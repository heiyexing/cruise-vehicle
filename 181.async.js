var iB=Object.defineProperty,aB=Object.defineProperties;var oB=Object.getOwnPropertyDescriptors;var nR=Object.getOwnPropertySymbols;var sB=Object.prototype.hasOwnProperty,uB=Object.prototype.propertyIsEnumerable;var Tp=Math.pow,iR=(Ue,_e,G)=>_e in Ue?iB(Ue,_e,{enumerable:!0,configurable:!0,writable:!0,value:G}):Ue[_e]=G,aR=(Ue,_e)=>{for(var G in _e||(_e={}))sB.call(_e,G)&&iR(Ue,G,_e[G]);if(nR)for(var G of nR(_e))uB.call(_e,G)&&iR(Ue,G,_e[G]);return Ue},oR=(Ue,_e)=>aB(Ue,oB(_e));(self.webpackChunk=self.webpackChunk||[]).push([[181],{81618:function(Ue){"use strict";(function(_e,G){Ue.exports=G()})(this,function(){function _e(Ce){var le=[];return Ce.AMapUI&&le.push(G(Ce.AMapUI)),Ce.Loca&&le.push(K(Ce.Loca)),Promise.all(le)}function G(Ce){return new Promise(function(le,Ie){var rt=[];if(Ce.plugins)for(var xt=0;xt<Ce.plugins.length;xt+=1)P.AMapUI.plugins.indexOf(Ce.plugins[xt])==-1&&rt.push(Ce.plugins[xt]);if(M.AMapUI===j.failed)Ie("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(M.AMapUI===j.notload){M.AMapUI=j.loading,P.AMapUI.version=Ce.version||P.AMapUI.version,xt=P.AMapUI.version;var nt=document.body||document.head,Ct=document.createElement("script");Ct.type="text/javascript",Ct.src="https://webapi.amap.com/ui/"+xt+"/main.js",Ct.onerror=function(jt){M.AMapUI=j.failed,Ie("\u8BF7\u6C42 AMapUI \u5931\u8D25")},Ct.onload=function(){if(M.AMapUI=j.loaded,rt.length)window.AMapUI.loadUI(rt,function(){for(var jt=0,Vt=rt.length;jt<Vt;jt++){var Rt=rt[jt].split("/").slice(-1)[0];window.AMapUI[Rt]=arguments[jt]}for(le();ee.AMapUI.length;)ee.AMapUI.splice(0,1)[0]()});else for(le();ee.AMapUI.length;)ee.AMapUI.splice(0,1)[0]()},nt.appendChild(Ct)}else M.AMapUI===j.loaded?Ce.version&&Ce.version!==P.AMapUI.version?Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):rt.length?window.AMapUI.loadUI(rt,function(){for(var jt=0,Vt=rt.length;jt<Vt;jt++){var Rt=rt[jt].split("/").slice(-1)[0];window.AMapUI[Rt]=arguments[jt]}le()}):le():Ce.version&&Ce.version!==P.AMapUI.version?Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):ee.AMapUI.push(function(jt){jt?Ie(jt):rt.length?window.AMapUI.loadUI(rt,function(){for(var Vt=0,Rt=rt.length;Vt<Rt;Vt++){var hr=rt[Vt].split("/").slice(-1)[0];window.AMapUI[hr]=arguments[Vt]}le()}):le()})})}function K(Ce){return new Promise(function(le,Ie){if(M.Loca===j.failed)Ie("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(M.Loca===j.notload){M.Loca=j.loading,P.Loca.version=Ce.version||P.Loca.version;var rt=P.Loca.version,xt=P.AMap.version.startsWith("2"),nt=rt.startsWith("2");if(xt&&!nt||!xt&&nt)Ie("JSAPI \u4E0E Loca \u7248\u672C\u4E0D\u5BF9\u5E94\uFF01\uFF01");else{xt=P.key,nt=document.body||document.head;var Ct=document.createElement("script");Ct.type="text/javascript",Ct.src="https://webapi.amap.com/loca?v="+rt+"&key="+xt,Ct.onerror=function(jt){M.Loca=j.failed,Ie("\u8BF7\u6C42 AMapUI \u5931\u8D25")},Ct.onload=function(){for(M.Loca=j.loaded,le();ee.Loca.length;)ee.Loca.splice(0,1)[0]()},nt.appendChild(Ct)}}else M.Loca===j.loaded?Ce.version&&Ce.version!==P.Loca.version?Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):le():Ce.version&&Ce.version!==P.Loca.version?Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):ee.Loca.push(function(jt){jt?Ie(jt):Ie()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var j;(function(Ce){Ce.notload="notload",Ce.loading="loading",Ce.loaded="loaded",Ce.failed="failed"})(j||(j={}));var P={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},M={AMap:j.notload,AMapUI:j.notload,Loca:j.notload},ee={AMap:[],AMapUI:[],Loca:[]},te=[],pe=function(Ce){typeof Ce=="function"&&(M.AMap===j.loaded?Ce(window.AMap):te.push(Ce))};return{load:function(Ce){return new Promise(function(le,Ie){if(M.AMap==j.failed)Ie("");else if(M.AMap==j.notload){var rt=Ce.key,xt=Ce.version,nt=Ce.plugins;rt?(window.AMap&&location.host!=="lbs.amap.com"&&Ie("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),P.key=rt,P.AMap.version=xt||P.AMap.version,P.AMap.plugins=nt||P.AMap.plugins,M.AMap=j.loading,xt=document.body||document.head,window.___onAPILoaded=function(jt){if(delete window.___onAPILoaded,jt)M.AMap=j.failed,Ie(jt);else for(M.AMap=j.loaded,_e(Ce).then(function(){le(window.AMap)}).catch(Ie);te.length;)te.splice(0,1)[0]()},nt=document.createElement("script"),nt.type="text/javascript",nt.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+P.AMap.version+"&key="+rt+"&plugin="+P.AMap.plugins.join(","),nt.onerror=function(jt){M.AMap=j.failed,Ie(jt)},xt.appendChild(nt)):Ie("\u8BF7\u586B\u5199key")}else if(M.AMap==j.loaded)if(Ce.key&&Ce.key!==P.key)Ie("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Ce.version&&Ce.version!==P.AMap.version)Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(rt=[],Ce.plugins)for(xt=0;xt<Ce.plugins.length;xt+=1)P.AMap.plugins.indexOf(Ce.plugins[xt])==-1&&rt.push(Ce.plugins[xt]);rt.length?window.AMap.plugin(rt,function(){_e(Ce).then(function(){le(window.AMap)}).catch(Ie)}):_e(Ce).then(function(){le(window.AMap)}).catch(Ie)}else if(Ce.key&&Ce.key!==P.key)Ie("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Ce.version&&Ce.version!==P.AMap.version)Ie("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var Ct=[];if(Ce.plugins)for(xt=0;xt<Ce.plugins.length;xt+=1)P.AMap.plugins.indexOf(Ce.plugins[xt])==-1&&Ct.push(Ce.plugins[xt]);pe(function(){Ct.length?window.AMap.plugin(Ct,function(){_e(Ce).then(function(){le(window.AMap)}).catch(Ie)}):_e(Ce).then(function(){le(window.AMap)}).catch(Ie)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,P={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},M={AMap:j.notload,AMapUI:j.notload,Loca:j.notload},ee={AMap:[],AMapUI:[],Loca:[]}}}})},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Ue){try{let le=function(){ee||(ee=!0,P())},Ie=function(){try{M.documentElement.doScroll("left")}catch(rt){return void setTimeout(Ie,50)}le()};var pe=le,Ce=Ie,G=(G=document.getElementsByTagName("script"))[G.length-1],_e=G.getAttribute("data-injectcss"),G=G.getAttribute("data-disable-injectsvg");if(!G){var K,j,P,M,ee,te=function(xt,nt){nt.parentNode.insertBefore(xt,nt)};if(_e&&!Ue.__iconfont__svg__cssinject__){Ue.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(rt){console&&console.log(rt)}}K=function(){var xt,nt=document.createElement("div");nt.innerHTML=Ue._iconfont_svg_string_3580659,(nt=nt.getElementsByTagName("svg")[0])&&(nt.setAttribute("aria-hidden","true"),nt.style.position="absolute",nt.style.width=0,nt.style.height=0,nt.style.overflow="hidden",nt=nt,(xt=document.body).firstChild?te(nt,xt.firstChild):xt.appendChild(nt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(K,0):(j=function(){document.removeEventListener("DOMContentLoaded",j,!1),K()},document.addEventListener("DOMContentLoaded",j,!1)):document.attachEvent&&(P=K,M=Ue.document,ee=!1,Ie(),M.onreadystatechange=function(){M.readyState=="complete"&&(M.onreadystatechange=null,le())})}}catch(le){}}(window)},67135:function(Ue,_e,G){(function(K,j){j(_e,G(53197))})(this,function(K,j){"use strict";var P={draw:"crosshair",pointHover:"pointer",pointDrag:"move",lineHover:"pointer",lineDrag:"move",polygonHover:"pointer",polygonDrag:"move"},M={point:[],line:[],polygon:[],midPoint:[],dashLine:[],text:[]},ee="top",te="bottom",pe="right",Ce="left",le="auto",Ie=[ee,te,pe,Ce],rt="start",xt="end",nt="clippingParents",Ct="viewport",jt="popper",Vt="reference",Rt=Ie.reduce(function(L,i){return L.concat([i+"-"+rt,i+"-"+xt])},[]),hr=[].concat(Ie,[le]).reduce(function(L,i){return L.concat([i,i+"-"+rt,i+"-"+xt])},[]),er=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function gn(L){return L?(L.nodeName||"").toLowerCase():null}function Rr(L){if(L==null)return window;if(""+L!="[object Window]"){var i=L.ownerDocument;return i&&i.defaultView||window}return L}function vn(L){return L instanceof Rr(L).Element||L instanceof Element}function rr(L){return L instanceof Rr(L).HTMLElement||L instanceof HTMLElement}function Jt(L){return typeof ShadowRoot!="undefined"&&(L instanceof Rr(L).ShadowRoot||L instanceof ShadowRoot)}var br={name:"applyStyles",enabled:!0,phase:"write",fn:function(L){var i=L.state;Object.keys(i.elements).forEach(function(s){var l=i.styles[s]||{},p=i.attributes[s]||{},S=i.elements[s];rr(S)&&gn(S)&&(Object.assign(S.style,l),Object.keys(p).forEach(function(A){var I=p[A];I===!1?S.removeAttribute(A):S.setAttribute(A,I===!0?"":I)}))})},effect:function(L){var i=L.state,s={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(i.elements.popper.style,s.popper),i.styles=s,i.elements.arrow&&Object.assign(i.elements.arrow.style,s.arrow),function(){Object.keys(i.elements).forEach(function(l){var p=i.elements[l],S=i.attributes[l]||{},A=Object.keys(i.styles.hasOwnProperty(l)?i.styles[l]:s[l]).reduce(function(I,U){return I[U]="",I},{});rr(p)&&gn(p)&&(Object.assign(p.style,A),Object.keys(S).forEach(function(I){p.removeAttribute(I)}))})}},requires:["computeStyles"]};function or(L){return L.split("-")[0]}var Br=Math.max,an=Math.min,ot=Math.round;function Dt(){var L=navigator.userAgentData;return L!=null&&L.brands&&Array.isArray(L.brands)?L.brands.map(function(i){return i.brand+"/"+i.version}).join(" "):navigator.userAgent}function Ee(){return!/^((?!chrome|android).)*safari/i.test(Dt())}function Bt(L,i,s){i===void 0&&(i=!1),s===void 0&&(s=!1);var l=L.getBoundingClientRect(),p=1,S=1;i&&rr(L)&&(p=L.offsetWidth>0&&ot(l.width)/L.offsetWidth||1,S=L.offsetHeight>0&&ot(l.height)/L.offsetHeight||1);var A=(vn(L)?Rr(L):window).visualViewport,I=!Ee()&&s,U=(l.left+(I&&A?A.offsetLeft:0))/p,q=(l.top+(I&&A?A.offsetTop:0))/S,re=l.width/p,de=l.height/S;return{width:re,height:de,top:q,right:U+re,bottom:q+de,left:U,x:U,y:q}}function Ot(L){var i=Bt(L),s=L.offsetWidth,l=L.offsetHeight;return Math.abs(i.width-s)>1||(s=i.width),Math.abs(i.height-l)>1||(l=i.height),{x:L.offsetLeft,y:L.offsetTop,width:s,height:l}}function Pr(L,i){var s=i.getRootNode&&i.getRootNode();if(L.contains(i))return!0;if(s&&Jt(s)){var l=i;do{if(l&&L.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function Fr(L){return Rr(L).getComputedStyle(L)}function Nr(L){return["table","td","th"].indexOf(gn(L))>=0}function hn(L){return((vn(L)?L.ownerDocument:L.document)||window.document).documentElement}function xn(L){return gn(L)==="html"?L:L.assignedSlot||L.parentNode||(Jt(L)?L.host:null)||hn(L)}function Ji(L){return rr(L)&&Fr(L).position!=="fixed"?L.offsetParent:null}function pi(L){for(var i=Rr(L),s=Ji(L);s&&Nr(s)&&Fr(s).position==="static";)s=Ji(s);return s&&(gn(s)==="html"||gn(s)==="body"&&Fr(s).position==="static")?i:s||function(l){var p=/firefox/i.test(Dt());if(/Trident/i.test(Dt())&&rr(l)&&Fr(l).position==="fixed")return null;var S=xn(l);for(Jt(S)&&(S=S.host);rr(S)&&0>["html","body"].indexOf(gn(S));){var A=Fr(S);if(A.transform!=="none"||A.perspective!=="none"||A.contain==="paint"||["transform","perspective"].indexOf(A.willChange)!==-1||p&&A.willChange==="filter"||p&&A.filter&&A.filter!=="none")return S;S=S.parentNode}return null}(L)||i}function Ka(L){return 0>["top","bottom"].indexOf(L)?"y":"x"}function na(L,i,s){return Br(L,an(i,s))}function ca(L){return Object.assign({},{top:0,right:0,bottom:0,left:0},L)}function po(L,i){return i.reduce(function(s,l){return s[l]=L,s},{})}var La={name:"arrow",enabled:!0,phase:"main",fn:function(L){var i,s=L.state,l=L.name,p=L.options,S=s.elements.arrow,A=s.modifiersData.popperOffsets,I=or(s.placement),U=Ka(I),q=[Ce,pe].indexOf(I)>=0?"height":"width";if(S&&A){var re=function(Pt,Xt){return ca(typeof(Pt=typeof Pt=="function"?Pt(Object.assign({},Xt.rects,{placement:Xt.placement})):Pt)!="number"?Pt:po(Pt,Ie))}(p.padding,s),de=Ot(S),we=U==="y"?ee:Ce,Oe=U==="y"?te:pe,Ge=s.rects.reference[q]+s.rects.reference[U]-A[U]-s.rects.popper[q],it=A[U]-s.rects.reference[U],tt=pi(S),ct=tt?U==="y"?tt.clientHeight||0:tt.clientWidth||0:0,ut=ct/2-de[q]/2+(Ge/2-it/2),Je=na(re[we],ut,ct-de[q]-re[Oe]);s.modifiersData[l]=((i={})[U]=Je,i.centerOffset=Je-ut,i)}},effect:function(L){var i=L.state,s=L.options.element,l=s===void 0?"[data-popper-arrow]":s;l!=null&&(typeof l!="string"||(l=i.elements.popper.querySelector(l)))&&Pr(i.elements.popper,l)&&(i.elements.arrow=l)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function $i(L){return L.split("-")[1]}var qo={top:"auto",right:"auto",bottom:"auto",left:"auto"};function is(L){var i,s=L.popper,l=L.popperRect,p=L.placement,S=L.variation,A=L.offsets,I=L.position,U=L.gpuAcceleration,q=L.adaptive,re=L.roundOffsets,de=L.isFixed,we=A.x,Oe=we===void 0?0:we,Ge=A.y,it=Ge===void 0?0:Ge,tt=typeof re=="function"?re({x:Oe,y:it}):{x:Oe,y:it};Oe=tt.x,it=tt.y;var ct=A.hasOwnProperty("x"),ut=A.hasOwnProperty("y"),Je=Ce,Pt=ee,Xt=window;if(q){var pr=pi(s),Ur="clientHeight",tn="clientWidth";pr===Rr(s)&&Fr(pr=hn(s)).position!=="static"&&I==="absolute"&&(Ur="scrollHeight",tn="scrollWidth"),(p===ee||(p===Ce||p===pe)&&S===xt)&&(Pt=te,it-=(de&&pr===Xt&&Xt.visualViewport?Xt.visualViewport.height:pr[Ur])-l.height,it*=U?1:-1),(p===Ce||(p===ee||p===te)&&S===xt)&&(Je=pe,Oe-=(de&&pr===Xt&&Xt.visualViewport?Xt.visualViewport.width:pr[tn])-l.width,Oe*=U?1:-1)}var An,xi=Object.assign({position:I},q&&qo),On=re===!0?function(si,kn){var ci=si.y,wi=kn.devicePixelRatio||1;return{x:ot(si.x*wi)/wi||0,y:ot(ci*wi)/wi||0}}({x:Oe,y:it},Rr(s)):{x:Oe,y:it};return Oe=On.x,it=On.y,Object.assign({},xi,U?((An={})[Pt]=ut?"0":"",An[Je]=ct?"0":"",An.transform=(Xt.devicePixelRatio||1)>1?"translate3d("+Oe+"px, "+it+"px, 0)":"translate("+Oe+"px, "+it+"px)",An):((i={})[Pt]=ut?it+"px":"",i[Je]=ct?Oe+"px":"",i.transform="",i))}var Ko={passive:!0},Za={left:"right",right:"left",bottom:"top",top:"bottom"};function ha(L){return L.replace(/left|right|bottom|top/g,function(i){return Za[i]})}var Fo={start:"end",end:"start"};function un(L){return L.replace(/start|end/g,function(i){return Fo[i]})}function Ua(L){var i=Rr(L);return{scrollLeft:i.pageXOffset,scrollTop:i.pageYOffset}}function zr(L){return Bt(hn(L)).left+Ua(L).scrollLeft}function be(L){var i=Fr(L);return/auto|scroll|overlay|hidden/.test(i.overflow+i.overflowY+i.overflowX)}function lt(L){return 0>["html","body","#document"].indexOf(gn(L))?rr(L)&&be(L)?L:lt(xn(L)):L.ownerDocument.body}function mt(L,i){var s;i===void 0&&(i=[]);var l=lt(L),p=l===((s=L.ownerDocument)==null?void 0:s.body),S=Rr(l),A=p?[S].concat(S.visualViewport||[],be(l)?l:[]):l,I=i.concat(A);return p?I:I.concat(mt(xn(A)))}function Qt(L){return Object.assign({},L,{left:L.x,top:L.y,right:L.x+L.width,bottom:L.y+L.height})}function xr(L,i,s){return i===Ct?Qt(function(l,p){var S=Rr(l),A=hn(l),I=S.visualViewport,U=A.clientWidth,q=A.clientHeight,re=0,de=0;if(I){U=I.width,q=I.height;var we=Ee();(we||!we&&p==="fixed")&&(re=I.offsetLeft,de=I.offsetTop)}return{width:U,height:q,x:re+zr(l),y:de}}(L,s)):vn(i)?function(l,p){var S=Bt(l,!1,p==="fixed");return S.top=S.top+l.clientTop,S.left=S.left+l.clientLeft,S.bottom=S.top+l.clientHeight,S.right=S.left+l.clientWidth,S.width=l.clientWidth,S.height=l.clientHeight,S.x=S.left,S.y=S.top,S}(i,s):Qt(function(l){var p,S=hn(l),A=Ua(l),I=(p=l.ownerDocument)==null?void 0:p.body,U=Br(S.scrollWidth,S.clientWidth,I?I.scrollWidth:0,I?I.clientWidth:0),q=Br(S.scrollHeight,S.clientHeight,I?I.scrollHeight:0,I?I.clientHeight:0),re=-A.scrollLeft+zr(l),de=-A.scrollTop;return Fr(I||S).direction==="rtl"&&(re+=Br(S.clientWidth,I?I.clientWidth:0)-U),{width:U,height:q,x:re,y:de}}(hn(L)))}function mn(L,i,s,l){var p=i==="clippingParents"?function(I){var U=mt(xn(I)),q=["absolute","fixed"].indexOf(Fr(I).position)>=0&&rr(I)?pi(I):I;return vn(q)?U.filter(function(re){return vn(re)&&Pr(re,q)&&gn(re)!=="body"}):[]}(L):[].concat(i),S=[].concat(p,[s]),A=S.reduce(function(I,U){var q=xr(L,U,l);return I.top=Br(q.top,I.top),I.right=an(q.right,I.right),I.bottom=an(q.bottom,I.bottom),I.left=Br(q.left,I.left),I},xr(L,S[0],l));return A.width=A.right-A.left,A.height=A.bottom-A.top,A.x=A.left,A.y=A.top,A}function Wn(L){var i,s=L.reference,l=L.element,p=L.placement,S=p?or(p):null,A=p?$i(p):null,I=s.x+s.width/2-l.width/2,U=s.y+s.height/2-l.height/2;switch(S){case ee:i={x:I,y:s.y-l.height};break;case te:i={x:I,y:s.y+s.height};break;case pe:i={x:s.x+s.width,y:U};break;case Ce:i={x:s.x-l.width,y:U};break;default:i={x:s.x,y:s.y}}var q=S?Ka(S):null;if(q!=null){var re=q==="y"?"height":"width";switch(A){case rt:i[q]=i[q]-(s[re]/2-l[re]/2);break;case xt:i[q]=i[q]+(s[re]/2-l[re]/2)}}return i}function tr(L,i){i===void 0&&(i={});var s=i.placement,l=s===void 0?L.placement:s,p=i.strategy,S=p===void 0?L.strategy:p,A=i.boundary,I=A===void 0?nt:A,U=i.rootBoundary,q=U===void 0?Ct:U,re=i.elementContext,de=re===void 0?jt:re,we=i.altBoundary,Oe=we!==void 0&&we,Ge=i.padding,it=Ge===void 0?0:Ge,tt=ca(typeof it!="number"?it:po(it,Ie)),ct=L.rects.popper,ut=L.elements[Oe?de===jt?Vt:jt:de],Je=mn(vn(ut)?ut:ut.contextElement||hn(L.elements.popper),I,q,S),Pt=Bt(L.elements.reference),Xt=Wn({reference:Pt,element:ct,strategy:"absolute",placement:l}),pr=Qt(Object.assign({},ct,Xt)),Ur=de===jt?pr:Pt,tn={top:Je.top-Ur.top+tt.top,bottom:Ur.bottom-Je.bottom+tt.bottom,left:Je.left-Ur.left+tt.left,right:Ur.right-Je.right+tt.right},An=L.modifiersData.offset;if(de===jt&&An){var xi=An[l];Object.keys(tn).forEach(function(On){var si=0>[pe,te].indexOf(On)?-1:1;tn[On]+=xi[0>[ee,te].indexOf(On)?"x":"y"]*si})}return tn}function Hr(L,i){i===void 0&&(i={});var s=i.boundary,l=i.rootBoundary,p=i.padding,S=i.flipVariations,A=i.allowedAutoPlacements,I=A===void 0?hr:A,U=$i(i.placement),q=U?S?Rt:Rt.filter(function(we){return $i(we)===U}):Ie,re=q.filter(function(we){return I.indexOf(we)>=0});re.length===0&&(re=q);var de=re.reduce(function(we,Oe){return we[Oe]=tr(L,{placement:Oe,boundary:s,rootBoundary:l,padding:p})[or(Oe)],we},{});return Object.keys(de).sort(function(we,Oe){return de[we]-de[Oe]})}var dr={name:"flip",enabled:!0,phase:"main",fn:function(L){var i=L.state,s=L.options,l=L.name;if(!i.modifiersData[l]._skip){for(var p=s.mainAxis,S=p===void 0||p,A=s.altAxis,I=A===void 0||A,U=s.fallbackPlacements,q=s.padding,re=s.boundary,de=s.rootBoundary,we=s.altBoundary,Oe=s.flipVariations,Ge=Oe===void 0||Oe,it=s.allowedAutoPlacements,tt=i.options.placement,ct=or(tt),ut=U||(ct===tt||!Ge?[ha(tt)]:function(Ti){if(or(Ti)===le)return[];var Aa=ha(Ti);return[un(Ti),Aa,un(Aa)]}(tt)),Je=[tt].concat(ut).reduce(function(Ti,Aa){return Ti.concat(or(Aa)===le?Hr(i,{placement:Aa,boundary:re,rootBoundary:de,padding:q,flipVariations:Ge,allowedAutoPlacements:it}):Aa)},[]),Pt=i.rects.reference,Xt=i.rects.popper,pr=new Map,Ur=!0,tn=Je[0],An=0;Je.length>An;An++){var xi=Je[An],On=or(xi),si=$i(xi)===rt,kn=[ee,te].indexOf(On)>=0,ci=kn?"width":"height",wi=tr(i,{placement:xi,boundary:re,rootBoundary:de,altBoundary:we,padding:q}),$n=kn?si?pe:Ce:si?te:ee;Pt[ci]>Xt[ci]&&($n=ha($n));var Si=ha($n),Kn=[];if(S&&Kn.push(0>=wi[On]),I&&Kn.push(0>=wi[$n],0>=wi[Si]),Kn.every(function(Ti){return Ti})){tn=xi,Ur=!1;break}pr.set(xi,Kn)}if(Ur)for(var la=function(Ti){var Aa=Je.find(function($o){var lo=pr.get($o);if(lo)return lo.slice(0,Ti).every(function(Oo){return Oo})});if(Aa)return tn=Aa,"break"},yn=Ge?3:1;yn>0&&la(yn)!=="break";yn--);i.placement!==tn&&(i.modifiersData[l]._skip=!0,i.placement=tn,i.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Un(L,i,s){return s===void 0&&(s={x:0,y:0}),{top:L.top-i.height-s.y,right:L.right-i.width+s.x,bottom:L.bottom-i.height+s.y,left:L.left-i.width-s.x}}function ti(L){return[ee,pe,te,Ce].some(function(i){return L[i]>=0})}var Yi={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(L){var i=L.state,s=L.name,l=L.options.offset,p=l===void 0?[0,0]:l,S=hr.reduce(function(U,q){return U[q]=function(re,de,we){var Oe=or(re),Ge=0>[Ce,ee].indexOf(Oe)?1:-1,it=typeof we=="function"?we(Object.assign({},de,{placement:re})):we,tt=it[0],ct=it[1];return tt=tt||0,ct=(ct||0)*Ge,0>[Ce,pe].indexOf(Oe)?{x:tt,y:ct}:{x:ct,y:tt}}(q,i.rects,p),U},{}),A=S[i.placement],I=A.y;i.modifiersData.popperOffsets!=null&&(i.modifiersData.popperOffsets.x+=A.x,i.modifiersData.popperOffsets.y+=I),i.modifiersData[s]=S}},ea={name:"preventOverflow",enabled:!0,phase:"main",fn:function(L){var i=L.state,s=L.options,l=L.name,p=s.mainAxis,S=p===void 0||p,A=s.altAxis,I=A!==void 0&&A,U=s.tether,q=U===void 0||U,re=s.tetherOffset,de=re===void 0?0:re,we=tr(i,{boundary:s.boundary,rootBoundary:s.rootBoundary,padding:s.padding,altBoundary:s.altBoundary}),Oe=or(i.placement),Ge=$i(i.placement),it=!Ge,tt=Ka(Oe),ct=tt==="x"?"y":"x",ut=i.modifiersData.popperOffsets,Je=i.rects.reference,Pt=i.rects.popper,Xt=typeof de=="function"?de(Object.assign({},i.rects,{placement:i.placement})):de,pr=typeof Xt=="number"?{mainAxis:Xt,altAxis:Xt}:Object.assign({mainAxis:0,altAxis:0},Xt),Ur=i.modifiersData.offset?i.modifiersData.offset[i.placement]:null,tn={x:0,y:0};if(ut){if(S){var An,xi=tt==="y"?ee:Ce,On=tt==="y"?te:pe,si=tt==="y"?"height":"width",kn=ut[tt],ci=kn+we[xi],wi=kn-we[On],$n=q?-Pt[si]/2:0,Si=Ge===rt?Je[si]:Pt[si],Kn=Ge===rt?-Pt[si]:-Je[si],la=i.elements.arrow,yn=q&&la?Ot(la):{width:0,height:0},Ti=i.modifiersData["arrow#persistent"]?i.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Aa=Ti[xi],$o=Ti[On],lo=na(0,Je[si],yn[si]),Oo=it?Je[si]/2-$n-lo-Aa-pr.mainAxis:Si-lo-Aa-pr.mainAxis,So=it?-Je[si]/2+$n+lo+$o+pr.mainAxis:Kn+lo+$o+pr.mainAxis,cs=i.elements.arrow&&pi(i.elements.arrow),Wo=(An=Ur==null?void 0:Ur[tt])!=null?An:0,Bo=kn+So-Wo,Xo=na(q?an(ci,kn+Oo-Wo-(cs?tt==="y"?cs.clientTop||0:cs.clientLeft||0:0)):ci,kn,q?Br(wi,Bo):wi);ut[tt]=Xo,tn[tt]=Xo-kn}if(I){var Au,Wi=ut[ct],hs=ct==="y"?"height":"width",Ba=Wi+we[tt==="x"?ee:Ce],bs=Wi-we[tt==="x"?te:pe],ms=[ee,Ce].indexOf(Oe)!==-1,Eo=(Au=Ur==null?void 0:Ur[ct])!=null?Au:0,gu=ms?Ba:Wi-Je[hs]-Pt[hs]-Eo+pr.altAxis,fs=ms?Wi+Je[hs]+Pt[hs]-Eo-pr.altAxis:bs,Cn=q&&ms?function(Ma,go,Na){var v=na(Ma,go,Na);return v>Na?Na:v}(gu,Wi,fs):na(q?gu:Ba,Wi,q?fs:bs);ut[ct]=Cn,tn[ct]=Cn-Wi}i.modifiersData[l]=tn}},requiresIfExists:["offset"]};function on(L,i,s){s===void 0&&(s=!1);var l,p,S=rr(i),A=rr(i)&&function(de){var we=de.getBoundingClientRect(),Oe=ot(we.width)/de.offsetWidth||1,Ge=ot(we.height)/de.offsetHeight||1;return Oe!==1||Ge!==1}(i),I=hn(i),U=Bt(L,A,s),q={scrollLeft:0,scrollTop:0},re={x:0,y:0};return(S||!S&&!s)&&((gn(i)!=="body"||be(I))&&(q=(l=i)!==Rr(l)&&rr(l)?{scrollLeft:(p=l).scrollLeft,scrollTop:p.scrollTop}:Ua(l)),rr(i)?((re=Bt(i,!0)).x+=i.clientLeft,re.y+=i.clientTop):I&&(re.x=zr(I))),{x:U.left+q.scrollLeft-re.x,y:U.top+q.scrollTop-re.y,width:U.width,height:U.height}}function Xn(L){var i=new Map,s=new Set,l=[];function p(S){s.add(S.name),[].concat(S.requires||[],S.requiresIfExists||[]).forEach(function(A){if(!s.has(A)){var I=i.get(A);I&&p(I)}}),l.push(S)}return L.forEach(function(S){i.set(S.name,S)}),L.forEach(function(S){s.has(S.name)||p(S)}),l}var Pi={placement:"bottom",modifiers:[],strategy:"absolute"};function Pa(){for(var L=arguments.length,i=Array(L),s=0;L>s;s++)i[s]=arguments[s];return!i.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function zo(L){L===void 0&&(L={});var i=L.defaultModifiers,s=i===void 0?[]:i,l=L.defaultOptions,p=l===void 0?Pi:l;return function(S,A,I){I===void 0&&(I=p);var U,q,re={placement:"bottom",orderedModifiers:[],options:Object.assign({},Pi,p),modifiersData:{},elements:{reference:S,popper:A},attributes:{},styles:{}},de=[],we=!1,Oe={state:re,setOptions:function(it){var tt=typeof it=="function"?it(re.options):it;Ge(),re.options=Object.assign({},p,re.options,tt),re.scrollParents={reference:vn(S)?mt(S):S.contextElement?mt(S.contextElement):[],popper:mt(A)};var ct,ut,Je=function(Pt){var Xt=Xn(Pt);return er.reduce(function(pr,Ur){return pr.concat(Xt.filter(function(tn){return tn.phase===Ur}))},[])}((ct=[].concat(s,re.options.modifiers),ut=ct.reduce(function(Pt,Xt){var pr=Pt[Xt.name];return Pt[Xt.name]=pr?Object.assign({},pr,Xt,{options:Object.assign({},pr.options,Xt.options),data:Object.assign({},pr.data,Xt.data)}):Xt,Pt},{}),Object.keys(ut).map(function(Pt){return ut[Pt]})));return re.orderedModifiers=Je.filter(function(Pt){return Pt.enabled}),re.orderedModifiers.forEach(function(Pt){var Xt=Pt.options,pr=Pt.effect;if(typeof pr=="function"){var Ur=pr({state:re,name:Pt.name,instance:Oe,options:Xt===void 0?{}:Xt});de.push(Ur||function(){})}}),Oe.update()},forceUpdate:function(){if(!we){var it=re.elements,tt=it.reference,ct=it.popper;if(Pa(tt,ct)){re.rects={reference:on(tt,pi(ct),re.options.strategy==="fixed"),popper:Ot(ct)},re.reset=!1,re.placement=re.options.placement,re.orderedModifiers.forEach(function(pr){return re.modifiersData[pr.name]=Object.assign({},pr.data)});for(var ut=0;re.orderedModifiers.length>ut;ut++)if(re.reset!==!0){var Je=re.orderedModifiers[ut],Pt=Je.fn,Xt=Je.options;typeof Pt=="function"&&(re=Pt({state:re,options:Xt===void 0?{}:Xt,name:Je.name,instance:Oe})||re)}else re.reset=!1,ut=-1}}},update:(U=function(){return new Promise(function(it){Oe.forceUpdate(),it(re)})},function(){return q||(q=new Promise(function(it){Promise.resolve().then(function(){q=void 0,it(U())})})),q}),destroy:function(){Ge(),we=!0}};if(!Pa(S,A))return Oe;function Ge(){de.forEach(function(it){return it()}),de=[]}return Oe.setOptions(I).then(function(it){!we&&I.onFirstUpdate&&I.onFirstUpdate(it)}),Oe}}var ya=zo({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(L){var i=L.state,s=L.instance,l=L.options,p=l.scroll,S=p===void 0||p,A=l.resize,I=A===void 0||A,U=Rr(i.elements.popper),q=[].concat(i.scrollParents.reference,i.scrollParents.popper);return S&&q.forEach(function(re){re.addEventListener("scroll",s.update,Ko)}),I&&U.addEventListener("resize",s.update,Ko),function(){S&&q.forEach(function(re){re.removeEventListener("scroll",s.update,Ko)}),I&&U.removeEventListener("resize",s.update,Ko)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(L){var i=L.state;i.modifiersData[L.name]=Wn({reference:i.rects.reference,element:i.rects.popper,strategy:"absolute",placement:i.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(L){var i=L.state,s=L.options,l=s.gpuAcceleration,p=l===void 0||l,S=s.adaptive,A=S===void 0||S,I=s.roundOffsets,U=I===void 0||I,q={placement:or(i.placement),variation:$i(i.placement),popper:i.elements.popper,popperRect:i.rects.popper,gpuAcceleration:p,isFixed:i.options.strategy==="fixed"};i.modifiersData.popperOffsets!=null&&(i.styles.popper=Object.assign({},i.styles.popper,is(Object.assign({},q,{offsets:i.modifiersData.popperOffsets,position:i.options.strategy,adaptive:A,roundOffsets:U})))),i.modifiersData.arrow!=null&&(i.styles.arrow=Object.assign({},i.styles.arrow,is(Object.assign({},q,{offsets:i.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:U})))),i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-placement":i.placement})},data:{}},br,Yi,dr,ea,La,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(L){var i=L.state,s=L.name,l=i.rects.reference,p=i.rects.popper,S=i.modifiersData.preventOverflow,A=tr(i,{elementContext:"reference"}),I=tr(i,{altBoundary:!0}),U=Un(A,l),q=Un(I,p,S),re=ti(U),de=ti(q);i.modifiersData[s]={referenceClippingOffsets:U,popperEscapeOffsets:q,isReferenceHidden:re,hasPopperEscaped:de},i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-reference-hidden":re,"data-popper-escaped":de})}}]}),Xu="tippy-content",Wt="tippy-backdrop",qe="tippy-arrow",se="tippy-svg-arrow",ve={passive:!0,capture:!0},Ae=function(){return document.body};function Re(L,i,s){if(Array.isArray(L)){var l=L[i];return l==null?Array.isArray(s)?s[i]:s:l}return L}function Xe(L,i){var s={}.toString.call(L);return s.indexOf("[object")===0&&s.indexOf(i+"]")>-1}function Qe(L,i){return typeof L=="function"?L.apply(void 0,i):L}function Ye(L,i){return i===0?L:function(l){clearTimeout(s),s=setTimeout(function(){L(l)},i)};var s}function Fe(L){return[].concat(L)}function Me(L,i){L.indexOf(i)===-1&&L.push(i)}function Be(L){return[].slice.call(L)}function yt(L){return Object.keys(L).reduce(function(i,s){return L[s]!==void 0&&(i[s]=L[s]),i},{})}function zt(){return document.createElement("div")}function Ze(L){return["Element","Fragment"].some(function(i){return Xe(L,i)})}function Yr(L){return Xe(L,"MouseEvent")}function Fn(L){return Ze(L)?[L]:function(i){return Xe(i,"NodeList")}(L)?Be(L):Array.isArray(L)?L:Be(document.querySelectorAll(L))}function Nn(L,i){L.forEach(function(s){s&&(s.style.transitionDuration=i+"ms")})}function qr(L,i){L.forEach(function(s){s&&s.setAttribute("data-state",i)})}function li(L){var i,s=Fe(L)[0];return s!=null&&(i=s.ownerDocument)!=null&&i.body?s.ownerDocument:document}function zn(L,i,s){var l=i+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(p){L[l](p,s)})}function jn(L,i){for(var s=i;s;){var l;if(L.contains(s))return!0;s=s.getRootNode==null||(l=s.getRootNode())==null?void 0:l.host}return!1}var Ca={isTouch:!1},ni=0;function za(){Ca.isTouch||(Ca.isTouch=!0,window.performance&&document.addEventListener("mousemove",Ao))}function Ao(){var L=performance.now();20>L-ni&&(Ca.isTouch=!1,document.removeEventListener("mousemove",Ao)),ni=L}function io(){var L,i=document.activeElement;(L=i)&&L._tippy&&L._tippy.reference===L&&i.blur&&!i._tippy.state.isVisible&&i.blur()}var ys=typeof window!="undefined"&&typeof document!="undefined"&&!!window.msCrypto,oo=Object.assign({appendTo:Ae,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),el=Object.keys(oo);function Qs(L){var i=(L.plugins||[]).reduce(function(s,l){var p,S=l.name;return S&&(s[S]=L[S]!==void 0?L[S]:(p=oo[S])!=null?p:l.defaultValue),s},{});return Object.assign({},L,i)}function vo(L,i){var s=Object.assign({},i,{content:Qe(i.content,[L])},i.ignoreAttributes?{}:function(l,p){return(p?Object.keys(Qs(Object.assign({},oo,{plugins:p}))):el).reduce(function(S,A){var I=(l.getAttribute("data-tippy-"+A)||"").trim();if(!I)return S;if(A==="content")S[A]=I;else try{S[A]=JSON.parse(I)}catch(U){S[A]=I}return S},{})}(L,i.plugins));return s.aria=Object.assign({},oo.aria,s.aria),s.aria={expanded:s.aria.expanded==="auto"?i.interactive:s.aria.expanded,content:s.aria.content==="auto"?i.interactive?null:"describedby":s.aria.content},s}var as=function(){return"innerHTML"};function To(L,i){L[as()]=i}function to(L){var i=zt();return L===!0?i.className=qe:(i.className=se,Ze(L)?i.appendChild(L):To(i,L)),i}function js(L,i){Ze(i.content)?(To(L,""),L.appendChild(i.content)):typeof i.content!="function"&&(i.allowHTML?To(L,i.content):L.textContent=i.content)}function Vc(L){var i=L.firstElementChild,s=Be(i.children);return{box:i,content:s.find(function(l){return l.classList.contains(Xu)}),arrow:s.find(function(l){return l.classList.contains(qe)||l.classList.contains(se)}),backdrop:s.find(function(l){return l.classList.contains(Wt)})}}function ws(L){var i=zt(),s=zt();s.className="tippy-box",s.setAttribute("data-state","hidden"),s.setAttribute("tabindex","-1");var l=zt();function p(S,A){var I=Vc(i),U=I.box,q=I.content,re=I.arrow;A.theme?U.setAttribute("data-theme",A.theme):U.removeAttribute("data-theme"),typeof A.animation=="string"?U.setAttribute("data-animation",A.animation):U.removeAttribute("data-animation"),A.inertia?U.setAttribute("data-inertia",""):U.removeAttribute("data-inertia"),U.style.maxWidth=typeof A.maxWidth=="number"?A.maxWidth+"px":A.maxWidth,A.role?U.setAttribute("role",A.role):U.removeAttribute("role"),S.content===A.content&&S.allowHTML===A.allowHTML||js(q,L.props),A.arrow?re?S.arrow!==A.arrow&&(U.removeChild(re),U.appendChild(to(A.arrow))):U.appendChild(to(A.arrow)):re&&U.removeChild(re)}return l.className=Xu,l.setAttribute("data-state","hidden"),js(l,L.props),i.appendChild(s),s.appendChild(l),p(L.props,L.props),{popper:i,onUpdate:p}}ws.$$tippy=!0;var Ss=1,eh=[],kc=[];function Io(L,i){var s,l,p,S,A,I,U,q,re=vo(L,Object.assign({},oo,Qs(yt(i)))),de=!1,we=!1,Oe=!1,Ge=!1,it=[],tt=Ye(Au,re.interactiveDebounce),ct=Ss++,ut=(q=re.plugins).filter(function(Cn,Ma){return q.indexOf(Cn)===Ma}),Je={id:ct,reference:L,popper:zt(),popperInstance:null,props:re,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:ut,clearDelayTimeouts:function(){clearTimeout(s),clearTimeout(l),cancelAnimationFrame(p)},setProps:function(Cn){if(!Je.state.isDestroyed){Si("onBeforeUpdate",[Je,Cn]),Bo();var Ma=Je.props,go=vo(L,Object.assign({},Ma,yt(Cn),{ignoreAttributes:!0}));Je.props=go,Wo(),Ma.interactiveDebounce!==go.interactiveDebounce&&(yn(),tt=Ye(Au,go.interactiveDebounce)),Ma.triggerTarget&&!go.triggerTarget?Fe(Ma.triggerTarget).forEach(function(Na){Na.removeAttribute("aria-expanded")}):go.triggerTarget&&L.removeAttribute("aria-expanded"),la(),$n(),pr&&pr(Ma,go),Je.popperInstance&&(bs(),Eo().forEach(function(Na){requestAnimationFrame(Na._tippy.popperInstance.forceUpdate)})),Si("onAfterUpdate",[Je,Cn])}},setContent:function(Cn){Je.setProps({content:Cn})},show:function(){var Cn=Je.state.isVisible,Ma=Je.state.isDestroyed,go=!Je.state.isEnabled,Na=Ca.isTouch&&!Je.props.touch,v=Re(Je.props.duration,0,oo.duration);if(!(Cn||Ma||go||Na)&&!si().hasAttribute("disabled")&&(Si("onShow",[Je],!1),Je.props.onShow(Je)!==!1)){if(Je.state.isVisible=!0,On()&&(Xt.style.visibility="visible"),$n(),lo(),Je.state.isMounted||(Xt.style.transition="none"),On()){var c=ci();Nn([c.box,c.content],0)}I=function(){var b;if(Je.state.isVisible&&!Ge){if(Ge=!0,Xt.style.transition=Je.props.moveTransition,On()&&Je.props.animation){var k=ci(),z=k.box,V=k.content;Nn([z,V],v),qr([z,V],"visible")}Kn(),la(),Me(kc,Je),(b=Je.popperInstance)==null||b.forceUpdate(),Si("onMount",[Je]),Je.props.animation&&On()&&function(W,ne){So(W,ne)}(v,function(){Je.state.isShown=!0,Si("onShown",[Je])})}},function(){var b,k=Je.props.appendTo,z=si();b=Je.props.interactive&&k===Ae||k==="parent"?z.parentNode:Qe(k,[z]),b.contains(Xt)||b.appendChild(Xt),Je.state.isMounted=!0,bs()}()}},hide:function(){var Cn=!Je.state.isVisible,Ma=Je.state.isDestroyed,go=!Je.state.isEnabled,Na=Re(Je.props.duration,1,oo.duration);if(!(Cn||Ma||go)&&(Si("onHide",[Je],!1),Je.props.onHide(Je)!==!1)){if(Je.state.isVisible=!1,Je.state.isShown=!1,Ge=!1,de=!1,On()&&(Xt.style.visibility="hidden"),yn(),Oo(),$n(!0),On()){var v=ci(),c=v.box,b=v.content;Je.props.animation&&(Nn([c,b],Na),qr([c,b],"hidden"))}Kn(),la(),Je.props.animation?On()&&function(k,z){So(k,function(){!Je.state.isVisible&&Xt.parentNode&&Xt.parentNode.contains(Xt)&&z()})}(Na,Je.unmount):Je.unmount()}},hideWithInteractivity:function(Cn){kn().addEventListener("mousemove",tt),Me(eh,tt),tt(Cn)},enable:function(){Je.state.isEnabled=!0},disable:function(){Je.hide(),Je.state.isEnabled=!1},unmount:function(){Je.state.isVisible&&Je.hide(),Je.state.isMounted&&(ms(),Eo().forEach(function(Cn){Cn._tippy.unmount()}),Xt.parentNode&&Xt.parentNode.removeChild(Xt),kc=kc.filter(function(Cn){return Cn!==Je}),Je.state.isMounted=!1,Si("onHidden",[Je]))},destroy:function(){Je.state.isDestroyed||(Je.clearDelayTimeouts(),Je.unmount(),Bo(),delete L._tippy,Je.state.isDestroyed=!0,Si("onDestroy",[Je]))}};if(!re.render)return Je;var Pt=re.render(Je),Xt=Pt.popper,pr=Pt.onUpdate;Xt.setAttribute("data-tippy-root",""),Xt.id="tippy-"+Je.id,Je.popper=Xt,L._tippy=Je,Xt._tippy=Je;var Ur=ut.map(function(Cn){return Cn.fn(Je)}),tn=L.hasAttribute("aria-expanded");return Wo(),la(),$n(),Si("onCreate",[Je]),re.showOnCreate&&gu(),Xt.addEventListener("mouseenter",function(){Je.props.interactive&&Je.state.isVisible&&Je.clearDelayTimeouts()}),Xt.addEventListener("mouseleave",function(){Je.props.interactive&&Je.props.trigger.indexOf("mouseenter")>=0&&kn().addEventListener("mousemove",tt)}),Je;function An(){var Cn=Je.props.touch;return Array.isArray(Cn)?Cn:[Cn,0]}function xi(){return An()[0]==="hold"}function On(){var Cn;return!((Cn=Je.props.render)==null||!Cn.$$tippy)}function si(){return U||L}function kn(){var Cn=si().parentNode;return Cn?li(Cn):document}function ci(){return Vc(Xt)}function wi(Cn){return Je.state.isMounted&&!Je.state.isVisible||Ca.isTouch||S&&S.type==="focus"?0:Re(Je.props.delay,Cn?0:1,oo.delay)}function $n(Cn){Cn===void 0&&(Cn=!1),Xt.style.pointerEvents=Je.props.interactive&&!Cn?"":"none",Xt.style.zIndex=""+Je.props.zIndex}function Si(Cn,Ma,go){var Na;go===void 0&&(go=!0),Ur.forEach(function(v){v[Cn]&&v[Cn].apply(v,Ma)}),go&&(Na=Je.props)[Cn].apply(Na,Ma)}function Kn(){var Cn=Je.props.aria;if(Cn.content){var Ma="aria-"+Cn.content,go=Xt.id;Fe(Je.props.triggerTarget||L).forEach(function(Na){var v=Na.getAttribute(Ma);if(Je.state.isVisible)Na.setAttribute(Ma,v?v+" "+go:go);else{var c=v&&v.replace(go,"").trim();c?Na.setAttribute(Ma,c):Na.removeAttribute(Ma)}})}}function la(){!tn&&Je.props.aria.expanded&&Fe(Je.props.triggerTarget||L).forEach(function(Cn){Je.props.interactive?Cn.setAttribute("aria-expanded",Je.state.isVisible&&Cn===si()?"true":"false"):Cn.removeAttribute("aria-expanded")})}function yn(){kn().removeEventListener("mousemove",tt),eh=eh.filter(function(Cn){return Cn!==tt})}function Ti(Cn){if(!Ca.isTouch||!Oe&&Cn.type!=="mousedown"){var Ma=Cn.composedPath&&Cn.composedPath()[0]||Cn.target;if(!Je.props.interactive||!jn(Xt,Ma)){if(Fe(Je.props.triggerTarget||L).some(function(go){return jn(go,Ma)})){if(Ca.isTouch||Je.state.isVisible&&Je.props.trigger.indexOf("click")>=0)return}else Si("onClickOutside",[Je,Cn]);Je.props.hideOnClick===!0&&(Je.clearDelayTimeouts(),Je.hide(),we=!0,setTimeout(function(){we=!1}),Je.state.isMounted||Oo())}}}function Aa(){Oe=!0}function $o(){Oe=!1}function lo(){var Cn=kn();Cn.addEventListener("mousedown",Ti,!0),Cn.addEventListener("touchend",Ti,ve),Cn.addEventListener("touchstart",$o,ve),Cn.addEventListener("touchmove",Aa,ve)}function Oo(){var Cn=kn();Cn.removeEventListener("mousedown",Ti,!0),Cn.removeEventListener("touchend",Ti,ve),Cn.removeEventListener("touchstart",$o,ve),Cn.removeEventListener("touchmove",Aa,ve)}function So(Cn,Ma){var go=ci().box;function Na(v){v.target===go&&(zn(go,"remove",Na),Ma())}if(Cn===0)return Ma();zn(go,"remove",A),zn(go,"add",Na),A=Na}function cs(Cn,Ma,go){go===void 0&&(go=!1),Fe(Je.props.triggerTarget||L).forEach(function(Na){Na.addEventListener(Cn,Ma,go),it.push({node:Na,eventType:Cn,handler:Ma,options:go})})}function Wo(){var Cn;xi()&&(cs("touchstart",Xo,{passive:!0}),cs("touchend",Wi,{passive:!0})),(Cn=Je.props.trigger,Cn.split(/\s+/).filter(Boolean)).forEach(function(Ma){if(Ma!=="manual")switch(cs(Ma,Xo),Ma){case"mouseenter":cs("mouseleave",Wi);break;case"focus":cs(ys?"focusout":"blur",hs);break;case"focusin":cs("focusout",hs)}})}function Bo(){it.forEach(function(Cn){Cn.node.removeEventListener(Cn.eventType,Cn.handler,Cn.options)}),it=[]}function Xo(Cn){var Ma,go=!1;if(Je.state.isEnabled&&!Ba(Cn)&&!we){var Na=((Ma=S)==null?void 0:Ma.type)==="focus";S=Cn,U=Cn.currentTarget,la(),!Je.state.isVisible&&Yr(Cn)&&eh.forEach(function(v){return v(Cn)}),Cn.type==="click"&&(0>Je.props.trigger.indexOf("mouseenter")||de)&&Je.props.hideOnClick!==!1&&Je.state.isVisible?go=!0:gu(Cn),Cn.type==="click"&&(de=!go),go&&!Na&&fs(Cn)}}function Au(Cn){var Ma=Cn.target,go=si().contains(Ma)||Xt.contains(Ma);if(Cn.type!=="mousemove"||!go){var Na=Eo().concat(Xt).map(function(v){var c,b=(c=v._tippy.popperInstance)==null?void 0:c.state;return b?{popperRect:v.getBoundingClientRect(),popperState:b,props:re}:null}).filter(Boolean);(function(v,c){var b=c.clientX,k=c.clientY;return v.every(function(z){var V=z.popperRect,W=z.popperState,ne=z.props.interactiveBorder,he=W.placement.split("-")[0],Se=W.modifiersData.offset;return!Se||V.top-k+(he==="bottom"?Se.top.y:0)>ne||k-V.bottom-(he==="top"?Se.bottom.y:0)>ne||V.left-b+(he==="right"?Se.left.x:0)>ne||b-V.right-(he==="left"?Se.right.x:0)>ne})})(Na,Cn)&&(yn(),fs(Cn))}}function Wi(Cn){Ba(Cn)||Je.props.trigger.indexOf("click")>=0&&de||(Je.props.interactive?Je.hideWithInteractivity(Cn):fs(Cn))}function hs(Cn){0>Je.props.trigger.indexOf("focusin")&&Cn.target!==si()||Je.props.interactive&&Cn.relatedTarget&&Xt.contains(Cn.relatedTarget)||fs(Cn)}function Ba(Cn){return!!Ca.isTouch&&xi()!==Cn.type.indexOf("touch")>=0}function bs(){ms();var Cn=Je.props,Ma=Cn.popperOptions,go=Cn.placement,Na=Cn.offset,v=Cn.getReferenceClientRect,c=Cn.moveTransition,b=On()?Vc(Xt).arrow:null,k=v?{getBoundingClientRect:v,contextElement:v.contextElement||si()}:L,z={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(W){var ne=W.state;if(On()){var he=ci().box;["placement","reference-hidden","escaped"].forEach(function(Se){Se==="placement"?he.setAttribute("data-placement",ne.placement):ne.attributes.popper["data-popper-"+Se]?he.setAttribute("data-"+Se,""):he.removeAttribute("data-"+Se)}),ne.attributes.popper={}}}},V=[{name:"offset",options:{offset:Na}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!c}},z];On()&&b&&V.push({name:"arrow",options:{element:b,padding:3}}),V.push.apply(V,(Ma==null?void 0:Ma.modifiers)||[]),Je.popperInstance=ya(k,Xt,Object.assign({},Ma,{placement:go,onFirstUpdate:I,modifiers:V}))}function ms(){Je.popperInstance&&(Je.popperInstance.destroy(),Je.popperInstance=null)}function Eo(){return Be(Xt.querySelectorAll("[data-tippy-root]"))}function gu(Cn){Je.clearDelayTimeouts(),Cn&&Si("onTrigger",[Je,Cn]),lo();var Ma=wi(!0),go=An(),Na=go[1];Ca.isTouch&&go[0]==="hold"&&Na&&(Ma=Na),Ma?s=setTimeout(function(){Je.show()},Ma):Je.show()}function fs(Cn){if(Je.clearDelayTimeouts(),Si("onUntrigger",[Je,Cn]),Je.state.isVisible){if(0>Je.props.trigger.indexOf("mouseenter")||0>Je.props.trigger.indexOf("click")||0>["mouseleave","mousemove"].indexOf(Cn.type)||!de){var Ma=wi(!1);Ma?l=setTimeout(function(){Je.state.isVisible&&Je.hide()},Ma):p=requestAnimationFrame(function(){Je.hide()})}}else Oo()}}function bo(L,i){i===void 0&&(i={});var s=oo.plugins.concat(i.plugins||[]);document.addEventListener("touchstart",za,ve),window.addEventListener("blur",io);var l=Object.assign({},i,{plugins:s}),p=Fn(L).reduce(function(S,A){var I=A&&Io(A,l);return I&&S.push(I),S},[]);return Ze(L)?p[0]:p}bo.defaultProps=oo,bo.setDefaultProps=function(L){Object.keys(L).forEach(function(i){oo[i]=L[i]})},bo.currentInput=Ca,Object.assign({},br,{effect:function(L){var i=L.state,s={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,s.popper),i.styles=s,i.elements.arrow&&Object.assign(i.elements.arrow.style,s.arrow)}});var du={clientX:0,clientY:0},Zo=[];function Il(L){du={clientX:L.clientX,clientY:L.clientY}}var Uo={name:"followCursor",defaultValue:!1,fn:function(L){var i=L.reference,s=li(L.props.triggerTarget||i),l=!1,p=!1,S=!0,A=L.props;function I(){return L.props.followCursor==="initial"&&L.state.isVisible}function U(){s.addEventListener("mousemove",de)}function q(){s.removeEventListener("mousemove",de)}function re(){l=!0,L.setProps({getReferenceClientRect:null}),l=!1}function de(Ge){var it=!Ge.target||i.contains(Ge.target),tt=L.props.followCursor,ct=Ge.clientX,ut=Ge.clientY,Je=i.getBoundingClientRect(),Pt=ct-Je.left,Xt=ut-Je.top;!it&&L.props.interactive||L.setProps({getReferenceClientRect:function(){var pr=i.getBoundingClientRect(),Ur=ct,tn=ut;tt==="initial"&&(Ur=pr.left+Pt,tn=pr.top+Xt);var An=tt==="horizontal"?pr.top:tn,xi=tt==="vertical"?pr.right:Ur,On=tt==="horizontal"?pr.bottom:tn,si=tt==="vertical"?pr.left:Ur;return{width:xi-si,height:On-An,top:An,right:xi,bottom:On,left:si}}})}function we(){L.props.followCursor&&(Zo.push({instance:L,doc:s}),function(Ge){Ge.addEventListener("mousemove",Il)}(s))}function Oe(){(Zo=Zo.filter(function(Ge){return Ge.instance!==L})).filter(function(Ge){return Ge.doc===s}).length===0&&function(Ge){Ge.removeEventListener("mousemove",Il)}(s)}return{onCreate:we,onDestroy:Oe,onBeforeUpdate:function(){A=L.props},onAfterUpdate:function(Ge,it){var tt=it.followCursor;l||tt!==void 0&&A.followCursor!==tt&&(Oe(),tt?(we(),!L.state.isMounted||p||I()||U()):(q(),re()))},onMount:function(){L.props.followCursor&&!p&&(S&&(de(du),S=!1),I()||U())},onTrigger:function(Ge,it){Yr(it)&&(du={clientX:it.clientX,clientY:it.clientY}),p=it.type==="focus"},onHidden:function(){L.props.followCursor&&(re(),q(),S=!0)}}}};bo.setDefaultProps({render:ws});var Ws,eu,sl,ul,ll,_c,zu={showTotalDistance:!1,showDashDistance:!0,showWhen:["normal","active"],format:function(L){return 1e3>L?+L.toFixed(2)+"m":+(L/1e3).toFixed(2)+"km"}},cl={showWhen:["normal","active"],format:function(L){return L>1e6?"".concat(+(L/1e6).toFixed(2),"km\xB2"):"".concat(+L.toFixed(2),"m\xB2")}},iu={maxSize:100},_t={remove:["del","backspace"],revert:["command+z","ctrl+z"],redo:["command+shift+z","ctrl+shift+z"]},Ut={allowHTML:!0,followCursor:!0,placement:"bottom-start",offset:[-10,20],plugins:[Uo],trigger:"manual",hideOnClick:!1,theme:"light"},Er={data:"drawData",pointAdsorbPixel:12,lineAdsorbPixel:10};function Sn(L,i){var s=Object.keys(L);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(L);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(L,p).enumerable})),s.push.apply(s,l)}return s}function kr(L){for(var i=1;arguments.length>i;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Sn(Object(s),!0).forEach(function(l){au(L,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(s)):Sn(Object(s)).forEach(function(l){Object.defineProperty(L,l,Object.getOwnPropertyDescriptor(s,l))})}return L}function wa(L){return wa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},wa(L)}function Xa(L,i){if(!(L instanceof i))throw new TypeError("Cannot call a class as a function")}function yl(L,i){for(var s=0;i.length>s;s++){var l=i[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(L,cc(l.key),l)}}function Jo(L,i,s){return i&&yl(L.prototype,i),s&&yl(L,s),Object.defineProperty(L,"prototype",{writable:!1}),L}function au(L,i,s){return(i=cc(i))in L?Object.defineProperty(L,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):L[i]=s,L}function ou(L,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");L.prototype=Object.create(i&&i.prototype,{constructor:{value:L,writable:!0,configurable:!0}}),Object.defineProperty(L,"prototype",{writable:!1}),i&&Mp(L,i)}function Ra(L){return Ra=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Ra(L)}function Mp(L,i){return Mp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,l){return s.__proto__=l,s},Mp(L,i)}function th(L){if(L===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L}function su(L){var i=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(s){return!1}}();return function(){var s,l=Ra(L);if(i){var p=Ra(this).constructor;s=Reflect.construct(l,arguments,p)}else s=l.apply(this,arguments);return function(S,A){if(A&&(typeof A=="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return th(S)}(this,s)}}function _a(){return _a=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(L,i,s){var l=function(S,A){for(;!Object.prototype.hasOwnProperty.call(S,A)&&(S=Ra(S))!==null;);return S}(L,i);if(l){var p=Object.getOwnPropertyDescriptor(l,i);return p.get?p.get.call(3>arguments.length?L:s):p.value}},_a.apply(this,arguments)}function os(L,i){return function(s){if(Array.isArray(s))return s}(L)||function(s,l){var p=s==null?null:typeof Symbol!="undefined"&&s[Symbol.iterator]||s["@@iterator"];if(p!=null){var S,A,I,U,q=[],re=!0,de=!1;try{if(I=(p=p.call(s)).next,l===0){if(Object(p)!==p)return;re=!1}else for(;!(re=(S=I.call(p)).done)&&(q.push(S.value),q.length!==l);re=!0);}catch(we){de=!0,A=we}finally{try{if(!re&&p.return!=null&&(U=p.return(),Object(U)!==U))return}finally{if(de)throw A}}return q}}(L,i)||Eh(L,i)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Su(L){return function(i){if(Array.isArray(i))return Mo(i)}(L)||function(i){if(typeof Symbol!="undefined"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}(L)||Eh(L)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Eh(L,i){if(L){if(typeof L=="string")return Mo(L,i);var s=Object.prototype.toString.call(L).slice(8,-1);return s==="Object"&&L.constructor&&(s=L.constructor.name),s==="Map"||s==="Set"?Array.from(L):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Mo(L,i):void 0}}function Mo(L,i){(i==null||i>L.length)&&(i=L.length);for(var s=0,l=Array(i);i>s;s++)l[s]=L[s];return l}function cc(L){var i=function(s,l){if(typeof s!="object"||s===null)return s;var p=s[Symbol.toPrimitive];if(p!==void 0){var S=p.call(s,l||"default");if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(s)}(L,"string");return typeof i=="symbol"?i:i+""}(Ws=K.DrawEvent||(K.DrawEvent={})).Init="init",Ws.Destroy="destroy",Ws.Enable="enable",Ws.Disable="disable",Ws.Add="add",Ws.Edit="edit",Ws.Remove="remove",Ws.Clear="clear",Ws.Change="change",Ws.DragStart="dragStart",Ws.Dragging="dragging",Ws.DragEnd="dragEnd",Ws.Select="select",Ws.AddNode="addNode",Ws.RemoveNode="removeNode",(eu=K.SourceEvent||(K.SourceEvent={})).Change="change",eu.Update="update",(sl=K.RenderEvent||(K.RenderEvent={})).Click="click",sl.UnClick="unclick",sl.Dragstart="dragstart",sl.Mousemove="mousemove",sl.Mouseout="mouseout",sl.Dragging="dragging",sl.Dragend="dragend",sl.DblClick="dblClick",sl.Contextmenu="contextmenu",(ul=K.LayerEvent||(K.LayerEvent={})).Mousedown="mousedown",ul.Mouseup="mouseup",ul.Click="click",ul.UnClick="unclick",ul.Dblclick="dblclick",ul.Mousemove="mousemove",ul.Mouseover="mouseover",ul.Mouseenter="mouseenter",ul.Mouseleave="mouseleave",ul.Mouseout="mouseout",ul.Contextmenu="contextmenu",(ll=K.SceneEvent||(K.SceneEvent={})).Loaded="loaded",ll.MapMove="mapmove",ll.MoveStart="movestart",ll.MoveEnd="moveend",ll.ZoomChange="zoomchange",ll.ZoomStart="zoomstart",ll.ZoomEnd="zoomend",ll.Click="click",ll.Dblclick="dblclick",ll.Mousemove="mousemove",ll.Mousewheel="mousewheel",ll.Mouseover="mouseover",ll.Mouseout="mouseout",ll.Mouseup="mouseup",ll.Mousedown="mousedown",ll.Contextmenu="contextmenu",ll.Dragstart="dragstart",ll.Dragging="dragging",ll.Dragend="dragend",(_c=K.ControlEvent||(K.ControlEvent={})).DrawChange="drawchange",_c.DataChange="datachange",_c.DrawSelect="drawselect",_c.DrawClear="drawclear";var uu=63710088e-1,Ja={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260511392e-6,inches:39.37*uu,kilometers:6371.0088,kilometres:6371.0088,meters:uu,metres:uu,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:uu/1852,radians:1,yards:6967335223679999e-9},rf={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Yu(L,i,s){s===void 0&&(s={});var l={type:"Feature"};return(s.id===0||s.id)&&(l.id=s.id),s.bbox&&(l.bbox=s.bbox),l.properties=i||{},l.geometry=L,l}function Vs(L,i,s){if(s===void 0&&(s={}),!L)throw Error("coordinates is required");if(!Array.isArray(L))throw Error("coordinates must be an Array");if(2>L.length)throw Error("coordinates must be at least 2 numbers long");if(!sd(L[0])||!sd(L[1]))throw Error("coordinates must contain numbers");return Yu({type:"Point",coordinates:L},i,s)}function yh(L,i,s){s===void 0&&(s={});for(var l=0,p=L;p.length>l;l++){var S=p[l];if(4>S.length)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var A=0;S[S.length-1].length>A;A++)if(S[S.length-1][A]!==S[0][A])throw Error("First and last Position are not equivalent.")}return Yu({type:"Polygon",coordinates:L},i,s)}function tl(L,i,s){if(s===void 0&&(s={}),2>L.length)throw Error("coordinates must be an array of two or more positions");return Yu({type:"LineString",coordinates:L},i,s)}function vu(L,i){i===void 0&&(i={});var s={type:"FeatureCollection"};return i.id&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.features=L,s}function Ch(L,i,s){return s===void 0&&(s={}),Yu({type:"MultiLineString",coordinates:L},i,s)}function Hf(L,i,s){return s===void 0&&(s={}),Yu({type:"MultiPoint",coordinates:L},i,s)}function Vn(L,i,s){return s===void 0&&(s={}),Yu({type:"MultiPolygon",coordinates:L},i,s)}function gi(L,i){i===void 0&&(i="kilometers");var s=Ja[i];if(!s)throw Error(i+" units is invalid");return L*s}function Hp(L,i){i===void 0&&(i="kilometers");var s=Ja[i];if(!s)throw Error(i+" units is invalid");return L/s}function nf(L){return 180*(L%(2*Math.PI))/Math.PI}function Gc(L){return L%360*Math.PI/180}function sd(L){return!isNaN(L)&&L!==null&&!Array.isArray(L)}function Bu(L){return!!L&&L.constructor===Object}var $d=Object.freeze({__proto__:null,earthRadius:uu,factors:Ja,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/uu,yards:1.0936133},areaFactors:rf,feature:Yu,geometry:function(L,i,s){switch(L){case"Point":return Vs(i).geometry;case"LineString":return tl(i).geometry;case"Polygon":return yh(i).geometry;case"MultiPoint":return Hf(i).geometry;case"MultiLineString":return Ch(i).geometry;case"MultiPolygon":return Vn(i).geometry;default:throw Error(L+" is invalid")}},point:Vs,points:function(L,i,s){return s===void 0&&(s={}),vu(L.map(function(l){return Vs(l,i)}),s)},polygon:yh,polygons:function(L,i,s){return s===void 0&&(s={}),vu(L.map(function(l){return yh(l,i)}),s)},lineString:tl,lineStrings:function(L,i,s){return s===void 0&&(s={}),vu(L.map(function(l){return tl(l,i)}),s)},featureCollection:vu,multiLineString:Ch,multiPoint:Hf,multiPolygon:Vn,geometryCollection:function(L,i,s){return s===void 0&&(s={}),Yu({type:"GeometryCollection",geometries:L},i,s)},round:function(L,i){if(i===void 0&&(i=0),i&&i<0)throw Error("precision must be a positive number");var s=Math.pow(10,i||0);return Math.round(L*s)/s},radiansToLength:gi,lengthToRadians:Hp,lengthToDegrees:function(L,i){return nf(Hp(L,i))},bearingToAzimuth:function(L){var i=L%360;return 0>i&&(i+=360),i},radiansToDegrees:nf,degreesToRadians:Gc,convertLength:function(L,i,s){if(i===void 0&&(i="kilometers"),s===void 0&&(s="kilometers"),L<0)throw Error("length must be a positive number");return gi(Hp(L,i),s)},convertArea:function(L,i,s){if(i===void 0&&(i="meters"),s===void 0&&(s="kilometers"),L<0)throw Error("area must be a positive number");var l=rf[i];if(!l)throw Error("invalid original units");var p=rf[s];if(!p)throw Error("invalid final units");return L/l*p},isNumber:sd,isObject:Bu,validateBBox:function(L){if(!L)throw Error("bbox is required");if(!Array.isArray(L))throw Error("bbox must be an Array");if(L.length!==4&&L.length!==6)throw Error("bbox must be an Array of 4 or 6 numbers");L.forEach(function(i){if(!sd(i))throw Error("bbox must only contain numbers")})},validateId:function(L){if(!L)throw Error("id is required");if(["string","number"].indexOf(typeof L)===-1)throw Error("id must be a number or a string")}});function rh(L,i,s){if(L!==null)for(var l,p,S,A,I,U,q,re,de=0,we=0,Oe=L.type,Ge=Oe==="FeatureCollection",it=Oe==="Feature",tt=Ge?L.features.length:1,ct=0;tt>ct;ct++){I=(re=!!(q=Ge?L.features[ct].geometry:it?L.geometry:L)&&q.type==="GeometryCollection")?q.geometries.length:1;for(var ut=0;I>ut;ut++){var Je=0,Pt=0;if((A=re?q.geometries[ut]:q)!==null){U=A.coordinates;var Xt=A.type;switch(de=!s||Xt!=="Polygon"&&Xt!=="MultiPolygon"?0:1,Xt){case null:break;case"Point":if(i(U,we,ct,Je,Pt)===!1)return!1;we++,Je++;break;case"LineString":case"MultiPoint":for(l=0;U.length>l;l++){if(i(U[l],we,ct,Je,Pt)===!1)return!1;we++,Xt==="MultiPoint"&&Je++}Xt==="LineString"&&Je++;break;case"Polygon":case"MultiLineString":for(l=0;U.length>l;l++){for(p=0;U[l].length-de>p;p++){if(i(U[l][p],we,ct,Je,Pt)===!1)return!1;we++}Xt==="MultiLineString"&&Je++,Xt==="Polygon"&&Pt++}Xt==="Polygon"&&Je++;break;case"MultiPolygon":for(l=0;U.length>l;l++){for(Pt=0,p=0;U[l].length>p;p++){for(S=0;U[l][p].length-de>S;S++){if(i(U[l][p][S],we,ct,Je,Pt)===!1)return!1;we++}Pt++}Je++}break;case"GeometryCollection":for(l=0;A.geometries.length>l;l++)if(rh(A.geometries[l],i,s)===!1)return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function Ah(L,i){var s;switch(L.type){case"FeatureCollection":for(s=0;L.features.length>s&&i(L.features[s].properties,s)!==!1;s++);break;case"Feature":i(L.properties,0)}}function lp(L,i){if(L.type==="Feature")i(L,0);else if(L.type==="FeatureCollection")for(var s=0;L.features.length>s&&i(L.features[s],s)!==!1;s++);}function hl(L){var i=[];return rh(L,function(s){i.push(s)}),i}function $f(L,i){var s,l,p,S,A,I,U,q,re,de,we=0,Oe=L.type==="FeatureCollection",Ge=L.type==="Feature",it=Oe?L.features.length:1;for(s=0;it>s;s++){for(q=Oe?L.features[s].properties:Ge?L.properties:{},re=Oe?L.features[s].bbox:Ge?L.bbox:void 0,de=Oe?L.features[s].id:Ge?L.id:void 0,A=(U=!!(I=Oe?L.features[s].geometry:Ge?L.geometry:L)&&I.type==="GeometryCollection")?I.geometries.length:1,p=0;A>p;p++)if((S=U?I.geometries[p]:I)!==null)switch(S.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(i(S,we,q,re,de)===!1)return!1;break;case"GeometryCollection":for(l=0;S.geometries.length>l;l++)if(i(S.geometries[l],we,q,re,de)===!1)return!1;break;default:throw Error("Unknown Geometry Type")}else if(i(null,we,q,re,de)===!1)return!1;we++}}function Th(L,i,s){var l=s;return $f(L,function(p,S,A,I,U){l=S===0&&s===void 0?p:i(l,p,S,A,I,U)}),l}function _h(L,i){$f(L,function(s,l,p,S,A){var I,U=s===null?null:s.type;switch(U){case null:case"Point":case"LineString":case"Polygon":return i(Yu(s,p,{bbox:S,id:A}),l,0)!==!1&&void 0}switch(U){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon"}for(var q=0;s.coordinates.length>q;q++)if(i(Yu({type:I,coordinates:s.coordinates[q]},p),l,q)===!1)return!1})}function nh(L,i){_h(L,function(s,l,p){var S=0;if(s.geometry){var A=s.geometry.type;if(A!=="Point"&&A!=="MultiPoint"){var I,U=0,q=0,re=0;return rh(s,function(de,we,Oe,Ge,it){if(I===void 0||l>U||Ge>q||it>re)return I=de,U=l,q=Ge,re=it,void(S=0);var tt=tl([I,de],s.properties);if(i(tt,l,p,it,S)===!1)return!1;S++,I=de})!==!1&&void 0}}})}function $p(L,i,s){var l=s,p=!1;return nh(L,function(S,A,I,U,q){l=p===!1&&s===void 0?S:i(l,S,A,I,U,q),p=!0}),l}function cp(L,i){if(!L)throw Error("geojson is required");_h(L,function(s,l,p){if(s.geometry!==null){var S=s.geometry.coordinates;switch(s.geometry.type){case"LineString":if(i(s,l,p,0,0)===!1)return!1;break;case"Polygon":for(var A=0;S.length>A;A++)if(i(tl(S[A],s.properties),l,p,A)===!1)return!1}}})}var Mu=Object.freeze({__proto__:null,coordAll:hl,coordEach:rh,coordReduce:function(L,i,s,l){var p=s;return rh(L,function(S,A,I,U,q){p=A===0&&s===void 0?S:i(p,S,A,I,U,q)},l),p},featureEach:lp,featureReduce:function(L,i,s){var l=s;return lp(L,function(p,S){l=S===0&&s===void 0?p:i(l,p,S)}),l},findPoint:function(L,i){if(!Bu(i=i||{}))throw Error("options is invalid");var s,l=i.featureIndex||0,p=i.multiFeatureIndex||0,S=i.geometryIndex||0,A=i.coordIndex||0,I=i.properties;switch(L.type){case"FeatureCollection":0>l&&(l=L.features.length+l),I=I||L.features[l].properties,s=L.features[l].geometry;break;case"Feature":I=I||L.properties,s=L.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=L;break;default:throw Error("geojson is invalid")}if(s===null)return null;var U=s.coordinates;switch(s.type){case"Point":return Vs(U,I,i);case"MultiPoint":return 0>p&&(p=U.length+p),Vs(U[p],I,i);case"LineString":return 0>A&&(A=U.length+A),Vs(U[A],I,i);case"Polygon":return 0>S&&(S=U.length+S),0>A&&(A=U[S].length+A),Vs(U[S][A],I,i);case"MultiLineString":return 0>p&&(p=U.length+p),0>A&&(A=U[p].length+A),Vs(U[p][A],I,i);case"MultiPolygon":return 0>p&&(p=U.length+p),0>S&&(S=U[p].length+S),0>A&&(A=U[p][S].length-A),Vs(U[p][S][A],I,i)}throw Error("geojson is invalid")},findSegment:function(L,i){if(!Bu(i=i||{}))throw Error("options is invalid");var s,l=i.featureIndex||0,p=i.multiFeatureIndex||0,S=i.geometryIndex||0,A=i.segmentIndex||0,I=i.properties;switch(L.type){case"FeatureCollection":0>l&&(l=L.features.length+l),I=I||L.features[l].properties,s=L.features[l].geometry;break;case"Feature":I=I||L.properties,s=L.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=L;break;default:throw Error("geojson is invalid")}if(s===null)return null;var U=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return 0>A&&(A=U.length+A-1),tl([U[A],U[A+1]],I,i);case"Polygon":return 0>S&&(S=U.length+S),0>A&&(A=U[S].length+A-1),tl([U[S][A],U[S][A+1]],I,i);case"MultiLineString":return 0>p&&(p=U.length+p),0>A&&(A=U[p].length+A-1),tl([U[p][A],U[p][A+1]],I,i);case"MultiPolygon":return 0>p&&(p=U.length+p),0>S&&(S=U[p].length+S),0>A&&(A=U[p][S].length-A-1),tl([U[p][S][A],U[p][S][A+1]],I,i)}throw Error("geojson is invalid")},flattenEach:_h,flattenReduce:function(L,i,s){var l=s;return _h(L,function(p,S,A){l=S===0&&A===0&&s===void 0?p:i(l,p,S,A)}),l},geomEach:$f,geomReduce:Th,lineEach:cp,lineReduce:function(L,i,s){var l=s;return cp(L,function(p,S,A,I){l=S===0&&s===void 0?p:i(l,p,S,A,I)}),l},propEach:Ah,propReduce:function(L,i,s){var l=s;return Ah(L,function(p,S){l=S===0&&s===void 0?p:i(l,p,S)}),l},segmentEach:nh,segmentReduce:$p});function af(L){var i=[1/0,1/0,-1/0,-1/0];return rh(L,function(s){i[0]>s[0]&&(i[0]=s[0]),i[1]>s[1]&&(i[1]=s[1]),s[0]>i[2]&&(i[2]=s[0]),s[1]>i[3]&&(i[3]=s[1])}),i}af.default=af;var hp=Object.freeze({__proto__:null,default:af});function ih(L){if(!L)throw Error("coord is required");if(!Array.isArray(L)){if(L.type==="Feature"&&L.geometry!==null&&L.geometry.type==="Point")return L.geometry.coordinates;if(L.type==="Point")return L.coordinates}if(Array.isArray(L)&&L.length>=2&&!Array.isArray(L[0])&&!Array.isArray(L[1]))return L;throw Error("coord must be GeoJSON Point or an Array of numbers")}function fp(L){if(Array.isArray(L))return L;if(L.type==="Feature"){if(L.geometry!==null)return L.geometry.coordinates}else if(L.coordinates)return L.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Vh(L){return L.type==="Feature"?L.geometry:L}function Nu(L,i){return L.type==="FeatureCollection"?"FeatureCollection":L.type==="GeometryCollection"?"GeometryCollection":L.type==="Feature"&&L.geometry!==null?L.geometry.type:L.type}function Wf(L,i,s,l,p){Sf(L,i,s||0,l||L.length-1,p||rl)}function Sf(L,i,s,l,p){for(;l>s;){if(l-s>600){var S=l-s+1,A=i-s+1,I=Math.log(S),U=.5*Math.exp(2*I/3),q=.5*Math.sqrt(I*U*(S-U)/S)*(0>A-S/2?-1:1);Sf(L,i,Math.max(s,Math.floor(i-A*U/S+q)),Math.min(l,Math.floor(i+(S-A)*U/S+q)),p)}var re=L[i],de=s,we=l;for(ko(L,s,i),p(L[l],re)>0&&ko(L,s,l);we>de;){for(ko(L,de,we),de++,we--;0>p(L[de],re);)de++;for(;p(L[we],re)>0;)we--}p(L[s],re)===0?ko(L,s,we):ko(L,++we,l),we>i||(s=we+1),i>we||(l=we-1)}}function ko(L,i,s){var l=L[i];L[i]=L[s],L[s]=l}function rl(L,i){return i>L?-1:L>i?1:0}function pp(L,i,s){if(!s)return i.indexOf(L);for(let l=0;i.length>l;l++)if(s(L,i[l]))return l;return-1}function jo(L,i){hc(L,0,L.children.length,i,L)}function hc(L,i,s,l,p){p||(p=Ph(null)),p.minX=1/0,p.minY=1/0,p.maxX=-1/0,p.maxY=-1/0;for(let S=i;s>S;S++){const A=L.children[S];_u(p,L.leaf?l(A):A)}return p}function _u(L,i){return L.minX=Math.min(L.minX,i.minX),L.minY=Math.min(L.minY,i.minY),L.maxX=Math.max(L.maxX,i.maxX),L.maxY=Math.max(L.maxY,i.maxY),L}function mu(L,i){return L.minX-i.minX}function Mh(L,i){return L.minY-i.minY}function ud(L){return(L.maxX-L.minX)*(L.maxY-L.minY)}function of(L){return L.maxX-L.minX+(L.maxY-L.minY)}function Eu(L,i){const s=Math.max(L.minX,i.minX),l=Math.max(L.minY,i.minY),p=Math.min(L.maxX,i.maxX),S=Math.min(L.maxY,i.maxY);return Math.max(0,p-s)*Math.max(0,S-l)}function dp(L,i){return!(L.minX>i.minX||L.minY>i.minY||i.maxX>L.maxX||i.maxY>L.maxY)}function Wp(L,i){return!(i.minX>L.maxX||i.minY>L.maxY||L.minX>i.maxX||L.minY>i.maxY)}function Ph(L){return{children:L,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wd(L,i,s,l,p){const S=[i,s];for(;S.length;){if(l>=(s=S.pop())-(i=S.pop()))continue;const A=i+Math.ceil((s-i)/l/2)*l;Wf(L,A,i,s,p),S.push(i,A,A,s)}}var Xp=Object.freeze({__proto__:null,default:class{constructor(L=9){this._maxEntries=Math.max(4,L),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(L){let i=this.data;const s=[];if(!Wp(L,i))return s;const l=this.toBBox,p=[];for(;i;){for(let S=0;i.children.length>S;S++){const A=i.children[S],I=i.leaf?l(A):A;Wp(L,I)&&(i.leaf?s.push(A):dp(L,I)?this._all(A,s):p.push(A))}i=p.pop()}return s}collides(L){let i=this.data;if(!Wp(L,i))return!1;const s=[];for(;i;){for(let l=0;i.children.length>l;l++){const p=i.children[l],S=i.leaf?this.toBBox(p):p;if(Wp(L,S)){if(i.leaf||dp(L,S))return!0;s.push(p)}}i=s.pop()}return!1}load(L){if(!L||!L.length)return this;if(this._minEntries>L.length){for(let s=0;L.length>s;s++)this.insert(L[s]);return this}let i=this._build(L.slice(),0,L.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(i.height>this.data.height){const s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(L){return L&&this._insert(L,this.data.height-1),this}clear(){return this.data=Ph([]),this}remove(L,i){if(!L)return this;let s=this.data;const l=this.toBBox(L),p=[],S=[];let A,I,U;for(;s||p.length;){if(s||(s=p.pop(),I=p[p.length-1],A=S.pop(),U=!0),s.leaf){const q=pp(L,s.children,i);if(q!==-1)return s.children.splice(q,1),p.push(s),this._condense(p),this}U||s.leaf||!dp(s,l)?I?(A++,s=I.children[A],U=!1):s=null:(p.push(s),S.push(A),A=0,I=s,s=s.children[0])}return this}toBBox(L){return L}compareMinX(L,i){return L.minX-i.minX}compareMinY(L,i){return L.minY-i.minY}toJSON(){return this.data}fromJSON(L){return this.data=L,this}_all(L,i){const s=[];for(;L;)L.leaf?i.push(...L.children):s.push(...L.children),L=s.pop();return i}_build(L,i,s,l){const p=s-i+1;let S,A=this._maxEntries;if(A>=p)return S=Ph(L.slice(i,s+1)),jo(S,this.toBBox),S;l||(A=Math.ceil(p/Math.pow(A,(l=Math.ceil(Math.log(p)/Math.log(A)))-1))),S=Ph([]),S.leaf=!1,S.height=l;const I=Math.ceil(p/A),U=I*Math.ceil(Math.sqrt(A));wd(L,i,s,U,this.compareMinX);for(let q=i;s>=q;q+=U){const re=Math.min(q+U-1,s);wd(L,q,re,I,this.compareMinY);for(let de=q;re>=de;de+=I)S.children.push(this._build(L,de,Math.min(de+I-1,re),l-1))}return jo(S,this.toBBox),S}_chooseSubtree(L,i,s,l){for(;l.push(i),!i.leaf&&l.length-1!==s;){let A,I=1/0,U=1/0;for(let q=0;i.children.length>q;q++){const re=i.children[q],de=ud(re),we=(Math.max((S=re).maxX,(p=L).maxX)-Math.min(S.minX,p.minX))*(Math.max(S.maxY,p.maxY)-Math.min(S.minY,p.minY))-de;U>we?(U=we,I=I>de?de:I,A=re):we===U&&I>de&&(I=de,A=re)}i=A||i.children[0]}var p,S;return i}_insert(L,i,s){const l=s?L:this.toBBox(L),p=[],S=this._chooseSubtree(l,this.data,i,p);for(S.children.push(L),_u(S,l);i>=0&&p[i].children.length>this._maxEntries;)this._split(p,i),i--;this._adjustParentBBoxes(l,p,i)}_split(L,i){const s=L[i],l=s.children.length,p=this._minEntries;this._chooseSplitAxis(s,p,l);const S=this._chooseSplitIndex(s,p,l),A=Ph(s.children.splice(S,s.children.length-S));A.height=s.height,A.leaf=s.leaf,jo(s,this.toBBox),jo(A,this.toBBox),i?L[i-1].children.push(A):this._splitRoot(s,A)}_splitRoot(L,i){this.data=Ph([L,i]),this.data.height=L.height+1,this.data.leaf=!1,jo(this.data,this.toBBox)}_chooseSplitIndex(L,i,s){let l,p=1/0,S=1/0;for(let A=i;s-i>=A;A++){const I=hc(L,0,A,this.toBBox),U=hc(L,A,s,this.toBBox),q=Eu(I,U),re=ud(I)+ud(U);p>q?(p=q,l=A,S=S>re?re:S):q===p&&S>re&&(S=re,l=A)}return l||s-i}_chooseSplitAxis(L,i,s){const l=L.leaf?this.compareMinX:mu,p=L.leaf?this.compareMinY:Mh,S=this._allDistMargin(L,i,s,l);this._allDistMargin(L,i,s,p)>S&&L.children.sort(l)}_allDistMargin(L,i,s,l){L.children.sort(l);const p=this.toBBox,S=hc(L,0,i,p),A=hc(L,s-i,s,p);let I=of(S)+of(A);for(let U=i;s-i>U;U++){const q=L.children[U];_u(S,L.leaf?p(q):q),I+=of(S)}for(let U=s-i-1;U>=i;U--){const q=L.children[U];_u(A,L.leaf?p(q):q),I+=of(A)}return I}_adjustParentBBoxes(L,i,s){for(let l=s;l>=0;l--)_u(i[l],L)}_condense(L){for(let i,s=L.length-1;s>=0;s--)L[s].children.length===0?s>0?(i=L[s-1].children,i.splice(i.indexOf(L[s]),1)):this.clear():jo(L[s],this.toBBox)}}});function vp(L,i){return i>L?-1:L>i?1:0}var Ga=Object.freeze({__proto__:null,default:class{constructor(L=[],i=vp){if(this.data=L,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(L){this.data.push(L),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const L=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),L}peek(){return this.data[0]}_up(L){const{data:i,compare:s}=this,l=i[L];for(;L>0;){const p=L-1>>1,S=i[p];if(s(l,S)>=0)break;i[L]=S,L=p}i[L]=l}_down(L){const{data:i,compare:s}=this,l=this.length>>1,p=i[L];for(;l>L;){let S=1+(L<<1),A=i[S];const I=S+1;if(this.length>I&&0>s(i[I],A)&&(S=I,A=i[I]),s(A,p)>=0)break;i[L]=A,L=S}i[L]=p}}}),mp=function(L,i,s,l){var p=L[0],S=L[1],A=!1;s===void 0&&(s=0),l===void 0&&(l=i.length);for(var I=(l-s)/2,U=0,q=I-1;I>U;q=U++){var re=i[s+2*U+0],de=i[s+2*U+1],we=i[s+2*q+1];de>S!=we>S&&(i[s+2*q+0]-re)*(S-de)/(we-de)+re>p&&(A=!A)}return A},Hc=function(L,i,s,l){var p=L[0],S=L[1],A=!1;s===void 0&&(s=0),l===void 0&&(l=i.length);for(var I=l-s,U=0,q=I-1;I>U;q=U++){var re=i[U+s][0],de=i[U+s][1],we=i[q+s][1];de>S!=we>S&&(i[q+s][0]-re)*(S-de)/(we-de)+re>p&&(A=!A)}return A},gp=function(L,i,s,l){return i.length>0&&Array.isArray(i[0])?Hc(L,i,s,l):mp(L,i,s,l)},sf=mp;gp.nested=Hc,gp.flat=sf;var ah=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof G.g!="undefined"?G.g:typeof self!="undefined"?self:{};function wo(L,i,s){return L(s={path:i,exports:{},require:function(l,p){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},s.exports),s.exports}function fl(L){if(L.__esModule)return L;var i=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(L).forEach(function(s){var l=Object.getOwnPropertyDescriptor(L,s);Object.defineProperty(i,s,l.get?l:{enumerable:!0,get:function(){return L[s]}})}),i}var pl=wo(function(L,i){(function(s){const p=33306690738754706e-32;function S(it,tt,ct,ut,Je){let Pt,Xt,pr,Ur,tn=tt[0],An=ut[0],xi=0,On=0;An>tn==An>-tn?(Pt=tn,tn=tt[++xi]):(Pt=An,An=ut[++On]);let si=0;if(it>xi&&ct>On)for(An>tn==An>-tn?(pr=Pt-((Xt=tn+Pt)-tn),tn=tt[++xi]):(pr=Pt-((Xt=An+Pt)-An),An=ut[++On]),Pt=Xt,pr!==0&&(Je[si++]=pr);it>xi&&ct>On;)An>tn==An>-tn?(pr=Pt-((Xt=Pt+tn)-(Ur=Xt-Pt))+(tn-Ur),tn=tt[++xi]):(pr=Pt-((Xt=Pt+An)-(Ur=Xt-Pt))+(An-Ur),An=ut[++On]),Pt=Xt,pr!==0&&(Je[si++]=pr);for(;it>xi;)pr=Pt-((Xt=Pt+tn)-(Ur=Xt-Pt))+(tn-Ur),tn=tt[++xi],Pt=Xt,pr!==0&&(Je[si++]=pr);for(;ct>On;)pr=Pt-((Xt=Pt+An)-(Ur=Xt-Pt))+(An-Ur),An=ut[++On],Pt=Xt,pr!==0&&(Je[si++]=pr);return Pt===0&&si!==0||(Je[si++]=Pt),si}function A(it){return new Float64Array(it)}const I=33306690738754716e-32,U=22204460492503146e-32,q=11093356479670487e-47,re=A(4),de=A(8),we=A(12),Oe=A(16),Ge=A(4);s.orient2d=function(it,tt,ct,ut,Je,Pt){const Xt=(tt-Pt)*(ct-Je),pr=(it-Je)*(ut-Pt),Ur=Xt-pr;if(Xt===0||pr===0||Xt>0!=pr>0)return Ur;const tn=Math.abs(Xt+pr);return I*tn>Math.abs(Ur)?-function(An,xi,On,si,kn,ci,wi){let $n,Si,Kn,la,yn,Ti,Aa,$o,lo,Oo,So,cs,Wo,Bo,Xo,Au,Wi,hs;const Ba=An-kn,bs=On-kn,ms=xi-ci,Eo=si-ci;yn=(Xo=($o=Ba-(Aa=(Ti=134217729*Ba)-(Ti-Ba)))*(Oo=Eo-(lo=(Ti=134217729*Eo)-(Ti-Eo)))-((Bo=Ba*Eo)-Aa*lo-$o*lo-Aa*Oo))-(So=Xo-(Wi=($o=ms-(Aa=(Ti=134217729*ms)-(Ti-ms)))*(Oo=bs-(lo=(Ti=134217729*bs)-(Ti-bs)))-((Au=ms*bs)-Aa*lo-$o*lo-Aa*Oo))),re[0]=Xo-(So+yn)+(yn-Wi),yn=(Wo=Bo-((cs=Bo+So)-(yn=cs-Bo))+(So-yn))-(So=Wo-Au),re[1]=Wo-(So+yn)+(yn-Au),yn=(hs=cs+So)-cs,re[2]=cs-(hs-yn)+(So-yn),re[3]=hs;let gu=function(Na,v){let c=v[0];for(let b=1;Na>b;b++)c+=v[b];return c}(4,re),fs=U*wi;if(gu>=fs||-gu>=fs||($n=An-(Ba+(yn=An-Ba))+(yn-kn),Kn=On-(bs+(yn=On-bs))+(yn-kn),Si=xi-(ms+(yn=xi-ms))+(yn-ci),la=si-(Eo+(yn=si-Eo))+(yn-ci),$n===0&&Si===0&&Kn===0&&la===0)||(fs=q*wi+p*Math.abs(gu),(gu+=Ba*la+Eo*$n-(ms*Kn+bs*Si))>=fs||-gu>=fs))return gu;yn=(Xo=($o=$n-(Aa=(Ti=134217729*$n)-(Ti-$n)))*(Oo=Eo-(lo=(Ti=134217729*Eo)-(Ti-Eo)))-((Bo=$n*Eo)-Aa*lo-$o*lo-Aa*Oo))-(So=Xo-(Wi=($o=Si-(Aa=(Ti=134217729*Si)-(Ti-Si)))*(Oo=bs-(lo=(Ti=134217729*bs)-(Ti-bs)))-((Au=Si*bs)-Aa*lo-$o*lo-Aa*Oo))),Ge[0]=Xo-(So+yn)+(yn-Wi),yn=(Wo=Bo-((cs=Bo+So)-(yn=cs-Bo))+(So-yn))-(So=Wo-Au),Ge[1]=Wo-(So+yn)+(yn-Au),yn=(hs=cs+So)-cs,Ge[2]=cs-(hs-yn)+(So-yn),Ge[3]=hs;const Cn=S(4,re,4,Ge,de);yn=(Xo=($o=Ba-(Aa=(Ti=134217729*Ba)-(Ti-Ba)))*(Oo=la-(lo=(Ti=134217729*la)-(Ti-la)))-((Bo=Ba*la)-Aa*lo-$o*lo-Aa*Oo))-(So=Xo-(Wi=($o=ms-(Aa=(Ti=134217729*ms)-(Ti-ms)))*(Oo=Kn-(lo=(Ti=134217729*Kn)-(Ti-Kn)))-((Au=ms*Kn)-Aa*lo-$o*lo-Aa*Oo))),Ge[0]=Xo-(So+yn)+(yn-Wi),yn=(Wo=Bo-((cs=Bo+So)-(yn=cs-Bo))+(So-yn))-(So=Wo-Au),Ge[1]=Wo-(So+yn)+(yn-Au),yn=(hs=cs+So)-cs,Ge[2]=cs-(hs-yn)+(So-yn),Ge[3]=hs;const Ma=S(Cn,de,4,Ge,we);yn=(Xo=($o=$n-(Aa=(Ti=134217729*$n)-(Ti-$n)))*(Oo=la-(lo=(Ti=134217729*la)-(Ti-la)))-((Bo=$n*la)-Aa*lo-$o*lo-Aa*Oo))-(So=Xo-(Wi=($o=Si-(Aa=(Ti=134217729*Si)-(Ti-Si)))*(Oo=Kn-(lo=(Ti=134217729*Kn)-(Ti-Kn)))-((Au=Si*Kn)-Aa*lo-$o*lo-Aa*Oo))),Ge[0]=Xo-(So+yn)+(yn-Wi),yn=(Wo=Bo-((cs=Bo+So)-(yn=cs-Bo))+(So-yn))-(So=Wo-Au),Ge[1]=Wo-(So+yn)+(yn-Au),yn=(hs=cs+So)-cs,Ge[2]=cs-(hs-yn)+(So-yn),Ge[3]=hs;const go=S(Ma,we,4,Ge,Oe);return Oe[go-1]}(it,tt,ct,ut,Je,Pt,tn):Ur},s.orient2dfast=function(it,tt,ct,ut,Je,Pt){return(tt-Pt)*(ct-Je)-(it-Je)*(ut-Pt)},Object.defineProperty(s,"__esModule",{value:!0})})(i)}),bh=fl(Xp),Xf=fl(Ga),yp=pl.orient2d;Xf.default&&(Xf=Xf.default);var Gh=Vu;function Vu(L,i,s){i=Math.max(0,i===void 0?2:i),s=s||0;var l=function(ut){for(var Je=ut[0],Pt=ut[0],Xt=ut[0],pr=ut[0],Ur=0;ut.length>Ur;Ur++){var tn=ut[Ur];Je[0]>tn[0]&&(Je=tn),tn[0]>Xt[0]&&(Xt=tn),Pt[1]>tn[1]&&(Pt=tn),tn[1]>pr[1]&&(pr=tn)}var An=[Je,Pt,Xt,pr],xi=An.slice();for(Ur=0;ut.length>Ur;Ur++)gp(ut[Ur],An)||xi.push(ut[Ur]);return function(On){On.sort(xp);for(var si=[],kn=0;On.length>kn;kn++){for(;si.length>=2&&0>=Xs(si[si.length-2],si[si.length-1],On[kn]);)si.pop();si.push(On[kn])}for(var ci=[],wi=On.length-1;wi>=0;wi--){for(;ci.length>=2&&0>=Xs(ci[ci.length-2],ci[ci.length-1],On[wi]);)ci.pop();ci.push(On[wi])}return ci.pop(),si.pop(),si.concat(ci)}(xi)}(L),p=new bh(16);p.toBBox=function(ut){return{minX:ut[0],minY:ut[1],maxX:ut[0],maxY:ut[1]}},p.compareMinX=function(ut,Je){return ut[0]-Je[0]},p.compareMinY=function(ut,Je){return ut[1]-Je[1]},p.load(L);for(var S,A=[],I=0;l.length>I;I++){var U=l[I];p.remove(U),S=_p(U,S),A.push(S)}var q=new bh(16);for(I=0;A.length>I;I++)q.insert(qf(A[I]));for(var re=i*i,de=s*s;A.length;){var we=A.shift(),Oe=we.p,Ge=we.next.p,it=bp(Oe,Ge);if(it>=de){var tt=it/re;(U=Yf(p,we.prev.p,Oe,Ge,we.next.next.p,tt,q))&&Math.min(bp(U,Oe),bp(U,Ge))<=tt&&(A.push(we),A.push(_p(U,we)),p.remove(U),q.remove(we),q.insert(qf(we)),q.insert(qf(we.next)))}}we=S;var ct=[];do ct.push(we.p),we=we.next;while(we!==S);return ct.push(we.p),ct}function Yf(L,i,s,l,p,S,A){for(var I=new Xf([],Ll),U=L.data;U;){for(var q=0;U.children.length>q;q++){var re=U.children[q],de=U.leaf?Yp(re,s,l):uf(s,l,re);S<de||I.push({node:re,dist:de})}for(;I.length&&!I.peek().node.children;){var we=I.pop(),Oe=we.node,Ge=Yp(Oe,i,s),it=Yp(Oe,l,p);if(Ge>we.dist&&it>we.dist&&kh(s,Oe,A)&&kh(l,Oe,A))return Oe}(U=I.pop())&&(U=U.node)}return null}function Ll(L,i){return L.dist-i.dist}function uf(L,i,s){if(Pp(L,s)||Pp(i,s))return 0;var l=kp(L[0],L[1],i[0],i[1],s.minX,s.minY,s.maxX,s.minY);if(l===0)return 0;var p=kp(L[0],L[1],i[0],i[1],s.minX,s.minY,s.minX,s.maxY);if(p===0)return 0;var S=kp(L[0],L[1],i[0],i[1],s.maxX,s.minY,s.maxX,s.maxY);if(S===0)return 0;var A=kp(L[0],L[1],i[0],i[1],s.minX,s.maxY,s.maxX,s.maxY);return A===0?0:Math.min(l,p,S,A)}function Pp(L,i){return!(i.minX>L[0]||L[0]>i.maxX||i.minY>L[1]||L[1]>i.maxY)}function kh(L,i,s){for(var l,p,S,A,I=s.search({minX:Math.min(L[0],i[0]),minY:Math.min(L[1],i[1]),maxX:Math.max(L[0],i[0]),maxY:Math.max(L[1],i[1])}),U=0;I.length>U;U++)if(p=I[U].next.p,S=L,(l=I[U].p)!==(A=i)&&p!==S&&Xs(l,p,S)>0!=Xs(l,p,A)>0&&Xs(S,A,l)>0!=Xs(S,A,p)>0)return!1;return!0}function Xs(L,i,s){return yp(L[0],L[1],i[0],i[1],s[0],s[1])}function qf(L){var i=L.p,s=L.next.p;return L.minX=Math.min(i[0],s[0]),L.minY=Math.min(i[1],s[1]),L.maxX=Math.max(i[0],s[0]),L.maxY=Math.max(i[1],s[1]),L}function _p(L,i){var s={p:L,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function bp(L,i){var s=L[0]-i[0],l=L[1]-i[1];return s*s+l*l}function Yp(L,i,s){var l=i[0],p=i[1],S=s[0]-l,A=s[1]-p;if(S!==0||A!==0){var I=((L[0]-l)*S+(L[1]-p)*A)/(S*S+A*A);I>1?(l=s[0],p=s[1]):I>0&&(l+=S*I,p+=A*I)}return(S=L[0]-l)*S+(A=L[1]-p)*A}function kp(L,i,s,l,p,S,A,I){var U,q,re,de,we=s-L,Oe=l-i,Ge=A-p,it=I-S,tt=L-p,ct=i-S,ut=we*we+Oe*Oe,Je=we*Ge+Oe*it,Pt=Ge*Ge+it*it,Xt=we*tt+Oe*ct,pr=Ge*tt+it*ct,Ur=ut*Pt-Je*Je,tn=Ur,An=Ur;Ur===0?(q=0,tn=1,de=pr,An=Pt):(de=ut*pr-Je*Xt,0>(q=Je*pr-Pt*Xt)?(q=0,de=pr,An=Pt):q>tn&&(q=tn,de=pr+Je,An=Pt)),0>de?(de=0,0>-Xt?q=0:-Xt>ut?q=tn:(q=-Xt,tn=ut)):de>An&&(de=An,0>-Xt+Je?q=0:-Xt+Je>ut?q=tn:(q=-Xt+Je,tn=ut));var xi=(1-(re=de===0?0:de/An))*p+re*A-((1-(U=q===0?0:q/tn))*L+U*s),On=(1-re)*S+re*I-((1-U)*i+U*l);return xi*xi+On*On}function xp(L,i){return L[0]===i[0]?L[1]-i[1]:L[0]-i[0]}function Kl(L,i,s){s===void 0&&(s={});var l=ih(L),p=ih(i),S=Gc(p[1]-l[1]),A=Gc(p[0]-l[0]),I=Gc(l[1]),U=Gc(p[1]),q=Math.pow(Math.sin(S/2),2)+Math.pow(Math.sin(A/2),2)*Math.cos(I)*Math.cos(U);return gi(2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q)),s.units)}function $c(L){return function(i,s){s===void 0&&(s={});var l=Number(i[0]),p=Number(i[1]),S=Number(i[2]),A=Number(i[3]);if(i.length===6)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");var I=[l,p];return yh([[I,[S,p],[S,A],[l,A],I]],s.properties,{bbox:i,id:s.id})}(af(L))}function Rl(L,i,s,l){l===void 0&&(l={});var p=ih(L),S=Gc(p[0]),A=Gc(p[1]),I=Gc(s),U=Hp(i,l.units),q=Math.asin(Math.sin(A)*Math.cos(U)+Math.cos(A)*Math.sin(U)*Math.cos(I));return Vs([nf(S+Math.atan2(Math.sin(I)*Math.sin(U)*Math.cos(A),Math.cos(U)-Math.sin(A)*Math.sin(q))),nf(q)],l.properties)}function Ms(L,i,s){if(s===void 0&&(s={}),s.final===!0)return function(q,re){var de=Ms(re,q);return de=(de+180)%360}(L,i);var l=ih(L),p=ih(i),S=Gc(l[0]),A=Gc(p[0]),I=Gc(l[1]),U=Gc(p[1]);return nf(Math.atan2(Math.sin(A-S)*Math.cos(U),Math.cos(I)*Math.sin(U)-Math.sin(I)*Math.cos(U)*Math.cos(A-S)))}function Hh(L,i){i===void 0&&(i={});var s=af(L);return Vs([(s[0]+s[2])/2,(s[1]+s[3])/2],i.properties,i)}function lf(L,i){i===void 0&&(i={});var s=0,l=0,p=0;return rh(L,function(S){s+=S[0],l+=S[1],p++},!0),Vs([s/p,l/p],i.properties)}function Ef(L,i){switch(i===void 0&&(i={}),Nu(L)){case"Point":return Vs(ih(L),i.properties);case"Polygon":var s=[];rh(L,function(Je){s.push(Je)});var l,p,S,A,I,U,q,re,de=lf(L,{properties:i.properties}),we=de.geometry.coordinates,Oe=0,Ge=0,it=0,tt=s.map(function(Je){return[Je[0]-we[0],Je[1]-we[1]]});for(l=0;s.length-1>l;l++)it+=re=(A=(p=tt[l])[0])*(q=(S=tt[l+1])[1])-(I=S[0])*(U=p[1]),Oe+=(A+I)*re,Ge+=(U+q)*re;if(it===0)return de;var ct=1/(6*(.5*it));return Vs([we[0]+ct*Oe,we[1]+ct*Ge],i.properties);default:var ut=function(Je,Pt){Pt===void 0&&(Pt={}),Pt.concavity=Pt.concavity||1/0;var Xt=[];if(rh(Je,function(Ur){Xt.push([Ur[0],Ur[1]])}),!Xt.length)return null;var pr=Gh(Xt,Pt.concavity);return pr.length>3?yh([pr]):null}(L);return ut?Ef(ut,{properties:i.properties}):lf(L,{properties:i.properties})}}function vs(L){if(!L)throw Error("geojson is required");var i=[];return _h(L,function(s){(function(l,p){var S=[],A=l.geometry;if(A!==null){switch(A.type){case"Polygon":S=fp(A);break;case"LineString":S=[fp(A)]}S.forEach(function(I){var U=function(q,re){var de=[];return q.reduce(function(we,Oe){var Ge,it,tt,ct,ut,Je,Pt=tl([we,Oe],re);return Pt.bbox=[(ut=(it=Oe)[0])>(tt=(Ge=we)[0])?tt:ut,(Je=it[1])>(ct=Ge[1])?ct:Je,tt>ut?tt:ut,ct>Je?ct:Je],de.push(Pt),Oe}),de}(I,l.properties);U.forEach(function(q){q.id=p.length,p.push(q)})})}})(s,i)}),vu(i)}Gh.default=Vu;function Ns(L,i,s){if(!s)return i.indexOf(L);for(let l=0;i.length>l;l++)if(s(L,i[l]))return l;return-1}function bc(L,i){fc(L,0,L.children.length,i,L)}function fc(L,i,s,l,p){p||(p=nl(null)),p.minX=1/0,p.minY=1/0,p.maxX=-1/0,p.maxY=-1/0;for(let S=i;s>S;S++){const A=L.children[S];xc(p,L.leaf?l(A):A)}return p}function xc(L,i){return L.minX=Math.min(L.minX,i.minX),L.minY=Math.min(L.minY,i.minY),L.maxX=Math.max(L.maxX,i.maxX),L.maxY=Math.max(L.maxY,i.maxY),L}function Pe(L,i){return L.minX-i.minX}function Ih(L,i){return L.minY-i.minY}function cf(L){return(L.maxX-L.minX)*(L.maxY-L.minY)}function Cf(L){return L.maxX-L.minX+(L.maxY-L.minY)}function Af(L,i){const s=Math.max(L.minX,i.minX),l=Math.max(L.minY,i.minY),p=Math.min(L.maxX,i.maxX),S=Math.min(L.maxY,i.maxY);return Math.max(0,p-s)*Math.max(0,S-l)}function Lh(L,i){return!(L.minX>i.minX||L.minY>i.minY||i.maxX>L.maxX||i.maxY>L.maxY)}function Cu(L,i){return!(i.minX>L.maxX||i.minY>L.maxY||L.minX>i.maxX||L.minY>i.maxY)}function nl(L){return{children:L,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Wc(L,i,s,l,p){const S=[i,s];for(;S.length;){if(l>=(s=S.pop())-(i=S.pop()))continue;const A=i+Math.ceil((s-i)/l/2)*l;Wf(L,A,i,s,p),S.push(i,A,A,s)}}var zi=Object.freeze({__proto__:null,default:class{constructor(L=9){this._maxEntries=Math.max(4,L),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(L){let i=this.data;const s=[];if(!Cu(L,i))return s;const l=this.toBBox,p=[];for(;i;){for(let S=0;i.children.length>S;S++){const A=i.children[S],I=i.leaf?l(A):A;Cu(L,I)&&(i.leaf?s.push(A):Lh(L,I)?this._all(A,s):p.push(A))}i=p.pop()}return s}collides(L){let i=this.data;if(!Cu(L,i))return!1;const s=[];for(;i;){for(let l=0;i.children.length>l;l++){const p=i.children[l],S=i.leaf?this.toBBox(p):p;if(Cu(L,S)){if(i.leaf||Lh(L,S))return!0;s.push(p)}}i=s.pop()}return!1}load(L){if(!L||!L.length)return this;if(this._minEntries>L.length){for(let s=0;L.length>s;s++)this.insert(L[s]);return this}let i=this._build(L.slice(),0,L.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(i.height>this.data.height){const s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(L){return L&&this._insert(L,this.data.height-1),this}clear(){return this.data=nl([]),this}remove(L,i){if(!L)return this;let s=this.data;const l=this.toBBox(L),p=[],S=[];let A,I,U;for(;s||p.length;){if(s||(s=p.pop(),I=p[p.length-1],A=S.pop(),U=!0),s.leaf){const q=Ns(L,s.children,i);if(q!==-1)return s.children.splice(q,1),p.push(s),this._condense(p),this}U||s.leaf||!Lh(s,l)?I?(A++,s=I.children[A],U=!1):s=null:(p.push(s),S.push(A),A=0,I=s,s=s.children[0])}return this}toBBox(L){return L}compareMinX(L,i){return L.minX-i.minX}compareMinY(L,i){return L.minY-i.minY}toJSON(){return this.data}fromJSON(L){return this.data=L,this}_all(L,i){const s=[];for(;L;)L.leaf?i.push(...L.children):s.push(...L.children),L=s.pop();return i}_build(L,i,s,l){const p=s-i+1;let S,A=this._maxEntries;if(A>=p)return S=nl(L.slice(i,s+1)),bc(S,this.toBBox),S;l||(A=Math.ceil(p/Math.pow(A,(l=Math.ceil(Math.log(p)/Math.log(A)))-1))),S=nl([]),S.leaf=!1,S.height=l;const I=Math.ceil(p/A),U=I*Math.ceil(Math.sqrt(A));Wc(L,i,s,U,this.compareMinX);for(let q=i;s>=q;q+=U){const re=Math.min(q+U-1,s);Wc(L,q,re,I,this.compareMinY);for(let de=q;re>=de;de+=I)S.children.push(this._build(L,de,Math.min(de+I-1,re),l-1))}return bc(S,this.toBBox),S}_chooseSubtree(L,i,s,l){for(;l.push(i),!i.leaf&&l.length-1!==s;){let A,I=1/0,U=1/0;for(let q=0;i.children.length>q;q++){const re=i.children[q],de=cf(re),we=(Math.max((S=re).maxX,(p=L).maxX)-Math.min(S.minX,p.minX))*(Math.max(S.maxY,p.maxY)-Math.min(S.minY,p.minY))-de;U>we?(U=we,I=I>de?de:I,A=re):we===U&&I>de&&(I=de,A=re)}i=A||i.children[0]}var p,S;return i}_insert(L,i,s){const l=s?L:this.toBBox(L),p=[],S=this._chooseSubtree(l,this.data,i,p);for(S.children.push(L),xc(S,l);i>=0&&p[i].children.length>this._maxEntries;)this._split(p,i),i--;this._adjustParentBBoxes(l,p,i)}_split(L,i){const s=L[i],l=s.children.length,p=this._minEntries;this._chooseSplitAxis(s,p,l);const S=this._chooseSplitIndex(s,p,l),A=nl(s.children.splice(S,s.children.length-S));A.height=s.height,A.leaf=s.leaf,bc(s,this.toBBox),bc(A,this.toBBox),i?L[i-1].children.push(A):this._splitRoot(s,A)}_splitRoot(L,i){this.data=nl([L,i]),this.data.height=L.height+1,this.data.leaf=!1,bc(this.data,this.toBBox)}_chooseSplitIndex(L,i,s){let l,p=1/0,S=1/0;for(let A=i;s-i>=A;A++){const I=fc(L,0,A,this.toBBox),U=fc(L,A,s,this.toBBox),q=Af(I,U),re=cf(I)+cf(U);p>q?(p=q,l=A,S=S>re?re:S):q===p&&S>re&&(S=re,l=A)}return l||s-i}_chooseSplitAxis(L,i,s){const l=L.leaf?this.compareMinX:Pe,p=L.leaf?this.compareMinY:Ih,S=this._allDistMargin(L,i,s,l);this._allDistMargin(L,i,s,p)>S&&L.children.sort(l)}_allDistMargin(L,i,s,l){L.children.sort(l);const p=this.toBBox,S=fc(L,0,i,p),A=fc(L,s-i,s,p);let I=Cf(S)+Cf(A);for(let U=i;s-i>U;U++){const q=L.children[U];xc(S,L.leaf?p(q):q),I+=Cf(S)}for(let U=s-i-1;U>=i;U--){const q=L.children[U];xc(A,L.leaf?p(q):q),I+=Cf(A)}return I}_adjustParentBBoxes(L,i,s){for(let l=s;l>=0;l--)xc(i[l],L)}_condense(L){for(let i,s=L.length-1;s>=0;s--)L[s].children.length===0?s>0?(i=L[s-1].children,i.splice(i.indexOf(L[s]),1)):this.clear():bc(L[s],this.toBBox)}}}),Ui=fl(zi),Gu=fl($d),$h=fl(Mu),Wh=fl(hp).default,ji=$h.featureEach,Ic=Gu.featureCollection;function hf(L){var i=new Ui(L);return i.insert=function(s){if(s.type!=="Feature")throw Error("invalid feature");return s.bbox=s.bbox?s.bbox:Wh(s),Ui.prototype.insert.call(this,s)},i.load=function(s){var l=[];return Array.isArray(s)?s.forEach(function(p){if(p.type!=="Feature")throw Error("invalid features");p.bbox=p.bbox?p.bbox:Wh(p),l.push(p)}):ji(s,function(p){if(p.type!=="Feature")throw Error("invalid features");p.bbox=p.bbox?p.bbox:Wh(p),l.push(p)}),Ui.prototype.load.call(this,l)},i.remove=function(s,l){if(s.type!=="Feature")throw Error("invalid feature");return s.bbox=s.bbox?s.bbox:Wh(s),Ui.prototype.remove.call(this,s,l)},i.clear=function(){return Ui.prototype.clear.call(this)},i.search=function(s){var l=Ui.prototype.search.call(this,this.toBBox(s));return Ic(l)},i.collides=function(s){return Ui.prototype.collides.call(this,this.toBBox(s))},i.all=function(){var s=Ui.prototype.all.call(this);return Ic(s)},i.toJSON=function(){return Ui.prototype.toJSON.call(this)},i.fromJSON=function(s){return Ui.prototype.fromJSON.call(this,s)},i.toBBox=function(s){var l;if(s.bbox)l=s.bbox;else if(Array.isArray(s)&&s.length===4)l=s;else if(Array.isArray(s)&&s.length===6)l=[s[0],s[1],s[3],s[4]];else if(s.type==="Feature")l=Wh(s);else{if(s.type!=="FeatureCollection")throw Error("invalid geojson");l=Wh(s)}return{minX:l[0],minY:l[1],maxX:l[2],maxY:l[3]}},i}var Gn=hf;function ld(L,i){var s={},l=[];if(L.type==="LineString"&&(L=Yu(L)),i.type==="LineString"&&(i=Yu(i)),L.type==="Feature"&&i.type==="Feature"&&L.geometry!==null&&i.geometry!==null&&L.geometry.type==="LineString"&&i.geometry.type==="LineString"&&L.geometry.coordinates.length===2&&i.geometry.coordinates.length===2){var p=xh(L,i);return p&&l.push(p),vu(l)}var S=Gn();return S.load(vs(i)),lp(vs(L),function(A){lp(S.search(A),function(I){var U=xh(A,I);if(U){var q=fp(U).join(",");s[q]||(s[q]=!0,l.push(U))}})}),vu(l)}function xh(L,i){var s=fp(L),l=fp(i);if(s.length!==2)throw Error("<intersects> line1 must only contain 2 coordinates");if(l.length!==2)throw Error("<intersects> line2 must only contain 2 coordinates");var p=s[0][0],S=s[0][1],A=s[1][0],I=s[1][1],U=l[0][0],q=l[0][1],re=l[1][0],de=l[1][1],we=(de-q)*(A-p)-(re-U)*(I-S),Oe=(re-U)*(S-q)-(de-q)*(p-U),Ge=(A-p)*(S-q)-(I-S)*(p-U);if(we===0)return null;var it=Oe/we,tt=Ge/we;return 0>it||it>1||0>tt||tt>1?null:Vs([p+it*(A-p),S+it*(I-S)])}Gn.default=hf;var Xh=6378137;function wh(L){return Th(L,function(i,s){return i+function(l){var p,S=0;switch(l.type){case"Polygon":return oh(l.coordinates);case"MultiPolygon":for(p=0;l.coordinates.length>p;p++)S+=oh(l.coordinates[p]);return S;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(s)},0)}function oh(L){var i=0;if(L&&L.length>0){i+=Math.abs(ff(L[0]));for(var s=1;L.length>s;s++)i-=Math.abs(ff(L[s]))}return i}function ff(L){var i,s,l,p,S,A,I=0,U=L.length;if(U>2){for(A=0;U>A;A++)A===U-2?(l=U-2,p=U-1,S=0):A===U-1?(l=U-1,p=0,S=1):(l=A,p=A+1,S=A+2),i=L[l],s=L[p],I+=(Tf(L[S][0])-Tf(i[0]))*Math.sin(Tf(s[1]));I=I*Xh*Xh/2}return I}function Tf(L){return L*Math.PI/180}function Jl(L,i){return i===void 0&&(i={}),$p(L,function(s,l){var p=l.geometry.coordinates;return s+Kl(p[0],p[1],i)},0)}function wc(L,i){i===void 0&&(i={});var s=Vh(L);switch(i.properties||L.type!=="Feature"||(i.properties=L.properties),s.type){case"Polygon":return function(l,p){p===void 0&&(p={});var S=Vh(l),A=S.coordinates,I=p.properties?p.properties:l.type==="Feature"?l.properties:{};return Ql(A,I)}(s,i);case"MultiPolygon":return function(l,p){p===void 0&&(p={});var S=Vh(l),A=S.coordinates,I=p.properties?p.properties:l.type==="Feature"?l.properties:{},U=[];return A.forEach(function(q){U.push(Ql(q,I))}),vu(U)}(s,i);default:throw Error("invalid poly")}}function Ql(L,i){return L.length>1?Ch(L,i):tl(L[0],i)}function Yh(L){for(var i,s,l=fp(L),p=0,S=1;l.length>S;)i=s||l[0],p+=((s=l[S])[0]-i[0])*(s[1]+i[1]),S++;return p>0}var Mf=wo(function(L){var i=Object.prototype.hasOwnProperty,s="~";function l(){}function p(U,q,re){this.fn=U,this.context=q,this.once=re||!1}function S(U,q,re,de,we){if(typeof re!="function")throw new TypeError("The listener must be a function");var Oe=new p(re,de||U,we),Ge=s?s+q:q;return U._events[Ge]?U._events[Ge].fn?U._events[Ge]=[U._events[Ge],Oe]:U._events[Ge].push(Oe):(U._events[Ge]=Oe,U._eventsCount++),U}function A(U,q){--U._eventsCount==0?U._events=new l:delete U._events[q]}function I(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(s=!1)),I.prototype.eventNames=function(){var U,q,re=[];if(this._eventsCount===0)return re;for(q in U=this._events)i.call(U,q)&&re.push(s?q.slice(1):q);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols(U)):re},I.prototype.listeners=function(U){var q=this._events[s?s+U:U];if(!q)return[];if(q.fn)return[q.fn];for(var re=0,de=q.length,we=Array(de);de>re;re++)we[re]=q[re].fn;return we},I.prototype.listenerCount=function(U){var q=this._events[s?s+U:U];return q?q.fn?1:q.length:0},I.prototype.emit=function(U,q,re,de,we,Oe){var Ge=s?s+U:U;if(!this._events[Ge])return!1;var it,tt,ct=this._events[Ge],ut=arguments.length;if(ct.fn){switch(ct.once&&this.removeListener(U,ct.fn,void 0,!0),ut){case 1:return ct.fn.call(ct.context),!0;case 2:return ct.fn.call(ct.context,q),!0;case 3:return ct.fn.call(ct.context,q,re),!0;case 4:return ct.fn.call(ct.context,q,re,de),!0;case 5:return ct.fn.call(ct.context,q,re,de,we),!0;case 6:return ct.fn.call(ct.context,q,re,de,we,Oe),!0}for(tt=1,it=Array(ut-1);ut>tt;tt++)it[tt-1]=arguments[tt];ct.fn.apply(ct.context,it)}else{var Je,Pt=ct.length;for(tt=0;Pt>tt;tt++)switch(ct[tt].once&&this.removeListener(U,ct[tt].fn,void 0,!0),ut){case 1:ct[tt].fn.call(ct[tt].context);break;case 2:ct[tt].fn.call(ct[tt].context,q);break;case 3:ct[tt].fn.call(ct[tt].context,q,re);break;case 4:ct[tt].fn.call(ct[tt].context,q,re,de);break;default:if(!it)for(Je=1,it=Array(ut-1);ut>Je;Je++)it[Je-1]=arguments[Je];ct[tt].fn.apply(ct[tt].context,it)}}return!0},I.prototype.on=function(U,q,re){return S(this,U,q,re,!1)},I.prototype.once=function(U,q,re){return S(this,U,q,re,!0)},I.prototype.removeListener=function(U,q,re,de){var we=s?s+U:U;if(!this._events[we])return this;if(!q)return A(this,we),this;var Oe=this._events[we];if(Oe.fn)Oe.fn!==q||de&&!Oe.once||re&&Oe.context!==re||A(this,we);else{for(var Ge=0,it=[],tt=Oe.length;tt>Ge;Ge++)(Oe[Ge].fn!==q||de&&!Oe[Ge].once||re&&Oe[Ge].context!==re)&&it.push(Oe[Ge]);it.length?this._events[we]=it.length===1?it[0]:it:A(this,we)}return this},I.prototype.removeAllListeners=function(U){var q;return U?this._events[q=s?s+U:U]&&A(this,q):(this._events=new l,this._eventsCount=0),this},I.prototype.off=I.prototype.removeListener,I.prototype.addListener=I.prototype.on,I.prefixed=s,I.EventEmitter=I,L.exports=I}),pf=function(L){ou(s,L);var i=su(s);function s(l,p){var S,A=p.style;return Xa(this,s),(S=i.call(this)).scene=void 0,S.style=void 0,S.layers=void 0,S.data=[],S.scene=l,S.style=A,S.layers=S.initLayers(),S.layers.forEach(function(I){l.addLayer(I)}),A.callback instanceof Function&&A.callback(S.layers),S}return Jo(s,[{key:"getLayers",value:function(){return this.layers}},{key:"show",value:function(){this.layers.forEach(function(l){l.show()})}},{key:"hide",value:function(){this.layers.forEach(function(l){l.hide()})}},{key:"setData",value:function(l){var p=Su(l).sort(function(S,A){return+S.properties.isActive-+A.properties.isActive});this.data=p,this.layers.forEach(function(S){S.setData(vu(p))})}},{key:"destroy",value:function(){var l=this;this.layers.forEach(function(p){l.scene.removeLayer(p)})}}]),s}(Mf.EventEmitter),Lc=function(L){ou(s,L);var i=su(s);function s(){return Xa(this,s),i.apply(this,arguments)}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.style,A=l.options;return[new j.LineLayer(A!=null?A:{}).source(vu([])).size(p.size).color(p.color).shape("line").style(S)]}}]),s}(pf),_l=function(L){var i=typeof L;return L!=null&&(i=="object"||i=="function")},xo=typeof ah=="object"&&ah&&ah.Object===Object&&ah,Dl=typeof self=="object"&&self&&self.Object===Object&&self,Po=xo||Dl||Function("return this")(),dl=function(){return Po.Date.now()},Kf=/\s/,Pf=function(L){for(var i=L.length;i--&&Kf.test(L.charAt(i)););return i},Sc=/^\s+/,Ec=function(L){return L&&L.slice(0,Pf(L)+1).replace(Sc,"")},Al=Po.Symbol,aa=Object.prototype,ta=aa.hasOwnProperty,Da=aa.toString,ba=Al?Al.toStringTag:void 0,bl=function(L){var i=ta.call(L,ba),s=L[ba];try{L[ba]=void 0;var l=!0}catch(S){}var p=Da.call(L);return l&&(i?L[ba]=s:delete L[ba]),p},jl=Object.prototype.toString,df=function(L){return jl.call(L)},Pu=Al?Al.toStringTag:void 0,Rh=function(L){return L==null?L===void 0?"[object Undefined]":"[object Null]":Pu&&Pu in Object(L)?bl(L):df(L)},ho=function(L){return L!=null&&typeof L=="object"},vl=function(L){return typeof L=="symbol"||ho(L)&&Rh(L)=="[object Symbol]"},kf=/^[-+]0x[0-9a-f]+$/i,Zu=/^0b[01]+$/i,il=/^0o[0-7]+$/i,sh=parseInt,ec=function(L){if(typeof L=="number")return L;if(vl(L))return NaN;if(_l(L)){var i=typeof L.valueOf=="function"?L.valueOf():L;L=_l(i)?i+"":i}if(typeof L!="string")return L===0?L:+L;L=Ec(L);var s=Zu.test(L);return s||il.test(L)?sh(L.slice(2),s?2:8):kf.test(L)?NaN:+L},If=Math.max,Rc=Math.min,Cc=function(L,i,s){var l,p,S,A,I,U,q=0,re=!1,de=!1,we=!0;if(typeof L!="function")throw new TypeError("Expected a function");function Oe(ut){var Je=l,Pt=p;return l=p=void 0,q=ut,A=L.apply(Pt,Je)}function Ge(ut){var Je=ut-U;return U===void 0||Je>=i||0>Je||de&&ut-q>=S}function it(){var ut=dl();if(Ge(ut))return tt(ut);I=setTimeout(it,function(Je){var Pt=i-(Je-U);return de?Rc(Pt,S-(Je-q)):Pt}(ut))}function tt(ut){return I=void 0,we&&l?Oe(ut):(l=p=void 0,A)}function ct(){var ut=dl(),Je=Ge(ut);if(l=arguments,p=this,U=ut,Je){if(I===void 0)return function(Pt){return q=Pt,I=setTimeout(it,i),re?Oe(Pt):A}(U);if(de)return clearTimeout(I),I=setTimeout(it,i),Oe(U)}return I===void 0&&(I=setTimeout(it,i)),A}return i=ec(i)||0,_l(s)&&(re=!!s.leading,S=(de="maxWait"in s)?If(ec(s.maxWait)||0,i):S,we="trailing"in s?!!s.trailing:we),ct.cancel=function(){I!==void 0&&clearTimeout(I),q=0,l=U=p=I=void 0},ct.flush=function(){return I===void 0?A:tt(dl())},ct},Lf=function(L){ou(s,L);var i=su(s);function s(){var l;Xa(this,s);for(var p=arguments.length,S=Array(p),A=0;p>A;A++)S[A]=arguments[A];return(l=i.call.apply(i,[this].concat(S))).onMouseMove=function(I){l.emit(K.RenderEvent.Mousemove,I)},l.onMouseOut=function(I){l.emit(K.RenderEvent.Mouseout,I)},l.onMouseDown=function(I){l.emit(K.RenderEvent.Dragstart,I)},l.onDragging=function(I){l.emit(K.RenderEvent.Dragging,I)},l.onDragEnd=Cc(function(I){l.emit(K.RenderEvent.Dragend,I)},0),l.onUnClick=function(I){l.emit(K.RenderEvent.UnClick,I)},l.enableHover=function(){var I,U;l.disableHover(),(I=l.layers[0])===null||I===void 0||I.on(K.LayerEvent.Mousemove,l.onMouseMove),(U=l.layers[0])===null||U===void 0||U.on(K.LayerEvent.Mouseout,l.onMouseOut)},l.disableHover=function(){var I,U;(I=l.layers[0])===null||I===void 0||I.off(K.LayerEvent.Mousemove,l.onMouseMove),(U=l.layers[0])===null||U===void 0||U.off(K.LayerEvent.Mouseout,l.onMouseOut)},l}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.hover,A=l.active,I=l.style,U=l.options;return[new j.LineLayer(U!=null?U:{}).source(vu([])).size("isHover*isActive",function(q,re){return re?A.size:q?S.size:p.size}).color("isHover*isActive",function(q,re){return re?A.color:q?S.color:p.color}).shape("line").style(I)]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(K.SceneEvent.Dragging,this.onDragging),this.scene.on(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(K.SceneEvent.Dragging,this.onDragging),this.scene.off(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(K.LayerEvent.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(K.LayerEvent.UnClick,this.onUnClick)}}]),s}(pf),Dh=function(L){ou(s,L);var i=su(s);function s(){var l;Xa(this,s);for(var p=arguments.length,S=Array(p),A=0;p>A;A++)S[A]=arguments[A];return(l=i.call.apply(i,[this].concat(S))).onMouseMove=function(I){l.emit(K.RenderEvent.Mousemove,I)},l.onMouseOut=function(I){l.emit(K.RenderEvent.Mouseout,I)},l.onMouseDown=function(I){l.emit(K.RenderEvent.Click,I)},l}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.style,A=S===void 0?{}:S,I=l.options,U=p.shape,q=p.size,re=p.color;return[new j.PointLayer(I!=null?I:{}).source(vu([])).size(q).color(re).shape(U).style(A)]}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(K.LayerEvent.Mousedown,this.onMouseDown)}},{key:"disableClick",value:function(){this.layers[0].off(K.LayerEvent.Mousedown,this.onMouseDown)}},{key:"enableHover",value:function(){var l,p;this.disableHover(),(l=this.layers[0])===null||l===void 0||l.on(K.LayerEvent.Mousemove,this.onMouseMove),(p=this.layers[0])===null||p===void 0||p.on(K.LayerEvent.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var l,p;(l=this.layers[0])===null||l===void 0||l.off(K.LayerEvent.Mousemove,this.onMouseMove),(p=this.layers[0])===null||p===void 0||p.off(K.LayerEvent.Mouseout,this.onMouseOut)}}]),s}(pf),wp=function(L){ou(s,L);var i=su(s);function s(){var l;Xa(this,s);for(var p=arguments.length,S=Array(p),A=0;p>A;A++)S[A]=arguments[A];return(l=i.call.apply(i,[this].concat(S))).onCreate=function(I){l.emit(K.RenderEvent.UnClick,I)},l.onMouseMove=function(I){l.emit(K.RenderEvent.Mousemove,I)},l.onMouseOut=function(I){l.emit(K.RenderEvent.Mouseout,I)},l.onMouseDown=function(I){l.emit(K.RenderEvent.Dragstart,I)},l.onDragging=function(I){l.emit(K.RenderEvent.Dragging,I)},l.onDragEnd=Cc(function(I){l.emit(K.RenderEvent.Dragend,I)},0),l.onClick=function(I){l.emit(K.RenderEvent.Click,I)},l.onContextmenu=function(I){l.emit(K.RenderEvent.Contextmenu,I)},l}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.hover,A=l.active,I=l.style,U=I===void 0?{}:I,q=l.options;return[new j.PointLayer(q!=null?q:{}).source(vu([])).size("isHover*isActive",function(re,de){return de?A.size:re?S.size:p.size}).color("isHover*isActive",function(re,de){return de?A.color:re?S.color:p.color}).shape("isHover*isActive",function(re,de){return de?A.shape:re?S.shape:p.shape}).style(U)]}},{key:"enableCreate",value:function(){this.disableCreate(),this.layers[0].on(K.LayerEvent.UnClick,this.onCreate)}},{key:"disableCreate",value:function(){this.layers[0].off(K.LayerEvent.UnClick,this.onCreate)}},{key:"enableHover",value:function(){var l,p;this.disableHover(),(l=this.layers[0])===null||l===void 0||l.on(K.LayerEvent.Mousemove,this.onMouseMove),(p=this.layers[0])===null||p===void 0||p.on(K.LayerEvent.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var l,p;(l=this.layers[0])===null||l===void 0||l.off(K.LayerEvent.Mousemove,this.onMouseMove),(p=this.layers[0])===null||p===void 0||p.off(K.LayerEvent.Mouseout,this.onMouseOut)}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(K.SceneEvent.Dragging,this.onDragging),this.scene.on(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(K.SceneEvent.Dragging,this.onDragging),this.scene.off(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(K.LayerEvent.Click,this.onClick)}},{key:"disableClick",value:function(){this.layers[0].off(K.LayerEvent.Click,this.onClick)}},{key:"enableContextMenu",value:function(){this.disableContextMenu(),this.layers[0].on(K.LayerEvent.Contextmenu,this.onContextmenu)}},{key:"disableContextMenu",value:function(){this.layers[0].off(K.LayerEvent.Contextmenu,this.onContextmenu)}}]),s}(pf),Jf=function(L){ou(s,L);var i=su(s);function s(){var l;Xa(this,s);for(var p=arguments.length,S=Array(p),A=0;p>A;A++)S[A]=arguments[A];return(l=i.call.apply(i,[this].concat(S))).onMouseMove=function(I){l.emit(K.RenderEvent.Mousemove,I)},l.onMouseOut=function(I){l.emit(K.RenderEvent.Mouseout,I)},l.onMouseDown=function(I){l.emit(K.RenderEvent.Dragstart,I)},l.onDragging=function(I){l.emit(K.RenderEvent.Dragging,I)},l.onDragEnd=Cc(function(I){l.emit(K.RenderEvent.Dragend,I)},0),l.onUnClick=function(I){l.emit(K.RenderEvent.UnClick,I)},l.enableHover=function(){var I,U;l.disableHover(),(I=l.layers[0])===null||I===void 0||I.on(K.LayerEvent.Mousemove,l.onMouseMove),(U=l.layers[0])===null||U===void 0||U.on(K.LayerEvent.Mouseout,l.onMouseOut)},l.disableHover=function(){var I,U;(I=l.layers[0])===null||I===void 0||I.off(K.LayerEvent.Mousemove,l.onMouseMove),(U=l.layers[0])===null||U===void 0||U.off(K.LayerEvent.Mouseout,l.onMouseOut)},l}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.hover,A=l.active,I=l.style,U=l.options,q=new j.PolygonLayer(U!=null?U:{});return q.source(vu([])).color("isHover*isActive",function(re,de){return de?A.color:re?S.color:p.color}).style(I),[q]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(K.SceneEvent.Dragging,this.onDragging),this.scene.on(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(K.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(K.SceneEvent.Dragging,this.onDragging),this.scene.off(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(K.LayerEvent.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(K.LayerEvent.UnClick,this.onUnClick)}}]),s}(pf),mr=function(L){ou(s,L);var i=su(s);function s(l){var p;return Xa(this,s),(p=i.call(this)).scene=void 0,p.previousClick=void 0,p.onDblClick=function(S){var A,I,U=(A=(I=S.pixel)!==null&&I!==void 0?I:S.point)!==null&&A!==void 0?A:{},q=U.x,re=q===void 0?0:q,de=U.y,we=de===void 0?0:de,Oe=Date.now();if(p.previousClick){var Ge=p.previousClick,it=Ge.y;300>Oe-Ge.time&&5>Math.abs(re-Ge.x)&&5>Math.abs(we-it)&&p.emit(K.RenderEvent.DblClick,S)}p.previousClick={x:re,y:we,time:Oe}},p.onMouseMove=function(S){p.emit(K.RenderEvent.Mousemove,S)},p.onMouseDown=function(S){p.emit(K.RenderEvent.Dragstart,S)},p.onDragging=function(S){p.emit(K.RenderEvent.Dragging,S)},p.onDragEnd=Cc(function(S){p.emit(K.RenderEvent.Dragend,S)},0),p.scene=l,p}return Jo(s,[{key:"enableDrag",value:function(){this.disableDrag(),this.scene.on(K.SceneEvent.Mousedown,this.onMouseDown),this.scene.on(K.SceneEvent.Dragging,this.onDragging),this.scene.on(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.scene.off(K.SceneEvent.Mousedown,this.onMouseDown),this.scene.off(K.SceneEvent.Dragging,this.onDragging),this.scene.off(K.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(K.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableMouseMove",value:function(){this.disableMouseMove(),this.scene.on(K.SceneEvent.Mousemove,this.onMouseMove)}},{key:"disableMouseMove",value:function(){this.scene.off(K.SceneEvent.Mousemove,this.onMouseMove)}},{key:"enableDblClick",value:function(){this.disableDblClick(),this.scene.on(K.SceneEvent.Mousedown,this.onDblClick)}},{key:"disableDblClick",value:function(){this.scene.off(K.SceneEvent.Mousedown,this.onDblClick)}}]),s}(Mf),D=function(L){ou(s,L);var i=su(s);function s(){return Xa(this,s),i.apply(this,arguments)}return Jo(s,[{key:"initLayers",value:function(){var l=this.style,p=l.normal,S=l.active,A=l.style,I=A===void 0?{}:A,U=l.options;return[new j.PointLayer(U!=null?U:{}).source(vu([])).size("isActive",function(q){return q?S.size:p.size}).color("isActive",function(q){return q?S.color:p.color}).shape("text","text").style(I)]}}]),s}(pf),h={point:wp,line:Lf,dashLine:Lc,midPoint:Dh,text:D,polygon:Jf},x="#1990FF",O="#ED9D48",Z={blend:"normal",pickingBuffer:5},H={color:x,shape:"circle",size:6},ae={color:O,shape:"circle",size:6},ue={shape:"circle",size:6,color:O},ge={options:Z,normal:H,hover:kr(kr({},H),{},{size:8}),active:kr(kr({},H),{},{size:8,color:O}),style:{stroke:"#ffffff",strokeWidth:2}},Le={options:Z,normal:ae,hover:kr(kr({},ae),{},{size:8}),active:kr(kr({},ae),{},{size:8}),style:{stroke:"#ffffff",strokeWidth:2}},m={color:x,size:12},w={point:Le,line:{options:Z,normal:{color:x,size:2},hover:{color:x,size:2},active:{color:O,size:2},style:{}},polygon:{options:Z,normal:{color:x},hover:{color:x},active:{color:O},style:{opacity:.15}},midPoint:{options:Z,normal:ue},dashLine:{options:Z,normal:{color:O,size:2},style:{lineType:"dash",dashArray:[6,6]}},text:{options:Z,normal:m,active:kr(kr({},m),{},{color:O}),style:{fontWeight:"800",textOffset:[0,m.size+6],textAllowOverlap:!0,stroke:"#ffffff",strokeWidth:2}}},_=function(L,i){return L===i||L!=L&&i!=i},T=function(L,i){for(var s=L.length;s--;)if(_(L[s][0],i))return s;return-1},N=Array.prototype.splice,$=function(L){var i=this.__data__,s=T(i,L);return s>=0&&(s==i.length-1?i.pop():N.call(i,s,1),--this.size,!0)},X=function(L){var i=this.__data__,s=T(i,L);return 0>s?void 0:i[s][1]},oe=function(L){return T(this.__data__,L)>-1},xe=function(L,i){var s=this.__data__,l=T(s,L);return 0>l?(++this.size,s.push([L,i])):s[l][1]=i,this};function ye(L){var i=-1,s=L==null?0:L.length;for(this.clear();++i<s;){var l=L[i];this.set(l[0],l[1])}}ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=$,ye.prototype.get=X,ye.prototype.has=oe,ye.prototype.set=xe;var De=ye,He=function(){this.__data__=new De,this.size=0},$e=function(L){var i=this.__data__,s=i.delete(L);return this.size=i.size,s},ft=function(L){return this.__data__.get(L)},pt=function(L){return this.__data__.has(L)},wt,dt=function(L){if(!_l(L))return!1;var i=Rh(L);return i=="[object Function]"||i=="[object GeneratorFunction]"||i=="[object AsyncFunction]"||i=="[object Proxy]"},Ft=Po["__core-js_shared__"],ar=(wt=/[^.]+$/.exec(Ft&&Ft.keys&&Ft.keys.IE_PROTO||""))?"Symbol(src)_1."+wt:"",nr=function(L){return!!ar&&ar in L},Ir=Function.prototype.toString,_r=function(L){if(L!=null){try{return Ir.call(L)}catch(i){}try{return L+""}catch(i){}}return""},Qr=/^\[object .+?Constructor\]$/,nn=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ln=function(L){return!(!_l(L)||nr(L))&&(dt(L)?nn:Qr).test(_r(L))},Mn=function(L,i){return L==null?void 0:L[i]},yi=function(L,i){var s=Mn(L,i);return Ln(s)?s:void 0},Ri=yi(Po,"Map"),Qi=yi(Object,"create"),Vi=function(L){var i=this.has(L)&&delete this.__data__[L];return this.size-=i?1:0,i},ao=Object.prototype.hasOwnProperty,Bi=function(L){var i=this.__data__;if(Qi){var s=i[L];return s==="__lodash_hash_undefined__"?void 0:s}return ao.call(i,L)?i[L]:void 0},oa=Object.prototype.hasOwnProperty,Ha=function(L){var i=this.__data__;return Qi?i[L]!==void 0:oa.call(i,L)},ja=function(L,i){var s=this.__data__;return this.size+=this.has(L)?0:1,s[L]=Qi&&i===void 0?"__lodash_hash_undefined__":i,this};function Sa(L){var i=-1,s=L==null?0:L.length;for(this.clear();++i<s;){var l=L[i];this.set(l[0],l[1])}}Sa.prototype.clear=function(){this.__data__=Qi?Qi(null):{},this.size=0},Sa.prototype.delete=Vi,Sa.prototype.get=Bi,Sa.prototype.has=Ha,Sa.prototype.set=ja;var Qa=Sa,eo=function(L){var i=typeof L;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?L!=="__proto__":L===null},va=function(L,i){var s=L.__data__;return eo(i)?s[typeof i=="string"?"string":"hash"]:s.map},tu=function(L){var i=va(this,L).delete(L);return this.size-=i?1:0,i},Gs=function(L){return va(this,L).get(L)},Tl=function(L){return va(this,L).has(L)},Ps=function(L,i){var s=va(this,L),l=s.size;return s.set(L,i),this.size+=s.size==l?0:1,this};function Qo(L){var i=-1,s=L==null?0:L.length;for(this.clear();++i<s;){var l=L[i];this.set(l[0],l[1])}}Qo.prototype.clear=function(){this.size=0,this.__data__={hash:new Qa,map:new(Ri||De),string:new Qa}},Qo.prototype.delete=tu,Qo.prototype.get=Gs,Qo.prototype.has=Tl,Qo.prototype.set=Ps;var Zs=Qo,Hs=function(L,i){var s=this.__data__;if(s instanceof De){var l=s.__data__;if(!Ri||199>l.length)return l.push([L,i]),this.size=++s.size,this;s=this.__data__=new Zs(l)}return s.set(L,i),this.size=s.size,this};function Uu(L){var i=this.__data__=new De(L);this.size=i.size}Uu.prototype.clear=He,Uu.prototype.delete=$e,Uu.prototype.get=ft,Uu.prototype.has=pt,Uu.prototype.set=Hs;var uh=Uu,pc=function(L,i){for(var s=-1,l=L==null?0:L.length;++s<l&&i(L[s],s,L)!==!1;);return L},Xc=function(){try{var L=yi(Object,"defineProperty");return L({},"",{}),L}catch(i){}}(),Yc=function(L,i,s){i=="__proto__"&&Xc?Xc(L,i,{configurable:!0,enumerable:!0,value:s,writable:!0}):L[i]=s},Qf=Object.prototype.hasOwnProperty,dc=function(L,i,s){var l=L[i];Qf.call(L,i)&&_(l,s)&&(s!==void 0||i in L)||Yc(L,i,s)},vc=function(L,i,s,l){var p=!s;s||(s={});for(var S=-1,A=i.length;++S<A;){var I=i[S],U=l?l(s[I],L[I],I,s,L):void 0;U===void 0&&(U=L[I]),p?Yc(s,I,U):dc(s,I,U)}return s},Dc=function(L,i){for(var s=-1,l=Array(L);++s<L;)l[s]=i(s);return l},Vl=function(L){return ho(L)&&Rh(L)=="[object Arguments]"},Gl=Object.prototype,vf=Gl.hasOwnProperty,mc=Gl.propertyIsEnumerable,Hl=Vl(function(){return arguments}())?Vl:function(L){return ho(L)&&vf.call(L,"callee")&&!mc.call(L,"callee")},lh=Hl,Os=Array.isArray,ch=function(){return!1},Es=wo(function(L,i){var s=i&&!i.nodeType&&i,l=s&&L&&!L.nodeType&&L,p=l&&l.exports===s?Po.Buffer:void 0;L.exports=(p?p.isBuffer:void 0)||ch}),Ol=/^(?:0|[1-9]\d*)$/,ml=function(L,i){var s=typeof L;return!!(i=i==null?9007199254740991:i)&&(s=="number"||s!="symbol"&&Ol.test(L))&&L>-1&&L%1==0&&i>L},mf=function(L){return typeof L=="number"&&L>-1&&L%1==0&&9007199254740991>=L},ku={};ku["[object Float32Array]"]=ku["[object Float64Array]"]=ku["[object Int8Array]"]=ku["[object Int16Array]"]=ku["[object Int32Array]"]=ku["[object Uint8Array]"]=ku["[object Uint8ClampedArray]"]=ku["[object Uint16Array]"]=ku["[object Uint32Array]"]=!0,ku["[object Arguments]"]=ku["[object Array]"]=ku["[object ArrayBuffer]"]=ku["[object Boolean]"]=ku["[object DataView]"]=ku["[object Date]"]=ku["[object Error]"]=ku["[object Function]"]=ku["[object Map]"]=ku["[object Number]"]=ku["[object Object]"]=ku["[object RegExp]"]=ku["[object Set]"]=ku["[object String]"]=ku["[object WeakMap]"]=!1;var ep=function(L){return ho(L)&&mf(L.length)&&!!ku[Rh(L)]},cd=function(L){return function(i){return L(i)}},qh=wo(function(L,i){var s=i&&!i.nodeType&&i,l=s&&L&&!L.nodeType&&L,p=l&&l.exports===s&&xo.process,S=function(){try{var A=l&&l.require&&l.require("util").types;return A||p&&p.binding&&p.binding("util")}catch(I){}}();L.exports=S}),Rd=qh&&qh.isTypedArray,Rf=Rd?cd(Rd):ep,hd=Object.prototype.hasOwnProperty,Sd=function(L,i){var s=Os(L),l=!s&&lh(L),p=!s&&!l&&Es(L),S=!s&&!l&&!p&&Rf(L),A=s||l||p||S,I=A?Dc(L.length,String):[],U=I.length;for(var q in L)!i&&!hd.call(L,q)||A&&(q=="length"||p&&(q=="offset"||q=="parent")||S&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||ml(q,U))||I.push(q);return I},Ip=Object.prototype,Fl=function(L){var i=L&&L.constructor;return L===(typeof i=="function"&&i.prototype||Ip)},Wd=function(L,i){return function(s){return L(i(s))}},Qm=Wd(Object.keys,Object),Tv=Object.prototype.hasOwnProperty,Mv=function(L){if(!Fl(L))return Qm(L);var i=[];for(var s in Object(L))Tv.call(L,s)&&s!="constructor"&&i.push(s);return i},Dd=function(L){return L!=null&&mf(L.length)&&!dt(L)},Pv=function(L){return Dd(L)?Sd(L):Mv(L)},fd=function(L,i){return L&&vc(i,Pv(i),L)},jv=function(L){var i=[];if(L!=null)for(var s in Object(L))i.push(s);return i},hh=Object.prototype.hasOwnProperty,dv=function(L){if(!_l(L))return jv(L);var i=Fl(L),s=[];for(var l in L)(l!="constructor"||!i&&hh.call(L,l))&&s.push(l);return s},Df=function(L){return Dd(L)?Sd(L,!0):dv(L)},Xd=function(L,i){return L&&vc(i,Df(i),L)},Yd=wo(function(L,i){var s=i&&!i.nodeType&&i,l=s&&L&&!L.nodeType&&L,p=l&&l.exports===s?Po.Buffer:void 0,S=p?p.allocUnsafe:void 0;L.exports=function(A,I){if(I)return A.slice();var U=A.length,q=S?S(U):new A.constructor(U);return A.copy(q),q}}),Vv=function(L,i){var s=-1,l=L.length;for(i||(i=Array(l));++s<l;)i[s]=L[s];return i},lm=function(L,i){for(var s=-1,l=L==null?0:L.length,p=0,S=[];++s<l;){var A=L[s];i(A,s,L)&&(S[p++]=A)}return S},Om=function(){return[]},Fm=Object.prototype.propertyIsEnumerable,cm=Object.getOwnPropertySymbols,hm=cm?function(L){return L==null?[]:lm(cm(L=Object(L)),function(i){return Fm.call(L,i)})}:Om,zm=function(L,i){return vc(L,hm(L),i)},qd=function(L,i){for(var s=-1,l=i.length,p=L.length;++s<l;)L[p+s]=i[s];return L},Sp=Wd(Object.getPrototypeOf,Object),Ed=Object.getOwnPropertySymbols?function(L){for(var i=[];L;)qd(i,hm(L)),L=Sp(L);return i}:Om,qu=function(L,i){return vc(L,Ed(L),i)},fh=function(L,i,s){var l=i(L);return Os(L)?l:qd(l,s(L))},Oh=function(L){return fh(L,Pv,hm)},Ku=function(L){return fh(L,Df,Ed)},Ml=yi(Po,"DataView"),qp=yi(Po,"Promise"),kv=yi(Po,"Set"),Kd=yi(Po,"WeakMap"),Ju="[object Map]",Od="[object Promise]",_s="[object Set]",vv="[object WeakMap]",Ac="[object DataView]",Sh=_r(Ml),Lp=_r(Ri),Tc=_r(qp),Of=_r(kv),Fd=_r(Kd),Oc=Rh;(Ml&&Oc(new Ml(new ArrayBuffer(1)))!=Ac||Ri&&Oc(new Ri)!=Ju||qp&&Oc(qp.resolve())!=Od||kv&&Oc(new kv)!=_s||Kd&&Oc(new Kd)!=vv)&&(Oc=function(L){var i=Rh(L),s=i=="[object Object]"?L.constructor:void 0,l=s?_r(s):"";if(l)switch(l){case Sh:return Ac;case Lp:return Ju;case Tc:return Od;case Of:return _s;case Fd:return vv}return i});var zd=Oc,yg=Object.prototype.hasOwnProperty,Gv=function(L){var i=L.length,s=new L.constructor(i);return i&&typeof L[0]=="string"&&yg.call(L,"index")&&(s.index=L.index,s.input=L.input),s},fm=Po.Uint8Array,Ff=function(L){var i=new L.constructor(L.byteLength);return new fm(i).set(new fm(L)),i},mv=function(L,i){var s=i?Ff(L.buffer):L.buffer;return new L.constructor(s,L.byteOffset,L.byteLength)},gc=/\w*$/,Hv=function(L){var i=new L.constructor(L.source,gc.exec(L));return i.lastIndex=L.lastIndex,i},pm=Al?Al.prototype:void 0,Cd=pm?pm.valueOf:void 0,dm=function(L){return Cd?Object(Cd.call(L)):{}},gf=function(L,i){var s=i?Ff(L.buffer):L.buffer;return new L.constructor(s,L.byteOffset,L.length)},Jd=function(L,i,s){var l=L.constructor;switch(i){case"[object ArrayBuffer]":return Ff(L);case"[object Boolean]":case"[object Date]":return new l(+L);case"[object DataView]":return mv(L,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return gf(L,s);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(L);case"[object RegExp]":return Hv(L);case"[object Symbol]":return dm(L)}},Kh=Object.create,qc=function(){function L(){}return function(i){if(!_l(i))return{};if(Kh)return Kh(i);L.prototype=i;var s=new L;return L.prototype=void 0,s}}(),Bd=function(L){return typeof L.constructor!="function"||Fl(L)?{}:qc(Sp(L))},zf=function(L){return ho(L)&&zd(L)=="[object Map]"},gv=qh&&qh.isMap,eg=gv?cd(gv):zf,Fh=function(L){return ho(L)&&zd(L)=="[object Set]"},yf=qh&&qh.isSet,tc=yf?cd(yf):Fh,_f="[object Arguments]",$v="[object Function]",vm="[object Object]",zl={};zl[_f]=zl["[object Array]"]=zl["[object ArrayBuffer]"]=zl["[object DataView]"]=zl["[object Boolean]"]=zl["[object Date]"]=zl["[object Float32Array]"]=zl["[object Float64Array]"]=zl["[object Int8Array]"]=zl["[object Int16Array]"]=zl["[object Int32Array]"]=zl["[object Map]"]=zl["[object Number]"]=zl[vm]=zl["[object RegExp]"]=zl["[object Set]"]=zl["[object String]"]=zl["[object Symbol]"]=zl["[object Uint8Array]"]=zl["[object Uint8ClampedArray]"]=zl["[object Uint16Array]"]=zl["[object Uint32Array]"]=!0,zl["[object Error]"]=zl[$v]=zl["[object WeakMap]"]=!1;var Wv=function L(i,s,l,p,S,A){var I,U=1&s,q=2&s,re=4&s;if(l&&(I=S?l(i,p,S,A):l(i)),I!==void 0)return I;if(!_l(i))return i;var de=Os(i);if(de){if(I=Gv(i),!U)return Vv(i,I)}else{var we=zd(i),Oe=we==$v||we=="[object GeneratorFunction]";if(Es(i))return Yd(i,U);if(we==vm||we==_f||Oe&&!S){if(I=q||Oe?{}:Bd(i),!U)return q?qu(i,Xd(I,i)):zm(i,fd(I,i))}else{if(!zl[we])return S?i:{};I=Jd(i,we,U)}}A||(A=new uh);var Ge=A.get(i);if(Ge)return Ge;A.set(i,I),tc(i)?i.forEach(function(tt){I.add(L(tt,s,l,tt,i,A))}):eg(i)&&i.forEach(function(tt,ct){I.set(ct,L(tt,s,l,ct,i,A))});var it=de?void 0:(re?q?Ku:Oh:q?Df:Pv)(i);return pc(it||i,function(tt,ct){it&&(tt=i[ct=tt]),dc(I,ct,L(tt,s,l,ct,i,A))}),I},al=function(L){return Wv(L,5)},Xv=function(L){for(var i=-1,s=L==null?0:L.length,l={};++i<s;){var p=L[i];l[p[0]]=p[1]}return l},Qd=function(L){return this.__data__.has(L)};function yv(L){var i=-1,s=L==null?0:L.length;for(this.__data__=new Zs;++i<s;)this.add(L[i])}yv.prototype.add=yv.prototype.push=function(L){return this.__data__.set(L,"__lodash_hash_undefined__"),this},yv.prototype.has=Qd;var _g=yv,mm=function(L,i){for(var s=-1,l=L==null?0:L.length;++s<l;)if(i(L[s],s,L))return!0;return!1},bg=function(L,i){return L.has(i)},Kp=function(L,i,s,l,p,S){var A=1&s,I=L.length,U=i.length;if(!(I==U||A&&U>I))return!1;var q=S.get(L),re=S.get(i);if(q&&re)return q==i&&re==L;var de=-1,we=!0,Oe=2&s?new _g:void 0;for(S.set(L,i),S.set(i,L);++de<I;){var Ge=L[de],it=i[de];if(l)var tt=A?l(it,Ge,de,i,L,S):l(Ge,it,de,L,i,S);if(tt!==void 0){if(tt)continue;we=!1;break}if(Oe){if(!mm(i,function(ct,ut){if(!bg(Oe,ut)&&(Ge===ct||p(Ge,ct,s,l,S)))return Oe.push(ut)})){we=!1;break}}else if(Ge!==it&&!p(Ge,it,s,l,S)){we=!1;break}}return S.delete(L),S.delete(i),we},Bm=function(L){var i=-1,s=Array(L.size);return L.forEach(function(l,p){s[++i]=[p,l]}),s},Ad=function(L){var i=-1,s=Array(L.size);return L.forEach(function(l){s[++i]=l}),s},ev=Al?Al.prototype:void 0,Fc=ev?ev.valueOf:void 0,tp=function(L,i,s,l,p,S,A){switch(s){case"[object DataView]":if(L.byteLength!=i.byteLength||L.byteOffset!=i.byteOffset)return!1;L=L.buffer,i=i.buffer;case"[object ArrayBuffer]":return!(L.byteLength!=i.byteLength||!S(new fm(L),new fm(i)));case"[object Boolean]":case"[object Date]":case"[object Number]":return _(+L,+i);case"[object Error]":return L.name==i.name&&L.message==i.message;case"[object RegExp]":case"[object String]":return L==i+"";case"[object Map]":var I=Bm;case"[object Set]":if(I||(I=Ad),L.size!=i.size&&!(1&l))return!1;var U=A.get(L);if(U)return U==i;l|=2,A.set(L,i);var q=Kp(I(L),I(i),l,p,S,A);return A.delete(L),q;case"[object Symbol]":if(Fc)return Fc.call(L)==Fc.call(i)}return!1},Nd=Object.prototype.hasOwnProperty,ze=function(L,i,s,l,p,S){var A=1&s,I=Oh(L),U=I.length;if(U!=Oh(i).length&&!A)return!1;for(var q=U;q--;){var re=I[q];if(!(A?re in i:Nd.call(i,re)))return!1}var de=S.get(L),we=S.get(i);if(de&&we)return de==i&&we==L;var Oe=!0;S.set(L,i),S.set(i,L);for(var Ge=A;++q<U;){var it=L[re=I[q]],tt=i[re];if(l)var ct=A?l(tt,it,re,i,L,S):l(it,tt,re,L,i,S);if(!(ct===void 0?it===tt||p(it,tt,s,l,S):ct)){Oe=!1;break}Ge||(Ge=re=="constructor")}if(Oe&&!Ge){var ut=L.constructor,Je=i.constructor;ut==Je||!("constructor"in L)||!("constructor"in i)||typeof ut=="function"&&ut instanceof ut&&typeof Je=="function"&&Je instanceof Je||(Oe=!1)}return S.delete(L),S.delete(i),Oe},At="[object Arguments]",Gt="[object Array]",fn="[object Object]",Dn=Object.prototype.hasOwnProperty,ln=function(L,i,s,l,p,S){var A=Os(L),I=Os(i),U=A?Gt:zd(L),q=I?Gt:zd(i),re=(U=U==At?fn:U)==fn,de=(q=q==At?fn:q)==fn,we=U==q;if(we&&Es(L)){if(!Es(i))return!1;A=!0,re=!1}if(we&&!re)return S||(S=new uh),A||Rf(L)?Kp(L,i,s,l,p,S):tp(L,i,U,s,l,p,S);if(!(1&s)){var Oe=re&&Dn.call(L,"__wrapped__"),Ge=de&&Dn.call(i,"__wrapped__");if(Oe||Ge){var it=Oe?L.value():L,tt=Ge?i.value():i;return S||(S=new uh),p(it,tt,s,l,S)}}return!!we&&(S||(S=new uh),ze(L,i,s,l,p,S))},_n=function L(i,s,l,p,S){return i===s||(i==null||s==null||!ho(i)&&!ho(s)?i!=i&&s!=s:ln(i,s,l,p,L,S))},Zn=function(L,i){return _n(L,i)},ri=function(L,i,s){(s!==void 0&&!_(L[i],s)||s===void 0&&!(i in L))&&Yc(L,i,s)},Ci=function(L){return function(i,s,l){for(var p=-1,S=Object(i),A=l(i),I=A.length;I--;){var U=A[L?I:++p];if(s(S[U],U,S)===!1)break}return i}},_i=Ci(),Li=function(L){return ho(L)&&Dd(L)},Fi=Function.prototype.toString,hi=Object.prototype.hasOwnProperty,ki=Fi.call(Object),Wr=function(L){if(!ho(L)||Rh(L)!="[object Object]")return!1;var i=Sp(L);if(i===null)return!0;var s=hi.call(i,"constructor")&&i.constructor;return typeof s=="function"&&s instanceof s&&Fi.call(s)==ki},bn=function(L,i){if((i!=="constructor"||typeof L[i]!="function")&&i!="__proto__")return L[i]},di=function(L){return vc(L,Df(L))},Gi=function(L,i,s,l,p,S,A){var I=bn(L,s),U=bn(i,s),q=A.get(U);if(q)ri(L,s,q);else{var re=S?S(I,U,s+"",L,i,A):void 0,de=re===void 0;if(de){var we=Os(U),Oe=!we&&Es(U),Ge=!we&&!Oe&&Rf(U);re=U,we||Oe||Ge?Os(I)?re=I:Li(I)?re=Vv(I):Oe?(de=!1,re=Yd(U,!0)):Ge?(de=!1,re=gf(U,!0)):re=[]:Wr(U)||lh(U)?(re=I,lh(I)?re=di(I):_l(I)&&!dt(I)||(re=Bd(U))):de=!1}de&&(A.set(U,re),p(re,U,l,S,A),A.delete(U)),ri(L,s,re)}},Yn=function L(i,s,l,p,S){i!==s&&_i(s,function(A,I){if(S||(S=new uh),_l(A))Gi(i,s,I,l,L,p,S);else{var U=p?p(bn(i,I),A,I+"",i,s,S):void 0;U===void 0&&(U=A),ri(i,I,U)}},Df)},ia=function(L){return L},oi=function(L,i,s){switch(s.length){case 0:return L.call(i);case 1:return L.call(i,s[0]);case 2:return L.call(i,s[0],s[1]);case 3:return L.call(i,s[0],s[1],s[2])}return L.apply(i,s)},Di=Math.max,qn=function(L,i,s){return i=Di(i===void 0?L.length-1:i,0),function(){for(var l=arguments,p=-1,S=Di(l.length-i,0),A=Array(S);++p<S;)A[p]=l[i+p];p=-1;for(var I=Array(i+1);++p<i;)I[p]=l[p];return I[i]=s(A),oi(L,this,I)}},Ai=function(L){return function(){return L}},Oa=Date.now,Ya=function(L){var i=0,s=0;return function(){var l=Oa(),p=16-(l-s);if(s=l,p>0){if(++i>=800)return arguments[0]}else i=0;return L.apply(void 0,arguments)}},Oi=Ya(Xc?function(L,i){return Xc(L,"toString",{configurable:!0,enumerable:!1,value:Ai(i),writable:!0})}:ia),Qn=function(L,i){return Oi(qn(L,i,ia),L+"")},Hn=function(L,i,s){if(!_l(s))return!1;var l=typeof i;return!!(l=="number"?Dd(s)&&ml(i,s.length):l=="string"&&i in s)&&_(s[i],L)},mo=function(L){return Qn(function(i,s){var l=-1,p=s.length,S=p>1?s[p-1]:void 0,A=p>2?s[2]:void 0;for(S=L.length>3&&typeof S=="function"?(p--,S):void 0,A&&Hn(s[0],s[1],A)&&(S=3>p?void 0:S,p=1),i=Object(i);++l<p;){var I=s[l];I&&L(i,I,l,S)}return i})},so=mo(function(L,i,s){Yn(L,i,s)}),sa=function(L,i){for(var s=-1,l=L==null?0:L.length,p=Array(l);++s<l;)p[s]=i(L[s],s,L);return p},Cs=function(L,i){return sa(i,function(s){return[s,L[s]]})},Vo=function(L){var i=-1,s=Array(L.size);return L.forEach(function(l){s[++i]=[l,l]}),s},Go=function(L){return function(i){var s=zd(i);return s=="[object Map]"?Bm(i):s=="[object Set]"?Vo(i):Cs(i,L(i))}}(Pv),Fs=wo(function(L){(function(i,s,l){if(i){for(var p,S={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},A={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},I={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},U={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},q=1;20>q;++q)S[111+q]="f"+q;for(q=0;9>=q;++q)S[q+96]=""+q;tt.prototype.bind=function(ct,ut,Je){var Pt=this;return Pt._bindMultiple.call(Pt,ct=ct instanceof Array?ct:[ct],ut,Je),Pt},tt.prototype.unbind=function(ct,ut){return this.bind.call(this,ct,function(){},ut)},tt.prototype.trigger=function(ct,ut){var Je=this;return Je._directMap[ct+":"+ut]&&Je._directMap[ct+":"+ut]({},ct),Je},tt.prototype.reset=function(){var ct=this;return ct._callbacks={},ct._directMap={},ct},tt.prototype.stopCallback=function(ct,ut){if((" "+ut.className+" ").indexOf(" mousetrap ")>-1||it(ut,this.target))return!1;if("composedPath"in ct&&typeof ct.composedPath=="function"){var Je=ct.composedPath()[0];Je!==ct.target&&(ut=Je)}return ut.tagName=="INPUT"||ut.tagName=="SELECT"||ut.tagName=="TEXTAREA"||ut.isContentEditable},tt.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},tt.addKeycodes=function(ct){for(var ut in ct)ct.hasOwnProperty(ut)&&(S[ut]=ct[ut]);p=null},tt.init=function(){var ct=tt(s);for(var ut in ct)ut.charAt(0)!=="_"&&(tt[ut]=function(Je){return function(){return ct[Je].apply(ct,arguments)}}(ut))},tt.init(),i.Mousetrap=tt,L.exports&&(L.exports=tt)}function re(ct,ut,Je){ct.addEventListener?ct.addEventListener(ut,Je,!1):ct.attachEvent("on"+ut,Je)}function de(ct){if(ct.type=="keypress"){var ut=String.fromCharCode(ct.which);return ct.shiftKey||(ut=ut.toLowerCase()),ut}return S[ct.which]?S[ct.which]:A[ct.which]?A[ct.which]:String.fromCharCode(ct.which).toLowerCase()}function we(ct){return ct=="shift"||ct=="ctrl"||ct=="alt"||ct=="meta"}function Oe(ct,ut,Je){return Je||(Je=function(){if(!p)for(var Pt in p={},S)Pt>95&&112>Pt||S.hasOwnProperty(Pt)&&(p[S[Pt]]=Pt);return p}()[ct]?"keydown":"keypress"),Je=="keypress"&&ut.length&&(Je="keydown"),Je}function Ge(ct,ut){var Je,Pt,Xt,pr=[];for(Je=function(Ur){return Ur==="+"?["+"]:(Ur=Ur.replace(/\+{2}/g,"+plus")).split("+")}(ct),Xt=0;Je.length>Xt;++Xt)U[Pt=Je[Xt]]&&(Pt=U[Pt]),ut&&ut!="keypress"&&I[Pt]&&(Pt=I[Pt],pr.push("shift")),we(Pt)&&pr.push(Pt);return{key:Pt,modifiers:pr,action:ut=Oe(Pt,pr,ut)}}function it(ct,ut){return ct!==null&&ct!==s&&(ct===ut||it(ct.parentNode,ut))}function tt(ct){var ut=this;if(ct=ct||s,!(ut instanceof tt))return new tt(ct);ut.target=ct,ut._callbacks={},ut._directMap={};var Je,Pt={},Xt=!1,pr=!1,Ur=!1;function tn(ci){ci=ci||{};var wi,$n=!1;for(wi in Pt)ci[wi]?$n=!0:Pt[wi]=0;$n||(Ur=!1)}function An(ci,wi,$n,Si,Kn,la){var yn,Ti,Aa,$o=[],lo=$n.type;if(!ut._callbacks[ci])return[];for(lo=="keyup"&&we(ci)&&(wi=[ci]),yn=0;ut._callbacks[ci].length>yn;++yn)Ti=ut._callbacks[ci][yn],(Si||!Ti.seq||Pt[Ti.seq]==Ti.level)&&lo==Ti.action&&(lo=="keypress"&&!$n.metaKey&&!$n.ctrlKey||(Aa=Ti.modifiers,wi.sort().join(",")===Aa.sort().join(",")))&&((!Si&&Ti.combo==Kn||Si&&Ti.seq==Si&&Ti.level==la)&&ut._callbacks[ci].splice(yn,1),$o.push(Ti));return $o}function xi(ci,wi,$n,Si){ut.stopCallback(wi,wi.target||wi.srcElement,$n,Si)||ci(wi,$n)===!1&&(function(Kn){Kn.preventDefault?Kn.preventDefault():Kn.returnValue=!1}(wi),function(Kn){Kn.stopPropagation?Kn.stopPropagation():Kn.cancelBubble=!0}(wi))}function On(ci){typeof ci.which!="number"&&(ci.which=ci.keyCode);var wi=de(ci);wi&&(ci.type!="keyup"||Xt!==wi?ut.handleKey(wi,function($n){var Si=[];return $n.shiftKey&&Si.push("shift"),$n.altKey&&Si.push("alt"),$n.ctrlKey&&Si.push("ctrl"),$n.metaKey&&Si.push("meta"),Si}(ci),ci):Xt=!1)}function si(ci,wi,$n,Si){function Kn(Aa){return function(){Ur=Aa,++Pt[ci],clearTimeout(Je),Je=setTimeout(tn,1e3)}}function la(Aa){xi($n,Aa,ci),Si!=="keyup"&&(Xt=de(Aa)),setTimeout(tn,10)}Pt[ci]=0;for(var yn=0;wi.length>yn;++yn){var Ti=yn+1===wi.length?la:Kn(Si||Ge(wi[yn+1]).action);kn(wi[yn],Ti,Si,ci,yn)}}function kn(ci,wi,$n,Si,Kn){ut._directMap[ci+":"+$n]=wi;var la,yn=(ci=ci.replace(/\s+/g," ")).split(" ");yn.length>1?si(ci,yn,wi,$n):(la=Ge(ci,$n),ut._callbacks[la.key]=ut._callbacks[la.key]||[],An(la.key,la.modifiers,{type:la.action},Si,ci,Kn),ut._callbacks[la.key][Si?"unshift":"push"]({callback:wi,modifiers:la.modifiers,action:la.action,seq:Si,level:Kn,combo:ci}))}ut._handleKey=function(ci,wi,$n){var Si,Kn=An(ci,wi,$n),la={},yn=0,Ti=!1;for(Si=0;Kn.length>Si;++Si)Kn[Si].seq&&(yn=Math.max(yn,Kn[Si].level));for(Si=0;Kn.length>Si;++Si)if(Kn[Si].seq){if(Kn[Si].level!=yn)continue;Ti=!0,la[Kn[Si].seq]=1,xi(Kn[Si].callback,$n,Kn[Si].combo,Kn[Si].seq)}else Ti||xi(Kn[Si].callback,$n,Kn[Si].combo);var Aa=$n.type=="keypress"&&pr;$n.type!=Ur||we(ci)||Aa||tn(la),pr=Ti&&$n.type=="keydown"},ut._bindMultiple=function(ci,wi,$n){for(var Si=0;ci.length>Si;++Si)kn(ci[Si],wi,$n)},re(ct,"keypress",On),re(ct,"keydown",On),re(ct,"keyup",On)}})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)}),xl,ks=function(L){return L&&L.length?L[0]:void 0},Ho=(xl=1,function(L){return"".concat(L,"-").concat(xl++)}),ss=function(L,i){var s,l;return!(!L||!i||((s=L.properties)===null||s===void 0?void 0:s.id)!==((l=i.properties)===null||l===void 0?void 0:l.id))},As=function(L){var i=L.target,s=L.targetHandler,l=L.otherHandler;return L.data.map(function(p,S){var A,I=ss(p,i)?s:l;return(A=I==null?void 0:I(p,S))!==null&&A!==void 0?A:p})},Lo=function(){return{id:Ho("point"),isHover:!1,isActive:!1,isDrag:!1,createTime:Date.now()}},Pl=function(){return{id:Ho("line"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},$l=function(){return{id:Ho("polygon"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},bu=function(L){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Vs(L,kr(kr({},Lo()),i))},Hu=function(L){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:"Feature",properties:kr(kr({},Pl()),{},{nodes:L},i),geometry:{type:"LineString",coordinates:hl(vu(L))}}},Du=function(L){return tl(L,{id:Ho("dashLine")})},Ro=function(L){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:"Feature",properties:kr(kr({},$l()),{},{nodes:L},i),geometry:{type:"Polygon",coordinates:[hl(vu([].concat(Su(L),[ks(L)])))]}}},Kc=function(L){return function(i,s,l){l===void 0&&(l={});for(var p=Vh(i).coordinates,S=0,A=0;p.length>A&&(S>s||A!==p.length-1);A++){if(S>=s){var I=s-S;if(I){var U=Ms(p[A],p[A-1])-180;return Rl(p[A],I,U,l)}return Vs(p[A])}S+=Kl(p[A],p[A+1],l)}return Vs(p[p.length-1])}(L,Jl(L,{units:"meters"})/2,{units:"meters"})},lu=function(L,i){var s=i.format,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p=[];if(i.showTotalDistance){var S=Kc(L),A=Jl(L,{units:"meters"});S.properties=kr({id:Ho("text"),isActive:!1,meters:A,text:s(A),type:"totalDistance"},l),p.push(S)}else for(var I=L.geometry.coordinates,U=0;I.length-1>U;U++){var q=Vs(I[U]),re=Vs(I[U+1]),de=Kl(q,re,{units:"meters"}),we=Hh(vu([q,re]));we.properties=kr({id:Ho("text"),isActive:!1,meters:de,text:s(de),type:"distance"},l),p.push(we)}return p},Fa=function(L,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=i.format,p=wh(L);return Ef(L,{properties:kr({meters:p,text:l(p),type:"area",isActive:!1},s)})},Ts=function(L){var i,s,l=L.getContainer();return(i=(s=l==null?void 0:l.querySelector(".l7-marker-container"))!==null&&s!==void 0?s:l==null?void 0:l.querySelector(".amap-maps"))!==null&&i!==void 0?i:null},us=function(L){return L.lngLat||L.lnglat},Iu=function(L){var i=us(L);return[i.lng,i.lat]},zh=function(L){return[L.lng,L.lat]},rp=function(L){for(var i=Number.MAX_SAFE_INTEGER,s=0,l=L.length,p=0;l>p;p++)i>L[p]&&(i=L[p],s=p);return s},qt=function(L,i){var s=[],l=[];return L.forEach(function(p){Zn(p,i)?l.length&&(s.push(l),l=[]):l.push(p)}),l.length&&s.push(l),s},pn=function(L,i,s){var l=[],p=[],S=[];return l=L==="allDrawData"?wr.instances.map(function(A){return A.getData()}).flat():L==="drawData"?i.getData():L instanceof Function?L(s):L,l.length&&(p=l.map(function(A){var I,U=(I=A.properties)!==null&&I!==void 0?I:{},q=U.nodes,re=q===void 0?[]:q,de=U.isActive;return de!==void 0&&de?re.filter(function(we){return!Zn(we.geometry.coordinates,s)}):re}).flat().filter(function(A){return A}),p.length||(p=hl(vu(l)).map(function(A){return Vs(A)})),S=l.map(function(A){var I,U,q=(I=A.properties)===null||I===void 0?void 0:I.line;return!((U=A.properties)===null||U===void 0)&&U.isActive&&q?qt(q.properties.nodes.map(function(re){return re.geometry.coordinates}),s).filter(function(re){return re.length>1}).map(function(re){return tl(re)}):[q]}).flat().filter(function(A){return A}),S.length||l.forEach(function(A){var I=Nu(A);if(/linestring/i.test(I)&&S.push(A),/polygon/i.test(I)){var U,q,re=wc(A);return(U=S).push.apply(U,Su((q=re==null?void 0:re.features)!==null&&q!==void 0?q:[re]))}})),{points:p,lines:S}},en=function(L,i,s,l){var p=s.pointAdsorbPixel,S=os(L,2),A=l.lngLatToPixel([S[0],S[1]]),I=A.x,U=A.y,q=i.map(function(de){var we=os(de.geometry.coordinates,2),Oe=l.lngLatToPixel([we[0],we[1]]),Ge=Oe.y;return Math.pow(I-Oe.x,2)+Math.pow(U-Ge,2)}),re=rp(q);return Math.pow(q[re],.5)>p?null:i[re].geometry.coordinates},ua=function(L,i,s,l){var p=s.lineAdsorbPixel,S=os(L,2),A=l.lngLatToPixel([S[0],S[1]]),I=A.x,U=A.y,q=i.filter(function(we){return hl(we).length>1}).map(function(we){return function(Oe,Ge,it){it===void 0&&(it={});var tt=Vs([1/0,1/0],{dist:1/0}),ct=0;return _h(Oe,function(ut){for(var Je=fp(ut),Pt=0;Je.length-1>Pt;Pt++){var Xt=Vs(Je[Pt]);Xt.properties.dist=Kl(Ge,Xt,it);var pr=Vs(Je[Pt+1]);pr.properties.dist=Kl(Ge,pr,it);var Ur=Kl(Xt,pr,it),tn=Math.max(Xt.properties.dist,pr.properties.dist),An=Ms(Xt,pr),xi=Rl(Ge,tn,An+90,it),On=Rl(Ge,tn,An-90,it),si=ld(tl([xi.geometry.coordinates,On.geometry.coordinates]),tl([Xt.geometry.coordinates,pr.geometry.coordinates])),kn=null;si.features.length>0&&((kn=si.features[0]).properties.dist=Kl(Ge,kn,it),kn.properties.location=ct+Kl(Xt,kn,it)),tt.properties.dist>Xt.properties.dist&&((tt=Xt).properties.index=Pt,tt.properties.location=ct),tt.properties.dist>pr.properties.dist&&((tt=pr).properties.index=Pt+1,tt.properties.location=ct+Ur),kn&&tt.properties.dist>kn.properties.dist&&((tt=kn).properties.index=Pt),ct+=Ur}}),tt}(we,L)});if(!q.length)return null;var re=q.map(function(we){var Oe=os(we.geometry.coordinates,2),Ge=l.lngLatToPixel([Oe[0],Oe[1]]),it=Ge.y;return Math.pow(I-Ge.x,2)+Math.pow(U-it,2)}),de=rp(re);return Math.pow(re[de],.5)>p?null:q[de].geometry.coordinates},ls=function(L,i){var s=os(i,2),l=s[0],p=s[1];L.lngLat&&(L.lngLat={lng:l,lat:p}),L.lnglat&&(L.lnglat={lng:l,lat:p})},Nt=function(){function L(i,s){Xa(this,L),this.container=void 0,this.cursor=null,this.options=void 0,this.container=Ts(i),this.options=s}return Jo(L,[{key:"setCursor",value:function(i){i!==this.cursor&&this.container&&(this.container.style.cursor=i?this.options[i]:"",this.cursor=i)}},{key:"destroy",value:function(){this.setCursor(null)}}]),L}();function Et(L,i){i===void 0&&(i={});var s=i.insertAt;if(L&&typeof document!="undefined"){var l=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css",s==="top"&&l.firstChild?l.insertBefore(p,l.firstChild):l.appendChild(p),p.styleSheet?p.styleSheet.cssText=L:p.appendChild(document.createTextNode(L))}}Et('.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}'),Et(".tippy-box[data-theme~=light]{color:#26323d;box-shadow:0 0 20px 4px rgba(154,161,177,.15),0 4px 80px -8px rgba(36,40,47,.25),0 4px 4px -2px rgba(91,94,105,.15);background-color:#fff}.tippy-box[data-theme~=light][data-placement^=top]>.tippy-arrow:before{border-top-color:#fff}.tippy-box[data-theme~=light][data-placement^=bottom]>.tippy-arrow:before{border-bottom-color:#fff}.tippy-box[data-theme~=light][data-placement^=left]>.tippy-arrow:before{border-left-color:#fff}.tippy-box[data-theme~=light][data-placement^=right]>.tippy-arrow:before{border-right-color:#fff}.tippy-box[data-theme~=light]>.tippy-backdrop{background-color:#fff}.tippy-box[data-theme~=light]>.tippy-svg-arrow{fill:#fff}");var gr=function(){function L(i,s){var l=this;Xa(this,L),this.content="",this.tippy=void 0,this.scene=void 0,this.isMouseInner=!1,this.onMouseMove=function(){l.isMouseInner=!0,l.checkTippyShow()},this.onMouseOut=function(){l.isMouseInner=!1,l.checkTippyShow()},this.setContent=Cc(function(p){l.content=p!=null?p:"",l.tippy.setContent(p!=null?p:""),l.checkTippyShow()},16,{maxWait:16}),this.tippy=bo(Ts(i),kr(kr({},Ut),s)),this.tippy.hide(),this.scene=i,i.on(K.SceneEvent.Mousemove,this.onMouseMove),i.on(K.SceneEvent.Mouseout,this.onMouseOut)}return Jo(L,[{key:"getContent",value:function(){return this.content}},{key:"checkTippyShow",value:function(){this.content&&this.isMouseInner?this.tippy.show():this.tippy.hide()}},{key:"destroy",value:function(){this.scene.off(K.SceneEvent.Mousemove,this.onMouseMove),this.scene.off(K.SceneEvent.Mouseout,this.onMouseOut),this.tippy.destroy()}}]),L}(),Vr=function(){function L(i){var s=i.config;Xa(this,L),this.historyList=[],this.historyIndex=0,this.config=void 0,this.config=s}return Jo(L,[{key:"save",value:function(i){if(this.config){var s=this.config.maxSize;this.historyIndex&&(this.historyList=this.historyList.slice(this.historyIndex),this.historyIndex=0),s>this.historyList.length||this.historyList.pop();var l=al(i);return this.historyList.unshift(l),l}}},{key:"revert",value:function(){if(this.historyList.length&&this.historyList.length-1>this.historyIndex){var i=this.historyList[++this.historyIndex];return i?al(i):void 0}}},{key:"redo",value:function(){if(this.historyList.length&&this.historyIndex>0){var i=this.historyList[--this.historyIndex];return i?al(i):void 0}}}]),L}(),$r=function(L){ou(s,L);var i=su(s);function s(l){var p,S=l.data,A=l.render,I=l.history,U=l.scene;return Xa(this,s),(p=i.call(this)).scene=void 0,p.render=void 0,p.data=al(M),p.timeout=null,p.diffData={},p.history=void 0,p.scene=U,p.render=A,I&&(p.history=new Vr({config:I})),S&&p.setData(S),p}return Jo(s,[{key:"saveHistory",value:function(){var l;return(l=this.history)===null||l===void 0?void 0:l.save(this.data)}},{key:"revertHistory",value:function(){var l,p=(l=this.history)===null||l===void 0?void 0:l.revert();if(p)return this.setData(p),p}},{key:"redoHistory",value:function(){var l,p=(l=this.history)===null||l===void 0?void 0:l.redo();if(p)return this.setData(p),p}},{key:"setData",value:function(l){var p=this;return Object.keys(l).length&&(this.data=kr(kr({},this.data),l),this.diffData=kr(kr({},this.diffData),l),this.timeout||(this.timeout=requestAnimationFrame(function(){return p.updateDiffData()})),this.emit(K.SourceEvent.Change,{data:this.data})),this.data}},{key:"getData",value:function(){return this.data}},{key:"getRenderData",value:function(l){return this.data[l]}},{key:"setRenderData",value:function(l,p){var S=typeof p=="function"?p(this.getRenderData(l)):p;return this.setData(au({},l,S)),this.emit(K.SourceEvent.Change,this.data),S}},{key:"updateDiffData",value:function(){var l=this,p=Object.entries(this.diffData);p.length&&(p.forEach(function(S){var A,I=os(S,2),U=I[0],q=I[1];Array.isArray(q)&&((A=l.getRender(U))===null||A===void 0||A.setData(q))}),this.emit(K.SourceEvent.Update,this.data,this.diffData),this.diffData={},this.timeout=null,requestAnimationFrame(function(){l.scene.render()}))}},{key:"getRender",value:function(l){return this.render[l]}},{key:"clear",value:function(){this.setData(Xv(Object.keys(this.render).map(function(l){return[l,[]]})))}}]),s}(Mf),wr=function(L){ou(s,L);var i=su(s);function s(l,p){var S;Xa(this,s),(S=i.call(this)).scene=void 0,S.source=void 0,S.render=void 0,S.cursor=void 0,S.options=void 0,S.enabled=!1,S.allowCreate=!1,S.sceneRender=void 0,S.mouseLngLat={lng:0,lat:0},S.popup=void 0,S.addCount=0,S.saveMouseLngLat=Cc(function(q){S.mouseLngLat=us(q)},100,{maxWait:100}),S.saveHistory=Cc(function(){S.options.history&&S.source.saveHistory()},100),S.bindThis(),S.scene=l,S.sceneRender=new mr(l),S.options=so({},S.getDefaultOptions(p),p),S.render=S.initRender(),S.source=new $r({render:S.render,history:S.options.history||void 0,scene:l}),S.cursor=new Nt(l,S.options.cursor);var A=S.options,I=A.initialData,U=A.popup;return I&&S.setData(I),U&&(S.popup=new gr(l,U instanceof Object?U:{})),S.saveHistory(),S.bindCommonEvent(),S.emit(K.DrawEvent.Init,th(S)),S.bindEnableEvent(),s.instances.push(th(S)),S}return Jo(s,[{key:"addable",get:function(){var l=this.getData(),p=this.options,S=p.multiple,A=p.maxCount,I=l.find(function(U){return U.properties.isDraw});return!(!this.enabled||!this.allowCreate)&&(!!(S&&0>=A||I)||!(!S&&this.addCount>=1)&&(0>=A||A>l.length))}},{key:"getOptions",value:function(){return this.options}},{key:"getEditItem",value:function(){return this.editItem}},{key:"getDragItem",value:function(){return this.dragItem}},{key:"setHelper",value:function(l){var p,S,A=this.options.helper;if(A){var I=(p=l in A?A[l]:l)!==null&&p!==void 0?p:null;(S=this.popup)===null||S===void 0||S.setContent(I)}}},{key:"isEnable",value:function(){return this.enabled}},{key:"bindThis",value:function(){this.initRender=this.initRender.bind(this),this.getData=this.getData.bind(this),this.setData=this.setData.bind(this),this.emitChangeEvent=this.emitChangeEvent.bind(this),this.saveHistory=this.saveHistory.bind(this),this.onSceneMouseMove=this.onSceneMouseMove.bind(this),this.revertHistory=this.revertHistory.bind(this),this.redoHistory=this.redoHistory.bind(this),this.removeActiveFeature=this.removeActiveFeature.bind(this),this.bindCommonEvent=this.bindCommonEvent.bind(this),this.bindEnableEvent=this.bindEnableEvent.bind(this),this.unbindEnableEvent=this.unbindEnableEvent.bind(this),this.setActiveFeature=this.setActiveFeature.bind(this)}},{key:"bindCommonEvent",value:function(){var l=this;this.on(K.DrawEvent.Add,this.emitChangeEvent),this.on(K.DrawEvent.Add,function(){l.addCount++}),this.on(K.DrawEvent.Edit,this.emitChangeEvent),this.on(K.DrawEvent.Remove,this.emitChangeEvent),this.on(K.DrawEvent.Clear,this.emitChangeEvent),this.on(K.DrawEvent.AddNode,this.saveHistory),this.on(K.DrawEvent.RemoveNode,this.emitChangeEvent),this.bindEmitSelectEvent(!0)}},{key:"bindEmitSelectEvent",value:function(){var l=this,p=arguments.length>0&&arguments[0]!==void 0&&arguments[0],S=null,A=function(){var I,U,q,re=l.getData().find(function(de){var we;return(we=de.properties)===null||we===void 0?void 0:we.isActive})||null;((I=S)===null||I===void 0||(U=I.properties)===null||U===void 0?void 0:U.id)!==(re==null||(q=re.properties)===null||q===void 0?void 0:q.id)&&(S=re,l.emit(K.DrawEvent.Select,re))};this.source.on(K.SourceEvent.Change,A),p&&A()}},{key:"bindEnableEvent",value:function(){this.unbindKeyboardEvent(),this.scene.setMapStatus({doubleClickZoom:!1}),this.scene.on(K.SceneEvent.Mousemove,this.saveMouseLngLat),this.bindKeyboardEvent()}},{key:"unbindEnableEvent",value:function(){this.scene.setMapStatus({doubleClickZoom:!0}),this.scene.off(K.SceneEvent.Mousemove,this.saveMouseLngLat),this.unbindKeyboardEvent()}},{key:"bindKeyboardEvent",value:function(){var l=this,p=this.options.keyboard||{},S=p.revert,A=p.redo,I=p.remove;I&&Fs.bind(I,function(){l.removeActiveFeature()}),this.options.history&&(S&&Fs.bind(S,this.revertHistory),A&&Fs.bind(A,this.redoHistory))}},{key:"unbindKeyboardEvent",value:function(){var l=this.options.keyboard||{},p=l.revert,S=l.redo,A=l.remove;A&&Fs.unbind(A),this.options.history&&(p&&Fs.unbind(p),S&&Fs.unbind(S))}},{key:"emitChangeEvent",value:function(){this.emit(K.DrawEvent.Change,this.getData()),this.saveHistory()}},{key:"revertHistory",value:function(){this.enabled&&this.options.history&&this.source.revertHistory()&&(this.correctDrawItem(),this.emit(K.DrawEvent.Change,this.getData()))}},{key:"redoHistory",value:function(){this.enabled&&this.options.history&&this.source.redoHistory()&&(this.correctDrawItem(),this.emit(K.DrawEvent.Change,this.getData()))}},{key:"getRenderLayers",value:function(){return Xv(Go(this.render).map(function(l){var p=os(l,2);return[p[0],p[1].getLayers()]}))}},{key:"getTargetFeature",value:function(l){var p,S,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getData(),I=null;return l&&(I=(p=A.find(function(U){var q;return U.properties.id===(typeof l=="string"?l:(q=l.properties)===null||q===void 0?void 0:q.id)}))!==null&&p!==void 0?p:null,!I&&l instanceof Object&&(I=(S=A.find(function(U){return Zn(l.geometry,U.geometry)}))!==null&&S!==void 0?S:null)),I}},{key:"removeActiveFeature",value:function(){var l=this.getData().find(function(p){var S=p.properties;return S.isActive||S.isDraw});return l&&this.removeFeature(l),l}},{key:"removeFeature",value:function(l){var p=this.getData(),S=this.getTargetFeature(l);S&&(this.setData(p.filter(function(A){return!ss(S,A)})),this.emit(K.DrawEvent.Remove,l,this.getData()))}},{key:"correctDrawItem",value:function(){this.getData().find(function(l){return l.properties.isDraw})&&this.onSceneMouseMove({type:"mousemove",lnglat:this.mouseLngLat,lngLat:this.mouseLngLat})}},{key:"initRender",value:function(){var l,p={},S=function(I,U){var q=typeof Symbol!="undefined"&&I[Symbol.iterator]||I["@@iterator"];if(!q){if(Array.isArray(I)||(q=Eh(I))||U&&I&&typeof I.length=="number"){q&&(I=q);var re=0,de=function(){};return{s:de,n:function(){return I.length>re?{done:!1,value:I[re++]}:{done:!0}},e:function(it){throw it},f:de}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var we,Oe=!0,Ge=!1;return{s:function(){q=q.call(I)},n:function(){var it=q.next();return Oe=it.done,it},e:function(it){Ge=!0,we=it},f:function(){try{Oe||q.return==null||q.return()}finally{if(Ge)throw we}}}}(this.getRenderTypes());try{for(S.s();!(l=S.n()).done;){var A=l.value;p[A]=new h[A](this.scene,{style:this.options.style[A]})}}catch(I){S.e(I)}finally{S.f()}return p}},{key:"getCommonOptions",value:function(l){return{initialData:[],autoActive:!0,cursor:al(P),editable:!0,style:al(w),multiple:!0,history:al(iu),keyboard:al(_t),popup:!0,helper:{},maxCount:-1}}},{key:"setCursor",value:function(l){this.cursor.setCursor(l)}},{key:"resetCursor",value:function(){this.setCursor(this.addable?"draw":null)}},{key:"enable",value:function(){var l=this;this.allowCreate=0>=arguments.length||arguments[0]===void 0||arguments[0],this.addCount=0,this.enabled=!0,this.bindEnableEvent(),this.resetCursor(),this.setHelper(this.addable?"draw":null),setTimeout(function(){l.emit(K.DrawEvent.Enable,l)},0)}},{key:"disable",value:function(){var l=this;this.resetFeatures(),this.enabled=!1,this.setCursor(null),this.unbindEnableEvent(),this.addCount=0,this.setHelper(null),setTimeout(function(){l.emit(K.DrawEvent.Disable,l)},0)}},{key:"clear",value:function(){var l=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.source.clear(),this.emit(K.DrawEvent.Clear,this),l&&this.disable()}},{key:"show",value:function(){return Object.values(this.render).forEach(function(l){l.show()})}},{key:"hide",value:function(){return Object.values(this.render).forEach(function(l){l.hide()})}},{key:"destroy",value:function(){var l,p=this;Object.values(this.render).forEach(function(A){A.destroy()}),Object.values(K.RenderEvent).forEach(function(A){Object.values(p.render).forEach(function(I){I.removeAllListeners(A)}),p.sceneRender.removeAllListeners(A)}),setTimeout(function(){Object.values(K.DrawEvent).forEach(function(A){p.removeAllListeners(A)})},0),(l=this.popup)===null||l===void 0||l.destroy(),this.cursor.destroy(),this.emit(K.DrawEvent.Destroy,this);var S=s.instances.indexOf(this);S>-1&&s.instances.splice(S,1)}}]),s}(Mf);wr.instances=[];var ur=function(L){var i=L==null?0:L.length;return i?L[i-1]:void 0},Lr=function(L){ou(s,L);var i=su(s);function s(){return Xa(this,s),i.apply(this,arguments)}return Jo(s,[{key:"pointRender",get:function(){return this.render.point}},{key:"dragPoint",get:function(){return this.getPointData().find(function(l){return l.properties.isDrag})}},{key:"editPoint",get:function(){return this.getPointData().find(function(l){return l.properties.isActive})}},{key:"hoverPoint",get:function(){return this.getPointData().find(function(l){return l.properties.isHover})}},{key:"getDragPoint",value:function(){return this.dragPoint}},{key:"getEditPoint",value:function(){return this.editPoint}},{key:"getPointData",value:function(){return this.source.getRenderData("point")}},{key:"setPointData",value:function(l){return this.source.setRenderData("point",l)}},{key:"bindPointRenderEvent",value:function(){var l,p,S,A,I,U;(l=this.pointRender)===null||l===void 0||l.on(K.RenderEvent.UnClick,this.onPointCreate.bind(this)),(p=this.pointRender)===null||p===void 0||p.on(K.RenderEvent.Mousemove,this.onPointMouseMove.bind(this)),(S=this.pointRender)===null||S===void 0||S.on(K.RenderEvent.Mouseout,this.onPointMouseOut.bind(this)),(A=this.pointRender)===null||A===void 0||A.on(K.RenderEvent.Dragstart,this.onPointDragStart.bind(this)),(I=this.pointRender)===null||I===void 0||I.on(K.RenderEvent.Dragging,this.onPointDragging.bind(this)),(U=this.pointRender)===null||U===void 0||U.on(K.RenderEvent.Dragend,this.onPointDragEnd.bind(this))}},{key:"handleCreatePoint",value:function(l){var p=this.options,S=p.autoActive,A=p.editable,I=bu(l);return this.setPointData(function(U){return As({target:I,data:[].concat(Su(U),[I]),targetHandler:function(q){q.properties=kr(kr({},q.properties),{},{isHover:A,isActive:S&&A})},otherHandler:function(q){q.properties=kr(kr({},q.properties),{},{isHover:!1,isActive:!1,isDrag:!1})}})}),I}},{key:"handlePointHover",value:function(l){return this.setCursor("pointHover"),ss(l,this.hoverPoint)||this.setPointData(function(p){return As({target:l,data:p,targetHandler:function(S){S.properties.isHover=!0},otherHandler:function(S){S.properties.isHover=!1}})}),l}},{key:"handlePointUnHover",value:function(l){return this.resetCursor(),this.setPointData(function(p){return p.map(function(S){return S.properties.isHover=!1,S})}),l}},{key:"handlePointDragStart",value:function(l){return this.setPointData(function(p){return As({target:l,data:p,targetHandler:function(S){S.properties=kr(kr({},S.properties),{},{isDrag:!0,isActive:!0})},otherHandler:function(S){S.properties=kr(kr({},S.properties),{},{isDrag:!1,isActive:!1})}})}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),l}},{key:"handlePointDragging",value:function(l,p){return this.setPointData(function(S){return As({target:l,data:S,targetHandler:function(A){A.geometry.coordinates=zh(p)}})}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),l}},{key:"handlePointDragEnd",value:function(l){return this.setPointData(function(p){return As({target:l,data:p,targetHandler:function(S){S.properties.isDrag=!1}})}),this.scene.setMapStatus({dragEnable:!0}),this.setCursor("pointHover"),l}},{key:"onPointCreate",value:function(l){return this.handleCreatePoint(zh(us(l)))}},{key:"onPointMouseMove",value:function(l){return this.handlePointHover(l.feature)}},{key:"onPointMouseOut",value:function(l){return this.handlePointUnHover(l.feature)}},{key:"onPointDragStart",value:function(l){if(this.options.editable)return this.handlePointDragStart(l.feature)}},{key:"onPointDragging",value:function(l){var p=this.dragPoint;if(this.options.editable&&p)return this.handlePointDragging(p,us(l))}},{key:"onPointDragEnd",value:function(l){var p=this.dragPoint;if(this.options.editable&&p)return this.handlePointDragEnd(p)}},{key:"enablePointRenderAction",value:function(){var l,p,S,A,I=this.options.editable;this.enabled&&((p=this.pointRender)===null||p===void 0||p.enableCreate()),(l=this.pointRender)===null||l===void 0||l.enableClick(),I&&((S=this.pointRender)===null||S===void 0||S.enableHover(),(A=this.pointRender)===null||A===void 0||A.enableDrag())}},{key:"disablePointRenderAction",value:function(){var l,p,S,A;(l=this.pointRender)===null||l===void 0||l.disableCreate(),(p=this.pointRender)===null||p===void 0||p.disableHover(),(S=this.pointRender)===null||S===void 0||S.disableDrag(),(A=this.pointRender)===null||A===void 0||A.disableClick()}}]),s}(wr),Zt=function(L){ou(s,L);var i=su(s);function s(){return Xa(this,s),i.apply(this,arguments)}return Jo(s,[{key:"midPointRender",get:function(){return this.render.midPoint}},{key:"getCommonOptions",value:function(l){return kr(kr({},_a(Ra(s.prototype),"getCommonOptions",this).call(this,l)),{},{showMidPoint:!0})}},{key:"bindMidPointRenderEvent",value:function(){var l,p,S;(l=this.midPointRender)===null||l===void 0||l.on(K.RenderEvent.Click,this.onMidPointClick.bind(this)),(p=this.midPointRender)===null||p===void 0||p.on(K.RenderEvent.Mousemove,this.onMidPointHover.bind(this)),(S=this.midPointRender)===null||S===void 0||S.on(K.RenderEvent.Mouseout,this.onMidPointUnHover.bind(this))}},{key:"getMidPointData",value:function(){return this.source.getRenderData("midPoint")}},{key:"setMidPointData",value:function(l){return this.source.setRenderData("midPoint",l)}},{key:"getMidPointsByLine",value:function(l){var p=l.properties.nodes;if(!this.options.showMidPoint||2>p.length)return[];for(var S=[],A=0;p.length-1>A;A++){var I,U,q,re,de=Hh(vu([p[A],p[A+1]]),{properties:{id:Ho("midPoint"),startId:(I=(U=p[A].properties)===null||U===void 0?void 0:U.id)!==null&&I!==void 0?I:"",endId:(q=(re=p[A+1].properties)===null||re===void 0?void 0:re.id)!==null&&q!==void 0?q:""}});S.push(de)}return S}},{key:"onMidPointHover",value:function(l){this.setCursor("pointHover")}},{key:"onMidPointUnHover",value:function(l){this.resetCursor()}},{key:"enableMidPointRenderAction",value:function(){var l,p;(l=this.midPointRender)===null||l===void 0||l.enableClick(),(p=this.midPointRender)===null||p===void 0||p.enableHover()}},{key:"disableMidPointRenderAction",value:function(){var l,p;(l=this.midPointRender)===null||l===void 0||l.disableClick(),(p=this.midPointRender)===null||p===void 0||p.disableHover()}}]),s}(Lr),lr={draw:"\u5355\u51FB\u7ED8\u5236\u70B9",pointHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u70B9\u4F4D\u7F6E",pointDrag:null},It={draw:"\u5355\u51FB\u7ED8\u5236\u9996\u4E2A\u8282\u70B9",pointHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u8282\u70B9\u4F4D\u7F6E",pointDrag:null,lineHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u7EBF\u4F4D\u7F6E",lineDrag:null,midPointHover:"\u5355\u51FB\u5728\u8BE5\u4F4D\u7F6E\u65B0\u589E\u8282\u70B9",drawFinish:"\u5355\u51FB\u7EE7\u7EED\u7ED8\u5236\uFF0C\u53CC\u51FB\u7ED3\u675F\u7ED8\u5236"},Zr={draw:"\u5355\u51FB\u7ED8\u5236\u9996\u4E2A\u8282\u70B9",drawContinue:"\u5355\u51FB\u7EE7\u7EED\u7ED8\u5236",drawFinish:"\u5355\u51FB\u7EE7\u7EED\u7ED8\u5236\uFF0C\u53CC\u51FB\u7ED3\u675F\u7ED8\u5236",midPointHover:"\u5355\u51FB\u5728\u8BE5\u4F4D\u7F6E\u65B0\u589E\u8282\u70B9",pointHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u8282\u70B9\u4F4D\u7F6E",pointDrag:null,lineHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u9762\u4F4D\u7F6E",lineDrag:null,polygonHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u9762\u4F4D\u7F6E",polygonDrag:null},Xr=kr(kr({},Zr),{},{draw:"\u5355\u51FB\u7ED8\u5236\u9996\u4E2A\u8282\u70B9",drawFinish:"\u5355\u51FB\u7ED3\u675F\u7ED8\u5236"}),Rn={draw:"\u62D6\u62FD\u5F00\u59CB\u7ED8\u5236",drawFinish:"\u677E\u5F00\u9F20\u6807\u7ED3\u675F\u7ED8\u5236"},dn={lineHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u77E9\u5F62\u4F4D\u7F6E",polygonHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u77E9\u5F62\u4F4D\u7F6E"},Pn={lineHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u5706\u4F4D\u7F6E",polygonHover:"\u53EF\u62D6\u62FD\u8C03\u6574\u5706\u4F4D\u7F6E"},vi=function(L){ou(s,L);var i=su(s);function s(){var l;Xa(this,s);for(var p=arguments.length,S=Array(p),A=0;p>A;A++)S[A]=arguments[A];return(l=i.call.apply(i,[this].concat(S))).previousPosition=[0,0],l}return Jo(s,[{key:"lineRender",get:function(){return this.render.line}},{key:"dragLine",get:function(){return this.getLineData().find(function(l){return l.properties.isDrag})}},{key:"drawLine",get:function(){return this.getLineData().find(function(l){return l.properties.isDraw})}},{key:"editLine",get:function(){return this.getLineData().find(function(l){var p=l.properties;return!p.isDraw&&p.isActive})}},{key:"hoverLine",get:function(){return this.getLineData().find(function(l){return l.properties.isHover})}},{key:"getDragLine",value:function(){return this.dragLine}},{key:"getDrawLine",value:function(){return this.drawLine}},{key:"getEditLine",value:function(){return this.editLine}},{key:"getDefaultOptions",value:function(l){var p=kr(kr({},this.getCommonOptions(l)),{},{showMidPoint:!0,distanceOptions:!1,helper:al(It)});return l.distanceOptions&&(p.distanceOptions=kr(kr({},zu),p.distanceOptions)),l.adsorbOptions&&(p.adsorbOptions=kr(kr({},Er),p.adsorbOptions)),p}},{key:"getAdsorbPosition",value:function(l){var p=this.options.adsorbOptions;if(typeof p=="boolean")return l;var S=this.scene,A=p.pointAdsorbPixel,I=p.lineAdsorbPixel,U=null,q=pn(p.data,this,l),re=q.points,de=q.lines;return re.length&&A>0&&(U=en(l,re,p,S)),!U&&de.length&&I>0&&(U=ua(l,de,p,S)),U}},{key:"bindSceneEvent",value:function(){this.sceneRender.on(K.RenderEvent.Mousemove,this.onSceneMouseMove.bind(this))}},{key:"bindPointRenderEvent",value:function(){var l;_a(Ra(s.prototype),"bindPointRenderEvent",this).call(this),(l=this.pointRender)===null||l===void 0||l.on(K.RenderEvent.Click,this.onPointClick.bind(this))}},{key:"bindLineRenderEvent",value:function(){var l,p,S,A,I,U;(l=this.lineRender)===null||l===void 0||l.on(K.RenderEvent.UnClick,this.onLineUnClick.bind(this)),(p=this.lineRender)===null||p===void 0||p.on(K.RenderEvent.Mousemove,this.onLineMouseMove.bind(this)),(S=this.lineRender)===null||S===void 0||S.on(K.RenderEvent.Mouseout,this.onLineMouseOut.bind(this)),(A=this.lineRender)===null||A===void 0||A.on(K.RenderEvent.Dragstart,this.onLineDragStart.bind(this)),(I=this.lineRender)===null||I===void 0||I.on(K.RenderEvent.Dragging,this.onLineDragging.bind(this)),(U=this.lineRender)===null||U===void 0||U.on(K.RenderEvent.Dragend,this.onLineDragEnd.bind(this))}},{key:"getDashLineDistanceTexts",value:function(l,p){var S=p.showTotalDistance,A=p.format;return p.showDashDistance?l.map(function(I){return lu(I,{showTotalDistance:S,format:A},{isActive:!0,type:"dash"})}).flat():[]}},{key:"getLineDistanceTexts",value:function(l,p){var S=p.showTotalDistance,A=p.format,I=p.showWhen,U=[];if(I.includes("active")){var q=l.filter(function(de){return de.properties.isActive&&de.properties.nodes.length>1});U.push.apply(U,Su(q.map(function(de){return lu(de,{showTotalDistance:S,format:A},{isActive:!0})}).flat()))}if(I.includes("normal")){var re=l.filter(function(de){return!de.properties.isActive&&de.properties.nodes.length>1});U.push.apply(U,Su(re.map(function(de){return lu(de,{showTotalDistance:S,format:A})}).flat()))}return U}},{key:"getDistanceTexts",value:function(){var l=this.options.distanceOptions;if(!l)return[];var p=[],S=l.showWhen,A=l.showDashDistance,I=l.format,U=l.showTotalDistance;return p.push.apply(p,Su(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!1,format:I,showDashDistance:A})).concat(Su(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:U,format:I,showWhen:S})))),p}},{key:"getAllTexts",value:function(){return this.getDistanceTexts()}},{key:"handleCreateLine",value:function(l){var p=Hu([l],{isActive:!0,isDraw:!0});return this.setLineData(function(S){return As({target:p,data:[].concat(Su(S),[p]),otherHandler:function(A){A.properties.isActive=!1}})}),this.setPointData([l]),this.setTextData(this.getAllTexts()),p}},{key:"syncLineNodes",value:function(l,p){return l.properties.nodes=p,l.geometry.coordinates=hl(vu(p)),this.setLineData(function(S){return S.map(function(A){return ss(A,l)?l:A})}),ss(this.editLine,l)&&this.setMidPointData(this.getMidPointsByLine(l)),this.setPointData(l.properties.nodes),this.setTextData(this.getAllTexts()),l}},{key:"setActiveLine",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setLineData(function(S){return As({target:l,data:S,targetHandler:function(A){A.properties=kr(kr({},A.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},p)},otherHandler:function(A){A.properties=kr(kr({},A.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})}),this.setPointData(l.properties.nodes.map(function(S){return S.properties=kr(kr({},S.properties),{},{isHover:!1,isActive:!1}),S})),this.setMidPointData(this.getMidPointsByLine(l)),this.setDashLineData([]),this.setTextData(this.getAllTexts()),l}},{key:"clearActiveLine",value:function(){this.source.setData({point:[],line:this.getLineData().map(function(l){return l.properties=kr(kr({},l.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),l}),midPoint:[],text:this.getAllTexts()})}},{key:"handleLineUnClick",value:function(l){return this.clearActiveLine(),l}},{key:"handleLineHover",value:function(l){if(!this.drawLine)return this.setCursor("lineHover"),ss(l,this.hoverLine)||this.setLineData(function(p){return As({target:l,data:p,targetHandler:function(S){S.properties.isHover=!0},otherHandler:function(S){S.properties.isHover=!1}})}),l}},{key:"handleLineUnHover",value:function(l){if(!this.drawLine)return this.resetCursor(),this.setLineData(function(p){return p.map(function(S){return S.properties.isHover=!1,S})}),l}},{key:"handleLineDragStart",value:function(l){return this.setActiveLine(l,{isDrag:!0,isActive:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("lineDrag"),l}},{key:"handleLineDragging",value:function(l,p){var S=p.lng,A=p.lat,I=l.properties.nodes,U=os(this.previousPosition,2),q=U[0],re=U[1];return I.forEach(function(de){var we=de.geometry.coordinates;de.geometry.coordinates=[we[0]+S-q,we[1]+A-re]}),this.syncLineNodes(l,I),this.setActiveLine(l,{isDrag:!0}),this.setCursor("lineDrag"),this.previousPosition=[S,A],l}},{key:"handleLineDragEnd",value:function(l){return l.properties.isDrag=!1,this.setLineData(function(p){return p}),this.scene.setMapStatus({dragEnable:!0}),l}},{key:"resetAdsorbLngLat",value:function(l){if(this.options.adsorbOptions){var p=this.getAdsorbPosition(zh(us(l)));return p&&ls(l,p),p}}},{key:"onPointCreate",value:function(l){if(!this.editLine){this.resetAdsorbLngLat(l);var p=_a(Ra(s.prototype),"onPointCreate",this).call(this,l),S=this.drawLine;if(p)return S?(this.syncLineNodes(S,[].concat(Su(S.properties.nodes),[p])),this.setDashLineData([])):this.handleCreateLine(p),p}}},{key:"onPointDragStart",value:function(l){if(this.editLine)return this.setHelper("pointDrag"),_a(Ra(s.prototype),"onPointDragStart",this).call(this,l)}},{key:"onPointDragging",value:function(l){var p=_a(Ra(s.prototype),"onPointDragging",this).call(this,l);if(p){var S=this.resetAdsorbLngLat(l);S&&(p.geometry.coordinates=al(S))}var A=this.editLine;return A&&p&&(this.syncLineNodes(A,A.properties.nodes.map(function(I){return ss(p,I)?p:I})),this.setActiveLine(A)),p}},{key:"onPointDragEnd",value:function(l){if(this.editLine){var p=_a(Ra(s.prototype),"onPointDragEnd",this).call(this,l);return this.setPointData(function(S){return S.map(function(A){return A.properties.isActive=!1,A})}),this.setHelper("pointHover"),p}}},{key:"onLineUnClick",value:function(l){var p=this.editLine;if(p)return this.handleLineUnClick(p)}},{key:"onLineMouseMove",value:function(l){if(!this.drawLine)return this.dragLine||this.drawLine||!this.options.editable||this.setHelper("lineHover"),this.handleLineHover(l.feature)}},{key:"onLineMouseOut",value:function(l){if(!this.drawLine)return this.dragLine||this.drawLine||this.setHelper(this.addable?"draw":null),this.handleLineUnHover(l.feature)}},{key:"onLineDragStart",value:function(l){if(this.options.editable&&!this.drawLine)return this.previousPosition=Iu(l),this.setHelper("lineDrag"),this.handleLineDragStart(l.feature)}},{key:"onLineDragging",value:function(l){var p=this.dragLine;if(p)return this.handleLineDragging(p,us(l))}},{key:"onLineDragEnd",value:function(l){var p=this.dragLine;if(p)return this.setHelper("lineHover"),this.handleLineDragEnd(p)}},{key:"onPointMouseMove",value:function(l){var p=_a(Ra(s.prototype),"onPointMouseMove",this).call(this,l);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper("pointHover"),p}},{key:"onPointMouseOut",value:function(l){var p=_a(Ra(s.prototype),"onPointMouseOut",this).call(this,l);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper(this.addable?"draw":null),p}},{key:"onMidPointHover",value:function(l){_a(Ra(s.prototype),"onMidPointHover",this).call(this,l),this.setHelper("midPointHover")}},{key:"onMidPointUnHover",value:function(l){_a(Ra(s.prototype),"onMidPointUnHover",this).call(this,l),this.setHelper(null)}},{key:"onPointClick",value:function(l){}},{key:"getLineData",value:function(){return this.source.getRenderData("line")}},{key:"setLineData",value:function(l){return this.source.setRenderData("line",l)}},{key:"getTextData",value:function(){return this.source.getRenderData("text")}},{key:"setTextData",value:function(l){return this.source.setRenderData("text",l)}},{key:"getDashLineData",value:function(){return this.source.getRenderData("dashLine")}},{key:"setDashLineData",value:function(l){return this.source.setRenderData("dashLine",l)}},{key:"onMidPointClick",value:function(l){var p=this.editLine,S=l.feature;if(p&&S&&!this.dragPoint){var A=p.properties.nodes,I=S.properties,U=I.startId,q=I.endId,re=A.findIndex(function(Oe){return Oe.properties.id===U}),de=A.findIndex(function(Oe){return Oe.properties.id===q});if(re>-1&&de>-1){var we=bu(S.geometry.coordinates,{isDrag:!0,isHover:!0});return this.setHelper("pointDrag"),A.splice(de,0,we),p.geometry.coordinates=hl(vu(A)),this.syncLineNodes(p,A),this.setActiveLine(p),we}}}},{key:"enableSceneRenderAction",value:function(){this.sceneRender.enableDrag(),this.sceneRender.enableMouseMove(),this.sceneRender.enableDblClick()}},{key:"disableSceneRenderAction",value:function(){this.sceneRender.disableDrag(),this.sceneRender.disableMouseMove(),this.sceneRender.disableDblClick()}},{key:"enableLineRenderAction",value:function(){var l,p,S,A=this.options.editable;(l=this.lineRender)===null||l===void 0||l.enableUnClick(),A&&((p=this.lineRender)===null||p===void 0||p.enableHover(),(S=this.lineRender)===null||S===void 0||S.enableDrag())}},{key:"disableLineRenderAction",value:function(){var l,p,S;(l=this.lineRender)===null||l===void 0||l.disableUnClick(),(p=this.lineRender)===null||p===void 0||p.disableHover(),(S=this.lineRender)===null||S===void 0||S.disableDrag()}}]),s}(Zt),Ea=function(L){ou(s,L);var i=su(s);function s(){return Xa(this,s),i.apply(this,arguments)}return Jo(s,[{key:"dragItem",get:function(){return this.dragPolygon}},{key:"editItem",get:function(){return this.editPolygon}},{key:"polygonRender",get:function(){return this.render.polygon}},{key:"dragPolygon",get:function(){return this.getPolygonData().find(function(l){return l.properties.isDrag})}},{key:"drawPolygon",get:function(){return this.getPolygonData().find(function(l){return l.properties.isDraw})}},{key:"editPolygon",get:function(){return this.getPolygonData().find(function(l){var p=l.properties;return!p.isDraw&&p.isActive})}},{key:"hoverPolygon",get:function(){return this.getPolygonData().find(function(l){return l.properties.isHover})}},{key:"getDragPolygon",value:function(){return this.dragPolygon}},{key:"getDrawPolygon",value:function(){return this.drawPolygon}},{key:"getEditPolygon",value:function(){return this.editPolygon}},{key:"getRenderTypes",value:function(){return["polygon","line","dashLine","midPoint","point","text"]}},{key:"getData",value:function(){return this.getPolygonData()}},{key:"getMainLayer",value:function(){var l,p;return(l=(p=this.render.polygon)===null||p===void 0?void 0:p.getLayers())!==null&&l!==void 0?l:[]}},{key:"getDefaultOptions",value:function(l){var p=kr(kr({},_a(Ra(s.prototype),"getDefaultOptions",this).call(this,l)),{},{areaOptions:!1,helper:al(Zr)});return l.areaOptions&&(p.areaOptions=kr(kr({},cl),l.areaOptions)),p}},{key:"getAreaTexts",value:function(l){var p=this.options.areaOptions;if(!p)return[];var S=p.format,A=p.showWhen,I=[],U=l.filter(function(q){return q.geometry.coordinates[0].length>=4});return A.includes("active")&&U.filter(function(q){return q.properties.isActive}).forEach(function(q){I.push(Fa(q,{format:S},{isActive:!0}))}),A.includes("normal")&&U.filter(function(q){return!q.properties.isActive}).forEach(function(q){I.push(Fa(q,{format:S},{isActive:!1}))}),I}},{key:"getAllTexts",value:function(){return[].concat(Su(_a(Ra(s.prototype),"getAllTexts",this).call(this)),Su(this.getAreaTexts(this.getPolygonData())))}},{key:"getPolygonData",value:function(){return this.source.getRenderData("polygon")}},{key:"setPolygonData",value:function(l){return this.source.setRenderData("polygon",l)}},{key:"handleCreatePolygon",value:function(l,p){var S=Ro(l,{nodes:l,line:p,isActive:!0,isDraw:!0});return this.setPolygonData(function(A){return As({target:S,data:[].concat(Su(A),[S]),otherHandler:function(I){I.properties.isActive=!1}})}),S}},{key:"handlePolygonUnClick",value:function(l){return this.clearActivePolygon(),l}},{key:"handlePolygonHover",value:function(l){return this.setCursor("polygonHover"),ss(l,this.hoverPolygon)||this.setPolygonData(function(p){return As({target:l,data:p,targetHandler:function(S){S.properties.isHover=!0},otherHandler:function(S){S.properties.isHover=!1}})}),l}},{key:"handlePolygonUnHover",value:function(){this.resetCursor(),this.setPolygonData(function(l){return l.map(function(p){return p.properties.isHover=!1,p})})}},{key:"handlePolygonDragStart",value:function(l){return this.setActivePolygon(l,{isDrag:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("polygonDrag"),l}},{key:"bindPolygonRenderEvent",value:function(){var l,p,S,A;(l=this.polygonRender)===null||l===void 0||l.on(K.RenderEvent.UnClick,this.onPolygonUnClick.bind(this)),(p=this.polygonRender)===null||p===void 0||p.on(K.RenderEvent.Mousemove,this.onPolygonHover.bind(this)),(S=this.polygonRender)===null||S===void 0||S.on(K.RenderEvent.Mouseout,this.onPolygonUnHover.bind(this)),(A=this.polygonRender)===null||A===void 0||A.on(K.RenderEvent.Dragstart,this.onPolygonDragStart.bind(this))}},{key:"syncPolygonNodes",value:function(l,p){var S=hl(vu([].concat(Su(p),[ks(p)]))),A=l.properties,I=A.line;if(l.properties.nodes=p,l.geometry.coordinates=[Yh(tl(S))?S:S.reverse()],this.setPolygonData(function(we){return we.map(function(Oe){return ss(Oe,l)?l:Oe})}),!ss(this.drawPolygon,l)){var U=I.properties.nodes,q=Su(p),re=ks(q);q.push(U.length===p.length?bu(re.geometry.coordinates):ur(U));var de=ur(q);Zn(re.geometry.coordinates,de.geometry.coordinates)||(de.geometry.coordinates=al(re.geometry.coordinates)),this.syncLineNodes(I,q)}return l}},{key:"setActivePolygon",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setActiveLine(l.properties.line,p),this.setPolygonData(function(S){return As({target:l,data:S,targetHandler:function(A){A.properties=kr(kr({},A.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},p)},otherHandler:function(A){A.properties=kr(kr({},A.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})}),this.setTextData(this.getAllTexts()),l}},{key:"clearActivePolygon",value:function(){this.setPolygonData(function(l){return l.map(function(p){return p.properties=kr(kr({},p.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),p})}),this.clearActiveLine()}},{key:"onLineDragStart",value:function(l){var p=_a(Ra(s.prototype),"onLineDragStart",this).call(this,l),S=this.getPolygonData().find(function(A){return ss(A.properties.line,p)});return S&&(this.setActivePolygon(S,{isDrag:!0}),this.emit(K.DrawEvent.DragStart,S,this.getPolygonData())),p}},{key:"onLineUnClick",value:function(l){return this.editLine}},{key:"onLineDragEnd",value:function(l){var p=_a(Ra(s.prototype),"onLineDragEnd",this).call(this,l),S=this.dragPolygon;return p&&S&&(S.properties.isDrag=!1,this.emit(K.DrawEvent.DragEnd,S,this.getPolygonData()),this.emit(K.DrawEvent.Edit,S,this.getPolygonData())),p}},{key:"onPolygonUnClick",value:function(l){var p=this.editPolygon;if(p)return this.handlePolygonUnClick(p)}},{key:"onPolygonHover",value:function(l){if(!this.drawPolygon)return this.dragPolygon||this.setHelper("polygonHover"),this.handlePolygonHover(l.feature)}},{key:"onPolygonUnHover",value:function(l){if(!this.drawPolygon)return this.setHelper(this.addable?"draw":null),this.handlePolygonUnHover()}},{key:"onPolygonDragStart",value:function(l){if(this.options.editable&&!this.drawPolygon){var p=l.feature;return this.previousPosition=Iu(l),this.setHelper("polygonDrag"),this.emit(K.DrawEvent.DragStart,p,this.getPolygonData()),this.handlePolygonDragStart(p)}}},{key:"onMidPointClick",value:function(l){var p=this.editPolygon,S=_a(Ra(s.prototype),"onMidPointClick",this).call(this,l);if(S&&p){var A=p.properties.line.properties.nodes;this.syncPolygonNodes(p,A.slice(0,A.length-1)),this.setActivePolygon(p)}return S}},{key:"onPointDragEnd",value:function(l){var p=this.editPolygon,S=_a(Ra(s.prototype),"onPointDragEnd",this).call(this,l);return S&&p&&this.emit(K.DrawEvent.Edit,p,this.getPolygonData()),S}},{key:"enablePolygonRenderAction",value:function(){var l,p,S,A=this.options.editable;(l=this.polygonRender)===null||l===void 0||l.enableUnClick(),A&&((p=this.polygonRender)===null||p===void 0||p.enableHover(),(S=this.polygonRender)===null||S===void 0||S.enableDrag())}},{key:"disablePolygonRenderAction",value:function(){var l,p,S;(l=this.polygonRender)===null||l===void 0||l.disableUnClick(),(p=this.polygonRender)===null||p===void 0||p.disableHover(),(S=this.polygonRender)===null||S===void 0||S.disableDrag()}},{key:"bindEnableEvent",value:function(){_a(Ra(s.prototype),"bindEnableEvent",this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.enablePolygonRenderAction()}},{key:"unbindEnableEvent",value:function(){_a(Ra(s.prototype),"unbindEnableEvent",this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.disablePolygonRenderAction()}},{key:"bindThis",value:function(){_a(Ra(s.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this),this.bindPolygonRenderEvent=this.bindPolygonRenderEvent.bind(this)}},{key:"setActiveFeature",value:function(l){var p=this.getTargetFeature(l);p?this.setActivePolygon(p):this.clearActivePolygon()}},{key:"resetFeatures",value:function(){var l=this.getPolygonData();this.drawPolygon&&(l=l.filter(function(p){return!p.properties.isDraw}),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setLineData(function(p){return p.filter(function(S){return!S.properties.isDraw})}),this.setTextData(function(p){return p.filter(function(S){return!S.properties.isActive})})),this.editPolygon&&this.handlePolygonUnClick(this.editPolygon),this.setPolygonData(l.map(function(p){return p.properties=kr(kr({},p.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),p}))}}]),s}(vi),ts=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).onSceneDragStart=S.onSceneDragStart.bind(th(S)),S.onSceneDragEnd=S.onSceneDragEnd.bind(th(S)),S}return Jo(s,[{key:"drawLine",get:function(){var l;return(l=this.drawPolygon)===null||l===void 0?void 0:l.properties.line}},{key:"isDragTrigger",get:function(){return this.options.trigger==="drag"}},{key:"isClickTrigger",get:function(){return this.options.trigger==="click"}},{key:"getDefaultOptions",value:function(l){var p=kr(kr({},_a(Ra(s.prototype),"getDefaultOptions",this).call(this,l)),{},{showMidPoint:!1,trigger:"click",autoActive:!1,helper:al(Xr)});return l.trigger==="drag"&&(p.helper=kr(kr({},p.helper),Rn)),p}},{key:"getMidPointsByLine",value:function(l){return[]}},{key:"handleCreatePolygon",value:function(l,p){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},A=p.properties.nodes;return Ro(A.slice(0,A.length-1),kr({nodes:l,line:p},S))}},{key:"handleFirstNodeCreate",value:function(l){var p=bu(l.geometry.coordinates),S=this.handleCreatePolygonLine(l,p,{isDraw:!0,isActive:!0}),A=this.handleCreatePolygon([l,p],S,{isDraw:!0,isActive:!0});return this.setPolygonData(function(I){return As({target:A,data:[].concat(Su(I),[A]),targetHandler:function(U){U.properties=kr(kr({},U.properties),{},{isDraw:!0,isActive:!0})}})}),this.emit(K.DrawEvent.AddNode,l,this.drawPolygon,this.getPolygonData()),this.setHelper("drawFinish"),l}},{key:"handleLastNodeCreate",value:function(l){var p=this.options,S=p.autoActive,A=p.editable,I=this.drawPolygon;return I&&(this.setLineData(function(U){return[].concat(Su(U),[I.properties.line])}),this.setActivePolygon(I),S&&A||this.handlePolygonUnClick(I),this.emit(K.DrawEvent.Add,I,this.getPolygonData()),this.emit(K.DrawEvent.AddNode,I.properties.nodes[1],this.drawPolygon,this.getPolygonData()),this.setHelper(A?S?"pointHover":"polygonHover":this.addable?"draw":null)),l}},{key:"onPointCreate",value:function(l){var p=this;if(this.addable&&!this.dragPoint&&!this.editLine&&this.isClickTrigger){var S=this.drawPolygon,A=Iu(l),I=this.handleCreatePoint(A);return S?requestAnimationFrame(function(){p.handleLastNodeCreate(I)}):this.handleFirstNodeCreate(I),I}}},{key:"setActivePolygon",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.setActiveLine(l.properties.line,p),this.setPolygonData(function(A){return As({target:l,data:A,targetHandler:function(I){I.properties=kr(kr({},I.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},p)},otherHandler:function(I){I.properties=kr(kr({},I.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})}),this.setPointData(l.properties.nodes),this.setDashLineData([]);var S=this.getAllTexts();return this.setTextData(S),l}},{key:"onPointDragging",value:function(l){var p=this.dragPoint;if(p){var S=this.handlePointDragging(p,us(l)),A=this.editPolygon;return S&&A&&(this.syncPolygonNodes(A,A.properties.nodes.map(function(I){return ss(I,S)?S:I})),this.setActivePolygon(A)),S}}},{key:"onSceneDragStart",value:function(l){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&(this.scene.setMapStatus({dragEnable:!1}),this.handleFirstNodeCreate(this.handleCreatePoint(Iu(l))))}},{key:"onSceneDragEnd",value:function(l){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&this.drawPolygon&&(this.scene.setMapStatus({dragEnable:!1}),this.handleLastNodeCreate(this.handleCreatePoint(Iu(l))))}},{key:"onSceneMouseMove",value:function(l){var p=this.drawPolygon;if(p){var S=p.properties.nodes,A=ks(S),I=ur(S);I.geometry.coordinates=Iu(l),this.syncPolygonNodes(p,[A,I]),this.setDashLineData([p.properties.line]),this.setTextData(this.getAllTexts()),this.resetCursor()}}},{key:"bindSceneDragEvent",value:function(){this.unbindSceneDragEvent(),this.sceneRender.on(K.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.on(K.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!1})}},{key:"unbindSceneDragEvent",value:function(){this.sceneRender.off(K.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.off(K.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!0})}},{key:"bindEnableEvent",value:function(){_a(Ra(s.prototype),"bindEnableEvent",this).call(this),this.isDragTrigger&&this.bindSceneDragEvent()}},{key:"unbindEnableEvent",value:function(){_a(Ra(s.prototype),"unbindEnableEvent",this).call(this),this.isDragTrigger&&this.unbindSceneDragEvent()}},{key:"bindThis",value:function(){_a(Ra(s.prototype),"bindThis",this).call(this),this.onSceneDragStart=this.onSceneDragStart.bind(this),this.onSceneDragEnd=this.onSceneDragEnd.bind(this)}}]),s}(Ea),ma=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).bindPointRenderEvent(),S.bindSceneEvent(),S.bindMidPointRenderEvent(),S.bindLineRenderEvent(),S.bindPolygonRenderEvent(),S}return Jo(s,[{key:"getDefaultOptions",value:function(l){var p=kr(kr({},_a(Ra(s.prototype),"getDefaultOptions",this).call(this,l)),{},{showMidPoint:!1,circleSteps:60});return p.distanceOptions&&(p.distanceOptions.showTotalDistance=!0,p.distanceOptions.showOnRadius===void 0&&(p.distanceOptions.showOnRadius=!0)),p.helper&&(p.helper=kr(kr({},p.helper),Pn)),p}},{key:"getDistanceTexts",value:function(){var l=this.options.distanceOptions;if(!l)return[];var p=[],S=l.showWhen,A=l.showDashDistance,I=l.format,U=l.showTotalDistance;return p.push.apply(p,Su(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!0,format:I,showDashDistance:A})).concat(Su(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:U,format:I,showWhen:S})))),p}},{key:"setData",value:function(l){var p=this,S=l.map(function(A){var I,U,q;A.properties=kr(kr({},$l()),A.properties);var re=(I=A.properties)===null||I===void 0?void 0:I.nodes;if(((U=re)===null||U===void 0?void 0:U.length)!==2){var de=os(Hh(A).geometry.coordinates,2),we=de[0],Oe=de[1],Ge=af(A),it=Ge[2],tt=(Ge[1]+Ge[3])/2;re=[bu([we,Oe]),bu([it,tt])],A.properties.nodes=re}var ct=re[0],ut=re[1],Je=!!(!((q=A.properties)===null||q===void 0)&&q.isActive),Pt=A.properties.line;return Pt||(Pt=p.handleCreatePolygonLine(ct,ut,{isActive:Je}),A.properties.line=Pt),p.handleCreatePolygon([ct,ut],Pt,kr(kr({},A.properties),{},{isActive:Je}))});this.source.setData({point:[],midPoint:[],dashLine:[],polygon:S,line:S.map(function(A){return A.properties.line})}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"handleCreatePolygonLine",value:function(l,p){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},A=this.getBoundaryPositions(l,p).map(function(I){return bu(I)});return Hu(A,S)}},{key:"syncPolygonNodes",value:function(l,p){var S=l.properties.line,A=this.getBoundaryPositions(p[0],p[1]);return l.properties.nodes=p,l.geometry.coordinates=[A],this.setPolygonData(function(I){return I.map(function(U){return ss(U,l)?l:U})}),this.setPointData(l.properties.isDraw?[p[0]]:p),S.properties.nodes.forEach(function(I,U){I.geometry.coordinates=A[U]}),S.geometry.coordinates=A,l}},{key:"onLineDragging",value:function(l){var p=this.dragPolygon,S=os(this.previousPosition,2),A=S[0],I=S[1],U=_a(Ra(s.prototype),"onLineDragging",this).call(this,l);if(p){var q=os(Iu(l),2),re=q[0],de=q[1];p.properties.nodes.forEach(function(we){var Oe=os(we.geometry.coordinates,2);we.geometry.coordinates=[Oe[0]+re-A,Oe[1]+de-I]}),this.syncPolygonNodes(p,p.properties.nodes),this.setActivePolygon(p,{isDrag:!0}),this.emit(K.DrawEvent.Dragging,p,this.getPolygonData())}return U}},{key:"getBoundaryPositions",value:function(l,p){for(var S=this.options.circleSteps,A=Kl(l,p,{units:"meters"}),I=[],U=0;S>U;U++)I.push(Rl(l,A,-360*U/S,{units:"meters"}).geometry.coordinates);return I.push(I[0]),I}}]),s}(ts),uo=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).drawLineFinish=function(){var A,I=S.drawLine,U=(A=I==null?void 0:I.properties.nodes)!==null&&A!==void 0?A:[];if(I&&(U==null?void 0:U.length)>1){S.setActiveLine(I);var q=S.options,re=q.autoActive,de=q.editable;re&&de||S.handleLineUnClick(I),S.setHelper(de&&re?"pointHover":S.addable?"draw":null),S.emit(K.DrawEvent.Add,I,S.getLineData())}},S.sceneRender.on(K.RenderEvent.DblClick,S.drawLineFinish),S.bindPointRenderEvent(),S.bindSceneEvent(),S.bindMidPointRenderEvent(),S.bindLineRenderEvent(),S}return Jo(s,[{key:"dragItem",get:function(){return this.dragLine}},{key:"editItem",get:function(){return this.editLine}},{key:"getMainLayer",value:function(){var l,p;return(l=(p=this.render.line)===null||p===void 0?void 0:p.getLayers())!==null&&l!==void 0?l:[]}},{key:"setData",value:function(l){var p=l.map(function(S){var A,I;return S.properties=kr(kr({},Pl()),(A=S.properties)!==null&&A!==void 0?A:{}),!((I=S.properties.nodes)===null||I===void 0)&&I.length||(S.properties.nodes=hl(S).map(function(U){return bu(U)})),S});this.source.setData({point:[],midPoint:[],dashLine:[],line:p}),this.setTextData(this.getAllTexts()),this.editLine&&this.setActiveLine(this.editLine)}},{key:"getData",value:function(){return this.getLineData()}},{key:"getRenderTypes",value:function(){return["line","dashLine","midPoint","point","text"]}},{key:"bindPointRenderEvent",value:function(){var l;_a(Ra(s.prototype),"bindPointRenderEvent",this).call(this),(l=this.pointRender)===null||l===void 0||l.on(K.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:"onPointClick",value:function(l){var p,S=this,A=this.drawLine,I=(p=A==null?void 0:A.properties.nodes)!==null&&p!==void 0?p:[],U=l.feature;if(ss(U,ur(I)))requestAnimationFrame(function(){S.drawLineFinish()});else{var q=os(U.geometry.coordinates,2);l.lngLat={lng:q[0],lat:q[1]},this.onPointCreate(l)}}},{key:"removeNode",value:function(l,p){var S,A=this.getTargetFeature(p),I=this.getTargetFeature(l,(S=A==null?void 0:A.properties.nodes)!==null&&S!==void 0?S:[]);if(A&&I){var U,q=(U=A==null?void 0:A.properties.nodes)!==null&&U!==void 0?U:[];if(3>q.length)return;this.syncLineNodes(A,q.filter(function(re){return!ss(I,re)})),this.emit(K.DrawEvent.RemoveNode,I,A,this.getLineData()),this.emit(K.DrawEvent.Edit,A,this.getLineData())}}},{key:"onPointContextMenu",value:function(l){var p,S=this.editLine,A=l.feature,I=(p=S==null?void 0:S.properties.nodes)!==null&&p!==void 0?p:[];if(S&&I.length>=3)return this.removeNode(A,S),this.scene.setMapStatus({dragEnable:!0}),A}},{key:"onPointCreate",value:function(l){if(this.addable){var p=_a(Ra(s.prototype),"onPointCreate",this).call(this,l);return p&&(this.setHelper("drawFinish"),this.emit(K.DrawEvent.AddNode,p,this.drawLine,this.getLineData())),p}}},{key:"onPointDragEnd",value:function(l){var p=this.editLine,S=_a(Ra(s.prototype),"onPointDragEnd",this).call(this,l);return p&&S&&this.emit(K.DrawEvent.Edit,p,this.getLineData()),S}},{key:"onLineDragStart",value:function(l){var p=_a(Ra(s.prototype),"onLineDragStart",this).call(this,l);return p&&this.emit(K.DrawEvent.DragStart,p,this.getLineData()),p}},{key:"onLineDragging",value:function(l){var p=_a(Ra(s.prototype),"onLineDragging",this).call(this,l);return p&&this.emit(K.DrawEvent.Dragging,p,this.getLineData()),p}},{key:"onLineDragEnd",value:function(l){var p=_a(Ra(s.prototype),"onLineDragEnd",this).call(this,l);return p&&(this.emit(K.DrawEvent.DragEnd,p,this.getLineData()),this.emit(K.DrawEvent.Edit,p,this.getLineData())),p}},{key:"onMidPointClick",value:function(l){var p=this.editLine,S=_a(Ra(s.prototype),"onMidPointClick",this).call(this,l);return p&&S&&(this.emit(K.DrawEvent.Edit,p,this.getLineData()),this.emit(K.DrawEvent.AddNode,S,p,this.getLineData())),S}},{key:"onSceneMouseMove",value:function(l){var p=this.drawLine;if(p){var S,A=ur(p.properties.nodes),I=Iu(l);this.options.adsorbOptions&&(I=(S=this.getAdsorbPosition(I))!==null&&S!==void 0?S:I),this.setDashLineData([Du([I,A.geometry.coordinates])]),this.setTextData(this.getAllTexts())}}},{key:"setActiveFeature",value:function(l){var p=this.getTargetFeature(l);p?this.setActiveLine(p):this.clearActiveLine()}},{key:"resetFeatures",value:function(){var l=this.getLineData();this.drawLine&&(l=l.filter(function(p){return!p.properties.isDraw}),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setTextData(function(p){return p.filter(function(S){return!S.properties.isActive})})),this.editLine&&this.handleLineUnClick(this.editLine),this.setLineData(l.map(function(p){return p.properties=kr(kr({},p.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),p}))}},{key:"enablePointRenderAction",value:function(){var l;_a(Ra(s.prototype),"enablePointRenderAction",this).call(this),this.options.editable&&((l=this.pointRender)===null||l===void 0||l.enableContextMenu())}},{key:"disablePointRenderAction",value:function(){var l;_a(Ra(s.prototype),"disablePointRenderAction",this).call(this),(l=this.pointRender)===null||l===void 0||l.disableContextMenu()}},{key:"bindEnableEvent",value:function(){_a(Ra(s.prototype),"bindEnableEvent",this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.sceneRender.enableDblClick()}},{key:"unbindEnableEvent",value:function(){_a(Ra(s.prototype),"unbindEnableEvent",this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.sceneRender.disableDblClick()}},{key:"bindThis",value:function(){_a(Ra(s.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this)}}]),s}(vi),Do=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).bindPointRenderEvent(),S}return Jo(s,[{key:"dragItem",get:function(){return this.dragPoint}},{key:"editItem",get:function(){return this.editPoint}},{key:"getDefaultOptions",value:function(l){var p=kr(kr({},this.getCommonOptions(l)),{},{helper:al(lr),initialData:l.initialData});return p.style.point=ge,p}},{key:"bindEnableEvent",value:function(){_a(Ra(s.prototype),"bindEnableEvent",this).call(this),this.enablePointRenderAction()}},{key:"unbindEnableEvent",value:function(){_a(Ra(s.prototype),"unbindEnableEvent",this).call(this),this.disablePointRenderAction()}},{key:"getRenderTypes",value:function(){return["point"]}},{key:"getMainLayer",value:function(){var l,p;return(l=(p=this.render.point)===null||p===void 0?void 0:p.getLayers())!==null&&l!==void 0?l:[]}},{key:"setData",value:function(l){this.setPointData(l.map(function(p){var S;return p.properties=kr(kr({},Lo()),(S=p.properties)!==null&&S!==void 0?S:{}),p}))}},{key:"getData",value:function(){return this.getPointData()}},{key:"onPointCreate",value:function(l){if(this.addable){var p=_a(Ra(s.prototype),"onPointCreate",this).call(this,l);if(p)return this.options.editable&&this.setHelper("pointHover"),this.emit(K.DrawEvent.Add,p,this.getData()),p}else this.setPointData(function(S){return S.map(function(A){return A.properties=kr(kr({},A.properties),{},{isHover:!1,isActive:!1}),A})})}},{key:"onPointMouseMove",value:function(l){var p=_a(Ra(s.prototype),"onPointMouseMove",this).call(this,l);return this.options.editable&&!this.dragPoint&&this.setHelper("pointHover"),p}},{key:"onPointMouseOut",value:function(l){var p=_a(Ra(s.prototype),"onPointMouseOut",this).call(this,l);return this.setHelper(this.addable?"draw":null),p}},{key:"onPointDragStart",value:function(l){var p=_a(Ra(s.prototype),"onPointDragStart",this).call(this,l);return this.setHelper("pointDrag"),this.emit(K.DrawEvent.DragStart,p,this.getData()),p}},{key:"onPointDragging",value:function(l){var p=_a(Ra(s.prototype),"onPointDragging",this).call(this,l);return p&&this.options.editable&&this.emit(K.DrawEvent.Dragging,p,this.getData()),p}},{key:"onPointDragEnd",value:function(l){var p=_a(Ra(s.prototype),"onPointDragEnd",this).call(this,l);return p&&this.options.editable&&(this.setHelper("pointHover"),this.emit(K.DrawEvent.DragEnd,p,this.getData()),this.emit(K.DrawEvent.Edit,p,this.getData())),p}},{key:"bindThis",value:function(){_a(Ra(s.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this)}},{key:"onSceneMouseMove",value:function(l){}},{key:"setActiveFeature",value:function(l){var p=this.getTargetFeature(l);this.setPointData(function(S){return S.map(function(A){return A.properties.isActive=ss(p,A),A})})}},{key:"resetFeatures",value:function(){this.setPointData(function(l){return l.map(function(p){return p.properties=kr(kr({},p.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),p})})}}]),s}(Lr),Ys=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).drawPolygonFinish=function(){var A,I=S.drawPolygon,U=(A=I==null?void 0:I.properties.nodes)!==null&&A!==void 0?A:[];if(I&&U.length>=3){I.properties.isDraw=!1,S.syncPolygonNodes(I,U),S.setActivePolygon(I);var q=S.options,re=q.autoActive,de=q.editable;re&&de||S.handlePolygonUnClick(I),S.setHelper(de?re?"pointHover":"polygonHover":S.addable?"draw":null),S.emit(K.DrawEvent.Add,I,S.getPolygonData())}},S.sceneRender.on(K.RenderEvent.DblClick,S.drawPolygonFinish),S.bindPointRenderEvent(),S.bindSceneEvent(),S.bindMidPointRenderEvent(),S.bindLineRenderEvent(),S.bindPolygonRenderEvent(),S}return Jo(s,[{key:"getDefaultOptions",value:function(l){return kr(kr({},_a(Ra(s.prototype),"getDefaultOptions",this).call(this,l)),{},{liveUpdate:!1})}},{key:"setData",value:function(l){var p=l.map(function(S){var A,I;if(S.properties=kr(kr({},$l()),(A=S.properties)!==null&&A!==void 0?A:{}),!(!((I=S.properties.nodes)===null||I===void 0)&&I.length)){var U=hl(S);U=U.slice(0,U.length-1),S.properties.nodes=U.map(function(re){return bu(re)})}if(!S.properties.line){var q=S.properties.nodes;S.properties.line=Hu([].concat(Su(q),[bu(ks(q).geometry.coordinates)]))}return S});this.source.setData({point:[],midPoint:[],dashLine:[],polygon:p,line:p.map(function(S){return S.properties.line})}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"onPointCreate",value:function(l){if(this.addable&&!this.dragPoint){var p=_a(Ra(s.prototype),"onPointCreate",this).call(this,l),S=this.drawPolygon,A=this.drawLine;return p&&(S?(this.syncPolygonNodes(S,[].concat(Su(S.properties.nodes),[p])),this.setDashLineData([Du([Iu(l),S.properties.nodes[0].geometry.coordinates])]),S.properties.nodes.length>1&&this.setHelper("drawFinish")):A&&(this.handleCreatePolygon([p],A),this.setHelper("drawContinue")),this.emit(K.DrawEvent.AddNode,p,S,this.getPolygonData())),p}}},{key:"onPointClick",value:function(l){var p=this,S=this.drawPolygon,A=l.feature;if(S){var I=S.properties.nodes;if(I.length<3||!ss(ks(I),A)&&!ss(ur(I),A)){var U=os(A.geometry.coordinates,2);l.lngLat={lng:U[0],lat:U[1]},this.onPointCreate(l)}else requestAnimationFrame(function(){p.drawPolygonFinish()})}}},{key:"onPointDragging",value:function(l){var p=this.dragPoint,S=this.editPolygon;if(p&&S){var A=S.properties.line;A.properties.nodes=A.properties.nodes.map(function(Oe){return ss(Oe,p)?p:Oe});var I=A.properties.nodes,U=I.slice(0,I.length-1),q=ks(I),re=ur(I),de=ss(q,p)||ss(re,p);if(de&&(q.geometry.coordinates=re.geometry.coordinates=Iu(l)),this.options.adsorbOptions&&de){var we=this.resetAdsorbLngLat(l);we&&(q.geometry.coordinates=re.geometry.coordinates=we)}_a(Ra(s.prototype),"onPointDragging",this).call(this,l),this.syncPolygonNodes(S,U),this.setActivePolygon(S)}return p}},{key:"onLineDragging",value:function(l){var p=this.dragPolygon,S=_a(Ra(s.prototype),"onLineDragging",this).call(this,l);if(S&&p){var A=S.properties.nodes;this.syncPolygonNodes(p,A.slice(0,A.length-1)),this.emit(K.DrawEvent.Dragging,p,this.getPolygonData())}return S}},{key:"onMidPointClick",value:function(l){var p=_a(Ra(s.prototype),"onMidPointClick",this).call(this,l),S=this.editPolygon;return p&&S&&(this.emit(K.DrawEvent.Edit,S,this.getPolygonData()),this.emit(K.DrawEvent.AddNode,p,S,this.getPolygonData())),p}},{key:"onSceneMouseMove",value:function(l){var p,S=this.drawPolygon,A=(p=S==null?void 0:S.properties.nodes)!==null&&p!==void 0?p:[];if(S&&A.length){this.options.adsorbOptions&&this.resetAdsorbLngLat(l);var I=Iu(l),U=[];if(U.push(Du([I,ks(A).geometry.coordinates])),A.length>1&&U.push(Du([I,ur(A).geometry.coordinates])),this.options.liveUpdate&&A.length>=2){var q=hl(vu(A));S.geometry.coordinates=[[].concat(Su(q),[I,q[0]])],this.setPolygonData(this.getPolygonData())}this.setDashLineData(U),this.setTextData(this.getAllTexts())}}},{key:"removeNode",value:function(l,p){var S,A=this.getTargetFeature(p),I=this.getTargetFeature(l,(S=A==null?void 0:A.properties.nodes)!==null&&S!==void 0?S:[]);if(A&&I){var U,q=(U=A==null?void 0:A.properties.nodes)!==null&&U!==void 0?U:[];if(4>q.length)return;this.syncPolygonNodes(A,q.filter(function(re){return!ss(I,re)})),this.emit(K.DrawEvent.RemoveNode,I,A,this.getLineData()),this.emit(K.DrawEvent.Edit,A,this.getPolygonData())}}},{key:"onPointContextMenu",value:function(l){var p,S=this.editPolygon,A=l.feature,I=(p=S==null?void 0:S.properties.nodes)!==null&&p!==void 0?p:[];if(S&&I.length>=4)return I.find(function(U){return ss(U,A)})||(A=I[0]),this.removeNode(A,S),A}},{key:"bindPointRenderEvent",value:function(){var l;_a(Ra(s.prototype),"bindPointRenderEvent",this).call(this),(l=this.pointRender)===null||l===void 0||l.on(K.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:"enablePointRenderAction",value:function(){var l;_a(Ra(s.prototype),"enablePointRenderAction",this).call(this),this.options.editable&&((l=this.pointRender)===null||l===void 0||l.enableContextMenu())}},{key:"disablePointRenderAction",value:function(){var l;_a(Ra(s.prototype),"disablePointRenderAction",this).call(this),(l=this.pointRender)===null||l===void 0||l.disableContextMenu()}}]),s}(Ea),Wl=function(L){ou(s,L);var i=su(s);function s(l,p){var S;return Xa(this,s),(S=i.call(this,l,p)).bindPointRenderEvent(),S.bindSceneEvent(),S.bindMidPointRenderEvent(),S.bindLineRenderEvent(),S.bindPolygonRenderEvent(),S}return Jo(s,[{key:"getDefaultOptions",value:function(l){var p=_a(Ra(s.prototype),"getDefaultOptions",this).call(this,l);return p.helper&&(p.helper=kr(kr({},p.helper),dn)),p}},{key:"setData",value:function(l){var p=this,S=l.map(function(A){var I,U,q;A.properties=kr(kr({},$l()),(I=A.properties)!==null&&I!==void 0?I:{});var re=A.properties.nodes;if(((U=re)===null||U===void 0?void 0:U.length)!==2){var de=os(af(A),4),we=de[2],Oe=de[3];re=[bu([de[0],de[1]]),bu([we,Oe])],A.properties.nodes=re}var Ge=os(re,2),it=Ge[0],tt=Ge[1],ct=!!(!((q=A.properties)===null||q===void 0)&&q.isActive),ut=A.properties.line;return ut||(ut=p.handleCreatePolygonLine(it,tt,{isActive:ct}),A.properties.line=ut),p.handleCreatePolygon([it,tt],ut,kr(kr({},A.properties),{},{isActive:ct}))});this.source.setData({point:[],midPoint:[],dashLine:[],polygon:S,line:S.map(function(A){return A.properties.line})}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"handleCreatePolygonLine",value:function(l,p){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},A=hl($c(vu([l,p]))).map(function(I,U){return U===0?l:U===2?p:bu(I)});return Hu(A,S)}},{key:"syncPolygonNodes",value:function(l,p){var S=l.properties.line,A=hl($c(vu(p)));l.properties.nodes=p,l.geometry.coordinates=[A],this.setPolygonData(function(q){return q.map(function(re){return ss(re,l)?l:re})}),this.setPointData(l.properties.isDraw?[p[0]]:p);var I=S.properties.nodes,U=A.filter(function(q){return!Zn(q,p[0].geometry.coordinates)&&!Zn(q,p[1].geometry.coordinates)});return I.forEach(function(q,re){var de=[0,0];switch(re){case 0:de=p[0].geometry.coordinates;break;case 1:de=U[0];break;case 2:de=p[1].geometry.coordinates;break;case 3:de=U[1];break;case 4:de=al(p[0].geometry.coordinates)}q.geometry.coordinates=de}),S.geometry.coordinates=A,l}},{key:"onLineDragging",value:function(l){var p=_a(Ra(s.prototype),"onLineDragging",this).call(this,l),S=this.dragPolygon;if(p&&S){var A=S.properties.line.properties.nodes;this.syncPolygonNodes(S,[A[0],A[2]]),this.setActivePolygon(S,{isDrag:!0}),this.emit(K.DrawEvent.Dragging,S,this.getPolygonData())}return p}}]),s}(ts),bf=function(L,i){for(var s=L;s&&!Array.from(s.classList).includes(i);)s=s.parentElement;return s},Iv=["point","line","polygon","rect","circle","clear"],Bh={point:"#l7draw-point",line:"#l7draw-line",polygon:"#l7draw-polygon",rect:"#l7draw-rect",circle:"#l7draw-circle",clear:"#l7draw-qingkong"},Rp={point:Do,line:uo,polygon:Ys,rect:Wl,circle:ma},ph="data-draw-type",tv="l7-draw-control",Td="".concat(tv,"__btn"),_v="".concat(Td,"--active");(function(L){var i,s,l,p,S,A='<svg><symbol id="l7draw-qingkong" viewBox="0 0 1024 1024"><path d="M778.96777344 334.02148437h-148.31542969V284.58300781A71.78466797 71.78466797 0 0 0 556.49462891 215.36914062H467.50537109a71.78466797 71.78466797 0 0 0-74.15771484 69.11499024V334.02148437h-148.31542969a29.66308594 29.66308594 0 1 0 0 59.32617188h29.66308594v326.29394531A88.98925781 88.98925781 0 0 0 363.68457031 808.63085938h296.63085938a88.98925781 88.98925781 0 0 0 88.98925781-88.98925782V393.34765625h29.66308594a29.66308594 29.66308594 0 0 0 0-59.32617188zM452.67382812 284.58300781c0-4.74609375 6.22924805-9.78881836 14.83154297-9.78881836h88.98925782c8.60229492 0 14.83154297 5.04272461 14.83154296 9.78881836V334.02148437H452.67382812V284.53356934z m237.30468751 435.10803223a29.66308594 29.66308594 0 0 1-29.66308594 29.66308593H363.68457031a29.66308594 29.66308594 0 0 1-29.66308593-29.66308594V393.34765625h355.95703124v326.29394531z"  ></path><path d="M437.84228516 660.31542969c6.57531739 0 12.85400391-3.46069336 17.5012207-9.64050294A39.20471192 39.20471192 0 0 0 462.56152344 627.33996582V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 437.84228516 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.50122071 9.64050293A39.20471192 39.20471192 0 0 0 413.12304687 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.50122071 9.64050294zM586.15771484 660.31542969c6.57531739 0 12.85400391-3.46069336 17.50122071-9.64050294a39.20471192 39.20471192 0 0 0 7.21801758-23.33496093V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 586.15771484 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.5012207 9.64050293A39.20471192 39.20471192 0 0 0 561.43847656 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.5012207 9.64050294z"  ></path></symbol><symbol id="l7draw-rect" viewBox="0 0 1024 1024"><path d="M736.14 648.79V330c0-23.16-18.84-42-42-42H375.49c-11.07-19.13-31.74-32.01-55.43-32.01-35.35 0-64.01 28.66-64.01 64.01 0 23.69 12.88 44.36 32.01 55.43v318.8c0 23.16 18.84 42 42 42H648.7c11.07 19.13 31.74 32.01 55.43 32.01 35.35 0 64.01-28.66 64.01-64.01 0.01-23.7-12.87-44.37-32-55.44zM352.06 375.43A64.281 64.281 0 0 0 375.49 352h296.64v296.8a64.357 64.357 0 0 0-23.43 23.43H352.06v-296.8z"  ></path></symbol><symbol id="l7draw-circle" viewBox="0 0 1024 1024"><path d="M467.013228 557.765038a64.01 64.01 0 1 0 90.52223-90.52539 64.01 64.01 0 1 0-90.52223 90.52539Z"  ></path><path d="M832.16 512.22c0-26.06-15.58-48.46-37.93-58.45-11.21-54.67-38.11-104.92-78.48-145.3-54.42-54.42-126.78-84.4-203.75-84.4s-149.33 29.97-203.75 84.4c-54.42 54.42-84.4 126.79-84.4 203.75s29.97 149.33 84.4 203.75c54.42 54.42 126.78 84.4 203.75 84.4s149.33-29.97 203.75-84.4c40.37-40.37 67.28-90.62 78.48-145.3 22.35-9.98 37.93-32.39 37.93-58.45zM670.5 670.72c-42.34 42.34-98.62 65.65-158.5 65.65-59.87 0-116.16-23.32-158.5-65.65-42.34-42.34-65.65-98.62-65.65-158.5s23.32-116.16 65.65-158.5c42.34-42.34 98.62-65.65 158.5-65.65 59.87 0 116.16 23.32 158.5 65.65 29.9 29.9 50.3 66.77 59.71 106.95-15.81 11.66-26.07 30.4-26.07 51.55s10.26 39.9 26.07 51.55c-9.41 40.18-29.81 77.05-59.71 106.95z"  ></path></symbol><symbol id="l7draw-polygon" viewBox="0 0 1024 1024"><path d="M705.97 640.31c-5.79 0-11.39 0.78-16.72 2.22L381.94 336.66a64.079 64.079 0 0 0 2.14-16.43c0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 23.69 12.88 44.36 32.01 55.43V648.8c-19.13 11.07-32.01 31.74-32.01 55.43 0 35.35 28.66 64.01 64.01 64.01 23.69 0 44.35-12.87 55.42-32l275.05 0.07c11.07 19.14 31.74 32.03 55.44 32.03 35.35 0 64.01-28.66 64.01-64.01s-28.66-64.02-64.02-64.02z m-353.91 8.48V397.22L628.44 672.3l-252.94-0.07a64.411 64.411 0 0 0-23.44-23.44z"  ></path></symbol><symbol id="l7draw-line" viewBox="0 0 1024 1024"><path d="M832.16 449.21c0-35.35-28.66-64.01-64.01-64.01-29.2 0-53.81 19.56-61.5 46.28l-390.9 96.82 72.18-144.18c33.56-1.99 60.17-29.83 60.17-63.89 0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 13.04 3.91 25.17 10.61 35.28l-78.42 156.65c-33.58 1.97-60.21 29.81-60.21 63.89 0 35.35 28.66 64.01 64.01 64.01 29.2 0 53.81-19.56 61.5-46.28l390.8-96.79-71.97 143.34c-33.62 1.93-60.28 29.8-60.28 63.9 0 35.35 28.66 64.01 64.01 64.01s64.01-28.66 64.01-64.01c0-13-3.89-25.09-10.54-35.18l78.28-155.93c33.61-1.95 60.28-29.81 60.28-63.91z"  ></path></symbol><symbol id="l7draw-point" viewBox="0 0 1024 1024"><path d="M331.46 330.08m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M384.12 735.84m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M769.11 512.7m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path></symbol></svg>',I=(I=document.getElementsByTagName("script"))[I.length-1].getAttribute("data-injectcss");if(I&&!L.__iconfont__svg__cssinject__){L.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(q){console&&console.log(q)}}function U(){S||(S=!0,l())}i=function(){var q,re=document.createElement("div");re.innerHTML=A,A=null,(re=re.getElementsByTagName("svg")[0])&&(re.setAttribute("aria-hidden","true"),re.style.position="absolute",re.style.width=0,re.style.height=0,re.style.overflow="hidden",(q=document.body).firstChild?function(de,we){we.parentNode.insertBefore(de,we)}(re,q.firstChild):q.appendChild(re))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(i,0):(s=function(){document.removeEventListener("DOMContentLoaded",s,!1),i()},document.addEventListener("DOMContentLoaded",s,!1)):document.attachEvent&&(l=i,p=L.document,S=!1,function q(){try{p.documentElement.doScroll("left")}catch(re){return void setTimeout(q,50)}U()}(),p.onreadystatechange=function(){p.readyState=="complete"&&(p.onreadystatechange=null,U())})})(window),Et(".l7-draw-control{display:flex;overflow:hidden;background:#fff;border-radius:2px;box-shadow:0 0 20px rgba(0,0,0,.14901960784313725)}.l7-draw-control__btn{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;padding:0;text-align:center;background:transparent;border-width:0;border-right:1px solid #e0e0e0;outline:0;cursor:pointer}.l7-draw-control__btn:hover{background-color:#e5e5e5}.l7-draw-control__btn:last-child{border-right:0;border-bottom:0}.l7-draw-control__btn .l7-draw-icon{width:26px;height:26px;overflow:hidden;fill:currentColor}.l7-draw-control__btn--active svg{color:#0370fe}");var Lv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gm=/^\w*$/,rc=function(L,i){if(Os(L))return!1;var s=typeof L;return!(s!="number"&&s!="symbol"&&s!="boolean"&&L!=null&&!vl(L))||gm.test(L)||!Lv.test(L)||i!=null&&L in Object(i)};function wl(L,i){if(typeof L!="function"||i!=null&&typeof i!="function")throw new TypeError("Expected a function");var s=function(){var l=arguments,p=i?i.apply(this,l):l[0],S=s.cache;if(S.has(p))return S.get(p);var A=L.apply(this,l);return s.cache=S.set(p,A)||S,A};return s.cache=new(wl.Cache||Zs),s}wl.Cache=Zs;var Nm=wl,Yv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rv=/\\(\\)?/g,ym=function(L){var i=Nm(L,function(l){return s.size===500&&s.clear(),l}),s=i.cache;return i}(function(L){var i=[];return L.charCodeAt(0)===46&&i.push(""),L.replace(Yv,function(s,l,p,S){i.push(p?S.replace(rv,"$1"):l||s)}),i}),Zm=Al?Al.prototype:void 0,Rv=Zm?Zm.toString:void 0,Zd=function L(i){if(typeof i=="string")return i;if(Os(i))return sa(i,L)+"";if(vl(i))return Rv?Rv.call(i):"";var s=i+"";return s=="0"&&1/i==-1/0?"-0":s},pd=function(L){return L==null?"":Zd(L)},_m=function(L,i){return Os(L)?L:rc(L,i)?[L]:ym(pd(L))},Jc=function(L){if(typeof L=="string"||vl(L))return L;var i=L+"";return i=="0"&&1/L==-1/0?"-0":i},Ii=function(L,i){for(var s=0,l=(i=_m(i,L)).length;L!=null&&l>s;)L=L[Jc(i[s++])];return s&&s==l?L:void 0},Ud=function(L,i,s){var l=-1,p=L.length;0>i&&(i=-i>p?0:p+i),0>(s=s>p?p:s)&&(s+=p),p=i>s?0:s-i>>>0,i>>>=0;for(var S=Array(p);++l<p;)S[l]=L[l+i];return S},cn=function(L,i){return 2>i.length?L:Ii(L,Ud(i,0,-1))},nv=function(L,i){return i=_m(i,L),(L=cn(L,i))==null||delete L[Jc(ur(i))]},tg=function(L){return Wr(L)?void 0:L},bv=Al?Al.isConcatSpreadable:void 0,dd=function(L){return Os(L)||lh(L)||!!(bv&&L&&L[bv])},jd=function L(i,s,l,p,S){var A=-1,I=i.length;for(l||(l=dd),S||(S=[]);++A<I;){var U=i[A];s>0&&l(U)?s>1?L(U,s-1,l,p,S):qd(S,U):p||(S[S.length]=U)}return S},rg=function(L){return L!=null&&L.length?jd(L,1):[]},Um=function(L){return Oi(qn(L,void 0,rg),L+"")}(function(L,i){var s={};if(L==null)return s;var l=!1;i=sa(i,function(S){return S=_m(S,L),l||(l=S.length>1),S}),vc(L,Ku(L),s),l&&(s=Wv(s,7,tg));for(var p=i.length;p--;)nv(s,i[p]);return s}),yc=Um,iv=function(L){ou(s,L);var i=su(s);function s(l){var p,S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Xa(this,s),(p=i.call(this,S)).controlOption=void 0,p.sceneInstance=void 0,p.drawMap={},p.btnMap={},p.activeType=null,p.emitDataChange=Cc(function(){p.emit(K.ControlEvent.DataChange,p.getDrawData())},16),p.emitDrawSelect=function(A,I){p.emit(K.ControlEvent.DrawSelect,A,I)},p.sceneInstance=l,p.controlOption=kr(kr({},p.getDefault()),S||{}),p.onBtnClick=p.onBtnClick.bind(th(p)),p}return Jo(s,[{key:"getActiveType",value:function(){return this.activeType}},{key:"getDefault",value:function(){return kr(kr({},_a(Ra(s.prototype),"getDefault",this).call(this)),{},{className:"",buttonClassName:"",activeButtonClassName:"",style:"",position:"topleft",commonDrawOptions:{},drawConfig:{point:!0,line:!0,polygon:!0,rect:!0,circle:!0,clear:!0}})}},{key:"addTo",value:function(l){return _a(Ra(s.prototype),"addTo",this).call(this,l),this.init(),this}},{key:"onAdd",value:function(){var l=this.controlOption,p=l.className,S=l.style,A=j.DOM.create("div","".concat(tv," ").concat(p));return S&&A.setAttribute("style",S),A}},{key:"onRemove",value:function(){Object.values(this.drawMap).forEach(function(l){l.clear(!0)})}},{key:"init",value:function(){var l,p=this,S=[];Object.entries(this.controlOption.drawConfig).filter(function(A){var I=os(A,2);return I[1]}).sort(function(A,I){var U=os(A,2)[1],q=os(I,2)[1],re=Number.MAX_SAFE_INTEGER;return(typeof U=="boolean"?re:U.order)-(typeof q=="boolean"?re:q.order)}).map(function(A){var I=os(A,2),U=I[1];return[I[0],wa(U)==="object"?yc(U,"order"):U]}).forEach(function(A){var I=os(A,2),U=I[0],q=I[1];if(wa(q)==="object"&&q.button){var re=q.button;re.classList.contains("l7-draw-control__btn")||re.classList.add("l7-draw-control__btn"),p.btnMap[U]=re,S.push(re)}else if(q&&Iv.includes(U)){var de=p.initBtn(U);de.addEventListener("click",p.onBtnClick),S.push(de),p.btnMap[U]=de;var we=Rp[U];if(we&&p.sceneInstance){var Oe=new we(p.sceneInstance,kr(kr({},p.controlOption.commonDrawOptions),typeof q=="boolean"?{}:q));Oe.on(K.DrawEvent.Change,p.emitDataChange),Oe.on(K.DrawEvent.Select,function(Ge){p.emitDrawSelect(U,Ge)}),p.drawMap[U]=Oe}}}),(l=this.container).append.apply(l,S),this.controlOption.defaultActiveType&&this.onDrawClick(this.controlOption.defaultActiveType)}},{key:"getDrawData",value:function(){return Xv(Go(this.drawMap).map(function(l){var p=os(l,2);return[p[0],p[1].getData()]}))}},{key:"getTypeDraw",value:function(l){var p;return(p=this.drawMap[l])!==null&&p!==void 0?p:null}},{key:"onBtnClick",value:function(l){var p=bf(l.target,Td);if(p){var S=p.getAttribute(ph);S==="clear"?this.clearDrawData():this.onDrawClick(S)}}},{key:"setActiveType",value:function(l){var p=null,S=this.activeType;if(S){var A,I=this.btnMap[S];if(I){j.DOM.removeClass(I,_v);var U=this.controlOption.activeButtonClassName;U&&j.DOM.removeClass(I,U)}(A=this.drawMap[S])===null||A===void 0||A.disable(),p=null}if(S!==l&&l){var q;(q=this.drawMap[l])===null||q===void 0||q.enable();var re=this.btnMap[l];re&&j.DOM.addClass(re,"".concat(_v," ").concat(this.controlOption.activeButtonClassName)),p=l}this.activeType=p,this.emit(K.ControlEvent.DrawChange,p)}},{key:"onDrawClick",value:function(l){this.setActiveType(l)}},{key:"clearDrawData",value:function(){Object.values(this.drawMap).forEach(function(l){l==null||l.clear()}),this.emit(K.ControlEvent.DrawClear)}},{key:"initBtn",value:function(l){var p=j.DOM.create("button","".concat(Td," ").concat(this.controlOption.buttonClassName));return p.innerHTML=`<svg class="l7-draw-icon" aria-hidden="true">
      <use xlink:href="`.concat(Bh[l],`"></use>
    </svg>`),p.setAttribute(ph,l),p}}]),s}(j.Control);K.ACTIVE_COLOR=O,K.BaseMode=wr,K.CircleDrawer=ma,K.DEFAULT_ADSORB_CONFIG=Er,K.DEFAULT_AREA_OPTIONS=cl,K.DEFAULT_COMMON_OPTIONS=Z,K.DEFAULT_CURSOR_MAP=P,K.DEFAULT_DISTANCE_OPTIONS=zu,K.DEFAULT_HISTORY_CONFIG=iu,K.DEFAULT_KEYBOARD_CONFIG=_t,K.DEFAULT_MID_POINT_STYLE=ue,K.DEFAULT_NODE_NORMAL_STYLE=ae,K.DEFAULT_NODE_STYLE=Le,K.DEFAULT_POINT_NORMAL_STYLE=H,K.DEFAULT_POINT_STYLE=ge,K.DEFAULT_POPUP_CONFIG=Ut,K.DEFAULT_SOURCE_DATA=M,K.DEFAULT_STYLE=w,K.DEFAULT_TEXT_NORMAL_STYLE=m,K.DashLineRender=Lc,K.DragPolygonMode=ts,K.DrawCircle=ma,K.DrawControl=iv,K.DrawLine=uo,K.DrawPoint=Do,K.DrawPolygon=Ys,K.DrawRect=Wl,K.LayerRender=pf,K.LineDrawer=uo,K.LineMode=vi,K.LineRender=Lf,K.MidPointMode=Zt,K.MidPointRender=Dh,K.NORMAL_COLOR=x,K.PointDrawer=Do,K.PointMode=Lr,K.PointRender=wp,K.PolygonDrawer=Ys,K.PolygonMode=Ea,K.PolygonRender=Jf,K.RENDER_MAP=h,K.RectDrawer=Wl,K.SceneRender=mr,K.Source=$r,K.TextRender=D,K.calcAreaText=Fa,K.calcDistanceTextsByLine=lu,K.createDashLine=Du,K.createLineFeature=Hu,K.createPointFeature=bu,K.createPolygonFeature=Ro,K.findMinIndex=rp,K.getAdsorbFeature=pn,K.getAdsorbLine=ua,K.getAdsorbPoint=en,K.getDefaultLineProperties=Pl,K.getDefaultPointProperties=Lo,K.getDefaultPolygonProperties=$l,K.getLineCenterPoint=Kc,K.getLngLat=us,K.getMapDom=Ts,K.getParentByClassName=bf,K.getPosition=Iu,K.getSingleColorStyle=function(L){return{point:{normal:{color:L},hover:{color:L},active:{color:L}},line:{normal:{color:L},hover:{color:L},active:{color:L}},polygon:{normal:{color:L},hover:{color:L},active:{color:L},style:{opacity:.2}},text:{normal:{color:L},active:{color:L}},midPoint:{normal:{color:L}},dashLine:{normal:{color:L}}}},K.getUuid=Ho,K.isDev=!1,K.isSameFeature=ss,K.resetEventLngLat=ls,K.splitByPosition=qt,K.transLngLat2Position=zh,K.updateTargetFeature=As,Object.defineProperty(K,"__esModule",{value:!0})})},53197:function(Ue,_e,G){"use strict";G.r(_e),G.d(_e,{AJAXError:function(){return za},AttributeType:function(){return Ni},BKDRHash:function(){return dl},BaiduMap:function(){return zO},BaseLayer:function(){return kd},BaseMapService:function(){return jy},BaseMapWrapper:function(){return l0},BaseModel:function(){return Lu},BasePostProcessingPass:function(){return Wm},BlendType:function(){return vh},ButtonControl:function(){return fy},CameraUniform:function(){return Sm},CanvasLayer:function(){return sS},CanvasUpdateType:function(){return P0},CityBuildingLayer:function(){return dT},Control:function(){return r0},CoordinateSystem:function(){return gd},CoordinateUniform:function(){return jm},DOM:function(){return K},Earth:function(){return Hz},EarthLayer:function(){return Ym},ExportImage:function(){return sA},FrequencyController:function(){return cf},Fullscreen:function(){return hA},GaodeMap:function(){return WI},GaodeMapV1:function(){return mO},GaodeMapV2:function(){return WI},GeoLocate:function(){return pA},GeometryLayer:function(){return Ib},HeatmapLayer:function(){return GT},IDebugLog:function(){return Qh},ILayerStage:function(){return zs},ImageLayer:function(){return Ob},InteractionEvent:function(){return Vd},LRUCache:function(){return sh},LayerPopup:function(){return $w},LayerSwitch:function(){return vA},LineLayer:function(){return Zb},LineTriangulation:function(){return _n},LinearDir:function(){return gy},LoadTileDataStatus:function(){return ue},Logo:function(){return rb},Map:function(){return e9},MapLibre:function(){return x9},MapServiceEvent:function(){return Mg},MapTheme:function(){return yA},Mapbox:function(){return h9},Marker:function(){return Y_},MarkerLayer:function(){return hy},MaskLayer:function(){return fu},MaskOperation:function(){return Us},MouseLocation:function(){return Uw},PassType:function(){return Qg},PointFillTriangulation:function(){return Zn},PointLayer:function(){return Zi},PolygonLayer:function(){return mh},PopperControl:function(){return Lw},Popup:function(){return Gw},PositionType:function(){return ga},RasterLayer:function(){return pa},RasterTileType:function(){return Up},Satistics:function(){return j},Scale:function(){return VP},ScaleTypes:function(){return Xl},Scene:function(){return rB},SceneConifg:function(){return zn},SceneEventList:function(){return S0},SelectControl:function(){return C1},SizeUnitType:function(){return k1},Source:function(){return cy},SourceTile:function(){return Ir},StencilType:function(){return nc},StyleScaleType:function(){return Em},TYPES:function(){return cn},TencentMap:function(){return D9},TextureBlend:function(){return hb},TileDebugLayer:function(){return Bs},TilesetManager:function(){return ao},UpdateTileStrategy:function(){return ae},Version:function(){return ip},Viewport:function(){return Uy},WindLayer:function(){return y3},WorkerSourceMap:function(){return Fi},Zoom:function(){return xA},aProjectFlat:function(){return Gn},amap2Project:function(){return xh},amap2UnProject:function(){return Xh},anchorTranslate:function(){return eh},anchorType:function(){return Ss},applyAnchorClass:function(){return kc},bBoxToBounds:function(){return Jl},bindAll:function(){return Ih},boundsContains:function(){return Tf},calAngle:function(){return pf},calDistance:function(){return Ql},calculateCentroid:function(){return xo},calculatePointsCenterAndRadius:function(){return Dl},container:function(){return lv},createLayerContainer:function(){return w0},createSceneContainer:function(){return uy},decodePickingColor:function(){return cc},djb2hash:function(){return Kf},encodePickingColor:function(){return uu},executeWorkerTask:function(){return Ai},expandUrl:function(){return oa},extent:function(){return Wc},flow:function(){return _l},formatImage:function(){return ws},generateCatRamp:function(){return Yu},generateColorRamp:function(){return Ja},generateCustomRamp:function(){return yh},generateLinearRamp:function(){return rf},generateQuantizeRamp:function(){return Vs},getAngle:function(){return Lc},getArrayBuffer:function(){return el},getBBoxFromPoints:function(){return Po},getCullFace:function(){return Hf},getData:function(){return vo},getDefaultDomain:function(){return vu},getImage:function(){return Vc},getJSON:function(){return oo},getProtocolAction:function(){return ni},getReferrer:function(){return vs},getTileIndices:function(){return dt},getTileWarpXY:function(){return Ft},getURLFromTemplate:function(){return Ha},getWMTSURLFromTemplate:function(){return ja},gl:function(){return Ke},guid:function(){return Pf},isAndroid:function(){return fc},isColor:function(){return Eh},isImageBitmap:function(){return lf},isPC:function(){return xc},isURLTemplate:function(){return Bi},isWorker:function(){return Ef},isiOS:function(){return bc},latitude:function(){return Ic},lazyInject:function(){return sy},lazyMultiInject:function(){return f5},lineAtOffset:function(){return kf},lineAtOffsetAsyc:function(){return Zu},lineStyleType:function(){return IA},lngLatInExtent:function(){return nl},lngLatToMeters:function(){return $h},lnglatDistance:function(){return wh},lodashUtil:function(){return Ga},longitude:function(){return ji},makeXMLHttpRequestPromise:function(){return io},metersToLngLat:function(){return Wh},normalize:function(){return wc},osmLonLat2TileXY:function(){return ft},osmTileXY2LonLat:function(){return pt},packCircleVertex:function(){return b5},padBounds:function(){return ff},polygonFillTriangulation:function(){return ri},postData:function(){return Qs},project:function(){return oh},rgb2arr:function(){return Mo},sameOrigin:function(){return as},setL7WorkerSource:function(){return Di},tileToBounds:function(){return wt},tranfrormCoord:function(){return Ui},unProjectFlat:function(){return ld},validateLngLat:function(){return hf},version:function(){return nB}});var K={};G.r(K),G.d(K,{DPR:function(){return Xs},addClass:function(){return pl},addStyle:function(){return qf},appendElementType:function(){return Rl},clearChildren:function(){return Kl},create:function(){return wo},css2Style:function(){return Yp},empty:function(){return Vu},findParentElement:function(){return Ms},getClass:function(){return Gh},getContainer:function(){return Hc},getDiffRect:function(){return kp},getStyleList:function(){return _p},getViewPortScale:function(){return kh},hasClass:function(){return Xf},printCanvas:function(){return Pp},remove:function(){return fl},removeClass:function(){return bh},removeStyle:function(){return bp},setChecked:function(){return xp},setClass:function(){return yp},setTransform:function(){return Ll},setUnDraggable:function(){return $c},splitWords:function(){return sf},triggerResize:function(){return uf},trim:function(){return gp}});var j={};G.r(j),G.d(j,{getColumn:function(){return wp},getSatByColumn:function(){return Jf},max:function(){return ec},mean:function(){return Cc},min:function(){return If},mode:function(){return Lf},statMap:function(){return Dh},sum:function(){return Rc}});var P={};G.r(P),G.d(P,{add:function(){return fr},adjoint:function(){return So},clone:function(){return la},copy:function(){return yn},create:function(){return Kn},determinant:function(){return cs},equals:function(){return ii},exactEquals:function(){return wn},frob:function(){return ir},fromQuat:function(){return z},fromQuat2:function(){return go},fromRotation:function(){return Eo},fromRotationTranslation:function(){return Ma},fromRotationTranslationScale:function(){return b},fromRotationTranslationScaleOrigin:function(){return k},fromScaling:function(){return ms},fromTranslation:function(){return bs},fromValues:function(){return Ti},fromXRotation:function(){return gu},fromYRotation:function(){return fs},fromZRotation:function(){return Cn},frustum:function(){return V},getRotation:function(){return c},getScaling:function(){return v},getTranslation:function(){return Na},identity:function(){return $o},invert:function(){return Oo},lookAt:function(){return gt},mul:function(){return da},multiply:function(){return Wo},multiplyScalar:function(){return Tr},multiplyScalarAndAdd:function(){return Jr},ortho:function(){return We},orthoNO:function(){return Ne},orthoZO:function(){return ht},perspective:function(){return ne},perspectiveFromFieldOfView:function(){return Se},perspectiveNO:function(){return W},perspectiveZO:function(){return he},rotate:function(){return Au},rotateX:function(){return Wi},rotateY:function(){return hs},rotateZ:function(){return Ba},scale:function(){return Xo},set:function(){return Aa},str:function(){return Ht},sub:function(){return $a},subtract:function(){return Gr},targetTo:function(){return St},translate:function(){return Bo},transpose:function(){return lo}});var M={};G.r(M),G.d(M,{add:function(){return db},angle:function(){return L1},bezier:function(){return HA},ceil:function(){return BA},clone:function(){return fb},copy:function(){return pb},create:function(){return lg},cross:function(){return yy},dist:function(){return YA},distance:function(){return hS},div:function(){return XA},divide:function(){return lS},dot:function(){return gb},equals:function(){return Rg},exactEquals:function(){return k0},floor:function(){return NA},forEach:function(){return QA},fromValues:function(){return Fu},hermite:function(){return GA},inverse:function(){return jA},len:function(){return KA},length:function(){return I1},lerp:function(){return VA},max:function(){return cS},min:function(){return $P},mul:function(){return WA},multiply:function(){return vb},negate:function(){return dS},normalize:function(){return Ig},random:function(){return $A},rotateX:function(){return by},rotateY:function(){return xy},rotateZ:function(){return vS},round:function(){return ZA},scale:function(){return mb},scaleAndAdd:function(){return UA},set:function(){return zA},sqrDist:function(){return qA},sqrLen:function(){return JA},squaredDistance:function(){return fS},squaredLength:function(){return pS},str:function(){return gS},sub:function(){return _b},subtract:function(){return uS},transformMat3:function(){return _y},transformMat4:function(){return Lg},transformQuat:function(){return yb},zero:function(){return mS}});var ee={},te={},pe=function(a){return te[a]},Ce=function(a,r){te[a]=r},le=function(a){return ee[a]},Ie=function(a,r){ee[a]=r},rt={},xt={},nt=34,Ct=10,jt=13;function Vt(e){return new Function("d","return {"+e.map(function(a,r){return JSON.stringify(a)+": d["+r+'] || ""'}).join(",")+"}")}function Rt(e,a){var r=Vt(e);return function(n,t){return a(r(n),t,e)}}function hr(e){var a=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in a||r.push(a[t]=t)}),r}function er(e,a){var r=e+"",n=r.length;return n<a?new Array(a-n+1).join(0)+r:r}function gn(e){return e<0?"-"+er(-e,6):e>9999?"+"+er(e,6):er(e,4)}function Rr(e){var a=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":gn(e.getUTCFullYear(),4)+"-"+er(e.getUTCMonth()+1,2)+"-"+er(e.getUTCDate(),2)+(t?"T"+er(a,2)+":"+er(r,2)+":"+er(n,2)+"."+er(t,3)+"Z":n?"T"+er(a,2)+":"+er(r,2)+":"+er(n,2)+"Z":r||a?"T"+er(a,2)+":"+er(r,2)+"Z":"")}function vn(e){var a=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(B,Y){var Q,ce,fe=t(B,function(Te,Ve){if(Q)return Q(Te,Ve-1);ce=Te,Q=Y?Rt(Te,Y):Vt(Te)});return fe.columns=ce||[],fe}function t(B,Y){var Q=[],ce=B.length,fe=0,Te=0,Ve,st=ce<=0,at=!1;B.charCodeAt(ce-1)===Ct&&--ce,B.charCodeAt(ce-1)===jt&&--ce;function Tt(){if(st)return xt;if(at)return at=!1,rt;var Yt,cr=fe,Mr;if(B.charCodeAt(cr)===nt){for(;fe++<ce&&B.charCodeAt(fe)!==nt||B.charCodeAt(++fe)===nt;);return(Yt=fe)>=ce?st=!0:(Mr=B.charCodeAt(fe++))===Ct?at=!0:Mr===jt&&(at=!0,B.charCodeAt(fe)===Ct&&++fe),B.slice(cr+1,Yt-1).replace(/""/g,'"')}for(;fe<ce;){if((Mr=B.charCodeAt(Yt=fe++))===Ct)at=!0;else if(Mr===jt)at=!0,B.charCodeAt(fe)===Ct&&++fe;else if(Mr!==r)continue;return B.slice(cr,Yt)}return st=!0,B.slice(cr,ce)}for(;(Ve=Tt())!==xt;){for(var kt=[];Ve!==rt&&Ve!==xt;)kt.push(Ve),Ve=Tt();Y&&(kt=Y(kt,Te++))==null||Q.push(kt)}return Q}function o(B,Y){return B.map(function(Q){return Y.map(function(ce){return R(Q[ce])}).join(e)})}function u(B,Y){return Y==null&&(Y=hr(B)),[Y.map(R).join(e)].concat(o(B,Y)).join(`
`)}function f(B,Y){return Y==null&&(Y=hr(B)),o(B,Y).join(`
`)}function g(B){return B.map(E).join(`
`)}function E(B){return B.map(R).join(e)}function R(B){return B==null?"":B instanceof Date?Rr(B):a.test(B+="")?'"'+B.replace(/"/g,'""')+'"':B}return{parse:n,parseRows:t,format:u,formatBody:f,formatRows:g,formatRow:E,formatValue:R}}var rr=vn(","),Jt=rr.parse,br=rr.parseRows,or=rr.format,Br=rr.formatBody,an=rr.formatRows,ot=rr.formatRow,Dt=rr.formatValue,Ee=G(1413),Bt=63710088e-1,Ot={centimeters:Bt*100,centimetres:Bt*100,degrees:Bt/111325,feet:Bt*3.28084,inches:Bt*39.37,kilometers:Bt/1e3,kilometres:Bt/1e3,meters:Bt,metres:Bt,miles:Bt/1609.344,millimeters:Bt*1e3,millimetres:Bt*1e3,nauticalmiles:Bt/1852,radians:1,yards:Bt*1.0936},Pr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Bt,yards:1.0936133},Fr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Nr(e,a,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=a||{},n.geometry=e,n}function hn(e,a,r){switch(r===void 0&&(r={}),e){case"Point":return xn(a).geometry;case"LineString":return na(a).geometry;case"Polygon":return pi(a).geometry;case"MultiPoint":return $i(a).geometry;case"MultiLineString":return La(a).geometry;case"MultiPolygon":return qo(a).geometry;default:throw new Error(e+" is invalid")}}function xn(e,a,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mt(e[0])||!mt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Nr(n,a,r)}function Ji(e,a,r){return r===void 0&&(r={}),po(e.map(function(n){return xn(n,a)}),r)}function pi(e,a,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var f={type:"Polygon",coordinates:e};return Nr(f,a,r)}function Ka(e,a,r){return r===void 0&&(r={}),po(e.map(function(n){return pi(n,a)}),r)}function na(e,a,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Nr(n,a,r)}function ca(e,a,r){return r===void 0&&(r={}),po(e.map(function(n){return na(n,a)}),r)}function po(e,a){a===void 0&&(a={});var r={type:"FeatureCollection"};return a.id&&(r.id=a.id),a.bbox&&(r.bbox=a.bbox),r.features=e,r}function La(e,a,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Nr(n,a,r)}function $i(e,a,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Nr(n,a,r)}function qo(e,a,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Nr(n,a,r)}function is(e,a,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Nr(n,a,r)}function Ko(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,a||0);return Math.round(e*r)/r}function Za(e,a){a===void 0&&(a="kilometers");var r=Ot[a];if(!r)throw new Error(a+" units is invalid");return e*r}function ha(e,a){a===void 0&&(a="kilometers");var r=Ot[a];if(!r)throw new Error(a+" units is invalid");return e/r}function Fo(e,a){return Ua(ha(e,a))}function un(e){var a=e%360;return a<0&&(a+=360),a}function Ua(e){var a=e%(2*Math.PI);return a*180/Math.PI}function zr(e){var a=e%360;return a*Math.PI/180}function be(e,a,r){if(a===void 0&&(a="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Za(ha(e,a),r)}function lt(e,a,r){if(a===void 0&&(a="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Fr[a];if(!n)throw new Error("invalid original units");var t=Fr[r];if(!t)throw new Error("invalid final units");return e/n*t}function mt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Qt(e){return!!e&&e.constructor===Object}function xr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!mt(a))throw new Error("bbox must only contain numbers")})}function mn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Wn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Hr(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Hr(e[0]);throw new Error("coordinates must only contain numbers")}function dr(e,a,r){if(!a||!r)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+r+": must be a "+a+", given "+e.type)}function Un(e,a,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+r+": must be a "+a+", given "+e.geometry.type)}function ti(e,a,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+r+": must be a "+a+", given "+o.geometry.type)}}function Yi(e){return e.type==="Feature"?e.geometry:e}function ea(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function on(e,a,r){if(e!==null)for(var n,t,o,u,f,g,E,R=0,B=0,Y,Q=e.type,ce=Q==="FeatureCollection",fe=Q==="Feature",Te=ce?e.features.length:1,Ve=0;Ve<Te;Ve++){E=ce?e.features[Ve].geometry:fe?e.geometry:e,Y=E?E.type==="GeometryCollection":!1,f=Y?E.geometries.length:1;for(var st=0;st<f;st++){var at=0,Tt=0;if(u=Y?E.geometries[st]:E,u!==null){g=u.coordinates;var kt=u.type;switch(R=r&&(kt==="Polygon"||kt==="MultiPolygon")?1:0,kt){case null:break;case"Point":if(a(g,B,Ve,at,Tt)===!1)return!1;B++,at++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(a(g[n],B,Ve,at,Tt)===!1)return!1;B++,kt==="MultiPoint"&&at++}kt==="LineString"&&at++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(t=0;t<g[n].length-R;t++){if(a(g[n][t],B,Ve,at,Tt)===!1)return!1;B++}kt==="MultiLineString"&&at++,kt==="Polygon"&&Tt++}kt==="Polygon"&&at++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(Tt=0,t=0;t<g[n].length;t++){for(o=0;o<g[n][t].length-R;o++){if(a(g[n][t][o],B,Ve,at,Tt)===!1)return!1;B++}Tt++}at++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(on(u.geometries[n],a,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Xn(e,a,r,n){var t=r;return on(e,function(o,u,f,g,E){u===0&&r===void 0?t=o:t=a(t,o,u,f,g,E)},n),t}function Pi(e,a){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&a(e.features[r].properties,r)!==!1;r++);break;case"Feature":a(e.properties,0);break}}function Pa(e,a,r){var n=r;return Pi(e,function(t,o){o===0&&r===void 0?n=t:n=a(n,t,o)}),n}function zo(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&a(e.features[r],r)!==!1;r++);}function ya(e,a,r){var n=r;return zo(e,function(t,o){o===0&&r===void 0?n=t:n=a(n,t,o)}),n}function Xu(e){var a=[];return on(e,function(r){a.push(r)}),a}function Wt(e,a){var r,n,t,o,u,f,g,E,R,B,Y=0,Q=e.type==="FeatureCollection",ce=e.type==="Feature",fe=Q?e.features.length:1;for(r=0;r<fe;r++){for(f=Q?e.features[r].geometry:ce?e.geometry:e,E=Q?e.features[r].properties:ce?e.properties:{},R=Q?e.features[r].bbox:ce?e.bbox:void 0,B=Q?e.features[r].id:ce?e.id:void 0,g=f?f.type==="GeometryCollection":!1,u=g?f.geometries.length:1,t=0;t<u;t++){if(o=g?f.geometries[t]:f,o===null){if(a(null,Y,E,R,B)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,Y,E,R,B)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(a(o.geometries[n],Y,E,R,B)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Y++}}function qe(e,a,r){var n=r;return Wt(e,function(t,o,u,f,g){o===0&&r===void 0?n=t:n=a(n,t,o,u,f,g)}),n}function se(e,a){Wt(e,function(r,n,t,o,u){var f=r===null?null:r.type;switch(f){case null:case"Point":case"LineString":case"Polygon":return a(Nr(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var g;switch(f){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var R=r.coordinates[E],B={type:g,coordinates:R};if(a(Nr(B,t),n,E)===!1)return!1}})}function ve(e,a,r){var n=r;return se(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=a(n,t,o,u)}),n}function Ae(e,a){se(e,function(r,n,t){var o=0;if(r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var f,g=0,E=0,R=0;if(on(r,function(B,Y,Q,ce,fe){if(f===void 0||n>g||ce>E||fe>R){f=B,g=n,E=ce,R=fe,o=0;return}var Te=lineString([f,B],r.properties);if(a(Te,n,t,fe,o)===!1)return!1;o++,f=B})===!1)return!1}}})}function Re(e,a,r){var n=r,t=!1;return Ae(e,function(o,u,f,g,E){t===!1&&r===void 0?n=o:n=a(n,o,u,f,g,E),t=!0}),n}function Xe(e,a){if(!e)throw new Error("geojson is required");se(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(a(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var f=0;f<u.length;f++)if(a(lineString(u[f],r.properties),n,t,f)===!1)return!1;break}}})}function Qe(e,a,r){var n=r;return Xe(e,function(t,o,u,f){o===0&&r===void 0?n=t:n=a(n,t,o,u,f)}),n}function Ye(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var r=a.featureIndex||0,n=a.multiFeatureIndex||0,t=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,f;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,f=e.features[r].geometry;break;case"Feature":u=u||e.properties,f=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=e;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var g=f.coordinates;switch(f.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=g.length+o-1),lineString([g[o],g[o+1]],u,a);case"Polygon":return t<0&&(t=g.length+t),o<0&&(o=g[t].length+o-1),lineString([g[t][o],g[t][o+1]],u,a);case"MultiLineString":return n<0&&(n=g.length+n),o<0&&(o=g[n].length+o-1),lineString([g[n][o],g[n][o+1]],u,a);case"MultiPolygon":return n<0&&(n=g.length+n),t<0&&(t=g[n].length+t),o<0&&(o=g[n][t].length-o-1),lineString([g[n][t][o],g[n][t][o+1]],u,a)}throw new Error("geojson is invalid")}function Fe(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var r=a.featureIndex||0,n=a.multiFeatureIndex||0,t=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,f;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,f=e.features[r].geometry;break;case"Feature":u=u||e.properties,f=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=e;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var g=f.coordinates;switch(f.type){case"Point":return point(g,u,a);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],u,a);case"LineString":return o<0&&(o=g.length+o),point(g[o],u,a);case"Polygon":return t<0&&(t=g.length+t),o<0&&(o=g[t].length+o),point(g[t][o],u,a);case"MultiLineString":return n<0&&(n=g.length+n),o<0&&(o=g[n].length+o),point(g[n][o],u,a);case"MultiPolygon":return n<0&&(n=g.length+n),t<0&&(t=g[n].length+t),o<0&&(o=g[n][t].length-o),point(g[n][t][o],u,a)}throw new Error("geojson is invalid")}var Me=G(43144),Be=G(15671),yt=G(60136),zt=G(82963),Ze=G(61120),Yr=G(89611);function Fn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(a){return typeof e=="function"}}var Nn=G(78814);function qr(e,a,r){return(0,Nn.Z)()?qr=Reflect.construct.bind():qr=function(t,o,u){var f=[null];f.push.apply(f,o);var g=Function.bind.apply(t,f),E=new g;return u&&(0,Yr.Z)(E,u.prototype),E},qr.apply(null,arguments)}function li(e){var a=typeof Map=="function"?new Map:void 0;return li=function(n){if(n===null||!Fn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(n))return a.get(n);a.set(n,t)}function t(){return qr(n,arguments,(0,Ze.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,Yr.Z)(t,n)},li(e)}var zn={REGISTERED_PROTOCOLS:{}};function jn(e){var a=Ca();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Ca(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ni=function(a){return zn.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]},za=function(e){(0,yt.Z)(r,e);var a=jn(r);function r(n,t,o,u){var f;return(0,Be.Z)(this,r),f=a.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),f.status=n,f.statusText=t,f.url=o,f.body=u,f}return(0,Me.Z)(r)}(li(Error));function Ao(e,a){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){a(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(f){return a(f)}a(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});a(new za(r.status,r.statusText,n.toString(),u))}},r.cancel=r.abort,r.send(e.body),r}function io(e){return new Promise(function(a,r){Ao(e,function(n,t,o,u,f){n?r({err:n,data:null,xhr:f}):a({err:null,data:t,cacheControl:o,expires:u,xhr:f})})})}function ys(e,a){return Ao(e,a)}var oo=function(a,r){var n=ni(a.url)||ys;return n((0,Ee.Z)((0,Ee.Z)({},a),{},{type:"json"}),r)},el=function(a,r){var n=ni(a.url)||ys;return n((0,Ee.Z)((0,Ee.Z)({},a),{},{type:"arrayBuffer"}),r)},Qs=function(a,r){return ys((0,Ee.Z)((0,Ee.Z)({},a),{},{method:"POST"}),r)},vo=function(a,r){return ys((0,Ee.Z)((0,Ee.Z)({},a),{},{method:"GET"}),r)};function as(e){var a=window.document.createElement("a");return a.href=e,a.protocol===window.document.location.protocol&&a.host===window.document.location.host}var To="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function to(e,a){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){a(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=To})},r.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):To}function js(e,a){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){a(null,n)}).catch(function(n){a(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Vc=function(a,r,n){var t=function(u,f){if(u)r(u);else if(f){var g=typeof createImageBitmap=="function",E=n?n(f):f;g?js(E,r):to(E,r)}};return a.type==="json"?oo(a,t):el(a,t)},ws=function(a,r){var n=typeof createImageBitmap=="function";n?js(a,r):to(a,r)},Ss=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),eh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kc(e,a,r){var n=e.classList;for(var t in eh)eh.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(a))}function Io(e,a,r){e.prototype=a.prototype=r,r.constructor=e}function bo(e,a){var r=Object.create(e.prototype);for(var n in a)r[n]=a[n];return r}function du(){}var Zo=.7,Il=1/Zo,Uo="\\s*([+-]?\\d+)\\s*",Ws="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",eu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sl=/^#([0-9a-f]{3,8})$/,ul=new RegExp("^rgb\\("+[Uo,Uo,Uo]+"\\)$"),ll=new RegExp("^rgb\\("+[eu,eu,eu]+"\\)$"),_c=new RegExp("^rgba\\("+[Uo,Uo,Uo,Ws]+"\\)$"),zu=new RegExp("^rgba\\("+[eu,eu,eu,Ws]+"\\)$"),cl=new RegExp("^hsl\\("+[Ws,eu,eu]+"\\)$"),iu=new RegExp("^hsla\\("+[Ws,eu,eu,Ws]+"\\)$"),_t={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Io(du,kr,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Ut,formatHex:Ut,formatHsl:Er,formatRgb:Sn,toString:Sn});function Ut(){return this.rgb().formatHex()}function Er(){return su(this).formatHsl()}function Sn(){return this.rgb().formatRgb()}function kr(e){var a,r;return e=(e+"").trim().toLowerCase(),(a=sl.exec(e))?(r=a[1].length,a=parseInt(a[1],16),r===6?wa(a):r===3?new au(a>>8&15|a>>4&240,a>>4&15|a&240,(a&15)<<4|a&15,1):r===8?Xa(a>>24&255,a>>16&255,a>>8&255,(a&255)/255):r===4?Xa(a>>12&15|a>>8&240,a>>8&15|a>>4&240,a>>4&15|a&240,((a&15)<<4|a&15)/255):null):(a=ul.exec(e))?new au(a[1],a[2],a[3],1):(a=ll.exec(e))?new au(a[1]*255/100,a[2]*255/100,a[3]*255/100,1):(a=_c.exec(e))?Xa(a[1],a[2],a[3],a[4]):(a=zu.exec(e))?Xa(a[1]*255/100,a[2]*255/100,a[3]*255/100,a[4]):(a=cl.exec(e))?th(a[1],a[2]/100,a[3]/100,1):(a=iu.exec(e))?th(a[1],a[2]/100,a[3]/100,a[4]):_t.hasOwnProperty(e)?wa(_t[e]):e==="transparent"?new au(NaN,NaN,NaN,0):null}function wa(e){return new au(e>>16&255,e>>8&255,e&255,1)}function Xa(e,a,r,n){return n<=0&&(e=a=r=NaN),new au(e,a,r,n)}function yl(e){return e instanceof du||(e=kr(e)),e?(e=e.rgb(),new au(e.r,e.g,e.b,e.opacity)):new au}function Jo(e,a,r,n){return arguments.length===1?yl(e):new au(e,a,r,n==null?1:n)}function au(e,a,r,n){this.r=+e,this.g=+a,this.b=+r,this.opacity=+n}Io(au,Jo,bo(du,{brighter:function(e){return e=e==null?Il:Math.pow(Il,e),new au(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Zo:Math.pow(Zo,e),new au(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ou,formatHex:ou,formatRgb:Ra,toString:Ra}));function ou(){return"#"+Mp(this.r)+Mp(this.g)+Mp(this.b)}function Ra(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Mp(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function th(e,a,r,n){return n<=0?e=a=r=NaN:r<=0||r>=1?e=a=NaN:a<=0&&(e=NaN),new os(e,a,r,n)}function su(e){if(e instanceof os)return new os(e.h,e.s,e.l,e.opacity);if(e instanceof du||(e=kr(e)),!e)return new os;if(e instanceof os)return e;e=e.rgb();var a=e.r/255,r=e.g/255,n=e.b/255,t=Math.min(a,r,n),o=Math.max(a,r,n),u=NaN,f=o-t,g=(o+t)/2;return f?(a===o?u=(r-n)/f+(r<n)*6:r===o?u=(n-a)/f+2:u=(a-r)/f+4,f/=g<.5?o+t:2-o-t,u*=60):f=g>0&&g<1?0:u,new os(u,f,g,e.opacity)}function _a(e,a,r,n){return arguments.length===1?su(e):new os(e,a,r,n==null?1:n)}function os(e,a,r,n){this.h=+e,this.s=+a,this.l=+r,this.opacity=+n}Io(os,_a,bo(du,{brighter:function(e){return e=e==null?Il:Math.pow(Il,e),new os(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Zo:Math.pow(Zo,e),new os(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,a=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*a,t=2*r-n;return new au(Su(e>=240?e-240:e+120,t,n),Su(e,t,n),Su(e<120?e+240:e-120,t,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Su(e,a,r){return(e<60?a+(r-a)*e/60:e<180?r:e<240?a+(r-a)*(240-e)/60:a)*255}function Eh(e){return typeof e=="string"?!!kr(e):!1}function Mo(e){var a=kr(e),r=[0,0,0,0];return a!=null&&(r[0]=a.r/255,r[1]=a.g/255,r[2]=a.b/255,r[3]=a.opacity),r}function cc(e){var a=e&&e[0],r=e&&e[1],n=e&&e[2],t=a+r*256+n*65536-1;return t}function uu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ja(e){var a=window.document.createElement("canvas"),r=a.getContext("2d");a.width=256,a.height=1;for(var n=null,t=r.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],f=0;f<e.colors.length;++f){var g=(e.positions[f]-o)/(u-o);t.addColorStop(g,e.colors[f])}return r.fillStyle=t,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),a=null,r=null,{data:n,width:256,height:1}}function rf(e,a){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var t=n.createLinearGradient(0,0,256,1),o=a[1]-a[0],u=0;u<e.colors.length;++u){var f=Math.max((e.positions[u]-a[0])/o,0);t.addColorStop(f,e.colors[u])}n.fillStyle=t,n.fillRect(0,0,256,1);var g=n.getImageData(0,0,256,1).data,E=tl(n,g);return r=null,n=null,E}function Yu(e){var a=window.document.createElement("canvas"),r=a.getContext("2d");a.width=256,a.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(t,o){var u=Mo(e.colors[o]);n.data[t*4+0]=u[0]*255,n.data[t*4+1]=u[1]*255,n.data[t*4+2]=u[2]*255,n.data[t*4+3]=u[3]*255}),a=null,r=null,n}function Vs(e){var a=window.document.createElement("canvas"),r=a.getContext("2d");r.globalAlpha=1,a.width=256,a.height=1;for(var n=256/e.colors.length,t=0;t<e.colors.length;t++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[t],r.moveTo(t*n,0),r.lineTo((t+1)*n,0),r.stroke();var o=r.getImageData(0,0,256,1).data,u=tl(r,o);return a=null,r=null,u}function yh(e,a){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var t=a[1]-a[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-a[0])/t*255,0),n.lineTo((e.positions[o+1]-a[0])/t*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,f=tl(n,u);return r=null,n=null,f}function tl(e,a){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=a[n+0],r.data[n+1]=a[n+1],r.data[n+2]=a[n+2],r.data[n+3]=a[n+3];return r}function vu(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var Ch={BACK:1029,FRONT:1028};function Hf(e){switch(e){case"GAODE1.x":return Ch.BACK;case"GAODE2.x":return Ch.BACK;case"MAPBOX":return Ch.FRONT;case"SIMPLE":return Ch.FRONT;case"GLOBEL":return Ch.BACK;case"DEBAULT":return Ch.FRONT;default:return Ch.FRONT}}var Vn=G(74902),gi=G(97685),Hp=G(74691),nf=G.n(Hp),Gc=G(50361),sd=G.n(Gc),Bu=G(23279),$d=G.n(Bu),rh=G(27361),Ah=G.n(rh),lp=G(51584),hl=G.n(lp),$f=G(18446),Th=G.n($f),_h=G(14293),nh=G.n(_h),$p=G(81763),cp=G.n($p),Mu=G(68630),af=G.n(Mu),hp=G(47037),ih=G.n(hp),fp=G(36719),Vh=G.n(fp),Nu=G(82492),Wf=G.n(Nu),Sf=G(30236),ko=G.n(Sf),rl=G(97019),pp=G.n(rl),jo=G(23493),hc=G.n(jo),_u=G(44908),mu=G.n(_u),Mh=G(11700),ud=G.n(Mh),of=G(23560),Eu=G.n(of),dp=G(13218),Wp=G.n(dp),Ph=G(52353),wd=G.n(Ph),Xp=G(68929),vp=G.n(Xp),Ga={isNil:nh(),merge:Wf(),throttle:hc(),isString:ih(),debounce:$d(),pull:pp(),isTypedArray:Vh(),isPlainObject:af(),isNumber:cp(),isBoolean:hl(),isEqual:Th(),cloneDeep:sd(),uniq:mu(),clamp:nf(),upperFirst:ud(),get:Ah(),mergeWith:ko(),isFunction:Eu(),isObject:Wp(),isUndefined:wd(),camelCase:vp()},mp=Ga.pull;function Hc(e){var a=e;return typeof e=="string"&&(a=window.document.getElementById(e)),a}function gp(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function sf(e){return gp(e).split(/\s+/)}function ah(e){var a,r,n=(a=document)===null||a===void 0||(r=a.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var t in e)if(e[t]&&e[t]in n)return e[t];return e[0]}function wo(e,a,r){var n=window.document.createElement(e);return a&&(n.className=a||""),r&&r.appendChild(n),n}function fl(e){var a=e.parentNode;a&&a.removeChild(e)}function pl(e,a){if(e.classList!==void 0)for(var r=sf(a),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!Xf(e,a)){var o=Gh(e);yp(e,(o?o+" ":"")+a)}}function bh(e,a){if(e.classList!==void 0){var r=sf(a);r.forEach(function(n){e.classList.remove(n)})}else yp(e,gp((" "+Gh(e)+" ").replace(" "+a+" "," ")))}function Xf(e,a){if(e.classList!==void 0)return e.classList.contains(a);var r=Gh(e);return r.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(r)}function yp(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Gh(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Vu(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Yf=ah(["transform","WebkitTransform"]);function Ll(e,a){e.style[Yf]=a}function uf(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Pp(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function kh(){var e,a=window.document.querySelector('meta[name="viewport"]');if(!a)return 1;var r=(e=a.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,gi.Z)(o,1),f=u[0];return f==="initial-scale"});return n?n.split("=")[1]*1:1}var Xs=kh()<1?1:window.devicePixelRatio;function qf(e,a){e.setAttribute("style","".concat(e.style.cssText).concat(a))}function _p(e){return e.split(";").map(function(a){return a.trim()}).filter(function(a){return a})}function bp(e,a){var r,n=_p((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=_p(a),o=mp.apply(void 0,[n].concat((0,Vn.Z)(t)));e.setAttribute("style",o.join(";"))}function Yp(e){return Object.entries(e).map(function(a){var r=(0,gi.Z)(a,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function kp(e,a){return{left:e.left-a.left,top:e.top-a.top,right:a.left+a.width-e.left-e.width,bottom:a.top+a.height-e.top-e.height}}function xp(e,a){e.checked=a,a?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Kl(e){e.innerHTML=""}function $c(e){e.setAttribute("draggable","false")}function Rl(e,a){if(typeof a=="string"){var r=document.createElement("div");for(r.innerHTML=a;r.firstChild;)e.append(r.firstChild)}else Array.isArray(a)?e.append.apply(e,(0,Vn.Z)(a)):e.append(a)}function Ms(e,a){for(var r=Array.isArray(a)?a:[a],n=e;n instanceof Element&&n!==window.document.body;){var t,o;if(r.find(function(u){var f;return(f=n)===null||f===void 0?void 0:f.matches(u)}))return n;n=(t=(o=n)===null||o===void 0?void 0:o.parentElement)!==null&&t!==void 0?t:null}}var Hh;function lf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Ef(){return typeof importScripts=="function"}var vs=Ef()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Ns=(Hh=navigator)===null||Hh===void 0?void 0:Hh.userAgent,bc=!!Ns.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),fc=Ns.indexOf("Android")>-1||Ns.indexOf("Adr")>-1;function xc(){for(var e=Ns,a=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,t=a;n<t.length;n++){var o=t[n];if(e.indexOf(o)>0){r=!1;break}}return r}var Pe=G(4942);function Ih(e,a){e.forEach(function(r){a[r]&&(a[r]=a[r].bind(a))})}var cf=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,Be.Z)(this,e),(0,Pe.Z)(this,"duration",16),(0,Pe.Z)(this,"timestamp",new Date().getTime()),this.duration=a}return(0,Me.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),t=n-this.timestamp;this.timestamp=n,t>=this.duration&&r()}}]),e}();function Cf(e){var a=[1/0,1/0,-1/0,-1/0];return on(e,function(r){a[0]>r[0]&&(a[0]=r[0]),a[1]>r[1]&&(a[1]=r[1]),a[2]<r[0]&&(a[2]=r[0]),a[3]<r[1]&&(a[3]=r[1])}),a}Cf.default=Cf;var Af=Cf;function Lh(e){return typeof e=="number"}var Cu=2*Math.PI*6378137/2;function nl(e,a){var r=(0,gi.Z)(a,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function Wc(e){var a=[1/0,1/0,-1/0,-1/0];return e.forEach(function(r){var n=r.coordinates;zi(a,n)}),a}function zi(e,a){return Array.isArray(a[0])?a.forEach(function(r){zi(e,r)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Ui(e,a){return Gu(e,a)}function Gu(e,a){return Array.isArray(e[0])?e.map(function(r){return Gu(r,a)}):a(e)}function $h(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=hf(e,a);var n=e[0],t=e[1],o=n*Cu/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Cu/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Wh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Cu*180,o=n/Cu*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(t=Number(t.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[t,o,e[2]]:[t,o]}function ji(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Ic(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function hf(e,a){if(a===!1)return e;var r=ji(e[0]),n=Ic(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Gn(e){var a=85.0511287798,r=Math.max(Math.min(a,e[1]),-a),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var f=.5/Math.PI,g=.5,E=-.5/Math.PI;return t=.5,o=n*(f*o+g),u=n*(E*u+t),[Math.floor(o),Math.floor(u)]}function ld(e){var a=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=(0,gi.Z)(e,2),f=u[0],g=u[1];f=(f/o-r)/a,g=(g/o-t)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,t=Math.PI/180;var E=g/t,R=f/t;return[R,E]}function xh(e,a){var r=85.0511287798,n=Math.PI/180,t=6378137;return a=Math.max(Math.min(r,a),-r),e*=n,a*=n,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*t,a*t]}function Xh(e,a){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(a/n))-Math.PI/4)/r;return[t,o]}function wh(e,a,r){var n=zr(a[1]-e[1]),t=zr(a[0]-e[0]),o=zr(e[1]),u=zr(a[1]),f=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Za(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),r="meters")}function oh(e){var a=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*a),u=n*e[0]*a,f=n*Math.log((1+o)/(1-o))/2;return[u,f]}function ff(e,a){var r=Math.abs(e[1][1]-e[0][1])*a,n=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Tf(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function Jl(e){return[[e[0],e[1]],[e[2],e[3]]]}function wc(e){var a=Ql(e,[0,0]);return[e[0]/a,e[1]/a]}function Ql(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function Yh(e,a){return e[0]*a[0]+e[1]*a[1]}function Mf(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function pf(e,a){return Math.acos(Yh(e,a)/(Mf(e)*Mf(a)))*180/Math.PI}function Lc(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function _l(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],f=e[o+1],g=Ql(u,f);n+=g;var E=[u[0]-f[0],u[1]-f[1]],R=Lc(r,E);if(o>0){var B=t[o-1].rotation;B-R>360-B+R&&(R=R+360)}t.push({start:u,end:f,dis:g,rotation:R,duration:0})}return t.map(function(Y){Y.duration=a*(Y.dis/n)}),t}}function xo(e){if(Lh(e[0]))return e;if(Lh(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Lh(e[0][0][0])){var a=e,r=0,n=0,t=0;return a.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Dl(e){for(var a=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,f=0,g=0;g<e.length;g+=2){var E=e[g],R=e[g+1];E&&R&&(a=Math.max(E,a),r=Math.max(R,r),n=Math.min(E,n),t=Math.min(R,t),o+=E,u+=R,f++)}return{center:[o/f,u/f],radius:Math.sqrt(Math.pow(a-n,2)+Math.pow(r-t,2))/2}}function Po(e){return Af(po([na(e)]))}function dl(e){var a=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*a+e.charCodeAt(o);return n}function Kf(e){e=e.toString();for(var a=5381,r=e.length;r;)a=a*33^e.charCodeAt(--r);return a>>>0}function Pf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=Math.random()*16|0,r=e==="x"?a:a&3|8;return r.toString(16)})}var Sc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Ec(e,a,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,f=r;return u&&(f=Math.round(r*(o-1))/(o-1)),n?Da(e,a,f,n,t):Da(e,a,f,.314,t)}function Al(e,a){var r=1-a;return(e[0]*r+e[1]*a)*r+(e[1]*r+e[2]*a)*a}function aa(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function ta(e,a,r){var n=[a[0]-e[0],a[1]-e[1]],t=aa(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),f=o+r,g=[u*Math.cos(f)+e[0],u*Math.sin(f)+e[1]];return g}function Da(e,a,r,n,t){if(t===Sc["GAODE2.x"]){var o=xh(e[0],e[1]),u=xh(a[0],a[1]),f=ta(o,u,n),g=[o[0],f[0],u[0]],E=[o[1],f[1],u[1]];return[].concat((0,Vn.Z)(Xh(Al(g,r),Al(E,r))),[0])}else{var R=ta(e,a,n),B=[e[0],R[0],a[0]],Y=[e[1],R[1],a[1]];return[Al(B,r),Al(Y,r),0]}}function ba(e,a,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,f=r;return u&&(f=Math.round(r*29)/29),Pu(e,a,f,t)}function bl(e,a){var r=[a[0]-e[0],a[1]-e[1]],n=Ql(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),f=t+o,g=[u*Math.cos(f)+e[0],u*Math.sin(f)+e[1]];return g}function jl(e,a){var r=1-a;return(e[0]*r+e[1]*a)*r+(e[1]*r+e[2]*a)*a}function df(e,a){var r=[e[0]-a[0],e[1]-a[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(a[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Pu(e,a,r,n){var t=[zr(e[0]),zr(e[1])],o=[zr(a[0]),zr(a[1])];if(n==="GAODE2.x"){var u=bl(t,o),f=[t[0],u[0],o[0]],g=[t[1],u[1],o[1]];return[jl(f,r),jl(g,r),0]}else{var E=df(t,o);if(Math.abs(E-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var R=Math.sin((1-r)*E)/Math.sin(E),B=Math.sin(r*E)/Math.sin(E),Y=[Math.sin(t[0]),Math.sin(t[1])],Q=[Math.cos(t[0]),Math.cos(t[1])],ce=[Math.sin(o[0]),Math.sin(o[1])],fe=[Math.cos(o[0]),Math.cos(o[1])],Te=R*Q[1]*Q[0]+B*fe[1]*fe[0],Ve=R*Q[1]*Y[0]+B*fe[1]*ce[0],st=R*Y[1]+B*ce[1];return[Ua(Math.atan2(Ve,Te)),Ua(Math.atan2(st,Math.sqrt(Te*Te+Ve*Ve)))]}}function Rh(e,a){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],f=vl(o,u),g=r;r+=f,n.push({p1:o,p2:u,totalDistance:r,distance:f,lastTotalDistance:g})}for(var E=r*a,R,B,Y=0,Q=n;Y<Q.length;Y++){var ce=Q[Y],fe=ce.totalDistance;if(fe>E){var Te=ce.p1,Ve=ce.p2,st=(E-ce.lastTotalDistance)/ce.distance,at=ho(Ve,Te,st);R=at[0],B=at[1];break}}return{lng:R,lat:B,height:0}}function ho(e,a,r){return[e[0]*r+a[0]*(1-r),e[1]*r+a[1]*(1-r)]}function vl(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function kf(e,a){var r=a.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=il(t,a);return(0,Ee.Z)((0,Ee.Z)({},t),o)})}function Zu(e,a){return new Promise(function(r){e.inited?r(kf(e,a)):e.once("update",function(){r(kf(e,a))})})}function il(e,a){var r=a.offset,n=a.shape,t=a.thetaOffset,o=a.mapVersion,u=a.segmentNumber,f=u===void 0?30:u,g=a.autoFit,E=g===void 0?!0:g,R=e.coordinates;if(n==="line")return Rh(R,r);var B=R[0],Y=R[1],Q=typeof t=="string"?e[t]||0:t,ce;switch(n){case"arc":ce=Ec;break;case"greatcircle":ce=ba;break;default:ce=Ec}var fe=ce(B,Y,r,Q,o,f,E),Te=(0,gi.Z)(fe,3),Ve=Te[0],st=Te[1],at=Te[2];return{lng:Ve,lat:st,height:at}}var sh=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,Be.Z)(this,e),this.limit=a,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Me.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function ec(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],r=1;r<e.length;r++)e[r]>a&&(a=e[r]);return a*1}function If(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],r=1;r<e.length;r++)e[r]<a&&(a=e[r]);return a*1}function Rc(e){if(e.length===0)return 0;for(var a=e[0]*1,r=1;r<e.length;r++)a+=e[r]*1;return a}function Cc(e){if(e.length===0)throw new Error("mean requires at least one data point");return Rc(e)/e.length}function Lf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==a?(t>n&&(n=t,r=a),t=1,a=e[o]):t++;return r*1}var Dh={min:If,max:ec,mean:Cc,sum:Rc,mode:Lf};function wp(e,a){return e.map(function(r){return r[a]})}function Jf(e,a){return Dh[e](a)}var mr=G(15861),D=G(97326),h=G(64687),x=G.n(h);function O(e,a){a===void 0&&(a={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],f=[r,o],g=[t,o],E=[t,n];return pi([[u,E,g,f,u]],a.properties,{bbox:e,id:a.id})}var Z=G(26729),H=G.n(Z),ae=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),ue=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),ge=0,Le=1,m=2;function w(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function _(e){e.forEach(function(a){a.properties.state=ge}),e.forEach(function(a){a.isCurrent&&!N(a)&&$(a)}),e.forEach(function(a){a.isVisible=!!(a.properties.state&m)})}function T(e){e.forEach(function(r){r.properties.state=ge}),e.forEach(function(r){r.isCurrent&&N(r)});var a=e.slice().sort(function(r,n){return r.z-n.z});a.forEach(function(r){r.isVisible=!!(r.properties.state&m),r.children.length&&(r.isVisible||r.properties.state&Le)?r.children.forEach(function(n){n.properties.state=Le}):r.isCurrent&&$(r)})}function N(e){for(;e;){if(e.isLoaded)return e.properties.state|=m,!0;e=e.parent}return!1}function $(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=m:$(a)})}var X,oe=256,xe=[-1/0,-1/0,1/0,1/0],ye=.2,De=5,He=(X={},(0,Pe.Z)(X,ae.Realtime,w),(0,Pe.Z)(X,ae.Overlap,_),(0,Pe.Z)(X,ae.Replace,T),X),$e=function(){};function ft(e,a,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function pt(e,a,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*a/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var wt=function(a,r,n){var t=pt(a,r,n),o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=pt(a+1,r+1,n),E=(0,gi.Z)(g,2),R=E[0],B=E[1];return[u,B,R,f]};function dt(e){var a=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?1/0:n,o=e.minZoom,u=o===void 0?0:o,f=e.zoomOffset,g=f===void 0?0:f,E=e.extent,R=E===void 0?xe:E,B=Math.ceil(a)+g;if(Number.isFinite(u)&&B<u)return[];Number.isFinite(t)&&B>t&&(B=t);for(var Y=(0,gi.Z)(r,4),Q=Y[0],ce=Y[1],fe=Y[2],Te=Y[3],Ve=[Math.max(Q,R[0]),Math.max(ce,R[1]),Math.min(fe,R[2]),Math.min(Te,R[3])],st=[],at=ft(Ve[0],Ve[1],B),Tt=(0,gi.Z)(at,2),kt=Tt[0],Yt=Tt[1],cr=ft(Ve[2],Ve[3],B),Mr=(0,gi.Z)(cr,2),Dr=Mr[0],sn=Mr[1],rn=kt;rn<=Dr;rn++)for(var Jn=sn;Jn<=Yt;Jn++)st.push({x:rn,y:Jn,z:B});var fi=(Dr+kt)/2,Hi=(Yt+sn)/2,Ds=function($s,Pc){return Math.abs($s-fi)+Math.abs(Pc-Hi)};return st.sort(function(pu,$s){return Ds(pu.x,pu.y)-Ds($s.x,$s.y)}),st}var Ft=function(a,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,f=o,g=a,E=r;return t&&(g<0?g=g+f:g>u&&(g=g%f)),{warpX:g,warpY:E}};function ar(e){var a=nr();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function nr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ir=function(e){(0,yt.Z)(r,e);var a=ar(r);function r(n){var t;(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"tileSize",256),(0,Pe.Z)((0,D.Z)(t),"isVisible",!1),(0,Pe.Z)((0,D.Z)(t),"isCurrent",!1),(0,Pe.Z)((0,D.Z)(t),"isVisibleChange",!1),(0,Pe.Z)((0,D.Z)(t),"loadedLayers",0),(0,Pe.Z)((0,D.Z)(t),"isLayerLoaded",!1),(0,Pe.Z)((0,D.Z)(t),"isLoad",!1),(0,Pe.Z)((0,D.Z)(t),"isChildLoad",!1),(0,Pe.Z)((0,D.Z)(t),"parent",null),(0,Pe.Z)((0,D.Z)(t),"children",[]),(0,Pe.Z)((0,D.Z)(t),"data",null),(0,Pe.Z)((0,D.Z)(t),"properties",{}),(0,Pe.Z)((0,D.Z)(t),"loadDataId",0);var o=n.x,u=n.y,f=n.z,g=n.tileSize,E=n.warp,R=E===void 0?!0:E;return t.x=o,t.y=u,t.z=f,t.warp=R||!0,t.tileSize=g,t}return(0,Me.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===ue.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===ue.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===ue.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===ue.Cancelled}},{key:"isDone",get:function(){return[ue.Loaded,ue.Cancelled,ue.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return wt(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,gi.Z)(this.bounds,4),o=t[0],u=t[1],f=t[2],g=t[3],E=[(f-o)/2,(g-u)/2],R=O(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:E,meta:`
      `.concat(this.key,`
      `)}});return R}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr;return x().wrap(function(Dr){for(;;)switch(Dr.prev=Dr.next){case 0:return f=u.getData,g=u.onLoad,E=u.onError,this.loadDataId++,R=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=ue.Loading,B=null,Dr.prev=7,Q=this.x,ce=this.y,fe=this.z,Te=this.bounds,Ve=this.tileSize,st=this.warp,at=Ft(Q,ce,fe,st),Tt=at.warpX,kt=at.warpY,Yt=this.abortController.signal,cr={x:Tt,y:kt,z:fe,bounds:Te,tileSize:Ve,signal:Yt,warp:st},Dr.next=14,f(cr,this);case 14:B=Dr.sent,Dr.next=20;break;case 17:Dr.prev=17,Dr.t0=Dr.catch(7),Y=Dr.t0;case 20:if(R===this.loadDataId){Dr.next=22;break}return Dr.abrupt("return");case 22:if(!(this.isCancelled&&!B)){Dr.next=24;break}return Dr.abrupt("return");case 24:if(!(Y||!B)){Dr.next=28;break}return this.loadStatus=ue.Failure,E(Y,this),Dr.abrupt("return");case 28:this.loadStatus=ue.Loaded,this.data=B,g(this);case 31:case"end":return Dr.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=ue.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Z.EventEmitter),_r=function(a,r){var n=Jl(a),t=ff(n,r),o=360*3-180,u=85.0511287798065,f=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return f},Qr=function(a,r){var n=Jl(a),t=Jl(r),o=Tf(n,t);return o};function nn(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ln(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function Ln(e,a){if(e){if(typeof e=="string")return Mn(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mn(e,a)}}function Mn(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function yi(e){var a=Ri();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qi=Ga.throttle,Vi=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),ao=function(e){(0,yt.Z)(r,e);var a=yi(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"currentTiles",[]),(0,Pe.Z)((0,D.Z)(t),"cacheTiles",new Map),(0,Pe.Z)((0,D.Z)(t),"throttleUpdate",Qi(function(o,u){t.update(o,u)},16)),(0,Pe.Z)((0,D.Z)(t),"onTileLoad",function(o){t.emit(Vi.TileLoaded,o),t.updateTileVisible(),t.loadFinished()}),(0,Pe.Z)((0,D.Z)(t),"onTileError",function(o,u){t.emit(Vi.TileError,{error:o,tile:u}),t.updateTileVisible(),t.loadFinished()}),(0,Pe.Z)((0,D.Z)(t),"onTileUnload",function(o){t.emit(Vi.TileUnload,o),t.loadFinished()}),t.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:xe,getTileData:$e,warp:!0,updateStrategy:ae.Replace},t.updateOptions(n),t}return(0,Me.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,f=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===f&&Qr(this.lastViewStates.latLonBoundsBuffer,o))){var g=_r(o,ye);this.lastViewStates={zoom:f,latLonBounds:o,latLonBoundsBuffer:g},this.currentZoom=f;var E=!1,R=this.getTileIndices(f,g).filter(function(B){return u.options.warp||B.x>=0&&B.x<Math.pow(2,f)});this.emit(Vi.TilesLoadStart),this.currentTiles=R.map(function(B){var Y=B.x,Q=B.y,ce=B.z,fe=u.getTile(Y,Q,ce);if(fe){var Te,Ve,st=((Te=fe)===null||Te===void 0?void 0:Te.isFailure)||((Ve=fe)===null||Ve===void 0?void 0:Ve.isCancelled);return st&&fe.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),fe}return fe=u.createTile(Y,Q,ce),E=!0,fe}),E&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=nn(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,gi.Z)(o.value,2),f=u[0],g=u[1];if(!this.currentTiles.includes(g)){this.cacheTiles.delete(f),this.onTileUnload(g);return}this.onTileUnload(g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(E){t.e(E)}finally{t.f()}}},{key:"reloadTileById",value:function(t,o,u){var f=this.cacheTiles.get("".concat(o,",").concat(u,",").concat(t));f&&(this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,o,u){var f=this.getTileByLngLat(t,o,u);f&&this.reloadTileById(f.z,f.x,f.y)}},{key:"reloadTileByExtent",value:function(t,o){var u=this,f=this.getTileIndices(o,t);f.forEach(function(g){u.reloadTileById(g.z,g.x,g.y)})}},{key:"pruneRequests",value:function(){var t=[],o=nn(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var f=u.value;f.isLoading&&!f.isCurrent&&!f.isVisible&&t.push(f)}}catch(E){o.e(E)}finally{o.f()}for(;t.length>0;){var g=t.shift();g.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var f=this.options.zoomOffset,g=Math.ceil(u)+f,E=ft(t,o,g),R=this.tiles.filter(function(B){return B.key==="".concat(E[0],"_").concat(E[1],"_").concat(g)});return R[0]}},{key:"getTileExtent",value:function(t,o){return this.getTileIndices(o,t)}},{key:"getTileByZXY",value:function(t,o,u){var f=this.tiles.filter(function(g){return g.key==="".concat(o,"_").concat(u,"_").concat(t)});return f[0]}},{key:"clear",value:function(){var t=nn(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading?u.abortLoad():this.onTileUnload(u)}}catch(f){t.e(f)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=nn(this.cacheTiles.values()),f;try{for(u.s();!(f=u.n()).done;){var g=f.value;o.set(g.key,g.isVisible),g.isCurrent=!1,g.isVisible=!1}}catch(ce){u.e(ce)}finally{u.f()}var E=nn(this.currentTiles),R;try{for(E.s();!(R=E.n()).done;){var B=R.value;B.isCurrent=!0,B.isVisible=!0}}catch(ce){E.e(ce)}finally{E.f()}var Y=Array.from(this.cacheTiles.values());typeof t=="function"?t(Y):He[t](Y);var Q=!1;Array.from(this.cacheTiles.values()).forEach(function(ce){ce.isVisible!==o.get(ce.key)?(ce.isVisibleChange=!0,Q=!0):ce.isVisibleChange=!1}),Q&&this.emit(Vi.TileUpdate)}},{key:"getTileIndices",value:function(t,o){var u=this.options,f=u.tileSize,g=u.extent,E=u.zoomOffset,R=Math.floor(this.options.maxZoom),B=Math.ceil(this.options.minZoom),Y=dt({maxZoom:R,minZoom:B,zoomOffset:E,tileSize:f,zoom:t,latLonBounds:o,extent:g});return Y}},{key:"getTileId",value:function(t,o,u){var f="".concat(t,",").concat(o,",").concat(u);return f}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some(function(o){return!o.isDone});return t&&this.emit(Vi.TilesLoadFinished),t}},{key:"getTile",value:function(t,o,u){var f=this.getTileId(t,o,u),g=this.cacheTiles.get(f);return g}},{key:"createTile",value:function(t,o,u){var f=this.getTileId(t,o,u),g=new Ir({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(f,g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),g}},{key:"resizeCacheTiles",value:function(){var t=De*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=nn(this.cacheTiles),f;try{for(u.s();!(f=u.n()).done;){var g=(0,gi.Z)(f.value,2),E=g[0],R=g[1];if(!R.isVisible&&!this.currentTiles.includes(R)&&(this.cacheTiles.delete(E),this.onTileUnload(R)),this.cacheTiles.size<=t)break}}catch(B){u.e(B)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=nn(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(B){t.e(B)}finally{t.f()}var f=nn(this.cacheTiles.values()),g;try{for(f.s();!(g=f.n()).done;){var E=g.value,R=this.getNearestAncestor(E.x,E.y,E.z);E.parent=R,R!=null&&R.children&&R.children.push(E)}}catch(B){f.e(B)}finally{f.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var f=this.getTile(t,o,u);if(f)return f}return null}}]),r}(H());function Bi(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function oa(e){var a=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)a.push(e.replace(r[0],String.fromCharCode(o)));return a}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),f=parseInt(r[1],10);f<=u;f++)a.push(e.replace(r[0],f.toString()));return a}return a.push(e),a}function Ha(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=a.x,n=a.y,t=a.z,o=oa(e),u=Math.abs(r+n)%o.length,f=ni(o[u])?"".concat(o[u],"/{z}/{x}/{y}"):o[u];return f.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,wt(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function ja(e,a){var r=a.x,n=a.y,t=a.z,o=a.layer,u=a.version,f=u===void 0?"1.0.0":u,g=a.style,E=g===void 0?"default":g,R=a.format,B=a.service,Y=B===void 0?"WMTS":B,Q=a.tileMatrixset,ce="".concat(e,"&SERVICE=").concat(Y,"&REQUEST=GetTile&VERSION=").concat(f,"&LAYER=").concat(o,"&STYLE=").concat(E,"&TILEMATRIXSET=").concat(Q,"&FORMAT=").concat(R,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return ce}function Sa(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var Qa={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},eo=Qa.self||Qa.window||{},va=Qa.window||Qa.self||{},tu=Qa.self||Qa.window||{},Gs=Qa.document||{},Tl=typeof importScripts=="function",Ps=typeof window!="undefined"&&typeof window.orientation!="undefined",Qo=function(){function e(a,r){var n=this;this.name=a,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(a,r){this.workerThread.postMessage({source:"Main thread",type:a,payload:r})},e.prototype.done=function(a){Sa(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){Sa(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),Zs=Qo,Hs=new Map;function Uu(e){Sa(e.source&&!e.url||!e.source&&e.url);var a=Hs.get(e.source||e.url);return a||(e.url&&(a=uh(e.url),Hs.set(e.url,a)),e.source&&(a=pc(e.source),Hs.set(e.source,a))),Sa(a),a}function uh(e){if(!e.startsWith("http"))return e;var a=Xc(e);return pc(a)}function pc(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function Xc(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Yc(e,a,r){a===void 0&&(a=!0);var n=r||new Set;if(e){if(Qf(e))n.add(e);else if(Qf(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var t in e)Yc(e[t],a,n)}}return r===void 0?Array.from(n):[]}function Qf(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var dc=function(){},vc=function(){function e(a){this.terminated=!1,this.loadableURL="";var r=a.name,n=a.source,t=a.url;Sa(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=dc,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=dc,this.onError=dc,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,r){r=r||Yc(a),this.worker.postMessage(a,r)},e.prototype.getErrorFromErrorEvent=function(a){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",a.message&&(r+=a.message+" in "),a.lineno&&(r+=":"+a.lineno+":"+a.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=Uu({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?a.onMessage(n.data):a.onError(new Error("No data received"))},r.onerror=function(n){a.onError(a.getErrorFromErrorEvent(n)),a.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+a.name+", message error: "+n)},r},e}(),Dc=vc,Vl=function(){return Vl=Object.assign||function(e){for(var a,r=1,n=arguments.length;r<n;r++){a=arguments[r];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},Vl.apply(this,arguments)},Gl=function(e,a,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function f(R){try{E(n.next(R))}catch(B){u(B)}}function g(R){try{E(n.throw(R))}catch(B){u(B)}}function E(R){R.done?o(R.value):t(R.value).then(f,g)}E((n=n.apply(e,a||[])).next())})},vf=function(e,a){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(E){return function(R){return g([E,R])}}function g(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=E[0]&2?t.return:E[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,E[1])).done)return o;switch(t=0,o&&(E=[E[0]&2,o.value]),E[0]){case 0:case 1:o=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,t=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!o||E[1]>o[0]&&E[1]<o[3])){r.label=E[1];break}if(E[0]===6&&r.label<o[1]){r.label=o[1],o=E;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(E);break}o[2]&&r.ops.pop(),r.trys.pop();continue}E=a.call(e,r)}catch(R){E=[6,R],t=0}finally{n=o=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},mc=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=Vl(Vl({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),Gl(this,void 0,void 0,function(){var t,o=this;return vf(this,function(u){switch(u.label){case 0:return t=new Promise(function(f){return o.jobQueue.push({name:a,onMessage:r,onError:n,onStart:f}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Gl(this,void 0,void 0,function(){var a,r,n;return vf(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:a}),n=new Zs(r.name,a),a.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},a.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Dc({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Ps?this.maxMobileConcurrency:this.maxConcurrency},e}(),Hl=mc,lh=function(){return lh=Object.assign||function(e){for(var a,r=1,n=arguments.length;r<n;r++){a=arguments[r];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},lh.apply(this,arguments)},Os=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,r=a&&e[a],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},ch={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Es=function(){function e(a){this.workerPools=new Map,this.props=lh({},ch),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Dc.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,r;try{for(var n=Os(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){a={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var r,n;this.props=lh(lh({},this.props),a);try{for(var t=Os(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(f){r={error:f}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(a){var r=a.name,n=a.source,t=a.url,o=this.workerPools.get(r);return o||(o=new Hl({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Ol=Es,ml=new Map,mf=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(r){if(ep(r)){var n=r.data,t=n.type,o=n.payload;a(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var r=ml.get(a);r||(r=function(n){if(ep(n)){var t=n.data,o=t.type,u=t.payload;a(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(a){var r=ml.get(a);ml.delete(a),self.removeEventListener("message",r)},e.postMessage=function(a,r){if(self){var n={source:"Worker thread",type:a,payload:r},t=Yc(r);self.postMessage(n,t)}},e}(),ku=null;function ep(e){var a=e.type,r=e.data;return a==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function cd(e){return JSON.parse(qh(e))}function qh(e){var a=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(a.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}a.add(n)}return n})}function Rd(e){return""+e.name}function Rf(e,a){a===void 0&&(a={});var r=a[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return a._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var hd=function(e,a,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function f(R){try{E(n.next(R))}catch(B){u(B)}}function g(R){try{E(n.throw(R))}catch(B){u(B)}}function E(R){R.done?o(R.value):t(R.value).then(f,g)}E((n=n.apply(e,a||[])).next())})},Sd=function(e,a){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(E){return function(R){return g([E,R])}}function g(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=E[0]&2?t.return:E[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,E[1])).done)return o;switch(t=0,o&&(E=[E[0]&2,o.value]),E[0]){case 0:case 1:o=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,t=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!o||E[1]>o[0]&&E[1]<o[3])){r.label=E[1];break}if(E[0]===6&&r.label<o[1]){r.label=o[1],o=E;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(E);break}o[2]&&r.ops.pop(),r.trys.pop();continue}E=a.call(e,r)}catch(R){E=[6,R],t=0}finally{n=o=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};function Ip(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function Fl(e,a,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),hd(this,void 0,void 0,function(){var t,o,u,f,g,E,R,B;return Sd(this,function(Y){switch(Y.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),f=u.getWorkerPool({name:t,url:o}),g=r.jobName||e.name,[4,f.startJob(g,Wd.bind(null,n))];case 1:return E=Y.sent(),R=removeNontransferableOptions(r),E.postMessage("process",{input:a,options:R}),[4,E.result];case 2:return B=Y.sent(),[2,B.result]}})})}function Wd(e,a,r,n){return hd(this,void 0,void 0,function(){var t,o,u,f,g,E,R;return Sd(this,function(B){switch(B.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(n),[3,9];case 2:return a.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,f=n.options,B.label=4;case 4:return B.trys.push([4,6,,7]),e.process?[4,e.process(u,f)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return g=B.sent(),a.postMessage("done",{id:o,result:g}),[3,7];case 6:return E=B.sent(),R=E instanceof Error?E.message:"unknown error",a.postMessage("error",{id:o,error:R}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),B.label=9;case 9:return[2]}})})}var Qm=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();a instanceof Error?r.reject(a):r.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){a._settlers.push({resolve:n,reject:t})})},e}(),Tv=null,Mv=function(e,a,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function f(R){try{E(n.next(R))}catch(B){u(B)}}function g(R){try{E(n.throw(R))}catch(B){u(B)}}function E(R){R.done?o(R.value):t(R.value).then(f,g)}E((n=n.apply(e,a||[])).next())})},Dd=function(e,a){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(E){return function(R){return g([E,R])}}function g(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=E[0]&2?t.return:E[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,E[1])).done)return o;switch(t=0,o&&(E=[E[0]&2,o.value]),E[0]){case 0:case 1:o=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,t=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!o||E[1]>o[0]&&E[1]<o[3])){r.label=E[1];break}if(E[0]===6&&r.label<o[1]){r.label=o[1],o=E;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(E);break}o[2]&&r.ops.pop(),r.trys.pop();continue}E=a.call(e,r)}catch(R){E=[6,R],t=0}finally{n=o=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},Pv=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],r;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(f,g){u=e[o](u),t(f,g,u.done,u.value)})}}function t(o,u,f,g){Promise.resolve(g).then(function(E){o({value:E,done:f})},u)}},fd=0,jv,hh;function dv(e,a){var r=this;if(typeof self!="undefined"){var n={process:Df};WorkerBody.onmessage=function(t,o){return Mv(r,void 0,void 0,function(){var u,f,g,E,R,B,Y,Q,ce,fe,Te;return Dd(this,function(Ve){switch(Ve.label){case 0:switch(Ve.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return f=Ve.sent(),WorkerBody.postMessage("done",{result:f}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");jv=new AsyncQueue,hh=o.options||{},g=a(jv,hh,n),Ve.label=4;case 4:Ve.trys.push([4,9,10,15]),E=Pv(g),Ve.label=5;case 5:return[4,E.next()];case 6:if(R=Ve.sent(),!!R.done)return[3,8];B=R.value,WorkerBody.postMessage("output-batch",{result:B}),Ve.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return Y=Ve.sent(),fe={error:Y},[3,15];case 10:return Ve.trys.push([10,,13,14]),R&&!R.done&&(Te=E.return)?[4,Te.call(E)]:[3,12];case 11:Ve.sent(),Ve.label=12;case 12:return[3,14];case 13:if(fe)throw fe.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return jv.push(o.input),[3,18];case 17:return jv.close(),[3,18];case 18:return[3,20];case 19:return Q=Ve.sent(),ce=Q instanceof Error?Q.message:"",WorkerBody.postMessage("error",{error:ce}),[3,20];case 20:return[2]}})})}}}function Df(e,a){return a===void 0&&(a={}),new Promise(function(r,n){var t=fd++,o=function(f,g){if(g.id===t)switch(f){case"done":WorkerBody.removeEventListener(o),r(g.result);break;case"error":WorkerBody.removeEventListener(o),n(g.error);break;default:}};WorkerBody.addEventListener(o);var u={id:t,input:e,options:a};WorkerBody.postMessage("process",u)})}var Xd=function(e,a,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function f(R){try{E(n.next(R))}catch(B){u(B)}}function g(R){try{E(n.throw(R))}catch(B){u(B)}}function E(R){R.done?o(R.value):t(R.value).then(f,g)}E((n=n.apply(e,a||[])).next())})},Yd=function(e,a){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(E){return function(R){return g([E,R])}}function g(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=E[0]&2?t.return:E[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,E[1])).done)return o;switch(t=0,o&&(E=[E[0]&2,o.value]),E[0]){case 0:case 1:o=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,t=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!o||E[1]>o[0]&&E[1]<o[3])){r.label=E[1];break}if(E[0]===6&&r.label<o[1]){r.label=o[1],o=E;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(E);break}o[2]&&r.ops.pop(),r.trys.pop();continue}E=a.call(e,r)}catch(R){E=[6,R],t=0}finally{n=o=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},Vv={};function lm(e,a,r){return a===void 0&&(a=null),r===void 0&&(r={}),Xd(this,void 0,void 0,function(){return Yd(this,function(n){switch(n.label){case 0:return a&&(e=Om(e,a,r)),Vv[e]=Vv[e]||Fm(e),[4,Vv[e]];case 1:return[2,n.sent()]}})})}function Om(e,a,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Fm(e){return Xd(this,void 0,void 0,function(){var a,r,n;return Yd(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=t.sent(),[4,a.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,cm(n,e)]}})})}function cm(e,a){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=a;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var hm="0.0.3",zm={id:"null",name:"null",module:"web-worker-helper",options:{}};function qd(e){var a=e.color;return!a||!a.length?[1,1,1,1]:a}function Sp(e,a,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Ed(e){var a=e.filter;return a?[1]:[0]}function qu(e,a){return[a]}var fh=G(9187),Oh=G.n(fh),Ku=1e-6,Ml=typeof Float32Array!="undefined"?Float32Array:Array,qp=Math.random;function kv(e){Ml=e}var Kd=Math.PI/180;function Ju(e){return e*Kd}function Od(e,a){return Math.abs(e-a)<=Ku*Math.max(1,Math.abs(e),Math.abs(a))}Math.hypot||(Math.hypot=function(){for(var e=0,a=arguments.length;a--;)e+=arguments[a]*arguments[a];return Math.sqrt(e)});function _s(){var e=new Ml(2);return Ml!=Float32Array&&(e[0]=0,e[1]=0),e}function vv(e){var a=new glMatrix.ARRAY_TYPE(2);return a[0]=e[0],a[1]=e[1],a}function Ac(e,a){var r=new Ml(2);return r[0]=e,r[1]=a,r}function Sh(e,a){return e[0]=a[0],e[1]=a[1],e}function Lp(e,a,r){return e[0]=a,e[1]=r,e}function Tc(e,a,r){return e[0]=a[0]+r[0],e[1]=a[1]+r[1],e}function Of(e,a,r){return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e}function Fd(e,a,r){return e[0]=a[0]*r[0],e[1]=a[1]*r[1],e}function Oc(e,a,r){return e[0]=a[0]/r[0],e[1]=a[1]/r[1],e}function zd(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e}function yg(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e}function Gv(e,a,r){return e[0]=Math.min(a[0],r[0]),e[1]=Math.min(a[1],r[1]),e}function fm(e,a,r){return e[0]=Math.max(a[0],r[0]),e[1]=Math.max(a[1],r[1]),e}function Ff(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e}function mv(e,a,r){return e[0]=a[0]*r,e[1]=a[1]*r,e}function gc(e,a,r,n){return e[0]=a[0]+r[0]*n,e[1]=a[1]+r[1]*n,e}function Hv(e,a){var r=a[0]-e[0],n=a[1]-e[1];return Math.hypot(r,n)}function pm(e,a){var r=a[0]-e[0],n=a[1]-e[1];return r*r+n*n}function Cd(e){var a=e[0],r=e[1];return Math.hypot(a,r)}function dm(e){var a=e[0],r=e[1];return a*a+r*r}function gf(e,a){return e[0]=-a[0],e[1]=-a[1],e}function Jd(e,a){return e[0]=1/a[0],e[1]=1/a[1],e}function Kh(e,a){var r=a[0],n=a[1],t=r*r+n*n;return t>0&&(t=1/Math.sqrt(t)),e[0]=a[0]*t,e[1]=a[1]*t,e}function qc(e,a){return e[0]*a[0]+e[1]*a[1]}function Bd(e,a,r){var n=a[0]*r[1]-a[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function zf(e,a,r,n){var t=a[0],o=a[1];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e}function gv(e,a){a=a||1;var r=glMatrix.RANDOM()*2*Math.PI;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e}function eg(e,a,r){var n=a[0],t=a[1];return e[0]=r[0]*n+r[2]*t,e[1]=r[1]*n+r[3]*t,e}function Fh(e,a,r){var n=a[0],t=a[1];return e[0]=r[0]*n+r[2]*t+r[4],e[1]=r[1]*n+r[3]*t+r[5],e}function yf(e,a,r){var n=a[0],t=a[1];return e[0]=r[0]*n+r[3]*t+r[6],e[1]=r[1]*n+r[4]*t+r[7],e}function tc(e,a,r){var n=a[0],t=a[1];return e[0]=r[0]*n+r[4]*t+r[12],e[1]=r[1]*n+r[5]*t+r[13],e}function _f(e,a,r,n){var t=a[0]-r[0],o=a[1]-r[1],u=Math.sin(n),f=Math.cos(n);return e[0]=t*f-o*u+r[0],e[1]=t*u+o*f+r[1],e}function $v(e,a){var r=e[0],n=e[1],t=a[0],o=a[1],u=Math.sqrt(r*r+n*n)*Math.sqrt(t*t+o*o),f=u&&(r*t+n*o)/u;return Math.acos(Math.min(Math.max(f,-1),1))}function vm(e){return e[0]=0,e[1]=0,e}function zl(e){return"vec2("+e[0]+", "+e[1]+")"}function Wv(e,a){return e[0]===a[0]&&e[1]===a[1]}function al(e,a){var r=e[0],n=e[1],t=a[0],o=a[1];return Math.abs(r-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(t))&&Math.abs(n-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))}var Xv=null,Qd=Of,yv=null,_g=null,mm=null,bg=null,Kp=null,Bm=function(){var e=_s();return function(a,r,n,t,o,u){var f,g;for(r||(r=2),n||(n=0),t?g=Math.min(t*r+n,a.length):g=a.length,f=n;f<g;f+=r)e[0]=a[f],e[1]=a[f+1],o(e,e,u),a[f]=e[0],a[f+1]=e[1];return a}}(),Ad=_s(),ev=_s(),Fc=_s(),tp=_s(),Nd=_s();function ze(e,a,r,n,t){Tc(e,r,n),Kh(e,e),a=Ac(-e[1],e[0]);var o=Ac(-r[1],r[0]);return[t/qc(a,o),a]}function At(e,a){return Lp(e,-a[1],a[0])}function Gt(e,a,r){return Qd(e,a,r),Kh(e,e),e}function fn(e,a){return e[0]===a[0]&&e[1]===a[1]}function Dn(e){for(var a=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(r,1),r++):a.set(n,n)}return e}var ln=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Be.Z)(this,e),(0,Pe.Z)(this,"lastFlip",-1),(0,Pe.Z)(this,"miter",Ac(0,0)),(0,Pe.Z)(this,"started",!1),(0,Pe.Z)(this,"dash",!1),(0,Pe.Z)(this,"totalDistance",0),(0,Pe.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Me.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,f=1;f<o;f++){var g,E,R,B=r[f-1];B.push((g=n[f-1][2])!==null&&g!==void 0?g:0);var Y=n[f-1],Q=r[f];Q.push((E=n[f][2])!==null&&E!==void 0?E:0);var ce=n[f],fe=f<r.length-1?[].concat((0,Vn.Z)(r[f+1]),[(R=n[f+1][2])!==null&&R!==void 0?R:0]):null,Te=f<n.length-1?n[f+1]:null,Ve=this.segment_gaode2(t,u,B,Q,fe,Y,ce,Te);u+=Ve}if(this.dash)for(var st=0;st<t.positions.length/6;st++)t.positions[st*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,f=1;f<o;f++){var g,E,R,B=r[f-1];B.push((g=n[f-1][2])!==null&&g!==void 0?g:0);var Y=n[f-1],Q=r[f];Q.push((E=n[f][2])!==null&&E!==void 0?E:0);var ce=n[f],fe=f<r.length-1?[].concat((0,Vn.Z)(r[f+1]),[(R=n[f+1][2])!==null&&R!==void 0?R:0]):null,Te=f<n.length-1?n[f+1]:null,Ve=this.simpleSegment(t,u,B,Q,fe,Y,ce,Te);u+=Ve}if(this.dash)for(var st=0;st<t.positions.length/6;st++)t.positions[st*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var f=r[u-1],g=r[u],E=u<r.length-1?r[u+1]:null,R=this.segment(n,o,f,g,E);o+=R}if(this.dash)for(var B=0;B<n.positions.length/6;B++)n.positions[B*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var f=r[u-1],g=r[u],E=u<r.length-1?r[u+1]:null,R=this.simpleSegment(n,o,f,g,E);o+=R}if(this.dash)for(var B=0;B<n.positions.length/6;B++)n.positions[B*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,f,g,E){var R=0,B=r.indices,Y=r.positions,Q=r.normals,ce=this.cap==="square",fe=this.join==="bevel",Te=Gn([g[0],g[1]]),Ve=Gn([f[0],f[1]]);Gt(Fc,o,t);var st=0;if(this.dash&&(st=this.lineSegmentDistance(Te,Ve),this.totalDistance+=st),this.normal||(this.normal=_s(),At(this.normal,Fc)),!this.started)if(this.started=!0,ce){var at=_s(),Tt=_s();Tc(at,this.normal,Fc),Tc(Tt,this.normal,Fc),Q.push(Tt[0],Tt[1],0),Q.push(at[0],at[1],0),Y.push(t[0],t[1],t[2]|0,this.totalDistance-st,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(t[0],t[1],t[2]|0,this.totalDistance-st,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Y,Q,t,this.normal,this.thickness,this.totalDistance-st);if(B.push(n+0,n+1,n+2),u){fn(o,u)&&Tc(u,o,Kh(u,Of(u,o,t))),Gt(tp,u,o);var cr=ze(Nd,_s(),Fc,tp,this.thickness),Mr=(0,gi.Z)(cr,2),Dr=Mr[0],sn=Mr[1],rn=qc(Nd,this.normal)<0?-1:1,Jn=fe;if(!Jn&&this.join==="miter"){var fi=Dr;fi>this.miterLimit&&(Jn=!0)}Jn?(Q.push(this.normal[0],this.normal[1],0),Q.push(sn[0],sn[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,B.push.apply(B,(0,Vn.Z)(this.lastFlip!==-rn?[n,n+2,n+3]:[n+2,n+1,n+3])),B.push(n+2,n+3,n+4),At(Ad,tp),Sh(this.normal,Ad),Q.push(this.normal[0],this.normal[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,R+=3):(this.extrusions(Y,Q,o,sn,Dr,this.totalDistance),B.push.apply(B,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),rn=-1,Sh(this.normal,sn),R+=2),this.lastFlip=rn}else{if(At(this.normal,Fc),ce){var kt=_s(),Yt=_s();Qd(Yt,Fc,this.normal),Tc(kt,Fc,this.normal),Q.push(Yt[0],Yt[1],0),Q.push(kt[0],kt[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Y,Q,o,this.normal,this.thickness,this.totalDistance);B.push.apply(B,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),R+=2}return R}},{key:"simpleSegment",value:function(r,n,t,o,u){var f=0,g=r.indices,E=r.positions,R=r.normals,B=Gn([o[0],o[1]]),Y=Gn([t[0],t[1]]);Gt(Fc,B,Y);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(B,Y),this.totalDistance+=Q),this.normal||(this.normal=_s(),At(this.normal,Fc)),this.started||(this.started=!0,this.extrusions(E,R,t,this.normal,this.thickness,this.totalDistance-Q)),g.push(n+0,n+1,n+2),!u)At(this.normal,Fc),this.extrusions(E,R,o,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),f+=2;else{var ce=Gn([u[0],u[1]]);fn(B,ce)&&Tc(ce,B,Kh(ce,Of(ce,B,Y))),Gt(tp,ce,B);var fe=ze(Nd,_s(),Fc,tp,this.thickness),Te=(0,gi.Z)(fe,2),Ve=Te[0],st=Te[1],at=qc(Nd,this.normal)<0?-1:1;this.extrusions(E,R,o,st,Ve,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),at=-1,Sh(this.normal,st),f+=2,this.lastFlip=at}return f}},{key:"segment",value:function(r,n,t,o,u){var f=0,g=r.indices,E=r.positions,R=r.normals,B=this.cap==="square",Y=this.join==="bevel",Q=Gn([o[0],o[1]]),ce=Gn([t[0],t[1]]);Gt(Fc,Q,ce);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(Q,ce),this.totalDistance+=fe),this.normal||(this.normal=_s(),At(this.normal,Fc)),!this.started)if(this.started=!0,B){var Te=_s(),Ve=_s();Tc(Te,this.normal,Fc),Tc(Ve,this.normal,Fc),R.push(Ve[0],Ve[1],0),R.push(Te[0],Te[1],0),E.push(t[0],t[1],t[2]|0,this.totalDistance-fe,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),E.push(t[0],t[1],t[2]|0,this.totalDistance-fe,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,R,t,this.normal,this.thickness,this.totalDistance-fe);if(g.push(n+0,n+1,n+2),u){var Tt=Gn([u[0],u[1]]);fn(Q,Tt)&&Tc(Tt,Q,Kh(Tt,Of(Tt,Q,ce))),Gt(tp,Tt,Q);var kt=ze(Nd,_s(),Fc,tp,this.thickness),Yt=(0,gi.Z)(kt,2),cr=Yt[0],Mr=Yt[1],Dr=qc(Nd,this.normal)<0?-1:1,sn=Y;if(!sn&&this.join==="miter"){var rn=cr;rn>this.miterLimit&&(sn=!0)}sn?(R.push(this.normal[0],this.normal[1],0),R.push(Mr[0],Mr[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Vn.Z)(this.lastFlip!==-Dr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),At(Ad,tp),Sh(this.normal,Ad),R.push(this.normal[0],this.normal[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f+=3):(this.extrusions(E,R,o,Mr,cr,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Dr=-1,Sh(this.normal,Mr),f+=2),this.lastFlip=Dr}else{if(At(this.normal,Fc),B){var st=_s(),at=_s();Qd(at,Fc,this.normal),Tc(st,Fc,this.normal),R.push(at[0],at[1],0),R.push(st[0],st[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,R,o,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),f+=2}return f}},{key:"extrusions",value:function(r,n,t,o,u,f){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,f,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,f,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function _n(e){var a=e.coordinates,r=e.originCoordinates,n=e.version,t=new ln({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var f=0;f<o.length;f++){var g=o[f],E=u[f];t.extrude_gaode2(g,E)}}else{var R=a;R[0]&&!Array.isArray(R[0][0])&&(R=[a]),R.forEach(function(Y){t.extrude(Y)})}var B=t.complex;return{vertices:B.positions,indices:B.indices,normals:B.normals,indexes:B.indexes,size:6}}function Zn(e){var a=xo(e.coordinates);return{vertices:[].concat((0,Vn.Z)(a),(0,Vn.Z)(a),(0,Vn.Z)(a),(0,Vn.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function ri(e){var a=e.coordinates,r=Oh().flatten(a),n=r.vertices,t=r.dimensions,o=r.holes,u=Oh()(n,o,t);return{indices:u,vertices:n,size:t}}var Ci=function(){var e=(0,mr.Z)(x().mark(function a(r){var n,t,o,u,f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,f={a_Color:qd,a_Position:Sp,filter:Ed,a_vertexId:qu,a_PickingColor:function(fe){var Te=fe.id;return o?uu(Te):[0,0,0]},a_DistanceAndIndex:function(fe,Te,Ve,st,at,Tt){return Tt===void 0?[Ve[3],10]:[Ve[3],Tt]},a_Total_Distance:function(fe,Te,Ve){return[Ve[5]]},a_Size:function(fe){var Te=fe.size,Ve=Te===void 0?1:Te;return Array.isArray(Ve)?[Ve[0],Ve[1]]:[Ve,0]},a_Normal:function(fe,Te,Ve,st,at){return at},a_Miter:function(fe,Te,Ve){return[Ve[4]]},a_iconMapUV:function(fe){var Te=fe.texture,Ve=u[Te]||{x:0,y:0},st=Ve.x,at=Ve.y;return[st,at]}},g={sizePerElement:0,elements:[]},E=0,R=[],B=3,t.forEach(function(ce,fe){var Te=_n(ce),Ve=Te.indices,st=Te.vertices,at=Te.normals,Tt=Te.size,kt=Te.indexes;Ve.forEach(function(Dr){R.push(Dr+E)}),B=Tt;var Yt=st.length/Tt;g.sizePerElement=B,g.elements.push({featureIdx:fe,vertices:st,normals:at,offset:E}),E+=Yt;for(var cr=function(sn){var rn=(at==null?void 0:at.slice(sn*3,sn*3+3))||[],Jn=st.slice(sn*Tt,sn*Tt+Tt),fi=0;kt&&kt[sn]!==void 0&&(fi=kt[sn]),n.forEach(function(Hi){if(Hi&&f[Hi.name]){var Ds;(Ds=Hi.buffer.data).push.apply(Ds,(0,Vn.Z)(f[Hi.name](ce,fe,Jn,sn,rn,fi)))}})},Mr=0;Mr<Yt;Mr++)cr(Mr)}),Q.abrupt("return",{descriptors:n,featureLayout:g,indices:R});case 8:case"end":return Q.stop()}},a)}));return function(r){return e.apply(this,arguments)}}(),_i=function(){var e=(0,mr.Z)(x().mark(function a(r){var n,t,o,u,f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,f={a_Color:qd,a_Position:Sp,filter:Ed,a_vertexId:qu,a_PickingColor:function(fe){var Te=fe.id;return o?uu(Te):[0,0,0]},a_Shape:function(fe){var Te=fe.shape,Ve=Te===void 0?2:Te,st=u.indexOf(Ve);return[st]},a_Extrude:function(fe,Te,Ve,st){var at=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Tt=st%4*3;return[at[Tt],at[Tt+1],at[Tt+2]]},a_Size:function(fe){var Te=fe.size,Ve=Te===void 0?5:Te;return Array.isArray(Ve)?[Ve[0]]:[Ve]}},g={sizePerElement:0,elements:[]},E=0,R=[],B=3,t.forEach(function(ce,fe){var Te=Zn(ce),Ve=Te.indices,st=Te.vertices,at=Te.normals,Tt=Te.size,kt=Te.indexes;Ve.forEach(function(Dr){R.push(Dr+E)}),B=Tt;var Yt=st.length/Tt;g.sizePerElement=B,g.elements.push({featureIdx:fe,vertices:st,normals:at,offset:E}),E+=Yt;for(var cr=function(sn){var rn=(at==null?void 0:at.slice(sn*3,sn*3+3))||[],Jn=st.slice(sn*Tt,sn*Tt+Tt),fi=0;kt&&kt[sn]!==void 0&&(fi=kt[sn]),n.forEach(function(Hi){if(Hi&&f[Hi.name]){var Ds;(Ds=Hi.buffer.data).push.apply(Ds,(0,Vn.Z)(f[Hi.name](ce,fe,Jn,sn,rn,fi)))}})},Mr=0;Mr<Yt;Mr++)cr(Mr)}),Q.abrupt("return",{descriptors:n,featureLayout:g,indices:R});case 8:case"end":return Q.stop()}},a)}));return function(r){return e.apply(this,arguments)}}(),Li=function(){var e=(0,mr.Z)(x().mark(function a(r){var n,t,o,u,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:qd,a_Position:Sp,filter:Ed,a_vertexId:qu,a_PickingColor:function(ce){var fe=ce.id;return o?uu(fe):[0,0,0]}},f={sizePerElement:0,elements:[]},g=0,E=[],R=3,t.forEach(function(Q,ce){var fe=ri(Q),Te=fe.indices,Ve=fe.vertices,st=fe.normals,at=fe.size,Tt=fe.indexes;Te.forEach(function(Mr){E.push(Mr+g)}),R=at;var kt=Ve.length/at;f.sizePerElement=R,f.elements.push({featureIdx:ce,vertices:Ve,normals:st,offset:g}),g+=kt;for(var Yt=function(Dr){var sn=(st==null?void 0:st.slice(Dr*3,Dr*3+3))||[],rn=Ve.slice(Dr*at,Dr*at+at),Jn=0;Tt&&Tt[Dr]!==void 0&&(Jn=Tt[Dr]),n.forEach(function(fi){if(fi&&u[fi.name]){var Hi;(Hi=fi.buffer.data).push.apply(Hi,(0,Vn.Z)(u[fi.name](Q,ce,rn,Dr,sn,Jn)))}})},cr=0;cr<kt;cr++)Yt(cr)}),Y.abrupt("return",{descriptors:n,featureLayout:f,indices:E});case 8:case"end":return Y.stop()}},a)}));return function(r){return e.apply(this,arguments)}}(),Fi={pointFill:_i,line:Ci,polygonFill:Li},hi=(0,Ee.Z)({},Fi);function ki(e){return Wr.apply(this,arguments)}function Wr(){return Wr=_asyncToGenerator(_regeneratorRuntime.mark(function e(a){var r,n;return _regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=a.workerType,n=a.data,!hi[r]){o.next=3;break}return o.abrupt("return",hi[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Wr.apply(this,arguments)}var bn=new Map;function di(e,a){bn.set(e,a)}function Gi(e){var a=bn.get(e);return a}var Yn="l7-worker",ia=3,oi=!0;function Di(e){di(Yn,e)}function qn(){var e=Gi(Yn);if(!e)throw new Error("get worker failed by workerName: ".concat(Yn,"."));return e}function Ai(e,a){return Oa.apply(this,arguments)}function Oa(){return Oa=(0,mr.Z)(x().mark(function e(a,r){var n,t,o,u,f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n=qn(),t=Ol.getWorkerFarm({maxConcurrency:ia,reuseWorkers:oi}),o=t.getWorkerPool({name:Yn,source:n}),E.next=5,o.startJob(Yn,function(R,B,Y){return R.done(Y)});case 5:return u=E.sent,u.postMessage("process",{input:{workerType:a,data:r}}),E.next=9,u.result;case 9:return f=E.sent,E.abrupt("return",f.result);case 11:case"end":return E.stop()}},e)})),Oa.apply(this,arguments)}var Ya=G(38163),Oi=G.n(Ya);function Qn(e,a){return e.map(function(r){return r[a]*1})}function Hn(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function mo(e){return Array.isArray(e)?e.length===0?!1:!!Hn(e[0]):!1}function so(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function sa(e){var a=Object.isFrozen(e)?Ga.cloneDeep(e):e;return Oi()(a,!0),a}function Cs(e,a){var r=a.x,n=a.y,t=a.x1,o=a.y1,u=a.coordinates,f=a.geometry,g=[];if(!Array.isArray(e))return{dataArray:[]};if(f)return e.filter(function(Ve){return Ve[f]&&Ve[f].type&&Ve[f].coordinates&&Ve[f].coordinates.length>0}).forEach(function(Ve,st){var at=sa(Ve[f]);se(at,function(Tt){var kt=tr(Tt),Yt=(0,Ee.Z)((0,Ee.Z)({},Ve),{},{_id:st,coordinates:kt});g.push(Yt)})}),{dataArray:g};for(var E=0;E<e.length;E++){var R=e[E],B=[];if(u){var Y="Polygon";Array.isArray(u[0])||(Y="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(Y="LineString");var Q=sa({type:Y,coordinates:R[u]});B=Q.coordinates}else if(r&&n&&t&&o){var ce=[parseFloat(R[r]),parseFloat(R[n])],fe=[parseFloat(R[t]),parseFloat(R[o])];B=[ce,fe]}else r&&n&&(B=[parseFloat(R[r]),parseFloat(R[n])]);var Te=(0,Ee.Z)((0,Ee.Z)({},R),{},{_id:E,coordinates:B});g.push(Te)}return{dataArray:g}}function Vo(e,a){var r=Jt(e);return Cs(r,a)}var Go=G(71002);function Fs(e){for(var a=e.toString(),r=5381,n=a.length;n;)r=r*33^a.charCodeAt(--n);return r>>>0}function xl(e,a){return a===void 0?null:(0,Go.Z)(e.properties[a])*1==="number"?e.properties[a]*1:e.properties&&e.properties[a]?Fs(e.properties[a]+"")%1000019:null}function ks(e,a){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),e=sa(e),e.features.length===0?{dataArray:[],featureKeys:n}:(se(e,function(t,o){var u=xl(t,a==null?void 0:a.featureId);u===null&&(u=o);var f=u,g=tr(t),E=(0,Ee.Z)((0,Ee.Z)({},t.properties),{},{coordinates:g,_id:f});r.push(E)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function Ho(e,a,r,n){for(var t=n,o=r-a>>1,u=r-a,f,g=e[a],E=e[a+1],R=e[r],B=e[r+1],Y=a+3;Y<r;Y+=3){var Q=ss(e[Y],e[Y+1],g,E,R,B);if(Q>t)f=Y,t=Q;else if(Q===t){var ce=Math.abs(Y-o);ce<u&&(f=Y,u=ce)}}t>n&&(f-a>3&&Ho(e,a,f,n),e[f+2]=t,r-f>3&&Ho(e,f,r,n))}function ss(e,a,r,n,t,o){var u=t-r,f=o-n;if(u!==0||f!==0){var g=((e-r)*u+(a-n)*f)/(u*u+f*f);g>1?(r=t,n=o):g>0&&(r+=u*g,n+=f*g)}return u=e-r,f=a-n,u*u+f*f}function As(e,a,r,n){var t={id:typeof e=="undefined"?null:e,type:a,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Lo(t),t}function Lo(e){var a=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Pl(e,a);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<a.length;n++)Pl(e,a[n]);else if(r==="MultiPolygon")for(n=0;n<a.length;n++)for(var t=0;t<a[n].length;t++)Pl(e,a[n][t])}function Pl(e,a){for(var r=0;r<a.length;r+=3)e.minX=Math.min(e.minX,a[r]),e.minY=Math.min(e.minY,a[r+1]),e.maxX=Math.max(e.maxX,a[r]),e.maxY=Math.max(e.maxY,a[r+1])}function $l(e,a){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)bu(r,e.features[n],a,n);else e.type==="Feature"?bu(r,e,a):bu(r,{geometry:e},a);return r}function bu(e,a,r,n){if(a.geometry){var t=a.geometry.coordinates,o=a.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),f=[],g=a.id;if(r.promoteId?g=a.properties[r.promoteId]:r.generateId&&(g=n||0),o==="Point")Hu(t,f);else if(o==="MultiPoint")for(var E=0;E<t.length;E++)Hu(t[E],f);else if(o==="LineString")Du(t,f,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(E=0;E<t.length;E++)f=[],Du(t[E],f,u,!1),e.push(As(g,"LineString",f,a.properties));return}else Ro(t,f,u,!1);else if(o==="Polygon")Ro(t,f,u,!0);else if(o==="MultiPolygon")for(E=0;E<t.length;E++){var R=[];Ro(t[E],R,u,!0),f.push(R)}else if(o==="GeometryCollection"){for(E=0;E<a.geometry.geometries.length;E++)bu(e,{id:g,geometry:a.geometry.geometries[E],properties:a.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(As(g,o,f,a.properties))}}function Hu(e,a){a.push(Kc(e[0])),a.push(lu(e[1])),a.push(0)}function Du(e,a,r,n){for(var t,o,u=0,f=0;f<e.length;f++){var g=Kc(e[f][0]),E=lu(e[f][1]);a.push(g),a.push(E),a.push(0),f>0&&(n?u+=(t*E-g*o)/2:u+=Math.sqrt(Math.pow(g-t,2)+Math.pow(E-o,2))),t=g,o=E}var R=a.length-3;a[2]=1,Ho(a,0,R,r),a[R+2]=1,a.size=Math.abs(u),a.start=0,a.end=a.size}function Ro(e,a,r,n){for(var t=0;t<e.length;t++){var o=[];Du(e[t],o,r,n),a.push(o)}}function Kc(e){return e/360+.5}function lu(e){var a=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return r<0?0:r>1?1:r}function Fa(e,a,r,n,t,o,u,f){if(r/=a,n/=a,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var g=[],E=0;E<e.length;E++){var R=e[E],B=R.geometry,Y=R.type,Q=t===0?R.minX:R.minY,ce=t===0?R.maxX:R.maxY;if(Q>=r&&ce<n){g.push(R);continue}else if(ce<r||Q>=n)continue;var fe=[];if(Y==="Point"||Y==="MultiPoint")Ts(B,fe,r,n,t);else if(Y==="LineString")us(B,fe,r,n,t,!1,f.lineMetrics);else if(Y==="MultiLineString")zh(B,fe,r,n,t,!1);else if(Y==="Polygon")zh(B,fe,r,n,t,!0);else if(Y==="MultiPolygon")for(var Te=0;Te<B.length;Te++){var Ve=[];zh(B[Te],Ve,r,n,t,!0),Ve.length&&fe.push(Ve)}if(fe.length){if(f.lineMetrics&&Y==="LineString"){for(Te=0;Te<fe.length;Te++)g.push(As(R.id,Y,fe[Te],R.tags));continue}(Y==="LineString"||Y==="MultiLineString")&&(fe.length===1?(Y="LineString",fe=fe[0]):Y="MultiLineString"),(Y==="Point"||Y==="MultiPoint")&&(Y=fe.length===3?"Point":"MultiPoint"),g.push(As(R.id,Y,fe,R.tags))}}return g.length?g:null}function Ts(e,a,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(a.push(e[o]),a.push(e[o+1]),a.push(e[o+2]))}}function us(e,a,r,n,t,o,u){for(var f=Iu(e),g=t===0?qt:pn,E=e.start,R,B,Y=0;Y<e.length-3;Y+=3){var Q=e[Y],ce=e[Y+1],fe=e[Y+2],Te=e[Y+3],Ve=e[Y+4],st=t===0?Q:ce,at=t===0?Te:Ve,Tt=!1;u&&(R=Math.sqrt(Math.pow(Q-Te,2)+Math.pow(ce-Ve,2))),st<r?at>r&&(B=g(f,Q,ce,Te,Ve,r),u&&(f.start=E+R*B)):st>n?at<n&&(B=g(f,Q,ce,Te,Ve,n),u&&(f.start=E+R*B)):rp(f,Q,ce,fe),at<r&&st>=r&&(B=g(f,Q,ce,Te,Ve,r),Tt=!0),at>n&&st<=n&&(B=g(f,Q,ce,Te,Ve,n),Tt=!0),!o&&Tt&&(u&&(f.end=E+R*B),a.push(f),f=Iu(e)),u&&(E+=R)}var kt=e.length-3;Q=e[kt],ce=e[kt+1],fe=e[kt+2],st=t===0?Q:ce,st>=r&&st<=n&&rp(f,Q,ce,fe),kt=f.length-3,o&&kt>=3&&(f[kt]!==f[0]||f[kt+1]!==f[1])&&rp(f,f[0],f[1],f[2]),f.length&&a.push(f)}function Iu(e){var a=[];return a.size=e.size,a.start=e.start,a.end=e.end,a}function zh(e,a,r,n,t,o){for(var u=0;u<e.length;u++)us(e[u],a,r,n,t,o,!1)}function rp(e,a,r,n){e.push(a),e.push(r),e.push(n)}function qt(e,a,r,n,t,o){var u=(o-a)/(n-a);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function pn(e,a,r,n,t,o){var u=(o-r)/(t-r);return e.push(a+(n-a)*u),e.push(o),e.push(1),u}function en(e,a){var r=a.buffer/a.extent,n=e,t=Fa(e,1,-1-r,r,0,-1,2,a),o=Fa(e,1,1-r,2+r,0,-1,2,a);return(t||o)&&(n=Fa(e,1,-r,1+r,0,-1,2,a)||[],t&&(n=ua(t,1).concat(n)),o&&(n=n.concat(ua(o,-1)))),n}function ua(e,a){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=ls(t.geometry,a);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var f=0;f<t.geometry.length;f++)u.push(ls(t.geometry[f],a))}else if(o==="MultiPolygon")for(u=[],f=0;f<t.geometry.length;f++){for(var g=[],E=0;E<t.geometry[f].length;E++)g.push(ls(t.geometry[f][E],a));u.push(g)}r.push(As(t.id,o,u,t.tags))}return r}function ls(e,a){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+a,e[n+1],e[n+2]);return r}function Nt(e,a){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,f;for(o=0;o<e.features.length;o++){var g=e.features[o],E=g.geometry,R=g.type;if(g.geometry=[],R===1)for(u=0;u<E.length;u+=2)g.geometry.push(Et(E[u],E[u+1],a,r,n,t));else for(u=0;u<E.length;u++){var B=[];for(f=0;f<E[u].length;f+=2)B.push(Et(E[u][f],E[u][f+1],a,r,n,t));g.geometry.push(B)}}return e.transformed=!0,e}function Et(e,a,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(a*n-o))]}function gr(e,a,r,n,t){for(var o=a===t.maxZoom?0:t.tolerance/((1<<a)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:a,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},f=0;f<e.length;f++){u.numFeatures++,Vr(u,e[f],o,t);var g=e[f].minX,E=e[f].minY,R=e[f].maxX,B=e[f].maxY;g<u.minX&&(u.minX=g),E<u.minY&&(u.minY=E),R>u.maxX&&(u.maxX=R),B>u.maxY&&(u.maxY=B)}return u}function Vr(e,a,r,n){var t=a.geometry,o=a.type,u=[];if(o==="Point"||o==="MultiPoint")for(var f=0;f<t.length;f+=3)u.push(t[f]),u.push(t[f+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")$r(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(f=0;f<t.length;f++)$r(u,t[f],e,r,o==="Polygon",f===0);else if(o==="MultiPolygon")for(var g=0;g<t.length;g++){var E=t[g];for(f=0;f<E.length;f++)$r(u,E[f],e,r,!0,f===0)}if(u.length){var R=a.tags||null;if(o==="LineString"&&n.lineMetrics){R={};for(var B in a.tags)R[B]=a.tags[B];R.mapbox_clip_start=t.start/t.size,R.mapbox_clip_end=t.end/t.size}var Y={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:R};a.id!==null&&(Y.id=a.id),e.features.push(Y)}}function $r(e,a,r,n,t,o){var u=n*n;if(n>0&&a.size<(t?u:n)){r.numPoints+=a.length/3;return}for(var f=[],g=0;g<a.length;g+=3)(n===0||a[g+2]>u)&&(r.numSimplified++,f.push(a[g]),f.push(a[g+1])),r.numPoints++;t&&wr(f,o),e.push(f)}function wr(e,a){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===a)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],f=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=f}}function ur(e,a){return new Lr(e,a)}function Lr(e,a){a=this.options=lr(Object.create(this.options),a);var r=a.debug;if(r&&console.time("preprocess data"),a.maxZoom<0||a.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(a.promoteId&&a.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=$l(e,a);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",a.indexMaxZoom,a.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=en(n,a),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Lr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lr.prototype.splitTile=function(e,a,r,n,t,o,u){for(var f=[e,a,r,n],g=this.options,E=g.debug;f.length;){n=f.pop(),r=f.pop(),a=f.pop(),e=f.pop();var R=1<<a,B=Zt(a,r,n),Y=this.tiles[B];if(!Y&&(E>1&&console.time("creation"),Y=this.tiles[B]=gr(e,a,r,n,g),this.tileCoords.push({z:a,x:r,y:n}),E)){E>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",a,r,n,Y.numFeatures,Y.numPoints,Y.numSimplified),console.timeEnd("creation"));var Q="z"+a;this.stats[Q]=(this.stats[Q]||0)+1,this.total++}if(Y.source=e,t){if(a===g.maxZoom||a===t)continue;var ce=1<<t-a;if(r!==Math.floor(o/ce)||n!==Math.floor(u/ce))continue}else if(a===g.indexMaxZoom||Y.numPoints<=g.indexMaxPoints)continue;if(Y.source=null,e.length!==0){E>1&&console.time("clipping");var fe=.5*g.buffer/g.extent,Te=.5-fe,Ve=.5+fe,st=1+fe,at,Tt,kt,Yt,cr,Mr;at=Tt=kt=Yt=null,cr=Fa(e,R,r-fe,r+Ve,0,Y.minX,Y.maxX,g),Mr=Fa(e,R,r+Te,r+st,0,Y.minX,Y.maxX,g),e=null,cr&&(at=Fa(cr,R,n-fe,n+Ve,1,Y.minY,Y.maxY,g),Tt=Fa(cr,R,n+Te,n+st,1,Y.minY,Y.maxY,g),cr=null),Mr&&(kt=Fa(Mr,R,n-fe,n+Ve,1,Y.minY,Y.maxY,g),Yt=Fa(Mr,R,n+Te,n+st,1,Y.minY,Y.maxY,g),Mr=null),E>1&&console.timeEnd("clipping"),f.push(at||[],a+1,r*2,n*2),f.push(Tt||[],a+1,r*2,n*2+1),f.push(kt||[],a+1,r*2+1,n*2),f.push(Yt||[],a+1,r*2+1,n*2+1)}}},Lr.prototype.getTile=function(e,a,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;a=(a%u+u)%u;var f=Zt(e,a,r);if(this.tiles[f])return Nt(this.tiles[f],t);o>1&&console.log("drilling down to z%d-%d-%d",e,a,r);for(var g=e,E=a,R=r,B;!B&&g>0;)g--,E=Math.floor(E/2),R=Math.floor(R/2),B=this.tiles[Zt(g,E,R)];return!B||!B.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",g,E,R),o>1&&console.time("drilling down"),this.splitTile(B.source,g,E,R,e,a,r),o>1&&console.timeEnd("drilling down"),this.tiles[f]?Nt(this.tiles[f],t):null)};function Zt(e,a,r){return((1<<e)*r+a)*32+e}function lr(e,a){for(var r in a)e[r]=a[r];return e}var It=function(){function e(a,r,n,t){(0,Be.Z)(this,e),(0,Pe.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=a}return(0,Me.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Zr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Xr(e){for(var a=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],a+=(u.x-o.x)*(o.y+u.y);return a}function Rn(e){var a=e.length;if(a<=1)return[e];for(var r=[],n,t,o=0;o<a;o++){var u=Xr(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var dn=["Unknown","Point","LineString","Polygon"];function Pn(e,a,r,n,t){var o=t.geometry,u=t.type,f=t.tags,g=t.id,E=e*Math.pow(2,n),R=e*a,B=e*r,Y=dn[u],Q,ce;function fe(st){for(var at=0;at<st.length;at++){var Tt=st[at];if(Tt[3])break;var kt=180-(Tt[1]+B)*360/E,Yt=(Tt[0]+R)*360/E-180,cr=360/Math.PI*Math.atan(Math.exp(kt*Math.PI/180))-90;st[at]=[Yt,cr,0,1]}}switch(u){case 1:var Te=[];for(Q=0;Q<o.length;Q++)Te[Q]=o[Q][0];o=Te,fe(o);break;case 2:for(Q=0;Q<o.length;Q++)fe(o[Q]);break;case 3:for(o=Rn(o),Q=0;Q<o.length;Q++)for(ce=0;ce<o[Q].length;ce++)fe(o[Q][ce]);break}o.length===1?o=o[0]:Y="Multi"+Y;var Ve={type:"Feature",geometry:{type:Y,coordinates:o},properties:f,id:g,tileOrigin:[0,0],coord:""};return Ve}var vi=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(g){var E=n.getTile(r.z,r.x,r.y),R=E?E.features.map(function(Q){return Pn(o,t.x,t.y,t.z,Q)}):[],B={layers:{defaultLayer:{features:R}}},Y=new It(B,r.x,r.y,r.z);g(Y)}));case 1:case"end":return f.stop()}},a)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Ea(e){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?a:(0,Ee.Z)((0,Ee.Z)({},a),e.geojsonvtOptions)}function ts(e,a){var r=Ea(a),n=r.extent||4096,t=ur(e,r),o=function(g,E){return vi(E,t,g,n)},u=(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},Zr),a),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function ma(e,a){var r=a.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||lf(e)?u([e]):uo(e,function(f){u(f)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function uo(e,a){var r=e,n=[];if(typeof r=="string")Vc({url:r},function(u,f){f&&(n.push(f),a(n))});else{var t=r.length,o=0;r.forEach(function(u){Vc({url:u},function(f,g){o++,g&&n.push(g),o===t&&a(n)})})}return ma}var Do=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o){var u,f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u={x:n.x,y:n.y,z:n.z},f=Ha(r,u),E.abrupt("return",new Promise(function(R){o?o(u,function(B,Y){if(B||!Y){var Q={layers:{defaultLayer:{features:[]}}},ce=new It(Q,n.x,n.y,n.z);R(ce)}else{var fe={layers:{defaultLayer:{features:Y.features}}},Te=new It(fe,n.x,n.y,n.z);R(Te)}}):vo((0,Ee.Z)((0,Ee.Z)({},t),{},{url:f}),function(B,Y){if(B||!Y){var Q={layers:{defaultLayer:{features:[]}}},ce=new It(Q,n.x,n.y,n.z);R(ce)}else{var fe=JSON.parse(Y),Te={layers:{defaultLayer:{features:fe}}},Ve=new It(Te,n.x,n.y,n.z);R(Ve)}})}));case 3:case"end":return E.stop()}},a)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Ys(e,a){var r=function(o,u){return Do(e,u,a==null?void 0:a.requestParameters,a.getCustomData)},n=(0,Ee.Z)((0,Ee.Z)({},a),{},{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Wl=G(38929),bf=G(3614),Iv=G.n(bf),Bh=function(){function e(a,r,n,t){(0,Be.Z)(this,e),(0,Pe.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new Wl.VectorTile(new(Iv())(a))}return(0,Me.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),f=u.toGeoJSON(this.x,this.y,this.z);t.push((0,Ee.Z)((0,Ee.Z)({},f),{},{properties:(0,Ee.Z)({id:f.id},f.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Rp={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},ph=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o,u){var f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return f=Ha(r,n),E.abrupt("return",new Promise(function(R){if(u)u({x:t.x,y:t.y,z:t.z},function(Y,Q){if(Y||!Q)R(void 0);else{var ce=new Bh(Q,t.x,t.y,t.z);R(ce)}});else{var B=el((0,Ee.Z)((0,Ee.Z)({},o),{},{url:f}),function(Y,Q){if(Y||!Q)R(void 0);else{var ce=new Bh(Q,t.x,t.y,t.z);R(ce)}});t.xhrCancel=function(){return B.cancel()}}}));case 2:case"end":return E.stop()}},a)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function tv(e,a){var r=Array.isArray(e)?e[0]:e,n=function(u,f){return ph(r,u,f,a==null?void 0:a.requestParameters,a==null?void 0:a.getCustomData)},t=(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},Rp),a),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Td(e,a,r){switch(e){case"+":return a+r;case"-":return a-r;case"*":return a*r;case"/":return a/r;case"%":return a%r;case"^":return Math.pow(a,r);case"abs":return Math.abs(a);case"floor":return Math.floor(a);case"round":return Math.round(a);case"ceil":return Math.ceil(a);case"sin":return Math.sin(a);case"cos":return Math.cos(a);case"atan":return r===-1?Math.atan(a):Math.atan2(a,r);case"min":return Math.min(a,r);case"max":return Math.max(a,r);case"log10":return Math.log(a);case"log2":return Math.log2(a);default:return console.warn("Calculate symbol err! Return default 0"),0}}function _v(e,a){for(var r=a[0],n=r.width,t=r.height,o=a.map(function(Q){return Q.rasterData}),u=n*t,f=[],g=JSON.stringify(e),E=0;E<u;E++){var R=JSON.parse(g),B=Lv(R,o,E);if(typeof B=="number")f.push(B);else{var Y=rc(R);f.push(Y)}}return f}function Lv(e,a,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return a[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=a[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:Lv(n,a,r)}})}function gm(e){var a=(0,gi.Z)(e,3),r=a[0],n=a[1],t=n===void 0?-1:n,o=a[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var f=r.replace(/\s+/g,"");return[f,t,u]}function rc(e){var a=gm(e),r=a[0],n=a[1],t=a[2];return Array.isArray(n)&&(n=rc(e[1])),Array.isArray(t)&&(t=rc(e[2])),Td(r,n,t)}var wl={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Nm}};function Nm(e,a){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(a==null?void 0:a.countCut)||[2,98],f=(0,gi.Z)(u,2),g=f[0],E=f[1],R=(a==null?void 0:a.RMinMax)||Yv(r,g,E),B=(a==null?void 0:a.GMinMax)||Yv(n,g,E),Y=(a==null?void 0:a.BMinMax)||Yv(t,g,E),Q=0;Q<r.length;Q++)o.push(Math.max(0,r[Q]-R[0])),o.push(Math.max(0,n[Q]-B[0])),o.push(Math.max(0,t[Q]-Y[0]));return{rasterData:o,rMinMax:R,gMinMax:B,bMinMax:Y}}function Yv(e,a,r){var n=e.slice().sort(function(f,g){return f-g}),t=n.length,o=n[Math.ceil(t*a/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function rv(e,a,r){return ym.apply(this,arguments)}function ym(){return ym=(0,mr.Z)(x().mark(function e(a,r,n){var t,o,u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(a.length!==0){B.next=2;break}return B.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return B.next=4,Promise.all(a.map(function(Y){var Q=Y.data,ce=Y.bands,fe=ce===void 0?[0]:ce;return r(Q,fe)}));case 4:t=B.sent,o=[],t.forEach(function(Y){Array.isArray(Y)?o.push.apply(o,(0,Vn.Z)(Y)):o.push(Y)}),u=o[0],f=u.width,g=u.height,B.t0=(0,Go.Z)(n),B.next=B.t0==="function"?11:B.t0==="object"?13:15;break;case 11:return E=n(o),B.abrupt("break",16);case 13:return Array.isArray(n)?E={rasterData:_v(n,o)}:E=Zm(n,o),B.abrupt("break",16);case 15:E={rasterData:o[0].rasterData};case 16:return B.abrupt("return",(0,Ee.Z)((0,Ee.Z)({},E),{},{width:f,height:g}));case 17:case"end":return B.stop()}},e)})),ym.apply(this,arguments)}function Zm(e,a){var r=wl[e.type];if(r.type==="function")return r.method(a,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?Rv(r.expression,a):{rasterData:_v(r.expression,a)}}function Rv(e,a){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=_v(e.r||["band",0],a),n=_v(e.g||["band",0],a),t=_v(e.b||["band",0],a);return[r,n,t]}function Zd(e,a,r,n){return pd.apply(this,arguments)}function pd(){return pd=(0,mr.Z)(x().mark(function e(a,r,n,t){var o;return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,rv(a,r,n);case 2:o=f.sent,t(null,{data:o});case 4:case"end":return f.stop()}},e)})),pd.apply(this,arguments)}function _m(e,a){var r=a.extent,n=a.width,t=a.height,o=a.min,u=a.max,f=a.format,g=a.operation,E,R,B;if(f===void 0||so(e))E=Array.from(e),R=n,B=t;else{var Y=Array.isArray(e)?e:[e];E=rv(Y,f,g)}var Q={_id:1,dataArray:[{_id:1,data:E,width:R,height:B,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return Q}var Jc=G(28660),Ii=G(86700),Ud=G(84879),cn={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},nv=1e20,tg=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=a.fontSize,n=r===void 0?24:r,t=a.buffer,o=t===void 0?3:t,u=a.radius,f=u===void 0?8:u,g=a.cutoff,E=g===void 0?.25:g,R=a.fontFamily,B=R===void 0?"sans-serif":R,Y=a.fontWeight,Q=Y===void 0?"normal":Y,ce=a.fontStyle,fe=ce===void 0?"normal":ce;(0,Be.Z)(this,e),(0,Pe.Z)(this,"buffer",void 0),(0,Pe.Z)(this,"cutoff",void 0),(0,Pe.Z)(this,"radius",void 0),(0,Pe.Z)(this,"size",void 0),(0,Pe.Z)(this,"ctx",void 0),(0,Pe.Z)(this,"gridOuter",void 0),(0,Pe.Z)(this,"gridInner",void 0),(0,Pe.Z)(this,"f",void 0),(0,Pe.Z)(this,"z",void 0),(0,Pe.Z)(this,"v",void 0),this.buffer=o,this.cutoff=E,this.radius=f;var Te=this.size=n+o*4,Ve=this._createCanvas(Te),st=this.ctx=Ve.getContext("2d",{willReadFrequently:!0});st.font="".concat(fe," ").concat(Q," ").concat(n,"px ").concat(B),st.textBaseline="alphabetic",st.textAlign="left",st.fillStyle="black",this.gridOuter=new Float64Array(Te*Te),this.gridInner=new Float64Array(Te*Te),this.f=new Float64Array(Te),this.z=new Float64Array(Te+1),this.v=new Uint16Array(Te)}return(0,Me.Z)(e,[{key:"_createCanvas",value:function(r){var n=document.createElement("canvas");return n.width=n.height=r,n}},{key:"draw",value:function(r){var n=this.ctx.measureText(r),t=n.width,o=n.actualBoundingBoxAscent,u=n.actualBoundingBoxDescent,f=n.actualBoundingBoxLeft,g=n.actualBoundingBoxRight,E=Math.ceil(o),R=0,B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),Y=Math.min(this.size-this.buffer,E+Math.ceil(u)),Q=B+2*this.buffer,ce=Y+2*this.buffer,fe=Math.max(Q*ce,0),Te=new Uint8ClampedArray(fe),Ve={data:Te,width:Q,height:ce,glyphWidth:B,glyphHeight:Y,glyphTop:E,glyphLeft:R,glyphAdvance:t};if(B===0||Y===0)return Ve;var st=this.buffer,at=this.gridInner,Tt=this.gridOuter,kt=this.ctx;kt.clearRect(st,st,B,Y),kt.fillText(r,st,st+E);var Yt=kt.getImageData(st,st,B,Y);Tt.fill(nv,0,fe),at.fill(0,0,fe);for(var cr=0;cr<Y;cr++)for(var Mr=0;Mr<B;Mr++){var Dr=Yt.data[4*(cr*B+Mr)+3]/255;if(Dr!==0){var sn=(cr+st)*Q+Mr+st;if(Dr===1)Tt[sn]=0,at[sn]=nv;else{var rn=.5-Dr;Tt[sn]=rn>0?rn*rn:0,at[sn]=rn<0?rn*rn:0}}}bv(Tt,0,0,Q,ce,Q,this.f,this.v,this.z),bv(at,st,st,B,Y,Q,this.f,this.v,this.z);for(var Jn=0;Jn<fe;Jn++){var fi=Math.sqrt(Tt[Jn])-Math.sqrt(at[Jn]);Te[Jn]=Math.round(255-255*(fi/this.radius+this.cutoff))}return Ve}}]),e}();function bv(e,a,r,n,t,o,u,f,g){for(var E=a;E<a+n;E++)dd(e,r*o+E,o,t,u,f,g);for(var R=r;R<r+t;R++)dd(e,R*o+a,1,n,u,f,g)}function dd(e,a,r,n,t,o,u){o[0]=0,u[0]=-nv,u[1]=nv,t[0]=e[a];for(var f=1,g=0,E=0;f<n;f++){t[f]=e[a+f*r];var R=f*f;do{var B=o[g];E=(t[f]-t[B]+R-B*B)/(f-B)/2}while(E<=u[g]&&--g>-1);g++,o[g]=f,u[g]=E,u[g+1]=nv}for(var Y=0,Q=0;Y<n;Y++){for(;u[Q+1]<Y;)Q++;var ce=o[Q],fe=Y-ce;e[a+Y*r]=t[ce]+fe*fe}}function jd(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rg(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function rg(e,a){if(e){if(typeof e=="string")return Um(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Um(e,a)}}function Um(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var yc=30;function iv(e){var a=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,f=u===void 0?{}:u,g=e.xOffset,E=g===void 0?0:g,R=e.yOffset,B=R===void 0?0:R,Y=0,Q=E;Array.from(a).forEach(function(fe,Te){if(!f[fe]){var Ve=r(fe,Te);Q+yc>o&&(Q=0,Y++),f[fe]={x:Q,y:B+Y*yc,width:yc,height:yc,advance:Ve},Q+=yc}});var ce=n+t*2;return{mapping:f,xOffset:Q,yOffset:B+Y*ce,canvasHeight:s(B+(Y+1)*ce)}}function L(e,a,r){var n=0,t=0,o=0,u=[],f={},g=jd(e),E;try{for(g.s();!(E=g.n()).done;){var R=E.value;if(!f[R.id]){var B=R.size;n+B+a>r&&(i(f,u,t),n=0,t=o+t+a,o=0,u=[]),u.push({icon:R,xOffset:n}),n=n+B+a,o=Math.max(o,B)}}}catch(Q){g.e(Q)}finally{g.f()}u.length>0&&i(f,u,t);var Y=s(o+t+a);return{mapping:f,canvasHeight:Y}}function i(e,a,r){var n=jd(a),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,f=o.xOffset;e[u.id]=(0,Ee.Z)((0,Ee.Z)({},u),{},{x:f,y:r,image:u.image,width:u.width,height:u.height})}}catch(g){n.e(g)}finally{n.f()}}function s(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var l,p;function S(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=A(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function A(e,a){if(e){if(typeof e=="string")return I(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,a)}}function I(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function U(e){var a=q();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var re=pr(),de="sans-serif",we="normal",Oe=24,Ge=3,it=.25,tt=8,ct=1024,ut=1,Je=1,Pt=3,Xt=null;function pr(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function Ur(e,a,r,n){e.font="".concat(n," ").concat(r,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function tn(e,a){for(var r=0;r<e.length;r++)a.data[4*r+3]=e[r]}var An=(l=(0,Ii.b2)(),l(p=function(e){(0,yt.Z)(r,e);var a=U(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"fontAtlas",void 0),(0,Pe.Z)((0,D.Z)(n),"iconFontMap",void 0),(0,Pe.Z)((0,D.Z)(n),"iconFontGlyphs",{}),(0,Pe.Z)((0,D.Z)(n),"fontOptions",void 0),(0,Pe.Z)((0,D.Z)(n),"key",void 0),(0,Pe.Z)((0,D.Z)(n),"cache",new sh(Pt)),n}return(0,Me.Z)(r,[{key:"scale",get:function(){return Je}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var o=this.cache.get(t);return o&&o.data}},{key:"getMappingByKey",value:function(t){var o=this.cache.get(t);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:de,fontWeight:we,characterSet:re,fontSize:Oe,buffer:Ge,sdf:!0,cutoff:it,radius:tt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Ee.Z)((0,Ee.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var f=this.generateFontAtlas(this.key,o,u);this.fontAtlas=f,this.cache.set(this.key,f)}}},{key:"addFontFace",value:function(t,o){var u=this,f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),f.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(g){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(g)}},document.getElementsByTagName("head")[0].appendChild(f)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var f=this.fontOptions,g=f.fontFamily,E=f.fontWeight,R=f.fontSize,B=f.buffer,Y=f.sdf,Q=f.radius,ce=f.cutoff,fe=f.iconfont,Te=u&&u.data;Te||(Te=window.document.createElement("canvas"),Te.width=ct);var Ve=Te.getContext("2d",{willReadFrequently:!0});Ur(Ve,g,R,E);var st=iv((0,Ee.Z)({getFontWidth:function($0){return Ve.measureText($0).width},fontHeight:R*Je,buffer:B,characterSet:o,maxCanvasWidth:ct},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),at=st.mapping,Tt=st.canvasHeight,kt=st.xOffset,Yt=st.yOffset,cr=Ve.getImageData(0,0,Te.width,Te.height);if(Te.height=Tt,Ve.putImageData(cr,0,0),Ur(Ve,g,R,E),Y){var Mr=new tg({fontSize:R,buffer:B,radius:Q,cutoff:ce,fontFamily:g,fontWeight:E}),Dr=S(o),sn;try{for(Dr.s();!(sn=Dr.n()).done;){var rn=sn.value,Jn=void 0;if(fe){var fi=String.fromCharCode(parseInt(rn.replace("&#x","").replace(";",""),16));Jn=Mr.draw(fi)}else Jn=Mr.draw(rn);var Hi=Jn,Ds=Hi.data,pu=Hi.width,$s=Hi.height,Pc=Ve.getImageData(0,0,pu,$s);tn(Ds,Pc),Ve.putImageData(Pc,at[rn].x,at[rn].y)}}catch(Uv){Dr.e(Uv)}finally{Dr.f()}}else{var lc=S(o),up;try{for(lc.s();!(up=lc.n()).done;){var Xg=up.value;Ve.fillText(Xg,at[Xg].x,at[Xg].y+R*ut)}}catch(Uv){lc.e(Uv)}finally{lc.f()}}return{xOffset:kt,yOffset:Yt,mapping:at,data:Te,width:Te.width,height:Te.height}}},{key:"getKey",value:function(){var t=this.fontOptions,o=t.fontFamily,u=t.fontWeight;return"".concat(o,"_").concat(u)}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var f=[],g=u.mapping,E=new Set(Object.keys(g)),R=new Set(o);return R.forEach(function(B){E.has(B)||f.push(B)}),f}}]),r}(Z.EventEmitter))||p),xi,On;function si(e){var a=kn();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function kn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ci=3,wi=1024,$n=64,Si=(xi=(0,Ii.b2)(),xi(On=function(e){(0,yt.Z)(r,e);var a=si(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"canvasHeight",128),(0,Pe.Z)((0,D.Z)(n),"texture",void 0),(0,Pe.Z)((0,D.Z)(n),"canvas",void 0),(0,Pe.Z)((0,D.Z)(n),"iconData",void 0),(0,Pe.Z)((0,D.Z)(n),"iconMap",void 0),(0,Pe.Z)((0,D.Z)(n),"ctx",void 0),(0,Pe.Z)((0,D.Z)(n),"loadingImageCount",0),n}return(0,Me.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,mr.Z)(x().mark(function o(u,f){var g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return g=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:$n}),this.updateIconMap(),B.next=6,this.loadImage(f);case 6:g=B.sent,E=this.iconData.find(function(Y){return Y.id===u}),E&&(E.image=g,E.width=g.width,E.height=g.height),this.update();case 10:case"end":return B.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var f=this,g=u.getSceneConfig().canvas,E=g.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:$n}),this.updateIconMap(),this.loadImageMini(o,g).then(function(R){E=R;var B=f.iconData.find(function(Y){return Y.id===t});B&&(B.image=E,B.width=E.width,B.height=E.height),f.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var f=new Image;f.crossOrigin="anonymous",f.onload=function(){o(f)},f.onerror=function(){u(new Error("Could not load image at "+t))},f.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=wi,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],f=u.x,g=u.y,E=u.image,R=u.width,B=R===void 0?64:R,Y=u.height,Q=Y===void 0?64:Y,ce=Math.max(B,Q),fe=ce/$n,Te=Q/fe,Ve=B/fe;E&&t.ctx.drawImage(E,f+($n-Ve)/2,g+($n-Te)/2,Ve,Te)})}},{key:"updateIconMap",value:function(){var t=L(this.iconData,ci,wi),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,f){var g=o.createImage();g.crossOrigin="anonymous",g.onload=function(){u(g)},g.onerror=function(){f(new Error("Could not load image at "+t))},g.src=t})}}]),r}(Z.EventEmitter))||On);function Kn(){var e=new Ml(16);return Ml!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function la(e){var a=new Ml(16);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function yn(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function Ti(e,a,r,n,t,o,u,f,g,E,R,B,Y,Q,ce,fe){var Te=new Ml(16);return Te[0]=e,Te[1]=a,Te[2]=r,Te[3]=n,Te[4]=t,Te[5]=o,Te[6]=u,Te[7]=f,Te[8]=g,Te[9]=E,Te[10]=R,Te[11]=B,Te[12]=Y,Te[13]=Q,Te[14]=ce,Te[15]=fe,Te}function Aa(e,a,r,n,t,o,u,f,g,E,R,B,Y,Q,ce,fe,Te){return e[0]=a,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=f,e[7]=g,e[8]=E,e[9]=R,e[10]=B,e[11]=Y,e[12]=Q,e[13]=ce,e[14]=fe,e[15]=Te,e}function $o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lo(e,a){if(e===a){var r=a[1],n=a[2],t=a[3],o=a[6],u=a[7],f=a[11];e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=r,e[6]=a[9],e[7]=a[13],e[8]=n,e[9]=o,e[11]=a[14],e[12]=t,e[13]=u,e[14]=f}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e}function Oo(e,a){var r=a[0],n=a[1],t=a[2],o=a[3],u=a[4],f=a[5],g=a[6],E=a[7],R=a[8],B=a[9],Y=a[10],Q=a[11],ce=a[12],fe=a[13],Te=a[14],Ve=a[15],st=r*f-n*u,at=r*g-t*u,Tt=r*E-o*u,kt=n*g-t*f,Yt=n*E-o*f,cr=t*E-o*g,Mr=R*fe-B*ce,Dr=R*Te-Y*ce,sn=R*Ve-Q*ce,rn=B*Te-Y*fe,Jn=B*Ve-Q*fe,fi=Y*Ve-Q*Te,Hi=st*fi-at*Jn+Tt*rn+kt*sn-Yt*Dr+cr*Mr;return Hi?(Hi=1/Hi,e[0]=(f*fi-g*Jn+E*rn)*Hi,e[1]=(t*Jn-n*fi-o*rn)*Hi,e[2]=(fe*cr-Te*Yt+Ve*kt)*Hi,e[3]=(Y*Yt-B*cr-Q*kt)*Hi,e[4]=(g*sn-u*fi-E*Dr)*Hi,e[5]=(r*fi-t*sn+o*Dr)*Hi,e[6]=(Te*Tt-ce*cr-Ve*at)*Hi,e[7]=(R*cr-Y*Tt+Q*at)*Hi,e[8]=(u*Jn-f*sn+E*Mr)*Hi,e[9]=(n*sn-r*Jn-o*Mr)*Hi,e[10]=(ce*Yt-fe*Tt+Ve*st)*Hi,e[11]=(B*Tt-R*Yt-Q*st)*Hi,e[12]=(f*Dr-u*rn-g*Mr)*Hi,e[13]=(r*rn-n*Dr+t*Mr)*Hi,e[14]=(fe*at-ce*kt-Te*st)*Hi,e[15]=(R*kt-B*at+Y*st)*Hi,e):null}function So(e,a){var r=a[0],n=a[1],t=a[2],o=a[3],u=a[4],f=a[5],g=a[6],E=a[7],R=a[8],B=a[9],Y=a[10],Q=a[11],ce=a[12],fe=a[13],Te=a[14],Ve=a[15];return e[0]=f*(Y*Ve-Q*Te)-B*(g*Ve-E*Te)+fe*(g*Q-E*Y),e[1]=-(n*(Y*Ve-Q*Te)-B*(t*Ve-o*Te)+fe*(t*Q-o*Y)),e[2]=n*(g*Ve-E*Te)-f*(t*Ve-o*Te)+fe*(t*E-o*g),e[3]=-(n*(g*Q-E*Y)-f*(t*Q-o*Y)+B*(t*E-o*g)),e[4]=-(u*(Y*Ve-Q*Te)-R*(g*Ve-E*Te)+ce*(g*Q-E*Y)),e[5]=r*(Y*Ve-Q*Te)-R*(t*Ve-o*Te)+ce*(t*Q-o*Y),e[6]=-(r*(g*Ve-E*Te)-u*(t*Ve-o*Te)+ce*(t*E-o*g)),e[7]=r*(g*Q-E*Y)-u*(t*Q-o*Y)+R*(t*E-o*g),e[8]=u*(B*Ve-Q*fe)-R*(f*Ve-E*fe)+ce*(f*Q-E*B),e[9]=-(r*(B*Ve-Q*fe)-R*(n*Ve-o*fe)+ce*(n*Q-o*B)),e[10]=r*(f*Ve-E*fe)-u*(n*Ve-o*fe)+ce*(n*E-o*f),e[11]=-(r*(f*Q-E*B)-u*(n*Q-o*B)+R*(n*E-o*f)),e[12]=-(u*(B*Te-Y*fe)-R*(f*Te-g*fe)+ce*(f*Y-g*B)),e[13]=r*(B*Te-Y*fe)-R*(n*Te-t*fe)+ce*(n*Y-t*B),e[14]=-(r*(f*Te-g*fe)-u*(n*Te-t*fe)+ce*(n*g-t*f)),e[15]=r*(f*Y-g*B)-u*(n*Y-t*B)+R*(n*g-t*f),e}function cs(e){var a=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],f=e[6],g=e[7],E=e[8],R=e[9],B=e[10],Y=e[11],Q=e[12],ce=e[13],fe=e[14],Te=e[15],Ve=a*u-r*o,st=a*f-n*o,at=a*g-t*o,Tt=r*f-n*u,kt=r*g-t*u,Yt=n*g-t*f,cr=E*ce-R*Q,Mr=E*fe-B*Q,Dr=E*Te-Y*Q,sn=R*fe-B*ce,rn=R*Te-Y*ce,Jn=B*Te-Y*fe;return Ve*Jn-st*rn+at*sn+Tt*Dr-kt*Mr+Yt*cr}function Wo(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3],f=a[4],g=a[5],E=a[6],R=a[7],B=a[8],Y=a[9],Q=a[10],ce=a[11],fe=a[12],Te=a[13],Ve=a[14],st=a[15],at=r[0],Tt=r[1],kt=r[2],Yt=r[3];return e[0]=at*n+Tt*f+kt*B+Yt*fe,e[1]=at*t+Tt*g+kt*Y+Yt*Te,e[2]=at*o+Tt*E+kt*Q+Yt*Ve,e[3]=at*u+Tt*R+kt*ce+Yt*st,at=r[4],Tt=r[5],kt=r[6],Yt=r[7],e[4]=at*n+Tt*f+kt*B+Yt*fe,e[5]=at*t+Tt*g+kt*Y+Yt*Te,e[6]=at*o+Tt*E+kt*Q+Yt*Ve,e[7]=at*u+Tt*R+kt*ce+Yt*st,at=r[8],Tt=r[9],kt=r[10],Yt=r[11],e[8]=at*n+Tt*f+kt*B+Yt*fe,e[9]=at*t+Tt*g+kt*Y+Yt*Te,e[10]=at*o+Tt*E+kt*Q+Yt*Ve,e[11]=at*u+Tt*R+kt*ce+Yt*st,at=r[12],Tt=r[13],kt=r[14],Yt=r[15],e[12]=at*n+Tt*f+kt*B+Yt*fe,e[13]=at*t+Tt*g+kt*Y+Yt*Te,e[14]=at*o+Tt*E+kt*Q+Yt*Ve,e[15]=at*u+Tt*R+kt*ce+Yt*st,e}function Bo(e,a,r){var n=r[0],t=r[1],o=r[2],u,f,g,E,R,B,Y,Q,ce,fe,Te,Ve;return a===e?(e[12]=a[0]*n+a[4]*t+a[8]*o+a[12],e[13]=a[1]*n+a[5]*t+a[9]*o+a[13],e[14]=a[2]*n+a[6]*t+a[10]*o+a[14],e[15]=a[3]*n+a[7]*t+a[11]*o+a[15]):(u=a[0],f=a[1],g=a[2],E=a[3],R=a[4],B=a[5],Y=a[6],Q=a[7],ce=a[8],fe=a[9],Te=a[10],Ve=a[11],e[0]=u,e[1]=f,e[2]=g,e[3]=E,e[4]=R,e[5]=B,e[6]=Y,e[7]=Q,e[8]=ce,e[9]=fe,e[10]=Te,e[11]=Ve,e[12]=u*n+R*t+ce*o+a[12],e[13]=f*n+B*t+fe*o+a[13],e[14]=g*n+Y*t+Te*o+a[14],e[15]=E*n+Q*t+Ve*o+a[15]),e}function Xo(e,a,r){var n=r[0],t=r[1],o=r[2];return e[0]=a[0]*n,e[1]=a[1]*n,e[2]=a[2]*n,e[3]=a[3]*n,e[4]=a[4]*t,e[5]=a[5]*t,e[6]=a[6]*t,e[7]=a[7]*t,e[8]=a[8]*o,e[9]=a[9]*o,e[10]=a[10]*o,e[11]=a[11]*o,e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function Au(e,a,r,n){var t=n[0],o=n[1],u=n[2],f=Math.hypot(t,o,u),g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr,Mr,Dr,sn,rn,Jn,fi,Hi,Ds;return f<Ku?null:(f=1/f,t*=f,o*=f,u*=f,g=Math.sin(r),E=Math.cos(r),R=1-E,B=a[0],Y=a[1],Q=a[2],ce=a[3],fe=a[4],Te=a[5],Ve=a[6],st=a[7],at=a[8],Tt=a[9],kt=a[10],Yt=a[11],cr=t*t*R+E,Mr=o*t*R+u*g,Dr=u*t*R-o*g,sn=t*o*R-u*g,rn=o*o*R+E,Jn=u*o*R+t*g,fi=t*u*R+o*g,Hi=o*u*R-t*g,Ds=u*u*R+E,e[0]=B*cr+fe*Mr+at*Dr,e[1]=Y*cr+Te*Mr+Tt*Dr,e[2]=Q*cr+Ve*Mr+kt*Dr,e[3]=ce*cr+st*Mr+Yt*Dr,e[4]=B*sn+fe*rn+at*Jn,e[5]=Y*sn+Te*rn+Tt*Jn,e[6]=Q*sn+Ve*rn+kt*Jn,e[7]=ce*sn+st*rn+Yt*Jn,e[8]=B*fi+fe*Hi+at*Ds,e[9]=Y*fi+Te*Hi+Tt*Ds,e[10]=Q*fi+Ve*Hi+kt*Ds,e[11]=ce*fi+st*Hi+Yt*Ds,a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e)}function Wi(e,a,r){var n=Math.sin(r),t=Math.cos(r),o=a[4],u=a[5],f=a[6],g=a[7],E=a[8],R=a[9],B=a[10],Y=a[11];return a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[4]=o*t+E*n,e[5]=u*t+R*n,e[6]=f*t+B*n,e[7]=g*t+Y*n,e[8]=E*t-o*n,e[9]=R*t-u*n,e[10]=B*t-f*n,e[11]=Y*t-g*n,e}function hs(e,a,r){var n=Math.sin(r),t=Math.cos(r),o=a[0],u=a[1],f=a[2],g=a[3],E=a[8],R=a[9],B=a[10],Y=a[11];return a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*t-E*n,e[1]=u*t-R*n,e[2]=f*t-B*n,e[3]=g*t-Y*n,e[8]=o*n+E*t,e[9]=u*n+R*t,e[10]=f*n+B*t,e[11]=g*n+Y*t,e}function Ba(e,a,r){var n=Math.sin(r),t=Math.cos(r),o=a[0],u=a[1],f=a[2],g=a[3],E=a[4],R=a[5],B=a[6],Y=a[7];return a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*t+E*n,e[1]=u*t+R*n,e[2]=f*t+B*n,e[3]=g*t+Y*n,e[4]=E*t-o*n,e[5]=R*t-u*n,e[6]=B*t-f*n,e[7]=Y*t-g*n,e}function bs(e,a){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e}function ms(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Eo(e,a,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),f,g,E;return u<Ku?null:(u=1/u,n*=u,t*=u,o*=u,f=Math.sin(a),g=Math.cos(a),E=1-g,e[0]=n*n*E+g,e[1]=t*n*E+o*f,e[2]=o*n*E-t*f,e[3]=0,e[4]=n*t*E-o*f,e[5]=t*t*E+g,e[6]=o*t*E+n*f,e[7]=0,e[8]=n*o*E+t*f,e[9]=t*o*E-n*f,e[10]=o*o*E+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function gu(e,a){var r=Math.sin(a),n=Math.cos(a);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fs(e,a){var r=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cn(e,a){var r=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ma(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3],f=n+n,g=t+t,E=o+o,R=n*f,B=n*g,Y=n*E,Q=t*g,ce=t*E,fe=o*E,Te=u*f,Ve=u*g,st=u*E;return e[0]=1-(Q+fe),e[1]=B+st,e[2]=Y-Ve,e[3]=0,e[4]=B-st,e[5]=1-(R+fe),e[6]=ce+Te,e[7]=0,e[8]=Y+Ve,e[9]=ce-Te,e[10]=1-(R+Q),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function go(e,a){var r=new Ml(3),n=-a[0],t=-a[1],o=-a[2],u=a[3],f=a[4],g=a[5],E=a[6],R=a[7],B=n*n+t*t+o*o+u*u;return B>0?(r[0]=(f*u+R*n+g*o-E*t)*2/B,r[1]=(g*u+R*t+E*n-f*o)*2/B,r[2]=(E*u+R*o+f*t-g*n)*2/B):(r[0]=(f*u+R*n+g*o-E*t)*2,r[1]=(g*u+R*t+E*n-f*o)*2,r[2]=(E*u+R*o+f*t-g*n)*2),Ma(e,a,r),e}function Na(e,a){return e[0]=a[12],e[1]=a[13],e[2]=a[14],e}function v(e,a){var r=a[0],n=a[1],t=a[2],o=a[4],u=a[5],f=a[6],g=a[8],E=a[9],R=a[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,f),e[2]=Math.hypot(g,E,R),e}function c(e,a){var r=new Ml(3);v(r,a);var n=1/r[0],t=1/r[1],o=1/r[2],u=a[0]*n,f=a[1]*t,g=a[2]*o,E=a[4]*n,R=a[5]*t,B=a[6]*o,Y=a[8]*n,Q=a[9]*t,ce=a[10]*o,fe=u+R+ce,Te=0;return fe>0?(Te=Math.sqrt(fe+1)*2,e[3]=.25*Te,e[0]=(B-Q)/Te,e[1]=(Y-g)/Te,e[2]=(f-E)/Te):u>R&&u>ce?(Te=Math.sqrt(1+u-R-ce)*2,e[3]=(B-Q)/Te,e[0]=.25*Te,e[1]=(f+E)/Te,e[2]=(Y+g)/Te):R>ce?(Te=Math.sqrt(1+R-u-ce)*2,e[3]=(Y-g)/Te,e[0]=(f+E)/Te,e[1]=.25*Te,e[2]=(B+Q)/Te):(Te=Math.sqrt(1+ce-u-R)*2,e[3]=(f-E)/Te,e[0]=(Y+g)/Te,e[1]=(B+Q)/Te,e[2]=.25*Te),e}function b(e,a,r,n){var t=a[0],o=a[1],u=a[2],f=a[3],g=t+t,E=o+o,R=u+u,B=t*g,Y=t*E,Q=t*R,ce=o*E,fe=o*R,Te=u*R,Ve=f*g,st=f*E,at=f*R,Tt=n[0],kt=n[1],Yt=n[2];return e[0]=(1-(ce+Te))*Tt,e[1]=(Y+at)*Tt,e[2]=(Q-st)*Tt,e[3]=0,e[4]=(Y-at)*kt,e[5]=(1-(B+Te))*kt,e[6]=(fe+Ve)*kt,e[7]=0,e[8]=(Q+st)*Yt,e[9]=(fe-Ve)*Yt,e[10]=(1-(B+ce))*Yt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function k(e,a,r,n,t){var o=a[0],u=a[1],f=a[2],g=a[3],E=o+o,R=u+u,B=f+f,Y=o*E,Q=o*R,ce=o*B,fe=u*R,Te=u*B,Ve=f*B,st=g*E,at=g*R,Tt=g*B,kt=n[0],Yt=n[1],cr=n[2],Mr=t[0],Dr=t[1],sn=t[2],rn=(1-(fe+Ve))*kt,Jn=(Q+Tt)*kt,fi=(ce-at)*kt,Hi=(Q-Tt)*Yt,Ds=(1-(Y+Ve))*Yt,pu=(Te+st)*Yt,$s=(ce+at)*cr,Pc=(Te-st)*cr,lc=(1-(Y+fe))*cr;return e[0]=rn,e[1]=Jn,e[2]=fi,e[3]=0,e[4]=Hi,e[5]=Ds,e[6]=pu,e[7]=0,e[8]=$s,e[9]=Pc,e[10]=lc,e[11]=0,e[12]=r[0]+Mr-(rn*Mr+Hi*Dr+$s*sn),e[13]=r[1]+Dr-(Jn*Mr+Ds*Dr+Pc*sn),e[14]=r[2]+sn-(fi*Mr+pu*Dr+lc*sn),e[15]=1,e}function z(e,a){var r=a[0],n=a[1],t=a[2],o=a[3],u=r+r,f=n+n,g=t+t,E=r*u,R=n*u,B=n*f,Y=t*u,Q=t*f,ce=t*g,fe=o*u,Te=o*f,Ve=o*g;return e[0]=1-B-ce,e[1]=R+Ve,e[2]=Y-Te,e[3]=0,e[4]=R-Ve,e[5]=1-E-ce,e[6]=Q+fe,e[7]=0,e[8]=Y+Te,e[9]=Q-fe,e[10]=1-E-B,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V(e,a,r,n,t,o,u){var f=1/(r-a),g=1/(t-n),E=1/(o-u);return e[0]=o*2*f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*g,e[6]=0,e[7]=0,e[8]=(r+a)*f,e[9]=(t+n)*g,e[10]=(u+o)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*E,e[15]=0,e}function W(e,a,r,n,t){var o=1/Math.tan(a/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==1/0?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var ne=W;function he(e,a,r,n,t){var o=1/Math.tan(a/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==1/0?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Se(e,a,r,n){var t=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),u=Math.tan(a.leftDegrees*Math.PI/180),f=Math.tan(a.rightDegrees*Math.PI/180),g=2/(u+f),E=2/(t+o);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((u-f)*g*.5),e[9]=(t-o)*E*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Ne(e,a,r,n,t,o,u){var f=1/(a-r),g=1/(n-t),E=1/(o-u);return e[0]=-2*f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(a+r)*f,e[13]=(t+n)*g,e[14]=(u+o)*E,e[15]=1,e}var We=Ne;function ht(e,a,r,n,t,o,u){var f=1/(a-r),g=1/(n-t),E=1/(o-u);return e[0]=-2*f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(a+r)*f,e[13]=(t+n)*g,e[14]=o*E,e[15]=1,e}function gt(e,a,r,n){var t,o,u,f,g,E,R,B,Y,Q,ce=a[0],fe=a[1],Te=a[2],Ve=n[0],st=n[1],at=n[2],Tt=r[0],kt=r[1],Yt=r[2];return Math.abs(ce-Tt)<Ku&&Math.abs(fe-kt)<Ku&&Math.abs(Te-Yt)<Ku?$o(e):(R=ce-Tt,B=fe-kt,Y=Te-Yt,Q=1/Math.hypot(R,B,Y),R*=Q,B*=Q,Y*=Q,t=st*Y-at*B,o=at*R-Ve*Y,u=Ve*B-st*R,Q=Math.hypot(t,o,u),Q?(Q=1/Q,t*=Q,o*=Q,u*=Q):(t=0,o=0,u=0),f=B*u-Y*o,g=Y*t-R*u,E=R*o-B*t,Q=Math.hypot(f,g,E),Q?(Q=1/Q,f*=Q,g*=Q,E*=Q):(f=0,g=0,E=0),e[0]=t,e[1]=f,e[2]=R,e[3]=0,e[4]=o,e[5]=g,e[6]=B,e[7]=0,e[8]=u,e[9]=E,e[10]=Y,e[11]=0,e[12]=-(t*ce+o*fe+u*Te),e[13]=-(f*ce+g*fe+E*Te),e[14]=-(R*ce+B*fe+Y*Te),e[15]=1,e)}function St(e,a,r,n){var t=a[0],o=a[1],u=a[2],f=n[0],g=n[1],E=n[2],R=t-r[0],B=o-r[1],Y=u-r[2],Q=R*R+B*B+Y*Y;Q>0&&(Q=1/Math.sqrt(Q),R*=Q,B*=Q,Y*=Q);var ce=g*Y-E*B,fe=E*R-f*Y,Te=f*B-g*R;return Q=ce*ce+fe*fe+Te*Te,Q>0&&(Q=1/Math.sqrt(Q),ce*=Q,fe*=Q,Te*=Q),e[0]=ce,e[1]=fe,e[2]=Te,e[3]=0,e[4]=B*Te-Y*fe,e[5]=Y*ce-R*Te,e[6]=R*fe-B*ce,e[7]=0,e[8]=R,e[9]=B,e[10]=Y,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function Ht(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ir(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function fr(e,a,r){return e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e[3]=a[3]+r[3],e[4]=a[4]+r[4],e[5]=a[5]+r[5],e[6]=a[6]+r[6],e[7]=a[7]+r[7],e[8]=a[8]+r[8],e[9]=a[9]+r[9],e[10]=a[10]+r[10],e[11]=a[11]+r[11],e[12]=a[12]+r[12],e[13]=a[13]+r[13],e[14]=a[14]+r[14],e[15]=a[15]+r[15],e}function Gr(e,a,r){return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],e[3]=a[3]-r[3],e[4]=a[4]-r[4],e[5]=a[5]-r[5],e[6]=a[6]-r[6],e[7]=a[7]-r[7],e[8]=a[8]-r[8],e[9]=a[9]-r[9],e[10]=a[10]-r[10],e[11]=a[11]-r[11],e[12]=a[12]-r[12],e[13]=a[13]-r[13],e[14]=a[14]-r[14],e[15]=a[15]-r[15],e}function Tr(e,a,r){return e[0]=a[0]*r,e[1]=a[1]*r,e[2]=a[2]*r,e[3]=a[3]*r,e[4]=a[4]*r,e[5]=a[5]*r,e[6]=a[6]*r,e[7]=a[7]*r,e[8]=a[8]*r,e[9]=a[9]*r,e[10]=a[10]*r,e[11]=a[11]*r,e[12]=a[12]*r,e[13]=a[13]*r,e[14]=a[14]*r,e[15]=a[15]*r,e}function Jr(e,a,r,n){return e[0]=a[0]+r[0]*n,e[1]=a[1]+r[1]*n,e[2]=a[2]+r[2]*n,e[3]=a[3]+r[3]*n,e[4]=a[4]+r[4]*n,e[5]=a[5]+r[5]*n,e[6]=a[6]+r[6]*n,e[7]=a[7]+r[7]*n,e[8]=a[8]+r[8]*n,e[9]=a[9]+r[9]*n,e[10]=a[10]+r[10]*n,e[11]=a[11]+r[11]*n,e[12]=a[12]+r[12]*n,e[13]=a[13]+r[13]*n,e[14]=a[14]+r[14]*n,e[15]=a[15]+r[15]*n,e}function wn(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]}function ii(e,a){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],f=e[5],g=e[6],E=e[7],R=e[8],B=e[9],Y=e[10],Q=e[11],ce=e[12],fe=e[13],Te=e[14],Ve=e[15],st=a[0],at=a[1],Tt=a[2],kt=a[3],Yt=a[4],cr=a[5],Mr=a[6],Dr=a[7],sn=a[8],rn=a[9],Jn=a[10],fi=a[11],Hi=a[12],Ds=a[13],pu=a[14],$s=a[15];return Math.abs(r-st)<=Ku*Math.max(1,Math.abs(r),Math.abs(st))&&Math.abs(n-at)<=Ku*Math.max(1,Math.abs(n),Math.abs(at))&&Math.abs(t-Tt)<=Ku*Math.max(1,Math.abs(t),Math.abs(Tt))&&Math.abs(o-kt)<=Ku*Math.max(1,Math.abs(o),Math.abs(kt))&&Math.abs(u-Yt)<=Ku*Math.max(1,Math.abs(u),Math.abs(Yt))&&Math.abs(f-cr)<=Ku*Math.max(1,Math.abs(f),Math.abs(cr))&&Math.abs(g-Mr)<=Ku*Math.max(1,Math.abs(g),Math.abs(Mr))&&Math.abs(E-Dr)<=Ku*Math.max(1,Math.abs(E),Math.abs(Dr))&&Math.abs(R-sn)<=Ku*Math.max(1,Math.abs(R),Math.abs(sn))&&Math.abs(B-rn)<=Ku*Math.max(1,Math.abs(B),Math.abs(rn))&&Math.abs(Y-Jn)<=Ku*Math.max(1,Math.abs(Y),Math.abs(Jn))&&Math.abs(Q-fi)<=Ku*Math.max(1,Math.abs(Q),Math.abs(fi))&&Math.abs(ce-Hi)<=Ku*Math.max(1,Math.abs(ce),Math.abs(Hi))&&Math.abs(fe-Ds)<=Ku*Math.max(1,Math.abs(fe),Math.abs(Ds))&&Math.abs(Te-pu)<=Ku*Math.max(1,Math.abs(Te),Math.abs(pu))&&Math.abs(Ve-$s)<=Ku*Math.max(1,Math.abs(Ve),Math.abs($s))}var da=Wo,$a=Gr,fa,ra,Xi=(fa=(0,Ii.b2)(),fa(ra=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"viewport",void 0),(0,Pe.Z)(this,"overridedViewProjectionMatrix",void 0),(0,Pe.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,Pe.Z)(this,"jitteredProjectionMatrix",void 0),(0,Pe.Z)(this,"viewMatrixInverse",void 0),(0,Pe.Z)(this,"cameraPosition",void 0)}return(0,Me.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Kn(),Oo(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,gi.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=bs(Kn(),[r,n,0]);this.jitteredProjectionMatrix=Wo(Kn(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Wo(Kn(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ra),ga=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),qi,Ei;function Wa(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ta(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function Ta(e,a){if(e){if(typeof e=="string")return gs(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gs(e,a)}}function gs(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var gl={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Sl=(qi=(0,Ii.b2)(),qi(Ei=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"container",void 0),(0,Pe.Z)(this,"controlCorners",void 0),(0,Pe.Z)(this,"controlContainer",void 0),(0,Pe.Z)(this,"scene",void 0),(0,Pe.Z)(this,"mapsService",void 0),(0,Pe.Z)(this,"controls",[]),(0,Pe.Z)(this,"unAddControls",[])}return(0,Me.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(cn.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(cn.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Wa(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=wo("div",n+"control-container",this.container);function o(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=f.map(function(E){return n+E}).join(" ");r[f.filter(function(E){return!["row","column"].includes(E)}).join("")]=wo("div",g,t)}function u(f){var g=f.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Vn.Z)(g),[gl[f]])}Object.values(ga).forEach(function(f){o(u(f))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&fl(this.controlCorners[r]);this.controlContainer&&fl(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(n)for(var t=function(){var g=u[o],E=g.match(/^(top|bottom)(left|right)$/);if(E){var R=(0,gi.Z)(E,3),B=R[1],Y=R[2],Q=r.controlCorners["".concat(B).concat(Y)],ce=new n(function(fe){var Te=(0,gi.Z)(fe,1),Ve=Te[0].target;Q&&(Q.style[B]=Ve.clientHeight+"px")});ce.observe(r.controlCorners["".concat(Y).concat(B)],{childList:!0,attributes:!0})}},o=0,u=Object.keys(this.controlCorners);o<u.length;o++)t()}}]),e}())||Ei),zc,Dp,Op=(zc=(0,Ii.b2)(),zc(Dp=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"container",void 0),(0,Pe.Z)(this,"scene",void 0),(0,Pe.Z)(this,"mapsService",void 0),(0,Pe.Z)(this,"markers",[]),(0,Pe.Z)(this,"markerLayers",[]),(0,Pe.Z)(this,"unAddMarkers",[]),(0,Pe.Z)(this,"unAddMarkerLayers",[])}return(0,Me.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(cn.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Dp),dh,Jh,Nh=(dh=(0,Ii.b2)(),dh(Jh=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"scene",void 0),(0,Pe.Z)(this,"mapsService",void 0),(0,Pe.Z)(this,"popups",[]),(0,Pe.Z)(this,"unAddPopups",[])}return(0,Me.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,Vn.Z)(this.popups),(0,Vn.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(cn.IMapService)}}]),e}())||Jh),vh=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),nc=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Us=function(e){return e.AND="and",e.OR="or",e}({}),zs=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Fp={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Zh=Fp,Bf,zp,np=Ga.merge,ic={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},yu={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Us.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},xf=(Bf=(0,Ii.b2)(),Bf(zp=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"sceneConfigCache",{}),(0,Pe.Z)(this,"layerConfigCache",{}),(0,Pe.Z)(this,"layerAttributeConfigCache",{})}return(0,Me.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Zh[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,Ee.Z)((0,Ee.Z)({},ic),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,Ee.Z)({},np({},this.sceneConfigCache[r],yu,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,Ee.Z)((0,Ee.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||zp);function yo(e,a,r,n){r&&Object.defineProperty(e,a,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ro(e,a,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,f){return f(e,a,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,a,o),o=null),o}function Bp(){var e=new Ml(4);return Ml!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function av(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function Np(e,a,r,n){var t=new Ml(4);return t[0]=e,t[1]=a,t[2]=r,t[3]=n,t}function qv(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function ov(e,a,r,n,t){return e[0]=a,e[1]=r,e[2]=n,e[3]=t,e}function Md(e,a,r){return e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e[3]=a[3]+r[3],e}function vd(e,a,r){return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],e[3]=a[3]-r[3],e}function Kv(e,a,r){return e[0]=a[0]*r[0],e[1]=a[1]*r[1],e[2]=a[2]*r[2],e[3]=a[3]*r[3],e}function Ep(e,a,r){return e[0]=a[0]/r[0],e[1]=a[1]/r[1],e[2]=a[2]/r[2],e[3]=a[3]/r[3],e}function xg(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e[3]=Math.ceil(a[3]),e}function y0(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e[3]=Math.floor(a[3]),e}function xv(e,a,r){return e[0]=Math.min(a[0],r[0]),e[1]=Math.min(a[1],r[1]),e[2]=Math.min(a[2],r[2]),e[3]=Math.min(a[3],r[3]),e}function Cp(e,a,r){return e[0]=Math.max(a[0],r[0]),e[1]=Math.max(a[1],r[1]),e[2]=Math.max(a[2],r[2]),e[3]=Math.max(a[3],r[3]),e}function W0(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e[3]=Math.round(a[3]),e}function bm(e,a,r){return e[0]=a[0]*r,e[1]=a[1]*r,e[2]=a[2]*r,e[3]=a[3]*r,e}function wg(e,a,r,n){return e[0]=a[0]+r[0]*n,e[1]=a[1]+r[1]*n,e[2]=a[2]+r[2]*n,e[3]=a[3]+r[3]*n,e}function Sg(e,a){var r=a[0]-e[0],n=a[1]-e[1],t=a[2]-e[2],o=a[3]-e[3];return Math.hypot(r,n,t,o)}function Eg(e,a){var r=a[0]-e[0],n=a[1]-e[1],t=a[2]-e[2],o=a[3]-e[3];return r*r+n*n+t*t+o*o}function Cg(e){var a=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(a,r,n,t)}function Xy(e){var a=e[0],r=e[1],n=e[2],t=e[3];return a*a+r*r+n*n+t*t}function X0(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e[3]=-a[3],e}function Yy(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e[3]=1/a[3],e}function qy(e,a){var r=a[0],n=a[1],t=a[2],o=a[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function sv(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3]}function Ag(e,a,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],f=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],E=r[2]*n[3]-r[3]*n[2],R=a[0],B=a[1],Y=a[2],Q=a[3];return e[0]=B*E-Y*g+Q*f,e[1]=-(R*E)+Y*u-Q*o,e[2]=R*g-B*u+Q*t,e[3]=-(R*f)+B*o-Y*t,e}function wv(e,a,r,n){var t=a[0],o=a[1],u=a[2],f=a[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=f+n*(r[3]-f),e}function Ky(e,a){a=a||1;var r,n,t,o,u,f;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,f=t*t+o*o;while(f>=1);var g=Math.sqrt((1-u)/f);return e[0]=a*r,e[1]=a*n,e[2]=a*t*g,e[3]=a*o*g,e}function Jv(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function Y0(e,a,r){var n=a[0],t=a[1],o=a[2],u=r[0],f=r[1],g=r[2],E=r[3],R=E*n+f*o-g*t,B=E*t+g*n-u*o,Y=E*o+u*t-f*n,Q=-u*n-f*t-g*o;return e[0]=R*E+Q*-u+B*-g-Y*-f,e[1]=B*E+Q*-f+Y*-u-R*-g,e[2]=Y*E+Q*-g+R*-f-B*-u,e[3]=a[3],e}function Zp(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function md(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Qv(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function Sv(e,a){var r=e[0],n=e[1],t=e[2],o=e[3],u=a[0],f=a[1],g=a[2],E=a[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(t-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(g))&&Math.abs(o-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))}var xm=null,Dv=null,q0=null,bx=null,Jy=null,dE=null,xx=null,vE=function(){var e=Bp();return function(a,r,n,t,o,u){var f,g;for(r||(r=4),n||(n=0),t?g=Math.min(t*r+n,a.length):g=a.length,f=n;f<g;f+=r)e[0]=a[f],e[1]=a[f+1],e[2]=a[f+2],e[3]=a[f+3],o(e,e,u),a[f]=e[0],a[f+1]=e[1],a[f+2]=e[2],a[f+3]=e[3];return a}}(),Qy=Math.PI/180,Sx=512,o_=4003e4;function s_(e){var a=e.latitude,r=a===void 0?0:a,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,f=u===void 0?!1:u,g=e.flipY,E=g===void 0?!1:g;o=o!==void 0?o:Math.pow(2,t);var R={},B=Sx*o,Y=Math.cos(r*Qy),Q=B/360,ce=Q/Y,fe=B/o_/Y;if(R.pixelsPerMeter=[fe,-fe,fe],R.metersPerPixel=[1/fe,-1/fe,1/fe],R.pixelsPerDegree=[Q,-ce,fe],R.degreesPerPixel=[1/Q,-1/ce,1/fe],f){var Te=Qy*Math.tan(r*Qy)/Y,Ve=Q*Te/2,st=B/o_*Te,at=st/ce*fe;R.pixelsPerDegree2=[0,-Ve,st],R.pixelsPerMeter2=[at,0,at],E&&(R.pixelsPerDegree2[1]=-R.pixelsPerDegree2[1],R.pixelsPerMeter2[1]=-R.pixelsPerMeter2[1])}return E&&(R.pixelsPerMeter[1]=-R.pixelsPerMeter[1],R.metersPerPixel[1]=-R.metersPerPixel[1],R.pixelsPerDegree[1]=-R.pixelsPerDegree[1],R.degreesPerPixel[1]=-R.degreesPerPixel[1]),R}var gd=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),jm={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},u_,em,Yg,K0,qg,l_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],mE=(u_=(0,Ii.b2)(),em=(0,Ii.f3)(cn.ICameraService),u_(Yg=(K0=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"needRefresh",!0),yo(this,"cameraService",qg,this),(0,Pe.Z)(this,"coordinateSystem",void 0),(0,Pe.Z)(this,"viewportCenter",void 0),(0,Pe.Z)(this,"viewportCenterProjection",void 0),(0,Pe.Z)(this,"pixelsPerDegree",void 0),(0,Pe.Z)(this,"pixelsPerDegree2",void 0),(0,Pe.Z)(this,"pixelsPerMeter",void 0)}return(0,Me.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=s_({latitude:o[1],zoom:n}),f=u.pixelsPerMeter,g=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=g,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===gd.LNGLAT||this.coordinateSystem===gd.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===gd.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===gd.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=s_({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),f=u.pixelsPerMeter,g=u.pixelsPerDegree,E=u.pixelsPerDegree2,R=this.cameraService.getViewMatrix(),B=this.cameraService.getProjectionMatrix(),Y=Wo([],B,R),Q=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Jv([],[Q[0],Q[1],0,1],Y),R=this.cameraService.getViewMatrixUncentered()||R,Y=Wo([],B,R),Y=Wo([],Y,l_),this.cameraService.setViewProjectionMatrix(Y),this.pixelsPerMeter=f,this.pixelsPerDegree=g,this.pixelsPerDegree2=E}}]),e}(),qg=ro(K0.prototype,"cameraService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K0))||Yg),Ex,gE;function yE(e){var a=xP();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function xP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wP=(Ex=(0,Ii.b2)(),Ex(gE=function(e){(0,yt.Z)(r,e);var a=yE(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"renderMap",new Map),(0,Pe.Z)((0,D.Z)(n),"enable",!1),(0,Pe.Z)((0,D.Z)(n),"renderEnable",!1),(0,Pe.Z)((0,D.Z)(n),"cacheLogs",{}),n}return(0,Me.Z)(r,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,o){var u=this;if(this.enable){var f=t.split("."),g=null;f.forEach(function(E,R){g!==null?(g[E]||(g[E]={}),R!==f.length-1&&(g=g[E])):(u.cacheLogs[E]||(u.cacheLogs[E]={}),R!==f.length-1&&(g=u.cacheLogs[E])),R===f.length-1&&(g[E]=(0,Ee.Z)((0,Ee.Z)({time:Date.now()},g[E]),o))})}}},{key:"getLog",value:function(t){var o=this;switch((0,Go.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map(function(u){return o.cacheLogs[u]}).filter(function(u){return u!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Pf():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t)||{};this.renderMap.set(t,(0,Ee.Z)((0,Ee.Z)({},o),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t);if(o){var u=o.renderStart,f=Date.now();this.emit("renderEnd",(0,Ee.Z)((0,Ee.Z)({},o),{},{renderEnd:f,renderDuration:f-u})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(Z.EventEmitter))||gE),SP=G(50840),e1=G.n(SP),Vd=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Cx,_E,bE,Ax,xE;function EP(e){var a=wE();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CP={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},AP=(Cx=(0,Ii.b2)(),_E=(0,Ii.f3)(cn.IMapService),Cx(bE=(Ax=function(e){(0,yt.Z)(r,e);var a=EP(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"indragging",!1),yo((0,D.Z)(n),"mapService",xE,(0,D.Z)(n)),(0,Pe.Z)((0,D.Z)(n),"hammertime",void 0),(0,Pe.Z)((0,D.Z)(n),"lastClickTime",0),(0,Pe.Z)((0,D.Z)(n),"lastClickXY",[-1,-1]),(0,Pe.Z)((0,D.Z)(n),"clickTimer",void 0),(0,Pe.Z)((0,D.Z)(n),"$containter",void 0),(0,Pe.Z)((0,D.Z)(n),"onDrag",function(f){var g=n.interactionEvent(f);g.type=CP[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Vd.Drag,g)}),(0,Pe.Z)((0,D.Z)(n),"onHammer",function(f){f.srcEvent.stopPropagation();var g=n.interactionEvent(f);n.emit(Vd.Hover,g)}),(0,Pe.Z)((0,D.Z)(n),"onTouch",function(f){var g=f.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,Pe.Z)((0,D.Z)(n),"onHover",function(f){var g=f.clientX,E=f.clientY,R=g,B=E,Y=f.type,Q=n.mapService.getMapContainer();if(Q){var ce=Q.getBoundingClientRect(),fe=ce.top,Te=ce.left;R=R-Te-Q.clientLeft,B=B-fe-Q.clientTop}var Ve=n.mapService.containerToLngLat([R,B]);if(Y==="click"){n.isDoubleTap(R,B,Ve);return}if(Y==="touch"){n.isDoubleTap(R,B,Ve);return}Y!=="click"&&Y!=="dblclick"&&n.emit(Vd.Hover,{x:R,y:B,lngLat:Ve,type:Y,target:f})}),n}return(0,Me.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Vd.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(Vd.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(Vd.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(Vd.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t){var o=new(e1()).Manager(t);o.add(new(e1()).Tap({event:"dblclick",taps:2})),o.add(new(e1()).Tap({event:"click"})),o.add(new(e1()).Pan({threshold:0,pointers:0})),o.add(new(e1()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,f,g;u==="touch"?(g=Math.floor(t.pointers[0].clientY),f=Math.floor(t.pointers[0].clientX)):(g=Math.floor(t.srcEvent.y),f=Math.floor(t.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var R=E.getBoundingClientRect(),B=R.top,Y=R.left;f-=Y,g-=B}var Q=this.mapService.containerToLngLat([f,g]);return{x:f,y:g,lngLat:Q,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var f=this,g=new Date().getTime(),E="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Vd.Hover,{x:t,y:o,lngLat:u,type:E})):(this.lastClickTime=g,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){E="click",f.emit(Vd.Hover,{x:t,y:o,lngLat:u,type:E})},400))}}]),r}(H()),xE=ro(Ax.prototype,"mapService",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax))||bE),TP=0;function MP(e){var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(TP++),r.classList.add("l7-scene"),a.appendChild(r),r}return null}function SE(e){var a,r=!0;if((e==null||(a=e.target)===null||a===void 0?void 0:a.target)instanceof HTMLElement)for(var n,t=e==null||(n=e.target)===null||n===void 0?void 0:n.target;t;){var o,u=Array.from(t.classList);if(u.includes("l7-marker")||u.includes("l7-popup")){r=!1;break}t=(o=t)===null||o===void 0?void 0:o.parentElement}return r}var Ke=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),EE,CE,t1,r1,Tx,Mx,c_,Kg,Px,AE,TE,kx,ME,PP=(EE=(0,Ii.b2)(),CE=(0,Ii.f3)(cn.IMapService),t1=(0,Ii.f3)(cn.IRendererService),r1=(0,Ii.f3)(cn.IGlobalConfigService),Tx=(0,Ii.f3)(cn.IInteractionService),Mx=(0,Ii.f3)(cn.ILayerService),EE(c_=(Kg=function(){function e(){var a=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"pickedColors",void 0),(0,Pe.Z)(this,"pickedTileLayers",[]),yo(this,"mapService",Px,this),yo(this,"rendererService",AE,this),yo(this,"configService",TE,this),yo(this,"interactionService",kx,this),yo(this,"layerService",ME,this),(0,Pe.Z)(this,"pickingFBO",void 0),(0,Pe.Z)(this,"width",0),(0,Pe.Z)(this,"height",0),(0,Pe.Z)(this,"alreadyInPicking",!1),(0,Pe.Z)(this,"pickBufferScale",1),(0,Pe.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,f=n.type,g=n.target,E=!1,R=a.rendererService,B=R.readPixels,Y=R.getContainer,Q=a.getContainerSize(Y()),ce=Q.width,fe=Q.height;ce*=Xs,fe*=Xs;var Te=r.getLayerConfig(),Ve=Te.enableHighlight,st=Te.enableSelect,at=t*Xs,Tt=o*Xs;if(at>ce-1*Xs||at<0||Tt>fe-1*Xs||Tt<0)return!1;var kt=B({x:Math.floor(at/a.pickBufferScale),y:Math.floor((fe-(o+1)*Xs)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=kt,kt[0]!==0||kt[1]!==0||kt[2]!==0){var Yt=cc(kt),cr=r.layerPickService.getFeatureById(Yt);Yt!==r.getCurrentPickId()&&f==="mousemove"&&(f="mouseenter");var Mr={x:t,y:o,type:f,lngLat:u,featureId:Yt,feature:cr,target:g};cr&&(E=!0,r.setCurrentPickId(Yt),a.triggerHoverOnLayer(r,Mr))}else{var Dr={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&f==="mousemove"?"mouseout":"un"+f,featureId:null,target:g,feature:null};a.triggerHoverOnLayer(r,(0,Ee.Z)((0,Ee.Z)({},Dr),{},{type:"unpick"})),a.triggerHoverOnLayer(r,Dr),r.setCurrentPickId(null)}if(Ve&&r.layerPickService.highlightPickedFeature(kt),st&&f==="click"&&(kt==null?void 0:kt.toString())!==[0,0,0,0].toString()){var sn=cc(kt);r.getCurrentSelectedId()===null||sn!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(kt),r.setCurrentSelectedId(sn)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return E})}return(0,Me.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,f=this.getContainerSize(u()),g=f.width,E=f.height;g*=Xs,E*=Xs,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(g/this.pickBufferScale),height:Math.round(E/this.pickBufferScale),wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.interactionService.on(Vd.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,mr.Z)(x().mark(function n(t,o,u){var f=this,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:g=this.rendererService,E=g.useFramebuffer,R=g.clear,this.resizePickingFBO(),E(this.pickingFBO,function(){R({framebuffer:f.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var Q=f.pickBox(t,o);u(Q)});case 3:case"end":return Y.stop()}},n,this)}));function r(n,t,o){return a.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(sn){var rn=sn<0?0:sn;return Math.floor(rn*Xs/t.pickBufferScale)}),u=(0,gi.Z)(o,4),f=u[0],g=u[1],E=u[2],R=u[3],B=this.rendererService,Y=B.readPixels,Q=B.getContainer,ce=this.getContainerSize(Q()),fe=ce.width,Te=ce.height;if(fe*=Xs,Te*=Xs,f>(fe-1)*Xs/this.pickBufferScale||E<0||g>(Te-1)*Xs/this.pickBufferScale||R<0)return[];for(var Ve=Math.min(fe/this.pickBufferScale,E)-f,st=Math.min(Te/this.pickBufferScale,R)-g,at=Y({x:f,y:Math.floor(Te/this.pickBufferScale-(R+1)),width:Ve,height:st,data:new Uint8Array(Ve*st*4),framebuffer:this.pickingFBO}),Tt=[],kt={},Yt=0;Yt<at.length/4;Yt=Yt+1){var cr=at.slice(Yt*4,Yt*4+4),Mr=cc(cr);if(Mr!==-1&&!kt[Mr]){var Dr=r.layerPickService.getFeatureById(Mr);Tt.push((0,Ee.Z)((0,Ee.Z)({},Dr),{},{pickedFeatureIdx:Mr})),kt[Mr]=!0}}return Tt}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,f=t.cursorEnabled;if(f){var g=this.mapService.version,E=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),R=E==null?void 0:E.style.getPropertyValue("cursor");n==="unmousemove"&&R!==""?E==null||E.style.setProperty("cursor",""):n==="mousemove"&&(E==null||E.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Xs,height:r.height/Xs}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=Xs,o*=Xs,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,mr.Z)(x().mark(function n(t){var o=this,u,f,g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:u=this.rendererService,f=u.useFramebuffer,g=u.clear,this.resizePickingFBO(),f(this.pickingFBO,function(){var B=o.layerService.getRenderList();B.filter(function(Y){return Y.needPick(t.type)}).reverse().some(function(Y){g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Y.layerPickService.pickRender(t);var Q=o.pickFromPickingFBO(Y,t);return o.layerService.pickedLayerId=Q?+Y.id:-1,Q&&!Y.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){SE(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),Px=ro(Kg.prototype,"mapService",[CE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=ro(Kg.prototype,"rendererService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TE=ro(Kg.prototype,"configService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=ro(Kg.prototype,"interactionService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=ro(Kg.prototype,"layerService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg))||c_),PE=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Be.Z)(this,e),(0,Pe.Z)(this,"autoStart",void 0),(0,Pe.Z)(this,"startTime",0),(0,Pe.Z)(this,"oldTime",0),(0,Pe.Z)(this,"running",!1),(0,Pe.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,Me.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),h_,n1,ng,kE,IE,i1,Ix,LE,f_;function _0(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p_(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function p_(e,a){if(e){if(typeof e=="string")return J0(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J0(e,a)}}function J0(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function kP(e){var a=IP();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function IP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RE=Ga.throttle,LP=(h_=(0,Ii.b2)(),n1=(0,Ii.f3)(cn.IRendererService),ng=(0,Ii.f3)(cn.IMapService),kE=(0,Ii.f3)(cn.IDebugService),h_(IE=(i1=function(e){(0,yt.Z)(r,e);var a=kP(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"pickedLayerId",-1),(0,Pe.Z)((0,D.Z)(n),"clock",new PE),(0,Pe.Z)((0,D.Z)(n),"alreadyInRendering",!1),(0,Pe.Z)((0,D.Z)(n),"layers",[]),(0,Pe.Z)((0,D.Z)(n),"layerList",[]),(0,Pe.Z)((0,D.Z)(n),"layerRenderID",void 0),(0,Pe.Z)((0,D.Z)(n),"sceneInited",!1),(0,Pe.Z)((0,D.Z)(n),"animateInstanceCount",0),(0,Pe.Z)((0,D.Z)(n),"shaderPicking",!0),(0,Pe.Z)((0,D.Z)(n),"enableRender",!0),yo((0,D.Z)(n),"renderService",Ix,(0,D.Z)(n)),yo((0,D.Z)(n),"mapService",LE,(0,D.Z)(n)),yo((0,D.Z)(n),"debugService",f_,(0,D.Z)(n)),(0,Pe.Z)((0,D.Z)(n),"reRender",RE(function(){n.renderLayers()},32)),(0,Pe.Z)((0,D.Z)(n),"throttleRenderLayers",RE(function(){n.renderLayers()},16)),n}return(0,Me.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var E=(0,mr.Z)(x().mark(function R(B){return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(B.startInit){Q.next=4;break}return Q.next=3,B.init();case 3:u.updateLayerRenderList();case 4:case"end":return Q.stop()}},R)}));return function(R){return E.apply(this,arguments)}}());case 2:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(){var n=(0,mr.Z)(x().mark(function o(u,f){var g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:f?(g=f.layerChildren.indexOf(u),g>-1&&f.layerChildren.splice(g,1)):(E=this.layers.indexOf(u),E>-1&&this.layers.splice(E,1)),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return B.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"removeAllLayers",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.destroy(),this.reRender();case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){Q.next=2;break}return Q.abrupt("return");case 2:this.updateLayerRenderList(),u=this.debugService.generateRenderUid(),this.debugService.renderStart(u),this.alreadyInRendering=!0,this.clear(),f=_0(this.layerList),Q.prev=8,f.s();case 10:if((g=f.n()).done){Q.next=23;break}if(E=g.value,R=E.getLayerConfig(),B=R.enableMask,E.masks.filter(function(ce){return ce.inited}).length>0&&B&&this.renderMask(E.masks),!E.getLayerConfig().enableMultiPassRenderer){Q.next=19;break}return Q.next=17,E.renderMultiPass();case 17:Q.next=21;break;case 19:return Q.next=21,E.render();case 21:Q.next=10;break;case 23:Q.next=28;break;case 25:Q.prev=25,Q.t0=Q.catch(8),f.e(Q.t0);case 28:return Q.prev=28,f.f(),Q.finish(28);case 31:this.debugService.renderEnd(u),this.alreadyInRendering=!1;case 33:case"end":return Q.stop()}},o,this,[[8,25,28,31]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var u=t.length>1?nc.MULTIPLE:nc.SINGLE,f=_0(t),g;try{for(f.s();!(g=f.n()).done;){var E=g.value;E.render({isStencil:!0,stencilType:u,stencilIndex:o++})}}catch(R){f.e(R)}finally{f.f()}}},{key:"beforeRenderData",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,u.hooks.beforeRenderData.promise();case 2:f=E.sent,f&&this.renderLayers();case 4:case"end":return E.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderTileLayerMask",value:function(t){var o=0,u=t.getLayerConfig(),f=u.enableMask,g=f===void 0?!0:f,E=t.tileMask?1:0,R=t.masks.filter(function(fe){return fe.inited});E=E+(g?R.length:1);var B=E>1?nc.MULTIPLE:nc.SINGLE;if((t.tileMask||R.length&&g)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),R.length&&g){var Y=_0(R),Q;try{for(Y.s();!(Q=Y.n()).done;){var ce=Q.value;ce.render({isStencil:!0,stencilType:B,stencilIndex:o++})}}catch(fe){Y.e(fe)}finally{Y.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:B,stencilIndex:o++,stencilOperation:Us.OR})}},{key:"renderTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(u){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.renderTileLayerMask(u),!u.getLayerConfig().enableMultiPassRenderer){g.next=6;break}return g.next=4,u.renderMultiPass();case 4:g.next=8;break;case 6:return g.next=8,u.render();case 8:case"end":return g.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Mo(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(Z.EventEmitter),Ix=ro(i1.prototype,"renderService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=ro(i1.prototype,"mapService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f_=ro(i1.prototype,"debugService",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i1))||IE),Uh=G(91),DE=Ga.isNil,a1=function(){function e(a){var r=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"name",void 0),(0,Pe.Z)(this,"type",void 0),(0,Pe.Z)(this,"scale",void 0),(0,Pe.Z)(this,"descriptor",void 0),(0,Pe.Z)(this,"featureBufferLayout",[]),(0,Pe.Z)(this,"needRescale",!1),(0,Pe.Z)(this,"needRemapping",!1),(0,Pe.Z)(this,"needRegenerateVertices",!1),(0,Pe.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,Pe.Z)(this,"vertexAttribute",void 0),(0,Pe.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var f,g=(f=r.scale)===null||f===void 0?void 0:f.scalers[u].func,E=g(o);return E})}),this.setProps(a)}return(0,Me.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,Vn.Z)(r));if(!DE(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Lx=["buffer","update","name"],OE=["buffer","update","name"],Vm,ig,Gm,Tg,Q0,o1,FE=(Vm={},(0,Pe.Z)(Vm,Ke.FLOAT,4),(0,Pe.Z)(Vm,Ke.UNSIGNED_BYTE,1),(0,Pe.Z)(Vm,Ke.UNSIGNED_SHORT,2),Vm),zE=(ig=(0,Ii.b2)(),Gm=(0,Ii.f3)(cn.IRendererService),ig(Tg=(Q0=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"attributesAndIndices",void 0),yo(this,"rendererService",o1,this),(0,Pe.Z)(this,"attributes",[]),(0,Pe.Z)(this,"triangulation",void 0),(0,Pe.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Me.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new a1(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(t){return t.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var t,o=n.name,u=(t=n.scale)===null||t===void 0?void 0:t.field;(r[o]||u&&r[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,Ee.Z)((0,Ee.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,f=this.attributes.find(function(kt){return kt.name===r});if(f&&f.descriptor){var g=f.descriptor,E=g.update,R=g.buffer,B=g.size,Y=B===void 0?0:B,Q=FE[R.type||Ke.FLOAT];if(E){var ce=this.featureLayout,fe=ce.elements,Te=ce.sizePerElement,Ve=fe.slice(t,o);if(!Ve.length)return;var st=Ve[0].offset,at=st*Y*Q,Tt=Ve.map(function(kt,Yt){for(var cr=kt.featureIdx,Mr=kt.vertices,Dr=kt.normals,sn=Mr.length/Te,rn=[],Jn=0;Jn<sn;Jn++){var fi=Dr?Dr.slice(Jn*3,Jn*3+3):[];rn.push.apply(rn,(0,Vn.Z)(E(n[cr],cr,Mr.slice(Jn*Te,Jn*Te+Te),Yt,fi)))}return rn}).reduce(function(kt,Yt){return kt.push.apply(kt,(0,Vn.Z)(Yt)),kt},[]);f.vertexAttribute.updateBuffer({data:Tt,offset:at}),u==null||u.emit("legend:".concat(r),{type:r,attr:f})}}}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(Ve){return Ve.resetDescriptor(),Ve.descriptor}),f=0,g=0,E=[],R=3;r.forEach(function(Ve,st){var at=o.triangulation(Ve,t),Tt=at.indices,kt=at.vertices,Yt=at.normals,cr=at.size,Mr=at.indexes,Dr=at.count;typeof Dr=="number"&&(g+=Dr),Tt.forEach(function(fi){E.push(fi+f)}),R=cr;var sn=kt.length/cr;o.featureLayout.sizePerElement=R,o.featureLayout.elements.push({featureIdx:st,vertices:kt,normals:Yt,offset:f}),f+=sn;for(var rn=function(Hi){var Ds=(Yt==null?void 0:Yt.slice(Hi*3,Hi*3+3))||[],pu=kt.slice(Hi*cr,Hi*cr+cr),$s=0;Mr&&Mr[Hi]!==void 0&&($s=Mr[Hi]),u.forEach(function(Pc,lc){if(Pc&&Pc.update){var up;(up=Pc.buffer.data).push.apply(up,(0,Vn.Z)(Pc.update(Ve,st,pu,Hi,Ds,$s)))}})},Jn=0;Jn<sn;Jn++)rn(Jn)});var B=this.rendererService,Y=B.createAttribute,Q=B.createBuffer,ce=B.createElements,fe={};u.forEach(function(Ve,st){if(Ve){var at=Ve.buffer,Tt=Ve.update,kt=Ve.name,Yt=(0,Uh.Z)(Ve,Lx),cr=Y((0,Ee.Z)({buffer:Q(at)},Yt));fe[Ve.name||""]=cr,o.attributes[st].vertexAttribute=cr}});var Te=ce({data:E,type:Ke.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:fe,elements:Te,count:g},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(Q){return Q.resetDescriptor(),Q.descriptor}),u=0,f=[],g=3;r.forEach(function(Q,ce){var fe=t.triangulation(Q),Te=fe.indices,Ve=fe.vertices,st=fe.normals,at=fe.size,Tt=fe.indexes;Te.forEach(function(Mr){f.push(Mr+u)}),g=at;var kt=Ve.length/at;t.featureLayout.sizePerElement=g,t.featureLayout.elements.push({featureIdx:ce,vertices:Ve,normals:st,offset:u}),u+=kt;for(var Yt=function(Dr){var sn=(st==null?void 0:st.slice(Dr*3,Dr*3+3))||[],rn=Ve.slice(Dr*at,Dr*at+at),Jn=0;Tt&&Tt[Dr]!==void 0&&(Jn=Tt[Dr]),o.forEach(function(fi,Hi){if(fi&&fi.update){var Ds;(Ds=fi.buffer.data).push.apply(Ds,(0,Vn.Z)(fi.update(Q,ce,rn,Dr,sn,Jn)))}})},cr=0;cr<kt;cr++)Yt(cr)});var E=this.rendererService,R=E.createAttribute,B=E.createBuffer,Y={};return o.forEach(function(Q,ce){if(Q){var fe=Q.buffer,Te=Q.update,Ve=Q.name,st=(0,Uh.Z)(Q,OE),at=R((0,Ee.Z)({buffer:B(fe)},st));Y[Q.name||""]=at,t.attributes[ce].vertexAttribute=at}}),{attributes:Y}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),o1=ro(Q0.prototype,"rendererService",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q0))||Tg),d_=G(34155);function Rx(e,a,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function f(R){try{E(n.next(R))}catch(B){u(B)}}function g(R){try{E(n.throw(R))}catch(B){u(B)}}function E(R){R.done?o(R.value):t(R.value).then(f,g)}E((n=n.apply(e,a||[])).next())})}function Dx(e,a){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(E){return function(R){return g([E,R])}}function g(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=E[0]&2?t.return:E[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,E[1])).done)return o;switch(t=0,o&&(E=[E[0]&2,o.value]),E[0]){case 0:case 1:o=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,t=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!o||E[1]>o[0]&&E[1]<o[3])){r.label=E[1];break}if(E[0]===6&&r.label<o[1]){r.label=o[1],o=E;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(E);break}o[2]&&r.ops.pop(),r.trys.pop();continue}E=a.call(e,r)}catch(R){E=[6,R],t=0}finally{n=o=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function v_(e,a){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(a===void 0||a-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(f){u={error:f}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function m_(e,a,r){if(r||arguments.length===2)for(var n=0,t=a.length,o;n<t;n++)(o||!(n in a))&&(o||(o=Array.prototype.slice.call(a,0,n)),o[n]=a[n]);return e.concat(o||Array.prototype.slice.call(a))}function Ox(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fx={exports:{}},g_={exports:{}},s1={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=a.default})(s1,s1.exports);var Ov={},ey={exports:{}},y_={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=a.default})(y_,y_.exports);var Hm={};Object.defineProperty(Hm,"__esModule",{value:!0}),Hm.fallback=b_,Hm.wrap=x_;var __=Hm.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,RP=Hm.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,BE=Hm.hasNextTick=typeof d_=="object"&&typeof d_.nextTick=="function";function b_(e){setTimeout(e,0)}function x_(e){return function(a){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return a.apply(void 0,r)})}}var ty;__?ty=queueMicrotask:RP?ty=setImmediate:BE?ty=d_.nextTick:ty=b_,Hm.default=x_(ty),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=g;var r=y_.exports,n=f(r),t=Hm,o=f(t),u=Ov;function f(B){return B&&B.__esModule?B:{default:B}}function g(B){return(0,u.isAsync)(B)?function(){for(var Y=[],Q=arguments.length;Q--;)Y[Q]=arguments[Q];var ce=Y.pop(),fe=B.apply(this,Y);return E(fe,ce)}:(0,n.default)(function(Y,Q){var ce;try{ce=B.apply(this,Y)}catch(fe){return Q(fe)}if(ce&&typeof ce.then=="function")return E(ce,Q);Q(null,ce)})}function E(B,Y){return B.then(function(Q){R(Y,null,Q)},function(Q){R(Y,Q&&Q.message?Q:new Error(Q))})}function R(B,Y,Q){try{B(Y,Q)}catch(ce){(0,o.default)(function(fe){throw fe},ce)}}e.exports=a.default}(ey,ey.exports),Object.defineProperty(Ov,"__esModule",{value:!0}),Ov.isAsyncIterable=Ov.isAsyncGenerator=Ov.isAsync=void 0;var zx=ey.exports,w_=NE(zx);function NE(e){return e&&e.__esModule?e:{default:e}}function Bx(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Nx(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function ZE(e){return typeof e[Symbol.asyncIterator]=="function"}function UE(e){if(typeof e!="function")throw new Error("expected a function");return Bx(e)?(0,w_.default)(e):e}Ov.default=UE,Ov.isAsync=Bx,Ov.isAsyncGenerator=Nx,Ov.isAsyncIterable=ZE;var Jg={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,f=[],g=arguments.length;g--;)f[g]=arguments[g];return typeof f[t-1]=="function"?n.apply(this,f):new Promise(function(E,R){f[t-1]=function(B){for(var Y=[],Q=arguments.length-1;Q-- >0;)Y[Q]=arguments[Q+1];if(B)return R(B);E(Y.length>1?Y:Y[0])},n.apply(u,f)})}return o}e.exports=a.default})(Jg,Jg.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=s1.exports,n=g(r),t=Ov,o=g(t),u=Jg.exports,f=g(u);function g(E){return E&&E.__esModule?E:{default:E}}a.default=(0,f.default)(function(E,R,B){var Y=(0,n.default)(R)?[]:{};E(R,function(Q,ce,fe){(0,o.default)(Q)(function(Te){for(var Ve,st=[],at=arguments.length-1;at-- >0;)st[at]=arguments[at+1];st.length<2&&(Ve=st,st=Ve[0]),Y[ce]=st,fe(Te)})},function(Q){return B(Q,Y)})},3),e.exports=a.default}(g_,g_.exports);var $m={exports:{}},u1={exports:{}},S_={exports:{}},ry={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var f=n;n=null,f.apply(this,o)}}return Object.assign(t,n),t}e.exports=a.default})(ry,ry.exports);var E_={exports:{}},C_={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=a.default})(C_,C_.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=R;var r=s1.exports,n=u(r),t=C_.exports,o=u(t);function u(B){return B&&B.__esModule?B:{default:B}}function f(B){var Y=-1,Q=B.length;return function(){return++Y<Q?{value:B[Y],key:Y}:null}}function g(B){var Y=-1;return function(){var ce=B.next();return ce.done?null:(Y++,{value:ce.value,key:Y})}}function E(B){var Y=B?Object.keys(B):[],Q=-1,ce=Y.length;return function fe(){var Te=Y[++Q];return Te==="__proto__"?fe():Q<ce?{value:B[Te],key:Te}:null}}function R(B){if((0,n.default)(B))return f(B);var Y=(0,o.default)(B);return Y?g(Y):E(B)}e.exports=a.default}(E_,E_.exports);var ny={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=a.default})(ny,ny.exports);var iy={exports:{}},l1={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r={};a.default=r,e.exports=a.default})(l1,l1.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var r=l1.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,f,g,E){var R=!1,B=!1,Y=!1,Q=0,ce=0;function fe(){Q>=f||Y||R||(Y=!0,u.next().then(function(st){var at=st.value,Tt=st.done;if(!(B||R)){if(Y=!1,Tt){R=!0,Q<=0&&E(null);return}Q++,g(at,ce,Te),ce++,fe()}}).catch(Ve))}function Te(st,at){if(Q-=1,!B){if(st)return Ve(st);if(st===!1){R=!0,B=!0;return}if(at===n.default||R&&Q<=0)return R=!0,E(null);fe()}}function Ve(st){B||(Y=!1,R=!0,E(st))}fe()}e.exports=a.default}(iy,iy.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=ry.exports,n=Q(r),t=E_.exports,o=Q(t),u=ny.exports,f=Q(u),g=Ov,E=iy.exports,R=Q(E),B=l1.exports,Y=Q(B);function Q(ce){return ce&&ce.__esModule?ce:{default:ce}}a.default=function(ce){return function(fe,Te,Ve){if(Ve=(0,n.default)(Ve),ce<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!fe)return Ve(null);if((0,g.isAsyncGenerator)(fe))return(0,R.default)(fe,ce,Te,Ve);if((0,g.isAsyncIterable)(fe))return(0,R.default)(fe[Symbol.asyncIterator](),ce,Te,Ve);var st=(0,o.default)(fe),at=!1,Tt=!1,kt=0,Yt=!1;function cr(Dr,sn){if(!Tt)if(kt-=1,Dr)at=!0,Ve(Dr);else if(Dr===!1)at=!0,Tt=!0;else{if(sn===Y.default||at&&kt<=0)return at=!0,Ve(null);Yt||Mr()}}function Mr(){for(Yt=!0;kt<ce&&!at;){var Dr=st();if(Dr===null){at=!0,kt<=0&&Ve(null);return}kt+=1,Te(Dr.value,Dr.key,(0,f.default)(cr))}Yt=!1}Mr()}},e.exports=a.default}(S_,S_.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=S_.exports,n=g(r),t=Ov,o=g(t),u=Jg.exports,f=g(u);function g(R){return R&&R.__esModule?R:{default:R}}function E(R,B,Y,Q){return(0,n.default)(B)(R,(0,o.default)(Y),Q)}a.default=(0,f.default)(E,4),e.exports=a.default}(u1,u1.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=u1.exports,n=u(r),t=Jg.exports,o=u(t);function u(g){return g&&g.__esModule?g:{default:g}}function f(g,E,R){return(0,n.default)(g,1,E,R)}a.default=(0,o.default)(f,3),e.exports=a.default}($m,$m.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=f;var r=g_.exports,n=u(r),t=$m.exports,o=u(t);function u(g){return g&&g.__esModule?g:{default:g}}function f(g,E){return(0,n.default)(o.default,g,E)}e.exports=a.default}(Fx,Fx.exports);var A_=Ox(Fx.exports),ag=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,r=[],n=0;n<arguments.length;n++)r[n]=a[n];return this.args=r,A_(this.tasks)},e.prototype.tap=function(a,r){var n=this;this.tasks.push(function(t){r.apply(void 0,m_([],v_(n.args),!1)),t(null,a)})},e}(),T_={exports:{}},M_={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=s1.exports,n=Te(r),t=l1.exports,o=Te(t),u=u1.exports,f=Te(u),g=ry.exports,E=Te(g),R=ny.exports,B=Te(R),Y=Ov,Q=Te(Y),ce=Jg.exports,fe=Te(ce);function Te(Tt){return Tt&&Tt.__esModule?Tt:{default:Tt}}function Ve(Tt,kt,Yt){Yt=(0,E.default)(Yt);var cr=0,Mr=0,Dr=Tt.length,sn=!1;Dr===0&&Yt(null);function rn(Jn,fi){Jn===!1&&(sn=!0),sn!==!0&&(Jn?Yt(Jn):(++Mr===Dr||fi===o.default)&&Yt(null))}for(;cr<Dr;cr++)kt(Tt[cr],cr,(0,B.default)(rn))}function st(Tt,kt,Yt){return(0,f.default)(Tt,1/0,kt,Yt)}function at(Tt,kt,Yt){var cr=(0,n.default)(Tt)?Ve:st;return cr(Tt,(0,Q.default)(kt),Yt)}a.default=(0,fe.default)(at,3),e.exports=a.default})(M_,M_.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=f;var r=M_.exports,n=u(r),t=g_.exports,o=u(t);function u(g){return g&&g.__esModule?g:{default:g}}function f(g,E){return(0,o.default)(n.default,g,E)}e.exports=a.default}(T_,T_.exports);var jE=Ox(T_.exports),VE=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return jE(this.tasks)},e.prototype.tapPromise=function(a,r){var n=this;this.tasks.push(function(t){return Rx(n,void 0,void 0,function(){return Dx(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,a),[2]}})})})},e}(),P_={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=ry.exports,n=R(r),t=ny.exports,o=R(t),u=Ov,f=R(u),g=Jg.exports,E=R(g);function R(Y){return Y&&Y.__esModule?Y:{default:Y}}function B(Y,Q){if(Q=(0,n.default)(Q),!Array.isArray(Y))return Q(new Error("First argument to waterfall must be an array of functions"));if(!Y.length)return Q();var ce=0;function fe(Ve){var st=(0,f.default)(Y[ce++]);st.apply(void 0,Ve.concat([(0,o.default)(Te)]))}function Te(Ve){for(var st=[],at=arguments.length-1;at-- >0;)st[at]=arguments[at+1];if(Ve!==!1){if(Ve||ce===Y.length)return Q.apply(void 0,[Ve].concat(st));fe(st)}}fe([])}a.default=(0,E.default)(B),e.exports=a.default})(P_,P_.exports);var Zx=Ox(P_.exports),uR=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Zx(this.tasks)},e.prototype.tap=function(a,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,m_([],v_(n),!1));t(o?null:!1,a)})},e}(),Ux=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return A_(this.tasks)},e.prototype.tap=function(a,r){this.tasks.push(function(n){var t=r();n(t,a)})},e}(),GE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,r=[],n=0;n<arguments.length;n++)r[n]=a[n];return this.args=r,A_(this.tasks)},e.prototype.tapPromise=function(a,r){var n=this;this.tasks.push(function(t){return Rx(n,void 0,void 0,function(){return Dx(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,m_([],v_(this.args),!1))];case 1:return o.sent(),t(null,a),[2]}})})})},e}(),HE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,r=[],n=0;n<arguments.length;n++)r[n]=a[n];return this.args=r,A_(this.tasks)},e.prototype.tapPromise=function(a,r){var n=this;this.tasks.push(function(t){return Rx(n,void 0,void 0,function(){var o;return Dx(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,m_([],v_(this.args),!1))];case 1:return o=u.sent(),t(o,a),[2]}})})})},e}(),jx=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Zx(this.tasks)},e.prototype.tapPromise=function(a,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),Vx=G(67709),$E=G.n(Vx),WE,Gx,Hx,$x,k_,Wx,Xx,XE,Yx,qx,Kx,I_,Jx,Qx,YE,e2,t2,r2,Jp,n2,i2,qE,a2,o2,s2,L_,u2,l2,KE,c2,h2,f2,R_,p2,d2;function DP(e){var a=JE();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QE=(WE=(0,Ii.b2)(),Gx=(0,Ii.f3)(cn.SceneID),Hx=(0,Ii.f3)(cn.IIconService),$x=(0,Ii.f3)(cn.IFontService),k_=(0,Ii.f3)(cn.IControlService),Wx=(0,Ii.f3)(cn.IGlobalConfigService),Xx=(0,Ii.f3)(cn.IMapService),XE=(0,Ii.f3)(cn.ICoordinateSystemService),Yx=(0,Ii.f3)(cn.IRendererService),qx=(0,Ii.f3)(cn.ILayerService),Kx=(0,Ii.f3)(cn.IDebugService),I_=(0,Ii.f3)(cn.ICameraService),Jx=(0,Ii.f3)(cn.IInteractionService),Qx=(0,Ii.f3)(cn.IPickingService),YE=(0,Ii.f3)(cn.IShaderModuleService),e2=(0,Ii.f3)(cn.IMarkerService),t2=(0,Ii.f3)(cn.IPopupService),WE(r2=(Jp=function(e){(0,yt.Z)(r,e);var a=DP(r);function r(){var n;return(0,Be.Z)(this,r),n=a.call(this),(0,Pe.Z)((0,D.Z)(n),"destroyed",!1),(0,Pe.Z)((0,D.Z)(n),"loaded",!1),yo((0,D.Z)(n),"id",n2,(0,D.Z)(n)),yo((0,D.Z)(n),"iconService",i2,(0,D.Z)(n)),yo((0,D.Z)(n),"fontService",qE,(0,D.Z)(n)),yo((0,D.Z)(n),"controlService",a2,(0,D.Z)(n)),yo((0,D.Z)(n),"configService",o2,(0,D.Z)(n)),yo((0,D.Z)(n),"map",s2,(0,D.Z)(n)),yo((0,D.Z)(n),"coordinateSystemService",L_,(0,D.Z)(n)),yo((0,D.Z)(n),"rendererService",u2,(0,D.Z)(n)),yo((0,D.Z)(n),"layerService",l2,(0,D.Z)(n)),yo((0,D.Z)(n),"debugService",KE,(0,D.Z)(n)),yo((0,D.Z)(n),"cameraService",c2,(0,D.Z)(n)),yo((0,D.Z)(n),"interactionService",h2,(0,D.Z)(n)),yo((0,D.Z)(n),"pickingService",f2,(0,D.Z)(n)),yo((0,D.Z)(n),"shaderModuleService",R_,(0,D.Z)(n)),yo((0,D.Z)(n),"markerService",p2,(0,D.Z)(n)),yo((0,D.Z)(n),"popupService",d2,(0,D.Z)(n)),(0,Pe.Z)((0,D.Z)(n),"inited",!1),(0,Pe.Z)((0,D.Z)(n),"initPromise",void 0),(0,Pe.Z)((0,D.Z)(n),"rendering",!1),(0,Pe.Z)((0,D.Z)(n),"$container",void 0),(0,Pe.Z)((0,D.Z)(n),"canvas",void 0),(0,Pe.Z)((0,D.Z)(n),"markerContainer",void 0),(0,Pe.Z)((0,D.Z)(n),"hooks",void 0),(0,Pe.Z)((0,D.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),uf(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,Pe.Z)((0,D.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new GE},n}return(0,Me.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,mr.Z)(x().mark(function u(){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),g.next=3,new Promise(function(E){o.map.onCameraChanged(function(R){o.cameraService.init(),o.cameraService.update(R),E()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Vd.Drag,o.addSceneEvent.bind(o));case 10:case"end":return g.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,mr.Z)(x().mark(function u(){var f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(g=((f=o.map)===null||f===void 0?void 0:f.getOverlayContainer())||void 0,g?o.$container=g:o.$container=MP(o.configService.getSceneConfig(o.id).id||""),!o.$container){B.next=13;break}return o.canvas=wo("canvas","",o.$container),o.setCanvas(),B.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.registerContextLost(),o.initContainer(),$E()(o.$container,o.handleWindowResized),window.matchMedia&&((E=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||E===void 0||E.addListener(o.handleWindowResized)),B.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return B.stop()}},u)}))),this.render()}},{key:"registerContextLost",value:function(){var t=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return t.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,mr.Z)(x().mark(function u(){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(E){o.map.onCameraChanged(function(R){o.cameraService.init(),o.cameraService.update(R),o.map.version!=="GAODE2.x"&&E()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Vd.Drag,o.addSceneEvent.bind(o));case 5:case"end":return g.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,mr.Z)(x().mark(function u(){var f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(f=t.canvas,o.$container=f||null,!o.$container){E.next=7;break}return E.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return E.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.rendering||this.destroyed)){f.next=2;break}return f.abrupt("return");case 2:if(this.rendering=!0,this.inited){f.next=16;break}return f.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),f.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,f.next=20;break;case 16:return f.next=18,this.layerService.initLayers();case 18:return f.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return g=(f=this.$container)===null||f===void 0?void 0:f.getElementsByTagName("canvas")[0],B.next=3,this.render();case 3:return E=u==="jpg"?g==null?void 0:g.toDataURL("image/jpeg"):g==null?void 0:g.toDataURL("image/png"),B.abrupt("return",E);case 5:case"end":return B.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=wo("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,Vx.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var f;(f=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||f===void 0||f.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var g;(g=t.$container)===null||g===void 0||g.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=Xs,f=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,g=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,E=this.canvas;E&&(E.width=f*u,E.height=g*u),this.rendererService.viewport({x:0,y:0,width:u*f,height:u*g})}},{key:"setCanvas",value:function(){var t,o,u=Xs,f=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,g=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,E=this.canvas;E.width=f*u,E.height=g*u,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(Z.EventEmitter),n2=ro(Jp.prototype,"id",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i2=ro(Jp.prototype,"iconService",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qE=ro(Jp.prototype,"fontService",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a2=ro(Jp.prototype,"controlService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o2=ro(Jp.prototype,"configService",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s2=ro(Jp.prototype,"map",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=ro(Jp.prototype,"coordinateSystemService",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u2=ro(Jp.prototype,"rendererService",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l2=ro(Jp.prototype,"layerService",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KE=ro(Jp.prototype,"debugService",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c2=ro(Jp.prototype,"cameraService",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h2=ro(Jp.prototype,"interactionService",[Jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f2=ro(Jp.prototype,"pickingService",[Qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=ro(Jp.prototype,"shaderModuleService",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p2=ro(Jp.prototype,"markerService",[e2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=ro(Jp.prototype,"popupService",[t2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jp))||r2);function eC(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var v2=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function D_(e){var a={};return e=e.replace(v2,function(r,n,t){var o=t.split(":"),u=o[0].trim(),f="";switch(o.length>1&&(f=o[1].trim()),n){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(g,E){return g.push(Number(E.trim())),g},[]):f=new Array(eC(n)).fill(0);break;default:}return a[u]=f,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:a}}var m2,tC,rC=Ga.uniq,g2="#define PI 3.14159265359",nC=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,y2=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,iC=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,aC=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,OP=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,FP=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ay=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;
uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}`,_2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,b2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,oC=/precision\s+(high|low|medium)p\s+float/,sC=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,uC=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,lC=/void\s+main\s*\([^)]*\)\s*\{\n?/,zP=/}\n?[^{}]*$/,cC=(m2=(0,Ii.b2)(),m2(tC=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"moduleCache",{}),(0,Pe.Z)(this,"rawContentCache",{})}return(0,Me.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:g2,fs:g2}),this.registerModule("decode",{vs:nC,fs:""}),this.registerModule("projection",{vs:ay,fs:""}),this.registerModule("project",{vs:FP,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:b2}),this.registerModule("lighting",{vs:iC,fs:""}),this.registerModule("light",{vs:y2,fs:""}),this.registerModule("picking",{vs:OP,fs:aC}),this.registerModule("rotation_2d",{vs:_2,fs:""})}},{key:"registerModule",value:function(r,n){var t=n.vs,o=n.fs,u=n.uniforms,f=n.inject,g=D_(t),E=g.content,R=g.uniforms,B=D_(o),Y=B.content,Q=B.uniforms;this.rawContentCache[r]={fs:Y,inject:f,uniforms:(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},R),Q),u),vs:E}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.rawContentCache[r].inject,f={};u!=null&&u["vs:#decl"]&&(t=(u==null?void 0:u["vs:#decl"])+t,f=D_(u==null?void 0:u["vs:#decl"]).uniforms),u!=null&&u["vs:#main-start"]&&(t=t.replace(lC,function(Te){return Te+(u==null?void 0:u["vs:#main-start"])}));var g=this.processModule(t,[],"vs"),E=g.content,R=g.includeList,B=this.processModule(o,[],"fs"),Y=B.content,Q=B.includeList,ce="",fe=rC(R.concat(Q).concat(r)).reduce(function(Te,Ve){return(0,Ee.Z)((0,Ee.Z)({},Te),n.rawContentCache[Ve].uniforms)},(0,Ee.Z)({},f));return oC.test(Y)||(ce=ce+sC),ce=ce+Y,this.moduleCache[r]={fs:ce.trim(),uniforms:fe,vs:E.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(uC,function(f,g){var E=g.split(" "),R=E[0].replace(/"/g,"");if(n.indexOf(R)>-1)return"";var B=o.rawContentCache[R][t];n.push(R);var Y=o.processModule(B,n,t),Q=Y.content;return Q});return{content:u,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(t,o){return t+"#define ".concat(o.toUpperCase()," ").concat(r[o],`;
`)},`
`);return n}}]),e}())||tC);function hC(e,a){for(;!Object.prototype.hasOwnProperty.call(e,a)&&(e=(0,Ze.Z)(e),e!==null););return e}function Ou(){return typeof Reflect!="undefined"&&Reflect.get?Ou=Reflect.get.bind():Ou=function(a,r,n){var t=hC(a,r);if(t){var o=Object.getOwnPropertyDescriptor(t,r);return o.get?o.get.call(arguments.length<3?a:n):o.value}},Ou.apply(this,arguments)}var Qg=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),x2,fC,O_=(x2=(0,Ii.b2)(),x2(fC=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"shaderModuleService",void 0),(0,Pe.Z)(this,"rendererService",void 0),(0,Pe.Z)(this,"cameraService",void 0),(0,Pe.Z)(this,"mapService",void 0),(0,Pe.Z)(this,"interactionService",void 0),(0,Pe.Z)(this,"layerService",void 0),(0,Pe.Z)(this,"config",void 0)}return(0,Me.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Qg.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(cn.IRendererService),this.cameraService=r.getContainer().get(cn.ICameraService),this.mapService=r.getContainer().get(cn.IMapService),this.interactionService=r.getContainer().get(cn.IInteractionService),this.layerService=r.getContainer().get(cn.ILayerService),this.shaderModuleService=r.getContainer().get(cn.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||fC),w2,S2;function pC(e){var a=dC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC=(w2=(0,Ii.b2)(),w2(S2=function(e){(0,yt.Z)(r,e);var a=pC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){Ou((0,Ze.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(O_))||S2),E2,F_,c1,z_,C2;function BP(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=A2(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function A2(e,a){if(e){if(typeof e=="string")return T2(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T2(e,a)}}function T2(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var mC=(E2=(0,Ii.b2)(),F_=(0,Ii.f3)(cn.IPostProcessor),E2(c1=(z_=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"passes",[]),yo(this,"postProcessor",C2,this),(0,Pe.Z)(this,"layer",void 0),(0,Pe.Z)(this,"renderFlag",void 0),(0,Pe.Z)(this,"width",0),(0,Pe.Z)(this,"height",0)}return(0,Me.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,mr.Z)(x().mark(function n(){var t,o,u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:t=BP(this.passes),g.prev=1,t.s();case 3:if((o=t.n()).done){g.next=9;break}return u=o.value,g.next=7,u.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),t.e(g.t0);case 14:return g.prev=14,t.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return a.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Qg.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),C2=ro(z_.prototype,"postProcessor",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_))||c1),M2,P2;function gC(e){var a=yC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _C=(M2=(0,Ii.b2)(),M2(P2=function(e){(0,yt.Z)(r,e);var a=gC(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"pickingFBO",void 0),(0,Pe.Z)((0,D.Z)(n),"layer",void 0),(0,Pe.Z)((0,D.Z)(n),"width",0),(0,Pe.Z)((0,D.Z)(n),"height",0),(0,Pe.Z)((0,D.Z)(n),"alreadyInRendering",!1),(0,Pe.Z)((0,D.Z)(n),"pickFromPickingFBO",function(f){var g=f.x,E=f.y,R=f.lngLat,B=f.type;if(!(!n.layer.isVisible()||!n.layer.needPick(B))){var Y=n.rendererService,Q=Y.getViewportSize,ce=Y.readPixels,fe=Y.useFramebuffer,Te=Q(),Ve=Te.width,st=Te.height,at=n.layer.getLayerConfig(),Tt=at.enableHighlight,kt=at.enableSelect,Yt=g*Xs,cr=E*Xs;if(!(Yt>Ve||Yt<0||cr>st||cr<0)){var Mr;fe(n.pickingFBO,function(){var Dr;if(Mr=ce({x:Math.round(Yt),y:Math.round(st-(E+1)*Xs),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Mr[0]!==0||Mr[1]!==0||Mr[2]!==0){var sn=cc(Mr),rn=n.layer.getSource().getFeatureById(sn),Jn={x:g,y:E,type:B,lngLat:R,featureId:sn,feature:rn};rn&&(n.layer.setCurrentPickId(sn),n.triggerHoverOnLayer(Jn))}else{var fi={x:g,y:E,lngLat:R,type:n.layer.getCurrentPickId()===null?"un"+B:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,Ee.Z)((0,Ee.Z)({},fi),{},{type:"unpick"})),n.triggerHoverOnLayer(fi),n.layer.setCurrentPickId(null)}Tt&&n.highlightPickedFeature(Mr),kt&&B==="click"&&((Dr=Mr)===null||Dr===void 0?void 0:Dr.toString())!==[0,0,0,0].toString()&&n.selectFeature(Mr)})}}}),n}return(0,Me.Z)(r,[{key:"getType",value:function(){return Qg.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){Ou((0,Ze.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,f=u.createTexture2D,g=u.createFramebuffer,E=u.getViewportSize,R=E(),B=R.width,Y=R.height;this.pickingFBO=g({color:f({width:B,height:Y,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.interactionService.on(Vd.Hover,this.pickFromPickingFBO),this.interactionService.on(Vd.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Vd.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,f=u.getViewportSize,g=u.useFramebuffer,E=u.clear,R=f(),B=R.width,Y=R.height;this.alreadyInRendering=!0,(this.width!==B||this.height!==Y)&&(this.pickingFBO.resize({width:B,height:Y}),this.width=B,this.height=Y),g(this.pickingFBO,function(){E({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Q=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(Q),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,gi.Z)(t,3),u=o[0],f=o[1],g=o[2];this.layer.hooks.beforeHighlight.call([u,f,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,gi.Z)(t,3),u=o[0],f=o[1],g=o[2];this.layer.hooks.beforeSelect.call([u,f,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=uu(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=uu(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(O_))||P2),k2,I2,L2,h1,R2,bC=Ga.camelCase,xC=Ga.isNil,wC=Ga.upperFirst,SC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Wm=(k2=(0,Ii.b2)(),I2=(0,Ii.f3)(cn.IShaderModuleService),k2(L2=(h1=function(){function e(){(0,Be.Z)(this,e),yo(this,"shaderModuleService",R2,this),(0,Pe.Z)(this,"rendererService",void 0),(0,Pe.Z)(this,"config",void 0),(0,Pe.Z)(this,"quad",SC),(0,Pe.Z)(this,"enabled",!0),(0,Pe.Z)(this,"renderToScreen",!1),(0,Pe.Z)(this,"model",void 0),(0,Pe.Z)(this,"name",void 0),(0,Pe.Z)(this,"optionsToUpdate",{})}return(0,Me.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Qg.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(cn.IRendererService),this.shaderModuleService=r.getContainer().get(cn.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,f=t.createModel,g=this.setupShaders(),E=g.vs,R=g.fs,B=g.uniforms;this.model=f({vs:E,fs:R,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:Ke.FLOAT}),size:2})},uniforms:(0,Ee.Z)((0,Ee.Z)({u_Texture:null},B),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,f=u.useFramebuffer,g=u.getViewportSize,E=u.clear,R=g(),B=R.width,Y=R.height;f(this.renderToScreen?null:o.getWriteFBO(),function(){E({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var Q=(0,Ee.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[B,Y]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(Q.u_BloomFinal=1,Q.u_Texture2=n),t.model.draw({uniforms:Q})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,Ee.Z)((0,Ee.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){xC(r[t])||(n["u_".concat(wC(bC(t)))]=r[t])}),n}}]),e}(),R2=ro(h1.prototype,"shaderModuleService",[I2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h1))||L2),D2,f1;function EC(e){var a=CC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,TC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,B_=Ga.isNil,MC=(D2=(0,Ii.b2)(),D2(f1=function(e){(0,yt.Z)(r,e);var a=EC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:TC,fs:AC});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return B_(t.bloomRadius)||(o.u_radius=t.bloomRadius),B_(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),B_(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(Wm))||f1),p1,O2;function PC(e){var a=kC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,LC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,RC=Ga.isNil,DC=(p1=(0,Ii.b2)(),p1(O2=function(e){(0,yt.Z)(r,e);var a=PC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:LC,fs:IC});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return RC(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(Wm))||O2),F2,z2;function N_(e){var a=OC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function OC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,zC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BC=Ga.isNil,B2=(F2=(0,Ii.b2)(),F2(z2=function(e){(0,yt.Z)(r,e);var a=N_(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:zC,fs:FC});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return BC(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(Wm))||z2),N2,Z2;function NC(e){var a=ZC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,jC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,VC=(N2=(0,Ii.b2)(),N2(Z2=function(e){(0,yt.Z)(r,e);var a=NC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:jC,fs:UC});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}}]),r}(Wm))||Z2),U2,j2;function GC(e){var a=HC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,$C=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,WC=(U2=(0,Ii.b2)(),U2(j2=function(e){(0,yt.Z)(r,e);var a=GC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:$C,fs:V2}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Wm))||j2),G2,H2;function XC(e){var a=YC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,qC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,KC=(G2=(0,Ii.b2)(),G2(H2=function(e){(0,yt.Z)(r,e);var a=XC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:qC,fs:$2});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}}]),r}(Wm))||H2),Z_,W2;function JC(e){var a=QC();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e5=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,t5=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,X2=(Z_=(0,Ii.b2)(),Z_(W2=function(e){(0,yt.Z)(r,e);var a=JC(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:t5,fs:e5});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService.getViewportSize(),E=g.width,R=g.height;return{vs:o,fs:u,uniforms:(0,Ee.Z)((0,Ee.Z)({},f),{},{u_ViewportSize:[E,R]})}}}]),r}(Wm))||W2),Y2,q2;function r5(e){var a=n5();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function n5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i5=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,K2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,a5=(Y2=(0,Ii.b2)(),Y2(q2=function(e){(0,yt.Z)(r,e);var a=r5(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:K2,fs:i5}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Wm))||q2),J2,Q2;function o5(e){var a=s5();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function s5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u5=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,l5=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,c5=(J2=(0,Ii.b2)(),J2(Q2=function(e){(0,yt.Z)(r,e);var a=o5(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:u5,fs:l5}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Wm))||Q2),ew,tw,rw,nw,b0,iw,h5=(ew=(0,Ii.b2)(),tw=(0,Ii.f3)(cn.IRendererService),rw=(0,Ii.zY)(),ew(nw=(b0=function(){function e(){(0,Be.Z)(this,e),yo(this,"rendererService",iw,this),(0,Pe.Z)(this,"passes",[]),(0,Pe.Z)(this,"readFBO",void 0),(0,Pe.Z)(this,"writeFBO",void 0)}return(0,Me.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,f=o.height;return t({x:0,y:0,width:u,height:f,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return f.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var a=(0,mr.Z)(x().mark(function n(t,o){var u,f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.getReadFBOTex();case 2:u=E.sent,f=0;case 4:if(!(f<4)){E.next=11;break}return E.next=7,o.render(t,u);case 7:this.swap(),f++,E.next=4;break;case 11:case"end":return E.stop()}},n,this)}));function r(n,t){return a.apply(this,arguments)}return r}()},{key:"render",value:function(){var a=(0,mr.Z)(x().mark(function n(t){var o,u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:o=0;case 1:if(!(o<this.passes.length)){g.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(t,u);case 7:g.next=12;break;case 9:return g.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),iw=ro(b0.prototype,"rendererService",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ro(b0.prototype,"init",[rw],Object.getOwnPropertyDescriptor(b0.prototype,"init"),b0.prototype),b0))||nw),aw,Nf;function uv(e){var a=xu();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ka=(aw=(0,Ii.b2)(),aw(Nf=function(e){(0,yt.Z)(r,e);var a=uv(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getType",value:function(){return Qg.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){Ou((0,Ze.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,f=o.clear,g=t.multiPassRenderer.getPostProcessor().getReadFBO();u(g,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(E){E.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(O_))||Nf),Ia,Gd,Fv,Ev,wm;function ow(e){var a=sw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uw=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Ap=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,x0=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function d1(e,a){for(var r=0,n=1/a,t=e;t>0;)r=r+n*(t%a),t=Math.floor(t/a),n=n/a;return r}var U_=1,j_=(Ia=(0,Ii.b2)(),Gd=(0,Ii.f3)(cn.IShaderModuleService),Ia(Fv=(Ev=function(e){(0,yt.Z)(r,e);var a=ow(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),yo((0,D.Z)(n),"shaderModuleService",wm,(0,D.Z)(n)),(0,Pe.Z)((0,D.Z)(n),"haltonSequence",[]),(0,Pe.Z)((0,D.Z)(n),"accumulatingId",0),(0,Pe.Z)((0,D.Z)(n),"frame",0),(0,Pe.Z)((0,D.Z)(n),"timer",void 0),(0,Pe.Z)((0,D.Z)(n),"sampleRenderTarget",void 0),(0,Pe.Z)((0,D.Z)(n),"prevRenderTarget",void 0),(0,Pe.Z)((0,D.Z)(n),"outputRenderTarget",void 0),(0,Pe.Z)((0,D.Z)(n),"copyRenderTarget",void 0),(0,Pe.Z)((0,D.Z)(n),"blendModel",void 0),(0,Pe.Z)((0,D.Z)(n),"outputModel",void 0),(0,Pe.Z)((0,D.Z)(n),"copyModel",void 0),n}return(0,Me.Z)(r,[{key:"getType",value:function(){return Qg.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){Ou((0,Ze.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,f=u.createFramebuffer,g=u.createTexture2D;this.sampleRenderTarget=f({color:g({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.prevRenderTarget=f({color:g({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.outputRenderTarget=f({color:g({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})}),this.copyRenderTarget=f({color:g({width:1,height:1,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([d1(E,2),d1(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",uw),this.outputModel=this.createTriangleModel("copy-pass",Ap,{blend:{enable:!0,func:{srcRGB:Ke.ONE,dstRGB:Ke.ONE_MINUS_SRC_ALPHA,srcAlpha:Ke.ONE,dstAlpha:Ke.ONE_MINUS_SRC_ALPHA},equation:{rgb:Ke.FUNC_ADD,alpha:Ke.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Ap)}},{key:"render",value:function(t){var o=this,u=this.rendererService,f=u.clear,g=u.getViewportSize,E=u.useFramebuffer,R=g(),B=R.width,Y=R.height;this.sampleRenderTarget.resize({width:B,height:Y}),this.prevRenderTarget.resize({width:B,height:Y}),this.outputRenderTarget.resize({width:B,height:Y}),this.copyRenderTarget.resize({width:B,height:Y}),this.resetFrame(),this.stopAccumulating();var Q=t.multiPassRenderer.getPostProcessor().getReadFBO();E(Q,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Q}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var ce=function fe(Te){!o.accumulatingId||Te!==o.accumulatingId||o.isFinished()||(o.doRender(t),window.requestAnimationFrame(function(){fe(Te)}))};this.accumulatingId=U_++,this.timer=window.setTimeout(function(){ce(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,f=u.clear,g=u.getViewportSize,E=u.useFramebuffer,R=g(),B=R.width,Y=R.height,Q=t.getLayerConfig(),ce=Q.jitterScale,fe=ce===void 0?1:ce,Te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Te[0]*2-1)/B*fe,(Te[1]*2-1)/Y*fe),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var Ve=t.getLayerConfig();E(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:Ve.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),E(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var st=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=st,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:x0,fs:o});var f=this.shaderModuleService.getModule(t),g=f.vs,E=f.fs,R=f.uniforms,B=this.rendererService,Y=B.createAttribute,Q=B.createBuffer,ce=B.createModel;return ce((0,Ee.Z)({vs:g,fs:E,attributes:{a_Position:Y({buffer:Q({data:[-4,-4,4,-4,0,4],type:Ke.FLOAT}),size:2})},uniforms:(0,Ee.Z)({},R),depth:{enable:!1},count:3},u))}}]),r}(O_),wm=ro(Ev.prototype,"shaderModuleService",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev))||Fv),oy=new Ii.W2;oy.bind(cn.IGlobalConfigService).to(xf).inSingletonScope(),(0,Ii.GW)((0,Ii.b2)(),Z.EventEmitter),oy.bind(cn.IEventEmitter).to(Z.EventEmitter);var lw=(0,Ud.Z)(oy,!1),sy=function(a){var r=lw.lazyInject(a);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},f5=function(a){var r=lw.lazyMultiInject(a);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},lv=oy,cw=0;function uy(){var e=new Ii.W2;return e.parent=oy,e.bind(cn.SceneID).toConstantValue("".concat(cw++)),e.bind(cn.IShaderModuleService).to(cC).inSingletonScope(),e.bind(cn.ILayerService).to(LP).inSingletonScope(),e.bind(cn.IDebugService).to(wP).inSingletonScope(),e.bind(cn.ISceneService).to(QE).inSingletonScope(),e.bind(cn.ICameraService).to(Xi).inSingletonScope(),e.bind(cn.ICoordinateSystemService).to(mE).inSingletonScope(),e.bind(cn.IInteractionService).to(AP).inSingletonScope(),e.bind(cn.IPickingService).to(PP).inSingletonScope(),e.bind(cn.IControlService).to(Sl).inSingletonScope(),e.bind(cn.IMarkerService).to(Op).inSingletonScope(),e.bind(cn.IIconService).to(Si).inSingletonScope(),e.bind(cn.IFontService).to(An).inSingletonScope(),e.bind(cn.IPopupService).to(Nh).inSingletonScope(),e.bind(cn.INormalPass).to(vC).whenTargetNamed("clear"),e.bind(cn.INormalPass).to(_C).whenTargetNamed("pixelPicking"),e.bind(cn.INormalPass).to(ka).whenTargetNamed("render"),e.bind(cn.INormalPass).to(j_).whenTargetNamed("taa"),e.bind(cn.IFactoryNormalPass).toFactory(function(a){return function(r){return a.container.getNamed(cn.INormalPass,r)}}),e.bind(cn.IPostProcessingPass).to(WC).whenTargetNamed("copy"),e.bind(cn.IPostProcessingPass).to(MC).whenTargetNamed("bloom"),e.bind(cn.IPostProcessingPass).to(DC).whenTargetNamed("blurH"),e.bind(cn.IPostProcessingPass).to(B2).whenTargetNamed("blurV"),e.bind(cn.IPostProcessingPass).to(a5).whenTargetNamed("noise"),e.bind(cn.IPostProcessingPass).to(c5).whenTargetNamed("sepia"),e.bind(cn.IPostProcessingPass).to(VC).whenTargetNamed("colorHalftone"),e.bind(cn.IPostProcessingPass).to(KC).whenTargetNamed("hexagonalPixelate"),e.bind(cn.IPostProcessingPass).to(X2).whenTargetNamed("ink"),e.bind(cn.IFactoryPostProcessingPass).toFactory(function(a){return function(r){var n=a.container.getNamed(cn.IPostProcessingPass,r);return n.setName(r),n}}),e}function w0(e){var a=new Ii.W2;return a.parent=e,a.bind(cn.IStyleAttributeService).to(zE).inSingletonScope(),a.bind(cn.IMultiPassRenderer).to(mC).inSingletonScope(),a.bind(cn.IPostProcessor).to(h5).inSingletonScope(),a}var p5=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function hw(e){return p5.indexOf(e)}var qs=Ga.clamp,Qu=2,d5=4,fw=64,pw=128,V_=256,v1=512,m1=8192,lR=16384,NP=32768,g1=null,dw=131072,v5=262144,m5=524288,ZP=1048576,vw=2097152,UP=4194304,g5=8388608,y5=16777216,_5=null;function y1(e,a){return e=qs(Math.floor(e),0,255),a=qs(Math.floor(a),0,255),256*e+a}function b5(e){var a=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,f=e.stroke,g=e.strokeWidth,E=e.strokeOpacity,R=[],B=[],Y=[],Q=[y1(a[0],a[1]),y1(a[2],a[3])],ce=[y1(f[0],f[1]),y1(f[2],f[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(fe){var Te=(0,gi.Z)(fe,2),Ve=Te[0],st=Te[1];R.push([].concat(Q,[(Ve+1)*g5+(st+1)*vw+hw(o)*dw+r,(n+512)*m5+(t+512)*fw])),B.push([].concat(ce,[g,E])),Y.push([u,0,0,0])}),{packedBuffer:R,packedBuffer2:B,packedBuffer3:Y}}function x5(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var r=a?1:0,n=Math.floor(e*127);return n*_5+r*y5+n*dw+r*g1+n*v1+r*V_+n*Qu+r}var Sm={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Qh={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Xl=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),Em=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Ni=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),Mg=["mapload","mapchange","mapAfterFrameChange"],S0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Up=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),_1=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(g,E){n({x:r.x,y:r.y,z:r.z},function(R,B){if(R||B.length===0){E(R);return}B&&Zd([{data:B,bands:[0]}],t,o,function(Y,Q){Y?E(Y):Q&&g(Q)})})}));case 1:case"end":return f.stop()}},a)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),w5=function(){var e=(0,mr.Z)(x().mark(function a(r,n){return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(u,f){n({x:r.x,y:r.y,z:r.z},function(g,E){if(g||!E){f(g);return}E instanceof ArrayBuffer?ws(E,function(R,B){R&&f(R),u(B)}):E instanceof HTMLImageElement?u(E):f(g)})}));case 1:case"end":return o.stop()}},a)}));return function(r,n){return e.apply(this,arguments)}}();function S5(e,a){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return Ha(r,a)}):e.map(function(r){return{url:Ha(r.url,a),bands:r.bands||[0]}}):Ha(e,a)}function E5(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(a){return{url:a,bands:[0]}}):e}function mw(e,a){e.xhrCancel=function(){a.map(function(r){r.abort()})}}var C5=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o,u){var f,g,E,R,B,Y;return x().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(f=E5(n.url),!(f.length>1)){ce.next=15;break}return ce.next=4,A5(f,n);case 4:if(g=ce.sent,E=g.rasterFiles,R=g.xhrList,B=g.errList,mw(r,R),!(B.length>0)){ce.next=12;break}return t(B,null),ce.abrupt("return");case 12:Zd(E,o,u,t),ce.next=17;break;case 15:Y=el(n,function(fe,Te){if(fe)t(fe);else if(Te){var Ve=[{data:Te,bands:f[0].bands}];Zd(Ve,o,u,t)}}),mw(r,[Y]);case 17:case"end":return ce.stop()}},a)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function A5(e,a){return G_.apply(this,arguments)}function G_(){return G_=(0,mr.Z)(x().mark(function e(a,r){var n,t,o,u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<a.length)){fe.next=20;break}return f=a[u],g=(0,Ee.Z)((0,Ee.Z)({},r),{},{url:f.url}),E=f.bands,fe.next=10,io((0,Ee.Z)((0,Ee.Z)({},g),{},{type:"arrayBuffer"}));case 10:R=fe.sent,B=R.err,Y=R.data,Q=R.xhr,B&&o.push(B),t.push(Q),n.push({data:Y,bands:E});case 17:u++,fe.next=4;break;case 20:return fe.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return fe.stop()}},e)})),G_.apply(this,arguments)}var gw=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o,u){var f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return f={url:S5(r,n)},E.abrupt("return",new Promise(function(R,B){C5(t,f,function(Y,Q){Y?B(Y):Q&&R(Q)},o,u)}));case 2:case"end":return E.stop()}},a)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),e0=function(){var e=(0,mr.Z)(x().mark(function a(r,n,t,o){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return f=Array.isArray(r)?r[0]:r,o.wmtsOptions?(g=(o==null?void 0:o.getURLFromTemplate)||ja,u=g(f,(0,Ee.Z)((0,Ee.Z)({},n),o.wmtsOptions))):(E=(o==null?void 0:o.getURLFromTemplate)||Ha,u=E(f,n)),B.abrupt("return",new Promise(function(Y,Q){var ce,fe=Vc({url:u,type:(o==null||(ce=o.requestParameters)===null||ce===void 0?void 0:ce.type)||"arrayBuffer"},function(Te,Ve){Te?Q(Te):Ve&&Y(Ve)},o.transformResponse);t.xhrCancel=function(){return fe.cancel()}}));case 3:case"end":return B.stop()}},a)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),H_=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},b1={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},T5=[Up.ARRAYBUFFER,Up.RGB];function M5(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function P5(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(M5(e))throw new Error("tile server url is error");var r=(a==null?void 0:a.dataType)||Up.IMAGE;r===Up.RGB&&(r=Up.ARRAYBUFFER);var n=function(u,f){switch(r){case Up.IMAGE:return e0(e,u,f,a);case Up.CUSTOMIMAGE:case Up.CUSTOMTERRAINRGB:return w5(f,a==null?void 0:a.getCustomData);case Up.ARRAYBUFFER:return gw(e,u,f,(a==null?void 0:a.format)||H_,a==null?void 0:a.operation);case Up.CUSTOMARRAYBUFFER:case Up.CUSTOMRGB:return _1(f,a==null?void 0:a.getCustomData,(a==null?void 0:a.format)||H_,a==null?void 0:a.operation);default:return e0(e,u,f,a)}},t=(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},b1),a),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var k5=["extent","min","max","width","height","format","operation"];function I5(e,a){var r=a.extent,n=a.min,t=a.max,o=a.width,u=a.height,f=a.format,g=a.operation,E=(0,Uh.Z)(a,k5),R;if(f===void 0||so(e))R=Array.from(e);else{var B=Array.isArray(e)?e:[e];R=rv(B,f,g)}var Y={_id:1,dataArray:[(0,Ee.Z)((0,Ee.Z)({_id:1,data:R,width:o,height:u},E),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return Y}var L5={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},R5=function(){var e=(0,mr.Z)(x().mark(function a(r){return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,gi.Z)(r.bounds,4),f=u[0],g=u[1],E=u[2],R=u[3],B={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(f+E)/2,y:(g+R)/2},geometry:{type:"LineString",coordinates:[[E,R],[E,g],[f,g],[f,g]]}}]}}};o(B)}));case 1:case"end":return t.stop()}},a)}));return function(r){return e.apply(this,arguments)}}();function D5(e,a){var r=function(o){return R5(o)},n=(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},L5),a),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var x1=G(69848),yw=G.n(x1);function _w(e,a){var r=a.radius,n=r===void 0?40:r,t=a.maxZoom,o=t===void 0?18:t,u=a.minZoom,f=u===void 0?0:u,g=a.zoom,E=g===void 0?2:g;if(e.pointIndex){var R=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=O5(R),e}var B=new(yw())({radius:n,minZoom:f,maxZoom:o}),Y={type:"FeatureCollection",features:[]};return Y.features=e.dataArray.map(function(Q){return{type:"Feature",geometry:{type:"Point",coordinates:Q.coordinates},properties:(0,Ee.Z)({},Q)}}),B.load(Y.features),B}function O5(e){return e.map(function(a,r){return(0,Ee.Z)({coordinates:a.geometry.coordinates,_id:r+1},a.properties)})}function bw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],r=1;r<e.length;r++)e[r]>a&&(a=e[r]);return a}function xw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],r=1;r<e.length;r++)e[r]<a&&(a=e[r]);return a}function ww(e){if(e.length===0)return 0;for(var a=e[0],r=0,n,t=1;t<e.length;t++)n=a+e[t]*1,Math.abs(a)>=Math.abs(e[t])?r+=a-n+e[t]:r+=e[t]-n+a,a=n;return a+r*1}function Sw(e){if(e.length===0)throw new Error("mean requires at least one data point");return ww(e)/e.length}var Pg={min:xw,max:bw,mean:Sw,sum:ww};function F5(e){var a=Ew();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jP=Ga.cloneDeep,z5=Ga.isFunction,B5=Ga.isString,N5=Ga.mergeWith;function w1(e,a){if(Array.isArray(a))return a}var S1=function(e){(0,yt.Z)(r,e);var a=F5(r);function r(n,t){var o;return(0,Be.Z)(this,r),o=a.call(this),(0,Pe.Z)((0,D.Z)(o),"type","source"),(0,Pe.Z)((0,D.Z)(o),"isTile",!1),(0,Pe.Z)((0,D.Z)(o),"inited",!1),(0,Pe.Z)((0,D.Z)(o),"hooks",{init:new ag}),(0,Pe.Z)((0,D.Z)(o),"parser",{type:"geojson"}),(0,Pe.Z)((0,D.Z)(o),"transforms",[]),(0,Pe.Z)((0,D.Z)(o),"cluster",!1),(0,Pe.Z)((0,D.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,Pe.Z)((0,D.Z)(o),"invalidExtent",!1),(0,Pe.Z)((0,D.Z)(o),"dataArrayChanged",!1),(0,Pe.Z)((0,D.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,Me.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,f=u.method,g=f===void 0?"sum":f,E=u.field,R=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,R.forEach(function(B){B.id||(B.properties.point_count=1)}),(E||z5(g))&&(R=R.map(function(B){var Y=B.id;if(Y){var Q=o.clusterIndex.getLeaves(Y,1/0),ce=Q.map(function(Ve){return Ve.properties}),fe;if(B5(g)&&E){var Te=Qn(ce,E);fe=Pg[g](Te)}z5(g)&&(fe=g(ce)),B.properties.stat=fe}else B.properties.point_count=1;return B})),this.data=pe("geojson")({type:"FeatureCollection",features:R}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,f=u===void 0?"geojson":u,g=o.geometry;if(f==="geojson"&&!this.cluster){var E=t<this.originData.features.length?this.originData.features[t]:"null",R=jP(E);if(R!=null&&R.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var B=this.data.dataArray.find(function(Y){return Y._id===t});R.properties=B}return R}else return f==="json"&&g?this.data.dataArray.find(function(Y){return Y._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,Ee.Z)((0,Ee.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(f){return f[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var t;(t=this.tileset)===null||t===void 0||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,o,u){var f;(f=this.tileset)===null||f===void 0||f.reloadTileById(t,o,u)}},{key:"reloadTileByLnglat",value:function(t,o,u){var f;(f=this.tileset)===null||f===void 0||f.reloadTileByLnglat(t,o,u)}},{key:"getTileExtent",value:function(t,o){var u;return(u=this.tileset)===null||u===void 0?void 0:u.getTileExtent(t,o)}},{key:"getTileByZXY",value:function(t,o,u){var f;return(f=this.tileset)===null||f===void 0?void 0:f.getTileByZXY(t,o,u)}},{key:"reloadTileByExtent",value:function(t,o){var u;(u=this.tileset)===null||u===void 0||u.reloadTileByExtent(t,o)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",new Promise(function(E,R){try{u.excuteParser(),u.initCluster(),u.executeTrans(),E({})}catch(B){R(B)}}));case 1:case"end":return g.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=N5(this.cfg,t,w1);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Ee.Z)((0,Ee.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.inited=!1,f.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=pe(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=Wc(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new ao((0,Ee.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var f=u.type,g=le(f)(t.data,u);Object.assign(t.data,g)})}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=_w(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(o=ff(Jl(this.extent),t)),o[0].concat(o[1])}}]),r}(Z.EventEmitter);function $_(e,a){var r=a.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function W_(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Z5(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function Z5(e,a){if(e){if(typeof e=="string")return Cw(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cw(e,a)}}function Cw(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var ly=6378e3;function U5(e,a){var r=e.dataArray,n=a.size,t=n===void 0?10:n,o=t/(2*Math.PI*ly)*(256<<20)/2,u=j5(r,t),f=u.gridHash,g=u.gridOffset,E=$5(f,g,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:E}}function j5(e,a){var r=1/0,n=-1/0,t,o=W_(e),u;try{for(o.s();!(u=o.n()).done;){var f=u.value;t=f.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(at){o.e(at)}finally{o.f()}var g=(r+n)/2,E=V5(a,g);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var R={},B=W_(e),Y;try{for(B.s();!(Y=B.n()).done;){var Q=Y.value,ce=Q.coordinates[1],fe=Q.coordinates[0];if(Number.isFinite(ce)&&Number.isFinite(fe)){var Te=Math.floor((ce+90)/E.yOffset),Ve=Math.floor((fe+180)/E.xOffset),st="".concat(Te,"-").concat(Ve);R[st]=R[st]||{count:0,points:[]},R[st].count+=1,R[st].points.push(Q)}}}catch(at){B.e(at)}finally{B.f()}return{gridHash:R,gridOffset:E}}function V5(e,a){var r=G5(e),n=H5(a,e);return{yOffset:r,xOffset:n}}function G5(e){return e/ly*(180/Math.PI)}function H5(e,a){return a/ly*(180/Math.PI)/Math.cos(e*Math.PI/180)}function $5(e,a,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),f=parseInt(u[0],10),g=parseInt(u[1],10),E={};if(r.field&&r.method){var R=wp(e[t].points,r.field);E[r.method]=Dh[r.method](R)}return Object.assign(E,{_id:o,coordinates:Gn([-180+a.xOffset*(g+.5),-90+a.yOffset*(f+.5)]),rawData:e[t].points,count:e[t].count}),n.push(E),n},[])}var t0=Math.PI/3,E0=[0,t0,2*t0,3*t0,4*t0,5*t0];function W5(e){return e[0]}function C0(e){return e[1]}function X5(){var e=0,a=0,r=1,n=1,t=W5,o=C0,u,f,g;function E(B){var Y={},Q=[],ce,fe=B.length;for(ce=0;ce<fe;++ce)if(!(isNaN(Ve=+t.call(null,Te=B[ce],ce,B))||isNaN(st=+o.call(null,Te,ce,B)))){var Te,Ve,st,at=Math.round(st=st/g),Tt=Math.round(Ve=Ve/f-(at&1)/2),kt=st-at;if(Math.abs(kt)*3>1){var Yt=Ve-Tt,cr=Tt+(Ve<Tt?-1:1)/2,Mr=at+(st<at?-1:1),Dr=Ve-cr,sn=st-Mr;Yt*Yt+kt*kt>Dr*Dr+sn*sn&&(Tt=cr+(at&1?1:-1)/2,at=Mr)}var rn=Tt+"-"+at,Jn=Y[rn];Jn?Jn.push(Te):(Q.push(Jn=Y[rn]=[Te]),Jn.x=(Tt+(at&1)/2)*f,Jn.y=at*g)}return Q}function R(B){var Y=0,Q=0;return E0.map(function(ce){var fe=Math.sin(ce)*B,Te=-Math.cos(ce)*B,Ve=fe-Y,st=Te-Q;return Y=fe,Q=Te,[Ve,st]})}return E.hexagon=function(B){return"m"+R(B==null?u:+B).join("l")+"z"},E.centers=function(){for(var B=[],Y=Math.round(a/g),Q=Math.round(e/f),ce=Y*g;ce<n+u;ce+=g,++Y)for(var fe=Q*f+(Y&1)*f/2;fe<r+f/2;fe+=f)B.push([fe,ce]);return B},E.mesh=function(){var B=R(u).slice(0,4).join("l");return E.centers().map(function(Y){return"M"+Y+"m"+B}).join("")},E.x=function(B){return arguments.length?(t=B,E):t},E.y=function(B){return arguments.length?(o=B,E):o},E.radius=function(B){return arguments.length?(u=+B,f=u*2*Math.sin(t0),g=u*1.5,E):u},E.size=function(B){return arguments.length?(e=a=0,r=+B[0],n=+B[1],E):[r-e,n-a]},E.extent=function(B){return arguments.length?(e=+B[0][0],a=+B[0][1],r=+B[1][0],n=+B[1][1],E):[[e,a],[r,n]]},E.radius(1)}var Aw=6378e3;function E1(e,a){var r=e.dataArray,n=a.size,t=n===void 0?10:n,o=a.method,u=o===void 0?"sum":o,f=t/(2*Math.PI*Aw)*(256<<20)/2,g=r.map(function(Y){var Q=Gn(Y.coordinates),ce=(0,gi.Z)(Q,2),fe=ce[0],Te=ce[1];return(0,Ee.Z)((0,Ee.Z)({},Y),{},{coordinates:[fe,Te]})}),E=X5().radius(f).x(function(Y){return Y.coordinates[0]}).y(function(Y){return Y.coordinates[1]}),R=E(g),B={dataArray:R.map(function(Y,Q){var ce;if(a.field&&u){var fe=wp(Y,a.field);Y[u]=Dh[u](fe)}return ce={},(0,Pe.Z)(ce,a.method,Y[u]),(0,Pe.Z)(ce,"count",Y.length),(0,Pe.Z)(ce,"rawData",Y),(0,Pe.Z)(ce,"coordinates",[Y.x,Y.y]),(0,Pe.Z)(ce,"_id",Q),ce}),radius:f,xOffset:f,yOffset:f,type:"hexagon"};return B}function Tw(e,a){var r=a.sourceField,n=a.targetField,t=a.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var f=u[n];return(0,Ee.Z)((0,Ee.Z)({},u),o[f])}),e}function Mw(e,a){var r=a.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ce("rasterTile",P5),Ce("mvt",tv),Ce("geojsonvt",ts),Ce("testTile",D5),Ce("geojson",ks),Ce("jsonTile",Ys),Ce("image",ma),Ce("csv",Vo),Ce("json",Cs),Ce("raster",_m),Ce("rasterRgb",I5),Ie("cluster",_w),Ie("filter",$_),Ie("join",Tw),Ie("map",Mw),Ie("grid",U5),Ie("hexagon",E1);var cy=S1;function X_(e){var a=Pw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y_=function(e){(0,yt.Z)(r,e);var a=X_(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"added",!1),(0,Pe.Z)((0,D.Z)(t),"eventHandle",function(o){t.polyfillEvent(o),t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,Ee.Z)((0,Ee.Z)({},t.getDefault()),n),Ih(["update","onMove","onMapClick"],(0,D.Z)(t)),t.init(),t}return(0,Me.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ss.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(cn.IMapService),this.sceneSerive=t.get(cn.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&fl(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&fl(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Ll(o,"".concat(eh[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,f=this.lngLat,g=f.lng,E=f.lat,R=this.mapsService.lngLatToContainer([g,E]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var B=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),Y=B.containerHeight,Q=B.containerWidth,ce=B.bounds;if(!ce)return;if(Math.abs(ce[0][0])>180||Math.abs(ce[1][0])>180){if(R.x>Q){var fe=this.mapsService.lngLatToContainer([g-360,E]);R.x=fe.x}if(R.x<0){var Te=this.mapsService.lngLatToContainer([g+360,E]);R.x=Te.x}}(R.x>Q||R.x<0||R.y>Y||R.y<0)&&(o.style.display="none"),o.style.left=R.x+u[0]+"px",o.style.top=R.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,f=u.color,g=u.anchor;if(!o){this.defaultMarker=!0,o=wo("div"),this.markerOption.element=o;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var R=document.createElementNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),R.setAttributeNS(null,"fill",f),E.appendChild(R),o.appendChild(E)}pl(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(B){var Y,Q,ce=((Y=t.markerOption)===null||Y===void 0?void 0:Y.style)&&((Q=t.markerOption)===null||Q===void 0?void 0:Q.style[B]);o&&(o.style[B]=ce)}),kc(o,g,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){!this.mapsService||this.mapsService.version!=="GAODE2.x"||xc()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(Z.EventEmitter);function cv(e){var a=Y5();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Y5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q5=Ga.merge,hy=function(e){(0,yt.Z)(r,e);var a=cv(r);function r(n){var t,o;return(0,Be.Z)(this,r),o=a.call(this),(0,Pe.Z)((0,D.Z)(o),"markers",[]),(0,Pe.Z)((0,D.Z)(o),"points",[]),(0,Pe.Z)((0,D.Z)(o),"clusterMarkers",[]),o.markerLayerOption=q5(o.getDefault(),n),Ih(["update"],(0,D.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,Me.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(cn.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),f=this.mapsService.getBounds();this.bbox=ff(f,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),f=u.lng,g=u.lat,E={geometry:{type:"Point",coordinates:[f,g]},properties:(0,Ee.Z)((0,Ee.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(E),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,f=u===void 0?0:u,g=t.maxZoom;this.clusterIndex=new(yw())({radius:o,minZoom:f,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,f=t[0].concat(t[1]),g=this.clusterIndex.getClusters(f,o);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],g.forEach(function(E){var R,B=u.markerLayerOption.clusterOption,Y=B.field,Q=B.method;if((R=E.properties)!==null&&R!==void 0&&R.cluster_id){var ce,fe=u.getLeaves((ce=E.properties)===null||ce===void 0?void 0:ce.cluster_id);if(E.properties.clusterData=fe,Y&&Q){var Te=fe==null?void 0:fe.map(function(kt){var Yt=(0,Pe.Z)({},Y,kt.properties[Y]);return Yt}),Ve=wp(Te,Y),st=Jf(Q,Ve),at="point_"+Q;E.properties[at]=st.toFixed(2)}}var Tt=u.clusterMarker(E);u.clusterMarkers.push(Tt),Tt.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1/0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,f=u.element,g=f===void 0?this.generateElement.bind(this):f,E=new Y_({element:g(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Tf(this.bbox,o))&&(this.bbox=ff(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=wo("div","l7-marker-cluster"),u=wo("div","",o),f=wo("span","",u),g=this.markerLayerOption.clusterOption,E=g.field,R=g.method;t.properties.point_count=t.properties.point_count||1;var B=E&&R?t.properties["point_"+R]||t.properties[E]:t.properties.point_count;return f.textContent=B,o}}]),r}(Z.EventEmitter),q_=G(4157);function K5(e){var a=J5();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r0=function(e){(0,yt.Z)(r,e);var a=K5(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this),r.controlCount++,t.controlOption=(0,Ee.Z)((0,Ee.Z)({},t.getDefault(n)),n||{}),t}return(0,Me.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var f=(0,gi.Z)(u,2),g=f[0],E=f[1];E===void 0&&(t[g]=o[g])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,Ee.Z)((0,Ee.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(cn.IMapService),this.renderService=t.get(cn.IRendererService),this.layerService=t.get(cn.ILayerService),this.controlService=t.get(cn.IControlService),this.configService=t.get(cn.IGlobalConfigService),this.scene=t.get(cn.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),pl(this.container,"l7-control");var o=this.controlOption,u=o.className,f=o.style;return u&&this.setClassName(u),f&&this.setStyle(f),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;fl(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return wo("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;bh(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;pl(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:ga.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ga.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&bh(o,u),t&&pl(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(H());(0,Pe.Z)(r0,"controlCount",0);function Q5(e){var a=kw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fy=function(e){(0,yt.Z)(r,e);var a=Q5(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"isDisable",!1),n}return(0,Me.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return wo("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,f=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(f),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,f=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(f),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&fl(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var f;(f=this.button)===null||f===void 0||f.insertBefore(t,u)}else{var g;(g=this.button)===null||g===void 0||g.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(this.button)if(bh(this.button,"l7-button-control--row"),bh(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=wo("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,pl(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(fl(this.buttonText),this.buttonText=void 0)}}]),r}(r0);function eA(e){var a=Iw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K_=function(e){(0,yt.Z)(r,e);var a=eA(r);function r(n,t){var o;return(0,Be.Z)(this,r),o=a.call(this),(0,Pe.Z)((0,D.Z)(o),"isShow",!1),(0,Pe.Z)((0,D.Z)(o),"timeout",null),(0,Pe.Z)((0,D.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),bh(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,D.Z)(o)&&u.isShow&&u.hide()}),o.emit("show"),window.addEventListener("pointerdown",o.onPopperUnClick)),(0,D.Z)(o)}),(0,Pe.Z)((0,D.Z)(o),"hide",function(){return o.isShow&&(pl(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide"),window.removeEventListener("pointerdown",o.onPopperUnClick)),(0,D.Z)(o)}),(0,Pe.Z)((0,D.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){o.isShow&&(o.hide(),o.timeout=null)},300))}),(0,Pe.Z)((0,D.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,Pe.Z)((0,D.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,Pe.Z)((0,D.Z)(o),"onPopperUnClick",function(u){Ms(u.target,[".l7-button-control",".l7-popper-content"])||o.hide()}),(0,Pe.Z)((0,D.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,Pe.Z)((0,D.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,D.Z)(o)),o}return(0,Me.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(Kl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),fl(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,f=o.offset,g=f===void 0?[0,0]:f,E=o.placement,R=(0,gi.Z)(g,2),B=R[0],Y=R[1],Q=this.button.getBoundingClientRect(),ce=u.getBoundingClientRect(),fe=kp(Q,ce),Te=fe.left,Ve=fe.right,st=fe.top,at=fe.bottom,Tt=!1,kt=!1;/^(left|right)/.test(E)?(E.includes("left")?t.right="".concat(Q.width+Ve,"px"):E.includes("right")&&(t.left="".concat(Q.width+Te,"px")),E.includes("start")?t.top="".concat(st,"px"):E.includes("end")?t.bottom="".concat(at,"px"):(t.top="".concat(st+Q.height/2,"px"),kt=!0,t.transform="translate(".concat(B,"px, calc(").concat(Y,"px - 50%))"))):/^(top|bottom)/.test(E)&&(E.includes("top")?t.bottom="".concat(Q.height+at,"px"):E.includes("bottom")&&(t.top="".concat(Q.height+st,"px")),E.includes("start")?t.left="".concat(Te,"px"):E.includes("end")?t.right="".concat(Ve,"px"):(t.left="".concat(Te+Q.width/2,"px"),Tt=!0,t.transform="translate(calc(".concat(B,"px - 50%), ").concat(Y,"px)"))),t.transform="translate(calc(".concat(B,"px - ").concat(Tt?"50%":"0%","), calc(").concat(Y,"px - ").concat(kt?"50%":"0%",")");var Yt=E.split("-");Yt.length&&pl(this.popperDOM,Yt.map(function(cr){return"l7-popper-".concat(cr)}).join(" ")),qf(this.popperDOM,Yp(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,f=u===void 0?"":u,g=t.content,E=wo("div","l7-popper l7-popper-hide ".concat(f)),R=wo("div","l7-popper-content"),B=wo("div","l7-popper-arrow");return E.appendChild(R),E.appendChild(B),o.appendChild(E),this.popperDOM=E,this.contentDOM=R,g&&this.setContent(g),E}}]),r}(Z.EventEmitter);(0,Pe.Z)(K_,"conflictPopperList",[]);function tA(e){var a=rA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var py={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},Lw=function(e){(0,yt.Z)(r,e);var a=tA(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Ou((0,Ze.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t),f=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:f instanceof Element?"bottom":py[f],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,f=o.popperPlacement,g=o.popperTrigger,E=this.mapsService.getMapContainer();return this.popper=new K_(this.button,{className:u,placement:f,trigger:g,container:E,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if(Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(fy);function nA(e){var a=iA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var og=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(og||{}),C1=function(e){(0,yt.Z)(r,e);var a=nA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"selectValue",[]),(0,Pe.Z)((0,D.Z)(n),"createNormalOption",function(f){var g=n.selectValue.includes(f.value),E=wo("div","l7-select-control-item ".concat(g?og.ActiveOptionClassName:""));n.getIsMultiple()&&E.appendChild(n.createCheckbox(g)),f.icon&&E.appendChild(f.icon);var R=wo("span");return R.innerText=f.text,E.appendChild(R),E}),(0,Pe.Z)((0,D.Z)(n),"onItemClick",function(f){if(n.getIsMultiple()){var g=n.selectValue.findIndex(function(E){return E===f.value});g>-1?n.selectValue.splice(g,1):n.selectValue=[].concat((0,Vn.Z)(n.selectValue),[f.value])}else n.selectValue=[f.value];n.setSelectValue(n.selectValue)}),n}return(0,Me.Z)(r,[{key:"setOptions",value:function(t){Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,f=this.transSelectValue(t);this.optionDOMList.forEach(function(g){var E=g.getAttribute(og.OptionValueAttrKey),R=o.getIsMultiple()?g.querySelector("input[type=checkbox]"):void 0;f.includes(E)?(pl(g,og.ActiveOptionClassName),R&&xp(R,!0)):(bh(g,og.ActiveOptionClassName),R&&xp(R,!1))}),this.selectValue=f,u&&this.emit("selectChange",this.getIsMultiple()?f:f[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),f=wo("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&pl(f,"l7-select-control--multiple");var g=t.map(function(E,R){var B=u?o.createImageOption(E):o.createNormalOption(E);return B.setAttribute(og.OptionValueAttrKey,E.value),B.setAttribute(og.OptionIndexAttrKey,window.String(R)),B.addEventListener("click",o.onItemClick.bind(o,E)),B});return f.append.apply(f,(0,Vn.Z)(g)),this.optionDOMList=g,f}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=wo("div","l7-select-control-item ".concat(o?og.ActiveOptionClassName:"")),f=wo("img");f.setAttribute("src",t.img),$c(f),u.appendChild(f);var g=wo("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var E=wo("span");return E.innerText=t.text,g.appendChild(E),u.appendChild(g),u}},{key:"createCheckbox",value:function(t){var o=wo("input");return o.setAttribute("type","checkbox"),t&&xp(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(Lw),Xm=function(a){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(a)),r.appendChild(n),r};function aA(e){var a=oA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=function(e){(0,yt.Z)(r,e);var a=aA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"onClick",(0,mr.Z)(x().mark(function f(){var g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(g=n.controlOption.onExport,g!=null){R.next=5;break}R.next=10;break;case 5:return R.t0=g,R.next=8,n.getImage();case 8:R.t1=R.sent,(0,R.t0)(R.t1);case 10:case"end":return R.stop()}},f)}))),(0,Pe.Z)((0,D.Z)(n),"mergeImage",(0,mr.Z)(x().mark(function f(){var g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt=arguments;return x().wrap(function(Mr){for(;;)switch(Mr.prev=Mr.next){case 0:for(R=n.controlOption.imageType,B=(g=(E=n.mapsService.getContainer())===null||E===void 0?void 0:E.getBoundingClientRect())!==null&&g!==void 0?g:{},Y=B.width,Q=Y===void 0?0:Y,ce=B.height,fe=ce===void 0?0:ce,Te=document.createElement("canvas"),Te.width=Q,Te.height=fe,Ve=Te.getContext("2d"),st=Yt.length,at=new Array(st),Tt=0;Tt<st;Tt++)at[Tt]=Yt[Tt];return Mr.next=9,Promise.all(at.map(function(Dr){return new Promise(function(sn){var rn=new Image;rn.onload=function(){sn(rn)},rn.src=Dr})}));case 9:return kt=Mr.sent,kt.forEach(function(Dr){Ve==null||Ve.drawImage(Dr,0,0,Q,fe)}),Mr.abrupt("return",Te.toDataURL("image/".concat(R)));case 12:case"end":return Mr.stop()}},f)}))),n}return(0,Me.Z)(r,[{key:"onAdd",value:function(){var t=Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Xm("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.mapsService.exportMap("png");case 2:return u=E.sent,E.next=5,this.scene.exportPng("png");case 5:return f=E.sent,E.abrupt("return",this.mergeImage.apply(this,(0,Vn.Z)([u,f].filter(function(R){return R}))));case 7:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(fy);function uA(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Rw(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function Rw(e,a){if(e){if(typeof e=="string")return J_(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J_(e,a)}}function J_(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var Dw=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],sg=function(){if(typeof document=="undefined")return!1;for(var e=Dw[0],a={},r=0,n=Dw;r<n.length;r++){var t=n[r],o=t==null?void 0:t[1];if(o in document){var u=uA(t.entries()),f;try{for(u.s();!(f=u.n()).done;){var g=(0,gi.Z)(f.value,2),E=g[0],R=g[1];a[e[E]]=R}}catch(B){u.e(B)}finally{u.f()}return a}}return!1}(),Q_={change:sg.fullscreenchange,error:sg.fullscreenerror},zv={request:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function f(){zv.off("change",f),n()};zv.on("change",o);var u=a[sg.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(a,r){if(!zv.isFullscreen){a();return}var n=function o(){zv.off("change",o),a()};zv.on("change",n);var t=document[sg.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(a,r){return zv.isFullscreen?zv.exit():zv.request(a,r)},onchange:function(a){zv.on("change",a)},onerror:function(a){zv.on("error",a)},on:function(a,r){var n=Q_[a];n&&document.addEventListener(n,r,!1)},off:function(a,r){var n=Q_[a];n&&document.removeEventListener(n,r,!1)},raw:sg};Object.defineProperties(zv,{isFullscreen:{get:function(){return!!document[sg.fullscreenElement]}},element:{enumerable:!0,get:function(){var a;return(a=document[sg.fullscreenElement])!==null&&a!==void 0?a:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[sg.fullscreenEnabled]}}}),sg||(zv={isEnabled:!1});var eb=zv;function lA(e){var a=cA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=function(e){(0,yt.Z)(r,e);var a=lA(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this,n),(0,Pe.Z)((0,D.Z)(t),"isFullscreen",!1),(0,Pe.Z)((0,D.Z)(t),"toggleFullscreen",(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!eb.isEnabled){f.next=3;break}return f.next=3,eb.toggle(t.mapContainer);case 3:case"end":return f.stop()}},o)}))),(0,Pe.Z)((0,D.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,Pe.Z)((0,D.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,f=o.btnIcon,g=o.title,E=o.exitBtnText,R=o.exitBtnIcon,B=o.exitTitle;t.isFullscreen?(t.setBtnTitle(B),t.setBtnText(E),t.setBtnIcon(R)):(t.setBtnTitle(g),t.setBtnText(u),t.setBtnIcon(f)),t.emit("fullscreenChange",t.isFullscreen)}),eb.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,Me.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,f=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(f)),Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Hc(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){Ou((0,Ze.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:Xm("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Xm("l7-icon-exit-fullscreen")})}}]),r}(fy);function fA(e){var a=Ow();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=function(e){(0,yt.Z)(r,e);var a=fA(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this,n),(0,Pe.Z)((0,D.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(f){var g=f.coords,E=g!=null?g:{},R=E.longitude,B=E.latitude;!isNaN(R)&&!isNaN(B)?o([R,B]):u()},function(f){u(f)})})}),(0,Pe.Z)((0,D.Z)(t),"onClick",(0,mr.Z)(x().mark(function o(){var u,f,g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(window.navigator.geolocation){R.next=2;break}return R.abrupt("return");case 2:return u=t.controlOption.transform,R.next=5,t.getGeoLocation();case 5:if(f=R.sent,g=t.mapsService.getZoom(),R.t0=t.mapsService,R.t1=g>15?g:15,!u){R.next=15;break}return R.next=12,u(f);case 12:R.t2=R.sent,R.next=16;break;case 15:R.t2=f;case 16:R.t3=R.t2,R.t0.setZoomAndCenter.call(R.t0,R.t1,R.t3);case 18:case"end":return R.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,Me.Z)(r,[{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:Xm("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(fy);function dA(e){var a=Fw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function tb(e){return e&&e.layer}var vA=function(e){(0,yt.Z)(r,e);var a=dA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"onLayerChange",function(){var f;(f=n.controlOption.layers)!==null&&f!==void 0&&f.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,Pe.Z)((0,D.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,Pe.Z)((0,D.Z)(n),"onSelectChange",function(){n.layers.forEach(function(f){var g=n.selectValue.includes(f.name),E=f.isVisible();g&&!E&&f.show(),!g&&E&&f.hide()})}),n}return(0,Me.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(f){if(f instanceof Object&&(tb(f)?u.push(f.layer):u.push(f)),typeof f=="string"){var g=t.getLayer(f)||t.getLayerByName(f);g&&u.push(g)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Xm("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){var t=this,o=this.controlOption.layers,u=o==null?void 0:o.every(function(f){return f.img});return o?o==null?void 0:o.map(function(f){if(tb(f))return{text:f.name||f.layer.name,value:f.layer.name,img:u?f.img:void 0};if(typeof f=="string"){var g=t.layerService.getLayer(f)||t.layerService.getLayerByName(f);return{text:g==null?void 0:g.name,value:g==null?void 0:g.name}}return{text:f.name,value:f.name}}):this.layers.map(function(f){return{text:f.name,value:f.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(C1);function mA(e){var a=zw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=function(e){(0,yt.Z)(r,e);var a=mA(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getDefault",value:function(){return{position:ga.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=wo("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(Kl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,f=o.img,g=wo("img");if(g.setAttribute("src",f),g.setAttribute("aria-label","AntV logo"),$c(g),u){var E=wo("a","l7-control-logo-link");E.target="_blank",E.href=u,E.rel="noopener nofollow",E.setAttribute("rel","noopener nofollow"),E.appendChild(g),t.appendChild(E)}else t.appendChild(g)}}]),r}(r0),gA={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},A1={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function Bw(e){var a=T1();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function T1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yA=function(e){(0,yt.Z)(r,e);var a=Bw(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,Me.Z)(r,[{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Xm("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?A1:gA;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,gi.Z)(o,2),f=u[0],g=u[1];return typeof g=="string"&&f!=="blank"}).map(function(o){var u,f=(0,gi.Z)(o,2),g=f[0],E=f[1],R=(u=t[g])!==null&&u!==void 0?u:{},B=R.text,Y=R.img;return{text:B!=null?B:g,value:E,img:Y,key:g}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,f,g=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(f=this.controlOption.options.find(function(R){return R.key===g}))===null||f===void 0?void 0:f.value)!==null&&u!==void 0?u:g}else{var E=this.getMapStyle();E?this.controlOption.defaultValue=E:this.mapsService.map.once("styledata",function(){var R=o.mapsService.getMapStyle();o.controlOption.defaultValue=R,o.setSelectValue(R,!1)})}return this.on("selectChange",this.onMapThemeChange),Ou((0,Ze.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(C1);function Nw(e){var a=Zw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=function(e){(0,yt.Z)(r,e);var a=Nw(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"location",[0,0]),(0,Pe.Z)((0,D.Z)(n),"onMouseMove",function(f){var g=n.location,E=f.lngLat||f.lnglat,R=n.controlOption.transform;E&&(g=[E.lng,E.lat]),n.location=g,R&&(g=R(g)),n.insertLocation2HTML(g),n.emit("locationChange",g)}),n}return(0,Me.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:ga.BOTTOMLEFT,transform:function(u){var f=(0,gi.Z)(u,2),g=f[0],E=f[1];return[+(+g).toFixed(6),+(+E).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=wo("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(r0);function jw(e){var a=_A();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VP=function(e){(0,yt.Z)(r,e);var a=jw(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"update",function(){var f=n.mapsService,g=n.controlOption.maxWidth,E=f.getSize()[1]/2,R=f.containerToLngLat([0,E]),B=f.containerToLngLat([g,E]),Y=wh([R.lng,R.lat],[B.lng,B.lat]);n.updateScales(Y)}),n}return(0,Me.Z)(r,[{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:ga.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=wo("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,f=o.imperial;u&&t&&this.updateMetric(t),f&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){Kl(t);var o=this.controlOption,u=o.metric,f=o.imperial,g=o.maxWidth,E=o.lockWidth;E&&qf(t,"width: ".concat(g,"px")),u&&(this.mScale=wo("div","l7-control-scale-line",t)),f&&(this.iScale=wo("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var f=this.controlOption.maxWidth;t.style.width=Math.round(f*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,f,g;o>5280?(u=o/5280,f=this.getRoundNum(u),this.updateScale(this.iScale,f+" mi",f/u)):(g=this.getRoundNum(o),this.updateScale(this.iScale,g+" ft",g/o))}}]),r}(r0);function bA(e){var a=nb();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=function(e){(0,yt.Z)(r,e);var a=bA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,Pe.Z)((0,D.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,Pe.Z)((0,D.Z)(n),"updateDisabled",function(){var f=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||f.getZoom()<=f.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(f.getZoom()))),(n.disabled||f.getZoom()>=f.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,Me.Z)(r,[{key:"getDefault",value:function(t){return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:ga.BOTTOMRIGHT,name:"zoom",zoomInText:Xm("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Xm("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(t){Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=wo("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){Kl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,f,g){var E=wo("button",u,f);return typeof t=="string"?E.innerHTML=t:E.append(t),E.title=o,g&&E.addEventListener("click",g),E}}]),r}(r0);function Vw(e){var a=wA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function wA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gw=function(e){(0,yt.Z)(r,e);var a=Vw(r);function r(n){var t;(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"isShow",!0),(0,Pe.Z)((0,D.Z)(t),"onMouseMove",function(u){var f,g=t.mapsService.getMapContainer(),E=(f=g==null?void 0:g.getBoundingClientRect())!==null&&f!==void 0?f:{},R=E.left,B=R===void 0?0:R,Y=E.top,Q=Y===void 0?0:Y;t.setPopupPosition(u.clientX-B,u.clientY-Q)}),(0,Pe.Z)((0,D.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,f=u.lng,g=u.lat,E=t.mapsService.lngLatToContainer([f,g]),R=E.x,B=E.y;t.setPopupPosition(R,B)}}),(0,Pe.Z)((0,D.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,Pe.Z)((0,D.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,Pe.Z)((0,D.Z)(t),"update",function(){var u=!!t.lngLat,f=t.popupOption,g=f.className,E=f.style,R=f.maxWidth,B=f.anchor,Y=f.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var Q=t.mapsService.getMarkerContainer();if(!t.container&&Q&&(t.container=wo("div","l7-popup ".concat(g!=null?g:""," ").concat(t.isShow?"":"l7-popup-hide"),Q),E&&t.container.setAttribute("style",E),t.tip=wo("div","l7-popup-tip",t.container),t.container.appendChild(t.content),Y&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(Te){t.container.addEventListener(Te,function(Ve){Ve.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),t.updateLngLatPosition(),Ll(t.container,"".concat(eh[B])),kc(t.container,B,"popup"),R){var ce=t.container.getBoundingClientRect(),fe=ce.width;fe>parseFloat(R)&&(t.container.style.width=R)}else t.container.style.removeProperty("width")}}),t.popupOption=(0,Ee.Z)((0,Ee.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,Me.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(cn.IMapService),this.sceneService=t.get(cn.ISceneService),this.layerService=t.get(cn.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,f=o.text,g=o.title;return u?this.setHTML(u):f&&this.setText(f),g&&this.setTitle(g),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&fl(this.content),this.container&&(fl(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,Ee.Z)((0,Ee.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(fl(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&bh(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&pl(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=wo("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Kl(this.contentTitle),Rl(this.contentTitle,t)):this.contentTitle&&(fl(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ss.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),Rl(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&fl(this.content),this.contentTitle=void 0,this.content=wo("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=Xm("l7-icon-guanbi");pl(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){t.hide()}),o.addEventListener("pointerup",function(u){u.stopPropagation()}),o.addEventListener("pointerdown",function(u){u.stopPropagation()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=wo("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(Z.EventEmitter);function SA(e){var a=Hw();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EA=Ga.get,$w=function(e){(0,yt.Z)(r,e);var a=SA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"layerClickCountByFrame",0),(0,Pe.Z)((0,D.Z)(n),"layerConfigMap",new WeakMap),(0,Pe.Z)((0,D.Z)(n),"onLayerClick",function(f,g){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(f,g.featureId))n.hide();else{var E=n.getLayerInfoFrag(f,g),R=E.title,B=E.content;n.setDOMContent(B),n.setLnglat(g.lngLat),n.setTitle(R),n.displayFeatureInfo={layer:f,featureId:g.featureId},n.show()}})}),(0,Pe.Z)((0,D.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,Pe.Z)((0,D.Z)(n),"updateCloseOnClick",function(){}),n}return(0,Me.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,f=o.items;return(t=u!=null?u:f)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return Ou((0,Ze.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Ou((0,Ze.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){var o;this.unbindLayerEvent();var u=(0,Ee.Z)({},t),f=t.trigger||this.popupOption.trigger;return((o=u.items)===null||o===void 0?void 0:o.length)===0&&f==="hover"&&(u.followCursor=!1),Ou((0,Ze.Z)(r.prototype),"setOptions",this).call(this,u),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,Ee.Z)((0,Ee.Z)({},Ou((0,Ze.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption,u=o.trigger,f=o.closeOnClick;this.layerConfigItems.forEach(function(g){var E,R=t.getLayerByConfig(g);if(R){var B=(0,Ee.Z)({},g);if(u==="hover"){var Y=t.onLayerMouseMove.bind(t,R),Q=t.onLayerMouseOut.bind(t,R);B.onMouseMove=Y,B.onMouseOut=Q,R==null||R.on("mousemove",Y),R==null||R.on("mouseout",Q)}else{var ce,fe=t.onLayerClick.bind(t,R);B.onClick=fe,R==null||R.on("click",fe);var Te=(ce=t.mapsService)===null||ce===void 0?void 0:ce.getMapContainer();Te&&f&&Te.addEventListener("click",t.onSceneClick)}var Ve=R==null||(E=R.getSource)===null||E===void 0?void 0:E.call(R),st=t.onSourceUpdate.bind(t);Ve==null||Ve.on("update",st),B.onSourceUpdate=st,t.layerConfigMap.set(R,B)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u,f=t.getLayerByConfig(o),g=f&&t.layerConfigMap.get(f);if(g){var E=g.onMouseMove,R=g.onMouseOut,B=g.onClick,Y=g.onSourceUpdate;if(E&&f.off("mousemove",E),R&&f.off("mouseout",R),B&&f.off("click",B),Y){var Q;f==null||(Q=f.getSource())===null||Q===void 0||Q.off("update",Y)}var ce=(u=t.mapsService)===null||u===void 0?void 0:u.getMapContainer();ce&&ce.removeEventListener("click",t.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o),f=u.title,g=u.content;this.setDOMContent(g),this.setTitle(f),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),f,g=document.createDocumentFragment();if(u){var E=o.feature;E.type==="Feature"&&"properties"in E&&"geometry"in E&&(E=E.properties);var R=u.title,B=u.fields,Y=u.customContent;if(R){f=document.createDocumentFragment();var Q=R instanceof Function?R(E):R;Rl(f,Q)}if(Y){var ce=Y instanceof Function?Y(E):Y;Rl(g,ce)}else B!=null&&B.length&&(B==null||B.forEach(function(fe){var Te,Ve,st=typeof fe=="string"?{field:fe}:fe,at=st.field,Tt=st.formatField,kt=st.formatValue,Yt=st.getValue,cr=wo("div","l7-layer-popup__row"),Mr=Yt?Yt(o.feature):EA(E,at),Dr=(Te=Tt instanceof Function?Tt(at,E):Tt)!==null&&Te!==void 0?Te:at,sn=(Ve=kt instanceof Function?kt(Mr,E):kt)!==null&&Ve!==void 0?Ve:Mr,rn=wo("span","l7-layer-popup__key",cr);Rl(rn,Dr),Rl(rn,document.createTextNode("\uFF1A"));var Jn=wo("span","l7-layer-popup__value",cr);Array.isArray(sn)&&sn.every(function(fi){return!(fi instanceof Object)})&&(sn=sn.map(function(fi){return String(fi)}).join(",")),Rl(Jn,sn),g.appendChild(cr)}))}return{title:f,content:g}}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(Gw);function CA(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}CA(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var ug,Ww=(ug={},(0,Pe.Z)(ug,vh.additive,{enable:!0,func:{srcRGB:Ke.ONE,dstRGB:Ke.ONE,srcAlpha:1,dstAlpha:1}}),(0,Pe.Z)(ug,vh.none,{enable:!1}),(0,Pe.Z)(ug,vh.normal,{enable:!0,func:{srcRGB:Ke.SRC_ALPHA,dstRGB:Ke.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,Pe.Z)(ug,vh.subtractive,{enable:!0,func:{srcRGB:Ke.ONE,dstRGB:Ke.ONE,srcAlpha:Ke.ZERO,dstAlpha:Ke.ONE_MINUS_SRC_COLOR},equation:{rgb:Ke.FUNC_SUBTRACT,alpha:Ke.FUNC_SUBTRACT}}),(0,Pe.Z)(ug,vh.max,{enable:!0,func:{srcRGB:Ke.ONE,dstRGB:Ke.ONE},equation:{rgb:Ke.MAX_EXT}}),(0,Pe.Z)(ug,vh.min,{enable:!0,func:{srcRGB:Ke.ONE,dstRGB:Ke.ONE},equation:{rgb:Ke.MIN_EXT}}),ug),ip=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),ib=Ga.cloneDeep;function Xw(e,a){var r=[a[0]-e[0],a[1]-e[1]],n=wc(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function AA(e,a,r){if(e.length>0&&a.version===ip["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ip["GAODE2.x"],t.originCoordinates=ib(t.coordinates),t.coordinates=a.coordToAMap2RelativeCoordinates(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ip["GAODE2.x"],t.originCoordinates=ib(t.coordinates),t.coordinates=a.coordToAMap2RelativeCoordinates(t.coordinates,n)})}}function ab(e,a){e.length>0&&a.version===ip.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=TA(r.coordinates,a),r.simpleCoordinate=!0)})}function TA(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(a.simpleMapCoord.unproject(t))}),n}}function Yw(e,a){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var f,g=u.field;(a.hasOwnProperty(g)||((f=e.scale)===null||f===void 0?void 0:f.type)==="variable")&&t.push(a[g])});var o=e.mapping?e.mapping(t):[];return o}function GP(e,a,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,f=u===void 0?{enable:!1}:u,g=a.map(function(E){var R={id:E._id,coordinates:E.coordinates};if(e.filter(function(Q){return Q.scale!==void 0}).forEach(function(Q){var ce=Yw(Q,E);Q.needRemapping=!1,Q.name==="color"&&(ce=ce.map(function(fe){return Mo(fe)})),R[Q.name]=Array.isArray(ce)&&ce.length===1?ce[0]:ce,Q.name==="shape"&&(R.shape=r.getIconFontKey(R[Q.name]))}),R.shape==="line"&&f.enable){var B=R.coordinates,Y=Xw(B[0],B[1]);R.coordinates.splice(1,0,Y,Y)}return R});return AA(g,n,t),ab(g,n),g}function qw(e,a,r,n,t,o){var u=new cy(t,o),f=n.getLayerStyleAttributes()||[],g=u.data.dataArray,E=g,R=GP(f,E,a,r,e);return u.destroy(),R}function Kw(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function Jw(e,a,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),Kw(a).forEach(function(f){var g=(0,gi.Z)(f,2),E=g[0],R=g[1];t.add(r(E),R)}),t.add(r("copy")),t}var Qw=function(){function e(a){(0,Be.Z)(this,e),this.layer=a}return(0,Me.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),t=n.get(cn.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(r);o.hooks.beforePickingEncode.call(),t.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(cn.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(cn.IPickingService),f=o.get(cn.IMapService),g=this.layer.getSource().extent,E=nl(n.lngLat,g),R={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},B=t||r;if(E){var Y=this.readRasterValue(r,g,f,n.x,n.y);return R.rasterValue=Y,u.triggerHoverOnLayer(B,R),!0}else return R.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(B,(0,Ee.Z)((0,Ee.Z)({},R),{},{type:"unpick"})),u.triggerHoverOnLayer(B,R),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var f=r.getSource().data.dataArray[0],g=(0,gi.Z)(n,4),E=g[0],R=E===void 0?0:E,B=g[1],Y=B===void 0?0:B,Q=g[2],ce=Q===void 0?10:Q,fe=g[3],Te=fe===void 0?-10:fe,Ve=t.lngLatToContainer([R,Y]),st=t.lngLatToContainer([ce,Te]),at=st.x-Ve.x,Tt=Ve.y-st.y,kt=[(o-Ve.x)/at,(u-st.y)/Tt],Yt=f.width||1,cr=f.height||1,Mr=Math.floor(kt[0]*Yt),Dr=Math.floor(kt[1]*cr),sn=Math.max(0,Dr-1)*Yt+Mr,rn=f.data[sn];return rn}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,gi.Z)(r,3),o=t[0],u=t[1],f=t[2];n.hooks.beforeSelect.call([o,u,f])}},{key:"highlightPickedFeature",value:function(r){var n=(0,gi.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),HP=function(){function e(a){(0,Be.Z)(this,e),this.layer=a;var r=this.layer.getContainer();this.rendererService=r.get(cn.IRendererService)}return(0,Me.Z)(e,[{key:"getColorTexture",value:function(r,n){var t=this.getTextureKey(r,n);return this.key===t?this.colorTexture:(this.createColorTexture(r,n),this.key=t,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var t=this.rendererService.createTexture2D,o=this.getColorRampBar(r,n),u=t({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(r,n,t){this.key=this.getTextureKey(n,t),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return Yu(r);case"quantize":return Vs(r);case"custom":return yh(r,n);case"linear":return rf(r,n);default:return Ja(r)}}},{key:"getTextureKey",value:function(r,n){var t;return"".concat(r.colors.join("_"),"_").concat(r==null||(t=r.positions)===null||t===void 0?void 0:t.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),MA=["passes"],PA=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],kg,A0,dy;function M1(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=eS(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function eS(e,a){if(e){if(typeof e=="string")return tm(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tm(e,a)}}function tm(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function T0(e){var a=M0();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function M0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vy=Ga.isEqual,ob=Ga.isFunction,sb=Ga.isNumber,Pd=Ga.isObject,kA=Ga.isPlainObject,tS=Ga.isUndefined,rS=0,kd=(kg=sy(cn.IGlobalConfigService),A0=function(e){(0,yt.Z)(r,e);var a=T0(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Be.Z)(this,r),n=a.call(this),(0,Pe.Z)((0,D.Z)(n),"id","".concat(rS++)),(0,Pe.Z)((0,D.Z)(n),"name","".concat(rS)),(0,Pe.Z)((0,D.Z)(n),"visible",!0),(0,Pe.Z)((0,D.Z)(n),"zIndex",0),(0,Pe.Z)((0,D.Z)(n),"inited",!1),(0,Pe.Z)((0,D.Z)(n),"layerModelNeedUpdate",!1),(0,Pe.Z)((0,D.Z)(n),"pickedFeatureID",null),(0,Pe.Z)((0,D.Z)(n),"selectedFeatureID",null),(0,Pe.Z)((0,D.Z)(n),"styleNeedUpdate",!1),(0,Pe.Z)((0,D.Z)(n),"forceRender",!1),(0,Pe.Z)((0,D.Z)(n),"clusterZoom",0),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,Pe.Z)((0,D.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,Pe.Z)((0,D.Z)(n),"hooks",{init:new HE,afterInit:new Ux,beforeRender:new Ux,beforeRenderData:new jx,afterRender:new ag,beforePickingEncode:new ag,afterPickingEncode:new ag,beforeHighlight:new ag(["pickedColor"]),afterHighlight:new ag,beforeSelect:new ag(["pickedColor"]),afterSelect:new ag,beforeDestroy:new ag,afterDestroy:new ag}),(0,Pe.Z)((0,D.Z)(n),"models",[]),(0,Pe.Z)((0,D.Z)(n),"startInit",!1),(0,Pe.Z)((0,D.Z)(n),"layerChildren",[]),(0,Pe.Z)((0,D.Z)(n),"masks",[]),yo((0,D.Z)(n),"configService",dy,(0,D.Z)(n)),(0,Pe.Z)((0,D.Z)(n),"animateOptions",{enable:!1}),(0,Pe.Z)((0,D.Z)(n),"currentPickId",null),(0,Pe.Z)((0,D.Z)(n),"encodeStyleAttribute",{}),(0,Pe.Z)((0,D.Z)(n),"enableShaderEncodeStyles",[]),(0,Pe.Z)((0,D.Z)(n),"enableDataEncodeStyles",[]),(0,Pe.Z)((0,D.Z)(n),"enablg",[]),(0,Pe.Z)((0,D.Z)(n),"pendingStyleAttributes",[]),(0,Pe.Z)((0,D.Z)(n),"scaleOptions",{}),(0,Pe.Z)((0,D.Z)(n),"animateStatus",!1),(0,Pe.Z)((0,D.Z)(n),"isDestroyed",!1),(0,Pe.Z)((0,D.Z)(n),"encodeDataLength",0),(0,Pe.Z)((0,D.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,Me.Z)(r,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(f){f in o.rawConfig&&(o.rawConfig[f]=t[f])}),!this.startInit)this.needUpdateConfig=(0,Ee.Z)((0,Ee.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(cn.SceneID);this.configService.setLayerConfig(u,this.id,(0,Ee.Z)((0,Ee.Z)((0,Ee.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:f=this.container.get(cn.SceneID),this.startInit=!0,this.configService.setLayerConfig(f,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(cn.IIconService),this.fontService=this.container.get(cn.IFontService),this.rendererService=this.container.get(cn.IRendererService),this.layerService=this.container.get(cn.ILayerService),this.debugService=this.container.get(cn.IDebugService),this.interactionService=this.container.get(cn.IInteractionService),this.pickingService=this.container.get(cn.IPickingService),this.mapService=this.container.get(cn.IMapService),g=this.getLayerConfig(),E=g.enableMultiPassRenderer,R=g.passes,E&&R!==null&&R!==void 0&&R.length&&R.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(cn.ICameraService),this.coordinateService=this.container.get(cn.ICoordinateSystemService),this.shaderModuleService=this.container.get(cn.IShaderModuleService),this.postProcessingPassFactory=this.container.get(cn.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(cn.IFactoryNormalPass),this.styleAttributeService=this.container.get(cn.IStyleAttributeService),E&&(this.multiPassRenderer=this.container.get(cn.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(Te){var Ve=Te.attributeName,st=Te.attributeField,at=Te.attributeValues,Tt=Te.updateOptions;u.styleAttributeService.updateStyleAttribute(Ve,{scale:(0,Ee.Z)({field:st},u.splitValuesAndCallbackInAttribute(at,st?void 0:u.getLayerConfig()[Ve]))},Tt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(cn.ILayerPlugin),B=M1(this.plugins);try{for(B.s();!(Y=B.n()).done;)Q=Y.value,Q.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(Te){B.e(Te)}finally{B.f()}return this.layerPickService=new Qw(this),this.textureService=new HP(this),this.log(Qh.LayerInitStart),fe.next=31,this.hooks.init.promise();case 31:this.log(Qh.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"log",value:function(t){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var f="".concat(this.id,".").concat(u,".").concat(t),g={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(f,g)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var f=this.calculateEncodeData(t,o),g=this.triangulation;return f&&g?this.styleAttributeService.createAttributesAndIndices(f,g):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?qw(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){var f=this.updateStyleAttribute("filter",t,o,u);return this.dataState.dataSourceNeedUpdate=f&&this.inited,this}},{key:"shape",value:function(t,o,u){this.shapeOption={field:t,values:o};var f=this.updateStyleAttribute("shape",t,o,u);return this.dataState.dataSourceNeedUpdate=f&&this.inited,this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return Pd(t)?(o.enable=!0,o=(0,Ee.Z)((0,Ee.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?(this.log(Qh.SourceInitStart,zs.UPDATE),this.layerSource.setData(t,o),this.log(Qh.SourceInitEnd,zs.UPDATE)):this.on("inited",function(){u.log(Qh.SourceInitStart,zs.UPDATE);var f=u.getSource();f?u.layerSource.setData(t,o):u.source(new cy(t,o)),u.layerSource.once("update",function(){u.log(Qh.SourceInitEnd,zs.UPDATE)})}),this}},{key:"style",value:function(t){var o=this,u=t.passes,f=(0,Uh.Z)(t,MA);u&&Kw(u).forEach(function(E){var R=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(E[0]);R&&R.updateOptions(E[1])});var g=f;return Object.keys(f).forEach(function(E){var R=f[E];Array.isArray(R)&&R.length===2&&!sb(R[0])&&!sb(R[1])&&(g[E]={field:R[0],value:R[1]})}),this.encodeStyle(g),this.updateLayerConfig(g),this}},{key:"encodeStyle",value:function(t){var o=this;Object.keys(t).forEach(function(u){[].concat((0,Vn.Z)(o.enableShaderEncodeStyles),(0,Vn.Z)(o.enableDataEncodeStyles)).includes(u)&&kA(t[u])&&(t[u].field||t[u].value)&&!vy(o.encodeStyleAttribute[u],t[u])?(o.encodeStyleAttribute[u]=t[u],o.updateStyleAttribute(u,t[u].field,t[u].value),o.inited&&(o.dataState.dataMappingNeedUpdate=!0)):o.encodeStyleAttribute[u]&&(delete o.encodeStyleAttribute[u],o.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(t,o){var u=(0,Ee.Z)({},this.scaleOptions);if(Pd(t)?this.scaleOptions=(0,Ee.Z)((0,Ee.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this.styleAttributeService&&!vy(u,this.scaleOptions)){var f=Pd(t)?t:(0,Pe.Z)({},t,o);this.styleAttributeService.updateScaleAttribute(f)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}},{key:"renderMultiPass",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){f.next=2;break}return f.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){f.next=7;break}return f.next=5,this.multiPassRenderer.render();case 5:f.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=Pd(t)?!0:t,Pd(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if(Pd(t)){var f=t.x,g=f===void 0?0:f,E=t.y,R=E===void 0?0:E;this.updateLayerConfig({highlightColor:Pd(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Pd(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:R})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:Pd(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Pd(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(uu(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=Pd(t)?!0:t,Pd(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if(Pd(t)){var f=t.x,g=f===void 0?0:f,E=t.y,R=E===void 0?0:E;this.updateLayerConfig({selectColor:Pd(o)?o.color:this.getLayerConfig().selectColor,selectMix:Pd(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:R})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:Pd(o)?o.color:this.getLayerConfig().selectColor,selectMix:Pd(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(uu(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,f=o.minZoom,g=f===void 0?-1/0:f,E=o.maxZoom,R=E===void 0?1/0:E;return!!u&&t>=g&&t<R}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),f=u.passes,g=f===void 0?[]:f;this.multiPassRenderer=Jw(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var E=this.rendererService.getViewportSize(),R=E.width,B=E.height;this.multiPassRenderer.resize(R,B)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,f=u.some(function(g){return Math.abs(g)===1/0});return f?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,f,g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(B){return B.destroy(!1)}),this.layerChildren=[];var E=this.getLayerConfig(),R=E.maskfence;R&&(this.masks.map(function(B){return B.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(g),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(f){var g=f.type;if(o.coordCenter===void 0){var E,R=o.layerSource.center;o.coordCenter=R,(E=o.mapService)!==null&&E!==void 0&&E.setCoordCenter&&o.mapService.setCoordCenter(R)}if(g==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,f,g=this.styleAttributeService.getLayerStyleAttribute(t),E=(g==null||(o=g.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=E[0].option)===null||u===void 0?void 0:u.type,field:g==null||(f=g.scale)===null||f===void 0?void 0:f.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(E){return(0,Pe.Z)({value:o.invertExtent(E)},t,E)});return u}else if(o.ticks){var f=o.ticks().map(function(E){return(0,Pe.Z)({value:E},t,o(E))});return f}else if(o!=null&&o.domain){var g=o.domain().filter(function(E){return!tS(E)}).map(function(E){return(0,Pe.Z)({value:E},t,o(E))});return g}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f=this,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at;return x().wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return g=u.moduleName,E=u.vertexShader,R=u.fragmentShader,B=u.inject,Y=u.triangulation,Q=u.segmentNumber,ce=(0,Uh.Z)(u,PA),this.shaderModuleService.registerModule(g,{vs:E,fs:R,inject:B}),fe=this.shaderModuleService.getModule(g),Te=fe.vs,Ve=fe.fs,st=fe.uniforms,at=this.rendererService.createModel,kt.abrupt("return",new Promise(function(Yt){var cr=f.styleAttributeService.createAttributesAndIndices(f.encodedData,Y,Q),Mr=cr.attributes,Dr=cr.elements,sn=cr.count,rn=(0,Ee.Z)({attributes:Mr,uniforms:st,fs:Ve,vs:Te,elements:Dr,blend:Ww[vh.normal]},ce);sn&&(rn.count=sn);var Jn=at(rn);Yt(Jn)}));case 5:case"end":return kt.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),f=u.attributes;return f}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,f=u===void 0?!0:u,g=o.enableSelect,E=g===void 0?!0:g,R=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&E&&(R=!0),t==="mousemove"&&(f||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(R=!0),this.isVisible()&&R}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return f.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.buildModels();case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,mr.Z)(x().mark(function o(u){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,u.render();case 2:case"end":return g.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,f){var g=this.configService.getAttributeConfig(this.id)||{};return vy(g[t],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,Pe.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,Ee.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},f):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:f}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.models.forEach(function(g){return g.destroy()}),this.models=[],f.next=4,this.layerModel.initModels();case 4:this.models=f.sent;case 5:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t){return{values:ob(t)?void 0:t,callback:ob(t)?t:void 0}}}]),r}(Z.EventEmitter),dy=ro(A0.prototype,"configService",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0);function nS(e,a){return{enable:e,mask:255,func:{cmp:Ke.EQUAL,ref:a?1:0,mask:1}}}function ub(e){return e.maskOperation===Us.OR?{enable:!0,mask:255,func:{cmp:Ke.ALWAYS,ref:1,mask:255},opFront:{fail:Ke.KEEP,zfail:Ke.REPLACE,zpass:Ke.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===nc.SINGLE||e.stencilIndex===0?Ke.ALWAYS:Ke.LESS,ref:e.stencilType===nc.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:Ke.KEEP,zfail:Ke.REPLACE,zpass:Ke.REPLACE}}}function iS(e){switch(e){case"rotation":return{name:"Rotation",type:Ni.Attribute,descriptor:{name:"a_Rotation",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(r){var n=r.rotation,t=n===void 0?0:n;return Array.isArray(t)?[t[0]]:[t]}}};case"stroke":return{name:"stroke",type:Ni.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(r){var n=r.stroke,t=n===void 0?[1,1,1,1]:n;return t}}};case"opacity":return{name:"opacity",type:Ni.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(r){var n=r.opacity,t=n===void 0?1:n;return[t]}}};case"extrusionBase":return{name:"extrusionBase",type:Ni.Attribute,descriptor:{name:"a_ExtrusionBase",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(r){var n=r.extrusionBase,t=n===void 0?0:n;return[t]}}};case"offsets":return{name:"offsets",type:Ni.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};default:return}}var lb,P1,cb,Lu=(lb=sy(cn.IGlobalConfigService),P1=function(){function e(a){(0,Be.Z)(this,e),(0,Pe.Z)(this,"preStyleAttribute",{}),(0,Pe.Z)(this,"encodeStyleAttribute",{}),yo(this,"configService",cb,this),this.layer=a,this.rendererService=a.getContainer().get(cn.IRendererService),this.pickingService=a.getContainer().get(cn.IPickingService),this.shaderModuleService=a.getContainer().get(cn.IShaderModuleService),this.styleAttributeService=a.getContainer().get(cn.IStyleAttributeService),this.mapService=a.getContainer().get(cn.IMapService),this.iconService=a.getContainer().get(cn.IIconService),this.fontService=a.getContainer().get(cn.IFontService),this.cameraService=a.getContainer().get(cn.ICameraService),this.layerService=a.getContainer().get(cn.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,Me.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return Ww[vh[t]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),t=n.mask,o=t===void 0?!1:t,u=n.maskInside,f=u===void 0?!0:u,g=n.enableMask,E=n.maskOperation,R=E===void 0?Us.AND:E;if(this.layer.type==="MaskLayer")return ub({isStencil:!0,stencilType:nc.SINGLE});if(r.isStencil)return ub((0,Ee.Z)((0,Ee.Z)({},r),{},{maskOperation:R}));var B=o||g&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return nS(B,f)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var a=(0,mr.Z)(x().mark(function n(){return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return a.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var a=(0,mr.Z)(x().mark(function n(){return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return a.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var a=(0,mr.Z)(x().mark(function n(){return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return a.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",t={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float"};this.layer.enableShaderEncodeStyles.forEach(function(u){r[u]&&(n+="#define USE_ATTRIBUTE_".concat(u.toUpperCase(),` 0.0; 

`)),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
      attribute `).concat(t[u]," a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
    #else
      uniform `).concat(t[u]," u_").concat(u,`;
    #endif

    `)});var o="";return this.layer.enableShaderEncodeStyles.forEach(function(u){o+=`

#ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
  `).concat(t[u]," ").concat(u,"  = a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
#else
  `).concat(t[u]," ").concat(u," = u_").concat(u,`;
#endif

`)}),{"vs:#decl":n,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var r=this,n={},t={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0};return this.layer.enableShaderEncodeStyles.forEach(function(o){if(!r.layer.encodeStyleAttribute[o]){var u=r.layer.getLayerConfig()[o],f=typeof u=="undefined"?t[o]:u;o==="stroke"&&(f=Mo(f)),n["u_"+o]=f}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var t=iS(n);t&&r.styleAttributeService.registerStyleAttribute(t)})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}}]),e}(),cb=ro(P1.prototype,"configService",[lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P1),IA=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),gy=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),hb=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),k1=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),P0=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function LA(e){var a=aS();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RA=function(e){(0,yt.Z)(r,e);var a=LA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateMode",P0.ALWAYS),(0,Pe.Z)((0,D.Z)(n),"renderUpdate",function(){var f=n.layer.getLayerConfig(),g=f.zIndex,E=g===void 0?10:g,R=f.update,B=R===void 0?P0.ALWAYS:R,Y=f.animateOption,Q=Y===void 0?{enable:!1,duration:20}:Y;+n.canvas.style.zIndex===E&&(n.canvas.style.zIndex=E+""),n.updateMode!==B&&(n.updateMode=B,n.unBindListener(),n.bindListener()),n.updateMode===P0.ALWAYS&&Q.enable&&n.renderCanvas()}),(0,Pe.Z)((0,D.Z)(n),"unBindListener",function(){n.mapService.off("mapchange",n.renderCanvas),n.mapService.off("zoomstart",n.clearCanvas),n.mapService.off("zoomend",n.renderCanvas),n.mapService.off("movestart",n.clearCanvas),n.mapService.off("moveend",n.renderCanvas)}),(0,Pe.Z)((0,D.Z)(n),"bindListener",function(){n.updateMode===P0.ALWAYS?n.mapService.on("mapchange",n.renderCanvas):(n.mapService.on("zoomstart",n.clearCanvas),n.mapService.on("zoomend",n.renderCanvas),n.mapService.on("movestart",n.clearCanvas),n.mapService.on("moveend",n.renderCanvas))}),(0,Pe.Z)((0,D.Z)(n),"clearCanvas",function(){if(n.ctx){var f=n.rendererService.getViewportSize(),g=f.width,E=f.height;n.ctx.clearRect(0,0,g,E)}}),(0,Pe.Z)((0,D.Z)(n),"renderCanvas",function(){var f=n.rendererService.getViewportSize(),g=f.width,E=f.height;if(n.prevSize[0]!==g||n.prevSize[1]!==E){n.prevSize=[g,E];var R=n.mapService.getSize(),B=(0,gi.Z)(R,2),Y=B[0],Q=B[1];n.canvas.width=g,n.canvas.height=E,n.canvas.style.width=Y+"px",n.canvas.style.height=Q+"px"}var ce=n.layer.getLayerConfig(),fe=ce.drawingOnCanvas;n.ctx&&fe({canvas:n.canvas,ctx:n.ctx,mapService:n.mapService,size:[g,E]})}),n}return(0,Me.Z)(r,[{key:"clearModels",value:function(){if(this.canvas){var t;(t=this.mapService.getContainer())===null||t===void 0||t.removeChild(this.canvas),this.canvas=null}this.unBindListener()}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),f=u.update,g=f===void 0?P0.ALWAYS:f,this.updateMode=g,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),R.abrupt("return",[]);case 7:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCanvas",value:function(){var t,o=this.layer.getLayerConfig(),u=o.zIndex,f=this.mapService.getSize(),g=(0,gi.Z)(f,2),E=g[0],R=g[1],B=this.rendererService.getViewportSize(),Y=B.width,Q=B.height;this.prevSize=[Y,Q];var ce=document.createElement("canvas");this.canvas=ce,ce.width=Y,ce.height=Q,ce.style.pointerEvents="none",ce.style.width=E+"px",ce.style.height=R+"px",ce.style.position="absolute",ce.style.top="0",ce.style.left="0",ce.style.zIndex=u+"",(t=this.mapService.getContainer())===null||t===void 0||t.appendChild(ce);var fe=ce.getContext("2d");this.ctx=fe}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){}}]),r}(Lu),oS={canvas:RA},DA=oS;function OA(e){var a=FA();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sS=function(e){(0,yt.Z)(r,e);var a=OA(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","CanvasLayer"),(0,Pe.Z)((0,D.Z)(n),"forceRender",!0),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new DA[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var t,o=this;return this!==null&&this!==void 0&&(t=this.layerModel)!==null&&t!==void 0&&t.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},!1)}),this}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={canvas:{}};return o[t]}},{key:"getModelType",value:function(){return"canvas"}}]),r}(kd);function lg(){var e=new Ml(3);return Ml!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function fb(e){var a=new Ml(3);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a}function I1(e){var a=e[0],r=e[1],n=e[2];return Math.hypot(a,r,n)}function Fu(e,a,r){var n=new Ml(3);return n[0]=e,n[1]=a,n[2]=r,n}function pb(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function zA(e,a,r,n){return e[0]=a,e[1]=r,e[2]=n,e}function db(e,a,r){return e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function uS(e,a,r){return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],e}function vb(e,a,r){return e[0]=a[0]*r[0],e[1]=a[1]*r[1],e[2]=a[2]*r[2],e}function lS(e,a,r){return e[0]=a[0]/r[0],e[1]=a[1]/r[1],e[2]=a[2]/r[2],e}function BA(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e}function NA(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e}function $P(e,a,r){return e[0]=Math.min(a[0],r[0]),e[1]=Math.min(a[1],r[1]),e[2]=Math.min(a[2],r[2]),e}function cS(e,a,r){return e[0]=Math.max(a[0],r[0]),e[1]=Math.max(a[1],r[1]),e[2]=Math.max(a[2],r[2]),e}function ZA(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e}function mb(e,a,r){return e[0]=a[0]*r,e[1]=a[1]*r,e[2]=a[2]*r,e}function UA(e,a,r,n){return e[0]=a[0]+r[0]*n,e[1]=a[1]+r[1]*n,e[2]=a[2]+r[2]*n,e}function hS(e,a){var r=a[0]-e[0],n=a[1]-e[1],t=a[2]-e[2];return Math.hypot(r,n,t)}function fS(e,a){var r=a[0]-e[0],n=a[1]-e[1],t=a[2]-e[2];return r*r+n*n+t*t}function pS(e){var a=e[0],r=e[1],n=e[2];return a*a+r*r+n*n}function dS(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e}function jA(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e}function Ig(e,a){var r=a[0],n=a[1],t=a[2],o=r*r+n*n+t*t;return o>0&&(o=1/Math.sqrt(o)),e[0]=a[0]*o,e[1]=a[1]*o,e[2]=a[2]*o,e}function gb(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]}function yy(e,a,r){var n=a[0],t=a[1],o=a[2],u=r[0],f=r[1],g=r[2];return e[0]=t*g-o*f,e[1]=o*u-n*g,e[2]=n*f-t*u,e}function VA(e,a,r,n){var t=a[0],o=a[1],u=a[2];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e}function GA(e,a,r,n,t,o){var u=o*o,f=u*(2*o-3)+1,g=u*(o-2)+o,E=u*(o-1),R=u*(3-2*o);return e[0]=a[0]*f+r[0]*g+n[0]*E+t[0]*R,e[1]=a[1]*f+r[1]*g+n[1]*E+t[1]*R,e[2]=a[2]*f+r[2]*g+n[2]*E+t[2]*R,e}function HA(e,a,r,n,t,o){var u=1-o,f=u*u,g=o*o,E=f*u,R=3*o*f,B=3*g*u,Y=g*o;return e[0]=a[0]*E+r[0]*R+n[0]*B+t[0]*Y,e[1]=a[1]*E+r[1]*R+n[1]*B+t[1]*Y,e[2]=a[2]*E+r[2]*R+n[2]*B+t[2]*Y,e}function $A(e,a){a=a||1;var r=qp()*2*Math.PI,n=qp()*2-1,t=Math.sqrt(1-n*n)*a;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e[2]=n*a,e}function Lg(e,a,r){var n=a[0],t=a[1],o=a[2],u=r[3]*n+r[7]*t+r[11]*o+r[15];return u=u||1,e[0]=(r[0]*n+r[4]*t+r[8]*o+r[12])/u,e[1]=(r[1]*n+r[5]*t+r[9]*o+r[13])/u,e[2]=(r[2]*n+r[6]*t+r[10]*o+r[14])/u,e}function _y(e,a,r){var n=a[0],t=a[1],o=a[2];return e[0]=n*r[0]+t*r[3]+o*r[6],e[1]=n*r[1]+t*r[4]+o*r[7],e[2]=n*r[2]+t*r[5]+o*r[8],e}function yb(e,a,r){var n=r[0],t=r[1],o=r[2],u=r[3],f=a[0],g=a[1],E=a[2],R=t*E-o*g,B=o*f-n*E,Y=n*g-t*f,Q=t*Y-o*B,ce=o*R-n*Y,fe=n*B-t*R,Te=u*2;return R*=Te,B*=Te,Y*=Te,Q*=2,ce*=2,fe*=2,e[0]=f+R+Q,e[1]=g+B+ce,e[2]=E+Y+fe,e}function by(e,a,r,n){var t=[],o=[];return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],o[0]=t[0],o[1]=t[1]*Math.cos(n)-t[2]*Math.sin(n),o[2]=t[1]*Math.sin(n)+t[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function xy(e,a,r,n){var t=[],o=[];return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],o[0]=t[2]*Math.sin(n)+t[0]*Math.cos(n),o[1]=t[1],o[2]=t[2]*Math.cos(n)-t[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function vS(e,a,r,n){var t=[],o=[];return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],o[0]=t[0]*Math.cos(n)-t[1]*Math.sin(n),o[1]=t[0]*Math.sin(n)+t[1]*Math.cos(n),o[2]=t[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function L1(e,a){var r=e[0],n=e[1],t=e[2],o=a[0],u=a[1],f=a[2],g=Math.sqrt(r*r+n*n+t*t),E=Math.sqrt(o*o+u*u+f*f),R=g*E,B=R&&gb(e,a)/R;return Math.acos(Math.min(Math.max(B,-1),1))}function mS(e){return e[0]=0,e[1]=0,e[2]=0,e}function gS(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function k0(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]}function Rg(e,a){var r=e[0],n=e[1],t=e[2],o=a[0],u=a[1],f=a[2];return Math.abs(r-o)<=Ku*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-u)<=Ku*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(t-f)<=Ku*Math.max(1,Math.abs(t),Math.abs(f))}var _b=uS,WA=vb,XA=lS,YA=hS,qA=fS,KA=I1,JA=pS,QA=function(){var e=lg();return function(a,r,n,t,o,u){var f,g;for(r||(r=3),n||(n=0),t?g=Math.min(t*r+n,a.length):g=a.length,f=n;f<g;f+=r)e[0]=a[f],e[1]=a[f+1],e[2]=a[f+2],o(e,e,u),a[f]=e[0],a[f+1]=e[1],a[f+2]=e[2];return a}}(),wy=100,bb=36,eT=40;function yS(e){return e/180*Math.acos(-1)}function xb(e){var a=yS(e[0])+Math.PI/2,r=yS(e[1]),n=wy+Math.random()*.4,t=n*Math.cos(r)*Math.cos(a),o=n*Math.cos(r)*Math.sin(a),u=n*Math.sin(r);return[o,u,t]}function wb(e,a){var r=Kn(),n=Kn(),t=Fu(0,1,0),o=Fu(0,0,0);a=a||{},e=typeof e!="undefined"?e:1;for(var u=typeof a.segments!="undefined"?a.segments:32,f=2+u,g=2*f,E=[],R=[],B=[],Y=[],Q=[],ce=[],fe=0;fe<=f;fe++){for(var Te=fe/f,Ve=Te*Math.PI,st=0;st<=g;st++){var at=st/g,Tt=at*Math.PI*2;$o(n),Ba(n,n,-Ve),$o(r),hs(r,r,Tt),Lg(o,t,n),Lg(o,o,r),mb(o,o,-e),B.push(o.slice()),Y.push.apply(Y,(0,Vn.Z)(o.slice())),Ig(o,o),Q.push.apply(Q,(0,Vn.Z)(o.slice())),ce.push([at,1-Te]),Y.push(at,1-Te)}if(fe>0)for(var kt=B.length,Yt=kt-2*(g+1);Yt+g+2<kt;Yt++)E.push([Yt,Yt+1,Yt+g+1]),R.push(Yt,Yt+1,Yt+g+1),E.push([Yt+g+1,Yt+1,Yt+g+2]),R.push(Yt+g+1,Yt+1,Yt+g+2)}return{cells:E,positions:B,uvs:ce,positionsArr:Y,indicesArr:R,normalArr:Q}}var R1=_s(),_S=_s(),jp=_s(),Dg=_s(),I0=_s();function Sy(e,a,r,n,t){Tc(e,r,n),Kh(e,e),a=Ac(-e[1],e[0]);var o=Ac(-r[1],r[0]);return[t/qc(a,o),a]}function Og(e,a){return Lp(e,-a[1],a[0])}function L0(e,a,r){return Qd(e,a,r),Kh(e,e),e}function D1(e,a){return e[0]===a[0]&&e[1]===a[1]}function tT(e){for(var a=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(r,1),r++):a.set(n,n)}return e}var bS=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Be.Z)(this,e),(0,Pe.Z)(this,"lastFlip",-1),(0,Pe.Z)(this,"miter",Ac(0,0)),(0,Pe.Z)(this,"started",!1),(0,Pe.Z)(this,"dash",!1),(0,Pe.Z)(this,"totalDistance",0),(0,Pe.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Me.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var f=r[u-1],g=r[u],E=u<r.length-1?r[u+1]:null,R=this.simpleSegment(n,o,f,g,E);o+=R}if(this.dash)for(var B=0;B<n.positions.length/6;B++)n.positions[B*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,f=1;f<o;f++){var g,E,R,B=r[f-1];B.push((g=n[f-1][2])!==null&&g!==void 0?g:0);var Y=n[f-1],Q=r[f];Q.push((E=n[f][2])!==null&&E!==void 0?E:0);var ce=n[f],fe=f<r.length-1?[].concat((0,Vn.Z)(r[f+1]),[(R=n[f+1][2])!==null&&R!==void 0?R:0]):null,Te=f<n.length-1?n[f+1]:null,Ve=this.simpleSegment(t,u,B,Q,fe,Y,ce,Te);u+=Ve}if(this.dash)for(var st=0;st<t.positions.length/6;st++)t.positions[st*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,f=1;f<o;f++){var g,E,R,B=r[f-1];B.push((g=n[f-1][2])!==null&&g!==void 0?g:0);var Y=n[f-1],Q=r[f];Q.push((E=n[f][2])!==null&&E!==void 0?E:0);var ce=n[f],fe=f<r.length-1?[].concat((0,Vn.Z)(r[f+1]),[(R=n[f+1][2])!==null&&R!==void 0?R:0]):null,Te=f<n.length-1?n[f+1]:null,Ve=this.segment_gaode2(t,u,B,Q,fe,Y,ce,Te);u+=Ve}if(this.dash)for(var st=0;st<t.positions.length/6;st++)t.positions[st*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var f=r[u-1],g=r[u],E=u<r.length-1?r[u+1]:null,R=this.segment(n,o,f,g,E);o+=R}if(this.dash)for(var B=0;B<n.positions.length/6;B++)n.positions[B*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var f=0,g=r.indices,E=r.positions,R=r.normals,B=Gn([o[0],o[1]]),Y=Gn([t[0],t[1]]);L0(jp,B,Y);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(B,Y),this.totalDistance+=Q),this.normal||(this.normal=_s(),Og(this.normal,jp)),this.started||(this.started=!0,this.extrusions(E,R,t,this.normal,this.thickness,this.totalDistance-Q)),g.push(n+0,n+1,n+2),!u)Og(this.normal,jp),this.extrusions(E,R,o,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),f+=2;else{var ce=Gn([u[0],u[1]]);D1(B,ce)&&Tc(ce,B,Kh(ce,Of(ce,B,Y))),L0(Dg,ce,B);var fe=Sy(I0,_s(),jp,Dg,this.thickness),Te=(0,gi.Z)(fe,2),Ve=Te[0],st=Te[1],at=qc(I0,this.normal)<0?-1:1;this.extrusions(E,R,o,st,Ve,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),at=-1,Sh(this.normal,st),f+=2,this.lastFlip=at}return f}},{key:"segment_gaode2",value:function(r,n,t,o,u,f,g,E){var R=0,B=r.indices,Y=r.positions,Q=r.normals,ce=this.cap==="square",fe=this.join==="bevel",Te=Gn([g[0],g[1]]),Ve=Gn([f[0],f[1]]);L0(jp,o,t);var st=0;if(this.dash&&(st=this.lineSegmentDistance(Te,Ve),this.totalDistance+=st),this.normal||(this.normal=_s(),Og(this.normal,jp)),!this.started)if(this.started=!0,ce){var at=_s(),Tt=_s();Tc(at,this.normal,jp),Tc(Tt,this.normal,jp),Q.push(Tt[0],Tt[1],0),Q.push(at[0],at[1],0),Y.push(t[0],t[1],t[2]|0,this.totalDistance-st,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(t[0],t[1],t[2]|0,this.totalDistance-st,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Y,Q,t,this.normal,this.thickness,this.totalDistance-st);if(B.push(n+0,n+1,n+2),u){D1(o,u)&&Tc(u,o,Kh(u,Of(u,o,t))),L0(Dg,u,o);var cr=Sy(I0,_s(),jp,Dg,this.thickness),Mr=(0,gi.Z)(cr,2),Dr=Mr[0],sn=Mr[1],rn=qc(I0,this.normal)<0?-1:1,Jn=fe;if(!Jn&&this.join==="miter"){var fi=Dr;fi>this.miterLimit&&(Jn=!0)}Jn?(Q.push(this.normal[0],this.normal[1],0),Q.push(sn[0],sn[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,B.push.apply(B,(0,Vn.Z)(this.lastFlip!==-rn?[n,n+2,n+3]:[n+2,n+1,n+3])),B.push(n+2,n+3,n+4),Og(R1,Dg),Sh(this.normal,R1),Q.push(this.normal[0],this.normal[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*rn,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,R+=3):(this.extrusions(Y,Q,o,sn,Dr,this.totalDistance),B.push.apply(B,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),rn=-1,Sh(this.normal,sn),R+=2),this.lastFlip=rn}else{if(Og(this.normal,jp),ce){var kt=_s(),Yt=_s();Qd(Yt,jp,this.normal),Tc(kt,jp,this.normal),Q.push(Yt[0],Yt[1],0),Q.push(kt[0],kt[1],0),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),Y.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Y,Q,o,this.normal,this.thickness,this.totalDistance);B.push.apply(B,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),R+=2}return R}},{key:"segment",value:function(r,n,t,o,u){var f=0,g=r.indices,E=r.positions,R=r.normals,B=this.cap==="square",Y=this.join==="bevel",Q=Gn([o[0],o[1]]),ce=Gn([t[0],t[1]]);L0(jp,Q,ce);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(Q,ce),this.totalDistance+=fe),this.normal||(this.normal=_s(),Og(this.normal,jp)),!this.started)if(this.started=!0,B){var Te=_s(),Ve=_s();Tc(Te,this.normal,jp),Tc(Ve,this.normal,jp),R.push(Ve[0],Ve[1],0),R.push(Te[0],Te[1],0),E.push(t[0],t[1],t[2]|0,this.totalDistance-fe,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),E.push(t[0],t[1],t[2]|0,this.totalDistance-fe,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,R,t,this.normal,this.thickness,this.totalDistance-fe);if(g.push(n+0,n+1,n+2),u){var Tt=Gn([u[0],u[1]]);D1(Q,Tt)&&Tc(Tt,Q,Kh(Tt,Of(Tt,Q,ce))),L0(Dg,Tt,Q);var kt=Sy(I0,_s(),jp,Dg,this.thickness),Yt=(0,gi.Z)(kt,2),cr=Yt[0],Mr=Yt[1],Dr=qc(I0,this.normal)<0?-1:1,sn=Y;if(!sn&&this.join==="miter"){var rn=cr;rn>this.miterLimit&&(sn=!0)}sn?(R.push(this.normal[0],this.normal[1],0),R.push(Mr[0],Mr[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Vn.Z)(this.lastFlip!==-Dr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),Og(R1,Dg),Sh(this.normal,R1),R.push(this.normal[0],this.normal[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f+=3):(this.extrusions(E,R,o,Mr,cr,this.totalDistance),g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Dr=-1,Sh(this.normal,Mr),f+=2),this.lastFlip=Dr}else{if(Og(this.normal,jp),B){var st=_s(),at=_s();Qd(at,jp,this.normal),Tc(st,jp,this.normal),R.push(at[0],at[1],0),R.push(st[0],st[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,R,o,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Vn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),f+=2}return f}},{key:"extrusions",value:function(r,n,t,o,u,f){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,f,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,f,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function xS(e){var a=e[0][0],r=e[0][e[0].length-1];a[0]===r[0]&&a[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Oh().flatten(e),o=t.vertices,u=t.dimensions,f=[],g=[],E=0;E<o.length/u;E++)u===2?f.push(o[E*2],o[E*2+1],1):f.push(o[E*3],o[E*3+1],1);var R=Oh()(t.vertices,t.holes,t.dimensions);g.push.apply(g,(0,Vn.Z)(R));for(var B=function(){var ce=t.vertices.slice(Y*u,(Y+1)*u),fe=t.vertices.slice((Y+1)*u,(Y+2)*u);fe.length===0&&(fe=t.vertices.slice(0,u));var Te=f.length/3;f.push(ce[0],ce[1],1,fe[0],fe[1],1,ce[0],ce[1],0,fe[0],fe[1],0),g.push.apply(g,(0,Vn.Z)([0,2,1,2,3,1].map(function(Ve){return Ve+Te})))},Y=0;Y<n;Y++)B();return{positions:f,index:g}}function rT(e){var a=Oh().flatten(e),r=Oh()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:r}}function Sb(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Oh().flatten(e),u=o.vertices,f=o.dimensions,g=[],E=[],R=[],B=0;B<u.length/f;B++)g.push(u[B*f],u[B*f+1],1,-1,-1),R.push(0,0,1);var Y=Oh()(o.vertices,o.holes,o.dimensions);E.push.apply(E,(0,Vn.Z)(Y));for(var Q=function(){var Te=o.vertices.slice(ce*f,(ce+1)*f),Ve=o.vertices.slice((ce+1)*f,(ce+2)*f);Ve.length===0&&(Ve=o.vertices.slice(0,f));var st=g.length/5;g.push(Te[0],Te[1],1,0,0,Ve[0],Ve[1],1,.1,0,Te[0],Te[1],0,0,.8,Ve[0],Ve[1],0,.1,.8);var at=nT([Ve[0],Ve[1],1],[Te[0],Te[1],0],[Te[0],Te[1],1],a);R.push.apply(R,(0,Vn.Z)(at).concat((0,Vn.Z)(at),(0,Vn.Z)(at),(0,Vn.Z)(at))),E.push.apply(E,(0,Vn.Z)([1,2,0,3,2,1].map(function(Tt){return Tt+st})))},ce=0;ce<t;ce++)Q();return{positions:g,index:E,normals:R}}function nT(e,a,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=lg(),o=lg(),u=lg();n&&(e=$h(e),a=$h(a),r=$h(r));var f=Fu.apply(M,(0,Vn.Z)(e)),g=Fu.apply(M,(0,Vn.Z)(a)),E=Fu.apply(M,(0,Vn.Z)(r));_b(t,E,g),_b(o,f,g),yy(u,t,o);var R=lg();return Ig(R,u),R}var Bv,Ey=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),R0=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Cy(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+a*Math.PI/12);var o=n.map(function(u){var f=Math.sin(u+Math.PI/4),g=Math.cos(u+Math.PI/4);return[f,g,0]});return o}function wS(){return Cy(30)}function SS(){return Cy(4)}function ES(){return Cy(3)}function CS(){return Cy(6,1)}function Eb(){return Cy(5)}var Fg=(Bv={},(0,Pe.Z)(Bv,R0.CIRCLE,wS),(0,Pe.Z)(Bv,R0.HEXAGON,CS),(0,Pe.Z)(Bv,R0.TRIANGLE,ES),(0,Pe.Z)(Bv,R0.SQUARE,SS),(0,Pe.Z)(Bv,R0.PENTAGON,Eb),(0,Pe.Z)(Bv,Ey.CYLINDER,wS),(0,Pe.Z)(Bv,Ey.HEXAGONCOLUMN,CS),(0,Pe.Z)(Bv,Ey.TRIANGLECOLUMN,ES),(0,Pe.Z)(Bv,Ey.SQUARECOLUMN,SS),(0,Pe.Z)(Bv,Ey.PENTAGONCOLUMN,Eb),Bv),O1={};function Ay(e){var a=xo(e.coordinates);return{vertices:[].concat((0,Vn.Z)(a),(0,Vn.Z)(a),(0,Vn.Z)(a),(0,Vn.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function AS(e){var a=xo(e.coordinates),r=xb(a);return{vertices:[].concat((0,Vn.Z)(r),(0,Vn.Z)(r),(0,Vn.Z)(r),(0,Vn.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function TS(e){var a=e.shape,r=IS(a,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function iT(e){var a=xo(e.coordinates);return{vertices:(0,Vn.Z)(a),indices:[0],size:a.length}}function Cb(e){var a=e.coordinates,r=e.originCoordinates,n=e.version,t=new bS({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var f=0;f<o.length;f++){var g=o[f],E=u[f];t.extrude_gaode2(g,E)}}else{var R=a;R[0]&&!Array.isArray(R[0][0])&&(R=[a]),R.forEach(function(Y){t.extrude(Y)})}var B=t.complex;return{vertices:B.positions,indices:B.indices,normals:B.normals,indexes:B.indexes,size:6}}function WP(e){var a=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,Vn.Z)(a),[1,2,-3],(0,Vn.Z)(a),[1,1,-3],(0,Vn.Z)(a),[0,1,0],(0,Vn.Z)(a),[0,0,0],(0,Vn.Z)(a),[1,0,0],(0,Vn.Z)(a),[1,2,-3],(0,Vn.Z)(a),[1,1,-3],(0,Vn.Z)(a),[0,1,0],(0,Vn.Z)(a),[0,0,0],(0,Vn.Z)(a)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function XP(e){var a=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(a),[1,2,-3],_toConsumableArray(a),[1,1,-3],_toConsumableArray(a),[0,1,0],_toConsumableArray(a),[0,0,0],_toConsumableArray(a)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1],indices:[0,1,1,2,2,3,3,4,4,0],size:7}}function aT(e){var a=e.coordinates,r=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=oT(a),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function YP(e){var a=e.coordinates,r=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],size:4,count:0};var n=sT(a),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function Ab(e,a){var r=a[0]-e[0],n=a[1]-e[1];return Math.sqrt(r*r+n*n)}function n0(e,a){return e.length<3&&e.push(0),a!==void 0&&e.push(a),e}function oT(e){var a=e;Array.isArray(a)&&Array.isArray(a[0])&&Array.isArray(a[0][0])&&(a=e.flat());var r=0;if(a.length<2)return{results:a,totalDistance:0};var n=[],t=n0(a[0],r);n.push(t);for(var o=1;o<a.length-1;o++){var u=Ab(a[o-1],a[o]);r+=u;var f=n0(a[o],r);n.push(f),n.push(f)}var g=Ab(a[a.length-2],a[a.length-1]);return r+=g,n.push(n0(a[a.length-1],r)),{results:n,totalDistance:r}}function sT(e){if(e.length<2)return{results:e};var a=[],r=n0(e[0]);a.push(r);for(var n=1;n<e.length-1;n++){var t=n0(e[n]);a.push(t),a.push(t)}return a.push(n0(e[e.length-1])),{results:a}}function Tb(e){var a=e.coordinates,r=Oh().flatten(a),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Oh()(n,o,t),vertices:n,size:t}}function uT(e){var a=e.coordinates,r=Oh().flatten(a),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Oh()(n,o,t),vertices:MS(n),size:t+4}}function MS(e){for(var a=[],r=Dl(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],f=e[o+1];a.push.apply(a,[u,f,0].concat((0,Vn.Z)(n),[t]))}return a}function Mb(e){var a=e.coordinates,r=Sb(a,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function PS(e){var a=e.shape,r=LS(a),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function Ty(e){var a=e.coordinates,r=[].concat((0,Vn.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,Vn.Z)(a[1]),[0,1,0],(0,Vn.Z)(a[0]),[0,0,1],(0,Vn.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function F1(e,a){for(var r=a||30,n=e.coordinates,t=[],o=[],u=function(E){t.push(E,1,E,n[0][0],n[0][1],n[1][0],n[1][1],E,-1,E,n[0][0],n[0][1],n[1][0],n[1][1]),E!==r-1&&o.push.apply(o,(0,Vn.Z)([0,1,2,1,3,2].map(function(R){return E*2+R})))},f=0;f<r;f++)u(f);return{vertices:t,indices:o,size:7}}function kS(e){var a=e.coordinates;a.length===2&&a.push(0);var r=z1(-1,1),n=z1(1,1),t=z1(-1,-1),o=z1(1,-1),u=[].concat((0,Vn.Z)(a),(0,Vn.Z)(r),(0,Vn.Z)(a),(0,Vn.Z)(t),(0,Vn.Z)(a),(0,Vn.Z)(o),(0,Vn.Z)(a),(0,Vn.Z)(n)),f=[0,1,2,3,0,2];return{vertices:u,indices:f,size:5}}function IS(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(O1&&O1[e])return O1[e];var r=Fg[e]?Fg[e]():Fg.cylinder(),n=Sb([r],a);return O1[e]=n,n}function qP(e,a){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,f,g=vec3.create(),E=vec3.create(),R=vec3.create(),B=0,Y=a.length;B<Y;B+=3){o=a[B+0]*3,u=a[B+1]*3,f=a[B+2]*3;var Q=[e[o],e[o+1]],ce=[e[u],e[u+1]],fe=[e[f],e[f+1]];n&&(Q=lngLatToMeters(Q),ce=lngLatToMeters(ce),fe=lngLatToMeters(fe));var Te=Q,Ve=_slicedToArray(Te,2),st=Ve[0],at=Ve[1],Tt=vec3.fromValues(st,at,e[o+2]),kt=ce,Yt=_slicedToArray(kt,2),cr=Yt[0],Mr=Yt[1],Dr=vec3.fromValues(cr,Mr,e[u+2]),sn=fe,rn=_slicedToArray(sn,2),Jn=rn[0],fi=rn[1],Hi=vec3.fromValues(Jn,fi,e[f+2]);vec3.sub(g,Hi,Dr),vec3.sub(E,Tt,Dr),vec3.cross(R,g,E),t[o]+=g[0],t[o+1]+=g[1],t[o+2]+=g[2],t[u]+=g[0],t[u+1]+=g[1],t[u+2]+=g[2],t[f]+=g[0],t[f+1]+=g[1],t[f+2]+=g[2]}return lT(t),t}function lT(e){for(var a=0,r=e.length;a<r;a+=3){var n=vec3.fromValues(e[a],e[a+1],e[a+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,a)}}function KP(e){var a=e[0][0],r=e[0][e[0].length-1];return a[0]===r[0]&&a[1]===r[1]}function LS(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Fg[e]?Fg[e]():Fg.circle(),n=a.indexOf(e)===-1?rT([r]):xS([r]);return n}function z1(e,a){var r=(e+1)/2,n=(a+1)/2;return[r,n]}function RS(){var e=wb(wy,{segments:bb}),a=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:a,indices:r,size:5,normals:n}}function DS(){var e=wb(wy+eT,{segments:bb}),a=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:a,indices:r,size:5,normals:n}}function cT(e){var a=OS();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hT=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Pb=function(e){(0,yt.Z)(r,e);var a=cT(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.baseColor,g=f===void 0?"rgb(16,16,16)":f,E=t.brightColor,R=E===void 0?"rgb(255,176,38)":E,B=t.windowColor,Y=B===void 0?"rgb(30,60,89)":B,Q=t.time,ce=Q===void 0?0:Q,fe=t.sweep,Te=fe===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:fe;return{u_cityCenter:Te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Te.sweepRadius,u_circleSweep:Te.enable?1:0,u_circleSweepColor:Mo(Te.sweepColor).slice(0,3),u_circleSweepSpeed:Te.sweepSpeed,u_opacity:u,u_baseColor:Mo(g),u_brightColor:Mo(R),u_windowColor:Mo(Y),u_time:this.layer.getLayerAnimateTime()||ce}}},{key:"calCityGeo",value:function(){var t=(0,gi.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],f=t[2],g=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(f+o)/2,(g+u)/2]);var E=this.mapService.lngLatToCoord([f,g]),R=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-R[0],2)+Math.pow(E[1]-R[1],2))/4}else{var B=f-o,Y=g-u;this.cityCenter=[(f+o)/2,(g+u)/2],this.cityMinSize=Math.sqrt(Math.pow(B,2)+Math.pow(Y,2))/4}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.calCityGeo(),this.startModelAnimate(),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:fT,fragmentShader:hT,triangulation:Mb,depth:{enable:!0},cull:{enable:!0,face:Ke.BACK}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?10:u;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function pT(e){var a=FS();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dT=function(e){(0,yt.Z)(r,e);var a=pT(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","CityBuildingLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layerModel=new Pb(this),f.next=3,this.initLayerModels();case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(kd);function vT(e){var a=mT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gT=`
uniform sampler2D u_texture;
uniform float u_opacity;

varying vec3 v_Color;
varying vec2 v_uv;

#pragma include "picking"
void main() {
  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity;
uniform vec2 u_size: [1.0, 1.0];
uniform mat2 u_RotateMatrix;

attribute vec3 a_Extrude;
attribute vec3 a_Position;
attribute vec2 a_Uv;
attribute vec3 a_Color;

varying vec3 v_Color;
varying vec2 v_uv;

#pragma include "projection"
#pragma include "picking"
void main() {
   vec3 extrude = a_Extrude;
   v_Color = a_Color;
   v_uv = a_Uv;

   float raiseHeight = u_raisingHeight;
   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raiseHeight = u_raisingHeight * mapboxZoomScale;
   }

   // \u8BA1\u7B97\u7ECF\u7EAC\u5EA6\u70B9\u4F4D\u5750\u6807
   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

   // \u8BA1\u7B97\u7ED5 z \u8F74\u65CB\u8F6C\u540E\u7684\u504F\u79FB
   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));
   // \u7ED5 z \u8F74\u65CB\u8F6C
   float x = project_pos.x + offsetXY.x;
   float y = project_pos.y + offsetXY.y;
   // z \u8F74\u4E0D\u53C2\u4E0E\u65CB\u8F6C
   float z = project_pixel(extrude.y * u_size.y + raiseHeight);

   gl_Position = project_common_position_to_clipspace_v2(vec4(x , y, z , 1.0));

   setPickingColor(a_PickingColor);
}
`,_T=function(e){(0,yt.Z)(r,e);var a=vT(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"radian",0),(0,Pe.Z)((0,D.Z)(n),"planeGeometryTriangulation",function(){var f=n.layer.getLayerConfig(),g=f.center,E=g===void 0?[120,30]:g;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat((0,Vn.Z)(E),[1,1],(0,Vn.Z)(E),[0,1],(0,Vn.Z)(E),[0,0],(0,Vn.Z)(E),[1,0])}}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.width,f=u===void 0?1:u,g=t.height,E=g===void 0?1:g,R=t.raisingHeight,B=R===void 0?0:R,Y=1;return(this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(Y=-1),this.radian=Y*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(B),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:o||1,u_texture:this.texture,u_size:[f,E]}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),f=u.drawCanvas,g=this.rendererService.createTexture2D,this.texture=g({height:0,width:0}),f&&this.updateTexture(f),B.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:yT,fragmentShader:gT,triangulation:this.planeGeometryTriangulation,primitive:Ke.TRIANGLES,depth:{enable:!0}});case 6:return E=B.sent,B.abrupt("return",[E]);case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateTexture",value:function(t){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),f=u.canvasWidth,g=f===void 0?1:f,E=u.canvasHeight,R=E===void 0?1:E,B=document.createElement("canvas");B.width=g,B.height=R;var Y=B.getContext("2d");Y&&(t(B),this.texture=o({data:B,width:B.width,height:B.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ni.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],R=g%4*3;return[E[R],E[R+1],E[R+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[2],f[3]]}}})}}]),r}(Lu);function zS(e){var a=bT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`
uniform sampler2D u_texture;
uniform float u_mapFlag;
uniform float u_opacity;

varying vec3 v_Color;
varying vec2 v_uv;
varying float v_clip;

#pragma include "picking"
void main() {
  // gl_FragColor = vec4(v_Color, u_opacity);
  if(u_mapFlag > 0.0) {
    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));
    gl_FragColor.a *= u_opacity;
  } else {
    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);
    gl_FragColor = vec4(v_Color, u_opacity);
  }
  gl_FragColor.a *= v_clip;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JP=`precision highp float;
uniform mat4 u_ModelMatrix;

uniform float u_opacity;
uniform float u_terrainClipHeight;

attribute vec3 a_Position;
attribute vec2 a_Uv;
attribute vec3 a_Color;

varying vec3 v_Color;
varying vec2 v_uv;
varying float v_clip;

#pragma include "projection"
#pragma include "picking"
void main() {
   v_Color = a_Color;
   v_uv = a_Uv;
  
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   v_clip = 1.0;
   if(a_Position.z < u_terrainClipHeight) {
      v_clip = 0.0;
   }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));

   setPickingColor(a_PickingColor);
}
`,QP=function(e){(0,yt.Z)(r,e);var a=zS(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"terrainImageLoaded",!1),(0,Pe.Z)((0,D.Z)(n),"planeGeometryTriangulation",function(){var f,g=n.layer.getLayerConfig(),E=g.width,R=E===void 0?1:E,B=g.height,Y=B===void 0?1:B,Q=g.widthSegments,ce=Q===void 0?1:Q,fe=g.heightSegments,Te=fe===void 0?1:fe,Ve=g.center,st=Ve===void 0?[120,30]:Ve,at=g.terrainTexture,Tt=(f=n).initPlane.apply(f,[R,Y,ce,Te].concat((0,Vn.Z)(st))),kt=Tt.indices,Yt=Tt.positions;return at&&n.loadTerrainTexture(Yt,kt),{vertices:Yt,indices:kt,size:5}}),n}return(0,Me.Z)(r,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:120,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,R=t/2,B=o/2,Y=Math.floor(u),Q=Math.floor(f),ce=Y+1,fe=Q+1,Te=t/Y,Ve=o/Q,st=[],at=[],Tt=0;Tt<fe;Tt++)for(var kt=Tt*Ve-B,Yt=0;Yt<ce;Yt++){var cr=Yt*Te-R;if(this.mapService.version===ip["GAODE2.x"]){var Mr=this.mapService.lngLatToCoord([cr+g,-kt+E]),Dr=(0,gi.Z)(Mr,2),sn=Dr[0],rn=Dr[1];at.push(sn,rn,0)}else at.push(cr+g,-kt+E,0);at.push(Yt/Y),at.push(1-Tt/Q)}for(var Jn=0;Jn<Q;Jn++)for(var fi=0;fi<Y;fi++){var Hi=fi+ce*Jn,Ds=fi+ce*(Jn+1),pu=fi+1+ce*(Jn+1),$s=fi+1+ce*Jn;st.push(Hi,Ds,$s),st.push(Ds,pu,$s)}return{indices:st,positions:at}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.mapTexture,f=t.terrainClipHeight,g=f===void 0?0:f,E=t.terrainTexture;if(this.mapTexture!==u){var R;this.mapTexture=u,(R=this.texture)===null||R===void 0||R.destroy(),this.updateTexture(u)}return{u_opacity:o||1,u_mapFlag:u?1:0,u_terrainClipHeight:E?g:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var t;this.terrainImage=null,(t=this.texture)===null||t===void 0||t.destroy()}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),f=u.mapTexture,this.mapTexture=f,g=this.rendererService.createTexture2D,this.texture=g({height:0,width:0}),this.updateTexture(f),B.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:JP,fragmentShader:BS,triangulation:this.planeGeometryTriangulation,primitive:Ke.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:Ke.BACK}});case 7:return E=B.sent,B.abrupt("return",[E]);case 9:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"createModelData",value:function(t){if(t){var o=this.layer.getLayerConfig(),u=o.widthSegments,f=o.heightSegments,g=o.width,E=o.height,R=t,B=R.widthSegments,Y=R.heightSegments,Q=R.width,ce=R.height;this.layer.style({widthSegments:B!==void 0?B:u,heightSegments:Y!==void 0?Y:f,width:Q!==void 0?Q:g,height:ce!==void 0?ce:E})}var fe=this.layer.getEncodedData(),Te=this.styleAttributeService.createAttributesAndIndices(fe,this.planeGeometryTriangulation);return Te}},{key:"updateTexture",value:function(t){var o=this,u=this.rendererService.createTexture2D;if(t){var f=new Image;f.crossOrigin="anonymous",f.onload=function(){o.texture=u({data:f,width:f.width,height:f.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE}),o.layerService.reRender()},f.src=t}else this.texture=u({width:0,height:0})}},{key:"getImageData",value:function(t){var o=document.createElement("canvas"),u=o.getContext("2d"),f=t.width,g=t.height;o.width=f,o.height=g,u.drawImage(t,0,0,f,g);var E=u.getImageData(0,0,f,g);return E}},{key:"translateVertex",value:function(t,o,u,f,g,E){for(var R=u.width,B=u.height,Y=this.getImageData(u).data,Q=Math.floor(f),ce=Math.floor(g),fe=Q+1,Te=ce+1,Ve=R/Q,st=B/ce,at=0;at<Te;at++)for(var Tt=Math.floor(at*st),kt=Tt*R,Yt=0;Yt<fe;Yt++){var cr=Math.floor(Yt*Ve),Mr=(kt+cr)*4,Dr=Y[Mr],sn=Y[Mr+1],rn=Y[Mr+2],Jn=(at*fe+Yt)*5+2;t[Jn]=E(Dr,sn,rn)}var fi=this.layer.getEncodedData(),Hi=this.styleAttributeService.createAttributesAndIndices(fi,function(){return{vertices:t,indices:o,size:5}});this.layer.updateModelData(Hi),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(t,o){var u=this,f=this.layer.getLayerConfig(),g=f.widthSegments,E=g===void 0?1:g,R=f.heightSegments,B=R===void 0?1:R,Y=f.terrainTexture,Q=f.rgb2height,ce=Q===void 0?function(Te,Ve,st){return Te+Ve+st}:Q;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(t,o,this.terrainImage,E,B,ce):this.terrainImage.onload=function(){u.translateVertex(t,o,u.terrainImage,E,B,ce)};else{var fe=new Image;this.terrainImage=fe,fe.crossOrigin="anonymous",fe.onload=function(){u.terrainImageLoaded=!0,setTimeout(function(){return u.layer.emit("terrainImageLoaded",null)}),u.translateVertex(t,o,fe,E,B,ce)},fe.src=Y}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function ek(e){var a=xT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function xT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wT=`
uniform sampler2D u_texture;
uniform float u_mapFlag;
uniform float u_opacity;

varying vec3 v_Color;
varying float v_d;

void main() {

  if(v_d < 0.0) {
    discard;
  }

  if(u_mapFlag > 0.0) {
    gl_FragColor = texture2D(u_texture, gl_PointCoord);
    gl_FragColor.a *= u_opacity;
  } else {
    gl_FragColor = vec4(v_Color, u_opacity);
  }
}
`,ST=`precision highp float;

attribute vec3 a_Position;
attribute vec3 a_Color;

uniform mat4 u_ModelMatrix;
uniform float u_opacity;
uniform float u_Scale;
varying vec3 v_Color;
varying float v_d;

#pragma include "projection"
void main() {
   v_Color = a_Color;
  
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   v_d = a_Position.z;

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));
gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;
}
`,D0=function(e){return e.UP="up",e.DOWN="down",e}(D0||{}),kb=function(e){(0,yt.Z)(r,e);var a=ek(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"planeGeometryUpdateTriangulation",function(){for(var f=n.layer.getLayerConfig(),g=f.spriteBottom,E=g===void 0?-1e5:g,R=n.spriteUpdate,B=E,Y=n.spriteTop,Q=0;Q<n.positions.length;Q+=5)n.spriteAnimate===D0.UP?(n.positions[Q+2]+=R,n.positions[Q+2]>Y&&(n.positions[Q+2]=B)):(n.positions[Q+2]-=R,n.positions[Q+2]<B&&(n.positions[Q+2]=Y));return{vertices:n.positions,indices:n.indices,size:5}}),(0,Pe.Z)((0,D.Z)(n),"updateModel",function(){var f=n.layer.createAttributes({triangulation:n.planeGeometryUpdateTriangulation});n.layer.models.map(function(g){g.updateAttributes(f)}),n.layerService.throttleRenderLayers(),n.timer=requestAnimationFrame(n.updateModel)}),(0,Pe.Z)((0,D.Z)(n),"planeGeometryTriangulation",function(){var f,g=n.layer.getLayerConfig(),E=g.center,R=E===void 0?[120,30]:E,B=g.spriteCount,Y=B===void 0?100:B,Q=g.spriteRadius,ce=Q===void 0?10:Q,fe=(f=n).initSprite.apply(f,[ce,Y].concat((0,Vn.Z)(R))),Te=fe.indices,Ve=fe.positions;return n.positions=Ve,n.indices=Te,{vertices:Ve,indices:Te,size:5}}),n}return(0,Me.Z)(r,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:120,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:30,g=[],E=[],R=this.mapService,B=this.spriteAnimate===D0.UP?-this.spriteTop:this.spriteTop,Y=0;Y<o;Y++){var Q=Math.random()*B;E.push.apply(E,(0,Vn.Z)(fe(Q)))}for(var ce=0;ce<o;ce++)g.push(ce);function fe(Te){var Ve=t*Math.random(),st=t*Math.random(),at=-t/2+Ve,Tt=-t/2+st;if(R.version===ip["GAODE2.x"]){var kt=R.lngLatToCoord([at+u,-Tt+f]),Yt=(0,gi.Z)(kt,2),cr=Yt[0],Mr=Yt[1];return[cr,Mr,Te,0,0]}else return[at+u,-Tt+f,Te,0,0]}return{indices:g,positions:E}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.mapTexture,f=t.spriteScale,g=f===void 0?1:f;if(this.mapTexture!==u){var E;this.mapTexture=u,(E=this.texture)===null||E===void 0||E.destroy(),this.updateTexture(u)}return{u_opacity:o||1,u_mapFlag:u?1:0,u_texture:this.texture,u_Scale:g}}},{key:"clearModels",value:function(){var t;cancelAnimationFrame(this.timer),(t=this.texture)===null||t===void 0||t.destroy()}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te;return x().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return f=this.layer.getLayerConfig(),g=f.mapTexture,E=f.spriteTop,R=E===void 0?5e6:E,B=f.spriteUpdate,Y=B===void 0?1e4:B,Q=f.spriteAnimate,ce=Q===void 0?D0.DOWN:Q,this.mapTexture=g,this.spriteTop=R,this.spriteUpdate=Y,ce==="up"?this.spriteAnimate=D0.UP:this.spriteAnimate=D0.DOWN,fe=this.rendererService.createTexture2D,this.texture=fe({height:0,width:0}),this.updateTexture(g),setTimeout(function(){u.updateModel()},100),st.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:ST,fragmentShader:wT,triangulation:this.planeGeometryTriangulation,primitive:Ke.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return Te=st.sent,st.abrupt("return",[Te]);case 13:case"end":return st.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateTexture",value:function(t){var o=this,u=this.rendererService.createTexture2D;if(t){var f=new Image;f.crossOrigin="anonymous",f.onload=function(){o.texture=u({data:f,width:f.width,height:f.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE}),o.layerService.reRender()},f.src=t}else this.texture=u({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Lu),ET={plane:QP,sprite:kb,billboard:_T},CT=ET;function My(e){var a=AT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function AT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ib=function(e){(0,yt.Z)(r,e);var a=My(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","GeometryLayer"),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new CT[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={plane:{},sprite:{},billboard:{}};return o[t]}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="plane"?"plane":u==="sprite"?"sprite":u==="billboard"?"billboard":"plane"}}]),r}(kd);function TT(e){var a=MT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PT=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,kT=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,IT=function(e){(0,yt.Z)(r,e);var a=TT(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,f=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:f||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:PT,fragmentShader:kT,triangulation:PS,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ni.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Lu);function NS(e){var a=ZS();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LT=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,B1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,US=function(e){(0,yt.Z)(r,e);var a=NS(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,f=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:f||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:LT,fragmentShader:B1,triangulation:TS,primitive:Ke.TRIANGLES,depth:{enable:!0}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ni.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Lu);function O0(e,a){for(var r=[],n=[],t=[],o=e+1,u=a+1,f=e/2,g=a/2,E=0;E<u;E++)for(var R=E-g,B=0;B<o;B++){var Y=B-f;n.push(Y/f,-R/g,0),t.push(B/e),t.push(1-E/a)}for(var Q=0;Q<a;Q++)for(var ce=0;ce<e;ce++){var fe=ce+o*Q,Te=ce+o*(Q+1),Ve=ce+1+o*(Q+1),st=ce+1+o*Q;r.push(fe,Te,st),r.push(Te,Ve,st)}return{vertices:n,indices:r,uvs:t}}var jS,N1;function Lb(e){var a=RT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function RT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DT=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,OT=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,FT=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,VS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,GS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,zT=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,BT=Ga.isEqual,HS=(jS=(0,Ii.b2)(),jS(N1=function(e){(0,yt.Z)(r,e);var a=Lb(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"render",value:function(t){var o=this,u=this.rendererService,f=u.clear,g=u.useFramebuffer,E=this.layer.getLayerConfig(),R=E.rampColors;g(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),BT(this.preRampColors,R)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q,ce,fe;return x().wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:return f=this.rendererService,g=f.createFramebuffer,E=f.getViewportSize,R=f.createTexture2D,B=this.styleAttributeService.getLayerStyleAttribute("shape"),Y=(B==null||(u=B.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=Y,Ve.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=Ve.sent,this.colorModel=Y==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),Q=E(),ce=Q.width,fe=Q.height,this.heatmapFramerBuffer=g({color:R({width:Math.floor(ce/4),height:Math.floor(fe/4),wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE,min:Ke.LINEAR,mag:Ke.LINEAR}),depth:!1}),this.updateColorTexture(),Ve.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return Ve.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ni.Attribute,descriptor:{name:"a_Dir",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return[f]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.triangulation=kS,g.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:zT,fragmentShader:GS,triangulation:kS,depth:{enable:!1},cull:{enable:!0,face:Hf(this.mapService.version)}});case 3:return u=g.sent,g.abrupt("return",u);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:VS,fs:FT});var t=this.shaderModuleService.getModule("heatmapColor"),o=t.vs,u=t.fs,f=t.uniforms,g=this.rendererService,E=g.createAttribute,R=g.createElements,B=g.createBuffer,Y=g.createModel;return Y({vs:o,fs:u,attributes:{a_Position:E({buffer:B({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Ke.FLOAT}),size:3}),a_Uv:E({buffer:B({data:[0,1,1,1,0,0,1,0],type:Ke.FLOAT}),size:2})},uniforms:(0,Ee.Z)({},f),depth:{enable:!1},elements:R({data:[0,2,1,2,3,1],type:Ke.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,f=o.intensity,g=f===void 0?10:f,E=o.radius,R=E===void 0?5:E;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:R,u_intensity:g},blend:{enable:!0,func:{srcRGB:Ke.ONE,srcAlpha:1,dstRGB:Ke.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var o,u=this.layer.getLayerConfig(),f=u.opacity;(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:f||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var o,u=this.layer.getLayerConfig(),f=u.opacity,g=Kn();Oo(g,this.cameraService.getViewProjectionMatrixUncentered()),(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:f||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Vn.Z)(g)},blend:{enable:!0,func:{srcRGB:Ke.SRC_ALPHA,srcAlpha:1,dstRGB:Ke.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=this.rendererService.getViewportSize,o=t(),u=o.width,f=o.height,g=O0(u/4,f/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:OT,fs:DT});var E=this.shaderModuleService.getModule("heatmap3dColor"),R=E.vs,B=E.fs,Y=E.uniforms,Q=this.rendererService,ce=Q.createAttribute,fe=Q.createElements,Te=Q.createBuffer,Ve=Q.createModel;return Ve({vs:R,fs:B,attributes:{a_Position:ce({buffer:Te({data:g.vertices,type:Ke.FLOAT}),size:3}),a_Uv:ce({buffer:Te({data:g.uvs,type:Ke.FLOAT}),size:2})},primitive:Ke.TRIANGLES,uniforms:(0,Ee.Z)({},Y),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Ke.SRC_ALPHA,srcAlpha:1,dstRGB:Ke.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:fe({data:g.indices,type:Ke.UNSIGNED_INT,count:g.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,f=Ja(u);this.colorTexture=t({data:new Uint8Array(f.data),width:f.width,height:f.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE,min:Ke.NEAREST,mag:Ke.NEAREST,flipY:!1}),this.preRampColors=u}}]),r}(Lu))||N1);function $S(e){var a=NT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function NT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZT=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,XS=function(e){(0,yt.Z)(r,e);var a=$S(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,f=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:f||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:ZT,fragmentShader:WS,triangulation:PS,depth:{enable:!1},primitive:Ke.TRIANGLES});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ni.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Lu),Rb={heatmap:HS,heatmap3d:HS,grid:IT,grid3d:US,hexagon:XS},UT=Rb;function jT(e){var a=VT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=function(e){(0,yt.Z)(r,e);var a=jT(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","HeatMapLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new UT[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(o),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(f){return f.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),f=u.shape3d,g=this.getSource(),E=g.data.type,R=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return R==="heatmap"||R==="heatmap3d"?"heatmap":E==="hexagon"?(f==null?void 0:f.indexOf(R))===-1?"hexagon":"grid3d":E==="grid"?(f==null?void 0:f.indexOf(R))===-1?"grid":"grid3d":"heatmap"}}]),r}(kd);function HT(e){var a=$T();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function $T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F0=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,Db=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,YS=function(e){(0,yt.Z)(r,e);var a=HT(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getSource(),f=this.rendererService.createTexture2D,this.texture=f({height:0,width:0}),B.next=5,u.data.images;case 5:return g=B.sent,this.texture=f({data:g[0],width:g[0].width,height:g[0].height,mag:Ke.LINEAR,min:Ke.LINEAR}),B.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:Db,fragmentShader:F0,triangulation:Ty,primitive:Ke.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return E=B.sent,B.abrupt("return",[E]);case 11:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu),WT={image:YS},XT=WT;function YT(e){var a=qS();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ob=function(e){(0,yt.Z)(r,e);var a=YT(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","ImageLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new XT[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(kd);function qT(e){var a=KT();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JT=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;


  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,KS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,QT=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  
  gl_FragColor.a *= u_opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,Z1=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;

uniform float u_opacity: 1.0;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,eM=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,JS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;
uniform float u_opacity: 1.0;

uniform float u_thetaOffset: 0.314;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= u_opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Fb={solid:0,dash:1},tM=Ga.isNumber,rM=function(e){(0,yt.Z)(r,e);var a=qT(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.sourceColor,g=t.targetColor,E=t.textureBlend,R=E===void 0?"normal":E,B=t.lineType,Y=B===void 0?"solid":B,Q=t.dashArray,ce=Q===void 0?[10,5]:Q,fe=t.forward,Te=fe===void 0?!0:fe,Ve=t.lineTexture,st=Ve===void 0?!1:Ve,at=t.iconStep,Tt=at===void 0?100:at,kt=t.segmentNumber,Yt=kt===void 0?30:kt,cr=t.thetaOffset,Mr=cr===void 0?.314:cr;ce.length===2&&ce.push(0,0);var Dr=0,sn=[0,0,0,0],rn=[0,0,0,0];return f&&g&&(sn=Mo(f),rn=Mo(g),Dr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:Mr,u_opacity:tM(u)?u:1,u_textureBlend:R==="normal"?0:1,segmentNumber:Yt,u_line_type:Fb[Y||"solid"],u_dash_array:ce,u_blur:.9,u_lineDir:Te?1:-1,u_texture:this.texture,u_line_texture:st?1:0,u_icon_step:Tt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Dr,u_sourceColor:sn,u_targetColor:rn}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,f=t.lineType;return f==="dash"?{frag:JT,vert:KS,type:"Dash"}:o&&u?{frag:eM,vert:JS,type:"Linear"}:{frag:QT,vert:Z1,type:""}}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),f=u.segmentNumber,g=f===void 0?30:f,E=this.getShaders(),R=E.frag,B=E.vert,Y=E.type,fe.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+Y,vertexShader:B,fragmentShader:R,triangulation:F1,depth:{enable:!1},segmentNumber:g});case 4:return Q=fe.sent,fe.abrupt("return",[Q]);case 6:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ni.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(u,f,g){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function tk(e){var a=zb();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function zb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,QS=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,iM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,aM={solid:0,dash:1},oM=function(e){(0,yt.Z)(r,e);var a=tk(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,f=t.textureBlend,g=f===void 0?"normal":f,E=t.lineType,R=E===void 0?"solid":E,B=t.dashArray,Y=B===void 0?[10,5]:B,Q=t.lineTexture,ce=Q===void 0?!1:Q,fe=t.iconStep,Te=fe===void 0?100:fe,Ve=t.segmentNumber,st=Ve===void 0?30:Ve,at=t.globalArcHeight,Tt=at===void 0?10:at;Y.length===2&&Y.push(0,0);var kt=0,Yt=[0,0,0,0],cr=[0,0,0,0];return o&&u&&(Yt=Mo(o),cr=Mo(u),kt=1),this.rendererService.getDirty()&&this.texture.bind(),(0,Ee.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:wy,u_global_height:Tt,u_textureBlend:g==="normal"?0:1,segmentNumber:st,u_line_type:aM[R]||0,u_dash_array:Y,u_texture:this.texture,u_line_texture:ce?1:0,u_icon_step:Te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kt,u_sourceColor:Yt,u_targetColor:cr},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:QS,vert:iM,type:"Linear"}:{frag:rk,vert:nM,type:""}}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),f=u.segmentNumber,g=f===void 0?30:f,E=this.getShaders(),R=E.frag,B=E.vert,Y=E.type,fe.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+Y,vertexShader:B,fragmentShader:R,inject:this.getInject(),triangulation:F1,segmentNumber:g});case 4:return Q=fe.sent,fe.abrupt("return",[Q]);case 6:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ni.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(u,f,g){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function sM(e){var a=uM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function uM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,hM=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,fM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,e3={solid:0,dash:1},Bb=function(e){(0,yt.Z)(r,e);var a=sM(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.sourceColor,g=t.targetColor,E=t.textureBlend,R=E===void 0?"normal":E,B=t.lineType,Y=B===void 0?"solid":B,Q=t.dashArray,ce=Q===void 0?[10,5]:Q,fe=t.lineTexture,Te=fe===void 0?!1:fe,Ve=t.iconStep,st=Ve===void 0?100:Ve,at=t.segmentNumber,Tt=at===void 0?30:at,kt=t.globalArcHeight,Yt=kt===void 0?10:kt;ce.length===2&&ce.push(0,0);var cr=0,Mr=[0,0,0,0],Dr=[0,0,0,0];return f&&g&&(Mr=Mo(f),Dr=Mo(g),cr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:wy,u_global_height:Yt,u_opacity:u,u_textureBlend:R==="normal"?0:1,segmentNumber:Tt,u_line_type:e3[Y]||0,u_dash_array:ce,u_texture:this.texture,u_line_texture:Te?1:0,u_icon_step:st,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:cr,u_sourceColor:Mr,u_targetColor:Dr}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:hM,vert:fM,type:"Linear"}:{frag:lM,vert:cM,type:""}}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),f=u.segmentNumber,g=f===void 0?30:f,E=this.getShaders(),R=E.frag,B=E.vert,Y=E.type,fe.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+Y,vertexShader:B,fragmentShader:R,triangulation:F1,depth:{enable:!0},segmentNumber:g});case 4:return Q=fe.sent,fe.abrupt("return",[Q]);case 6:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ni.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(u,f,g){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function pM(e){var a=dM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function dM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U1=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,vM=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = normalize(target - source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.8), project_pixel(lengthCommon*.8)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);

  float gapCommon =  project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,mM=function(e){(0,yt.Z)(r,e);var a=pM(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.gapWidth,u=o===void 0?2:o,f=t.strokeWidth,g=f===void 0?1:f,E=t.stroke,R=E===void 0?"#000":E,B=t.strokeOpacity,Y=B===void 0?1:B;return(0,Ee.Z)({u_gap_width:u,u_stroke_width:g,u_stroke:Mo(R),u_stroke_opacity:Y},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:vM,fragmentShader:U1,inject:this.getInject(),triangulation:WP,primitive:Ke.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ni.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(o,u,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}})}}]),r}(Lu);function Nb(e){var a=gM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,_M=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,bM={solid:0,dash:1},xM=function(e){(0,yt.Z)(r,e);var a=Nb(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.sourceColor,g=t.targetColor,E=t.textureBlend,R=E===void 0?"normal":E,B=t.lineType,Y=B===void 0?"solid":B,Q=t.dashArray,ce=Q===void 0?[10,5]:Q,fe=t.lineTexture,Te=fe===void 0?!1:fe,Ve=t.iconStep,st=Ve===void 0?100:Ve,at=t.segmentNumber,Tt=at===void 0?30:at;ce.length===2&&ce.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var kt=0,Yt=[0,0,0,0],cr=[0,0,0,0];return f&&g&&(Yt=Mo(f),cr=Mo(g),kt=1),{u_opacity:u,u_textureBlend:R==="normal"?0:1,segmentNumber:Tt,u_line_type:bM[Y]||0,u_dash_array:ce,u_texture:this.texture,u_line_texture:Te?1:0,u_icon_step:st,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kt,u_sourceColor:Yt,u_targetColor:cr}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:_M,fragmentShader:yM,triangulation:F1,depth:{enable:!1}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ni.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(u,f,g){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function wM(e){var a=SM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function SM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

 
  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,CM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));
  
 float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,AM=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth / 2.0;


    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,t3=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,TM=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity: 1.0;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,MM={solid:0,dash:1},r3=function(e){(0,yt.Z)(r,e);var a=wM(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"textureEventFlag",!1),(0,Pe.Z)((0,D.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,f=t.textureBlend,g=f===void 0?"normal":f,E=t.lineType,R=E===void 0?"solid":E,B=t.dashArray,Y=B===void 0?[10,5,0,0]:B,Q=t.lineTexture,ce=Q===void 0?!1:Q,fe=t.iconStep,Te=fe===void 0?100:fe,Ve=t.vertexHeightScale,st=Ve===void 0?20:Ve,at=t.borderWidth,Tt=at===void 0?0:at,kt=t.borderColor,Yt=kt===void 0?"#ccc":kt,cr=t.raisingHeight,Mr=cr===void 0?0:cr,Dr=t.heightfixed,sn=Dr===void 0?!1:Dr,rn=t.linearDir,Jn=rn===void 0?gy.VERTICAL:rn,fi=t.blur,Hi=fi===void 0?[1,1,1]:fi,Ds=t.arrow,pu=Ds===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ds;Y.length===2&&Y.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var $s=0,Pc=[0,0,0,0],lc=[0,0,0,0];return o&&u&&(Pc=Mo(o),lc=Mo(u),$s=1),(0,Ee.Z)({u_textureBlend:g===hb.NORMAL?0:1,u_line_type:MM[R],u_dash_array:Y,u_blur:Hi,u_texture:this.texture,u_line_texture:ce?1:0,u_icon_step:Te,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Tt,u_borderColor:Mo(Yt),u_linearDir:Jn===gy.VERTICAL?1:0,u_linearColor:$s,u_sourceColor:Pc,u_targetColor:lc,u_heightfixed:Number(sn),u_vertexScale:st,u_raisingHeight:Number(Mr),u_arrow:Number(pu.enable),u_arrowHeight:pu.arrowHeight||3,u_arrowWidth:pu.arrowWidth||2,u_tailWidth:pu.tailWidth===void 0?1:pu.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),f.abrupt("return",this.buildModels());case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),f=u.depth,g=f===void 0?!1:f,E=this.getShaders(),R=E.frag,B=E.vert,Y=E.type,this.layer.triangulation=_n,fe.next=5,this.layer.buildLayerModel({moduleName:"line"+Y,vertexShader:B,fragmentShader:R,triangulation:_n,inject:this.getInject(),depth:{enable:g}});case 5:return Q=fe.sent,fe.abrupt("return",[Q]);case 7:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,f=t.lineType;return f==="dash"?{frag:EM,vert:CM,type:"Dash"}:o&&u?{frag:TM,vert:t3,type:"Linear"}:{frag:AM,vert:t3,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ni.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u,f,g,E,R,B){return B===void 0?[g[3],10]:[g[3],B]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ni.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u,f,g){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0],g[1]]:[g,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(u,f,g,E,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ni.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u,f,g){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function PM(e){var a=kM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function kM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IM=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,LM=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,RM=Ga.isNumber,DM=function(e){(0,yt.Z)(r,e);var a=PM(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),E=g.rampColors,R=Ja(E);n.colorTexture=f({data:new Uint8Array(R.data),width:R.width,height:R.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE,min:Ke.NEAREST,mag:Ke.NEAREST,flipY:!1})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.vertexHeightScale,g=f===void 0?20:f,E=t.raisingHeight,R=E===void 0?0:E,B=t.heightfixed,Y=B===void 0?!1:B,Q=t.linearDir,ce=Q===void 0?gy.VERTICAL:Q;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:ce===gy.VERTICAL?1:0,u_opacity:RM(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(Y),u_vertexScale:g,u_raisingHeight:Number(R)}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),f.abrupt("return",this.buildModels());case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),f=u.depth,g=f===void 0?!1:f,this.layer.triangulation=Cb,B.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:LM,fragmentShader:IM,triangulation:Cb,depth:{enable:g}});case 4:return E=B.sent,B.abrupt("return",[E]);case 6:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ni.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f,g,E,R){return R===void 0?[f[3],10]:[f[3],R]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ni.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o,u,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ni.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o,u,f){return[f[4]]}}})}}]),r}(Lu);function n3(e){var a=OM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function OM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FM=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,zM=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
uniform float u_opacity: 1.0;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,i3=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); 
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,BM=Ga.isNumber,a3=function(e){(0,yt.Z)(r,e);var a=n3(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.sourceColor,g=t.targetColor,E=t.vertexHeightScale,R=E===void 0?20:E,B=0,Y=[0,0,0,0],Q=[0,0,0,0];return f&&g&&(Y=Mo(f),Q=Mo(g),B=1),{u_opacity:BM(u)?u:1,u_linearColor:B,u_sourceColor:Y,u_targetColor:Q,u_vertexScale:R}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:zM,vert:i3,type:"lineSimpleLinear"}:{frag:FM,vert:i3,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return u=this.getShaders(),f=u.frag,g=u.vert,E=u.type,Y.next=3,this.layer.buildLayerModel({moduleName:E,vertexShader:g,fragmentShader:f,triangulation:aT,primitive:Ke.LINES,depth:{enable:!1},pick:!1});case 3:return R=Y.sent,Y.abrupt("return",[R]);case 5:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ni.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o,u,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ni.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o,u,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}})}}]),r}(Lu);function o3(e){var a=NM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function NM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,UM=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jM=Ga.isNumber,VM=function(e){(0,yt.Z)(r,e);var a=o3(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.NEAREST,min:Ke.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.sourceColor,g=t.targetColor,E=t.textureBlend,R=E===void 0?"normal":E,B=t.heightfixed,Y=B===void 0?!1:B,Q=t.lineTexture,ce=Q===void 0?!1:Q,fe=t.iconStep,Te=fe===void 0?100:fe,Ve=t.iconStepCount,st=Ve===void 0?1:Ve;this.rendererService.getDirty()&&this.texture.bind();var at=0,Tt=[0,0,0,0],kt=[0,0,0,0];return f&&g&&(Tt=Mo(f),kt=Mo(g),at=1),{u_heightfixed:Number(Y),u_opacity:jM(u)?u:1,u_textureBlend:R==="normal"?0:1,u_texture:this.texture,u_line_texture:ce?1:0,u_iconStepCount:st,u_icon_step:Te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:at,u_sourceColor:Tt,u_targetColor:kt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:UM,fragmentShader:ZM,triangulation:Cb,depth:{enable:!1},blend:this.getBlend()});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ni.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u,f,g){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ni.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u,f,g){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=u.size,g=f===void 0?1:f;return Array.isArray(g)?[g[0],g[1]]:[g,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(u,f,g,E,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ni.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u,f,g){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.texture,E=f[g]||{x:0,y:0},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu),GM={arc:rM,arc3d:oM,greatcircle:xM,wall:VM,line:r3,simple:a3,linearline:DM,earthArc3d:Bb,flowline:mM},HM=GM;function $M(e){var a=WM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function WM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zb=function(e){(0,yt.Z)(r,e);var a=$M(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","LineLayer"),(0,Pe.Z)((0,D.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),(0,Pe.Z)((0,D.Z)(n),"arrowInsertCount",0),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new HM[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var f=(0,Ee.Z)({},u);u.coordinates.map(function(g){o.push((0,Ee.Z)((0,Ee.Z)({},f),{},{coordinates:g}))})}else o.push(u)}),o}}]),r}(kd);function Ub(e){var a=XM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function XM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Py=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,YM=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function s3(e){var a=e.coordinates;return{vertices:(0,Vn.Z)(a),indices:[0],size:a.length}}var qM=function(e){(0,yt.Z)(r,e);var a=Ub(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.offsets,g=f===void 0?[0,0]:f,E=t.blend,R=t.strokeOpacity,B=R===void 0?1:R,Y=t.strokeWidth,Q=Y===void 0?0:Y,ce=t.stroke,fe=ce===void 0?"#fff":ce;return{u_additive:E==="additive"?1:0,u_opacity:u,u_offsets:g,u_stroke_opacity:B,u_stroke_width:Q,u_stroke_color:Mo(fe)}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.triangulation=s3,g.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:YM,fragmentShader:Py,triangulation:s3,depth:{enable:!1},primitive:Ke.POINTS});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0]]:[f]}}})}}]),r}(Lu);function ky(e){var a=KM();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function KM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JM=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,e4=Ga.isNumber,u3=function(e){(0,yt.Z)(r,e);var a=ky(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"raiseCount",0),(0,Pe.Z)((0,D.Z)(n),"raiseRepeat",0),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,f=t.opacity,g=f===void 0?1:f,E=t.sourceColor,R=t.targetColor,B=t.pickLight,Y=B===void 0?!1:B,Q=t.heightfixed,ce=Q===void 0?!1:Q,fe=t.opacityLinear,Te=fe===void 0?{enable:!1,dir:"up"}:fe,Ve=t.lightEnable,st=Ve===void 0?!0:Ve,at=0,Tt=[0,0,0,0],kt=[0,0,0,0];if(E&&R&&(Tt=Mo(E),kt=Mo(R),at=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Yt=u.speed,cr=Yt===void 0?.01:Yt;this.raiseCount+=cr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(Y),u_heightfixed:Number(ce),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:e4(g)?g:1,u_linearColor:at,u_sourceColor:Tt,u_targetColor:kt,u_opacitylinear:Number(Te.enable),u_opacitylinear_dir:Te.dir==="up"?1:0,u_lightEnable:Number(st)}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),f=u.animateOption.repeat,g=f===void 0?1:f,this.raiseRepeat=g,B.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:QM,fragmentShader:JM,triangulation:TS,depth:{enable:!0},cull:{enable:!0,face:Hf(this.mapService.version)},blend:this.getBlend()});case 4:return E=B.sent,B.abrupt("return",[E]);case 6:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=o.size;if(u){var f=[];return Array.isArray(u)&&(f=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(f=[u,u,u]),f}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ni.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=xo(o.coordinates);return xb([u[0],u[1]])}}})}}]),r}(Lu);function jb(e){var a=l3();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t4=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,c3=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,r4=function(e){(0,yt.Z)(r,e);var a=jb(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.strokeOpacity,g=f===void 0?1:f,E=t.strokeWidth,R=E===void 0?0:E,B=t.stroke,Y=B===void 0?"rgba(0,0,0,0)":B,Q=t.blend,ce=t.blur,fe=ce===void 0?0:ce;return{u_blur:fe,u_additive:Q==="additive"?1:0,u_opacity:u,u_stroke_opacity:g,u_stroke_width:R,u_stroke_color:Mo(Y)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.triangulation=AS,g.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:c3,fragmentShader:t4,triangulation:AS,depth:{enable:!0},blend:this.getBlend()});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ni.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(u,f,g,E){var R=(0,gi.Z)(g,3),B=R[0],Y=R[1],Q=R[2],ce=Fu(0,0,1),fe=Fu(B,0,Q),Te=B>=0?L1(ce,fe):Math.PI*2-L1(ce,fe),Ve=Math.PI*2-Math.asin(Y/100),st=Kn();hs(st,st,Te),Wi(st,st,Ve);var at=Fu(1,1,0);Lg(at,at,st),Ig(at,at);var Tt=Fu(-1,1,0);Lg(Tt,Tt,st),Ig(Tt,Tt);var kt=Fu(-1,-1,0);Lg(kt,kt,st),Ig(kt,kt);var Yt=Fu(1,-1,0);Lg(Yt,Yt,st),Ig(Yt,Yt);var cr=[].concat((0,Vn.Z)(at),(0,Vn.Z)(Tt),(0,Vn.Z)(kt),(0,Vn.Z)(Yt)),Mr=E%4*3;return[cr[Mr],cr[Mr+1],cr[Mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?5:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ni.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.shape,g=f===void 0?2:f,E=t.layer.getLayerConfig().shape2d,R=E.indexOf(g);return[R]}}})}}]),r}(Lu);function n4(e){var a=i4();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function i4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a4=`varying vec4 v_color;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"


void main() {

  gl_FragColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,o4=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;
varying float v_lightWeight;
varying float v_barLinearZ;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
uniform float u_opacitylinear: 0.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacitylinear_dir: 1.0;
uniform float  u_linearColor: 0.0;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * u_opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  // gl_Position = project_common_position_to_clipspace(pos);

  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,h3=function(e){(0,yt.Z)(r,e);var a=n4(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"raiseCount",0),(0,Pe.Z)((0,D.Z)(n),"raiseRepeat",0),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,f=t.opacity,g=f===void 0?1:f,E=t.sourceColor,R=t.targetColor,B=t.pickLight,Y=B===void 0?!1:B,Q=t.heightfixed,ce=Q===void 0?!1:Q,fe=t.opacityLinear,Te=fe===void 0?{enable:!1,dir:"up"}:fe,Ve=t.lightEnable,st=Ve===void 0?!0:Ve,at=0,Tt=[0,0,0,0],kt=[0,0,0,0];if(E&&R&&(Tt=Mo(E),kt=Mo(R),at=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Yt=u.speed,cr=Yt===void 0?.01:Yt;this.raiseCount+=cr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(Y),u_heightfixed:Number(ce),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:g,u_linearColor:at,u_sourceColor:Tt,u_targetColor:kt,u_opacitylinear:Number(Te.enable),u_opacitylinear_dir:Te.dir==="up"?1:0,u_lightEnable:Number(st)}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return u=this.layer.getLayerConfig(),f=u.depth,g=f===void 0?!0:f,E=u.animateOption.repeat,R=E===void 0?1:E,this.raiseRepeat=R,Q.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:o4,fragmentShader:a4,triangulation:TS,cull:{enable:!0,face:Hf(this.mapService.version)},depth:{enable:g}});case 4:return B=Q.sent,Q.abrupt("return",[B]);case 6:case"end":return Q.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=o.size;if(u){var f=[];return Array.isArray(u)&&(f=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(f=[u,u,u]),f}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ni.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o){var u=xo(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(Lu);function s4(e){var a=u4();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function u4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cg=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nk=`uniform float u_additive;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;


#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = v_color;
  } else {
    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,Vb=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;
uniform float u_stroke_width: 2;
uniform vec3 u_blur_height_fixed: [0, 0, 0];


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,f3=function(e){(0,yt.Z)(r,e);var a=s4(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.strokeOpacity,u=o===void 0?1:o,f=t.strokeWidth,g=f===void 0?0:f,E=t.blend,R=t.blur,B=R===void 0?0:R,Y=t.raisingHeight,Q=Y===void 0?0:Y,ce=t.heightfixed,fe=ce===void 0?!1:ce,Te=t.unit,Ve=Te===void 0?"pixel":Te;return(0,Ee.Z)({u_blur_height_fixed:[B,Number(Q),Number(fe)],u_additive:E==="additive"?1:0,u_stroke_opacity:u,u_stroke_width:g,u_size_unit:k1[Ve]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Zn)}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),f=u.animateOption,g=f===void 0?{enable:!1}:f,E=this.getShaders(g),R=E.frag,B=E.vert,Y=E.type,this.layer.triangulation=Zn,fe.next=5,this.layer.buildLayerModel({moduleName:Y,vertexShader:B,fragmentShader:R,inject:this.getInject(),triangulation:Zn,depth:{enable:!1}});case 5:return Q=fe.sent,fe.abrupt("return",[Q]);case 7:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:cg,vert:Vb,type:"pointWave"};default:return{frag:cg,vert:Vb,type:"pointWave"}}else return{frag:nk,vert:Vb,type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ni.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(u,f,g,E){var R=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],B=E%4*3;return[R[B],R[B+1],R[B+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?5:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ni.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.shape,g=f===void 0?2:f,E=t.indexOf(g);return[E]}}})}}]),r}(Lu);function l4(e){var a=Iy();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Iy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ik=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Ly=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,p3=function(e){(0,yt.Z)(r,e);var a=l4(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"meter2coord",1),(0,Pe.Z)((0,D.Z)(n),"isMeter",!1),(0,Pe.Z)((0,D.Z)(n),"radian",0),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.LINEAR,min:Ke.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,f=t.heightfixed,g=f===void 0?!1:f,E=t.unit,R=E===void 0?"pixel":E;return this.rendererService.getDirty()&&this.texture.bind(),(0,Ee.Z)({u_raisingHeight:Number(u),u_heightfixed:Number(g),u_size_unit:k1[R],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ay)}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:Ly,fragmentShader:ik,triangulation:Ay,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:Hf(this.mapService.version)}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.shape,E=f[g]||{x:-64,y:-64},R=E.x,B=E.y;return[R,B]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ni.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(u,f,g,E){var R=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],B=E%4*3;return[R[B],R[B+1],R[B+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?5:f;return Array.isArray(g)?[g[0]]:[g]}}})}}]),r}(Lu);function Gb(e){var a=c4();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function c4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h4=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,f4=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Hb=function(e){(0,yt.Z)(r,e);var a=Gb(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"updateTexture",function(){var f=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=f({data:n.iconService.getCanvas(),mag:Ke.LINEAR,min:Ke.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.offsets,g=f===void 0?[0,0]:f,E=t.raisingHeight,R=E===void 0?0:E,B=t.heightfixed,Y=B===void 0?!1:B;return this.rendererService.getDirty()&&this.texture.bind(),(0,Ee.Z)({u_raisingHeight:Number(R),u_heightfixed:Number(Y),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:f4,fragmentShader:h4,triangulation:iT,inject:this.getInject(),depth:{enable:!1},primitive:Ke.POINTS});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(u){var f=u.size,g=f===void 0?5:f;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(u){var f=t.iconService.getIconMap(),g=u.shape,E=f[g]||{x:-64,y:-64},R=E.x,B=E.y;return[R,B]}}})}}]),r}(Lu);function p4(e){var a=d4();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function d4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d3=`varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
}
`,v4=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`,ak=Ga.isNumber;function m4(e){var a=e.coordinates;return{vertices:(0,Vn.Z)(a),indices:[0],size:a.length}}var z0=function(e){(0,yt.Z)(r,e);var a=p4(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return(0,Ee.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.triangulation=m4,g.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:v4,fragmentShader:d3,triangulation:m4,inject:this.getInject(),depth:{enable:!1},primitive:Ke.POINTS,pick:!1});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0]]:[f]}}})}}]),r}(Lu);function j1(e){var a=g4();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function g4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y4=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,v3=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,_4=function(e){(0,yt.Z)(r,e);var a=j1(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.blend,g=t.speed,E=g===void 0?1:g,R=t.unit,B=R===void 0?"pixel":R;return{u_size_unit:k1[B],u_speed:E,u_additive:f==="additive"?1:0,u_opacity:u}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ay)}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:v3,fragmentShader:y4,triangulation:Ay,depth:{enable:!1}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ni.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],R=g%4*3;return[E[R],E[R+1],E[R+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?5:u;return Array.isArray(f)?[f[0]]:[f]}}})}}]),r}(Lu);function b4(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=m3(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function m3(e,a){if(e){if(typeof e=="string")return $b(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $b(e,a)}}function $b(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var x4=function(){function e(a,r,n){(0,Be.Z)(this,e),(0,Pe.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(a/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=r,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Me.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,f){this.boxCells[u].push(f)}},{key:"queryHitTest",value:function(r,n,t,o,u,f){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var E=0;E<this.boxKeys.length;E++)g.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return f?g.filter(f):g}var R={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,g,R,f),u?g.length>0:g}},{key:"queryCell",value:function(r,n,t,o,u,f,g,E){var R=g.seenUids,B=this.boxCells[u];if(B!==null){var Y=this.bboxes,Q=b4(B),ce;try{for(Q.s();!(ce=Q.n()).done;){var fe=ce.value;if(!R.box[fe]){R.box[fe]=!0;var Te=fe*4;if(r<=Y[Te+2]&&n<=Y[Te+3]&&t>=Y[Te+0]&&o>=Y[Te+1]&&(!E||E(this.boxKeys[fe]))){if(g.hitTest)return f.push(!0),!0;f.push({key:this.boxKeys[fe],x1:Y[Te],y1:Y[Te+1],x2:Y[Te+2],y2:Y[Te+3]})}}}}catch(Ve){Q.e(Ve)}finally{Q.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,f,g,E){for(var R=this.convertToXCellCoord(r),B=this.convertToYCellCoord(n),Y=this.convertToXCellCoord(t),Q=this.convertToYCellCoord(o),ce=R;ce<=Y;ce++)for(var fe=B;fe<=Q;fe++){var Te=this.xCellCount*fe+ce;if(u.call(this,r,n,t,o,Te,f,g,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),w4=x4,S4=function(){function e(a,r){(0,Be.Z)(this,e),(0,Pe.Z)(this,"viewportPadding",100),this.width=a,this.height=r,this.viewportPadding=Math.max(a,r),this.grid=new w4(a+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Me.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=Np(n,t,0,1),u=Bp(),f=Ti.apply(P,(0,Vn.Z)(r));return Jv(u,o,f),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function E4(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ok(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function ok(e,a){if(e){if(typeof e=="string")return d(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,a)}}function d(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function y(e){var a=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:a,verticalAlign:r}}function C(e,a,r,n,t){if(t){var o=e[n],u=o.glyph;if(u)for(var f=a[u].advance*o.scale,g=(e[n].x+f)*t,E=r;E<=n;E++)e[E].x-=g}}function F(e,a,r,n,t,o,u){var f=(a-r)*t,g=(-n*u+.5)*o,E=E4(e),R;try{for(E.s();!(R=E.n()).done;){var B=R.value;B.x+=f,B.y+=g}}catch(Y){E.e(Y)}finally{E.f()}}function J(e,a,r,n,t,o,u){var f=-8,g=0,E=f,R=0,B=e.positionedGlyphs,Y=o==="right"?1:o==="left"?0:.5,Q=B.length;r.forEach(function(st){if(st.split("").forEach(function(Tt){var kt=a[Tt],Yt=0;kt&&(B.push({glyph:Tt,x:g,y:E+Yt,vertical:!1,scale:1,metrics:kt}),g+=kt.advance+u)}),B.length!==Q){var at=g-u;R=Math.max(at,R),C(B,a,Q,B.length-1,Y)}g=0,E-=n+5});var ce=y(t),fe=ce.horizontalAlign,Te=ce.verticalAlign;F(B,Y,fe,Te,R,n,r.length);var Ve=E-f;e.top+=-Te*Ve,e.bottom=e.top-Ve,e.left+=-fe*R,e.right=e.left+R}function ie(e,a,r,n,t,o,u){var f=-8,g=0,E=f,R=0,B=e.positionedGlyphs,Y=o==="right"?1:o==="left"?0:.5,Q=B.length;r.forEach(function(st){var at=a[st],Tt=0;if(at&&(B.push({glyph:st,x:at.advance/2,y:E+Tt,vertical:!1,scale:1,metrics:at}),g+=at.advance+u),B.length!==Q){var kt=g-u;R=Math.max(kt,R),C(B,a,Q,B.length-1,Y)}g=0,E-=n+5});var ce=y(t),fe=ce.horizontalAlign,Te=ce.verticalAlign;F(B,Y,fe,Te,R,n,r.length);var Ve=E-f;e.top+=-Te*Ve,e.bottom=e.top-Ve,e.left+=-fe*R,e.right=e.left+R}function me(e,a,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],f=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),E=[],R={positionedGlyphs:E,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:g.length,text:e};return f?ie(R,a,g,r,n,t,o):J(R,a,g,r,n,t,o),E.length?R:!1}function ke(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=E4(t),f;try{for(u.s();!(f=u.n()).done;){var g=f.value,E=g.metrics,R=4,B=E.advance*g.scale/2,Y=r?[g.x+B,g.y]:[0,0],Q=r?[0,0]:[g.x+B+a[0],g.y+a[1]],ce=(0-R)*g.scale-B+Q[0],fe=(0-R)*g.scale+Q[1],Te=ce+E.width*g.scale,Ve=fe+E.height*g.scale,st={x:ce,y:fe},at={x:Te,y:fe},Tt={x:ce,y:Ve},kt={x:Te,y:Ve};o.push({tl:st,tr:at,bl:Tt,br:kt,tex:E,glyphOffset:Y})}}catch(Yt){u.e(Yt)}finally{u.f()}return o}function je(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=et(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function et(e,a){if(e){if(typeof e=="string")return bt(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bt(e,a)}}function bt(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function Mt(e){var a=sr();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function sr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kt=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,vr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,Sr=Ga.isEqual;function Ar(e){var a=this,r=e.id,n=[],t=[];if(!a.glyphInfoMap||!a.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[r].glyphQuads.forEach(function(f,g){n.push.apply(n,(0,Vn.Z)(u).concat([f.tex.x,f.tex.y+f.tex.height,f.tl.x,f.tl.y],(0,Vn.Z)(u),[f.tex.x+f.tex.width,f.tex.y+f.tex.height,f.tr.x,f.tr.y],(0,Vn.Z)(u),[f.tex.x+f.tex.width,f.tex.y,f.br.x,f.br.y],(0,Vn.Z)(u),[f.tex.x,f.tex.y,f.bl.x,f.bl.y])),t.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:t,size:7}}var jr=function(e){(0,yt.Z)(r,e);var a=Mt(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"glyphInfoMap",{}),(0,Pe.Z)((0,D.Z)(n),"currentZoom",-1),(0,Pe.Z)((0,D.Z)(n),"textureHeight",0),(0,Pe.Z)((0,D.Z)(n),"textCount",0),(0,Pe.Z)((0,D.Z)(n),"preTextStyle",{}),(0,Pe.Z)((0,D.Z)(n),"mapping",(0,mr.Z)(x().mark(function f(){return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n.initGlyph(),n.updateTexture(),E.next=4,n.reBuildModel();case 4:case"end":return E.stop()}},f)}))),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.stroke,u=o===void 0?"#fff":o,f=t.strokeWidth,g=f===void 0?0:f,E=t.halo,R=E===void 0?.5:E,B=t.gamma,Y=B===void 0?2:B,Q=t.raisingHeight,ce=Q===void 0?0:Q,fe=this.getFontServiceMapping(),Te=this.getFontServiceCanvas();return fe&&Object.keys(fe).length!==this.textCount&&Te&&(this.updateTexture(),this.textCount=Object.keys(fe).length),this.preTextStyle=this.getTextStyle(),(0,Ee.Z)({u_raisingHeight:Number(ce),u_stroke_width:g,u_stroke_color:Mo(u),u_sdf_map:this.texture,u_halo_blur:R,u_gamma_scale:Y,u_sdf_map_size:[(Te==null?void 0:Te.width)||1,(Te==null?void 0:Te.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),f.abrupt("return",this.buildModels());case 5:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),f=u.textAllowOverlap,g=f===void 0?!1:f,this.initGlyph(),this.updateTexture(),g||this.filterGlyphs(),B.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:vr,fragmentShader:Kt,inject:this.getInject(),triangulation:Ar.bind(this),depth:{enable:!1}});case 6:return E=B.sent,B.abrupt("return",[E]);case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q,ce,fe,Te,Ve;return x().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:if(u=this.getTextStyle(),f=u.textAllowOverlap,g=f===void 0?!1:f,E=u.textAnchor,R=E===void 0?"center":E,B=u.textOffset,Y=u.padding,Q=u.fontFamily,ce=u.fontWeight,!(!Sr(Y,this.preTextStyle.padding)||!Sr(B,this.preTextStyle.textOffset)||!Sr(R,this.preTextStyle.textAnchor)||!Sr(Q,this.preTextStyle.fontFamily)||!Sr(ce,this.preTextStyle.fontWeight))){at.next=5;break}return at.next=4,this.mapping();case 4:return at.abrupt("return",!0);case 5:if(!g){at.next=7;break}return at.abrupt("return",!1);case 7:if(fe=this.mapService.getZoom(),Te=this.mapService.getBounds(),Ve=Tf(this.extent,Te),!(Math.abs(this.currentZoom-fe)>.5||!Ve||g!==this.preTextStyle.textAllowOverlap)){at.next=14;break}return at.next=13,this.reBuildModel();case 13:return at.abrupt("return",!0);case 14:return at.abrupt("return",!1);case 15:case"end":return at.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ni.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?12:u;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ni.Attribute,descriptor:{name:"a_tex",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return ff(t,.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,f=this.rawEncodeData,g=[];f.forEach(function(E){var R=E.shape,B=R===void 0?"":R;B=B.toString();var Y=je(B),Q;try{for(Y.s();!(Q=Y.n()).done;){var ce=Q.value;g.indexOf(ce)===-1&&g.push(ce)}}catch(fe){Y.e(fe)}finally{Y.f()}}),this.fontService.setFontOptions({characterSet:g,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,f=this.rawEncodeData,g=[];f.forEach(function(E){var R=E.shape,B=R===void 0?"":R;B="".concat(B),g.indexOf(B)===-1&&g.push(B)}),this.fontService.setFontOptions({characterSet:g,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,f=t.fontFamily,g=f===void 0?"sans-serif":f,E=t.textAllowOverlap,R=E===void 0?!1:E,B=t.padding,Y=B===void 0?[0,0]:B,Q=t.textAnchor,ce=Q===void 0?"center":Q,fe=t.textOffset,Te=fe===void 0?[0,0]:fe,Ve=t.opacity,st=Ve===void 0?1:Ve,at=t.strokeOpacity,Tt=at===void 0?1:at,kt=t.strokeWidth,Yt=kt===void 0?0:kt,cr=t.stroke,Mr=cr===void 0?"#000":cr;return{fontWeight:u,fontFamily:g,textAllowOverlap:R,padding:Y,textAnchor:ce,textOffset:Te,opacity:st,strokeOpacity:Tt,strokeWidth:Yt,stroke:Mr}}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.getFontServiceMapping(),f=this.layer.getLayerConfig(),g=f.spacing,E=g===void 0?2:g,R=f.textAnchor,B=R===void 0?"center":R,Y=f.textOffset,Q=this.rawEncodeData;this.glyphInfo=Q.map(function(ce){var fe=ce.shape,Te=fe===void 0?"":fe,Ve=ce.id,st=ce.size,at=st===void 0?1:st,Tt=ce.textOffset?ce.textOffset:Y||[0,0],kt=ce.textAnchor?ce.textAnchor:B||"center",Yt=me(Te.toString(),u,at,kt,"left",E,Tt,t),cr=ke(Yt,Tt,!1);return ce.shaping=Yt,ce.glyphQuads=cr,ce.centroid=xo(ce.coordinates),ce.originCentroid=ce.version==="GAODE2.x"?xo(ce.originCoordinates):ce.originCentroid=ce.centroid,o.glyphInfoMap[Ve]={shaping:Yt,glyphQuads:cr,centroid:xo(ce.coordinates)},ce})}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,f=t.fontFamily,g=f===void 0?"sans-serif":f;return this.fontService.getMappingByKey("".concat(g,"_").concat(u))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,f=t.fontFamily,g=f===void 0?"sans-serif":f;return this.fontService.getCanvasByKey("".concat(g,"_").concat(u))}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,f=u===void 0?[0,0]:u,g=o.textAllowOverlap,E=g===void 0?!1:g;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var R=this.rendererService.getViewportSize(),B=R.width,Y=R.height,Q=new S4(B,Y),ce=this.glyphInfo.filter(function(fe){var Te=fe.shaping,Ve=fe.id,st=Ve===void 0?0:Ve,at=fe.version==="GAODE2.x"?fe.originCentroid:fe.centroid,Tt=fe.size,kt=Tt/16,Yt=t.mapService.lngLatToContainer(at),cr=Q.placeCollisionBox({x1:Te.left*kt-f[0],x2:Te.right*kt+f[0],y1:Te.top*kt-f[1],y2:Te.bottom*kt+f[1],anchorPointX:Yt.x,anchorPointY:Yt.y}),Mr=cr.box;return Mr&&Mr.length?(Q.insertCollisionBox(Mr,st),!0):!1});ce.forEach(function(fe){t.glyphInfoMap[fe.id]=fe})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:Ke.LINEAR,min:Ke.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.filterGlyphs(),g.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:vr,fragmentShader:Kt,triangulation:Ar.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:u=g.sent,this.layer.models=[u];case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Lu),Kr={fillImage:p3,fill:f3,radar:_4,image:Hb,normal:z0,simplePoint:qM,extrude:h3,text:jr,earthFill:r4,earthExtrude:u3},Tn=Kr;function En(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ui(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function ui(e,a){if(e){if(typeof e=="string")return ai(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ai(e,a)}}function ai(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function Bn(e){var a=bi();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function bi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zi=function(e){(0,yt.Z)(r,e);var a=Bn(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","PointLayer"),(0,Pe.Z)((0,D.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","rotation"]),(0,Pe.Z)((0,D.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new Tn[u](this),g.next=5,this.initLayerModels();case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.buildModels();case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,f=this.getLayerConfig(),g=f.shape2d,E=this.iconService.getIconMap();if(o&&(g==null?void 0:g.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var R=En(u),B;try{for(R.s();!(B=R.n()).done;){var Y=B.value;if(typeof Y=="string"&&E.hasOwnProperty(Y))return"image"}}catch(Q){R.e(Q)}finally{R.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,f=o.shape3d,g=o.billboard,E=g===void 0?!0:g,R=this.iconService.getIconMap(),B=t.find(function(Q){return Q.hasOwnProperty("shape")});if(B){var Y=B.shape;return Y==="dot"?"normal":Y==="simple"?"simplePoint":Y==="radar"?"radar":this.layerType==="fillImage"||E===!1?"fillImage":(u==null?void 0:u.indexOf(Y))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(f==null?void 0:f.indexOf(Y))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":R.hasOwnProperty(Y)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(kd);function ei(e){var a=mi();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function mi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $t=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,vt=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,Lt=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,Or=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Cr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,In=function(e){(0,yt.Z)(r,e);var a=ei(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.heightfixed,u=o===void 0?!1:o,f=t.raisingHeight,g=f===void 0?0:f,E=t.topsurface,R=E===void 0?!0:E,B=t.sidesurface,Y=B===void 0?!0:B,Q=t.sourceColor,ce=t.targetColor,fe=0,Te=[1,1,1,1],Ve=[1,1,1,1];return Q&&ce&&(Te=Mo(Q),Ve=Mo(ce),fe=1),(0,Ee.Z)({u_topsurface:Number(R),u_sidesurface:Number(Y),u_heightfixed:Number(u),u_raisingHeight:Number(g),u_linearColor:fe,u_sourceColor:Te,u_targetColor:Ve,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.loadTexture();case 2:return f.abrupt("return",this.buildModels());case 3:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return u=this.getShaders(),f=u.frag,g=u.vert,E=u.type,Y.next=3,this.layer.buildLayerModel({moduleName:E,vertexShader:g,fragmentShader:f,inject:this.getInject(),triangulation:Mb});case 3:return R=Y.sent,Y.abrupt("return",[R]);case 5:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:Lt,vert:yr,type:"polygonExtrudeTexture"}:o?{frag:Or,vert:Cr,type:"polygonExtrudePickLight"}:{frag:$t,vert:vt,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=t,u=this.layer.coordCenter||this.layer.getSource().center,f=o[2]-o[0],g=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var E=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],u),R=(0,gi.Z)(E,2),B=R[0],Y=R[1],Q=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],u),ce=(0,gi.Z)(Q,2),fe=ce[0],Te=ce[1];f=fe-B,g=Te-Y,o=[B,Y,fe,Te]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Ni.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(st,at,Tt){var kt=Tt[0],Yt=Tt[1];return[(kt-o[0])/f,(Yt-o[1])/g,Tt[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(st,at,Tt,kt,Yt){return Yt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(st){var at=st.size,Tt=at===void 0?10:at;return Array.isArray(Tt)?[Tt[0]]:[Tt]}}})}},{key:"loadTexture",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(f=this.layer.getLayerConfig(),g=f.mapTexture,E=this.rendererService.createTexture2D,this.texture=E({height:0,width:0}),!g){B.next=5;break}return B.abrupt("return",new Promise(function(Y,Q){var ce=new Image;ce.crossOrigin="anonymous",ce.src=g,ce.onload=function(){return u.texture=E({data:ce,width:ce.width,height:ce.height,wrapS:Ke.CLAMP_TO_EDGE,wrapT:Ke.CLAMP_TO_EDGE,min:Ke.LINEAR,mag:Ke.LINEAR}),Y(null)},ce.onerror=function(){Q(new Error("image load error"))}}));case 5:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Lu);function Mi(e){var a=Ki();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Ki(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yo=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Va=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,Co=function(e){(0,yt.Z)(r,e);var a=Mi(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){return(0,Ee.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return u=this.getShaders(),f=u.frag,g=u.vert,E=u.type,Y.next=3,this.layer.buildLayerModel({moduleName:E,vertexShader:g,fragmentShader:f,inject:this.getInject(),triangulation:Mb});case 3:return R=Y.sent,Y.abrupt("return",[R]);case 5:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:Yo,vert:Va,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?10:u;return Array.isArray(f)?[f[0]]:[f]}}})}}]),r}(Lu);function kl(e){var a=cu();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bc=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,El=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,fo=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,qa=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,_o=function(e){(0,yt.Z)(r,e);var a=kl(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,f=t.opacityLinear,g=f===void 0?{enable:!1,dir:"in"}:f;return(0,Ee.Z)({u_raisingHeight:Number(u),u_opacitylinear:Number(g.enable),u_dir:g.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return u=this.getModelParams(),f=u.frag,g=u.vert,E=u.triangulation,R=u.type,this.layer.triangulation=E,Q.next=4,this.layer.buildLayerModel({moduleName:R,vertexShader:g,fragmentShader:f,inject:this.getInject(),triangulation:E,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 4:return B=Q.sent,Q.abrupt("return",[B]);case 6:case"end":return Q.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ni.Attribute,descriptor:{name:"a_linear",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(g,E,R){return[R[3],R[4],R[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:El,vert:fo,type:"polygonLinear",triangulation:uT}:{frag:Bc,vert:qa,type:"polygonFill",triangulation:ri}}}]),r}(Lu);function Is(e){var a=xs();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var no=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,ps=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,wu=Ga.isNumber,$u=function(e){(0,yt.Z)(r,e);var a=Is(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.watercolor,g=f===void 0?"#6D99A8":f,E=t.watercolor2,R=E===void 0?"#0F121C":E;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Mo(g),u_watercolor2:Mo(R),u_opacity:wu(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.loadTexture(),f.abrupt("return",this.buildModels());case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:ps,fragmentShader:no,triangulation:Tb,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,gi.Z)(t,4),u=o[0],f=o[1],g=o[2],E=o[3],R=g-u,B=E-f;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Ni.Attribute,descriptor:{name:"a_uv",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(Q,ce,fe,Te){var Ve=Q.version===ip["GAODE2.x"]?Q.originCoordinates[0][Te]:fe,st=(0,gi.Z)(Ve,2),at=st[0],Tt=st[1];return[(at-u)/R,(Tt-f)/B]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),f(function(E){t.texture1=g(E[0]),t.texture2=g(E[1]),t.texture3=g(E[2]),t.layerService.reRender()});function f(E){var R=0,B=[],Y=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];Y.map(function(Q){var ce=new Image;ce.crossOrigin="",ce.src=Q,B.push(ce),ce.onload=function(){R++,R===3&&E(B)}})}function g(E){return o({data:E,width:E.width,height:E.height,wrapS:Ke.MIRRORED_REPEAT,wrapT:Ke.MIRRORED_REPEAT,min:Ke.LINEAR,mag:Ke.LINEAR})}}}]),r}(Lu);function ol(e){var a=ds();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function ds(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ks=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,ru=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,Ru=Ga.isNumber,Js=function(e){(0,yt.Z)(r,e);var a=ol(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.speed,g=f===void 0?.5:f;return{u_texture:this.texture,u_speed:g,u_opacity:Ru(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.loadTexture(),f.abrupt("return",this.buildModels());case 2:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:ru,fragmentShader:Ks,triangulation:Tb,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,gi.Z)(t,4),u=o[0],f=o[1],g=o[2],E=o[3],R=g-u,B=E-f;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Ni.Attribute,descriptor:{name:"a_uv",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(Q,ce,fe,Te){var Ve=Q.version===ip["GAODE2.x"]?Q.originCoordinates[0][Te]:fe,st=(0,gi.Z)(Ve,2),at=st[0],Tt=st[1];return[(at-u)/R,(Tt-f)/B]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,f=this.rendererService.createTexture2D;this.texture=f({height:0,width:0});var g=new Image;g.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=u):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){t.texture=f({data:g,width:g.width,height:g.height,wrapS:Ke.MIRRORED_REPEAT,wrapT:Ke.MIRRORED_REPEAT,min:Ke.LINEAR,mag:Ke.LINEAR}),t.layerService.reRender()}}}]),r}(Lu),Nc={fill:_o,line:r3,extrude:In,text:jr,point_fill:f3,point_image:Hb,point_normal:z0,point_extrude:h3,water:Js,ocean:$u,extrusion:Co},Vp=Nc;function jh(e){var a=hu();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function hu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mh=function(e){(0,yt.Z)(r,e);var a=jh(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","PolygonLayer"),(0,Pe.Z)((0,D.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new Vp[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"||!u?"fill":u==="extrude"?"extrude":u==="extrusion"?"extrusion":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,f=o.shape3d,g=this.iconService.getIconMap(),E=t.find(function(B){return B.hasOwnProperty("shape")});if(E){var R=E.shape;return R==="dot"?"point_normal":(u==null?void 0:u.indexOf(R))!==-1?"point_fill":(f==null?void 0:f.indexOf(R))!==-1?"point_extrude":g.hasOwnProperty(R)?"point_image":"text"}else return"fill"}}]),r}(kd);function Qc(e){var a=Bl();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zf=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,Cl=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,Qp=function(e){(0,yt.Z)(r,e);var a=Qc(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.clampLow,g=f===void 0?!0:f,E=t.clampHigh,R=E===void 0?!0:E,B=t.noDataValue,Y=B===void 0?-9999999:B,Q=t.domain,ce=t.rampColors,fe=Q||vu(ce);return this.colorTexture=this.layer.textureService.getColorTexture(ce,fe),{u_opacity:u||1,u_texture:this.texture,u_domain:fe,u_clampLow:g,u_clampHigh:typeof R!="undefined"?R:g,u_noDataValue:Y,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!Array.isArray(u.data)){Y.next=4;break}return Y.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return Y.next=6,u.data;case 6:return f=Y.sent,g=f.rasterData,E=f.width,R=f.height,Y.abrupt("return",{data:Array.from(g),width:E,height:R});case 11:case"end":return Y.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getSource(),f=this.rendererService.createTexture2D,g=u.data.dataArray[0],fe.next=5,this.getRasterData(g);case 5:return E=fe.sent,R=E.data,B=E.width,Y=E.height,this.texture=f({data:R,width:B,height:Y,format:Ke.LUMINANCE,type:Ke.FLOAT}),fe.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:Cl,fragmentShader:Zf,triangulation:Ty,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 12:return Q=fe.sent,fe.abrupt("return",[Q]);case 14:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu),ed=["data"],hv=["rasterData"];function td(e){var a=Uf();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jf=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,Vf=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,Mc=function(e){(0,yt.Z)(r,e);var a=td(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"dataOption",{}),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.noDataValue,g=f===void 0?0:f,E=this.dataOption,R=E.rMinMax,B=E.gMinMax,Y=E.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:g,u_rminmax:R,u_gminmax:B,u_bminmax:Y}}},{key:"getRasterData",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f,g,E,R,B;return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!Array.isArray(u.data)){Q.next=4;break}return f=u.data,g=(0,Uh.Z)(u,ed),this.dataOption=g,Q.abrupt("return",(0,Ee.Z)({data:f},g));case 4:return Q.next=6,u.data;case 6:if(E=Q.sent,R=E.rasterData,B=(0,Uh.Z)(E,hv),this.dataOption=B,!Array.isArray(R)){Q.next=14;break}return Q.abrupt("return",(0,Ee.Z)({data:R},B));case 14:return Q.abrupt("return",(0,Ee.Z)({data:Array.from(R)},B));case 15:case"end":return Q.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getSource(),f=this.rendererService.createTexture2D,g=u.data.dataArray[0],fe.next=5,this.getRasterData(g);case 5:return E=fe.sent,R=E.data,B=E.width,Y=E.height,this.texture=f({data:R,width:B,height:Y,format:Ke.RGB,type:Ke.FLOAT}),fe.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:jf,fragmentShader:Vf,triangulation:Ty,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 12:return Q=fe.sent,fe.abrupt("return",[Q]);case 14:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function Nv(e){var a=yd();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function yd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gp=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,ac=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,oc=function(e){(0,yt.Z)(r,e);var a=Nv(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,f=u===void 0?!0:u,g=t.clampHigh,E=g===void 0?!0:g,R=t.noDataValue,B=R===void 0?-9999999:R,Y=t.domain,Q=t.rampColors,ce=t.colorTexture,fe=t.rScaler,Te=fe===void 0?6553.6:fe,Ve=t.gScaler,st=Ve===void 0?25.6:Ve,at=t.bScaler,Tt=at===void 0?.1:at,kt=t.offset,Yt=kt===void 0?1e4:kt,cr=Y||vu(Q),Mr=ce;return ce?this.layer.textureService.setColorTexture(ce,Q,cr):Mr=this.layer.textureService.getColorTexture(Q,cr),{u_opacity:o||1,u_texture:this.texture,u_domain:cr,u_clampLow:f,u_clampHigh:typeof E!="undefined"?E:f,u_noDataValue:B,u_unpack:[Te,st,Tt,Yt],u_colorTexture:Mr}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getSource(),f=this.rendererService.createTexture2D,B.next=4,u.data.images;case 4:return g=B.sent,this.texture=f({data:g[0],width:g[0].width,height:g[0].height,min:Ke.LINEAR,mag:Ke.LINEAR}),B.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:ac,fragmentShader:Gp,triangulation:Ty,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 8:return E=B.sent,B.abrupt("return",[E]);case 10:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu),sc={raster:Qp,rasterRgb:Mc,raster3d:Qp,rasterTerrainRgb:oc},rd=sc;function Ls(e){var a=ju();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function ju(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pa=function(e){(0,yt.Z)(r,e);var a=Ls(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","RasterLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new rd[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(kd);function No(e){var a=co();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bs=function(e){(0,yt.Z)(r,e);var a=No(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","TileDebugLayer"),(0,Pe.Z)((0,D.Z)(n),"zIndex",1e4),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return");case 1:case"end":return f.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(kd);function Nl(e){var a=Zl();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Zl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _d=`
uniform float u_opacity;
uniform vec3 u_CameraPosition;

varying vec3 vVertexNormal;
varying float v_offset;
varying vec4 v_Color;
void main() {
    
    
    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
    // \u53BB\u9664\u80CC\u9762
    if(intensity > 1.0) intensity = 0.0;

    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,bd=`
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute vec2 a_Uv;
attribute vec4 a_Color;
uniform vec3 u_CameraPosition;
varying float v_CamreaDistance;

uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_ViewMatrix;

varying vec3 vVertexNormal;
varying vec4 v_Color;
varying float v_offset;

void main() {
    float EARTH_RADIUS = 100.0;
    
    v_Color = a_Color;

    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);
    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,nd=Ga.isNumber,gh=function(e){(0,yt.Z)(r,e);var a=Nl(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:nd(u)?u:1}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.zIndex=-997,g.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:bd,fragmentShader:_d,triangulation:RS,depth:{enable:!1},blend:this.getBlend()});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function id(e){var a=Id();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Id(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rm=`
uniform sampler2D u_texture;

varying vec2 v_texCoord;
varying float v_lightWeight;


void main() {

    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
    color.xyz = color.xyz * v_lightWeight;
    gl_FragColor = color;
}
`,Rs=`// attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

// attribute vec2 a_Extrude;
// attribute float a_Size;
// attribute float a_Shape;

uniform vec3 u_CameraPosition;
uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;
uniform float u_ambientRatio : 0.5;
uniform float u_diffuseRatio : 0.3;
uniform float u_specularRatio : 0.2;
uniform vec3 u_sunLight: [1.0, -10.5, 12.0];



float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;

    // cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(u_sunLight);

    vec3 halfDir = normalize(viewDir+lightDir);
    // lambert
    float lambert = dot(worldNormal, lightDir);
    // specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
    //sum to light weight
    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;

    return lightWeight;
}

varying float v_lightWeight;
void main() {

    v_texCoord = a_Uv;

    float lightWeight = calc_lighting(vec4(a_Position, 1.0));
    v_lightWeight = lightWeight;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,es=function(e){(0,yt.Z)(r,e);var a=id(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"earthTime",3.4),(0,Pe.Z)((0,D.Z)(n),"sunX",1e3),(0,Pe.Z)((0,D.Z)(n),"sunY",1e3),(0,Pe.Z)((0,D.Z)(n),"sunZ",1e3),(0,Pe.Z)((0,D.Z)(n),"sunRadius",Math.sqrt(n.sunX*n.sunX+n.sunY*n.sunY+n.sunZ*n.sunZ)),n}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=t.globalOptions;return o!=null&&o.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(u==null?void 0:u.ambientRatio)||.6,u_diffuseRatio:(u==null?void 0:u.diffuseRatio)||.4,u_specularRatio:(u==null?void 0:u.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return f=this.layer.getLayerConfig(),g=f.globalOptions,(g==null?void 0:g.earthTime)!==void 0&&this.setEarthTime(g.earthTime),E=this.layer.getSource(),R=this.rendererService.createTexture2D,this.texture=R({height:0,width:0}),E.data.images.then(function(Q){u.texture=R({data:Q[0],width:Q[0].width,height:Q[0].height}),u.layerService.reRender()}),Y.abrupt("return",this.buildModels());case 7:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.zIndex=-998,g.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:Rs,fragmentShader:rm,triangulation:RS,depth:{enable:!0},blend:this.getBlend()});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function nu(e){var a=Gf();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uc=`
uniform float u_opacity;
uniform vec3 u_CameraPosition;
varying vec3 vVertexNormal;

varying vec4 v_Color;
void main() {


    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));
    // \u53BB\u9664\u80CC\u9762
    if(intensity > 1.0) intensity = 0.0;

    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,zg=`
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute vec2 a_Uv;
attribute vec4 a_Color;
uniform vec3 u_CameraPosition;
uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_ViewMatrix;

varying vec3 vVertexNormal;
varying vec4 v_Color;

void main() {
    v_Color = a_Color;

    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,Cm=Ga.isNumber,Bg=function(e){(0,yt.Z)(r,e);var a=nu(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:Cm(u)?u:1}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.layer.zIndex=-999,g.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:zg,fragmentShader:uc,triangulation:DS,depth:{enable:!1},blend:this.getBlend()});case 3:return u=g.sent,g.abrupt("return",[u]);case 5:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ni.Attribute,descriptor:{name:"a_Size",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(o){var u=o.size,f=u===void 0?1:u;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ni.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Ke.STATIC_DRAW,data:[],type:Ke.FLOAT},size:3,update:function(o,u,f,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}}]),r}(Lu);function Ng(e){var a=nm();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function nm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Am={base:es,atomSphere:gh,bloomSphere:Bg},Ry=["base","atomSphere","bloomSphere"],Ym=function(e){(0,yt.Z)(r,e);var a=Ng(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","EarthLayer"),(0,Pe.Z)((0,D.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new Am[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(t):console.warn("\u8BF7\u5728 scene loaded \u4E4B\u540E\u6267\u884C\u8BE5\u65B9\u6CD5\uFF01")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"base";return Ry.indexOf(u)<0&&(u="base"),u}}]),r}(kd);function i0(e){var a=Zg();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Zg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var im=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,hg=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Ug=Ga.isNumber,jg=function(e){(0,yt.Z)(r,e);var a=i0(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,f=t.color,g=f===void 0?"#000":f;return{u_opacity:Ug(u)?u:0,u_color:Mo(g)}}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.buildModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:hg,fragmentShader:im,triangulation:Tb,depth:{enable:!1},pick:!1});case 2:return u=g.sent,g.abrupt("return",[u]);case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Lu),Tm={fill:jg},a0=Tm;function Mm(e){var a=Tu();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fu=function(e){(0,yt.Z)(r,e);var a=Mm(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","MaskLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new a0[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(kd);function ap(e,a,r){var n=ad(e,e.VERTEX_SHADER,a),t=ad(e,e.FRAGMENT_SHADER,r);if(!n||!t)return null;var o=e.createProgram();if(!o)return null;e.attachShader(o,n),e.attachShader(o,t),e.linkProgram(o);var u=e.getProgramParameter(o,e.LINK_STATUS);if(!u){var f=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+f),e.deleteProgram(o),e.deleteShader(t),e.deleteShader(n),null}for(var g=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),E=0;E<g;E++){var R=e.getActiveAttrib(o,E);o[R.name]=e.getAttribLocation(o,R.name)}for(var B=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),Y=0;Y<B;Y++){var Q=e.getActiveUniform(o,Y);o[Q.name]=e.getUniformLocation(o,Q.name)}return o.vertexShader=n,o.fragmentShader=t,o}function ad(e,a,r){var n=e.createShader(a);if(n==null)return console.warn("unable to create shader"),null;e.shaderSource(n,r),e.compileShader(n);var t=e.getShaderParameter(n,e.COMPILE_STATUS);if(!t){var o=e.getShaderInfoLog(n);return console.warn("Failed to compile shader: "+o),e.deleteShader(n),null}return n}function Yl(e,a,r,n,t){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),o}function Ld(e,a,r){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),n}function xd(e,a,r){e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,a)}function Pm(e,a){var r=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,a,e.STATIC_DRAW),r}function am(e,a,r,n,t){var o=e.createBuffer();o||console.warn("failed create vertex buffer"),e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);var u=e.getAttribLocation(t,a);return e.vertexAttribPointer(u,n,e.FLOAT,!1,0,0),e.enableVertexAttribArray(u),e.bindBuffer(e.ARRAY_BUFFER,null),{buffer:o,attr:u,count:n}}function fg(e,a){var r=e.createBuffer();return r?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,e.STATIC_DRAW)):console.warn("failed create vertex buffer"),r}function km(e,a,r,n,t){var o=e.getUniformLocation(n,a);return o===null||o<0?console.warn("\u65E0\u6CD5\u83B7\u53D6 uniform \u53D8\u91CF\u7684\u5B58\u50A8\u4F4D\u7F6E"):o0(e,o,r,t),o}function o0(e,a,r,n){switch(n){case"float":e.uniform1f(a,r);break;case"vec2":e.uniform2fv(a,r);break;case"vec3":e.uniform3fv(a,r);break;case"vec4":e.uniform4fv(a,r);break;case"bool":e.uniform1i(a,r);break;case"sampler2d":break;case"mat4":e.uniformMatrix4fv(a,!1,r);break}}function g3(e){var a=e.drawingBufferWidth,r=e.drawingBufferHeight,n=a,t=r,o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o);var u=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,u),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,u);var f=e.createTexture();return o.texture=f,o.width=n,o.height=t,e.bindTexture(e.TEXTURE_2D,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),{FRAMEBUFFER:o,OFFER_SCREEN_WIDTH:n,OFFER_SCREEN_HEIGHT:t}}var om=`
 precision mediump float;

 attribute float a_index;

 uniform sampler2D u_particles;
 uniform float u_particles_res;

 varying vec2 v_particle_pos;

 void main() {
     vec4 color = texture2D(u_particles, vec2(
         fract(a_index / u_particles_res),
         floor(a_index / u_particles_res) / u_particles_res)
     );

     // decode current particle position from the pixel's RGBA value
     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);

     gl_PointSize = 1.0;
     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);
 }`,V1=`
 precision mediump float;

 uniform sampler2D u_wind;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform sampler2D u_color_ramp;

 varying vec2 v_particle_pos;

 void main() {
     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);
     float speed_t = length(velocity) / length(u_wind_max);

     // color ramp is encoded in a 16x16 texture
     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);

     gl_FragColor = texture2D(u_color_ramp, ramp_pos);
 }`,pg=`
 precision mediump float;

 attribute vec2 a_pos;

 varying vec2 v_tex_pos;

 void main() {
     v_tex_pos = a_pos;
     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);
     // framebuffer \u59CB\u7EC8\u7528\u94FA\u6EE1\u5C4F\u5E55\u7684 texture
 }`,s0=`
 precision highp float;

 uniform sampler2D u_particles;
 uniform sampler2D u_wind;
 uniform vec2 u_wind_res;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform float u_rand_seed;
 uniform float u_speed_factor;
 uniform float u_drop_rate;
 uniform float u_drop_rate_bump;

 varying vec2 v_tex_pos;

 // pseudo-random generator
 const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);
 float rand(const vec2 co) {
 float t = dot(rand_constants.xy, co);
     return fract(sin(t) * (rand_constants.z + t));
 }

 // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation
 vec2 lookup_wind(const vec2 uv) {
     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering
     vec2 px = 1.0 / u_wind_res;
     vec2 vc = (floor(uv * u_wind_res)) * px;
     vec2 f = fract(uv * u_wind_res);
     vec2 tl = texture2D(u_wind, vc).rg;
     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;
     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;
     vec2 br = texture2D(u_wind, vc + px).rg;
     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);
 }

 void main() {
     vec4 color = texture2D(u_particles, v_tex_pos);
     vec2 pos = vec2(
         color.r / 255.0 + color.b,
         color.g / 255.0 + color.a); // decode particle position from pixel RGBA
     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));
     float speed_t = length(velocity) / length(u_wind_max);

     // take EPSG:4236 distortion into account for calculating where the particle moved
     float distortion = cos(radians(pos.y * 180.0 - 90.0));
     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;

     // update particle position, wrapping around the date line
     pos = fract(1.0 + pos + offset);

     // a random seed to use for the particle drop
     vec2 seed = (pos + v_tex_pos) * u_rand_seed;

     // drop rate is a chance a particle will restart at random position, to avoid degeneration
     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;
     float drop = step(1.0 - drop_rate, rand(seed));

     vec2 random_pos = vec2(
         rand(seed + 1.3),
         rand(seed + 2.1));
         pos = mix(pos, random_pos, drop);

     // encode the new particle position back into RGBA
     gl_FragColor = vec4(
         fract(pos * 255.0),
         floor(pos * 255.0) / 255.0);
 }`,B0=`
     precision mediump float;

     attribute vec2 a_pos;

     varying vec2 v_tex_pos;

     void main() {
         v_tex_pos = a_pos;
         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);
         gl_PointSize = 100.0;
 }`,N0=`
 precision mediump float;

 uniform sampler2D u_screen;
 uniform float u_opacity;
 varying vec2 v_tex_pos;

 void main() {
     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);

     // a hack to guarantee opacity fade out even with a value close to 1.0
     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);
 }`;function Z0(e){var a=document.createElement("canvas"),r=a.getContext("2d");a.width=256,a.height=1;for(var n=r.createLinearGradient(0,0,256,0),t=0,o=Object.keys(e);t<o.length;t++){var u=o[t];n.addColorStop(+u,e[+u])}return r.fillStyle=n,r.fillRect(0,0,256,1),a=null,new Uint8Array(r.getImageData(0,0,256,1).data)}function U0(e,a,r,n){e.bindBuffer(e.ARRAY_BUFFER,a),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,n,e.FLOAT,!1,0,0)}function u0(e,a,r){e.bindFramebuffer(e.FRAMEBUFFER,a),r&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}var Wb=function(){function e(a){(0,Be.Z)(this,e),(0,Pe.Z)(this,"width",512),(0,Pe.Z)(this,"height",512),(0,Pe.Z)(this,"numParticles",65536),this.gl=a.glContext,this.width=a.imageWidth,this.height=a.imageHeight,this.fadeOpacity=a.fadeOpacity,this.speedFactor=a.speedFactor,this.dropRate=a.dropRate,this.dropRateBump=a.dropRateBump,this.rampColors=a.rampColors,this.init()}return(0,Me.Z)(e,[{key:"init",value:function(){var r=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=ap(r,om,V1),this.fullScreenProgram=ap(r,B0,N0),this.updateProgram=ap(r,pg,s0),this.quadBuffer=Pm(r,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=r.createFramebuffer(),this.colorRampTexture=Yl(this.gl,this.gl.LINEAR,Z0(this.rampColors),16,16);var n=new Uint8Array(this.width*this.height*4);this.backgroundTexture=Yl(r,r.NEAREST,n,this.width,this.height),this.screenTexture=Yl(r,r.NEAREST,n,this.width,this.height);var t=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=t*t;for(var o=new Uint8Array(this.numParticlesSize*4),u=0;u<o.length;u++)o[u]=Math.floor(Math.random()*256);this.particleStateTexture0=Yl(r,r.NEAREST,o,t,t),this.particleStateTexture1=Yl(r,r.NEAREST,o,t,t);for(var f=new Float32Array(this.numParticlesSize),g=0;g<this.numParticlesSize;g++)f[g]=g;this.particleIndexBuffer=Pm(r,f)}},{key:"setWind",value:function(r){this.windData=r,this.windTexture=Ld(this.gl,this.gl.LINEAR,r.image)}},{key:"updateParticelNum",value:function(r){var n=this.gl;if(r!==this.numParticles){this.numParticles=r;var t=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=t*t;for(var o=new Uint8Array(this.numParticlesSize*4),u=0;u<o.length;u++)o[u]=Math.floor(Math.random()*256);this.particleStateTexture0=Yl(n,n.NEAREST,o,t,t),this.particleStateTexture1=Yl(n,n.NEAREST,o,t,t);for(var f=new Float32Array(this.numParticlesSize),g=0;g<this.numParticlesSize;g++)f[g]=g;this.particleIndexBuffer=Pm(n,f)}}},{key:"updateWindDir",value:function(r,n,t,o){this.windData.uMin=r,this.windData.uMax=n,this.windData.vMin=t,this.windData.vMax=o}},{key:"updateColorRampTexture",value:function(r){if(this.isColorChanged(r)){this.rampColors=r;var n=this.gl;n.deleteTexture(this.colorRampTexture),this.colorRampTexture=Yl(n,n.LINEAR,Z0(r),16,16)}}},{key:"isColorChanged",value:function(r){for(var n=Object.keys(r),t=0,o=n;t<o.length;t++){var u=o[t],f=Number(u);if(!this.rampColors[f]||this.rampColors[f]&&this.rampColors[f]!==r[f])return!0}return!1}},{key:"reSize",value:function(r,n){if(r!==this.width||n!==this.height){var t=this.gl;t.deleteTexture(this.backgroundTexture),t.deleteTexture(this.screenTexture),this.width=r,this.height=n;var o=new Uint8Array(r*n*4);this.backgroundTexture=Yl(t,t.NEAREST,o,r,n),this.screenTexture=Yl(t,t.NEAREST,o,r,n)}}},{key:"draw",value:function(){var r;if((r=this.windData)!==null&&r!==void 0&&r.image){var n=this.gl;return xd(n,this.windTexture,0),xd(n,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}else return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var r=this.gl;u0(r,this.framebuffer,this.screenTexture),r.viewport(0,0,this.width,this.height),r.disable(r.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),r.readPixels(0,0,this.width,this.height,r.RGBA,r.UNSIGNED_BYTE,this.pixels),u0(r,null,null),r.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var n=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=n}},{key:"drawFullTexture",value:function(r,n){var t=this.gl,o=this.fullScreenProgram;t.useProgram(o),t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.vertexAttribPointer(o.a_pos,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.a_pos),t.bindBuffer(t.ARRAY_BUFFER,null),xd(t,r,2),t.uniform1i(o.u_screen,2),t.uniform1f(o.u_opacity,n),t.drawArrays(t.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var r=this.gl,n=this.drawProgram;r.useProgram(n),U0(r,this.particleIndexBuffer,n.a_index,1),xd(r,this.colorRampTexture,2),r.uniform1i(n.u_wind,0),r.uniform1i(n.u_particles,1),r.uniform1i(n.u_color_ramp,2),r.uniform1f(n.u_particles_res,this.particleStateResolution),r.uniform2f(n.u_wind_min,this.windData.uMin,this.windData.vMin),r.uniform2f(n.u_wind_max,this.windData.uMax,this.windData.vMax),r.drawArrays(r.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var r=this.gl;u0(r,this.framebuffer,this.particleStateTexture1),r.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var n=this.updateProgram;r.useProgram(n),U0(r,this.quadBuffer,n.a_pos,2),r.uniform1i(n.u_wind,0),r.uniform1i(n.u_particles,1),r.uniform1f(n.u_rand_seed,Math.random()),r.uniform2f(n.u_wind_res,this.windData.image.width*2,this.windData.image.height*2),r.uniform2f(n.u_wind_min,this.windData.uMin,this.windData.vMin),r.uniform2f(n.u_wind_max,this.windData.uMax,this.windData.vMax),r.uniform1f(n.u_speed_factor,this.speedFactor),r.uniform1f(n.u_drop_rate,this.dropRate),r.uniform1f(n.u_drop_rate_bump,this.dropRateBump),r.drawArrays(r.TRIANGLES,0,6);var t=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=t,u0(r,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}();function Xb(e){var a=Yb();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qb=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,rs=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,Wu={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},op=function(e){(0,yt.Z)(r,e);var a=Xb(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"sizeScale",.5),(0,Pe.Z)((0,D.Z)(n),"frequency",new cf(7.2)),n}return(0,Me.Z)(r,[{key:"render",value:function(t){var o=this;this.drawColorMode(t),this.frequency.run(function(){o.drawWind()})}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E=this,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr,Mr,Dr,sn,rn,Jn,fi,Hi,Ds,pu,$s,Pc;return x().wrap(function(up){for(;;)switch(up.prev=up.next){case 0:return R=this.layer.getLayerConfig(),B=R.uMin,Y=B===void 0?-21.32:B,Q=R.uMax,ce=Q===void 0?26.8:Q,fe=R.vMin,Te=fe===void 0?-21.57:fe,Ve=R.vMax,st=Ve===void 0?21.42:Ve,at=R.fadeOpacity,Tt=at===void 0?.996:at,kt=R.speedFactor,Yt=kt===void 0?.25:kt,cr=R.dropRate,Mr=cr===void 0?.003:cr,Dr=R.dropRateBump,sn=Dr===void 0?.01:Dr,rn=R.rampColors,Jn=rn===void 0?Wu:rn,fi=R.sizeScale,Hi=fi===void 0?.5:fi,Ds=this.rendererService.createTexture2D,pu=this.layer.getSource(),this.texture=Ds({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),$s=this.rendererService.getGLContext(),this.imageCoords=(u=pu.data)===null||u===void 0?void 0:u.dataArray[0].coordinates,(f=pu.data)===null||f===void 0||(g=f.images)===null||g===void 0||g.then(function(Xg){var Uv;E.sizeScale=Hi*E.getZoomScale();var $0=E.getWindSize(),a_=$0.imageWidth,tf=$0.imageHeight,Av={glContext:$s,imageWidth:a_,imageHeight:tf,fadeOpacity:Tt,speedFactor:Yt,dropRate:Mr,dropRateBump:sn,rampColors:Jn};E.wind=new Wb(Av),E.wind.setWind({uMin:Y,uMax:ce,vMin:Te,vMax:st,image:Xg[0]}),(Uv=E.texture)===null||Uv===void 0||Uv.destroy(),E.texture=Ds({width:a_,height:tf}),E.layerService.reRender()}),up.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:rs,fragmentShader:qb,triangulation:Ty,primitive:Ke.TRIANGLES,depth:{enable:!1}});case 10:return Pc=up.sent,this.colorModel=Pc,up.abrupt("return",[Pc]);case 13:case"end":return up.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),o=this.mapService.lngLatToPixel(this.imageCoords[1]),u=Math.min(Math.floor((o.x-t.x)*this.sizeScale),2048),f=Math.min(Math.floor((t.y-o.y)*this.sizeScale),2048);return{imageWidth:u,imageHeight:f}}},{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.initModels());case 1:case"end":return f.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.wind)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ni.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:2,update:function(o,u,f){return[f[3],f[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),o=t.uMin,u=o===void 0?-21.32:o,f=t.uMax,g=f===void 0?26.8:f,E=t.vMin,R=E===void 0?-21.57:E,B=t.vMax,Y=B===void 0?21.42:B,Q=t.numParticles,ce=Q===void 0?65535:Q,fe=t.fadeOpacity,Te=fe===void 0?.996:fe,Ve=t.speedFactor,st=Ve===void 0?.25:Ve,at=t.dropRate,Tt=at===void 0?.003:at,kt=t.dropRateBump,Yt=kt===void 0?.01:kt,cr=t.rampColors,Mr=cr===void 0?Wu:cr,Dr=t.sizeScale,sn=Dr===void 0?.5:Dr,rn=ce,Jn=Math.floor(this.mapService.getZoom());if(typeof sn=="number"&&sn!==this.sizeScale||Jn!==this.cacheZoom){var fi=this.getZoomScale();this.sizeScale=sn,rn*=fi;var Hi=this.getWindSize(),Ds=Hi.imageWidth,pu=Hi.imageHeight;this.wind.reSize(Ds,pu),this.cacheZoom=Jn}this.wind.updateWindDir(u,g,R,Y),this.wind.updateParticelNum(rn),this.wind.updateColorRampTexture(Mr),this.wind.fadeOpacity=Te,this.wind.speedFactor=st,this.wind.dropRate=Tt,this.wind.dropRateBump=Yt;var $s=this.wind.draw(),Pc=$s.d,lc=$s.w,up=$s.h;this.rendererService.setBaseState(),this.texture.update({data:Pc,width:lc,height:up})}}},{key:"drawColorMode",value:function(){var t,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=this.layer.getLayerConfig(),f=u.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:f||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(o)}),this.layer.hooks.afterRender.call()}}]),r}(Lu),od={wind:op},sp=od;function G1(e){var a=Kb();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y3=function(e){(0,yt.Z)(r,e);var a=G1(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","WindLayer"),n}return(0,Me.Z)(r,[{key:"buildModels",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=this.getModelType(),this.layerModel=new sp[u](this),g.next=4,this.initLayerModels();case 4:case"end":return g.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.layerModel&&this.layerModel.render(t),this}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={wind:{}};return o[t]}},{key:"getModelType",value:function(){return"wind"}}]),r}(kd),Dy,sk,uk,lk,_3,ck,hk,cR=Ga.cloneDeep,hR=(Dy=(0,Ii.b2)(),sk=(0,Ii.f3)(cn.IMapService),uk=(0,Ii.f3)(cn.IFontService),Dy(lk=(_3=function(){function e(){(0,Be.Z)(this,e),yo(this,"mapService",ck,this),yo(this,"fontService",hk,this)}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,mr.Z)(x().mark(function u(){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:r.log(Qh.MappingStart,zs.INIT),t.generateMaping(r,{styleAttributeService:o}),r.log(Qh.MappingEnd,zs.INIT);case 3:case"end":return g.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,mr.Z)(x().mark(function f(g){var E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(g){B.next=2;break}return B.abrupt("return",g);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(Qh.MappingStart,zs.UPDATE),E=t.generateMaping(r,{styleAttributeService:o}),r.log(Qh.MappingEnd,zs.UPDATE),B.abrupt("return",E);case 7:case"end":return B.stop()}},f)}));return function(f){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var f=o.getLayerStyleAttributes()||[],g=o.getLayerStyleAttribute("filter"),E=u.data.dataArray;if(!(Array.isArray(E)&&E.length===0)){var R=f.filter(function(Q){return Q.needRemapping}),B=E;if(g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(B=E.filter(function(Q){return t.applyAttributeMapping(g,Q)[0]})),R.length){var Y=t.mapping(r,R,B,r.getEncodedData());r.setEncodedData(Y)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],f=o.getLayerStyleAttribute("filter"),g=r.getSource().data.dataArray,E=g;f!=null&&f.scale&&(E=g.filter(function(B){return t.applyAttributeMapping(f,B)[0]})),E=r.processData(E);var R=this.mapping(r,u,E,void 0);return r.setEncodedData(R),g.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,t,o){var u=this,f=r.getLayerConfig(),g=f.arrow,E=g===void 0?{enable:!1}:g,R=n.filter(function(Y){return Y.scale!==void 0}).filter(function(Y){return Y.name!=="filter"}),B=t.map(function(Y,Q){var ce=o?o[Q]:{},fe=(0,Ee.Z)({id:Y._id,coordinates:Y.coordinates},ce);if(R.forEach(function(st){var at=u.applyAttributeMapping(st,Y);(st.name==="color"||st.name==="stroke")&&(at=at.map(function(Tt){return Mo(Tt)})),fe[st.name]=Array.isArray(at)&&at.length===1?at[0]:at,st.name==="shape"&&(fe.shape=u.fontService.getIconFontKey(fe[st.name]))}),E.enable&&fe.shape==="line"){var Te=fe.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var Ve=u.getArrowPoints(Te[0],Te[1]);fe.coordinates.splice(1,0,Ve,Ve),r.arrowInsertCount++}}return fe});return n.forEach(function(Y){Y.needRemapping=!1}),this.adjustData2Amap2Coordinates(B,r),this.adjustData2SimpleCoordinates(B),B}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===ip["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ip["GAODE2.x"],u.originCoordinates=cR(u.coordinates),u.coordinates=t.mapService.coordToAMap2RelativeCoordinates(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ip.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var f=[];u.map(function(g){f.push(n.mapService.simpleMapCoord.unproject(g))}),t.push(f)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(g){var E,R=g.field;(n.hasOwnProperty(R)||((E=r.scale)===null||E===void 0?void 0:E.type)==="variable")&&u.push(n[R])});var f=r.mapping?r.mapping(u):[];return f}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=wc(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),ck=ro(_3.prototype,"mapService",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hk=ro(_3.prototype,"fontService",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_3))||lk),fk,pk,fR=(fk=(0,Ii.b2)(),fk(pk=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(cn.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,mr.Z)(x().mark(function t(){var o,u,f,g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(r.log(Qh.SourceInitStart,zs.INIT),o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,f=u.data,g=u.options,o=new cy(f,g),r.setSource(o)),!o.inited){R.next=8;break}n.updateClusterData(r),r.log(Qh.SourceInitEnd,zs.INIT),R.next=10;break;case 8:return R.next=10,new Promise(function(B){o.on("update",function(Y){Y.type==="inited"&&(n.updateClusterData(r),r.log(Qh.SourceInitEnd,zs.INIT)),B(null)})});case 10:case"end":return R.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,mr.Z)(x().mark(function t(){var o,u,f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,f=o||u,E.abrupt("return",f);case 5:case"end":return E.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,f=this.mapService.getZoom()-1,g=r.dataState.dataSourceNeedUpdate;return t&&g&&n.updateClusterData(Math.floor(f)),t&&Math.abs(r.clusterZoom-f)>=1?(u!==Math.floor(f)&&n.updateClusterData(Math.floor(f)),r.clusterZoom=f,!0):!1}}]),e}())||pk);function C4(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function dk(e){return e.length===1&&(e=pR(e)),{left:function(a,r,n,t){for(n==null&&(n=0),t==null&&(t=a.length);n<t;){var o=n+t>>>1;e(a[o],r)<0?n=o+1:t=o}return n},right:function(a,r,n,t){for(n==null&&(n=0),t==null&&(t=a.length);n<t;){var o=n+t>>>1;e(a[o],r)>0?t=o:n=o+1}return n}}}function pR(e){return function(a,r){return C4(e(a),r)}}var vk=dk(C4),dR=vk.right,lB=vk.left,b3=dR;function mk(e,a){var r=e.length,n=-1,t,o,u;if(a==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=a(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=a(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var gk=Array.prototype,cB=gk.slice,hB=gk.map,A4=Math.sqrt(50),T4=Math.sqrt(10),M4=Math.sqrt(2);function yk(e,a,r){var n,t=-1,o,u,f;if(a=+a,e=+e,r=+r,e===a&&r>0)return[e];if((n=a<e)&&(o=e,e=a,a=o),(f=x3(e,a,r))===0||!isFinite(f))return[];if(f>0)for(e=Math.ceil(e/f),a=Math.floor(a/f),u=new Array(o=Math.ceil(a-e+1));++t<o;)u[t]=(e+t)*f;else for(e=Math.floor(e*f),a=Math.ceil(a*f),u=new Array(o=Math.ceil(e-a+1));++t<o;)u[t]=(e-t)/f;return n&&u.reverse(),u}function x3(e,a,r){var n=(a-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=A4?10:o>=T4?5:o>=M4?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=A4?10:o>=T4?5:o>=M4?2:1)}function P4(e,a,r){var n=Math.abs(a-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=A4?t*=10:o>=T4?t*=5:o>=M4&&(t*=2),a<e?-t:t}function fB(){var e=identity,a=extent,r=sturges;function n(t){var o,u=t.length,f,g=new Array(u);for(o=0;o<u;++o)g[o]=e(t[o],o,t);var E=a(g),R=E[0],B=E[1],Y=r(g,R,B);Array.isArray(Y)||(Y=tickStep(R,B,Y),Y=range(Math.ceil(R/Y)*Y,B,Y));for(var Q=Y.length;Y[0]<=R;)Y.shift(),--Q;for(;Y[Q-1]>B;)Y.pop(),--Q;var ce=new Array(Q+1),fe;for(o=0;o<=Q;++o)fe=ce[o]=[],fe.x0=o>0?Y[o-1]:R,fe.x1=o<Q?Y[o]:B;for(o=0;o<u;++o)f=g[o],R<=f&&f<=B&&ce[bisect(Y,f,0,Q)].push(t[o]);return ce}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(a=typeof t=="function"?t:constant([t[0],t[1]]),n):a},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function pB(e,a,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function vR(e){return e===null?NaN:+e}function mR(e,a,r){if(r==null&&(r=vR),!!(n=e.length)){if((a=+a)<=0||n<2)return+r(e[0],0,e);if(a>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*a,o=Math.floor(t),u=+r(e[o],o,e),f=+r(e[o+1],o+1,e);return u+(f-u)*(t-o)}}function _k(e,a,r,n,t){var o=e*e,u=o*e;return((1-3*e+3*o-u)*a+(4-6*o+3*u)*r+(1+3*e+3*o-3*u)*n+u*t)/6}function gR(e){var a=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,a-1):Math.floor(r*a),t=e[n],o=e[n+1],u=n>0?e[n-1]:2*t-o,f=n<a-1?e[n+2]:2*o-t;return _k((r-n/a)*a,u,t,o,f)}}function yR(e){var a=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*a),t=e[(n+a-1)%a],o=e[n%a],u=e[(n+1)%a],f=e[(n+2)%a];return _k((r-n/a)*a,t,o,u,f)}}function k4(e){return function(){return e}}function bk(e,a){return function(r){return e+r*a}}function _R(e,a,r){return e=Math.pow(e,r),a=Math.pow(a,r)-e,r=1/r,function(n){return Math.pow(e+n*a,r)}}function dB(e,a){var r=a-e;return r?bk(e,r>180||r<-180?r-360*Math.round(r/360):r):constant(isNaN(e)?a:e)}function bR(e){return(e=+e)==1?xk:function(a,r){return r-a?_R(a,r,e):k4(isNaN(a)?r:a)}}function xk(e,a){var r=a-e;return r?bk(e,r):k4(isNaN(e)?a:e)}var wk=function e(a){var r=bR(a);function n(t,o){var u=r((t=Jo(t)).r,(o=Jo(o)).r),f=r(t.g,o.g),g=r(t.b,o.b),E=xk(t.opacity,o.opacity);return function(R){return t.r=u(R),t.g=f(R),t.b=g(R),t.opacity=E(R),t+""}}return n.gamma=e,n}(1);function Sk(e){return function(a){var r=a.length,n=new Array(r),t=new Array(r),o=new Array(r),u,f;for(u=0;u<r;++u)f=Jo(a[u]),n[u]=f.r||0,t[u]=f.g||0,o[u]=f.b||0;return n=e(n),t=e(t),o=e(o),f.opacity=1,function(g){return f.r=n(g),f.g=t(g),f.b=o(g),f+""}}}var xR=Sk(gR),vB=Sk(yR),qm="$";function w3(){}w3.prototype=Ek.prototype={constructor:w3,has:function(e){return qm+e in this},get:function(e){return this[qm+e]},set:function(e,a){return this[qm+e]=a,this},remove:function(e){var a=qm+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===qm&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===qm&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===qm&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===qm&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===qm&&++e;return e},empty:function(){for(var e in this)if(e[0]===qm)return!1;return!0},each:function(e){for(var a in this)a[0]===qm&&e(this[a],a.slice(1),this)}};function Ek(e,a){var r=new w3;if(e instanceof w3)e.each(function(f,g){r.set(g,f)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(a==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(a(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var I4=Ek;function mB(){var e=[],a=[],r,n,t;function o(f,g,E,R){if(g>=e.length)return r!=null&&f.sort(r),n!=null?n(f):f;for(var B=-1,Y=f.length,Q=e[g++],ce,fe,Te=map(),Ve,st=E();++B<Y;)(Ve=Te.get(ce=Q(fe=f[B])+""))?Ve.push(fe):Te.set(ce,[fe]);return Te.each(function(at,Tt){R(st,Tt,o(at,g,E,R))}),st}function u(f,g){if(++g>e.length)return f;var E,R=a[g-1];return n!=null&&g>=e.length?E=f.entries():(E=[],f.each(function(B,Y){E.push({key:Y,values:u(B,g)})})),R!=null?E.sort(function(B,Y){return R(B.key,Y.key)}):E}return t={object:function(f){return o(f,0,wR,SR)},map:function(f){return o(f,0,Ck,Ak)},entries:function(f){return u(o(f,0,Ck,Ak),0)},key:function(f){return e.push(f),t},sortKeys:function(f){return a[e.length-1]=f,t},sortValues:function(f){return r=f,t},rollup:function(f){return n=f,t}}}function wR(){return{}}function SR(e,a,r){e[a]=r}function Ck(){return map()}function Ak(e,a,r){e.set(a,r)}function S3(){}var Oy=I4.prototype;S3.prototype=ER.prototype={constructor:S3,has:Oy.has,add:function(e){return e+="",this[qm+e]=e,this},remove:Oy.remove,clear:Oy.clear,values:Oy.keys,size:Oy.size,empty:Oy.empty,each:Oy.each};function ER(e,a){var r=new S3;if(e instanceof S3)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(a==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(a(e[n],n,e))}return r}var gB=null,Tk=Array.prototype,Mk=Tk.map,Fy=Tk.slice;function j0(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function Pk(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var kk={name:"implicit"};function E3(){var e=I4(),a=[],r=[],n=kk;function t(o){var u=o+"",f=e.get(u);if(!f){if(n!==kk)return n;e.set(u,f=a.push(o))}return r[(f-1)%r.length]}return t.domain=function(o){if(!arguments.length)return a.slice();a=[],e=I4();for(var u=-1,f=o.length,g,E;++u<f;)e.has(E=(g=o[u])+"")||e.set(E,a.push(g));return t},t.range=function(o){return arguments.length?(r=Fy.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return E3(a,r).unknown(n)},j0.apply(t,arguments),t}function Ik(){var e=ordinal().unknown(void 0),a=e.domain,r=e.range,n=[0,1],t,o,u=!1,f=0,g=0,E=.5;delete e.unknown;function R(){var B=a().length,Y=n[1]<n[0],Q=n[Y-0],ce=n[1-Y];t=(ce-Q)/Math.max(1,B-f+g*2),u&&(t=Math.floor(t)),Q+=(ce-Q-t*(B-f))*E,o=t*(1-f),u&&(Q=Math.round(Q),o=Math.round(o));var fe=sequence(B).map(function(Te){return Q+t*Te});return r(Y?fe.reverse():fe)}return e.domain=function(B){return arguments.length?(a(B),R()):a()},e.range=function(B){return arguments.length?(n=[+B[0],+B[1]],R()):n.slice()},e.rangeRound=function(B){return n=[+B[0],+B[1]],u=!0,R()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(B){return arguments.length?(u=!!B,R()):u},e.padding=function(B){return arguments.length?(f=Math.min(1,g=+B),R()):f},e.paddingInner=function(B){return arguments.length?(f=Math.min(1,B),R()):f},e.paddingOuter=function(B){return arguments.length?(g=+B,R()):g},e.align=function(B){return arguments.length?(E=Math.max(0,Math.min(1,B)),R()):E},e.copy=function(){return Ik(a(),n).round(u).paddingInner(f).paddingOuter(g).align(E)},initRange.apply(R(),arguments)}function Lk(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Lk(a())},e}function yB(){return Lk(Ik.apply(null,arguments).paddingInner(1))}function _B(e,a){return(isNumberArray(a)?numberArray:Rk)(e,a)}function Rk(e,a){var r=a?a.length:0,n=e?Math.min(r,e.length):0,t=new Array(n),o=new Array(r),u;for(u=0;u<n;++u)t[u]=D4(e[u],a[u]);for(;u<r;++u)o[u]=a[u];return function(f){for(u=0;u<n;++u)o[u]=t[u](f);return o}}function CR(e,a){var r=new Date;return e=+e,a=+a,function(n){return r.setTime(e*(1-n)+a*n),r}}function C3(e,a){return e=+e,a=+a,function(r){return e*(1-r)+a*r}}function AR(e,a){var r={},n={},t;(e===null||typeof e!="object")&&(e={}),(a===null||typeof a!="object")&&(a={});for(t in a)t in e?r[t]=D4(e[t],a[t]):n[t]=a[t];return function(o){for(t in r)n[t]=r[t](o);return n}}var L4=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,R4=new RegExp(L4.source,"g");function TR(e){return function(){return e}}function MR(e){return function(a){return e(a)+""}}function PR(e,a){var r=L4.lastIndex=R4.lastIndex=0,n,t,o,u=-1,f=[],g=[];for(e=e+"",a=a+"";(n=L4.exec(e))&&(t=R4.exec(a));)(o=t.index)>r&&(o=a.slice(r,o),f[u]?f[u]+=o:f[++u]=o),(n=n[0])===(t=t[0])?f[u]?f[u]+=t:f[++u]=t:(f[++u]=null,g.push({i:u,x:C3(n,t)})),r=R4.lastIndex;return r<a.length&&(o=a.slice(r),f[u]?f[u]+=o:f[++u]=o),f.length<2?g[0]?MR(g[0].x):TR(a):(a=g.length,function(E){for(var R=0,B;R<a;++R)f[(B=g[R]).i]=B.x(E);return f.join("")})}function kR(e,a){a||(a=[]);var r=e?Math.min(a.length,e.length):0,n=a.slice(),t;return function(o){for(t=0;t<r;++t)n[t]=e[t]*(1-o)+a[t]*o;return n}}function IR(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function D4(e,a){var r=typeof a,n;return a==null||r==="boolean"?k4(a):(r==="number"?C3:r==="string"?(n=kr(a))?(a=n,wk):PR:a instanceof kr?wk:a instanceof Date?CR:IR(a)?kR:Array.isArray(a)?Rk:typeof a.valueOf!="function"&&typeof a.toString!="function"||isNaN(a)?AR:C3)(e,a)}function LR(e,a){return e=+e,a=+a,function(r){return Math.round(e*(1-r)+a*r)}}function RR(e){return function(){return e}}function DR(e){return+e}var Dk=[0,1];function Cv(e){return e}function O4(e,a){return(a-=e=+e)?function(r){return(r-e)/a}:RR(isNaN(a)?NaN:.5)}function Ok(e){var a=e[0],r=e[e.length-1],n;return a>r&&(n=a,a=r,r=n),function(t){return Math.max(a,Math.min(r,t))}}function OR(e,a,r){var n=e[0],t=e[1],o=a[0],u=a[1];return t<n?(n=O4(t,n),o=r(u,o)):(n=O4(n,t),o=r(o,u)),function(f){return o(n(f))}}function FR(e,a,r){var n=Math.min(e.length,a.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<n;)t[u]=O4(e[u],e[u+1]),o[u]=r(a[u],a[u+1]);return function(f){var g=b3(e,f,1,n)-1;return o[g](t[g](f))}}function A3(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function F4(){var e=Dk,a=Dk,r=D4,n,t,o,u=Cv,f,g,E;function R(){return f=Math.min(e.length,a.length)>2?FR:OR,g=E=null,B}function B(Y){return isNaN(Y=+Y)?o:(g||(g=f(e.map(n),a,r)))(n(u(Y)))}return B.invert=function(Y){return u(t((E||(E=f(a,e.map(n),C3)))(Y)))},B.domain=function(Y){return arguments.length?(e=Mk.call(Y,DR),u===Cv||(u=Ok(e)),R()):e.slice()},B.range=function(Y){return arguments.length?(a=Fy.call(Y),R()):a.slice()},B.rangeRound=function(Y){return a=Fy.call(Y),r=LR,R()},B.clamp=function(Y){return arguments.length?(u=Y?Ok(e):Cv,B):u!==Cv},B.interpolate=function(Y){return arguments.length?(r=Y,R()):r},B.unknown=function(Y){return arguments.length?(o=Y,B):o},function(Y,Q){return n=Y,t=Q,R()}}function Fk(e,a){return F4()(e,a)}var zR=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function T3(e){if(!(a=zR.exec(e)))throw new Error("invalid format: "+e);var a;return new z4({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}T3.prototype=z4.prototype;function z4(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}z4.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function BR(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function M3(e,a){if((r=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function H1(e){return e=M3(Math.abs(e)),e?e[1]:NaN}function NR(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(H1(a)/3)))*3-H1(Math.abs(e)))}function ZR(e,a){return function(r,n){for(var t=r.length,o=[],u=0,f=e[0],g=0;t>0&&f>0&&(g+f+1>n&&(f=Math.max(1,n-g)),o.push(r.substring(t-=f,t+f)),!((g+=f+1)>n));)f=e[u=(u+1)%e.length];return o.reverse().join(a)}}function UR(e){return function(a){return a.replace(/[0-9]/g,function(r){return e[+r]})}}function jR(e){e:for(var a=e.length,r=1,n=-1,t;r<a;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var zk;function VR(e,a){var r=M3(e,a);if(!r)return e+"";var n=r[0],t=r[1],o=t-(zk=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+M3(e,Math.max(0,a+o-1))[0]}function Bk(e,a){var r=M3(e,a);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var Nk={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:BR,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return Bk(e*100,a)},r:Bk,s:VR,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Zk(e){return e}var Uk=Array.prototype.map,jk=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function GR(e){var a=e.grouping===void 0||e.thousands===void 0?Zk:ZR(Uk.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Zk:UR(Uk.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",f=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function E(B){B=T3(B);var Y=B.fill,Q=B.align,ce=B.sign,fe=B.symbol,Te=B.zero,Ve=B.width,st=B.comma,at=B.precision,Tt=B.trim,kt=B.type;kt==="n"?(st=!0,kt="g"):Nk[kt]||(at===void 0&&(at=12),Tt=!0,kt="g"),(Te||Y==="0"&&Q==="=")&&(Te=!0,Y="0",Q="=");var Yt=fe==="$"?r:fe==="#"&&/[boxX]/.test(kt)?"0"+kt.toLowerCase():"",cr=fe==="$"?n:/[%p]/.test(kt)?u:"",Mr=Nk[kt],Dr=/[defgprs%]/.test(kt);at=at===void 0?6:/[gprs]/.test(kt)?Math.max(1,Math.min(21,at)):Math.max(0,Math.min(20,at));function sn(rn){var Jn=Yt,fi=cr,Hi,Ds,pu;if(kt==="c")fi=Mr(rn)+fi,rn="";else{rn=+rn;var $s=rn<0||1/rn<0;if(rn=isNaN(rn)?g:Mr(Math.abs(rn),at),Tt&&(rn=jR(rn)),$s&&+rn==0&&ce!=="+"&&($s=!1),Jn=($s?ce==="("?ce:f:ce==="-"||ce==="("?"":ce)+Jn,fi=(kt==="s"?jk[8+zk/3]:"")+fi+($s&&ce==="("?")":""),Dr){for(Hi=-1,Ds=rn.length;++Hi<Ds;)if(pu=rn.charCodeAt(Hi),48>pu||pu>57){fi=(pu===46?t+rn.slice(Hi+1):rn.slice(Hi))+fi,rn=rn.slice(0,Hi);break}}}st&&!Te&&(rn=a(rn,1/0));var Pc=Jn.length+rn.length+fi.length,lc=Pc<Ve?new Array(Ve-Pc+1).join(Y):"";switch(st&&Te&&(rn=a(lc+rn,lc.length?Ve-fi.length:1/0),lc=""),Q){case"<":rn=Jn+rn+fi+lc;break;case"=":rn=Jn+lc+rn+fi;break;case"^":rn=lc.slice(0,Pc=lc.length>>1)+Jn+rn+fi+lc.slice(Pc);break;default:rn=lc+Jn+rn+fi;break}return o(rn)}return sn.toString=function(){return B+""},sn}function R(B,Y){var Q=E((B=T3(B),B.type="f",B)),ce=Math.max(-8,Math.min(8,Math.floor(H1(Y)/3)))*3,fe=Math.pow(10,-ce),Te=jk[8+ce/3];return function(Ve){return Q(fe*Ve)+Te}}return{format:E,formatPrefix:R}}var P3,B4,Vk;HR({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function HR(e){return P3=GR(e),B4=P3.format,Vk=P3.formatPrefix,P3}function $R(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,H1(a)-H1(e))+1}function WR(e){return Math.max(0,-H1(Math.abs(e)))}function XR(e,a,r,n){var t=P4(e,a,r),o;switch(n=T3(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return n.precision==null&&!isNaN(o=NR(t,u))&&(n.precision=o),Vk(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=$R(t,Math.max(Math.abs(e),Math.abs(a))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=WR(t))&&(n.precision=o-(n.type==="%")*2);break}}return B4(n)}function Jb(e){var a=e.domain;return e.ticks=function(r){var n=a();return yk(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=a();return XR(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=a(),t=0,o=n.length-1,u=n[t],f=n[o],g;return f<u&&(g=u,u=f,f=g,g=t,t=o,o=g),g=x3(u,f,r),g>0?(u=Math.floor(u/g)*g,f=Math.ceil(f/g)*g,g=x3(u,f,r)):g<0&&(u=Math.ceil(u*g)/g,f=Math.floor(f*g)/g,g=x3(u,f,r)),g>0?(n[t]=Math.floor(u/g)*g,n[o]=Math.ceil(f/g)*g,a(n)):g<0&&(n[t]=Math.ceil(u*g)/g,n[o]=Math.floor(f*g)/g,a(n)),e},e}function Gk(){var e=Fk(Cv,Cv);return e.copy=function(){return A3(e,Gk())},j0.apply(e,arguments),Jb(e)}function YR(e){var a;function r(n){return isNaN(n=+n)?a:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(a=n,r):a},r.copy=function(){return YR(e).unknown(a)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function Hk(e,a){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=a.floor(t),e[n]=a.ceil(o),e}function $k(e){return Math.log(e)}function Wk(e){return Math.exp(e)}function qR(e){return-Math.log(-e)}function KR(e){return-Math.exp(-e)}function JR(e){return isFinite(e)?+("1e"+e):e<0?0:e}function QR(e){return e===10?JR:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function e7(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function Xk(e){return function(a){return-e(-a)}}function t7(e){var a=e($k,Wk),r=a.domain,n=10,t,o;function u(){return t=e7(n),o=QR(n),r()[0]<0?(t=Xk(t),o=Xk(o),e(qR,KR)):e($k,Wk),a}return a.base=function(f){return arguments.length?(n=+f,u()):n},a.domain=function(f){return arguments.length?(r(f),u()):r()},a.ticks=function(f){var g=r(),E=g[0],R=g[g.length-1],B;(B=R<E)&&(Y=E,E=R,R=Y);var Y=t(E),Q=t(R),ce,fe,Te,Ve=f==null?10:+f,st=[];if(!(n%1)&&Q-Y<Ve){if(Y=Math.round(Y)-1,Q=Math.round(Q)+1,E>0){for(;Y<Q;++Y)for(fe=1,ce=o(Y);fe<n;++fe)if(Te=ce*fe,!(Te<E)){if(Te>R)break;st.push(Te)}}else for(;Y<Q;++Y)for(fe=n-1,ce=o(Y);fe>=1;--fe)if(Te=ce*fe,!(Te<E)){if(Te>R)break;st.push(Te)}}else st=yk(Y,Q,Math.min(Q-Y,Ve)).map(o);return B?st.reverse():st},a.tickFormat=function(f,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=B4(g)),f===1/0)return g;f==null&&(f=10);var E=Math.max(1,n*f/a.ticks().length);return function(R){var B=R/o(Math.round(t(R)));return B*n<n-.5&&(B*=n),B<=E?g(R):""}},a.nice=function(){return r(Hk(r(),{floor:function(f){return o(Math.floor(t(f)))},ceil:function(f){return o(Math.ceil(t(f)))}}))},a}function Yk(){var e=t7(F4()).domain([1,10]);return e.copy=function(){return A3(e,Yk()).base(e.base())},j0.apply(e,arguments),e}function qk(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function Kk(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function r7(e){var a=1,r=e(qk(a),Kk(a));return r.constant=function(n){return arguments.length?e(qk(a=+n),Kk(a)):a},linearish(r)}function n7(){var e=r7(transformer());return e.copy=function(){return copy(e,n7()).constant(e.constant())},initRange.apply(e,arguments)}function Jk(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function i7(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function a7(e){return e<0?-e*e:e*e}function o7(e){var a=e(Cv,Cv),r=1;function n(){return r===1?e(Cv,Cv):r===.5?e(i7,a7):e(Jk(r),Jk(1/r))}return a.exponent=function(t){return arguments.length?(r=+t,n()):r},Jb(a)}function N4(){var e=o7(F4());return e.copy=function(){return A3(e,N4()).exponent(e.exponent())},j0.apply(e,arguments),e}function bB(){return N4.apply(null,arguments).exponent(.5)}function Qk(){var e=[],a=[],r=[],n;function t(){var u=0,f=Math.max(1,a.length);for(r=new Array(f-1);++u<f;)r[u-1]=mR(e,u/f);return o}function o(u){return isNaN(u=+u)?n:a[b3(r,u)]}return o.invertExtent=function(u){var f=a.indexOf(u);return f<0?[NaN,NaN]:[f>0?r[f-1]:e[0],f<r.length?r[f]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var f=0,g=u.length,E;f<g;++f)E=u[f],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(C4),t()},o.range=function(u){return arguments.length?(a=Fy.call(u),t()):a.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Qk().domain(e).range(a).unknown(n)},j0.apply(o,arguments)}function e6(){var e=0,a=1,r=1,n=[.5],t=[0,1],o;function u(g){return g<=g?t[b3(n,g,0,r)]:o}function f(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*a-(g-r)*e)/(r+1);return u}return u.domain=function(g){return arguments.length?(e=+g[0],a=+g[1],f()):[e,a]},u.range=function(g){return arguments.length?(r=(t=Fy.call(g)).length-1,f()):t.slice()},u.invertExtent=function(g){var E=t.indexOf(g);return E<0?[NaN,NaN]:E<1?[e,n[0]]:E>=r?[n[r-1],a]:[n[E-1],n[E]]},u.unknown=function(g){return arguments.length&&(o=g),u},u.thresholds=function(){return n.slice()},u.copy=function(){return e6().domain([e,a]).range(t).unknown(o)},j0.apply(Jb(u),arguments)}function t6(){var e=[.5],a=[0,1],r,n=1;function t(o){return o<=o?a[b3(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=Fy.call(o),n=Math.min(e.length,a.length-1),t):e.slice()},t.range=function(o){return arguments.length?(a=Fy.call(o),n=Math.min(e.length,a.length-1),t):a.slice()},t.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return t6().domain(e).range(a).unknown(r)},j0.apply(t,arguments)}var Z4=new Date,U4=new Date;function Zv(e,a,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},t.round=function(o){var u=t(o),f=t.ceil(o);return o-u<f-o?u:f},t.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,f){var g=[],E;if(o=t.ceil(o),f=f==null?1:Math.floor(f),!(o<u)||!(f>0))return g;do g.push(E=new Date(+o)),a(o,f),e(o);while(E<o&&o<u);return g},t.filter=function(o){return Zv(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,f){if(u>=u)if(f<0)for(;++f<=0;)for(;a(u,-1),!o(u););else for(;--f>=0;)for(;a(u,1),!o(u););})},r&&(t.count=function(o,u){return Z4.setTime(+o),U4.setTime(+u),e(Z4),e(U4),Math.floor(r(Z4,U4))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o===0}:function(u){return t.count(0,u)%o===0}):t}),t}var j4=Zv(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});j4.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Zv(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,r){a.setFullYear(a.getFullYear()+r*e)})};var $1=j4,xB=j4.range,r6=Zv(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),s7=r6,wB=r6.range,k3=1e3,Qb=6e4,n6=36e5,i6=864e5,a6=6048e5;function zy(e){return Zv(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,r){a.setDate(a.getDate()+r*7)},function(a,r){return(r-a-(r.getTimezoneOffset()-a.getTimezoneOffset())*Qb)/a6})}var V4=zy(0),I3=zy(1),u7=zy(2),l7=zy(3),W1=zy(4),c7=zy(5),h7=zy(6),SB=V4.range,EB=I3.range,CB=u7.range,AB=l7.range,TB=W1.range,MB=c7.range,PB=h7.range,o6=Zv(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*Qb)/i6},function(e){return e.getDate()-1}),G4=o6,kB=o6.range,s6=Zv(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*k3-e.getMinutes()*Qb)},function(e,a){e.setTime(+e+a*n6)},function(e,a){return(a-e)/n6},function(e){return e.getHours()}),f7=s6,IB=s6.range,u6=Zv(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*k3)},function(e,a){e.setTime(+e+a*Qb)},function(e,a){return(a-e)/Qb},function(e){return e.getMinutes()}),p7=u6,LB=u6.range,l6=Zv(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*k3)},function(e,a){return(a-e)/k3},function(e){return e.getUTCSeconds()}),d7=l6,RB=l6.range,L3=Zv(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});L3.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Zv(function(a){a.setTime(Math.floor(a/e)*e)},function(a,r){a.setTime(+a+r*e)},function(a,r){return(r-a)/e}):L3};var v7=L3,DB=L3.range;function By(e){return Zv(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,r){a.setUTCDate(a.getUTCDate()+r*7)},function(a,r){return(r-a)/a6})}var c6=By(0),R3=By(1),m7=By(2),g7=By(3),X1=By(4),y7=By(5),_7=By(6),OB=c6.range,FB=R3.range,zB=m7.range,BB=g7.range,NB=X1.range,ZB=y7.range,UB=_7.range,h6=Zv(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/i6},function(e){return e.getUTCDate()-1}),f6=h6,jB=h6.range,H4=Zv(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});H4.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Zv(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,r){a.setUTCFullYear(a.getUTCFullYear()+r*e)})};var ex=H4,VB=H4.range;function $4(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function W4(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function tx(e,a,r){return{y:e,m:a,d:r,H:0,M:0,S:0,L:0}}function b7(e){var a=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,f=e.months,g=e.shortMonths,E=rx(t),R=nx(t),B=rx(o),Y=nx(o),Q=rx(u),ce=nx(u),fe=rx(f),Te=nx(f),Ve=rx(g),st=nx(g),at={a:$s,A:Pc,b:lc,B:up,c:null,d:y6,e:y6,f:V7,g:Q7,G:tD,H:Z7,I:U7,j:j7,L:_6,m:G7,M:H7,p:Xg,q:Uv,Q:C6,s:A6,S:$7,u:W7,U:X7,V:Y7,w:q7,W:K7,x:null,X:null,y:J7,Y:eD,Z:rD,"%":E6},Tt={a:$0,A:a_,b:tf,B:Av,c:null,d:x6,e:x6,f:oD,g:mD,G:yD,H:nD,I:iD,j:aD,L:w6,m:sD,M:uD,p:fE,q:pE,Q:C6,s:A6,S:lD,u:cD,U:hD,V:fD,w:pD,W:dD,x:null,X:null,y:vD,Y:gD,Z:_D,"%":E6},kt={a:sn,A:rn,b:Jn,B:fi,c:Hi,d:m6,e:m6,f:F7,g:v6,G:d6,H:g6,I:g6,j:L7,L:O7,m:I7,M:R7,p:Dr,q:k7,Q:B7,s:N7,S:D7,u:C7,U:A7,V:T7,w:E7,W:M7,x:Ds,X:pu,y:v6,Y:d6,Z:P7,"%":z7};at.x=Yt(r,at),at.X=Yt(n,at),at.c=Yt(a,at),Tt.x=Yt(r,Tt),Tt.X=Yt(n,Tt),Tt.c=Yt(a,Tt);function Yt(ns,ql){return function(jc){var xa=[],um=-1,wf=0,Rm=ns.length,Dm,Wy,rR;for(jc instanceof Date||(jc=new Date(+jc));++um<Rm;)ns.charCodeAt(um)===37&&(xa.push(ns.slice(wf,um)),(Wy=p6[Dm=ns.charAt(++um)])!=null?Dm=ns.charAt(++um):Wy=Dm==="e"?" ":"0",(rR=ql[Dm])&&(Dm=rR(jc,Wy)),xa.push(Dm),wf=um+1);return xa.push(ns.slice(wf,um)),xa.join("")}}function cr(ns,ql){return function(jc){var xa=tx(1900,void 0,1),um=Mr(xa,ns,jc+="",0),wf,Rm;if(um!=jc.length)return null;if("Q"in xa)return new Date(xa.Q);if("s"in xa)return new Date(xa.s*1e3+("L"in xa?xa.L:0));if(ql&&!("Z"in xa)&&(xa.Z=0),"p"in xa&&(xa.H=xa.H%12+xa.p*12),xa.m===void 0&&(xa.m="q"in xa?xa.q:0),"V"in xa){if(xa.V<1||xa.V>53)return null;"w"in xa||(xa.w=1),"Z"in xa?(wf=W4(tx(xa.y,0,1)),Rm=wf.getUTCDay(),wf=Rm>4||Rm===0?R3.ceil(wf):R3(wf),wf=f6.offset(wf,(xa.V-1)*7),xa.y=wf.getUTCFullYear(),xa.m=wf.getUTCMonth(),xa.d=wf.getUTCDate()+(xa.w+6)%7):(wf=$4(tx(xa.y,0,1)),Rm=wf.getDay(),wf=Rm>4||Rm===0?I3.ceil(wf):I3(wf),wf=G4.offset(wf,(xa.V-1)*7),xa.y=wf.getFullYear(),xa.m=wf.getMonth(),xa.d=wf.getDate()+(xa.w+6)%7)}else("W"in xa||"U"in xa)&&("w"in xa||(xa.w="u"in xa?xa.u%7:"W"in xa?1:0),Rm="Z"in xa?W4(tx(xa.y,0,1)).getUTCDay():$4(tx(xa.y,0,1)).getDay(),xa.m=0,xa.d="W"in xa?(xa.w+6)%7+xa.W*7-(Rm+5)%7:xa.w+xa.U*7-(Rm+6)%7);return"Z"in xa?(xa.H+=xa.Z/100|0,xa.M+=xa.Z%100,W4(xa)):$4(xa)}}function Mr(ns,ql,jc,xa){for(var um=0,wf=ql.length,Rm=jc.length,Dm,Wy;um<wf;){if(xa>=Rm)return-1;if(Dm=ql.charCodeAt(um++),Dm===37){if(Dm=ql.charAt(um++),Wy=kt[Dm in p6?ql.charAt(um++):Dm],!Wy||(xa=Wy(ns,jc,xa))<0)return-1}else if(Dm!=jc.charCodeAt(xa++))return-1}return xa}function Dr(ns,ql,jc){var xa=E.exec(ql.slice(jc));return xa?(ns.p=R[xa[0].toLowerCase()],jc+xa[0].length):-1}function sn(ns,ql,jc){var xa=Q.exec(ql.slice(jc));return xa?(ns.w=ce[xa[0].toLowerCase()],jc+xa[0].length):-1}function rn(ns,ql,jc){var xa=B.exec(ql.slice(jc));return xa?(ns.w=Y[xa[0].toLowerCase()],jc+xa[0].length):-1}function Jn(ns,ql,jc){var xa=Ve.exec(ql.slice(jc));return xa?(ns.m=st[xa[0].toLowerCase()],jc+xa[0].length):-1}function fi(ns,ql,jc){var xa=fe.exec(ql.slice(jc));return xa?(ns.m=Te[xa[0].toLowerCase()],jc+xa[0].length):-1}function Hi(ns,ql,jc){return Mr(ns,a,ql,jc)}function Ds(ns,ql,jc){return Mr(ns,r,ql,jc)}function pu(ns,ql,jc){return Mr(ns,n,ql,jc)}function $s(ns){return u[ns.getDay()]}function Pc(ns){return o[ns.getDay()]}function lc(ns){return g[ns.getMonth()]}function up(ns){return f[ns.getMonth()]}function Xg(ns){return t[+(ns.getHours()>=12)]}function Uv(ns){return 1+~~(ns.getMonth()/3)}function $0(ns){return u[ns.getUTCDay()]}function a_(ns){return o[ns.getUTCDay()]}function tf(ns){return g[ns.getUTCMonth()]}function Av(ns){return f[ns.getUTCMonth()]}function fE(ns){return t[+(ns.getUTCHours()>=12)]}function pE(ns){return 1+~~(ns.getUTCMonth()/3)}return{format:function(ns){var ql=Yt(ns+="",at);return ql.toString=function(){return ns},ql},parse:function(ns){var ql=cr(ns+="",!1);return ql.toString=function(){return ns},ql},utcFormat:function(ns){var ql=Yt(ns+="",Tt);return ql.toString=function(){return ns},ql},utcParse:function(ns){var ql=cr(ns+="",!0);return ql.toString=function(){return ns},ql}}}var p6={"-":"",_:" ",0:"0"},Hd=/^\s*\d+/,x7=/^%/,w7=/[\\^$*+?|[\]().{}]/g;function Zc(e,a,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(a)+t:t)}function S7(e){return e.replace(w7,"\\$&")}function rx(e){return new RegExp("^(?:"+e.map(S7).join("|")+")","i")}function nx(e){for(var a={},r=-1,n=e.length;++r<n;)a[e[r].toLowerCase()]=r;return a}function E7(e,a,r){var n=Hd.exec(a.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function C7(e,a,r){var n=Hd.exec(a.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function A7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function T7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function M7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function d6(e,a,r){var n=Hd.exec(a.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function v6(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function P7(e,a,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function k7(e,a,r){var n=Hd.exec(a.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function I7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function m6(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function L7(e,a,r){var n=Hd.exec(a.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function g6(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function R7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function D7(e,a,r){var n=Hd.exec(a.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function O7(e,a,r){var n=Hd.exec(a.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function F7(e,a,r){var n=Hd.exec(a.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function z7(e,a,r){var n=x7.exec(a.slice(r,r+1));return n?r+n[0].length:-1}function B7(e,a,r){var n=Hd.exec(a.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function N7(e,a,r){var n=Hd.exec(a.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function y6(e,a){return Zc(e.getDate(),a,2)}function Z7(e,a){return Zc(e.getHours(),a,2)}function U7(e,a){return Zc(e.getHours()%12||12,a,2)}function j7(e,a){return Zc(1+G4.count($1(e),e),a,3)}function _6(e,a){return Zc(e.getMilliseconds(),a,3)}function V7(e,a){return _6(e,a)+"000"}function G7(e,a){return Zc(e.getMonth()+1,a,2)}function H7(e,a){return Zc(e.getMinutes(),a,2)}function $7(e,a){return Zc(e.getSeconds(),a,2)}function W7(e){var a=e.getDay();return a===0?7:a}function X7(e,a){return Zc(V4.count($1(e)-1,e),a,2)}function b6(e){var a=e.getDay();return a>=4||a===0?W1(e):W1.ceil(e)}function Y7(e,a){return e=b6(e),Zc(W1.count($1(e),e)+($1(e).getDay()===4),a,2)}function q7(e){return e.getDay()}function K7(e,a){return Zc(I3.count($1(e)-1,e),a,2)}function J7(e,a){return Zc(e.getFullYear()%100,a,2)}function Q7(e,a){return e=b6(e),Zc(e.getFullYear()%100,a,2)}function eD(e,a){return Zc(e.getFullYear()%1e4,a,4)}function tD(e,a){var r=e.getDay();return e=r>=4||r===0?W1(e):W1.ceil(e),Zc(e.getFullYear()%1e4,a,4)}function rD(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+Zc(a/60|0,"0",2)+Zc(a%60,"0",2)}function x6(e,a){return Zc(e.getUTCDate(),a,2)}function nD(e,a){return Zc(e.getUTCHours(),a,2)}function iD(e,a){return Zc(e.getUTCHours()%12||12,a,2)}function aD(e,a){return Zc(1+f6.count(ex(e),e),a,3)}function w6(e,a){return Zc(e.getUTCMilliseconds(),a,3)}function oD(e,a){return w6(e,a)+"000"}function sD(e,a){return Zc(e.getUTCMonth()+1,a,2)}function uD(e,a){return Zc(e.getUTCMinutes(),a,2)}function lD(e,a){return Zc(e.getUTCSeconds(),a,2)}function cD(e){var a=e.getUTCDay();return a===0?7:a}function hD(e,a){return Zc(c6.count(ex(e)-1,e),a,2)}function S6(e){var a=e.getUTCDay();return a>=4||a===0?X1(e):X1.ceil(e)}function fD(e,a){return e=S6(e),Zc(X1.count(ex(e),e)+(ex(e).getUTCDay()===4),a,2)}function pD(e){return e.getUTCDay()}function dD(e,a){return Zc(R3.count(ex(e)-1,e),a,2)}function vD(e,a){return Zc(e.getUTCFullYear()%100,a,2)}function mD(e,a){return e=S6(e),Zc(e.getUTCFullYear()%100,a,2)}function gD(e,a){return Zc(e.getUTCFullYear()%1e4,a,4)}function yD(e,a){var r=e.getUTCDay();return e=r>=4||r===0?X1(e):X1.ceil(e),Zc(e.getUTCFullYear()%1e4,a,4)}function _D(){return"+0000"}function E6(){return"%"}function C6(e){return+e}function A6(e){return Math.floor(+e/1e3)}var Y1,T6,bD,xD,wD;SD({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function SD(e){return Y1=b7(e),T6=Y1.format,bD=Y1.parse,xD=Y1.utcFormat,wD=Y1.utcParse,Y1}var ix=1e3,ax=ix*60,ox=ax*60,sx=ox*24,ED=sx*7,M6=sx*30,X4=sx*365;function CD(e){return new Date(e)}function AD(e){return e instanceof Date?+e:+new Date(+e)}function P6(e,a,r,n,t,o,u,f,g){var E=Fk(Cv,Cv),R=E.invert,B=E.domain,Y=g(".%L"),Q=g(":%S"),ce=g("%I:%M"),fe=g("%I %p"),Te=g("%a %d"),Ve=g("%b %d"),st=g("%B"),at=g("%Y"),Tt=[[u,1,ix],[u,5,5*ix],[u,15,15*ix],[u,30,30*ix],[o,1,ax],[o,5,5*ax],[o,15,15*ax],[o,30,30*ax],[t,1,ox],[t,3,3*ox],[t,6,6*ox],[t,12,12*ox],[n,1,sx],[n,2,2*sx],[r,1,ED],[a,1,M6],[a,3,3*M6],[e,1,X4]];function kt(cr){return(u(cr)<cr?Y:o(cr)<cr?Q:t(cr)<cr?ce:n(cr)<cr?fe:a(cr)<cr?r(cr)<cr?Te:Ve:e(cr)<cr?st:at)(cr)}function Yt(cr,Mr,Dr,sn){if(cr==null&&(cr=10),typeof cr=="number"){var rn=Math.abs(Dr-Mr)/cr,Jn=dk(function(fi){return fi[2]}).right(Tt,rn);Jn===Tt.length?(sn=P4(Mr/X4,Dr/X4,cr),cr=e):Jn?(Jn=Tt[rn/Tt[Jn-1][2]<Tt[Jn][2]/rn?Jn-1:Jn],sn=Jn[1],cr=Jn[0]):(sn=Math.max(P4(Mr,Dr,cr),1),cr=f)}return sn==null?cr:cr.every(sn)}return E.invert=function(cr){return new Date(R(cr))},E.domain=function(cr){return arguments.length?B(Mk.call(cr,AD)):B().map(CD)},E.ticks=function(cr,Mr){var Dr=B(),sn=Dr[0],rn=Dr[Dr.length-1],Jn=rn<sn,fi;return Jn&&(fi=sn,sn=rn,rn=fi),fi=Yt(cr,sn,rn,Mr),fi=fi?fi.range(sn,rn+1):[],Jn?fi.reverse():fi},E.tickFormat=function(cr,Mr){return Mr==null?kt:g(Mr)},E.nice=function(cr,Mr){var Dr=B();return(cr=Yt(cr,Dr[0],Dr[Dr.length-1],Mr))?B(Hk(Dr,cr)):E},E.copy=function(){return A3(E,P6(e,a,r,n,t,o,u,f,g))},E}function TD(){return j0.apply(P6($1,s7,V4,G4,f7,p7,d7,v7,T6).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function GB(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function D3(){var e=0,a=1,r,n,t,o,u=Cv,f=!1,g;function E(R){return isNaN(R=+R)?g:u(t===0?.5:(R=(o(R)-r)*t,f?Math.max(0,Math.min(1,R)):R))}return E.domain=function(R){return arguments.length?(r=o(e=+R[0]),n=o(a=+R[1]),t=r===n?0:1/(n-r),E):[e,a]},E.clamp=function(R){return arguments.length?(f=!!R,E):f},E.interpolator=function(R){return arguments.length?(u=R,E):u},E.unknown=function(R){return arguments.length?(g=R,E):g},function(R){return o=R,r=R(e),n=R(a),t=r===n?0:1/(n-r),E}}function ux(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function k6(){var e=Jb(D3()(Cv));return e.copy=function(){return ux(e,k6())},Pk.apply(e,arguments)}function MD(){var e=loggish(D3()).domain([1,10]);return e.copy=function(){return ux(e,MD()).base(e.base())},initInterpolator.apply(e,arguments)}function PD(){var e=symlogish(D3());return e.copy=function(){return ux(e,PD()).constant(e.constant())},initInterpolator.apply(e,arguments)}function I6(){var e=powish(D3());return e.copy=function(){return ux(e,I6()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function HB(){return I6.apply(null,arguments).exponent(.5)}function kD(){var e=[],a=identity;function r(n){if(!isNaN(n=+n))return a((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(a=n,r):a},r.copy=function(){return kD(a).domain(e)},initInterpolator.apply(r,arguments)}function O3(){var e=0,a=.5,r=1,n,t,o,u,f,g=Cv,E,R=!1,B;function Y(Q){return isNaN(Q=+Q)?B:(Q=.5+((Q=+E(Q))-t)*(Q<t?u:f),g(R?Math.max(0,Math.min(1,Q)):Q))}return Y.domain=function(Q){return arguments.length?(n=E(e=+Q[0]),t=E(a=+Q[1]),o=E(r=+Q[2]),u=n===t?0:.5/(t-n),f=t===o?0:.5/(o-t),Y):[e,a,r]},Y.clamp=function(Q){return arguments.length?(R=!!Q,Y):R},Y.interpolator=function(Q){return arguments.length?(g=Q,Y):g},Y.unknown=function(Q){return arguments.length?(B=Q,Y):B},function(Q){return E=Q,n=Q(e),t=Q(a),o=Q(r),u=n===t?0:.5/(t-n),f=t===o?0:.5/(o-t),Y}}function L6(){var e=Jb(O3()(Cv));return e.copy=function(){return ux(e,L6())},Pk.apply(e,arguments)}function ID(){var e=loggish(O3()).domain([.1,1,10]);return e.copy=function(){return copy(e,ID()).base(e.base())},initInterpolator.apply(e,arguments)}function LD(){var e=symlogish(O3());return e.copy=function(){return copy(e,LD()).constant(e.constant())},initInterpolator.apply(e,arguments)}function R6(){var e=powish(O3());return e.copy=function(){return copy(e,R6()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function $B(){return R6.apply(null,arguments).exponent(.5)}function D6(e){var a,r=[];function n(t){return t==null?a:t}return n.invert=n,n.domain=n.range=function(t){return t?(r=t,t):r},n.unknown=function(t){return t?(a=t,t):a},n.copy=function(){return D6(e).unknown(a)},n}var Im,O6,F6,Y4=Ga.isNil,RD=Ga.isString,DD=Ga.uniq,OD=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,FD=(Im={},(0,Pe.Z)(Im,Xl.LINEAR,Gk),(0,Pe.Z)(Im,Xl.POWER,N4),(0,Pe.Z)(Im,Xl.LOG,Yk),(0,Pe.Z)(Im,Xl.IDENTITY,D6),(0,Pe.Z)(Im,Xl.SEQUENTIAL,k6),(0,Pe.Z)(Im,Xl.TIME,TD),(0,Pe.Z)(Im,Xl.QUANTILE,Qk),(0,Pe.Z)(Im,Xl.QUANTIZE,e6),(0,Pe.Z)(Im,Xl.THRESHOLD,t6),(0,Pe.Z)(Im,Xl.CAT,E3),(0,Pe.Z)(Im,Xl.DIVERGING,L6),Im),zD=(O6=(0,Ii.b2)(),O6(F6=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"scaleOptions",{})}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,mr.Z)(x().mark(function u(){var f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(r.log(Qh.ScaleInitStart,zs.INIT),t.scaleOptions=r.getScaleOptions(),g=o.getLayerStyleAttributes(),E=(f=r.getSource())===null||f===void 0?void 0:f.data.dataArray,!(Array.isArray(E)&&E.length===0)){B.next=8;break}return B.abrupt("return");case 8:t.caculateScalesForAttributes(g||[],E);case 9:r.log(Qh.ScaleInitEnd,zs.INIT);case 10:case"end":return B.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,mr.Z)(x().mark(function f(g){var E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(g){Y.next=2;break}return Y.abrupt("return",g);case 2:if(r.log(Qh.ScaleInitStart,zs.UPDATE),t.scaleOptions=r.getScaleOptions(),E=o.getLayerStyleAttributes(),R=r.getSource().data.dataArray,!(Array.isArray(R)&&R.length===0)){Y.next=8;break}return Y.abrupt("return",!0);case 8:return t.caculateScalesForAttributes(E||[],R),r.log(Qh.ScaleInitEnd,zs.UPDATE),r.layerModelNeedUpdate=!0,Y.abrupt("return",!0);case 12:case"end":return Y.stop()}},f)}));return function(f){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),f=r.getSource().data.dataArray;if(!(Array.isArray(f)&&f.length===0)&&u){var g=u.filter(function(E){return E.needRescale});g.length&&t.caculateScalesForAttributes(g,f)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale,f=o.scale.field;u.names=t.parseFields(Y4(f)?[]:f);var g=[];u.names.forEach(function(E){var R;g.push(t.createScale(E,o.name,(R=o.scale)===null||R===void 0?void 0:R.values,n))}),g.some(function(E){return E.type===Em.VARIABLE})?(u.type=Em.VARIABLE,g.forEach(function(E){if(!u.callback&&u.values!=="text"){var R;switch((R=E.option)===null||R===void 0?void 0:R.type){case Xl.LOG:case Xl.LINEAR:case Xl.POWER:if(u.values&&u.values.length>2){var B=E.scale.ticks(u.values.length);E.scale.domain(B)}u.values?E.scale.range(u.values):E.scale.range(E.option.domain);break;case Xl.QUANTILE:case Xl.QUANTIZE:case Xl.THRESHOLD:E.scale.range(u.values);break;case Xl.IDENTITY:break;case Xl.CAT:u.values?E.scale.range(u.values):E.scale.range(E.option.domain);break;case Xl.DIVERGING:case Xl.SEQUENTIAL:E.scale.interpolator(xR(u.values));break}}if(u.values==="text"){var Y;E.scale.range((Y=E.option)===null||Y===void 0?void 0:Y.domain)}})):(u.type=Em.CONSTANT,u.defaultValues=g.map(function(E,R){return E.scale(u.names[R])})),u.scalers=g.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:RD(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,f,g=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],E={field:r,scale:void 0,type:Em.VARIABLE,option:g};if(!o||!o.length)return g&&g.type?E.scale=this.createDefaultScale(g):(E.scale=E3([r]),E.type=Em.CONSTANT),E;var R=(f=o.find(function(Q){return!Y4(Q[r])}))===null||f===void 0?void 0:f[r];if(this.isNumber(r)||Y4(R)&&!g)E.scale=E3([r]),E.type=Em.CONSTANT;else{var B=g&&g.type||this.getDefaultType(R);t==="text"&&(B=Xl.CAT),t===void 0&&(B=Xl.IDENTITY);var Y=this.createScaleConfig(B,r,g,o);E.scale=this.createDefaultScale(Y),E.option=Y}return E}},{key:"getDefaultType",value:function(r){var n=Xl.LINEAR;return typeof r=="string"&&(n=OD.test(r)?Xl.TIME:Xl.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},f=(o==null?void 0:o.map(function(R){return R[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r===Xl.CAT||r===Xl.IDENTITY)u.domain=DD(f);else if(r===Xl.QUANTILE)u.domain=f;else if(r===Xl.DIVERGING){var g=mk(f),E=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(g[0]+g[1])/2;u.domain=[g[0],E,g[1]]}else u.domain=mk(f);return(0,Ee.Z)((0,Ee.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,f=r.nice,g=FD[n]();return t&&g.domain&&g.domain(t),o&&g.unknown(o),u!==void 0&&g.clamp&&g.clamp(u),f!==void 0&&g.nice&&g.nice(f),g}}]),e}())||F6),z6,B6,BD=(z6=(0,Ii.b2)(),z6(B6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,Ee.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||B6),N6,Z6,ND=(N6=(0,Ii.b2)(),N6(Z6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),t=n.maskLayers,o=n.enableMask;if(!r.tileLayer&&t&&t.length>0){var u;(u=r.masks).push.apply(u,(0,Vn.Z)(t)),r.updateLayerConfig({mask:o})}})}}]),e}())||Z6),ZD=function(){function e(a){var r=a.rendererService,n=a.layerService,t=a.parent;(0,Be.Z)(this,e),(0,Pe.Z)(this,"tileResource",new Map),(0,Pe.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,Me.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(o){return o.key===r}),t=this.layerTiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);if(r.isVisible)if(r.parent){var t=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(t)}else n==null||n.updateVisible(!0);else if(r.parent){var o=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(!o)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.every(function(o){var u=n.getTile(o==null?void 0:o.key);return u?(u==null?void 0:u.isLoaded)===!0:!0})}},{key:"render",value:function(){var a=(0,mr.Z)(x().mark(function n(){var t=this,o,u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=this.getRenderLayers(),u=o.map(function(){var E=(0,mr.Z)(x().mark(function R(B){return x().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,t.layerService.renderTileLayer(B);case 2:case"end":return Q.stop()}},R)}));return function(R){return E.apply(this,arguments)}}()),g.next=4,Promise.all(u);case 4:case"end":return g.stop()}},n,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,Vn.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,Vn.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),UD=G(32676);function jD(e,a,r){r===void 0&&(r={});var n=Yi(e),t=Yi(a),o=UD.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?pi(o[0],r.properties):qo(o,r.properties)}var VD=jD,GD=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=pi(o.coordinates);n===null?n=u:n=VD(n,u)}),t&&(n.properties=(0,Ee.Z)({},t)),n}}]),e}(),lx="select",cx="active",HD=function(){function e(a){var r=a.layerService,n=a.tileLayerService,t=a.parent;(0,Be.Z)(this,e),(0,Pe.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new GD}return(0,Me.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(cn.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var f=u.getMainLayer();return f.layerPickService.pickRasterLayer(f,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,gi.Z)(r,3),t=n[0],o=n[1],u=n[2],f=this.color2PickId(t,o,u);this.tilePickID.set(lx,f),this.updateHighLight(t,o,u,lx)}},{key:"highlightPickedFeature",value:function(r){var n=(0,gi.Z)(r,3),t=n[0],o=n[1],u=n[2],f=this.color2PickId(t,o,u);this.tilePickID.set(cx,f),this.updateHighLight(t,o,u,cx)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var f=u.getMainLayer();switch(o){case lx:f==null||f.hooks.beforeSelect.call([r,n,t]);break;case cx:f==null||f.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(lx),n=this.tilePickID.get(cx);if(r){var t=this.pickId2Color(r),o=(0,gi.Z)(t,3),u=o[0],f=o[1],g=o[2];this.updateHighLight(u,f,g,lx);return}if(n){var E=this.pickId2Color(n),R=(0,gi.Z)(E,3),B=R[0],Y=R[1],Q=R[2];this.updateHighLight(B,Y,Q,cx);return}}},{key:"color2PickId",value:function(r,n,t){return cc(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return uu(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.forEach(function(o){t.push.apply(t,(0,Vn.Z)(o.getFeatureById(r)))}),t}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}();function $D(e){return e==="PolygonLayer"?mh:e==="LineLayer"?Zb:Zi}function WD(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function XD(e){var a=YD();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function YD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ny=function(e){(0,yt.Z)(r,e);var a=XD(r);function r(n,t){var o;return(0,Be.Z)(this,r),o=a.call(this),(0,Pe.Z)((0,D.Z)(o),"visible",!0),(0,Pe.Z)((0,D.Z)(o),"layers",[]),(0,Pe.Z)((0,D.Z)(o),"isLoaded",!1),(0,Pe.Z)((0,D.Z)(o),"tileMaskLayers",[]),o.parent=t,o.sourceTile=n,o.x=n.x,o.y=n.y,o.z=n.z,o.key="".concat(o.x,"_").concat(o.y,"_").concat(o.z),o}return(0,Me.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var o=(0,gi.Z)(this.sourceTile.bounds,4),u=o[0],f=o[1],g=o[2],E=o[3],R=t.lng,B=t.lat;return R>=u&&R<=g&&B>=f&&B<=E}},{key:"getLayerOptions",value:function(){var t,o=this.parent.getLayerConfig();return(0,Ee.Z)((0,Ee.Z)({},o),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:WD(this.parent.type),mask:o.mask||((t=o.maskLayers)===null||t===void 0?void 0:t.length)!==0&&o.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,o=this.parent.getLayerConfig(),u=o.maskLayers,f=[];return u==null||u.forEach(function(g){if(!g.tileLayer)return f.push(g),g;var E=g.tileLayer,R=E.getTile(t.sourceTile.key),B=R==null?void 0:R.getLayers()[0];B&&f.push(B)}),f}},{key:"addTileMask",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=new mh({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),f=w0(this.parent.sceneContainer),u.setContainer(f,this.parent.sceneContainer),R.next=5,u.init();case 5:return this.tileMask=u,g=this.getMainLayer(),g!==void 0&&(g.tileMask=u),R.abrupt("return",u);case 9:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addMask",value:function(){var n=(0,mr.Z)(x().mark(function o(u,f){var g;return x().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return g=w0(this.parent.sceneContainer),f.setContainer(g,this.parent.sceneContainer),R.next=4,f.init();case 4:u.addMask(f),this.tileMaskLayers.push(f);case 6:case"end":return R.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(u){var f;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u.isTileLayer=!0,f=w0(this.parent.sceneContainer),u.setContainer(f,this.parent.sceneContainer),this.layers.push(u),E.next=6,u.init();case 6:case"end":return E.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,o){this.layers.forEach(function(u){u.updateLayerConfig((0,Pe.Z)({},t,o))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(function(o){return o.destroy()})}}]),r}(Z.EventEmitter);function qD(e){var a=KD();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function KD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JD=function(e){(0,yt.Z)(r,e);var a=qD(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.getSourceOption(),f=u.data.features[0].properties,g=new Zb().source(u.data,u.options).size(1).shape("line").color("red"),E=new Zi({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([f],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),B.next=6,this.addLayer(g);case 6:return B.next=8,this.addLayer(E);case 8:this.isLoaded=!0;case 9:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(Ny);function QD(e){var a=e8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function e8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t8=function(e){(0,yt.Z)(r,e);var a=QD(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=this.getSourceOption(),E=new Ob((0,Ee.Z)({},f)).source(g.data,g.options),u&&Object.keys(u).forEach(function(Y){var Q,ce,fe=Y;E[fe]((Q=u[fe])===null||Q===void 0?void 0:Q.field,(ce=u[fe])===null||ce===void 0?void 0:ce.values)}),B.next=7,this.addLayer(E);case 7:this.isLoaded=!0;case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ny);function r8(e){var a=n8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function n8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i8=function(e){(0,yt.Z)(r,e);var a=r8(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=this.getSourceOption(),E=new fu((0,Ee.Z)({},f)).source(g.data,g.options),u&&Object.keys(u).forEach(function(Y){var Q,ce,fe=Y;E[fe]((Q=u[fe])===null||Q===void 0?void 0:Q.field,(ce=u[fe])===null||ce===void 0?void 0:ce.values)}),B.next=7,this.addLayer(E);case 7:this.isLoaded=!0;case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,f=o.featureId,g=this.getFeatures(u);return{data:{type:"FeatureCollection",features:g},options:{parser:{type:"geojson",featureId:f},transforms:t.transforms}}}}]),r}(Ny),a8=["rasterData"];function o8(e){var a=s8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function s8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u8=function(e){(0,yt.Z)(r,e);var a=o8(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=this.getSourceOption(),E=new pa((0,Ee.Z)({},f)).source(g.data,g.options),u&&Object.keys(u).forEach(function(Y){var Q,ce,fe=Y;E[fe]((Q=u[fe])===null||Q===void 0?void 0:Q.field,(ce=u[fe])===null||ce===void 0?void 0:ce.values)}),B.next=7,this.addLayer(E);case 7:this.isLoaded=!0;case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,f=(0,Uh.Z)(o,a8);return{data:u,options:{parser:(0,Ee.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},f),transforms:t.transforms}}}}]),r}(Ny);function l8(e){var a=c8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function c8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h8=function(e){(0,yt.Z)(r,e);var a=l8(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E;return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=this.getSourceOption(),E=new pa((0,Ee.Z)({},f)).source(g.data,g.options),u&&Object.keys(u).forEach(function(Y){var Q,ce,fe=Y;E[fe]((Q=u[fe])===null||Q===void 0?void 0:Q.field,(ce=u[fe])===null||ce===void 0?void 0:ce.values)}),B.next=7,this.addLayer(E);case 7:this.isLoaded=!0;case 8:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ny),f8=["rasterData"];function p8(e){var a=d8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function d8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v8={positions:[0,1],colors:["#000","#fff"]},m8=function(e){(0,yt.Z)(r,e);var a=p8(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y;return x().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=this.getSourceOption(),E=this.getLayerOptions(),R=E.rampColors,B=E.domain,this.colorTexture=this.parent.textureService.getColorTexture(R,B),Y=new pa((0,Ee.Z)((0,Ee.Z)({},f),{},{colorTexture:this.colorTexture})).source(g.data,g.options),u&&Object.keys(u).forEach(function(fe){var Te,Ve,st=fe;Y[st]((Te=u[st])===null||Te===void 0?void 0:Te.field,(Ve=u[st])===null||Ve===void 0?void 0:Ve.values)}),ce.next=9,this.addLayer(Y);case 9:this.isLoaded=!0;case 10:case"end":return ce.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,f=(0,Uh.Z)(o,f8);return{data:u,options:{parser:(0,Ee.Z)({type:"raster",extent:this.sourceTile.bounds},f),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];var g=u,E=g.rampColors,R=E===void 0?v8:E,B=g.domain;this.colorTexture=this.parent.textureService.getColorTexture(R,B||vu(R)),this.layers.forEach(function(Y){return Y.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(Ny);function g8(e){var a=y8();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function y8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F3=function(e){(0,yt.Z)(r,e);var a=g8(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R;return x().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(u=this.parent.getLayerAttributeConfig(),f=this.getLayerOptions(),g=$D(this.parent.type),E=this.getSourceOption(),E){Y.next=8;break}return this.isLoaded=!0,this.emit("loaded"),Y.abrupt("return");case 8:return R=new g((0,Ee.Z)({},f)).source(E.data,E.options),Object.keys(u).forEach(function(Q){var ce,fe,Te=Q;R[Te]((ce=u[Te])===null||ce===void 0?void 0:ce.field,(fe=u[Te])===null||fe===void 0?void 0:fe.values)}),Y.next=12,this.addLayer(R);case 12:if(!f.tileMask){Y.next=15;break}return Y.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(R),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,f=u===void 0?"defaultLayer":u,g=o.featureId,E=g===void 0?"id":g,R=this.getFeatures(f);return{data:{type:"FeatureCollection",features:R},options:{parser:{type:"geojson",featureId:E},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(f){return f._id===t});return u}}]),r}(Ny);function _8(e){var a=e.type;switch(a){case"PolygonLayer":return F3;case"LineLayer":return F3;case"PointLayer":return F3;case"TileDebugLayer":return JD;case"MaskLayer":return i8;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case Up.RGB:case Up.CUSTOMRGB:return u8;case Up.ARRAYBUFFER:case Up.CUSTOMARRAYBUFFER:return m8;case Up.TERRAINRGB:case Up.CUSTOMTERRAINRGB:return h8;default:return t8}default:return F3}}var b8=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],x8=Ga.debounce,U6=function(){function e(a){var r=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"initedTileset",!1),(0,Pe.Z)(this,"mapchange",function(){var t;if(r.parent.isVisible()!==!1){var o=r.getCurrentView(),u=o.latLonBounds,f=o.zoom;if(r.mapService.version==="GAODE1.x"){var g=r.parent.getLayerConfig(),E=g.visible;f<2&&E?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):f>=2&&!E&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===f&&r.lastViewStates.latLonBounds.toString()===u.toString()||(r.lastViewStates={zoom:f,latLonBounds:u},(t=r.tilesetManager)===null||t===void 0||t.throttleUpdate(f,u))}}),(0,Pe.Z)(this,"viewchange",x8(this.mapchange,24)),this.parent=a;var n=this.parent.getContainer();this.rendererService=n.get(cn.IRendererService),this.layerService=n.get(cn.ILayerService),this.mapService=n.get(cn.IMapService),this.pickingService=n.get(cn.IPickingService),this.tileLayerService=new ZD({rendererService:this.rendererService,layerService:this.layerService,parent:a}),this.tilePickService=new HD({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:a}),this.parent.setLayerPickService(this.tilePickService),this.proxy(a),this.initTileSetManager()}return(0,Me.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(o,t)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var a=(0,mr.Z)(x().mark(function n(){var t=this,o,u;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.tilesetManager){g.next=2;break}return g.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),g.next=6,Promise.all(this.tilesetManager.tiles.filter(function(E){return E.isLoaded}).filter(function(E){return E.isVisibleChange}).filter(function(E){return E.data}).filter(function(E){return E.z>=o&&E.z<u}).map(function(){var E=(0,mr.Z)(x().mark(function R(B){var Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:if(t.tileLayerService.hasTile(B.key)){fe.next=9;break}return Y=_8(t.parent),Q=new Y(B,t.parent),fe.next=5,Q.initTileLayer();case 5:t.tilePickService.setPickState(),Q.getLayers().length!==0&&(t.tileLayerService.addTile(Q),t.tileLayerService.updateTileVisible(B),t.layerService.reRender()),fe.next=12;break;case 9:t.tileLayerService.updateTileVisible(B),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return fe.stop()}},R)}));return function(R){return E.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return g.stop()}},n,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;b8.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return o.apply(void 0,f),n.getLayers().map(function(E){E[t].apply(E,f)}),t==="style"&&n.getTiles().forEach(function(E){return E.styleUpdate.apply(E,f)}),r}})}}]),e}(),j6,V6,w8=(j6=(0,Ii.b2)(),j6(V6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"build",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,mr.Z)(x().mark(function t(){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new U6(r),u.abrupt("return");case 4:return r.log(Qh.BuildModelStart,zs.INIT),u.next=7,n.initLayerModel(r);case 7:r.log(Qh.BuildModelEnd,zs.INIT);case 8:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,mr.Z)(x().mark(function o(u){return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u){g.next=2;break}return g.abrupt("return",!1);case 2:if(!r.getSource().isTile){g.next=5;break}return r.tileLayer=new U6(r),g.abrupt("return",!1);case 5:return r.log(Qh.BuildModelStart,zs.UPDATE),g.next=8,n.prepareLayerModel(r);case 8:return r.log(Qh.BuildModelEnd,zs.UPDATE),g.abrupt("return",!0);case 10:case"end":return g.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||V6),G6,H6,S8=(G6=(0,Ii.b2)(),G6(H6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o),r.styleNeedUpdate=!1})}}]),e}())||H6),$6,W6,E8=["type"],X6={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},C8={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},A8={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},T8={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function M8(e){var a={u_DirectionalLights:new Array(3).fill((0,Ee.Z)({},A8)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Ee.Z)({},T8)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[C8]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,Uh.Z)(r,E8),u=X6[t].lights,f=X6[t].num,g=a[f];a[u][g]=(0,Ee.Z)((0,Ee.Z)({},a[u][g]),o),a[f]++}),a}var P8=($6=(0,Ii.b2)(),$6(W6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,Ee.Z)({},M8()))})})}}]),e}())||W6),Y6,q6,k8=(Y6=(0,Ii.b2)(),Y6(q6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,f=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),E=g.enableMultiPassRenderer,R=g.passes,B=R===void 0?[]:R;t.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=Jw(r,B,u,f),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var g=o.getViewportSize(),E=g.width,R=g.height;r.multiPassRenderer.resize(E,R)}})}}]),e}())||q6),K6,J6,z3={NONE:0,ENCODE:1,HIGHLIGHT:2},I8=(K6=(0,Ii.b2)(),K6(J6=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:Ni.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:Ke.FLOAT},size:3,update:function(g){var E=g.id;return u?uu(E):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(f){return f.addUniforms({u_PickingStage:z3.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(f){return f.addUniforms({u_PickingStage:z3.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),f=u.highlightColor,g=u.activeMix,E=g===void 0?0:g,R=typeof f=="string"?Mo(f):f||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:cc(new Uint8Array(o))}),r.models.forEach(function(B){return B.addUniforms({u_PickingStage:z3.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:R.map(function(Y){return Y*255}),u_activeMix:E})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),f=u.selectColor,g=u.selectMix,E=g===void 0?0:g,R=typeof f=="string"?Mo(f):f||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:cc(new Uint8Array(o))}),r.models.forEach(function(B){return B.addUniforms({u_PickingStage:z3.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:R.map(function(Y){return Y*255}),u_activeMix:E,u_CurrentSelectedId:o,u_SelectColor:R.map(function(Y){return Y*255}),u_EnableSelect:1})})})}}]),e}())||J6),L8=["mvt","geojsonvt","testTile"];function R8(e){var a=e.getSource();return L8.includes(a.parser.type)}function WB(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Q6,eI,D8=(Q6=(0,Ii.b2)(),Q6(eI=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){R8(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:Ni.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:Ke.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:Ni.Attribute,descriptor:{name:"filter",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:Ni.Attribute,descriptor:{name:"a_Color",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:Ni.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:Ke.DYNAMIC_DRAW,data:[],type:Ke.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||eI),tI,rI,nI,iI,aI,oI,q1,sI,uI,lI,cI,O8=(tI=(0,Ii.b2)(),rI=(0,Ii.f3)(cn.ICameraService),nI=(0,Ii.f3)(cn.ICoordinateSystemService),iI=(0,Ii.f3)(cn.IRendererService),aI=(0,Ii.f3)(cn.IMapService),tI(oI=(q1=function(){function e(){(0,Be.Z)(this,e),yo(this,"cameraService",sI,this),yo(this,"coordinateSystemService",uI,this),yo(this,"rendererService",lI,this),yo(this,"mapService",cI,this)}return(0,Me.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(f),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var g=n.rendererService.getViewportSize(),E=g.width,R=g.height;r.models.forEach(function(B){var Y;B.addUniforms((Y={},(0,Pe.Z)(Y,Sm.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,Pe.Z)(Y,Sm.ViewMatrix,n.cameraService.getViewMatrix()),(0,Pe.Z)(Y,Sm.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,Pe.Z)(Y,Sm.Zoom,n.cameraService.getZoom()),(0,Pe.Z)(Y,Sm.ZoomScale,n.cameraService.getZoomScale()),(0,Pe.Z)(Y,Sm.FocalDistance,n.cameraService.getFocalDistance()),(0,Pe.Z)(Y,Sm.CameraPosition,n.cameraService.getCameraPosition()),(0,Pe.Z)(Y,jm.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,Pe.Z)(Y,jm.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,Pe.Z)(Y,jm.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,Pe.Z)(Y,jm.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,Pe.Z)(Y,jm.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,Pe.Z)(Y,jm.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,Pe.Z)(Y,jm.Mvp,o),(0,Pe.Z)(Y,"u_sceneCenterMercator",u),(0,Pe.Z)(Y,"u_ViewportSize",[E,R]),(0,Pe.Z)(Y,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,Pe.Z)(Y,"u_DevicePixelRatio",window.devicePixelRatio),(0,Pe.Z)(Y,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,Pe.Z)(Y,"u_shaderPick",Number(r.getShaderPickStat())),Y))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),sI=ro(q1.prototype,"cameraService",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=ro(q1.prototype,"coordinateSystemService",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lI=ro(q1.prototype,"rendererService",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cI=ro(q1.prototype,"mapService",[aI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1))||oI),hI,fI,F8=(hI=(0,Ii.b2)(),hI(fI=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||fI),pI,dI,z8=(pI=(0,Ii.b2)(),pI(dI=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(f){return f.needRegenerateVertices=!1});return}o.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){t.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex,r),f.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||dI);lv.bind(cn.ILayerPlugin).to(fR).inRequestScope(),lv.bind(cn.ILayerPlugin).to(D8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(zD).inRequestScope(),lv.bind(cn.ILayerPlugin).to(hR).inRequestScope(),lv.bind(cn.ILayerPlugin).to(S8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(ND).inRequestScope(),lv.bind(cn.ILayerPlugin).to(z8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(F8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(k8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(O8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(BD).inRequestScope(),lv.bind(cn.ILayerPlugin).to(P8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(I8).inRequestScope(),lv.bind(cn.ILayerPlugin).to(w8).inRequestScope();var vI,q4,mI,l0=(vI=sy(cn.IGlobalConfigService),q4=function(){function e(a){(0,Be.Z)(this,e),yo(this,"configService",mI,this),this.config=a}return(0,Me.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(cn.MapConfig).toConstantValue((0,Ee.Z)((0,Ee.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(cn.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),mI=ro(q4.prototype,"configService",[vI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q4),B8=G(81618),gI=G.n(B8);function hx(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function B3(e,a){var r=Jv([],a,e);return bm(r,r,1/r[3]),r}function XB(e,a){var r=e%a;return r<0?a+r:r}function YB(e,a,r){return r*a+(1-r)*e}function Zy(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var dg=Math.PI,yI=dg/4,c0=dg/180,_I=180/dg,K4=512,J4=4003e4,N8=1.5;function bI(e){return Math.pow(2,e)}function Z8(e){return Math.log2(e)}function N3(e,a){var r=(0,gi.Z)(e,2),n=r[0],t=r[1];Zy(Number.isFinite(n)&&Number.isFinite(a)),Zy(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),a*=K4;var o=n*c0,u=t*c0,f=a*(o+dg)/(2*dg),g=a*(dg-Math.log(Math.tan(yI+u*.5)))/(2*dg);return[f,g]}function Q4(e,a){var r=(0,gi.Z)(e,2),n=r[0],t=r[1];a*=K4;var o=n/a*(2*dg)-dg,u=2*(Math.atan(Math.exp(dg-t/a*(2*dg)))-yI);return[o*_I,u*_I]}function qB(e){var a=e.latitude;assert(Number.isFinite(a));var r=Math.cos(a*c0);return Z8(J4*r)-9}function xI(e){var a=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:bI(n),Zy(Number.isFinite(a)&&Number.isFinite(r)&&Number.isFinite(t));var f={},g=K4*t,E=Math.cos(a*c0),R=g/360,B=R/E,Y=g/J4/E;if(f.pixelsPerMeter=[Y,-Y,Y],f.metersPerPixel=[1/Y,-1/Y,1/Y],f.pixelsPerDegree=[R,-B,Y],f.degreesPerPixel=[1/R,-1/B,1/Y],u){var Q=c0*Math.tan(a*c0)/E,ce=R*Q/2,fe=g/J4*Q,Te=fe/B*Y;f.pixelsPerDegree2=[0,-ce,fe],f.pixelsPerMeter2=[Te,0,Te]}return f}function KB(e,a){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(a,3),f=u[0],g=u[1],E=u[2],R=1,B=xI({longitude:n,latitude:t,scale:R,highPrecision:!0}),Y=B.pixelsPerMeter,Q=B.pixelsPerMeter2,ce=N3(e,R);ce[0]+=f*(Y[0]+Q[0]*g),ce[1]+=g*(Y[1]+Q[1]*g);var fe=Q4(ce,R),Te=(o||0)+(E||0);return Number.isFinite(o)||Number.isFinite(E)?[fe[0],fe[1],Te]:fe}function U8(e){var a=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,f=e.flipY,g=f===void 0?!1:f,E=hx();return Bo(E,E,[0,0,-t]),Xo(E,E,[1,1,1/a]),Wi(E,E,-r*c0),Ba(E,E,n*c0),g&&Xo(E,E,[1,-1,1]),u&&Bo(E,E,dS([],u)),E}function j8(e){var a=e.width,r=e.height,n=e.altitude,t=n===void 0?N8:n,o=e.pitch,u=o===void 0?0:o,f=e.nearZMultiplier,g=f===void 0?1:f,E=e.farZMultiplier,R=E===void 0?1:E,B=u*c0,Y=Math.atan(.5/t),Q=Math.sin(Y)*t/Math.sin(Math.PI/2-B-Y),ce=Math.cos(Math.PI/2-B)*Q+t;return{fov:2*Math.atan(r/2/t),aspect:a/r,focalDistance:t,near:g,far:ce*R}}function V8(e){var a=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,f=j8({width:a,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),g=f.fov,E=f.aspect,R=f.near,B=f.far,Y=ne([],g,E,R,B);return Y}function G8(e,a){var r=(0,gi.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return Zy(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),B3(a,[n,t,u,1])}function wI(e,a){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,gi.Z)(e,3),t=n[0],o=n[1],u=n[2];if(Zy(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var f=B3(a,[t,o,u,1]);return f}var g=B3(a,[t,o,0,1]),E=B3(a,[t,o,1,1]),R=g[2],B=E[2],Y=R===B?0:((r||0)-R)/(B-R);return zf([],g,E,Y)}var SI=hx(),H8=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=a.width,n=a.height,t=a.viewMatrix,o=t===void 0?SI:t,u=a.projectionMatrix,f=u===void 0?SI:u;(0,Be.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=f;var g=hx();Wo(g,g,this.projectionMatrix),Wo(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var E=hx();Xo(E,E,[this.width/2,-this.height/2,1]),Bo(E,E,[1,-1,0]),Wo(E,E,this.viewProjectionMatrix);var R=Oo(hx(),E);if(!R)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=R,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Me.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ii(r.projectionMatrix,this.projectionMatrix)&&ii(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),f=G8(u,this.pixelProjectionMatrix),g=(0,gi.Z)(f,2),E=g[0],R=g[1],B=o?R:this.height-R;return r.length===2?[E,B]:[E,B,f[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,f=(0,gi.Z)(r,3),g=f[0],E=f[1],R=f[2],B=o?E:this.height-E,Y=u&&u*this.pixelsPerMeter,Q=wI([g,B,R],this.pixelUnprojectionMatrix,Y),ce=this.unprojectPosition(Q),fe=(0,gi.Z)(ce,3),Te=fe[0],Ve=fe[1],st=fe[2];return Number.isFinite(R)?[Te,Ve,st]:Number.isFinite(u)?[Te,Ve,u]:[Te,Ve]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,gi.Z)(n,2),o=t[0],u=t[1],f=(r[2]||0)*this.pixelsPerMeter;return[o,u,f]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,gi.Z)(n,2),o=t[0],u=t[1],f=(r[2]||0)/this.pixelsPerMeter;return[o,u,f]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function $8(e){var a=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,f=u===void 0?24:u,g=e.padding,E=g===void 0?0:g,R=e.offset,B=R===void 0?[0,0]:R,Y=(0,gi.Z)(n,2),Q=(0,gi.Z)(Y[0],2),ce=Q[0],fe=Q[1],Te=(0,gi.Z)(Y[1],2),Ve=Te[0],st=Te[1];if(Number.isFinite(E)){var at=E;E={top:at,bottom:at,left:at,right:at}}else Zy(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var Tt=new eP({width:a,height:r,longitude:0,latitude:0,zoom:0}),kt=Tt.project([ce,st]),Yt=Tt.project([Ve,fe]),cr=[Math.max(Math.abs(Yt[0]-kt[0]),o),Math.max(Math.abs(Yt[1]-kt[1]),o)],Mr=[a-E.left-E.right-Math.abs(B[0])*2,r-E.top-E.bottom-Math.abs(B[1])*2];Zy(Mr[0]>0&&Mr[1]>0);var Dr=Mr[0]/cr[0],sn=Mr[1]/cr[1],rn=(E.right-E.left)/2/Dr,Jn=(E.bottom-E.top)/2/sn,fi=[(Yt[0]+kt[0])/2+rn,(Yt[1]+kt[1])/2+Jn],Hi=Tt.unproject(fi),Ds=Tt.zoom+Math.log2(Math.abs(Math.min(Dr,sn)));return{longitude:Hi[0],latitude:Hi[1],zoom:Math.min(Ds,f)}}var eP=function(e){(0,yt.Z)(a,e);function a(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,f=u===void 0?0:u,g=n.longitude,E=g===void 0?0:g,R=n.zoom,B=R===void 0?0:R,Y=n.pitch,Q=Y===void 0?0:Y,ce=n.bearing,fe=ce===void 0?0:ce,Te=n.altitude,Ve=Te===void 0?1.5:Te,st=n.nearZMultiplier,at=n.farZMultiplier;(0,Be.Z)(this,a),t=t||1,o=o||1;var Tt=bI(B);Ve=Math.max(.75,Ve);var kt=N3([E,f],Tt);kt[2]=0;var Yt=V8({width:t,height:o,pitch:Q,bearing:fe,altitude:Ve,nearZMultiplier:st||1/o,farZMultiplier:at||1.01}),cr=U8({height:o,center:kt,pitch:Q,bearing:fe,altitude:Ve,flipY:!0});return r=(0,zt.Z)(this,(0,Ze.Z)(a).call(this,{width:t,height:o,viewMatrix:cr,projectionMatrix:Yt})),r.latitude=f,r.longitude=E,r.zoom=B,r.pitch=Q,r.bearing=fe,r.altitude=Ve,r.scale=Tt,r.center=kt,r.pixelsPerMeter=xI((0,D.Z)((0,D.Z)(r))).pixelsPerMeter[2],Object.freeze((0,D.Z)((0,D.Z)(r))),r}return(0,Me.Z)(a,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return N3(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q4(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=wI(o,this.pixelUnprojectionMatrix),f=N3(t,this.scale),g=Tc([],f,gf([],u)),E=Tc([],this.center,g);return Q4(E,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,f=$8(Object.assign({width:o,height:u,bounds:n},t)),g=f.longitude,E=f.latitude,R=f.zoom;return new a({width:o,height:u,longitude:g,latitude:E,zoom:R})}}]),a}(H8),Uy=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,f=r.viewportHeight,g=r.viewportWidth,E=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new eP((0,Ee.Z)((0,Ee.Z)({},E),{},{width:g,height:f,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),EI=function(){function e(a){(0,Be.Z)(this,e),(0,Pe.Z)(this,"size",1e4),this.size=a||1e4}return(0,Me.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}();function Z3(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return(0,Ee.Z)((0,Ee.Z)({},a),e)}var W8={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},X8=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],CI,AI,TI,MI,PI,kI,K1,II,LI,RI,DI;function Y8(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}Y8(`.amap-logo{
 display: none !important;
}
`);var q8={contextmenu:"rightclick"},K8={contextmenu:"rightclick",camerachange:"viewchange"},OI={"GAODE1.x":q8,"GAODE2.x":K8},J8=0;window.forceWebGL=!0;var FI="15cd8a57710d40c9b7c0e3cc120f1200",Q8="1.4.15",eO="amap-script",tP=!1,U3=[],tO=12,zI=(CI=(0,Ii.b2)(),AI=(0,Ii.f3)(cn.IGlobalConfigService),TI=(0,Ii.f3)(cn.MapConfig),MI=(0,Ii.f3)(cn.ICoordinateSystemService),PI=(0,Ii.f3)(cn.IEventEmitter),CI(kI=(K1=function(){function e(){var a=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"version",ip["GAODE1.x"]),(0,Pe.Z)(this,"simpleMapCoord",new EI),(0,Pe.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),yo(this,"configService",II,this),yo(this,"config",LI,this),yo(this,"coordinateSystemService",RI,this),yo(this,"eventEmitter",DI,this),(0,Pe.Z)(this,"handleCameraChanged",function(r){var n=r.camera,t=n.fov,o=n.near,u=n.far,f=n.height,g=n.pitch,E=n.rotation,R=n.aspect,B=n.position,Y=a.getCenter(),Q=Y.lng,ce=Y.lat;if(a.emit("mapchange"),a.cameraChangedCallback){a.viewport.syncWithMapCamera({aspect:R,bearing:360-E,far:u,fov:t,cameraHeight:f,near:o,pitch:g,zoom:a.map.getZoom()-1,center:[Q,ce],offsetOrigin:[B.x,B.y]});var fe=a.config.offsetZoom,Te=fe===void 0?tO:fe;a.viewport.getZoom()>Te?a.coordinateSystemService.setCoordinateSystem(gd.P20_OFFSET):a.coordinateSystemService.setCoordinateSystem(gd.P20),a.cameraChangedCallback(a.viewport)}})}return(0,Me.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getContainer();if(r!==null){var n=r.getElementsByClassName("amap-maps")[0];this.markerContainer=wo("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Mg.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(OI[this.version][r]||r,n)}},{key:"off",value:function(r,n){Mg.indexOf(r)!==-1?this.eventEmitter.off(r,n):this.map.off(OI[this.version][r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var r;return(r=this.map.getContainer())===null||r===void 0?void 0:r.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var r=this.map.getSize();return[r.getWidth(),r.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(r){return this.map.setZoom(r+1)}},{key:"getCenter",value:function(r){if(r!=null&&r.padding){var n=this.getCenter(),t=Z3(r.padding),o=this.lngLatToPixel([n.lng,n.lat]),u=[(t.right-t.left)/2,(t.bottom-t.top)/2],f=this.pixelToLngLat([o.x-u[0],o.y-u[1]]);return f}var g=this.map.getCenter();return{lng:g.getLng(),lat:g.getLat()}}},{key:"setCenter",value:function(r,n){if(n!=null&&n.padding){var t=Z3(n.padding),o=this.lngLatToPixel(r),u=[(t.right-t.left)/2,(t.bottom-t.top)/2],f=this.pixelToLngLat([o.x+u[0],o.y+u[1]]);this.map.setCenter([f.lng,f.lat])}else this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var r=this.map.getBounds().toBounds(),n=r.getNorthEast(),t=r.getSouthWest(),o=this.getCenter(),u=o.lng>n.getLng()||o.lng<t.getLng()?180-n.getLng():n.getLng(),f=o.lng<t.getLng()?t.getLng()-180:t.getLng();return[[f,t.getLat()],[u,n.getLat()]]}},{key:"getMinZoom",value:function(){var r=this.map.get("zooms");return r[0]-1}},{key:"getMaxZoom",value:function(){var r=this.map.get("zooms");return r[1]-1}},{key:"setRotation",value:function(r){return this.map.setRotation(r)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(r,n)}},{key:"fitBounds",value:function(r){this.map.setBounds(new AMap.Bounds([r[0][0],r[0][1],r[1][0],r[1][1]]))}},{key:"setZoomAndCenter",value:function(r,n){this.map.setZoomAndCenter(r+1,n)}},{key:"setMapStyle",value:function(r){this.map.setMapStyle(this.getMapStyleValue(r))}},{key:"setMapStatus",value:function(r){this.map.setStatus(r)}},{key:"getMapStyleConfig",value:function(){return W8}},{key:"getMapStyleValue",value:function(r){return this.getMapStyleConfig()[r]||r}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(r){var n=this.map.pixelToLngLat(new AMap.Pixel(r[0],r[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(r){var n=this.map.lnglatToPixel(new AMap.LngLat(r[0],r[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(r){var n=new AMap.Pixel(r[0],r[1]),t=this.map.containerToLngLat(n);return{lng:t==null?void 0:t.getLng(),lat:t==null?void 0:t.getLat()}}},{key:"lngLatToContainer",value:function(r){var n=new AMap.LngLat(r[0],r[1]),t=this.map.lngLatToContainer(n);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToCoord",value:function(r){var n=this.map.lngLatToGeodeticCoord(r),t=n.x,o=n.y;return[t,-o]}},{key:"lngLatToMercator",value:function(r,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(r,n,t){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=this.viewport.projectFlat(r),f=Kn();return Bo(f,f,Fu(u[0],u[1],n)),Xo(f,f,Fu(o[0],o[1],o[2])),Wi(f,f,t[0]),hs(f,f,t[1]),Ba(f,f,t[2]),f}},{key:"init",value:function(){var a=(0,mr.Z)(x().mark(function n(){var t=this,o,u,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st;return x().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:return o=this.config,u=o.id,f=o.style,g=f===void 0?"light":f,E=o.minZoom,R=E===void 0?0:E,B=o.maxZoom,Y=B===void 0?18:B,Q=o.token,ce=Q===void 0?FI:Q,fe=o.mapInstance,Te=o.plugin,Ve=Te===void 0?[]:Te,st=(0,Uh.Z)(o,X8),Tt.next=3,new Promise(function(kt){var Yt=function(){if(fe)t.map=fe,t.$mapContainer=t.map.getContainer(),setTimeout(function(){t.map.on("camerachange",t.handleCameraChanged),kt()},30);else{t.$mapContainer=t.creatMapContainer(u);var Mr=(0,Ee.Z)({mapStyle:t.getMapStyleValue(g),zooms:[R,Y],viewMode:"3D"},st);Mr.zoom&&(Mr.zoom+=1);var Dr=new AMap.Map(t.$mapContainer,Mr);Dr.on("camerachange",t.handleCameraChanged),Dr.on("camerachange",function(){setTimeout(function(){return t.handleAfterMapChange()})}),t.map=Dr,setTimeout(function(){kt()},10)}};!tP&&!fe?(ce===FI&&console.warn("%c".concat(t.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),tP=!0,Ve.push("Map3D"),gI().load({key:ce,version:Q8,plugins:Ve}).then(function(){Yt(),U3.length&&(U3.forEach(function(cr){return cr()}),U3=[])}).catch(function(cr){throw new Error(cr)})):tP&&window.AMap||fe?Yt():U3.push(Yt)});case 3:this.viewport=new Uy;case 4:case"end":return Tt.stop()}},n,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"meterToCoord",value:function(r,n){var t=AMap.GeometryUtil.distance(qr(AMap.LngLat,(0,Vn.Z)(r)),qr(AMap.LngLat,(0,Vn.Z)(n))),o=this.lngLatToCoord(r),u=(0,gi.Z)(o,2),f=u[0],g=u[1],E=this.lngLatToCoord(n),R=(0,gi.Z)(E,2),B=R[0],Y=R[1],Q=Math.sqrt(Math.pow(f-B,2)+Math.pow(g-Y,2));return Q/t}},{key:"updateView",value:function(r){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(r){var n,t=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],o=r==="jpg"?t==null?void 0:t.toDataURL("image/jpeg"):t==null?void 0:t.toDataURL("image/png");return o}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var t=document.getElementById(eO);t&&document.head.removeChild(t),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var t=document.createElement("div");return t.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,t.id="l7_amap_div"+J8++,n.appendChild(t),t}}]),e}(),II=ro(K1.prototype,"configService",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=ro(K1.prototype,"config",[TI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=ro(K1.prototype,"coordinateSystemService",[MI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DI=ro(K1.prototype,"eventEmitter",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1))||kI);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var vg=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(vg||{}),sm={key:"",AMap:{version:"2.0",plugins:[]}},h0={AMap:vg.notload},rO=[],nO=function(a){if(typeof a=="function"){if(h0.AMap===vg.loaded){a(window.AMap);return}rO.push(a)}},iO=function(){var e=(0,mr.Z)(x().mark(function a(r){return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o,u){if(h0.AMap===vg.failed)u("");else if(h0.AMap===vg.notload){var f=r.key,g=r.version,E=r.plugins;if(!f){u("\u8BF7\u586B\u5199key");return}window.AMap&&location.host!=="lbs.amap.com"&&u("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),sm.key=f,sm.AMap.version=g||sm.AMap.version,sm.AMap.plugins=E||sm.AMap.plugins,h0.AMap=vg.loading;var R=document.body||document.head;window._onAPILoaded=function(ce){ce?(h0.AMap=vg.failed,u(ce)):(h0.AMap=vg.loaded,o(null))};var B=document.createElement("script");B.type="text/javascript",B.async=!1,B.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+sm.AMap.version+"&key="+f+"&plugin="+sm.AMap.plugins.join(","),B.onerror=function(ce){h0.AMap=vg.failed,u(ce)},R.appendChild(B)}else if(h0.AMap===vg.loaded){if(r.key&&r.key!==sm.key){u("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");return}if(r.version&&r.version!==sm.AMap.version){u("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");return}var Y=[];r.plugins&&r.plugins.forEach(function(ce){sm.AMap.plugins.indexOf(ce)===-1&&Y.push(ce)}),Y.length&&window.AMap.plugin(Y,function(){o(window.AMap)})}else{if(r.key&&r.key!==sm.key){u("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");return}if(r.version&&r.version!==sm.AMap.version){u("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");return}var Q=[];r.plugins&&r.plugins.forEach(function(ce){sm.AMap.plugins.indexOf(ce)===-1&&Q.push(ce)}),nO(function(){Q.length&&window.AMap.plugin(Q,function(){o(window.AMap)})})}}));case 1:case"end":return t.stop()}},a)}));return function(r){return e.apply(this,arguments)}}();function aO(){delete window.AMap,sm={key:"",AMap:{version:"1.4.15",plugins:[]}},h0={AMap:vg.notload}}var oO={load:iO,reset:aO},BI=Math.PI/180,sO=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"projectionMatrix",Kn()),(0,Pe.Z)(this,"viewMatrix",Kn()),(0,Pe.Z)(this,"viewProjectionMatrix",Kn()),(0,Pe.Z)(this,"ViewProjectionMatrixUncentered",Kn()),(0,Pe.Z)(this,"viewUncenteredMatrix",Kn())}return(0,Me.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.zoom,t=n===void 0?1:n,o=r.pitch,u=o===void 0?0:o,f=r.bearing,g=f===void 0?0:f,E=r.center,R=E===void 0?[0,0]:E,B=r.offsetOrigin,Y=B===void 0?[0,0]:B,Q=r.cameraHeight,ce=Q===void 0?1:Q,fe=r.aspect,Te=fe===void 0?1:fe,Ve=r.near,st=Ve===void 0?.1:Ve,at=r.far,Tt=at===void 0?1e3:at,kt=r.fov,Yt=kt===void 0?0:kt;this.zoom=t,this.center=R;var cr=u*BI,Mr=(360-g)*BI;ne(this.projectionMatrix,Yt,Te,st,Tt);var Dr=Fu(ce*Math.sin(cr)*Math.sin(Mr),-ce*Math.sin(cr)*Math.cos(Mr),ce*Math.cos(cr)),sn=Fu(-Math.cos(cr)*Math.sin(Mr),Math.cos(cr)*Math.cos(Mr),Math.sin(cr));gt(this.viewMatrix,Dr,Fu(0,0,0),sn),this.viewUncenteredMatrix=la(this.viewMatrix),Bo(this.viewMatrix,this.viewMatrix,Fu(-Y[0],Y[1],0)),Wo(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Wo(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var r=(0,gi.Z)(this.center,2),n=r[0],t=r[1];return[n,t]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r){var n=85.0511287798,t=Math.max(Math.min(n,r[1]),-n),o=256<<20,u=Math.PI/180,f=r[0]*u,g=t*u;g=Math.log(Math.tan(Math.PI/4+g/2));var E=.5/Math.PI,R=.5,B=-.5/Math.PI;return u=.5,f=o*(E*f+R)-215440491,g=-(o*(B*g+u)-106744817),[f,g]}}]),e}(),uO=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],NI,ZI;function lO(e){var a=cO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function cO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}window.forceWebGL=!0;var UI="15cd8a57710d40c9b7c0e3cc120f1200",hO="1.4.15",rP=!1,j3=[],fO=12,pO=(NI=(0,Ii.b2)(),NI(ZI=function(e){(0,yt.Z)(r,e);var a=lO(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip["GAODE1.x"]),(0,Pe.Z)((0,D.Z)(n),"handleCameraChanged",function(f){var g=f.camera,E=g.fov,R=g.near,B=g.far,Y=g.height,Q=g.pitch,ce=g.rotation,fe=g.aspect,Te=g.position,Ve=n.getCenter(),st=Ve.lng,at=Ve.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:fe,bearing:360-ce,far:B,fov:E,cameraHeight:Y,near:R,pitch:Q,zoom:n.map.getZoom()-1,center:[st,at],offsetOrigin:[Te.x,Te.y]});var Tt=n.config.offsetZoom,kt=Tt===void 0?fO:Tt;n.viewport.getZoom()>kt?n.coordinateSystemService.setCoordinateSystem(gd.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(gd.P20),n.cameraChangedCallback(n.viewport)}}),n}return(0,Me.Z)(r,[{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=this.viewport.projectFlat(t),E=Kn();return Bo(E,E,Fu(g[0],g[1],o)),Xo(E,E,Fu(f[0],f[1],f[2])),Wi(E,E,u[0]),hs(E,E,u[1]),Ba(E,E,u[2]),E}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt;return x().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return f=this.config,g=f.id,E=f.style,R=E===void 0?"light":E,B=f.minZoom,Y=B===void 0?0:B,Q=f.maxZoom,ce=Q===void 0?18:Q,fe=f.token,Te=fe===void 0?UI:fe,Ve=f.mapInstance,st=f.plugin,at=st===void 0?[]:st,Tt=(0,Uh.Z)(f,uO),Yt.next=3,new Promise(function(cr){var Mr=function(){if(Ve)u.map=Ve,u.$mapContainer=u.map.getContainer(),setTimeout(function(){u.map.on("camerachange",u.handleCameraChanged),cr()},30);else{u.$mapContainer=u.creatMapContainer(g);var sn=(0,Ee.Z)({mapStyle:u.getMapStyleValue(R),zooms:[Y,ce],viewMode:"3D"},Tt);sn.zoom&&(sn.zoom+=1);var rn=new AMap.Map(u.$mapContainer,sn);rn.on("camerachange",u.handleCameraChanged),rn.on("camerachange",function(){setTimeout(function(){return u.handleAfterMapChange()})}),u.map=rn,setTimeout(function(){cr()},10)}};!rP&&!Ve?(Te===UI&&console.warn(u.configService.getSceneWarninfo("MapToken")),rP=!0,at.push("Map3D"),oO.load({key:Te,version:hO,plugins:at}).then(function(Dr){Mr(),j3.length&&(j3.forEach(function(sn){return sn()}),j3=[])}).catch(function(Dr){throw new Error(Dr)})):rP&&window.AMap||Ve?Mr():j3.push(Mr)});case 3:this.viewport=new sO;case 4:case"end":return Yt.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,o){var u=AMap.GeometryUtil.distance(qr(AMap.LngLat,(0,Vn.Z)(t)),qr(AMap.LngLat,(0,Vn.Z)(o))),f=this.lngLatToCoord(t),g=(0,gi.Z)(f,2),E=g[0],R=g[1],B=this.lngLatToCoord(o),Y=(0,gi.Z)(B,2),Q=Y[0],ce=Y[1],fe=Math.sqrt(Math.pow(E-Q,2)+Math.pow(R-ce,2));return fe/u}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var o,u=(o=this.getContainer())===null||o===void 0?void 0:o.getElementsByClassName("amap-layer")[0],f=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return f}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),r}(zI))||ZI);function dO(e){var a=vO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function vO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mO=function(e){(0,yt.Z)(r,e);var a=dO(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return pO}}]),r}(l0),gO=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"projectionMatrix",Kn()),(0,Pe.Z)(this,"viewMatrix",Kn()),(0,Pe.Z)(this,"viewProjectionMatrix",Kn()),(0,Pe.Z)(this,"ViewProjectionMatrixUncentered",Kn()),(0,Pe.Z)(this,"viewUncenteredMatrix",Kn())}return(0,Me.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.zoom,t=n===void 0?1:n,o=r.center,u=o===void 0?[0,0]:o,f=r.offsetOrigin,g=f===void 0?[0,0]:f,E=r.cameraPosition,R=E===void 0?[0,0,0]:E,B=r.up,Y=B===void 0?[0,1,0]:B,Q=r.lookAt,ce=Q===void 0?[0,0,0]:Q,fe=r.aspect,Te=fe===void 0?1:fe,Ve=r.near,st=Ve===void 0?.1:Ve,at=r.far,Tt=at===void 0?1e3:at,kt=r.fov,Yt=kt===void 0?45:kt;this.zoom=t,this.center=u,ne(this.projectionMatrix,Yt/180*Math.PI,Te,st,Tt);var cr=Fu.apply(M,(0,Vn.Z)(R)),Mr=Fu.apply(M,(0,Vn.Z)(ce)),Dr=Fu.apply(M,(0,Vn.Z)(Y));gt(this.viewMatrix,cr,Mr,Dr),this.viewUncenteredMatrix=la(this.viewMatrix),Bo(this.viewMatrix,this.viewMatrix,Fu(-g[0],g[1],0)),Wo(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Wo(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var r=(0,gi.Z)(this.center,2),n=r[0],t=r[1];return[n,t]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(r){var n=85.0511287798,t=Math.max(Math.min(n,r[1]),-n),o=256<<20,u=Math.PI/180,f=r[0]*u,g=t*u;g=Math.log(Math.tan(Math.PI/4+g/2));var E=.5/Math.PI,R=.5,B=-.5/Math.PI;return u=.5,f=o*(E*f+R)-215440491,g=-(o*(B*g+u)-106744817),[f,g]}}]),e}(),yO=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],jI,VI;function _O(e){var a=bO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function bO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xO(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}xO(`.amap-logo{
 display: none !important;
}
`);var GI=[108.92361,34.54083];window.forceWebGL=!0;var HI="f59bcf249433f8b05caaee19f349b3d7",$I="2.0",JB=!1,QB=null,wO=(jI=(0,Ii.b2)(),jI(VI=function(e){(0,yt.Z)(r,e);var a=_O(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip["GAODE2.x"]),(0,Pe.Z)((0,D.Z)(n),"handleViewChanged",function(f){var g=n.map.customCoords.getCameraParams(),E=g.fov,R=g.near,B=g.far,Y=g.aspect,Q=g.position,ce=g.lookAt,fe=g.up;n.emit("mapchange");var Te=n.map.customCoords.getCenter();n.cameraChangedCallback&&(n.viewport.syncWithMapCamera({aspect:Y,far:B,fov:E,cameraPosition:Q,lookAt:ce,up:fe,near:R,zoom:n.map.getZoom()-1,center:Te,offsetOrigin:[Q[0],Q[1]]}),n.coordinateSystemService.setCoordinateSystem(gd.P20_2),n.cameraChangedCallback(n.viewport))}),n}return(0,Me.Z)(r,[{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMercator=xh.apply(void 0,(0,Vn.Z)(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(t,o){var u=o||this.sceneCenterMercator,f=this._sub(xh(t[0],t[1]),u);return t[2]&&f.push(t[2]),f}},{key:"coordToAMap2RelativeCoordinates",value:function(t,o){var u=this,f=xh(o[0],o[1]);return typeof t[0]=="number"?this.lngLatToCoordByLayer(t,f):t.map(function(g){return Array.isArray(g)&&typeof g[0]=="number"?u.lngLatToCoordByLayer(g,f):g.map(function(E){return u.lngLatToCoordByLayer(E,f)})})}},{key:"setCoordCenter",value:function(t){this.map.customCoords.setCenter(t||GI),this.setCustomCoordCenter(t||GI)}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(xh(t[0],t[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(t){var o=this;return t.map(function(u){return typeof u[0]=="number"?o.lngLatToCoord(u):u.map(function(f){return o.lngLatToCoord(f)})})}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(t!==null){var o=t.getElementsByClassName("amap-maps")[0];o.style.zIndex="auto",this.markerContainer=wo("div","l7-marker-container2",o)}}}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var t=this.map.getBounds(),o=t.getNorthEast(),u=t.getSouthWest(),f=this.getCenter(),g=f.lng>o.getLng()||f.lng<u.getLng()?180-o.getLng():o.getLng(),E=f.lng<u.getLng()?u.getLng()-180:u.getLng();return[[E,u.getLat()],[g,o.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.getZooms();return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.getZooms();return t[1]-1}},{key:"lngLatToContainer",value:function(t){var o=this.map.lngLatToContainer(t);return{x:o.getX(),y:o.getY()}}},{key:"lngLatToPixel",value:function(t){var o=this.map.lngLatToPixel(new AMap.LngLat(t[0],t[1]));return{x:o.getX(),y:o.getY()}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=this.map.customCoords.lngLatToCoord(t),E=Kn();return Bo(E,E,Fu(g[0],g[1],o)),Xo(E,E,Fu(f[0],f[1],f[2])),Wi(E,E,u[0]),hs(E,E,u[1]),Ba(E,E,u[2]),E}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr,Mr,Dr,sn,rn;return x().wrap(function(fi){for(;;)switch(fi.prev=fi.next){case 0:if(u=this.config,f=u.id,g=u.style,E=g===void 0?"light":g,R=u.minZoom,B=R===void 0?0:R,Y=u.maxZoom,Q=Y===void 0?18:Y,ce=u.token,fe=ce===void 0?HI:ce,Te=u.mapInstance,Ve=u.plugin,st=Ve===void 0?[]:Ve,at=u.version,Tt=at===void 0?$I:at,kt=(0,Uh.Z)(u,yO),this.viewport=new gO,window.AMap||Te){fi.next=6;break}return st.push("Map3D"),fi.next=6,gI().load({key:fe,version:$I,plugins:st});case 6:Te?(this.map=Te,this.$mapContainer=this.map.getContainer(),cr=this.map.getCenter(),(Yt=this.map.customCoords)===null||Yt===void 0||Yt.setCenter([cr.lng,cr.lat]),this.setCustomCoordCenter([cr.lng,cr.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(f),Dr=(0,Ee.Z)({mapStyle:this.getMapStyleValue(E),zooms:[B,Q],viewMode:"3D"},kt),Dr.zoom&&(Dr.zoom+=1),fe===HI&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;")),sn=new AMap.Map(this.$mapContainer,Dr),this.map=sn,rn=sn.getCenter(),(Mr=this.map.customCoords)===null||Mr===void 0||Mr.setCenter([rn.lng,rn.lat]),this.setCustomCoordCenter([rn.lng,rn.lat]),sn.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return fi.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,o=(t=this.map.customCoords)===null||t===void 0?void 0:t.getCameraParams(),u=o.fov,f=o.near,g=o.far,E=o.aspect,R=o.position,B=o.lookAt,Y=o.up;this.emit("mapchange");var Q=this.map.customCoords.getCenter(),ce=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:E,far:g,fov:u,cameraPosition:R,lookAt:B,near:f,up:Y,zoom:ce-1,center:Q,offsetOrigin:[R[0],R[1]]}),this.coordinateSystemService.setCoordinateSystem(gd.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,o){var u=[0,0];return u[0]=t[0]-o[0],u[1]=t[1]-o[1],u}}]),r}(zI))||VI);function SO(e){var a=EO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function EO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WI=function(e){(0,yt.Z)(r,e);var a=SO(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return wO}}]),r}(l0),CO={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},XI,YI,qI,KI,JI,QI,J1,eL,tL,rL,nL,iL={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},AO=12,jy=(XI=(0,Ii.b2)(),YI=(0,Ii.f3)(cn.MapConfig),qI=(0,Ii.f3)(cn.IGlobalConfigService),KI=(0,Ii.f3)(cn.ICoordinateSystemService),JI=(0,Ii.f3)(cn.IEventEmitter),XI(QI=(J1=function(){function e(){var a=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"version",ip.DEFUALT),(0,Pe.Z)(this,"simpleMapCoord",new EI),(0,Pe.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),yo(this,"config",eL,this),yo(this,"configService",tL,this),yo(this,"coordinateSystemService",rL,this),yo(this,"eventEmitter",nL,this),(0,Pe.Z)(this,"handleCameraChanged",function(r){var n=a.map.getCenter(),t=n.lat,o=n.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[o,t],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0}),a.updateCoordinateSystemService(),a.cameraChangedCallback(a.viewport)})}return(0,Me.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=wo("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){Mg.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(iL[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(iL[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===ip.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return CO}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>AO&&n?this.coordinateSystemService.setCoordinateSystem(gd.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(gd.LNGLAT)}}]),e}(),eL=ro(J1.prototype,"config",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tL=ro(J1.prototype,"configService",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rL=ro(J1.prototype,"coordinateSystemService",[KI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=ro(J1.prototype,"eventEmitter",[JI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J1))||QI);if(!window)throw Error("BMapGL JSAPI can only be used in Browser.");var mg=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(mg||{}),Vg={key:"",BMapGL:{version:"1.0"}},f0={BMapGL:mg.notload},nP=[],aL=function(a){if(typeof a=="function"){if(f0.BMapGL===mg.loaded){a(window.BMapGL);return}nP.push(a)}},TO=function(a){return new Promise(function(r,n){if(f0.BMapGL===mg.failed)n("");else if(f0.BMapGL===mg.notload){var t=a.key,o=a.version;if(!t){n("\u8BF7\u586B\u5199key");return}Vg.key=t,Vg.BMapGL.version=o||Vg.BMapGL.version,f0.BMapGL=mg.loading;var u=document.body||document.head;window.___onBMapGLAPILoaded=function(g){if(delete window.___onBMapGLAPILoaded,g)f0.BMapGL=mg.failed,n(g);else for(f0.BMapGL=mg.loaded;nP.length;)nP.splice(0,1)[0](window.BMapGL)};var f=document.createElement("script");f.type="text/javascript",f.src="https://api.map.baidu.com/api?type=webgl&v=".concat(Vg.BMapGL.version,"&ak=").concat(Vg.key,"&callback=___onBMapGLAPILoaded"),f.onerror=function(g){f0.BMapGL=mg.failed,n(g)},u.appendChild(f),aL(r)}else if(f0.BMapGL===mg.loaded){if(a.key&&a.key!==Vg.key){n("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");return}if(a.version&&a.version!==Vg.BMapGL.version){n("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");return}r(window.BMapGL)}else{if(a.key&&a.key!==Vg.key){n("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");return}if(a.version&&a.version!==Vg.BMapGL.version){n("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");return}aL(r)}})},MO=function(){delete window.BMapGL,Vg={key:"",BMapGL:{version:"1.0"}},f0={BMapGL:mg.notload}},PO={load:TO,reset:MO},kO=["id","center","zoom","token","mapInstance","version","mapSize","minZoom","maxZoom"];function IO(e){var a=LO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function LO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function RO(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}RO(`.bmap-contianer--hide-logo .anchorBL > img[src*='api.map.baidu.com/images/logo_hd.png'] {
  display: none;
}
`);var oL={mapmove:"moving",contextmenu:"rightclick",camerachange:"update",zoomchange:"zoomend"},sL="zLhopYPPERGtpGOgimcdKcCimGRyyIsh",uL="1.0",DO=function(e){(0,yt.Z)(r,e);var a=IO(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"styleConfig",{normal:[]}),(0,Pe.Z)((0,D.Z)(n),"currentStyle","normal"),(0,Pe.Z)((0,D.Z)(n),"evtCbProxyMap",new Map),(0,Pe.Z)((0,D.Z)(n),"handleCameraChanged",function(){n.emit("mapchange");var f=n.getMap(),g=f.getCenter(),E=g.lng,R=g.lat,B={center:[E,R],viewportHeight:f.getContainer().clientHeight,viewportWidth:f.getContainer().clientWidth,bearing:360-f.getHeading(),pitch:f.getTilt(),zoom:f.getZoom()-1.75};n.viewport.syncWithMapCamera(B),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)}),n}return(0,Me.Z)(r,[{key:"getMap",value:function(){return this.map}},{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr,Mr,Dr,sn,rn,Jn,fi,Hi;return x().wrap(function(pu){for(;;)switch(pu.prev=pu.next){case 0:if(this.viewport=new Uy,f=this.config,g=f.id,E=f.center,R=E===void 0?[121.30654632240122,31.25744185633306]:E,B=f.zoom,Y=B===void 0?12:B,Q=f.token,ce=Q===void 0?sL:Q,fe=f.mapInstance,Te=f.version,Ve=Te===void 0?uL:Te,st=f.mapSize,at=st===void 0?1e4:st,Tt=f.minZoom,kt=Tt===void 0?0:Tt,Yt=f.maxZoom,cr=Yt===void 0?21:Yt,Mr=(0,Uh.Z)(f,kO),this.viewport=new Uy,this.version=Ve,this.simpleMapCoord.setSize(at),window.BMapGL||fe){pu.next=8;break}return pu.next=8,PO.load({key:ce,version:uL});case 8:if(!fe){pu.next=17;break}this.map=fe,this.$mapContainer=this.map.getContainer(),Dr=new BMapGL.Point(R[0],R[1]),this.map.isLoaded()||this.map.centerAndZoom(Dr,Y+1.75),this.initMapByConfig(this.config),this.map.on("update",this.handleCameraChanged),pu.next=32;break;case 17:if(sn=(0,Ee.Z)({enableWheelZoom:!0,minZoom:kt,maxZoom:cr},Mr),ce===sL&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),g){pu.next=21;break}throw Error("No container id specified");case 21:rn=Hc(g),Jn=(0,Vn.Z)(rn.childNodes),fi=new BMapGL.Map(rn,sn),this.$mapContainer=fi.getContainer(),Jn.forEach(function($s){u.$mapContainer.appendChild($s)}),Jn=null,this.map=fi,Hi=new BMapGL.Point(R[0],R[1]),this.map.centerAndZoom(Hi,Y+1.75),this.initMapByConfig(this.config),fi.on("update",this.handleCameraChanged);case 32:case"end":return pu.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){this.getMap().destroy()}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.map.getPanes().markerPane}},{key:"on",value:function(t,o){if(Mg.indexOf(t)!==-1){this.eventEmitter.on(t,o);return}var u=this.evtCbProxyMap.get(t);if(u||this.evtCbProxyMap.set(t,u=new Map),!u.get(o)){var f=function(){for(var E=arguments.length,R=new Array(E),B=0;B<E;B++)R[B]=arguments[B];R[0]&&(0,Go.Z)(R[0])==="object"&&!R[0].lngLat&&!R[0].lnglat&&(R[0].lngLat=R[0].latlng||R[0].latLng),o.apply(void 0,R)};u.set(o,f),this.map.on(oL[t]||t,f)}}},{key:"off",value:function(t,o){var u,f;if(Mg.indexOf(t)!==-1){this.eventEmitter.off(t,o);return}var g=(u=this.evtCbProxyMap.get(t))===null||u===void 0?void 0:u.get(o);g&&((f=this.evtCbProxyMap.get(t))===null||f===void 0||f.delete(o),this.map.off(oL[t]||t,g))}},{key:"once",value:function(t,o){this.eventEmitter.once(t,o)}},{key:"getContainer",value:function(){return this.getMap().getContainer()}},{key:"getSize",value:function(){var t=this.getMap().getSize();return[t.width,t.height]}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()-1.75}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()-1.75}},{key:"getType",value:function(){return"bmap"}},{key:"getZoom",value:function(){return this.getMap().getZoom()-1.75}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var o=this.getCenter(),u=Z3(t.padding),f=this.lngLatToPixel([o.lng,o.lat]),g=[(u.right-u.left)/2,(u.bottom-u.top)/2],E=this.pixelToLngLat([f.x-g[0],f.y-g[1]]);return E}var R=this.map.getCenter();return{lng:R.lng,lat:R.lat}}},{key:"getPitch",value:function(){return this.getMap().getTilt()}},{key:"getRotation",value:function(){return 360-this.getMap().getHeading()}},{key:"getBounds",value:function(){var t=this.getMap().getBounds(),o=t.getNorthEast(),u=t.getSouthWest();return[[u.lng,u.lat],[o.lng,o.lat]]}},{key:"getMapContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapStyleConfig",value:function(){return this.styleConfig}},{key:"getMapStyleValue",value:function(t){return this.styleConfig[t]}},{key:"setMapStyle",value:function(t){if(this.currentStyle!==t){var o=Array.isArray(t)?t:this.styleConfig[t]||t;if(Array.isArray(o)){this.map.setMapStyleV2({styleJson:o}),this.currentStyle=t;return}if(typeof o=="string"){this.map.setMapStyleV2({styleId:o}),this.currentStyle=t;return}}}},{key:"setRotation",value:function(t){this.getMap().setHeading(t)}},{key:"zoomIn",value:function(){this.getMap().zoomIn()}},{key:"zoomOut",value:function(){this.getMap().zoomOut()}},{key:"panTo",value:function(t){this.getMap().panTo(new BMapGL.Point(t[0],t[1]))}},{key:"panBy",value:function(t,o){this.getMap().panBy(t,o)}},{key:"fitBounds",value:function(t,o){this.map.setViewport(t.map(function(u){return new BMapGL.Point(u[0],u[1])}),o)}},{key:"setZoomAndCenter",value:function(t,o){var u=(0,gi.Z)(o,2),f=u[0],g=u[1];this.getMap().centerAndZoom(new BMapGL.Point(f,g),t+1.75)}},{key:"setCenter",value:function(t,o){var u=(0,gi.Z)(t,2),f=u[0],g=u[1],E={lng:f,lat:g};if(o!=null&&o.padding){var R=Z3(o.padding),B=this.lngLatToPixel([f,g]),Y=[(R.right-R.left)/2,(R.bottom-R.top)/2];E=this.pixelToLngLat([B.x+Y[0],B.y+Y[1]])}this.getMap().setCenter(new BMapGL.Point(E.lng,E.lat))}},{key:"setPitch",value:function(t){this.getMap().setTilt(t)}},{key:"setZoom",value:function(t){this.getMap().setZoom(t+1.75)}},{key:"setMapStatus",value:function(t){var o=this,u=this.getMap();Object.keys(t).map(function(f){switch(f){case"doubleClickZoom":t.doubleClickZoom?u.enableDoubleClickZoom():u.disableDoubleClickZoom();break;case"dragEnable":t.dragEnable?u.enableDragging():u.disableDragging();break;case"keyboardEnable":t.keyboardEnable?u.enableKeyboard():u.disableKeyboard();break;case"resizeEnable":t.resizeEnable?u.enableAutoResize():u.disableAutoResize();break;case"rotateEnable":t.rotateEnable?(u.enableRotate(),u.enableRotateGestures()):(u.disableRotate(),u.disableRotateGestures());break;case"zoomEnable":t.zoomEnable?(o.map.enableDoubleClickZoom(),o.map.enableScrollWheelZoom(),o.map.enablePinchToZoom()):(o.map.disableDoubleClickZoom(),o.map.disableScrollWheelZoom(),o.map.disablePinchToZoom());break;case"showIndoorMap":u.setDisplayOptions({indoor:!!t.showIndoorMap});break;default:}})}},{key:"meterToCoord",value:function(t,o){var u=this.getMap().getDistance(qr(BMapGL.Point,(0,Vn.Z)(t)),qr(BMapGL.Point,(0,Vn.Z)(o))),f=this.lngLatToCoord(t),g=(0,gi.Z)(f,2),E=g[0],R=g[1],B=this.lngLatToCoord(o),Y=(0,gi.Z)(B,2),Q=Y[0],ce=Y[1],fe=Math.sqrt(Math.pow(E-Q,2)+Math.pow(R-ce,2));return fe/u}},{key:"pixelToLngLat",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.getMap().pixelToPoint(new BMapGL.Pixel(u,f));return{lng:g.lng,lat:g.lat}}},{key:"lngLatToPixel",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.getMap().pointToPixel(new BMapGL.Point(u,f));return{x:g.x,y:g.y}}},{key:"containerToLngLat",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.getMap().overlayPixelToPoint(new BMapGL.Pixel(u,f));return{lng:g.lng,lat:g.lat}}},{key:"lngLatToContainer",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.getMap().pointToOverlayPixel(new BMapGL.Point(u,f));return{x:g.x,y:g.y}}},{key:"lngLatToCoord",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.getMap().pointToPixel(new BMapGL.Point(u,f)),E=g.x,R=g.y;return[E,-R]}},{key:"lngLatToCoords",value:function(t){var o=this;return t.map(function(u){return Array.isArray(u[0])?o.lngLatToCoords(u):o.lngLatToCoord(u)})}},{key:"lngLatToMercator",value:function(t,o){var u=(0,gi.Z)(t,2),f=u[0],g=u[1],E=this.getMap().lnglatToMercator(f,g),R=(0,gi.Z)(E,2),B=R[0],Y=R[1];return{x:B,y:Y,z:o}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=this.viewport.projectFlat(t),E=Kn();return Bo(E,E,Fu(g[0],g[1],o)),Xo(E,E,Fu(f[0],f[1],f[2])),Wi(E,E,u[0]),hs(E,E,u[1]),Ba(E,E,u[2]),E}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(t){var o=this.getMap()._webglPainter._canvas,u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"hideLogo",value:function(){var t=this.map.getContainer();t&&pl(t,"bmap-contianer--hide-logo")}},{key:"initMapByConfig",value:function(t){var o=t.style,u=t.pitch,f=u===void 0?0:u,g=t.rotation,E=g===void 0?0:g,R=t.logoVisible,B=R===void 0?!0:R;o&&this.setMapStyle(o),f&&this.setPitch(f),E&&this.setRotation(E),B===!1&&this.hideLogo()}}]),r}(jy);function OO(e){var a=FO();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function FO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zO=function(e){(0,yt.Z)(r,e);var a=OO(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return DO}}]),r}(l0),BO=G(99874),NO=G.n(BO);function ZO(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=UO(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function UO(e,a){if(e){if(typeof e=="string")return lL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lL(e,a)}}function lL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var iP;function aP(e,a,r){var n=r-a,t=((e-a)%n+n)%n+a;return t===a?r:t}function p0(e,a,r){return Math.min(r,Math.max(a,e))}function Km(e,a,r){return e*(1-r)+a*r}function oP(e,a,r,n){var t=new(NO())(e,a,r,n);return function(o){return t.solve(o)}}var sP=oP(.25,.1,.25,1);function cL(){return iP==null&&(iP=window.matchMedia("(prefers-reduced-motion: reduce)")),iP.matches}function jO(e,a){var r={},n=ZO(a),t;try{for(n.s();!(t=n.n()).done;){var o=t.value;o in e&&(r[o]=e[o])}}catch(u){n.e(u)}finally{n.f()}return r}var V0=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),VO=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,GO=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function V3(e){var a=VO(e);return{cancel:function(){return GO(a)}}}function HO(e){for(var a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];for(var t=0,o=r;t<o.length;t++){var u=o[t];for(var f in u)u[f]!==void 0&&(e[f]=u[f])}return e}var hL=63710088e-1,ef=function(){function e(a,r){if((0,Be.Z)(this,e),isNaN(a)||isNaN(r))throw new Error("Invalid LngLat object: (".concat(a,", ").concat(r,")"));if(this.lng=+a,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,Me.Z)(e,[{key:"wrap",value:function(){return new e(aP(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(r){var n=Math.PI/180,t=this.lat*n,o=r.lat*n,u=Math.sin(t)*Math.sin(o)+Math.cos(t)*Math.cos(o)*Math.cos((r.lng-this.lng)*n),f=hL*Math.acos(Math.min(u,1));return f}}],[{key:"convert",value:function(r){if(r instanceof e)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new e(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&(0,Go.Z)(r)==="object"&&r!==null){var n="lng"in r?r.lng:r.lon;return new e(Number(n),Number(r.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),fx=function(){function e(a,r){(0,Be.Z)(this,e),a&&(r?this.setSouthWest(a).setNorthEast(r):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}return(0,Me.Z)(e,[{key:"setNorthEast",value:function(r){return this.ne=r instanceof ef?new ef(r.lng,r.lat):ef.convert(r),this}},{key:"setSouthWest",value:function(r){return this.sw=r instanceof ef?new ef(r.lng,r.lat):ef.convert(r),this}},{key:"extend",value:function(r){var n=this.sw,t=this.ne,o,u;if(r instanceof ef)o=r,u=r;else if(r instanceof e){if(o=r.sw,u=r.ne,!o||!u)return this}else{if(Array.isArray(r))if(r.length===4||r.every(Array.isArray)){var f=r;return this.extend(e.convert(f))}else{var g=r;return this.extend(ef.convert(g))}return this}return!n&&!t?(this.sw=new ef(o.lng,o.lat),this.ne=new ef(u.lng,u.lat)):(n.lng=Math.min(o.lng,n.lng),n.lat=Math.min(o.lat,n.lat),t.lng=Math.max(u.lng,t.lng),t.lat=Math.max(u.lat,t.lat)),this}},{key:"getCenter",value:function(){return new ef((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new ef(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new ef(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(r){var n=ef.convert(r),t=n.lng,o=n.lat,u=this.sw.lat<=o&&o<=this.ne.lat,f=this.sw.lng<=t&&t<=this.ne.lng;return this.sw.lng>this.ne.lng&&(f=this.sw.lng>=t&&t>=this.ne.lng),u&&f}}],[{key:"convert",value:function(r){return r instanceof e?r:new e(r)}}]),e}(),Ul=function(){function e(a,r){(0,Be.Z)(this,e),this.x=a,this.y=r}return(0,Me.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(r){return this.x+=r.x,this.y+=r.y,this}},{key:"add",value:function(r){return this.clone()._add(r)}},{key:"_sub",value:function(r){return this.x-=r.x,this.y-=r.y,this}},{key:"sub",value:function(r){return this.clone()._sub(r)}},{key:"_multByPoint",value:function(r){return this.x*=r.x,this.y*=r.y,this}},{key:"multByPoint",value:function(r){return this.clone()._multByPoint(r)}},{key:"_divByPoint",value:function(r){return this.x/=r.x,this.y/=r.y,this}},{key:"divByPoint",value:function(r){return this.clone()._divByPoint(r)}},{key:"_mult",value:function(r){return this.x*=r,this.y*=r,this}},{key:"mult",value:function(r){return this.clone()._mult(r)}},{key:"_div",value:function(r){return this.x/=r,this.y/=r,this}},{key:"div",value:function(r){return this.clone()._div(r)}},{key:"_rotate",value:function(r){var n=Math.cos(r),t=Math.sin(r),o=n*this.x-t*this.y,u=t*this.x+n*this.y;return this.x=o,this.y=u,this}},{key:"rotate",value:function(r){return this.clone()._rotate(r)}},{key:"_rotateAround",value:function(r,n){var t=Math.cos(r),o=Math.sin(r),u=n.x+t*(this.x-n.x)-o*(this.y-n.y),f=n.y+o*(this.x-n.x)+t*(this.y-n.y);return this.x=u,this.y=f,this}},{key:"roateAround",value:function(r,n){return this.clone()._rotateAround(r,n)}},{key:"_matMult",value:function(r){var n=r[0]*this.x+r[1]*this.y,t=r[2]*this.x+r[3]*this.y;return this.x=n,this.y=t,this}},{key:"matMult",value:function(r){return this.clone()._matMult(r)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var r=this.y;return this.y=this.x,this.x=-r,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(r){return this.x===r.x&&this.y===r.y}},{key:"dist",value:function(r){return Math.sqrt(this.distSqr(r))}},{key:"distSqr",value:function(r){var n=r.x-this.x,t=r.y-this.y;return n*n+t*t}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(r){return Math.atan2(this.y-r.y,this.x-r.x)}},{key:"angleWith",value:function(r){return this.angleWithSep(r.x,r.y)}},{key:"angleWithSep",value:function(r,n){return Math.atan2(this.x*n-this.y*r,this.x*r+this.y*n)}}],[{key:"convert",value:function(r){return r instanceof e?r:Array.isArray(r)?new e(r[0],r[1]):r}}]),e}();function $O(){var e=new Ml(4);return Ml!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function eN(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function tN(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function rN(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function nN(e,a,r,n){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=e,t[1]=a,t[2]=r,t[3]=n,t}function iN(e,a,r,n,t){return e[0]=a,e[1]=r,e[2]=n,e[3]=t,e}function aN(e,a){if(e===a){var r=a[1];e[1]=a[2],e[2]=r}else e[0]=a[0],e[1]=a[2],e[2]=a[1],e[3]=a[3];return e}function oN(e,a){var r=a[0],n=a[1],t=a[2],o=a[3],u=r*o-t*n;return u?(u=1/u,e[0]=o*u,e[1]=-n*u,e[2]=-t*u,e[3]=r*u,e):null}function sN(e,a){var r=a[0];return e[0]=a[3],e[1]=-a[1],e[2]=-a[2],e[3]=r,e}function uN(e){return e[0]*e[3]-e[2]*e[1]}function lN(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3],f=r[0],g=r[1],E=r[2],R=r[3];return e[0]=n*f+o*g,e[1]=t*f+u*g,e[2]=n*E+o*R,e[3]=t*E+u*R,e}function WO(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3],f=Math.sin(r),g=Math.cos(r);return e[0]=n*g+o*f,e[1]=t*g+u*f,e[2]=n*-f+o*g,e[3]=t*-f+u*g,e}function cN(e,a,r){var n=a[0],t=a[1],o=a[2],u=a[3],f=r[0],g=r[1];return e[0]=n*f,e[1]=t*f,e[2]=o*g,e[3]=u*g,e}function hN(e,a){var r=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e}function fN(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=a[1],e}function pN(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function dN(e){return Math.hypot(e[0],e[1],e[2],e[3])}function vN(e,a,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,a,r]}function mN(e,a,r){return e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e[3]=a[3]+r[3],e}function gN(e,a,r){return e[0]=a[0]-r[0],e[1]=a[1]-r[1],e[2]=a[2]-r[2],e[3]=a[3]-r[3],e}function yN(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function _N(e,a){var r=e[0],n=e[1],t=e[2],o=e[3],u=a[0],f=a[1],g=a[2],E=a[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(t-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(g))&&Math.abs(o-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))}function bN(e,a,r){return e[0]=a[0]*r,e[1]=a[1]*r,e[2]=a[2]*r,e[3]=a[3]*r,e}function xN(e,a,r,n){return e[0]=a[0]+r[0]*n,e[1]=a[1]+r[1]*n,e[2]=a[2]+r[2]*n,e[3]=a[3]+r[3]*n,e}var wN=null,SN=null,XO=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if((0,Be.Z)(this,e),isNaN(a)||a<0||isNaN(r)||r<0||isNaN(n)||n<0||isNaN(t)||t<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=r,this.left=n,this.right=t}return(0,Me.Z)(e,[{key:"interpolate",value:function(r,n,t){return n.top!=null&&r.top!=null&&(this.top=Km(r.top,n.top,t)),n.bottom!=null&&r.bottom!=null&&(this.bottom=Km(r.bottom,n.bottom,t)),n.left!=null&&r.left!=null&&(this.left=Km(r.left,n.left,t)),n.right!=null&&r.right!=null&&(this.right=Km(r.right,n.right,t)),this}},{key:"getCenter",value:function(r,n){var t=p0((this.left+r-this.right)/2,0,r),o=p0((this.top+n-this.bottom)/2,0,n);return new Ul(t,o)}},{key:"equals",value:function(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),fL=2*Math.PI*hL;function pL(e){return fL*Math.cos(e*Math.PI/180)}function G3(e){return(180+e)/360}function H3(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function dL(e,a){return e/pL(a)}function YO(e){return e*360-180}function uP(e){var a=180-e*360;return 360/Math.PI*Math.atan(Math.exp(a*Math.PI/180))-90}function qO(e,a){return e*pL(uP(a))}function KO(e){return 1/Math.cos(e*Math.PI/180)}var Vy=function(){function e(a,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;(0,Be.Z)(this,e),this.x=+a,this.y=+r,this.z=+n}return(0,Me.Z)(e,[{key:"toLngLat",value:function(){return new ef(YO(this.x),uP(this.y))}},{key:"toAltitude",value:function(){return qO(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/fL*KO(uP(this.y))}}],[{key:"fromLngLat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=ef.convert(r);return new e(G3(t.lng),H3(t.lat),dL(n,t.lat))}}]),e}();function JO(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QO(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function QO(e,a){if(e){if(typeof e=="string")return vL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vL(e,a)}}function vL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var EN=8192,eF=function(){function e(a,r,n,t,o){(0,Be.Z)(this,e),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=o===void 0?!0:o,this._minZoom=a||0,this._maxZoom=r||22,this._minPitch=n==null?0:n,this._maxPitch=t==null?60:t,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ef(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new XO,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,Me.Z)(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}},{key:"minPitch",get:function(){return this._minPitch},set:function(r){this._minPitch!==r&&(this._minPitch=r,this._pitch=Math.max(this._pitch,r))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(r){this._maxPitch!==r&&(this._maxPitch=r,this._pitch=Math.min(this._pitch,r))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Ul(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(r){var n=-aP(r,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=$O(),WO(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(r){var n=p0(r,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==n&&(this.unmodified=!1,this._pitch=n,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this.unmodified=!1,this._fov=r/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(r){var n=Math.min(Math.max(r,this._minZoom),this._maxZoom);this._zoom!==n&&(this.unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this.unmodified=!1,this._center=r,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(r){this.edgeInsets.equals(r)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,r,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var r=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r.center=this._center,r.zoom=this.zoom,r.angle=this.angle,r.fov=this._fov,r.pitch=this._pitch,r.unmodified=this.unmodified,r.edgeInsets=this.edgeInsets.clone(),r.calcMatrices(),r}},{key:"isPaddingEqual",value:function(r){return this.edgeInsets.equals(r)}},{key:"interpolatePadding",value:function(r,n,t){this.unmodified=!1,this.edgeInsets.interpolate(r,n,t),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(r){var n=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,n)}},{key:"resize",value:function(r,n){this.width=r,this.height=n,this.pixelsToGLUnits=[2/r,-2/n],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(r){return Math.pow(2,r)}},{key:"scaleZoom",value:function(r){return Math.log(r)/Math.LN2}},{key:"project",value:function(r){var n=p0(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Ul(G3(r.lng)*this.worldSize,H3(n)*this.worldSize)}},{key:"unproject",value:function(r){return new Vy(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(r,n){var t=this.pointCoordinate(n),o=this.pointCoordinate(this.centerPoint),u=this.locationCoordinate(r),f=new Vy(u.x-(t.x-o.x),u.y-(t.y-o.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(r){var n=0,t=new Float64Array([r.x,r.y,0,1]),o=new Float64Array([r.x,r.y,1,1]);Jv(t,t,this.pixelMatrixInverse),Jv(o,o,this.pixelMatrixInverse);var u=t[3],f=o[3],g=t[0]/u,E=o[0]/f,R=t[1]/u,B=o[1]/f,Y=t[2]/u,Q=o[2]/f,ce=Y===Q?0:(n-Y)/(Q-Y);return new Vy(Km(g,E,ce)/this.worldSize,Km(R,B,ce)/this.worldSize)}},{key:"getBounds",value:function(){return new fx().extend(this.pointLocation(new Ul(0,0))).extend(this.pointLocation(new Ul(this.width,0))).extend(this.pointLocation(new Ul(this.width,this.height))).extend(this.pointLocation(new Ul(0,this.height)))}},{key:"getMaxBounds",value:function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new fx([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}},{key:"setMaxBounds",value:function(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var r=this.pointCoordinate(new Ul(0,0)),n=new Float32Array([r.x*this.worldSize,r.y*this.worldSize,0,1]),t=Jv(n,n,this.pixelMatrix);return t[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var r=this._pitch,n=Math.tan(r)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Ul(0,n))}},{key:"getCameraQueryGeometry",value:function(r){var n=this.getCameraPoint();if(r.length===1)return[r[0],n];var t=n.x,o=n.y,u=n.x,f=n.y,g=JO(r),E;try{for(g.s();!(E=g.n()).done;){var R=E.value;t=Math.min(t,R.x),o=Math.min(o,R.y),u=Math.max(u,R.x),f=Math.max(f,R.y)}}catch(B){g.e(B)}finally{g.f()}return[new Ul(t,o),new Ul(u,o),new Ul(u,f),new Ul(t,f),new Ul(t,o)]}},{key:"coordinatePoint",value:function(r){var n=Np(r.x*this.worldSize,r.y*this.worldSize,0,1);return Jv(n,n,this.pixelMatrix),new Ul(n[0]/n[3],n[1]/n[3])}},{key:"locationPoint",value:function(r){return this.coordinatePoint(this.locationCoordinate(r))}},{key:"pointLocation",value:function(r){return this.coordinateLocation(this.pointCoordinate(r))}},{key:"locationCoordinate",value:function(r){return Vy.fromLngLat(r)}},{key:"coordinateLocation",value:function(r){return r.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(!(!this.center||!this.width||!this.height||this.constraining)){this.constraining=!0;var r=-90,n=90,t=-180,o=180,u,f,g,E,R=this.size,B=this.unmodified;if(this.latRange){var Y=this.latRange;r=H3(Y[1])*this.worldSize,n=H3(Y[0])*this.worldSize,u=n-r<R.y?R.y/(n-r):0}if(this.lngRange){var Q=this.lngRange;t=G3(Q[0])*this.worldSize,o=G3(Q[1])*this.worldSize,f=o-t<R.x?R.x/(o-t):0}var ce=this.point,fe=Math.max(f||0,u||0);if(fe){this.center=this.unproject(new Ul(f?(o+t)/2:ce.x,u?(n+r)/2:ce.y)),this.zoom+=this.scaleZoom(fe),this.unmodified=B,this.constraining=!1;return}if(this.latRange){var Te=ce.y,Ve=R.y/2;Te-Ve<r&&(E=r+Ve),Te+Ve>n&&(E=n-Ve)}if(this.lngRange){var st=ce.x,at=R.x/2;st-at<t&&(g=t+at),st+at>o&&(g=o-at)}(g!==void 0||E!==void 0)&&(this.center=this.unproject(new Ul(g!==void 0?g:ce.x,E!==void 0?E:ce.y))),this.unmodified=B,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var r=this._fov/2,n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(r)*this.height;var t=Math.PI/2+this._pitch,o=this._fov*(.5+n.y/this.height),u=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p0(Math.PI-t-o,.01,Math.PI-.01)),f=this.point,g=f.x,E=f.y,R=Math.cos(Math.PI/2-this._pitch)*u+this.cameraToCenterDistance,B=R*1.01,Y=this.height/50,Q=new Float64Array(16);ne(Q,this._fov,this.width/this.height,Y,B),Q[8]=-n.x*2/this.width,Q[9]=n.y*2/this.height,Xo(Q,Q,[1,-1,1]),Bo(Q,Q,[0,0,-this.cameraToCenterDistance]),Wi(Q,Q,this._pitch),Ba(Q,Q,this.angle),Bo(Q,Q,[-g,-E,0]),this.mercatorMatrix=Xo([],Q,[this.worldSize,this.worldSize,this.worldSize]),Xo(Q,Q,[1,1,dL(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Q,this.invProjMatrix=Oo([],this.projMatrix);var ce=this.width%2/2,fe=this.height%2/2,Te=Math.cos(this.angle),Ve=Math.sin(this.angle),st=g-Math.round(g)+Te*ce+Ve*fe,at=E-Math.round(E)+Te*fe+Ve*ce,Tt=new Float64Array(Q);if(Bo(Tt,Tt,[st>.5?st-1:st,at>.5?at-1:at,0]),this.alignedProjMatrix=Tt,Q=Kn(),Xo(Q,Q,[this.width/2,-this.height/2,1]),Bo(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=Kn(),Xo(Q,Q,[1,-1,1]),Bo(Q,Q,[-1,-1,0]),Xo(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=Wo(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),Q=Oo(new Float64Array(16),this.pixelMatrix),!Q)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Q,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),tF=Ga.merge,Uc=(0,Me.Z)(function e(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Be.Z)(this,e),tF(this,r),this.type=a});function rF(e){var a=nF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function nF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gg=Ga.merge,mL=function(e){(0,yt.Z)(r,e);var a=rF(r);function r(n){var t;(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"renderFrameCallback",function(){var R=Math.min((V0()-t.easeStart)/t.easeOptions.duration,1);t.onEaseFrame(t.easeOptions.easing(R)),R<1?t.easeFrameId=t.requestRenderFrame(t.renderFrameCallback):t.stop()}),t.options=n;var o=n.minZoom,u=n.maxZoom,f=n.minPitch,g=n.maxPitch,E=n.renderWorldCopies;return t.moving=!1,t.zooming=!1,t.bearingSnap=n.bearingSnap,t.pitchEnabled=n.pitchEnabled,t.rotateEnabled=n.rotateEnabled,t.transform=new eF(o,u,f,g,E),t}return(0,Me.Z)(r,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,o=t.lng,u=t.lat;return new ef(o,u)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,o){return this.jumpTo({center:t},o)}},{key:"setPitch",value:function(t,o){return this.jumpTo({pitch:t},o),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,o,u){return this.easeTo(Gg({center:t},o),u)}},{key:"panBy",value:function(t,o,u){return t=Ul.convert(t).mult(-1),this.panTo(this.transform.center,HO({offset:t},o||{}),u)}},{key:"zoomOut",value:function(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}},{key:"setBearing",value:function(t,o){return this.jumpTo({bearing:t},o),this}},{key:"setZoom",value:function(t,o){return this.jumpTo({zoom:t},o),this}},{key:"zoomIn",value:function(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}},{key:"zoomTo",value:function(t,o,u){return this.easeTo(Gg({zoom:t},o),u)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,o){return this.jumpTo({padding:t},o),this}},{key:"rotateTo",value:function(t,o,u){return this.easeTo(Gg({bearing:t},o),u)}},{key:"resetNorth",value:function(t,o){return this.rotateTo(0,Gg({duration:1e3},t),o),this}},{key:"resetNorthPitch",value:function(t,o){return this.easeTo(Gg({bearing:0,pitch:0,duration:1e3},t),o),this}},{key:"fitBounds",value:function(t,o,u){return this.fitInternal(this.cameraForBounds(t,o),o,u)}},{key:"cameraForBounds",value:function(t,o){return t=fx.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,o)}},{key:"snapToNorth",value:function(t,o){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,o):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;this.stop();var u=this.transform,f=!1,g=!1,E=!1;return t.zoom!==void 0&&u.zoom!==+t.zoom&&(f=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=ef.convert(t.center)),t.bearing!==void 0&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),t.pitch!==void 0&&u.pitch!==+t.pitch&&(E=!0,u.pitch=+t.pitch),t.padding!==void 0&&!u.isPaddingEqual(t.padding)&&(u.padding=t.padding),this.emit("movestart",new Uc("movestart",o)),this.emit("move",new Uc("move",o)),f&&(this.emit("zoomstart",new Uc("zoomstart",o)),this.emit("zoom",new Uc("zoom",o)),this.emit("zoomend",new Uc("zoomend",o))),g&&(this.emit("rotatestart",new Uc("rotatestart",o)),this.emit("rotate",new Uc("rotate",o)),this.emit("rotateend",new Uc("rotateend",o))),E&&(this.emit("pitchstart",new Uc("pitchstart",o)),this.emit("pitch",new Uc("pitch",o)),this.emit("pitchend",new Uc("pitchend",o))),this.emit("moveend",new Uc("moveend",o))}},{key:"easeTo",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;o=Gg({offset:[0,0],duration:500,easing:sP},o),(o.animate===!1||!o.essential&&cL())&&(o.duration=0);var f=this.transform,g=this.getZoom(),E=this.getBearing(),R=this.getPitch(),B=this.getPadding(),Y=o.zoom?+o.zoom:g,Q=o.bearing?this.normalizeBearing(o.bearing,E):E,ce=o.pitch?+o.pitch:R,fe=o.padding?o.padding:f.padding,Te=Ul.convert(o.offset),Ve=f.centerPoint.add(Te),st=f.pointLocation(Ve),at=ef.convert(o.center||st);this.normalizeCenter(at);var Tt=f.project(st),kt=f.project(at).sub(Tt),Yt=f.zoomScale(Y-g),cr,Mr;o.around&&(cr=ef.convert(o.around),Mr=f.locationPoint(cr));var Dr={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||Y!==g,this.rotating=this.rotating||E!==Q,this.pitching=this.pitching||ce!==R,this.padding=!f.isPaddingEqual(fe),this.easeId=o.easeId,this.prepareEase(u,o.noMoveStart,Dr),clearTimeout(this.easeEndTimeoutID),this.ease(function(sn){if(t.zooming&&(f.zoom=Km(g,Y,sn)),t.rotating&&t.rotateEnabled&&(f.bearing=Km(E,Q,sn)),t.pitching&&t.pitchEnabled&&(f.pitch=Km(R,ce,sn)),t.padding&&(f.interpolatePadding(B,fe,sn),Ve=f.centerPoint.add(Te)),cr)f.setLocationAtPoint(cr,Mr);else{var rn=f.zoomScale(f.zoom-g),Jn=Y>g?Math.min(2,Yt):Math.max(.5,Yt),fi=Math.pow(Jn,1-sn),Hi=f.unproject(Tt.add(kt.mult(sn*fi)).mult(rn));f.setLocationAtPoint(f.renderWorldCopies?Hi.wrap():Hi,Ve)}t.fireMoveEvents(u)},function(sn){t.afterEase(u,sn)},o),this}},{key:"flyTo",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;if(!o.essential&&cL()){var f=jO(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(f,u)}this.stop(),o=Gg({offset:[0,0],speed:1.2,curve:1.42,easing:sP},o);var g=this.transform,E=this.getZoom(),R=this.getBearing(),B=this.getPitch(),Y=this.getPadding(),Q=o.zoom?p0(+o.zoom,g.minZoom,g.maxZoom):E,ce=o.bearing?this.normalizeBearing(o.bearing,R):R,fe=o.pitch?+o.pitch:B,Te="padding"in o?o.padding:g.padding,Ve=g.zoomScale(Q-E),st=Ul.convert(o.offset),at=g.centerPoint.add(st),Tt=g.pointLocation(at),kt=ef.convert(o.center||Tt);this.normalizeCenter(kt);var Yt=g.project(Tt),cr=g.project(kt).sub(Yt),Mr=o.curve,Dr=Math.max(g.width,g.height),sn=Dr/Ve,rn=cr.mag();if("minZoom"in o){var Jn=p0(Math.min(o.minZoom,E,Q),g.minZoom,g.maxZoom),fi=Dr/g.zoomScale(Jn-E);Mr=Math.sqrt(fi/rn*2)}var Hi=Mr*Mr;function Ds(tf){var Av=(sn*sn-Dr*Dr+(tf?-1:1)*Hi*Hi*rn*rn)/(2*(tf?sn:Dr)*Hi*rn);return Math.log(Math.sqrt(Av*Av+1)-Av)}function pu(tf){return(Math.exp(tf)-Math.exp(-tf))/2}function $s(tf){return(Math.exp(tf)+Math.exp(-tf))/2}function Pc(tf){return pu(tf)/$s(tf)}var lc=Ds(0),up=function(Av){return $s(lc)/$s(lc+Mr*Av)},Xg=function(Av){return Dr*(($s(lc)*Pc(lc+Mr*Av)-pu(lc))/Hi)/rn},Uv=(Ds(1)-lc)/Mr;if(Math.abs(rn)<1e-6||!isFinite(Uv)){if(Math.abs(Dr-sn)<1e-6)return this.easeTo(o,u);var $0=sn<Dr?-1:1;Uv=Math.abs(Math.log(sn/Dr))/Mr,Xg=function(){return 0},up=function(Av){return Math.exp($0*Mr*Av)}}if("duration"in o)o.duration=+o.duration;else{var a_="screenSpeed"in o?+o.screenSpeed/Mr:+o.speed;o.duration=1e3*Uv/a_}return o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this.zooming=!0,this.rotating=R!==ce,this.pitching=fe!==B,this.padding=!g.isPaddingEqual(Te),this.prepareEase(u,!1),this.ease(function(tf){var Av=tf*Uv,fE=1/up(Av);g.zoom=tf===1?Q:E+g.scaleZoom(fE),t.rotating&&(g.bearing=Km(R,ce,tf)),t.pitching&&(g.pitch=Km(B,fe,tf)),t.padding&&(g.interpolatePadding(Y,Te,tf),at=g.centerPoint.add(st));var pE=tf===1?kt:g.unproject(Yt.add(cr.mult(Xg(Av))).mult(fE));g.setLocationAtPoint(g.renderWorldCopies?pE.wrap():pE,at),t.fireMoveEvents(u)},function(){return t.afterEase(u)},o),this}},{key:"fitScreenCoordinates",value:function(t,o,u,f,g){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Ul.convert(t)),this.transform.pointLocation(Ul.convert(o)),u,f),f,g)}},{key:"stop",value:function(t,o){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var u=this.onEaseEnd;delete this.onEaseEnd,u.call(this,o)}return this}},{key:"normalizeBearing",value:function(t,o){t=aP(t,-180,180);var u=Math.abs(t-o);return Math.abs(t-360-o)<u&&(t-=360),Math.abs(t+360-o)<u&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var o=this.transform;if(!(!o.renderWorldCopies||o.lngRange)){var u=t.lng-o.center.lng;t.lng+=u>180?-360:u<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new Uc("move",t)),this.zooming&&this.emit("zoom",new Uc("zoom",t)),this.rotating&&this.emit("rotate",new Uc("rotate",t)),this.pitching&&this.emit("rotate",new Uc("pitch",t))}},{key:"prepareEase",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.moving=!0,!o&&!u.moving&&this.emit("movestart",new Uc("movestart",t)),this.zooming&&!u.zooming&&this.emit("zoomstart",new Uc("zoomstart",t)),this.rotating&&!u.rotating&&this.emit("rotatestart",new Uc("rotatestart",t)),this.pitching&&!u.pitching&&this.emit("pitchstart",new Uc("pitchstart",t))}},{key:"afterEase",value:function(t,o){if(!(this.easeId&&o&&this.easeId===o)){delete this.easeId;var u=this.zooming,f=this.rotating,g=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,u&&this.emit("zoomend",new Uc("zoomend",t)),f&&this.emit("rotateend",new Uc("rotateend",t)),g&&this.emit("pitchend",new Uc("pitchend",t)),this.emit("moveend",new Uc("moveend",t))}}},{key:"ease",value:function(t,o,u){u.animate===!1||u.duration===0?(t(1),o()):(this.easeStart=V0(),this.easeOptions=u,this.onEaseFrame=t,this.onEaseEnd=o,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,o,u,f){var g={top:0,bottom:0,right:0,left:0};if(f=Gg({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f),typeof f.padding=="number"){var E=f.padding;f.padding={top:E,bottom:E,right:E,left:E}}f.padding=Gg(g,f.padding);var R=this.transform,B=R.padding,Y=R.project(ef.convert(t)),Q=R.project(ef.convert(o)),ce=Y.rotate(-u*Math.PI/180),fe=Q.rotate(-u*Math.PI/180),Te=new Ul(Math.max(ce.x,fe.x),Math.max(ce.y,fe.y)),Ve=new Ul(Math.min(ce.x,fe.x),Math.min(ce.y,fe.y)),st=Te.sub(Ve),at=(R.width-(B.left+B.right+f.padding.left+f.padding.right))/st.x,Tt=(R.height-(B.top+B.bottom+f.padding.top+f.padding.bottom))/st.y;if(!(Tt<0||at<0)){var kt=Math.min(R.scaleZoom(R.scale*Math.min(at,Tt)),f.maxZoom),Yt=Ul.convert(f.offset),cr=(f.padding.left-f.padding.right)/2,Mr=(f.padding.top-f.padding.bottom)/2,Dr=new Ul(Yt.x+cr,Yt.y+Mr),sn=Dr.mult(R.scale/R.zoomScale(kt)),rn=R.unproject(Y.add(Q).div(2).sub(sn));return{center:rn,zoom:kt,bearing:u}}}},{key:"fitInternal",value:function(t,o,u){return t?(o=Gg(t,o),delete o.padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}}]),r}(Z.EventEmitter);function gL(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iF(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function iF(e,a){if(e){if(typeof e=="string")return yL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yL(e,a)}}function yL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var Lm={},fv=Lm;Lm.create=function(e,a,r){var n=window.document.createElement(e);return a!==void 0&&(n.className=a),r&&r.appendChild(n),n},Lm.createNS=function(e,a){var r=window.document.createElementNS(e,a);return r};var Gy=window.document&&window.document.documentElement.style;function _L(e){if(!Gy)return e[0];var a=gL(e),r;try{for(a.s();!(r=a.n()).done;){var n=r.value;if(n in Gy)return n}}catch(t){a.e(t)}finally{a.f()}return e[0]}var px=_L(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),bL;Lm.disableDrag=function(){Gy&&px&&(bL=Gy[px],Gy[px]="none")},Lm.enableDrag=function(){Gy&&px&&(Gy[px]=bL)};var aF=_L(["transform","WebkitTransform"]);Lm.setTransform=function(e,a){e.style[aF]=a};var $3=!1;try{var W3=Object.defineProperty({},"passive",{get:function(){$3=!0}});window.addEventListener("test",W3,W3),window.removeEventListener("test",W3,W3)}catch(e){$3=!1}Lm.addEventListener=function(e,a,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&$3?e.addEventListener(a,r,n):e.addEventListener(a,r,n.capture)},Lm.removeEventListener=function(e,a,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&$3?e.removeEventListener(a,r,n):e.removeEventListener(a,r,n.capture)};var xL=function e(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",e,!0)};Lm.suppressClick=function(){window.addEventListener("click",xL,!0),setTimeout(function(){window.removeEventListener("click",xL,!0)},0)},Lm.mousePos=function(e,a){var r=e.getBoundingClientRect();return new Ul(a.clientX-r.left-e.clientLeft,a.clientY-r.top-e.clientTop)},Lm.touchPos=function(e,a){var r=e.getBoundingClientRect(),n=[],t=gL(a),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;n.push(new Ul(u.clientX-r.left-e.clientLeft,u.clientY-r.top-e.clientTop))}}catch(f){t.e(f)}finally{t.f()}return n},Lm.mouseButton=function(e){return e.button},Lm.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};function oF(e){var a=sF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function sF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uF=Ga.merge,d0=function(e){(0,yt.Z)(r,e);var a=oF(r);function r(n,t,o){var u,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};(0,Be.Z)(this,r);var g=fv.mousePos(t.getCanvasContainer(),o),E=t.unproject(g);return u=a.call(this,n,uF({point:g,lngLat:E,originalEvent:o},f)),u.defaultPrevented=!1,u.target=t,u}return(0,Me.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(Uc);function lF(e){var a=cF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function cF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=function(e){(0,yt.Z)(r,e);var a=lF(r);function r(n,t,o){var u;(0,Be.Z)(this,r);var f=n==="touchend"?o.changedTouches:o.touches,g=fv.touchPos(t.getCanvasContainer(),f),E=g.map(function(Y){return t.unproject(Y)}),R=g.reduce(function(Y,Q,ce,fe){return Y.add(Q.div(fe.length))},new Ul(0,0)),B=t.unproject(R);return u=a.call(this,n,{points:g,point:R,lngLats:E,lngLat:B,originalEvent:o}),u.defaultPrevented=!1,u}return(0,Me.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(Uc);function hF(e){var a=fF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function fF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pF=function(e){(0,yt.Z)(r,e);var a=hF(r);function r(n,t,o){var u;return(0,Be.Z)(this,r),u=a.call(this,n,{originalEvent:o}),u.defaultPrevented=!1,u}return(0,Me.Z)(r,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),r}(Uc),dF=function(){function e(a){(0,Be.Z)(this,e),this.map=a}return(0,Me.Z)(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(r){this.map.emit(r.type,new d0(r.type,this.map,r))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new d0("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(r){this.delayContextMenu?this.contextMenuEvent=r:this.map.emit(r.type,new d0(r.type,this.map,r)),this.map.listeners("contextmenu")&&r.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),vF=function(){function e(a,r){(0,Be.Z)(this,e),this.map=a,this.el=a.getCanvasContainer(),this.container=a.getContainer(),this.clickTolerance=r.clickTolerance||1}return(0,Me.Z)(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(r,n){this.isEnabled()&&r.shiftKey&&r.button===0&&(fv.disableDrag(),this.startPos=this.lastPos=n,this.active=!0)}},{key:"mousemoveWindow",value:function(r,n){if(this.active){var t=n;if(!(this.lastPos.equals(t)||!this.box&&t.dist(this.startPos)<this.clickTolerance)){var o=this.startPos;this.lastPos=t,this.box||(this.box=fv.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",r));var u=Math.min(o.x,t.x),f=Math.max(o.x,t.x),g=Math.min(o.y,t.y),E=Math.max(o.y,t.y);fv.setTransform(this.box,"translate(".concat(u,"px,").concat(g,"px)")),this.box&&(this.box.style.width="".concat(f-u,"px"),this.box.style.height="".concat(E-g,"px"))}}}},{key:"mouseupWindow",value:function(r,n){var t=this;if(this.active&&r.button===0){var o=this.startPos,u=n;if(this.reset(),fv.suppressClick(),o.x===u.x&&o.y===u.y)this.fireEvent("boxzoomcancel",r);else return this.map.emit("boxzoomend",new Uc("boxzoomend",{originalEvent:r})),{cameraAnimation:function(g){return g.fitScreenCoordinates(o,u,t.map.getBearing(),{linear:!0})}}}}},{key:"keydown",value:function(r){this.active&&r.keyCode===27&&(this.reset(),this.fireEvent("boxzoomcancel",r))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(fv.remove(this.box),this.box=null),fv.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(r,n){return this.map.emit(r,new Uc(r,{originalEvent:n}))}}]),e}(),mF=vF,gF=function(){function e(){(0,Be.Z)(this,e),this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(r,n){return r.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(r.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:r})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function yF(e){var a=_F();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function _F(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bF=function(e){(0,yt.Z)(r,e);var a=yF(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"type","renderFrame"),n}return(0,Me.Z)(r)}(Uc);function xF(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wF(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function wF(e,a){if(e){if(typeof e=="string")return wL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wL(e,a)}}function wL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var Q1=Ga.merge,Y3={linearity:.3,easing:oP(0,0,.3,1)},SF=Q1({deceleration:2500,maxSpeed:1400},Y3),EF=Q1({deceleration:20,maxSpeed:1400},Y3),CF=Q1({deceleration:1e3,maxSpeed:360},Y3),AF=Q1({deceleration:1e3,maxSpeed:90},Y3),TF=function(){function e(a){(0,Be.Z)(this,e),this.map=a,this.clear()}return(0,Me.Z)(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(r){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:V0(),settings:r})}},{key:"drainInertiaBuffer",value:function(){for(var r=this.inertiaBuffer,n=V0(),t=160;r.length>0&&n-r[0].time>t;)r.shift()}},{key:"onMoveEnd",value:function(r){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var n={zoom:0,bearing:0,pitch:0,pan:new Ul(0,0),pinchAround:void 0,around:void 0},t=xF(this.inertiaBuffer),o;try{for(t.s();!(o=t.n()).done;){var u=o.value.settings;n.zoom+=u.zoomDelta||0,n.bearing+=u.bearingDelta||0,n.pitch+=u.pitchDelta||0,u.panDelta&&n.pan._add(u.panDelta),u.around&&(n.around=u.around),u.pinchAround&&(n.pinchAround=u.pinchAround)}}catch(fe){t.e(fe)}finally{t.f()}var f=this.inertiaBuffer[this.inertiaBuffer.length-1],g=f.time-this.inertiaBuffer[0].time,E={};if(n.pan.mag()){var R=K3(n.pan.mag(),g,Q1({},SF,r||{}));E.offset=n.pan.mult(R.amount/n.pan.mag()),E.center=this.map.transform.center,q3(E,R)}if(n.zoom){var B=K3(n.zoom,g,EF);E.zoom=this.map.transform.zoom+B.amount,q3(E,B)}if(n.bearing){var Y=K3(n.bearing,g,CF);E.bearing=this.map.transform.bearing+p0(Y.amount,-179,179),q3(E,Y)}if(n.pitch){var Q=K3(n.pitch,g,AF);E.pitch=this.map.transform.pitch+Q.amount,q3(E,Q)}if(E.zoom||E.bearing){var ce=n.pinchAround===void 0?n.around:n.pinchAround;E.around=ce?this.map.unproject(ce):this.map.getCenter()}return this.clear(),Q1(E,{noMoveStart:!0})}}}]),e}();function q3(e,a){(!e.duration||e.duration<a.duration)&&(e.duration=a.duration,e.easing=a.easing)}function K3(e,a,r){var n=r.maxSpeed,t=r.linearity,o=r.deceleration,u=p0(e*t/(a/1e3),-n,n),f=Math.abs(u)/(o*t);return{easing:r.easing,duration:f*1e3,amount:u*(f/2)}}var MF={panStep:100,bearingStep:15,pitchStep:10},PF=function(){function e(){(0,Be.Z)(this,e);var a=MF;this.panStep=a.panStep,this.bearingStep=a.bearingStep,this.pitchStep=a.pitchStep}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(r){var n=this;if(!(r.altKey||r.ctrlKey||r.metaKey)){var t=0,o=0,u=0,f=0,g=0;switch(r.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:r.shiftKey?o=-1:(r.preventDefault(),f=-1);break;case 39:r.shiftKey?o=1:(r.preventDefault(),f=1);break;case 38:r.shiftKey?u=1:(r.preventDefault(),g=-1);break;case 40:r.shiftKey?u=-1:(r.preventDefault(),g=1);break;default:return}return{cameraAnimation:function(R){var B=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:kF,zoom:t?Math.round(B)+t*(r.shiftKey?2:1):B,bearing:R.getBearing()+o*n.bearingStep,pitch:R.getPitch()+u*n.pitchStep,offset:[-f*n.panStep,-g*n.panStep],center:R.getCenter()},{originalEvent:r})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function kF(e){return e*(2-e)}var IF=PF,LF=function(){function e(a,r){(0,Be.Z)(this,e),this.map=a,this.clickTolerance=r.clickTolerance}return(0,Me.Z)(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(r){return this.firePreventable(new pF(r.type,this.map,r))}},{key:"mousedown",value:function(r,n){return this.mousedownPos=n,this.firePreventable(new d0(r.type,this.map,r))}},{key:"mouseup",value:function(r){this.map.emit(r.type,new d0(r.type,this.map,r))}},{key:"click",value:function(r,n){this.mousedownPos&&this.mousedownPos.dist(n)>=this.clickTolerance||this.map.emit(r.type,new d0(r.type,this.map,r))}},{key:"dblclick",value:function(r){return this.firePreventable(new d0(r.type,this.map,r))}},{key:"mouseover",value:function(r){this.map.emit(r.type,new d0(r.type,this.map,r))}},{key:"mouseout",value:function(r){this.map.emit(r.type,new d0(r.type,this.map,r))}},{key:"touchstart",value:function(r){return this.firePreventable(new X3(r.type,this.map,r))}},{key:"touchmove",value:function(r){this.map.emit(r.type,new X3(r.type,this.map,r))}},{key:"touchend",value:function(r){this.map.emit(r.type,new X3(r.type,this.map,r))}},{key:"touchcancel",value:function(r){this.map.emit(r.type,new X3(r.type,this.map,r))}},{key:"firePreventable",value:function(r){if(this.map.emit(r.type,r),r.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),J3,Q3=0,lP=2,RF=(J3={},(0,Pe.Z)(J3,Q3,1),(0,Pe.Z)(J3,lP,2),J3);function DF(e,a){var r=RF[a];return e.buttons===void 0||(e.buttons&r)!==r}var cP=function(){function e(a){(0,Be.Z)(this,e),this.reset(),this.clickTolerance=a.clickTolerance||1}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(r,n){if(!this.lastPoint){var t=fv.mouseButton(r);this.correctButton(r,t)&&(this.lastPoint=n,this.eventButton=t)}}},{key:"mousemoveWindow",value:function(r,n){var t=this.lastPoint;if(t){if(r.preventDefault(),DF(r,this.eventButton)){this.reset();return}if(!(!this.moved&&n.dist(t)<this.clickTolerance))return this.moved=!0,this.lastPoint=n,this.move(t,n)}}},{key:"mouseupWindow",value:function(r){if(this.lastPoint){var n=fv.mouseButton(r);n===this.eventButton&&(this.moved&&fv.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(r,n){return!1}},{key:"move",value:function(r,n){}}]),e}();function OF(e){var a=FF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function FF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zF=function(e){(0,yt.Z)(r,e);var a=OF(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"mousedown",value:function(t,o){Ou((0,Ze.Z)(r.prototype),"mousedown",this).call(this,t,o),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,o){return{around:o,panDelta:o.sub(t)}}},{key:"correctButton",value:function(t,o){return o===Q3&&!t.ctrlKey}}]),r}(cP);function BF(e){var a=NF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function NF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZF=function(e){(0,yt.Z)(r,e);var a=BF(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"correctButton",value:function(t,o){return o===Q3&&t.ctrlKey||o===lP}},{key:"move",value:function(t,o){var u=-.5,f=(o.y-t.y)*u;if(f)return this.active=!0,{pitchDelta:f}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),r}(cP);function UF(e){var a=jF();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function jF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VF=function(e){(0,yt.Z)(r,e);var a=UF(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,o){return o===Q3&&t.ctrlKey||o===lP}},{key:"move",value:function(t,o){var u=.8,f=(o.x-t.x)*u;if(f)return this.active=!0,{bearingDelta:f}}}]),r}(cP),SL=4.000244140625,GF=1/100,HF=1/450,$F=2,WF=function(){function e(a,r){var n=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"onScrollFrame",function(){if(n.frameId&&(n.frameId=null,!!n.isActive())){var t=n.map.transform;if(n.delta!==0){var o=n.type==="wheel"&&Math.abs(n.delta)>SL?n.wheelZoomRate:n.defaultZoomRate,u=$F/(1+Math.exp(-Math.abs(n.delta*o)));n.delta<0&&u!==0&&(u=1/u);var f=typeof n.targetZoom=="number"?t.zoomScale(n.targetZoom):t.scale;n.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(f*u))),n.type==="wheel"&&(n.startZoom=t.zoom,n.easing=n.smoothOutEasing(200)),n.delta=0}var g=typeof n.targetZoom=="number"?n.targetZoom:t.zoom,E=n.startZoom,R=n.easing,B=!1,Y;if(n.type==="wheel"&&E&&R){var Q=Math.min((V0()-n.lastWheelEventTime)/200,1),ce=R(Q);Y=Km(E,g,ce),Q<1?n.frameId||(n.frameId=!0):B=!0}else Y=g,B=!0;return n.active=!0,B&&(n.active=!1,n.finishTimeout=setTimeout(function(){n.zooming=!1,n.handler.triggerRenderFrame(),delete n.targetZoom,delete n.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:Y-t.zoom,around:n.aroundPoint,originalEvent:n.lastWheelEvent}}}),this.map=a,this.el=a.getCanvasContainer(),this.handler=r,this.delta=0,this.defaultZoomRate=GF,this.wheelZoomRate=HF}return(0,Me.Z)(e,[{key:"setZoomRate",value:function(r){this.defaultZoomRate=r}},{key:"setWheelZoomRate",value:function(r){this.wheelZoomRate=r}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||this.finishTimeout!==void 0}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(r){this.isEnabled()||(this.enabled=!0,this.aroundCenter=r&&r.around==="center")}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(r){if(this.isEnabled()){var n=r.deltaMode===window.WheelEvent.DOM_DELTA_LINE?r.deltaY*40:r.deltaY,t=V0(),o=t-(this.lastWheelEventTime||0);this.lastWheelEventTime=t,n!==0&&n%SL===0?this.type="wheel":n!==0&&Math.abs(n)<4?this.type="trackpad":o>400?(this.type=null,this.lastValue=n,this.timeout=setTimeout(this.onTimeout,40,r)):this.type||(this.type=Math.abs(o*n)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,n+=this.lastValue)),r.shiftKey&&n&&(n=n/4),this.type&&(this.lastWheelEvent=r,this.delta-=n,this.active||this.start(r)),r.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(r){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(r)}},{key:"start",value:function(r){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var n=fv.mousePos(this.el,r);this.around=ef.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(n)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(r){var n=sP;if(this.prevEase){var t=this.prevEase,o=(V0()-t.start)/t.duration,u=t.easing(o+.01)-t.easing(o),f=.27/Math.sqrt(u*u+1e-4)*.01,g=Math.sqrt(.27*.27-f*f);n=oP(f,g,.25,1)}return this.prevEase={start:V0(),duration:r,easing:n},n}}]),e}(),XF=WF,YF=function(){function e(a,r){(0,Be.Z)(this,e),this.clickZoom=a,this.tapZoom=r}return(0,Me.Z)(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),qF=function(){function e(a,r,n){(0,Be.Z)(this,e),this.el=a,this.mousePan=r,this.touchPan=n}return(0,Me.Z)(e,[{key:"enable",value:function(r){this.inertiaOptions=r||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),KF=function(){function e(a,r,n){(0,Be.Z)(this,e),this.pitchWithRotate=a.pitchWithRotate,this.mouseRotate=r,this.mousePitch=n}return(0,Me.Z)(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),JF=function(){function e(a,r,n,t){(0,Be.Z)(this,e),this.el=a,this.touchZoom=r,this.touchRotate=n,this.tapDragZoom=t,this.rotationDisabled=!1,this.enabled=!0}return(0,Me.Z)(e,[{key:"enable",value:function(r){this.touchZoom.enable(r),this.rotationDisabled||this.touchRotate.enable(r),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function hP(e,a){for(var r={},n=0;n<e.length;n++)r[e[n].identifier]=a[n];return r}function QF(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ez(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function ez(e,a){if(e){if(typeof e=="string")return EL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EL(e,a)}}function EL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}function tz(e){var a=new Ul(0,0),r=QF(e),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;a._add(t)}}catch(o){r.e(o)}finally{r.f()}return a.div(e.length)}var CL=500,rz=500,AL=30,nz=function(){function e(a){(0,Be.Z)(this,e),this.reset(),this.numTouches=a.numTouches}return(0,Me.Z)(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(r,n,t){(this.centroid||t.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=r.timeStamp),t.length===this.numTouches&&(this.centroid=tz(n),this.touches=hP(t,n)))}},{key:"touchmove",value:function(r,n,t){if(!(this.aborted||!this.centroid)){var o=hP(t,n);for(var u in this.touches)if(this.touches[u]){var f=this.touches[u],g=o[u];(!g||g.dist(f)>AL)&&(this.aborted=!0)}}}},{key:"touchend",value:function(r,n,t){if((!this.centroid||r.timeStamp-this.startTime>rz)&&(this.aborted=!0),t.length===0){var o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}]),e}(),fP=function(){function e(a){(0,Be.Z)(this,e),this.singleTap=new nz(a),this.numTaps=a.numTaps,this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(r,n,t){this.singleTap.touchstart(r,n,t)}},{key:"touchmove",value:function(r,n,t){this.singleTap.touchmove(r,n,t)}},{key:"touchend",value:function(r,n,t){var o=this.singleTap.touchend(r,n,t);if(o){var u=r.timeStamp-this.lastTime<CL,f=!this.lastTap||this.lastTap.dist(o)<AL;if((!u||!f)&&this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}]),e}(),iz=function(){function e(){(0,Be.Z)(this,e),this.tap=new fP({numTouches:1,numTaps:1}),this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(r,n,t){this.swipePoint||(this.tapTime&&r.timeStamp-this.tapTime>CL&&this.reset(),this.tapTime?t.length>0&&(this.swipePoint=n[0],this.swipeTouch=t[0].identifier):this.tap.touchstart(r,n,t))}},{key:"touchmove",value:function(r,n,t){if(!this.tapTime)this.tap.touchmove(r,n,t);else if(this.swipePoint){if(t[0].identifier!==this.swipeTouch)return;var o=n[0],u=o.y-this.swipePoint.y;return this.swipePoint=o,r.preventDefault(),this.active=!0,{zoomDelta:u/128}}}},{key:"touchend",value:function(r,n,t){if(this.tapTime)this.swipePoint&&t.length===0&&this.reset();else{var o=this.tap.touchend(r,n,t);o&&(this.tapTime=r.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),az=function(){function e(){(0,Be.Z)(this,e),this.zoomIn=new fP({numTouches:1,numTaps:2}),this.zoomOut=new fP({numTouches:2,numTaps:1}),this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(r,n,t){this.zoomIn.touchstart(r,n,t),this.zoomOut.touchstart(r,n,t)}},{key:"touchmove",value:function(r,n,t){this.zoomIn.touchmove(r,n,t),this.zoomOut.touchmove(r,n,t)}},{key:"touchend",value:function(r,n,t){var o=this,u=this.zoomIn.touchend(r,n,t),f=this.zoomOut.touchend(r,n,t);if(u)return this.active=!0,r.preventDefault(),setTimeout(function(){return o.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(u)},{originalEvent:r})}};if(f)return this.active=!0,r.preventDefault(),setTimeout(function(){return o.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(f)},{originalEvent:r})}}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),oz=function(){function e(a){(0,Be.Z)(this,e),this.minTouches=1,this.clickTolerance=a.clickTolerance||1,this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Ul(0,0)}},{key:"touchstart",value:function(r,n,t){return this.calculateTransform(r,n,t)}},{key:"touchmove",value:function(r,n,t){if(this.active)return r.preventDefault(),this.calculateTransform(r,n,t)}},{key:"touchend",value:function(r,n,t){this.calculateTransform(r,n,t),this.active&&t.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(r,n,t){t.length>0&&(this.active=!0);var o=hP(t,n),u=new Ul(0,0),f=new Ul(0,0),g=0;for(var E in o)if(o[E]){var R=o[E],B=this.touches[E];B&&(u._add(R),f._add(R.sub(B)),g++,o[E]=R)}if(this.touches=o,!(g<this.minTouches||!f.mag())){var Y=f.div(g);if(this.sum._add(Y),!(this.sum.mag()<this.clickTolerance)){var Q=u.div(g);return{around:Q,panDelta:Y}}}}}]),e}(),pP=function(){function e(){(0,Be.Z)(this,e),this.reset()}return(0,Me.Z)(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(r){}},{key:"move",value:function(r,n,t){}},{key:"touchstart",value:function(r,n,t){this.firstTwoTouches||t.length<2||(this.firstTwoTouches=[t[0].identifier,t[1].identifier],this.start([n[0],n[1]]))}},{key:"touchmove",value:function(r,n,t){if(this.firstTwoTouches){r.preventDefault();var o=(0,gi.Z)(this.firstTwoTouches,2),u=o[0],f=o[1],g=eE(t,n,u),E=eE(t,n,f);if(!(!g||!E)){var R=this.aroundCenter?null:g.add(E).div(2);return this.move([g,E],R,r)}}}},{key:"touchend",value:function(r,n,t){if(this.firstTwoTouches){var o=(0,gi.Z)(this.firstTwoTouches,2),u=o[0],f=o[1],g=eE(t,n,u),E=eE(t,n,f);g&&E||(this.active&&fv.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(r){this.enabled=!0,this.aroundCenter=!!r&&r.around==="center"}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function eE(e,a,r){for(var n=0;n<e.length;n++)if(e[n].identifier===r)return a[n]}function sz(e){var a=uz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function uz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dP(e){return Math.abs(e.y)>Math.abs(e.x)}var lz=100,cz=function(e){(0,yt.Z)(r,e);var a=sz(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"reset",value:function(){Ou((0,Ze.Z)(r.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,dP(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,o,u){var f=t[0].sub(this.lastPoints[0]),g=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(f,g,u.timeStamp),!!this.valid){this.lastPoints=t,this.active=!0;var E=(f.y+g.y)/2,R=-.5;return{pitchDelta:E*R}}}},{key:"gestureBeginsVertically",value:function(t,o,u){if(this.valid!==void 0)return this.valid;var f=2,g=t.mag()>=f,E=o.mag()>=f;if(!(!g&&!E)){if(!g||!E)return this.firstMove===void 0&&(this.firstMove=u),u-this.firstMove<lz?void 0:!1;var R=t.y>0==o.y>0;return dP(t)&&dP(o)&&R}}}]),r}(pP);function hz(e){var a=fz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function fz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pz=25;function TL(e,a){return e.angleWith(a)*180/Math.PI}var dz=function(e){(0,yt.Z)(r,e);var a=hz(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"reset",value:function(){Ou((0,Ze.Z)(r.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,o){var u=this.vector;if(this.vector=t[0].sub(t[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:TL(this.vector,u),pinchAround:o}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var o=Math.PI*this.minDiameter,u=pz/o*360,f=TL(t,this.startVector);return Math.abs(f)<u}}]),r}(pP);function vz(e){var a=mz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function mz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gz=.1;function ML(e,a){return Math.log(e/a)/Math.LN2}var yz=function(e){(0,yt.Z)(r,e);var a=vz(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"reset",value:function(){Ou((0,Ze.Z)(r.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,o){var u=this.distance;if(this.distance=t[0].dist(t[1]),!(!this.active&&Math.abs(ML(this.distance,this.startDistance))<gz))return this.active=!0,{zoomDelta:ML(this.distance,u),pinchAround:o}}}]),r}(pP);function Hy(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_z(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function _z(e,a){if(e){if(typeof e=="string")return PL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PL(e,a)}}function PL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var vP=Ga.merge,tE=function(a){return a.zoom||a.drag||a.pitch||a.rotate};function mP(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var bz=function(){function e(a,r){var n=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"handleWindowEvent",function(B){n.handleEvent(B,"".concat(B.type,"Window"))}),(0,Pe.Z)(this,"handleEvent",function(B,Y){if(B.type==="blur"){n.stop();return}n.updatingCamera=!0;var Q=B.type==="renderFrame"?void 0:B,ce={needsRenderFrame:!1},fe={},Te={},Ve=B.touches?n.getMapTouches(B.touches):void 0,st=Ve?fv.touchPos(n.el,Ve):fv.mousePos(n.el,B),at=Hy(n.handlers),Tt;try{for(at.s();!(Tt=at.n()).done;){var kt=Tt.value,Yt=kt.handlerName,cr=kt.handler,Mr=kt.allowed;if(cr.isEnabled()){var Dr=void 0;if(n.blockedByActive(Te,Mr,Yt))cr.reset();else{var sn=Y||B.type;cr&&cr[sn]&&(Dr=cr[sn](B,st,Ve),n.mergeIHandlerResult(ce,fe,Dr,Yt,Q),Dr&&Dr.needsRenderFrame&&n.triggerRenderFrame())}(Dr||cr.isActive())&&(Te[Yt]=cr)}}}catch(Hi){at.e(Hi)}finally{at.f()}var rn={};for(var Jn in n.previousActiveHandlers)Te[Jn]||(rn[Jn]=Q);n.previousActiveHandlers=Te,(Object.keys(rn).length||mP(ce))&&(n.changes.push([ce,fe,rn]),n.triggerRenderFrame()),(Object.keys(Te).length||mP(ce))&&n.map.stop(!0),n.updatingCamera=!1;var fi=ce.cameraAnimation;fi&&(n.inertia.clear(),n.fireEvents({},{}),n.changes=[],fi(n.map))}),this.map=a,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new TF(a),this.bearingSnap=r.bearingSnap,this.rotateEnabled=r.rotateEnabled,this.pitchEnabled=r.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(r);var t=this.el;this.listeners=[],this.listeners=[[t,"touchstart",{passive:!1}],[t,"touchmove",{passive:!1}],[t,"touchend",void 0],[t,"touchcancel",void 0],[t,"mousedown",void 0],[t,"mousemove",void 0],[t,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[t,"mouseover",void 0],[t,"mouseout",void 0],[t,"dblclick",void 0],[t,"click",void 0],[t,"keydown",{capture:!1}],[t,"keyup",void 0],[t,"wheel",{passive:!1}],[t,"contextmenu",void 0],[window,"blur",void 0]];var o=Hy(this.listeners),u;try{for(o.s();!(u=o.n()).done;){var f=(0,gi.Z)(u.value,3),g=f[0],E=f[1],R=f[2];fv.addEventListener(g,E,g===window.document?this.handleWindowEvent:this.handleEvent,R)}}catch(B){o.e(B)}finally{o.f()}}return(0,Me.Z)(e,[{key:"destroy",value:function(){var r=Hy(this.listeners),n;try{for(r.s();!(n=r.n()).done;){var t=(0,gi.Z)(n.value,3),o=t[0],u=t[1],f=t[2];fv.removeEventListener(o,u,o===window.document?this.handleWindowEvent:this.handleEvent,f)}}catch(g){r.e(g)}finally{r.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var r=Hy(this.handlers),n;try{for(r.s();!(n=r.n()).done;){var t=n.value.handler;t.reset()}}catch(o){r.e(o)}finally{r.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var r=Hy(this.handlers),n;try{for(r.s();!(n=r.n()).done;){var t=n.value.handler;if(t.isActive())return!0}}catch(o){r.e(o)}finally{r.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return!!tE(this.eventsInProgress)||this.isZooming()}},{key:"mergeIHandlerResult",value:function(r,n,t,o,u){if(t){vP(r,t);var f={handlerName:o,originalEvent:t.originalEvent||u};t.zoomDelta!==void 0&&(n.zoom=f),t.panDelta!==void 0&&(n.drag=f),t.pitchDelta!==void 0&&(n.pitch=f),t.bearingDelta!==void 0&&(n.rotate=f)}}},{key:"triggerRenderFrame",value:function(){var r=this;this.frameId===void 0&&(this.frameId=this.map.requestRenderFrame(function(n){delete r.frameId,r.handleEvent(new bF("renderFrame",{timeStamp:n})),r.applyChanges()}))}},{key:"addDefaultHandlers",value:function(r){var n=this.map,t=n.getCanvasContainer();this.add("mapEvent",new LF(n,r));var o=n.boxZoom=new mF(n,r);this.add("boxZoom",o);var u=new az,f=new gF;n.doubleClickZoom=new YF(f,u),this.add("tapZoom",u),this.add("clickZoom",f);var g=new iz;this.add("tapDragZoom",g);var E=n.touchPitch=new cz;this.add("touchPitch",E);var R=new ZF(r),B=new VF(r);n.dragRotate=new KF(r,R,B),this.add("mouseRotate",R,["mousePitch"]),this.add("mousePitch",B,["mouseRotate"]);var Y=new zF(r),Q=new oz(r);n.dragPan=new qF(t,Y,Q),this.add("mousePan",Y),this.add("touchPan",Q,["touchZoom","touchRotate"]);var ce=new dz,fe=new yz;n.touchZoomRotate=new JF(t,fe,ce,g),this.add("touchRotate",ce,["touchPan","touchZoom"]),this.add("touchZoom",fe,["touchPan","touchRotate"]);var Te=n.scrollZoom=new XF(n,this);this.add("scrollZoom",Te,["mousePan"]);var Ve=n.keyboard=new IF;this.add("keyboard",Ve),this.add("blockableMapEvent",new dF(n));for(var st=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];st<at.length;st++){var Tt=at[st];r.interactive&&r[Tt]&&n[Tt].enable(r[Tt])}}},{key:"add",value:function(r,n,t){this.handlers.push({handlerName:r,handler:n,allowed:t}),this.handlersById[r]=n}},{key:"blockedByActive",value:function(r,n,t){for(var o in r)if(o!==t&&(!n||n.indexOf(o)<0))return!0;return!1}},{key:"getMapTouches",value:function(r){var n=[],t=Hy(r),o;try{for(t.s();!(o=t.n()).done;){var u=o.value,f=u.target;this.el.contains(f)&&n.push(u)}}catch(g){t.e(g)}finally{t.f()}return n}},{key:"applyChanges",value:function(){var r={},n={},t={},o=Hy(this.changes),u;try{for(o.s();!(u=o.n()).done;){var f=(0,gi.Z)(u.value,3),g=f[0],E=f[1],R=f[2];g.panDelta&&(r.panDelta=(r.panDelta||new Ul(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),vP(n,E),vP(t,R)}}catch(B){o.e(B)}finally{o.f()}this.updateMapTransform(r,n,t),this.changes=[]}},{key:"updateMapTransform",value:function(r,n,t){var o=this.map,u=o.transform;if(!mP(r))return this.fireEvents(n,t);var f=r.panDelta,g=r.zoomDelta,E=r.bearingDelta,R=r.pitchDelta,B=r.pinchAround,Y=r.around;B!==void 0&&(Y=B),o.stop(!0),Y=Y||o.transform.centerPoint;var Q=u.pointLocation(f?Y.sub(f):Y);E&&this.rotateEnabled&&(u.bearing+=E),R&&this.pitchEnabled&&(u.pitch+=R),g&&(u.zoom+=g),u.setLocationAtPoint(Q,Y),this.map.update(),r.noInertia||this.inertia.record(r),this.fireEvents(n,t)}},{key:"fireEvents",value:function(r,n){var t=this,o=tE(this.eventsInProgress),u=tE(r),f={};for(var g in r)if(r[g]){var E=r[g].originalEvent;this.eventsInProgress[g]||(f["".concat(g,"start")]=E),this.eventsInProgress[g]=r[g]}!o&&u&&this.fireEvent("movestart",u.originalEvent);for(var R in f)f[R]&&this.fireEvent(R,f[R]);r.rotate&&(this.bearingChanged=!0),u&&this.fireEvent("move",u.originalEvent);for(var B in r)if(r[B]){var Y=r[B].originalEvent;this.fireEvent(B,Y)}var Q={},ce;for(var fe in this.eventsInProgress)if(this.eventsInProgress[fe]){var Te=this.eventsInProgress[fe],Ve=Te.handlerName,st=Te.originalEvent;this.handlersById[Ve].isActive()||(delete this.eventsInProgress[fe],ce=n[Ve]||st,Q["".concat(fe,"end")]=ce)}for(var at in Q)Q[at]&&this.fireEvent(at,Q[at]);var Tt=tE(this.eventsInProgress);if((o||u)&&!Tt){this.updatingCamera=!0;var kt=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),Yt=function(Mr){return Mr!==0&&-t.bearingSnap<Mr&&Mr<t.bearingSnap};kt?(Yt(kt.bearing||this.map.getBearing())&&(kt.bearing=0),this.map.easeTo(kt,{originalEvent:ce})):(this.map.emit("moveend",new Uc("moveend",{originalEvent:ce})),Yt(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(r,n){this.map.emit(r,new Uc(r,n?{originalEvent:n}:{}))}}]),e}(),kL=bz,rE=null,dx=[],xz=30,gP=1e3/xz,e_=window.performance,t_={create:"create",load:"load",fullLoad:"fullLoad"},nE={mark:function(a){e_.mark(a)},frame:function(a){var r=a;if(rE!=null){var n=r-rE;dx.push(n)}rE=r},clearMetrics:function(){rE=null,dx=[],e_.clearMeasures("loadTime"),e_.clearMeasures("fullLoadTime");for(var a in t_)e_.clearMarks(t_[a])},getPerformanceMetrics:function(){var a=e_.measure("loadTime",t_.create,t_.load).duration,r=e_.measure("fullLoadTime",t_.create,t_.fullLoad).duration,n=dx.length,t=dx.reduce(function(g,E){return g+E},0)/n/1e3,o=1/t,u=dx.filter(function(g){return g>gP}).reduce(function(g,E){return g+(E-gP)/gP},0),f=u/(n+u)*100;return{loadTime:a,fullLoadTime:r,fps:o,percentDroppedFrames:f}}};function IL(e,a){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wz(e))||a&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,f;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return o=E.done,E},e:function(E){u=!0,f=E},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw f}}}}function wz(e,a){if(e){if(typeof e=="string")return LL(e,a);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LL(e,a)}}function LL(e,a){(a==null||a>e.length)&&(a=e.length);for(var r=0,n=new Array(a);r<a;r++)n[r]=e[r];return n}var Sz=function(){function e(){(0,Be.Z)(this,e),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,Me.Z)(e,[{key:"add",value:function(r){var n=++this.id,t=this.queue;return t.push({callback:r,id:n,cancelled:!1}),n}},{key:"remove",value:function(r){var n=this.currentlyRunning,t=n?this.queue.concat(n):this.queue,o=IL(t),u;try{for(o.s();!(u=o.n()).done;){var f=u.value;if(f.id===r){f.cancelled=!0;return}}}catch(g){o.e(g)}finally{o.f()}}},{key:"run",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=this.currentlyRunning=this.queue;this.queue=[];var t=IL(n),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;if(!u.cancelled&&(u.callback(r),this.cleared))break}}catch(f){t.e(f)}finally{t.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),RL=Sz;function Ez(e){var a=Cz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Cz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Az(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}Az(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var iE=-2,DL=22,Tz=Ga.merge,r_=0,aE=60,Mz={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:iE,maxZoom:DL,minPitch:r_,maxPitch:aE,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},Pz=function(e){(0,yt.Z)(r,e);var a=Ez(r);function r(n){var t;return(0,Be.Z)(this,r),t=a.call(this,Tz({},Mz,n)),(0,Pe.Z)((0,D.Z)(t),"renderTaskQueue",new RL),(0,Pe.Z)((0,D.Z)(t),"trackResize",!0),(0,Pe.Z)((0,D.Z)(t),"onWindowOnline",function(){t.update()}),(0,Pe.Z)((0,D.Z)(t),"onWindowResize",function(o){t.trackResize&&t.resize({originalEvent:o}).update()}),t.initContainer(),t.resize(),t.handlers=new kL((0,D.Z)(t),t.options),typeof window!="undefined"&&(window.addEventListener("online",t.onWindowOnline,!1),window.addEventListener("resize",t.onWindowResize,!1),window.addEventListener("orientationchange",t.onWindowResize,!1)),t}return(0,Me.Z)(r,[{key:"resize",value:function(t){var o=this.containerDimensions(),u=o[0],f=o[1];this.transform.resize(u,f);var g=!this.moving;return g&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),g&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(ef.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(Ul.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(fx.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if(t=t==null?iE:t,t>=iE&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(iE," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if(t=t==null?DL:t,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if(t=t==null?r_:t,t<r_)throw new Error("minPitch must be greater than or equal to ".concat(r_));if(t>=r_&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(r_," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if(t=t==null?aE:t,t>aE)throw new Error("maxPitch must be less than or equal to ".concat(aE));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=V3(function(o){nE.frame(o),t.frame=null,t.update(o)}))}},{key:"update",value:function(t){var o=this;this.frame||(this.frame=V3(function(u){nE.frame(u),o.frame=null,o.renderTaskQueue.run(t)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var t=this.container;t.classList.add("l7-map");var o=this.canvasContainer=wo("div","l7-canvas-container",t);this.options.interactive&&o.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,o=0;return this.container&&(t=this.container.clientWidth||400,o=this.container.clientHeight||300),[t,o]}},{key:"resizeCanvas",value:function(t,o){var u=Xs||1;this.canvas.width=u*t,this.canvas.height=u*o,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(o,"px")}}]),r}(mL),kz=Ga.throttle,Iz=function(){function e(a){var r=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"onHashChange",function(){var n=r.getCurrentHash();if(n.length>=3&&!n.some(function(o){return isNaN(+o)})){var t=r.map.dragRotate.isEnabled()&&r.map.touchZoomRotate.isEnabled()?+(n[3]||0):r.map.getBearing();return r.map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:t,pitch:+(n[4]||0)}),!0}return!1}),(0,Pe.Z)(this,"getCurrentHash",function(){var n=window.location.hash.replace("#","");if(r.hashName){var t;return n.split("&").map(function(o){return o.split("=")}).forEach(function(o){o[0]===r.hashName&&(t=o)}),(t&&t[1]||"").split("/")}return n.split("/")}),(0,Pe.Z)(this,"updateHashUnthrottled",function(){var n=r.getHashString();try{window.history.replaceState(window.history.state,"",n)}catch(t){}}),this.hashName=a&&encodeURIComponent(a),this.updateHash=kz(this.updateHashUnthrottled,30*1e3/100)}return(0,Me.Z)(e,[{key:"addTo",value:function(r){return this.map=r,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(r){var n=this.map.getCenter(),t=Math.round(this.map.getZoom()*100)/100,o=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,o),f=Math.round(n.lng*u)/u,g=Math.round(n.lat*u)/u,E=this.map.getBearing(),R=this.map.getPitch(),B="";if(r?B+="/".concat(f,"/").concat(g,"/").concat(t):B+="".concat(t,"/").concat(g,"/").concat(f),(E||R)&&(B+="/".concat(Math.round(E*10)/10)),R&&(B+="/".concat(Math.round(R))),this.hashName){var Y=this.hashName,Q=!1,ce=window.location.hash.slice(1).split("&").map(function(fe){var Te=fe.split("=")[0];return Te===Y?(Q=!0,"".concat(Te,"=").concat(B)):fe}).filter(function(fe){return fe});return Q||ce.push("".concat(Y,"=").concat(B)),"#".concat(ce.join("&"))}return"#".concat(B)}}]),e}(),Lz=Iz;function Rz(e){var a=Dz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Dz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Oz(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}Oz(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`),function(){if(typeof window.CustomEvent=="function")return!1;function e(a,r){r=r||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(a,r.bubbles,r.cancelable,r.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var oE=-2,OL=22,FL=Ga.merge,n_=0,sE=60,Fz={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:oE,maxZoom:OL,minPitch:n_,maxPitch:sE,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},zL=function(e){(0,yt.Z)(r,e);var a=Rz(r);function r(n){var t;(0,Be.Z)(this,r),t=a.call(this,FL({},Fz,n)),(0,Pe.Z)((0,D.Z)(t),"renderTaskQueue",new RL),(0,Pe.Z)((0,D.Z)(t),"trackResize",!0),(0,Pe.Z)((0,D.Z)(t),"onWindowOnline",function(){t.update()}),(0,Pe.Z)((0,D.Z)(t),"onWindowResize",function(u){t.trackResize&&t.resize({originalEvent:u}).update()}),t.initContainer(),t.resize(),t.handlers=new kL((0,D.Z)(t),t.options),typeof window!="undefined"&&(window.addEventListener("online",t.onWindowOnline,!1),window.addEventListener("resize",t.onWindowResize,!1),window.addEventListener("orientationchange",t.onWindowResize,!1));var o=typeof n.hash=="string"&&n.hash||void 0;return n.hash&&(t.hash=new Lz(o).addTo((0,D.Z)(t))),(!t.hash||!t.hash.onHashChange())&&(t.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),n.bounds&&(t.resize(),t.fitBounds(n.bounds,FL({},n.fitBoundsOptions,{duration:0})))),t}return(0,Me.Z)(r,[{key:"resize",value:function(t){var o=this.containerDimensions(),u=(0,gi.Z)(o,2),f=u[0],g=u[1];this.transform.resize(f,g);var E=!this.moving;return E&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",t)),this.emit("move",new window.CustomEvent("move",t))),this.emit("resize",new window.CustomEvent("resize",t)),E&&this.emit("moveend",new window.CustomEvent("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(ef.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(Ul.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(fx.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if(t=t==null?oE:t,t>=oE&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(oE," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if(t=t==null?OL:t,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if(t=t==null?n_:t,t<n_)throw new Error("minPitch must be greater than or equal to ".concat(n_));if(t>=n_&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(n_," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if(t=t==null?sE:t,t>sE)throw new Error("maxPitch must be less than or equal to ".concat(sE));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=V3(function(o){nE.frame(o),t.frame=null,t.update(o)}))}},{key:"update",value:function(t){var o=this;this.frame||(this.frame=V3(function(u){nE.frame(u),o.frame=null,o.renderTaskQueue.run(t)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var t=this.container;t.classList.add("l7-map");var o=this.canvasContainer=wo("div","l7-canvas-container",t);this.options.interactive&&o.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,o=0;return this.container&&(t=this.container.clientWidth,o=this.container.clientHeight,t=t===0?400:t,o=o===0?300:o),[t,o]}}]),r}(mL),zz=function(){function e(){(0,Be.Z)(this,e),(0,Pe.Z)(this,"xzReg",-Math.PI*.6),(0,Pe.Z)(this,"yReg",Math.PI*.2),(0,Pe.Z)(this,"earthCameraRadius",200),(0,Pe.Z)(this,"earthCameraZoom",1),(0,Pe.Z)(this,"cameraPosition",lg()),(0,Pe.Z)(this,"projectionMatrix",Kn()),(0,Pe.Z)(this,"modelMatrix",Kn()),(0,Pe.Z)(this,"viewMatrix",Kn()),(0,Pe.Z)(this,"viewProjectionMatrix",Kn()),(0,Pe.Z)(this,"ViewProjectionMatrixUncentered",Kn()),(0,Pe.Z)(this,"viewUncenteredMatrix",Kn())}return(0,Me.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.viewportHeight,t=n===void 0?1:n,o=r.viewportWidth,u=o===void 0?1:o,f=u/t,g=.1,E=1e4,R=20;ne(this.projectionMatrix,R,f,g,E);var B=this.earthCameraRadius*Math.cos(this.xzReg),Y=this.earthCameraRadius*Math.sin(this.xzReg),Q=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=Fu(B,Q,Y),Ig(this.cameraPosition,this.cameraPosition),vb(this.cameraPosition,this.cameraPosition,Fu(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),mb(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var ce=lg();yy(ce,this.cameraPosition,Fu(0,1,0));var fe=Fu(0,1,0);yy(fe,ce,this.cameraPosition);var Te=Fu(0,0,0);gt(this.viewMatrix,this.cameraPosition,Te,fe),this.viewUncenteredMatrix=la(this.viewMatrix),Wo(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Wo(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(r){this.xzReg+=r*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(r){this.yReg+=r*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(r){this.earthCameraZoom+=r,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),Bz=["id","style","rotation"],BL,NL;function Nz(e){var a=Zz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Zz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZL={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Uz=12,jz=(BL=(0,Ii.b2)(),BL(NL=function(e){(0,yt.Z)(r,e);var a=Nz(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip.GLOBEL),(0,Pe.Z)((0,D.Z)(n),"dragging",!1),(0,Pe.Z)((0,D.Z)(n),"handleCameraChanged",function(f){n.emit("mapchange");var g=2e3;n.handleCameraChanging=!0,n.handleCameraTimer&&clearTimeout(n.handleCameraTimer),n.handleCameraTimer=setTimeout(function(){n.handleCameraChanging=!1},g);var E=.02;f.type&&f.originalEvent&&(f.originalEvent.type==="wheel"&&n.viewport.scaleZoom(.01*Math.sign(f.originalEvent.wheelDelta)*-1),Math.abs(f.originalEvent.movementX)>Math.abs(f.originalEvent.movementY)?f.originalEvent.movementX>0?n.viewport.rotateY(E):f.originalEvent.movementX<0&&n.viewport.rotateY(-E):f.originalEvent.movementY>0?n.viewport.rotateX(E):f.originalEvent.movementY<0&&n.viewport.rotateX(-E));var R=n.config.offsetCoordinate,B=R===void 0?!0:R;n.viewport.syncWithMapCamera({viewportHeight:n.map.transform.height,viewportWidth:n.map.transform.width}),n.viewport.getZoom()>Uz&&B?n.coordinateSystemService.setCoordinateSystem(gd.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(gd.LNGLAT),n.cameraChangedCallback(n.viewport)}),n}return(0,Me.Z)(r,[{key:"lngLatToMercator",value:function(t,o){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(t,o,u,f,g){throw new Error("Method not implemented.")}},{key:"on",value:function(t,o){Mg.indexOf(t)!==-1?this.eventEmitter.on(t,o):this.map.on(ZL[t]||t,o)}},{key:"off",value:function(t,o){this.map.off(ZL[t]||t,o),this.eventEmitter.off(t,o)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q;return x().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:u=this.config,f=u.id,g=f===void 0?"map":f,E=u.style,R=E===void 0?"light":E,B=u.rotation,Y=B===void 0?0:B,Q=(0,Uh.Z)(u,Bz),this.viewport=new zz,this.$mapContainer=this.creatMapContainer(g),this.map=new Pz((0,Ee.Z)({container:this.$mapContainer,style:this.getMapStyleValue(R),bearing:Y},Q)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).emit.apply(o,[t].concat(f))}},{key:"once",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).once.apply(o,[t].concat(f))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var o=t||{},u=o.force,f=u===void 0?!1:u,g=o.reg,E=g===void 0?.01:g;this.handleCameraChanging&&!f||this.viewport&&(this.viewport.rotateY(E),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),r}(jy))||NL);function Vz(e){var a=Gz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Gz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hz=function(e){(0,yt.Z)(r,e);var a=Vz(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return jz}}]),r}(l0),$z=["id","style","rotation","mapInstance","version","mapSize","interactive"],Wz=["id","style","rotation","mapInstance","canvas","hasBaseMap"],UL,jL;function Xz(e){var a=Yz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Yz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qz=12,Kz=(UL=(0,Ii.b2)(),UL(jL=function(e){(0,yt.Z)(r,e);var a=Xz(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip.DEFUALT),(0,Pe.Z)((0,D.Z)(n),"handleMiniCameraChanged",function(f,g,E,R,B){var Y=n.config.offsetCoordinate,Q=Y===void 0?!0:Y;n.viewport.syncWithMapCamera({bearing:R,center:[f,g],viewportHeight:n.map.transform.height,pitch:B,viewportWidth:n.map.transform.width,zoom:E,cameraHeight:0}),n.viewport.getZoom()>qz&&Q?n.coordinateSystemService.setCoordinateSystem(gd.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(gd.LNGLAT),n.cameraChangedCallback(n.viewport)}),n}return(0,Me.Z)(r,[{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),f=u.x,g=u.y;return[f-o.x,g-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=Vy.fromLngLat(t,o),f=u.x,g=f===void 0?0:f,E=u.y,R=E===void 0?0:E,B=u.z,Y=B===void 0?0:B;return{x:g,y:R,z:Y}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},E=Vy.fromLngLat(t,o),R=E.meterInMercatorCoordinateUnits(),B=Kn();return Bo(B,B,Fu(E.x-g.x,E.y-g.y,E.z||0-g.z)),Xo(B,B,Fu(R*f[0],-R*f[1],R*f[2])),Wi(B,B,u[0]),hs(B,B,u[1]),Ba(B,B,u[2]),B}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt;return x().wrap(function(cr){for(;;)switch(cr.prev=cr.next){case 0:f=this.config,g=f.id,E=g===void 0?"map":g,R=f.style,B=R===void 0?"light":R,Y=f.rotation,Q=Y===void 0?0:Y,ce=f.mapInstance,fe=f.version,Te=fe===void 0?"DEFAULTMAP":fe,Ve=f.mapSize,st=Ve===void 0?1e4:Ve,at=f.interactive,Tt=at===void 0?!0:at,kt=(0,Uh.Z)(f,$z),this.viewport=new Uy,this.version=Te,this.simpleMapCoord.setSize(st),Te===ip.SIMPLE&&kt.center&&(kt.center=this.simpleMapCoord.unproject(kt.center)),ce?(this.map=ce,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(E),this.map=new zL((0,Ee.Z)({container:this.$mapContainer,style:this.getMapStyleValue(B),bearing:Q},kt))),this.map.on("load",function(){u.handleCameraChanged()}),Tt&&this.map.on("move",this.handleCameraChanged),setTimeout(function(){u.handleCameraChanged()},100),this.handleCameraChanged();case 10:case"end":return cr.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initMiniMap",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt;return x().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:f=this.config,g=f.id,E=g===void 0?"map":g,R=f.style,B=R===void 0?"light":R,Y=f.rotation,Q=Y===void 0?0:Y,ce=f.mapInstance,fe=f.canvas,Te=fe===void 0?null:fe,Ve=f.hasBaseMap,st=Ve===void 0?!1:Ve,at=(0,Uh.Z)(f,Wz),this.viewport=new Uy,this.$mapContainer=Te,this.map=new zL((0,Ee.Z)({container:this.$mapContainer,style:this.getMapStyleValue(B),bearing:Q,canvas:Te},at)),st?(Tt=this.map.getCenter(),this.handleMiniCameraChanged(Tt.lng,Tt.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),window.document.addEventListener("mapCameaParams",function(cr){var Mr=cr.e,Dr=Mr.longitude,sn=Mr.latitude,rn=Mr.scale,Jn=Mr.bearing,fi=Mr.pitch;u.handleMiniCameraChanged(Dr,sn,rn-1.25,Jn,fi)})):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return Yt.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}}]),r}(jy))||jL);function Jz(e){var a=Qz();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function Qz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e9=function(e){(0,yt.Z)(r,e);var a=Jz(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return Kz}}]),r}(l0),t9=G(6158),vx=G.n(t9),VL=function(){function e(){(0,Be.Z)(this,e)}return(0,Me.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,f=r.viewportHeight,g=r.viewportWidth;this.viewport=new eP({width:g,height:f,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),r9=["id","attributionControl","style","token","rotation","mapInstance"],GL,HL;function n9(e){var a=i9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function i9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function a9(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}a9(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=vx();var o9=0,$L="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",s9=(GL=(0,Ii.b2)(),GL(HL=function(e){(0,yt.Z)(r,e);var a=n9(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip.MAPBOX),n}return(0,Me.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),f=u.x,g=u.y;return[f-o.x,g-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),f=u.x,g=f===void 0?0:f,E=u.y,R=E===void 0?0:E,B=u.z,Y=B===void 0?0:B;return{x:g,y:R,z:Y}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},E=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),R=E.meterInMercatorCoordinateUnits(),B=Kn();return Bo(B,B,Fu(E.x-g.x,E.y-g.y,E.z||0-g.z)),Xo(B,B,Fu(R*f[0],-R*f[1],R*f[2])),Wi(B,B,u[0]),hs(B,B,u[1]),Ba(B,B,u[2]),B}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at;return x().wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:f=this.config,g=f.id,E=g===void 0?"map":g,R=f.attributionControl,B=R===void 0?!1:R,Y=f.style,Q=Y===void 0?"light":Y,ce=f.token,fe=ce===void 0?$L:ce,Te=f.rotation,Ve=Te===void 0?0:Te,st=f.mapInstance,at=(0,Uh.Z)(f,r9),this.viewport=new VL,!st&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),fe===$L&&Q!=="blank"&&!window.mapboxgl.accessToken&&!st&&console.warn(this.configService.getSceneWarninfo("MapToken")),!st&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=fe),st?(this.map=st,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(E),this.map=new window.mapboxgl.Map((0,Ee.Z)({container:this.$mapContainer,style:this.getMapStyleValue(Q),attributionControl:B,bearing:Ve},at))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return kt.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).emit.apply(o,[t].concat(f))}},{key:"once",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).once.apply(o,[t].concat(f))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(vx()).LngLat(t[0],t[1]),f=new(vx()).LngLat(o[0],o[1]),g=u.distanceTo(f),E=vx().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),R=vx().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),B=E.x,Y=E.y,Q=R.x,ce=R.y,fe=Math.sqrt(Math.pow(B-Q,2)+Math.pow(Y-ce,2))*4194304*2;return fe/g}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+o9++,o.appendChild(u),u}}]),r}(jy))||HL);function u9(e){var a=l9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function l9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function c9(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}c9(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var h9=function(e){(0,yt.Z)(r,e);var a=u9(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return s9}}]),r}(l0),f9=G(24613),mx=G.n(f9),p9=["id","attributionControl","style","rotation","mapInstance"],WL,XL;function d9(e){var a=v9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function v9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m9(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}m9(`.maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-webkit-full-screen{height:100%;width:100%}.maplibregl-map:-moz-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;-webkit-box-sizing:content-box;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;-webkit-box-sizing:border-box;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:-webkit-box;display:-ms-flexbox;display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.maplibregl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.maplibregl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35);-webkit-box-sizing:border-box;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:rgba(0,0,0,.4);color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:1.4em;inset:0;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;-webkit-transition:opacity 1s ease 1s;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;-webkit-transition:opacity .05s;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}`),window.maplibregl=mx();var g9=0,y9=(WL=(0,Ii.b2)(),WL(XL=function(e){(0,yt.Z)(r,e);var a=d9(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"version",ip.MAPBOX),n}return(0,Me.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),f=u.x,g=u.y;return[f-o.x,g-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.maplibregl.MercatorCoordinate.fromLngLat(t,o),f=u.x,g=f===void 0?0:f,E=u.y,R=E===void 0?0:E,B=u.z,Y=B===void 0?0:B;return{x:g,y:R,z:Y}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},E=window.maplibregl.MercatorCoordinate.fromLngLat(t,o),R=E.meterInMercatorCoordinateUnits(),B=Kn();return Bo(B,B,Fu(E.x-g.x,E.y-g.y,E.z||0-g.z)),Xo(B,B,Fu(R*f[0],-R*f[1],R*f[2])),Wi(B,B,u[0]),hs(B,B,u[1]),Ba(B,B,u[2]),B}},{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u=this,f,g,E,R,B,Y,Q,ce,fe,Te,Ve;return x().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:f=this.config,g=f.id,E=g===void 0?"map":g,R=f.attributionControl,B=R===void 0?!1:R,Y=f.style,Q=Y===void 0?"light":Y,ce=f.rotation,fe=ce===void 0?0:ce,Te=f.mapInstance,Ve=(0,Uh.Z)(f,p9),this.viewport=new VL,!Te&&!window.maplibregl&&console.error(this.configService.getSceneWarninfo("SDK")),Te?(this.map=Te,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(E),this.map=new window.maplibregl.Map((0,Ee.Z)({container:this.$mapContainer,style:this.getMapStyleValue(Q),attributionControl:B,bearing:fe},Ve))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 7:case"end":return at.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).emit.apply(o,[t].concat(f))}},{key:"once",value:function(t){for(var o,u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];(o=this.eventEmitter).once.apply(o,[t].concat(f))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(mx()).LngLat(t[0],t[1]),f=new(mx()).LngLat(o[0],o[1]),g=u.distanceTo(f),E=mx().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),R=mx().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),B=E.x,Y=E.y,Q=R.x,ce=R.y,fe=Math.sqrt(Math.pow(B-Q,2)+Math.pow(Y-ce,2))*4194304*2;return fe/g}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+g9++,o.appendChild(u),u}}]),r}(jy))||XL);function _9(e){var a=b9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function b9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x9=function(e){(0,yt.Z)(r,e);var a=_9(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return y9}}]),r}(l0);if(!window)throw Error("TMap JSAPI can only be used in Browser.");var gg=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(gg||{}),v0={key:"",version:"1.exp",libraries:[]},m0={TMap:gg.notload},yP=[],YL=function(a){if(typeof a=="function"){if(m0.TMap===gg.loaded){a(window.AMap);return}yP.push(a)}},w9=function(a){return new Promise(function(r,n){if(m0.TMap===gg.failed)n("");else if(m0.TMap===gg.notload){var t=a.key,o=a.version,u=a.libraries;if(!t){n("\u8BF7\u586B\u5199key");return}v0.key=t,v0.version=o||v0.version,v0.libraries=u||v0.libraries,m0.TMap=gg.loading,window._onTMapAPILoaded=function(E){if(delete window._onTMapAPILoaded,E)m0.TMap=gg.failed,n(E);else for(m0.TMap=gg.loaded;yP.length;)yP.splice(0,1)[0](window.TMap)};var f=document.createElement("script");f.type="text/javascript",f.async=!1,f.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+v0.version+"&key="+t+"&plugin="+v0.libraries.join(","),f.onerror=function(E){m0.TMap=gg.failed,n(E)};var g=document.body||document.head;g.appendChild(f),YL(r)}else if(m0.TMap===gg.loaded){if(a.key&&a.key!==v0.key){n("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");return}if(a.version&&a.version!==v0.version){n("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");return}YL(r)}})},S9=function(){delete window.TMap,m0={TMap:gg.notload}},E9={load:w9,reset:S9},C9=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];function A9(e){var a=T9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function T9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function M9(e,a){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(a||(a=document),!!a)){var t=a.head||a.getElementsByTagName("head")[0];if(!t){t=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):a.documentElement.appendChild(t)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),t.appendChild(u),u}}M9(`.tmap-contianer--hide-logo  img[src*='mapapi.qq.com/web/jsapi/logo/logo_def.png'] {
  display: none;
}
`);var P9="OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77",k9="1.exp",uE={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"},I9=function(e){(0,yt.Z)(r,e);var a=A9(r);function r(){var n;(0,Be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,Pe.Z)((0,D.Z)(n),"viewport",null),(0,Pe.Z)((0,D.Z)(n),"handleCameraChanged",function(){n.emit("mapchange");var f=n.map,g=f.getCenter(),E=g.lng,R=g.lat,B={center:[E,R],viewportHeight:f.getContainer().clientHeight,viewportWidth:f.getContainer().clientWidth,bearing:f.getHeading(),pitch:f.getPitch(),zoom:f.getZoom()-1};n.viewport.syncWithMapCamera(B),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)}),n}return(0,Me.Z)(r,[{key:"init",value:function(){var n=(0,mr.Z)(x().mark(function o(){var u,f,g,E,R,B,Y,Q,ce,fe,Te,Ve,st,at,Tt,kt,Yt,cr,Mr,Dr,sn,rn,Jn,fi,Hi,Ds;return x().wrap(function($s){for(;;)switch($s.prev=$s.next){case 0:if(this.viewport=new Uy,u=this.config,f=u.id,g=u.mapInstance,E=u.center,R=E===void 0?[121.30654632240122,31.25744185633306]:E,B=u.token,Y=B===void 0?P9:B,Q=u.version,ce=Q===void 0?k9:Q,fe=u.libraries,Te=fe===void 0?[]:fe,Ve=u.minZoom,st=Ve===void 0?3:Ve,at=u.maxZoom,Tt=at===void 0?18:at,kt=u.rotation,Yt=kt===void 0?0:kt,cr=u.pitch,Mr=cr===void 0?0:cr,Dr=u.mapSize,sn=Dr===void 0?1e4:Dr,rn=u.logoVisible,Jn=rn===void 0?!0:rn,fi=(0,Uh.Z)(u,C9),window.TMap||g){$s.next=5;break}return $s.next=5,E9.load({key:Y,version:ce,libraries:Te});case 5:if(!g){$s.next=11;break}this.map=g,this.$mapContainer=this.map.getContainer(),Jn===!1&&this.hideLogo(),$s.next=18;break;case 11:if(f){$s.next=13;break}throw Error("No container id specified");case 13:Hi=Hc(f),Ds=new TMap.Map(Hi,(0,Ee.Z)({maxZoom:Tt,minZoom:st,rotation:Yt,pitch:Mr,showControl:!1,center:new TMap.LatLng(R[1],R[0])},fi)),this.map=Ds,this.$mapContainer=Ds.getContainer(),Jn===!1&&this.hideLogo();case 18:this.map.canvasContainer.style.position="absolute",this.simpleMapCoord.setSize(sn),this.map.on("drag",this.handleCameraChanged),this.map.on("pan",this.handleCameraChanged),this.map.on("rotate",this.handleCameraChanged),this.map.on("pitch",this.handleCameraChanged),this.map.on("zoom",this.handleCameraChanged),this.handleCameraChanged();case 26:case"end":return $s.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){this.map.destroy()}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();this.markerContainer=wo("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,o){var u=this;Mg.indexOf(t)!==-1?this.eventEmitter.on(t,o):Array.isArray(uE[t])?uE[t].forEach(function(f){u.map.on(f||t,o)}):this.map.on(uE[t]||t,o)}},{key:"off",value:function(t,o){this.map.off(uE[t]||t,o),this.eventEmitter.off(t,o)}},{key:"once",value:function(){throw new Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"tmap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter(),o=t.lng,u=t.lat;return{lng:o,lat:u}}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().getNorthEast(),o=this.map.getBounds().getSouthWest();return[[o.lng,o.lat],[t.lng,t.lat]]}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByTagName("canvas")[0]}},{key:"getMapStyleConfig",value:function(){throw new Error("Method not implemented.")}},{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setMapStyle",value:function(t){this.map.setMapStyleId(t)}},{key:"setRotation",value:function(t){this.map.setRotation(t)}},{key:"zoomIn",value:function(){this.map.setZoom(this.getZoom()+1)}},{key:"zoomOut",value:function(){this.map.setZoom(this.getZoom()-1)}},{key:"panTo",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1];this.map.panTo(new TMap.LatLng(f,u))}},{key:"panBy",value:function(t,o){this.map.panBy([t,o])}},{key:"fitBounds",value:function(t,o){var u=(0,gi.Z)(t,2),f=u[0],g=u[1],E=new TMap.LatLng(f[1],f[0]),R=new TMap.LatLng(g[1],g[0]),B=new TMap.LatLngBounds(E,R);this.map.fitBounds(B,o)}},{key:"setZoomAndCenter",value:function(t,o){var u=(0,gi.Z)(o,2),f=u[0],g=u[1];this.map.setCenter(new TMap.LatLng(g,f)),this.map.setZoom(t)}},{key:"setCenter",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1];this.map.setCenter(new TMap.LatLng(f,u))}},{key:"setPitch",value:function(t){this.map.setPitch(t)}},{key:"setZoom",value:function(t){this.map.setZoom(t)}},{key:"setMapStatus",value:function(t){var o=this;Object.keys(t).map(function(u){switch(u){case"doubleClickZoom":o.map.setDoubleClickZoom(!!t.doubleClickZoom);break;case"dragEnable":o.map.setDraggable(!!t.doubleClickZoom);break;case"rotateEnable":o.map.setRotatable(!!t.rotateEnable);break;case"zoomEnable":o.map.setDoubleClickZoom(!!t.zoomEnable),o.map.setScrollable(!!t.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported");default:}})}},{key:"meterToCoord",value:function(t,o){var u=(0,gi.Z)(t,2),f=u[0],g=u[1],E=(0,gi.Z)(o,2),R=E[0],B=E[1],Y=TMap.geometry.computeDistance([new TMap.LatLng(g,f),new TMap.LatLng(B,R)]),Q=this.lngLatToCoord([f,g]),ce=(0,gi.Z)(Q,2),fe=ce[0],Te=ce[1],Ve=this.lngLatToCoord([R,B]),st=(0,gi.Z)(Ve,2),at=st[0],Tt=st[1],kt=Math.sqrt(Math.pow(fe-at,2)+Math.pow(Te-Tt,2));return kt/Y}},{key:"pixelToLngLat",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.map.getCenter(),E=g.lng,R=g.lat,B=this.lngLatToPixel([E,R]),Y=B.x,Q=B.y,ce=this.lngLatToContainer([E,R]),fe=ce.x,Te=ce.y,Ve=this.map.unprojectFromContainer(new TMap.Point(fe+(u-Y),Te+(f-Q))),st=Ve.lng,at=Ve.lat;return this.containerToLngLat([st,at])}},{key:"lngLatToPixel",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.map.projectToWorldPlane(new TMap.LatLng(f,u)),E=g.x,R=g.y;return{x:E,y:R}}},{key:"containerToLngLat",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.map.unprojectFromContainer(new TMap.Point(u,f)),E=g.lng,R=g.lat;return{lng:E,lat:R}}},{key:"lngLatToContainer",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.map.projectToContainer(new TMap.LatLng(f,u)),E=g.x,R=g.y;return{x:E,y:R}}},{key:"lngLatToCoord",value:function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1],g=this.lngLatToPixel([u,f]),E=g.x,R=g.y;return[E,-R]}},{key:"lngLatToCoords",value:function(t){var o=this;return t.map(function(u){return Array.isArray(u[0])?o.lngLatToCoords(u):o.lngLatToCoord(u)})}},{key:"lngLatToMercator",value:function(t,o){var u=Vy.fromLngLat(t,o),f=u.x,g=f===void 0?0:f,E=u.y,R=E===void 0?0:E,B=u.z,Y=B===void 0?0:B;return{x:g,y:R,z:Y}}},{key:"getModelMatrix",value:function(t,o,u){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],g=this.viewport.projectFlat(t),E=Kn();return Bo(E,E,Fu(g[0],g[1],o)),Xo(E,E,Fu(f[0],f[1],f[2])),Wi(E,E,u[0]),hs(E,E,u[1]),Ba(E,E,u[2]),E}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(t){var o=this.getMapCanvasContainer(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"rotateY",value:function(){throw new Error("Method not implemented.")}},{key:"hideLogo",value:function(){var t=this.map.getContainer();t&&pl(t,"tmap-contianer--hide-logo")}}]),r}(jy);function L9(e){var a=R9();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function R9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D9=function(e){(0,yt.Z)(r,e);var a=L9(r);function r(){return(0,Be.Z)(this,r),a.apply(this,arguments)}return(0,Me.Z)(r,[{key:"getServiceConstructor",value:function(){return I9}}]),r}(l0),O9=G(81550),F9=G.n(O9),z9=function(){function e(a,r){(0,Be.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,f=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:g||0},f&&(this.attribute.size=f)}return(0,Me.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),g0,gx,G0,Jm,yx,H0,_x,lE,Hg,$y,pv,$g,Wg,cE,B9=(g0={},(0,Pe.Z)(g0,Ke.POINTS,"points"),(0,Pe.Z)(g0,Ke.LINES,"lines"),(0,Pe.Z)(g0,Ke.LINE_LOOP,"line loop"),(0,Pe.Z)(g0,Ke.LINE_STRIP,"line strip"),(0,Pe.Z)(g0,Ke.TRIANGLES,"triangles"),(0,Pe.Z)(g0,Ke.TRIANGLE_FAN,"triangle fan"),(0,Pe.Z)(g0,Ke.TRIANGLE_STRIP,"triangle strip"),g0),qL=(gx={},(0,Pe.Z)(gx,Ke.STATIC_DRAW,"static"),(0,Pe.Z)(gx,Ke.DYNAMIC_DRAW,"dynamic"),(0,Pe.Z)(gx,Ke.STREAM_DRAW,"stream"),gx),_P=(G0={},(0,Pe.Z)(G0,Ke.BYTE,"int8"),(0,Pe.Z)(G0,Ke.INT,"int32"),(0,Pe.Z)(G0,Ke.UNSIGNED_BYTE,"uint8"),(0,Pe.Z)(G0,Ke.UNSIGNED_SHORT,"uint16"),(0,Pe.Z)(G0,Ke.UNSIGNED_INT,"uint32"),(0,Pe.Z)(G0,Ke.FLOAT,"float"),G0),N9=(Jm={},(0,Pe.Z)(Jm,Ke.ALPHA,"alpha"),(0,Pe.Z)(Jm,Ke.LUMINANCE,"luminance"),(0,Pe.Z)(Jm,Ke.LUMINANCE_ALPHA,"luminance alpha"),(0,Pe.Z)(Jm,Ke.RGB,"rgb"),(0,Pe.Z)(Jm,Ke.RGBA,"rgba"),(0,Pe.Z)(Jm,Ke.RGBA4,"rgba4"),(0,Pe.Z)(Jm,Ke.RGB5_A1,"rgb5 a1"),(0,Pe.Z)(Jm,Ke.RGB565,"rgb565"),(0,Pe.Z)(Jm,Ke.DEPTH_COMPONENT,"depth"),(0,Pe.Z)(Jm,Ke.DEPTH_STENCIL,"depth stencil"),Jm),Z9=(yx={},(0,Pe.Z)(yx,Ke.DONT_CARE,"dont care"),(0,Pe.Z)(yx,Ke.NICEST,"nice"),(0,Pe.Z)(yx,Ke.FASTEST,"fast"),yx),KL=(H0={},(0,Pe.Z)(H0,Ke.NEAREST,"nearest"),(0,Pe.Z)(H0,Ke.LINEAR,"linear"),(0,Pe.Z)(H0,Ke.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,Pe.Z)(H0,Ke.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,Pe.Z)(H0,Ke.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,Pe.Z)(H0,Ke.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),H0),JL=(_x={},(0,Pe.Z)(_x,Ke.REPEAT,"repeat"),(0,Pe.Z)(_x,Ke.CLAMP_TO_EDGE,"clamp"),(0,Pe.Z)(_x,Ke.MIRRORED_REPEAT,"mirror"),_x),U9=(lE={},(0,Pe.Z)(lE,Ke.NONE,"none"),(0,Pe.Z)(lE,Ke.BROWSER_DEFAULT_WEBGL,"browser"),lE),j9=(Hg={},(0,Pe.Z)(Hg,Ke.NEVER,"never"),(0,Pe.Z)(Hg,Ke.ALWAYS,"always"),(0,Pe.Z)(Hg,Ke.LESS,"less"),(0,Pe.Z)(Hg,Ke.LEQUAL,"lequal"),(0,Pe.Z)(Hg,Ke.GREATER,"greater"),(0,Pe.Z)(Hg,Ke.GEQUAL,"gequal"),(0,Pe.Z)(Hg,Ke.EQUAL,"equal"),(0,Pe.Z)(Hg,Ke.NOTEQUAL,"notequal"),Hg),QL=($y={},(0,Pe.Z)($y,Ke.FUNC_ADD,"add"),(0,Pe.Z)($y,Ke.MIN_EXT,"min"),(0,Pe.Z)($y,Ke.MAX_EXT,"max"),(0,Pe.Z)($y,Ke.FUNC_SUBTRACT,"subtract"),(0,Pe.Z)($y,Ke.FUNC_REVERSE_SUBTRACT,"reverse subtract"),$y),hE=(pv={},(0,Pe.Z)(pv,Ke.ZERO,"zero"),(0,Pe.Z)(pv,Ke.ONE,"one"),(0,Pe.Z)(pv,Ke.SRC_COLOR,"src color"),(0,Pe.Z)(pv,Ke.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,Pe.Z)(pv,Ke.SRC_ALPHA,"src alpha"),(0,Pe.Z)(pv,Ke.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,Pe.Z)(pv,Ke.DST_COLOR,"dst color"),(0,Pe.Z)(pv,Ke.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,Pe.Z)(pv,Ke.DST_ALPHA,"dst alpha"),(0,Pe.Z)(pv,Ke.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,Pe.Z)(pv,Ke.CONSTANT_COLOR,"constant color"),(0,Pe.Z)(pv,Ke.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,Pe.Z)(pv,Ke.CONSTANT_ALPHA,"constant alpha"),(0,Pe.Z)(pv,Ke.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,Pe.Z)(pv,Ke.SRC_ALPHA_SATURATE,"src alpha saturate"),pv),V9=($g={},(0,Pe.Z)($g,Ke.NEVER,"never"),(0,Pe.Z)($g,Ke.ALWAYS,"always"),(0,Pe.Z)($g,Ke.LESS,"less"),(0,Pe.Z)($g,Ke.LEQUAL,"lequal"),(0,Pe.Z)($g,Ke.GREATER,"greater"),(0,Pe.Z)($g,Ke.GEQUAL,"gequal"),(0,Pe.Z)($g,Ke.EQUAL,"equal"),(0,Pe.Z)($g,Ke.NOTEQUAL,"notequal"),$g),i_=(Wg={},(0,Pe.Z)(Wg,Ke.ZERO,"zero"),(0,Pe.Z)(Wg,Ke.KEEP,"keep"),(0,Pe.Z)(Wg,Ke.REPLACE,"replace"),(0,Pe.Z)(Wg,Ke.INVERT,"invert"),(0,Pe.Z)(Wg,Ke.INCR,"increment"),(0,Pe.Z)(Wg,Ke.DECR,"decrement"),(0,Pe.Z)(Wg,Ke.INCR_WRAP,"increment wrap"),(0,Pe.Z)(Wg,Ke.DECR_WRAP,"decrement wrap"),Wg),G9=(cE={},(0,Pe.Z)(cE,Ke.FRONT,"front"),(0,Pe.Z)(cE,Ke.BACK,"back"),cE),H9=function(){function e(a,r){(0,Be.Z)(this,e),(0,Pe.Z)(this,"isDestroyed",!1);var n=r.data,t=r.usage,o=r.type;this.buffer=a.buffer({data:n,usage:qL[t||Ke.STATIC_DRAW],type:_P[o||Ke.UNSIGNED_BYTE]})}return(0,Me.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),$9=function(){function e(a,r){(0,Be.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=a.elements({data:n,usage:qL[t||Ke.STATIC_DRAW],type:_P[o||Ke.UNSIGNED_BYTE],count:u})}return(0,Me.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),W9=function(){function e(a,r){(0,Be.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,f={width:n,height:t};Array.isArray(u)&&(f.colors=u.map(function(g){return g.get()})),o&&typeof o!="boolean"&&(f.color=o.get()),this.framebuffer=a.framebuffer(f)}return(0,Me.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),X9=Ga.isPlainObject,Y9=Ga.isTypedArray,q9=function(){function e(a,r){(0,Be.Z)(this,e),(0,Pe.Z)(this,"destroyed",!1),(0,Pe.Z)(this,"uniforms",{}),this.reGl=a;var n=r.vs,t=r.fs,o=r.attributes,u=r.uniforms,f=r.primitive,g=r.count,E=r.elements,R=r.depth,B=r.cull,Y=r.instances,Q={};this.options=r,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Te){Q[Te]=a.prop(Te)}));var ce={};Object.keys(o).forEach(function(Te){ce[Te]=o[Te].get()});var fe={attributes:ce,frag:t,uniforms:Q,vert:n,colorMask:a.prop("colorMask"),lineWidth:1,blend:{enable:a.prop("blend.enable"),func:a.prop("blend.func"),equation:a.prop("blend.equation"),color:a.prop("blend.color")},stencil:{enable:a.prop("stencil.enable"),mask:a.prop("stencil.mask"),func:a.prop("stencil.func"),opFront:a.prop("stencil.opFront"),opBack:a.prop("stencil.opBack")},primitive:B9[f===void 0?Ke.TRIANGLES:f]};Y&&(fe.instances=Y),g?fe.count=g:E&&(fe.elements=E.get()),this.initDepthDrawParams({depth:R},fe),this.initCullDrawParams({cull:B},fe),this.drawCommand=a(fe),this.drawParams=fe}return(0,Me.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};Object.keys(r).forEach(function(o){t[o]=r[o].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(t){n[t]=r[t].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,Ee.Z)((0,Ee.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,Ee.Z)((0,Ee.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var f=(0,Go.Z)(t[u]);f==="boolean"||f==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),o.stencil=this.getStencilDrawParams(r),o.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:j9[t.func||Ke.LESS],range:t.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,t=n||{},o=t.enable,u=t.func,f=t.equation,g=t.color,E=g===void 0?[0,0,0,0]:g;return{enable:!!o,func:{srcRGB:hE[u&&u.srcRGB||Ke.SRC_ALPHA],srcAlpha:hE[u&&u.srcAlpha||Ke.SRC_ALPHA],dstRGB:hE[u&&u.dstRGB||Ke.ONE_MINUS_SRC_ALPHA],dstAlpha:hE[u&&u.dstAlpha||Ke.ONE_MINUS_SRC_ALPHA]},equation:{rgb:QL[f&&f.rgb||Ke.FUNC_ADD],alpha:QL[f&&f.alpha||Ke.FUNC_ADD]},color:E}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,t=n||{},o=t.enable,u=t.mask,f=u===void 0?-1:u,g=t.func,E=g===void 0?{cmp:Ke.ALWAYS,ref:0,mask:-1}:g,R=t.opFront,B=R===void 0?{fail:Ke.KEEP,zfail:Ke.KEEP,zpass:Ke.KEEP}:R,Y=t.opBack,Q=Y===void 0?{fail:Ke.KEEP,zfail:Ke.KEEP,zpass:Ke.KEEP}:Y;return{enable:!!o,mask:f,func:(0,Ee.Z)((0,Ee.Z)({},E),{},{cmp:V9[E.cmp]}),opFront:{fail:i_[B.fail],zfail:i_[B.zfail],zpass:i_[B.zpass]},opBack:{fail:i_[Q.fail],zfail:i_[Q.zfail],zpass:i_[Q.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var t=r.stencil,o=t!=null&&t.enable&&t.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,f=u===void 0?Ke.BACK:u;n.cull={enable:!!o,face:G9[f]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Y9(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}X9(n)&&Object.keys(n).forEach(function(f){u.extractUniformsRecursively(f,n[f],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(f,g){Object.keys(f).forEach(function(E){u.extractUniformsRecursively(E,f[E],t,"".concat(o&&o+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),K9=function(){function e(a,r){(0,Be.Z)(this,e),(0,Pe.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?Ke.UNSIGNED_BYTE:t,u=r.width,f=r.height,g=r.flipY,E=g===void 0?!1:g,R=r.format,B=R===void 0?Ke.RGBA:R,Y=r.mipmap,Q=Y===void 0?!1:Y,ce=r.wrapS,fe=ce===void 0?Ke.CLAMP_TO_EDGE:ce,Te=r.wrapT,Ve=Te===void 0?Ke.CLAMP_TO_EDGE:Te,st=r.aniso,at=st===void 0?0:st,Tt=r.alignment,kt=Tt===void 0?1:Tt,Yt=r.premultiplyAlpha,cr=Yt===void 0?!1:Yt,Mr=r.mag,Dr=Mr===void 0?Ke.NEAREST:Mr,sn=r.min,rn=sn===void 0?Ke.NEAREST:sn,Jn=r.colorSpace,fi=Jn===void 0?Ke.BROWSER_DEFAULT_WEBGL:Jn,Hi=r.x,Ds=Hi===void 0?0:Hi,pu=r.y,$s=pu===void 0?0:pu,Pc=r.copy,lc=Pc===void 0?!1:Pc;this.width=u,this.height=f;var up={width:u,height:f,type:_P[o],format:N9[B],wrapS:JL[fe],wrapT:JL[Ve],mag:KL[Dr],min:KL[rn],alignment:kt,flipY:E,colorSpace:U9[fi],premultiplyAlpha:cr,aniso:at,x:Ds,y:$s,copy:lc};n&&(up.data=n),typeof Q=="number"?up.mipmap=Z9[Q]:typeof Q=="boolean"&&(up.mipmap=Q),this.texture=a.texture(up)}return(0,Me.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),eR,tR,J9=(eR=(0,Ii.b2)(),eR(tR=function(){function e(){var a=this;(0,Be.Z)(this,e),(0,Pe.Z)(this,"createModel",function(r){return new q9(a.gl,r)}),(0,Pe.Z)(this,"createAttribute",function(r){return new z9(a.gl,r)}),(0,Pe.Z)(this,"createBuffer",function(r){return new H9(a.gl,r)}),(0,Pe.Z)(this,"createElements",function(r){return new $9(a.gl,r)}),(0,Pe.Z)(this,"createTexture2D",function(r){return new K9(a.gl,r)}),(0,Pe.Z)(this,"createFramebuffer",function(r){return new W9(a.gl,r)}),(0,Pe.Z)(this,"useFramebuffer",function(r,n){a.gl({framebuffer:r?r.get():null})(n)}),(0,Pe.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,f=r.framebuffer,g=f===void 0?null:f,E={color:t,depth:o,stencil:u};E.framebuffer=g===null?g:g.get(),(n=a.gl)===null||n===void 0||n.clear(E)}),(0,Pe.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;a.gl._gl.viewport(n,t,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,Pe.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,f=r.height,g={x:t,y:o,width:u,height:f};return n&&(g.framebuffer=n.get()),a.gl.read(g)}),(0,Pe.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,Pe.Z)(this,"getContainer",function(){var r;return(r=a.canvas)===null||r===void 0?void 0:r.parentElement}),(0,Pe.Z)(this,"getCanvas",function(){return a.canvas}),(0,Pe.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,Pe.Z)(this,"destroy",function(){var r,n,t;a.canvas=null,(r=a.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),a.gl.destroy(),a.gl=null})}return(0,Me.Z)(e,[{key:"init",value:function(){var a=(0,mr.Z)(x().mark(function n(t,o,u){var f=this;return x().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(this.canvas=t,!u){E.next=5;break}this.gl=u,E.next=8;break;case 5:return E.next=7,new Promise(function(R,B){F9()({canvas:f.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(Q,ce){(Q||!ce)&&B(Q),R(ce)}})});case 7:this.gl=E.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return E.stop()}},n,this)}));function r(n,t,o){return a.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||tR);function Q9(e){var a=eB();return function(){var n=(0,Ze.Z)(e),t;if(a){var o=(0,Ze.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,zt.Z)(this,t)}}function eB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bP=["selectstart","selecting","selectend"],tB=function(e){(0,yt.Z)(r,e);var a=Q9(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,Be.Z)(this,r),t=a.call(this),(0,Pe.Z)((0,D.Z)(t),"isEnable",!1),(0,Pe.Z)((0,D.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Pe.Z)((0,D.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Pe.Z)((0,D.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,Me.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=wo("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,f=this.endEvent,g=f.x,E=f.y,R=Math.min(o,g),B=Math.min(u,E),Y=Math.abs(o-g),Q=Math.abs(u-E);this.box.style.top="".concat(B,"px"),this.box.style.left="".concat(R,"px"),this.box.style.width="".concat(Y,"px"),this.box.style.height="".concat(Q,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,f=this.endEvent.lngLat,g=f.lng,E=f.lat;return Po([[o,u],[g,E]])}}]),r}(Z.EventEmitter),rB=function(){function e(a){(0,Be.Z)(this,e);var r=a.id,n=a.map,t=a.canvas,o=a.hasBaseMap,u=uy();this.container=u,n.setContainer(u,r,t,o),u.bind(cn.IRendererService).to(J9).inSingletonScope(),this.sceneService=u.get(cn.ISceneService),this.mapService=u.get(cn.IMapService),this.iconService=u.get(cn.IIconService),this.fontService=u.get(cn.IFontService),this.controlService=u.get(cn.IControlService),this.layerService=u.get(cn.ILayerService),this.debugService=u.get(cn.IDebugService),this.debugService.setEnable(a.debug),this.markerService=u.get(cn.IMarkerService),this.interactionService=u.get(cn.IInteractionService),this.popupService=u.get(cn.IPopupService),this.boxSelect=new tB(this,{}),this.initComponent(r),this.sceneService.init(a),this.initControl()}return(0,Me.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var a=(0,mr.Z)(x().mark(function n(t){return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return a.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=w0(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,f=u===void 0?"#000":u,g=n.maskOpacity,E=g===void 0?0:g;if(!(!t||!o)){var R=new fu().source(o).shape("fill").style({color:f,opacity:E});return R}}},{key:"addMask",value:function(r,n){if(r){var t=this.getLayer(n);if(t){var o=w0(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var a=(0,mr.Z)(x().mark(function n(t,o){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layerService.remove(t,o);case 2:case"end":return f.stop()}},n,this)}));function r(n,t){return a.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var a=(0,mr.Z)(x().mark(function n(){return x().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,gi.Z)(t,2),u=o[0],f=o[1];n.fontService.addIconFont(u,f)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var a=(0,mr.Z)(x().mark(function n(t,o){return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.iconService.addImage(t,o);case 2:case"end":return f.stop()}},n,this)}));function r(n,t){return a.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(bP.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else S0.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(bP.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else S0.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){S0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(bP.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else S0.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,Ee.Z)((0,Ee.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(cn.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return zn.REGISTERED_PROTOCOLS[r]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Hc(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new rb({position:t}))}}],[{key:"addProtocol",value:function(r,n){zn.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete zn.REGISTERED_PROTOCOLS[r]}}]),e}(),nB="2.19.9"},33109:function(Ue,_e,G){"use strict";G.d(_e,{yD:function(){return Jg},$2:function(){return mp},ns:function(){return FE},dW:function(){return d_}});var K=G(53197),j=G(67294),P=G.t(j,2),M=G(18446),ee=G.n(M),te=function(d,y){return d===void 0&&(d=[]),y===void 0&&(y=[]),ee()(d,y)},pe=function(d){return function(y,C){var F=(0,j.useRef)(),J=(0,j.useRef)(0);(C===void 0||!te(C,F.current))&&(F.current=C,J.current+=1),d(y,[J.current])}},Ce=pe(j.useEffect),le=G(94184),Ie=G.n(le);function rt(d){return d===void 0}var xt=rt;function nt(d){return d===null}var Ct=nt,jt=typeof global=="object"&&global&&global.Object===Object&&global,Vt=jt,Rt=typeof self=="object"&&self&&self.Object===Object&&self,hr=Vt||Rt||Function("return this")(),er=hr,gn=er.Symbol,Rr=gn,vn=Object.prototype,rr=vn.hasOwnProperty,Jt=vn.toString,br=Rr?Rr.toStringTag:void 0;function or(d){var y=rr.call(d,br),C=d[br];try{d[br]=void 0;var F=!0}catch(ie){}var J=Jt.call(d);return F&&(y?d[br]=C:delete d[br]),J}var Br=or,an=Object.prototype,ot=an.toString;function Dt(d){return ot.call(d)}var Ee=Dt,Bt="[object Null]",Ot="[object Undefined]",Pr=Rr?Rr.toStringTag:void 0;function Fr(d){return d==null?d===void 0?Ot:Bt:Pr&&Pr in Object(d)?Br(d):Ee(d)}var Nr=Fr;function hn(d){return d!=null&&typeof d=="object"}var xn=hn,Ji="[object Number]";function pi(d){return typeof d=="number"||xn(d)&&Nr(d)==Ji}var Ka=pi,na="*",ca=function(){function d(){this._events={}}return d.prototype.on=function(y,C,F){return this._events[y]||(this._events[y]=[]),this._events[y].push({callback:C,once:!!F}),this},d.prototype.once=function(y,C){return this.on(y,C,!0)},d.prototype.emit=function(y){for(var C=this,F=[],J=1;J<arguments.length;J++)F[J-1]=arguments[J];var ie=this._events[y]||[],me=this._events[na]||[],ke=function(je){for(var et=je.length,bt=0;bt<et;bt++)if(je[bt]){var Mt=je[bt],sr=Mt.callback,Kt=Mt.once;Kt&&(je.splice(bt,1),je.length===0&&delete C._events[y],et--,bt--),sr.apply(C,F)}};ke(ie),ke(me)},d.prototype.off=function(y,C){if(!y)this._events={};else if(!C)delete this._events[y];else{for(var F=this._events[y]||[],J=F.length,ie=0;ie<J;ie++)F[ie].callback===C&&(F.splice(ie,1),J--,ie--);F.length===0&&delete this._events[y]}return this},d.prototype.getEvents=function(){return this._events},d}(),po=ca;function La(d){"@babel/helpers - typeof";return La=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},La(d)}function $i(d,y){var C=typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(!C){if(Array.isArray(d)||(C=qo(d))||y&&d&&typeof d.length=="number"){C&&(d=C);var F=0,J=function(){};return{s:J,n:function(){return F>=d.length?{done:!0}:{done:!1,value:d[F++]}},e:function(et){throw et},f:J}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ie=!0,me=!1,ke;return{s:function(){C=C.call(d)},n:function(){var et=C.next();return ie=et.done,et},e:function(et){me=!0,ke=et},f:function(){try{!ie&&C.return!=null&&C.return()}finally{if(me)throw ke}}}}function qo(d,y){if(d){if(typeof d=="string")return is(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return is(d,y)}}function is(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Ko(d,y){if(!(d instanceof y))throw new TypeError("Cannot call a class as a function")}function Za(d,y){for(var C=0;C<y.length;C++){var F=y[C];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(d,xr(F.key),F)}}function ha(d,y,C){return y&&Za(d.prototype,y),C&&Za(d,C),Object.defineProperty(d,"prototype",{writable:!1}),d}function Fo(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(y&&y.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),Object.defineProperty(d,"prototype",{writable:!1}),y&&un(d,y)}function un(d,y){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(F,J){return F.__proto__=J,F},un(d,y)}function Ua(d){var y=lt();return function(){var F=mt(d),J;if(y){var ie=mt(this).constructor;J=Reflect.construct(F,arguments,ie)}else J=F.apply(this,arguments);return zr(this,J)}}function zr(d,y){if(y&&(La(y)==="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return be(d)}function be(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function lt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}function mt(d){return mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)},mt(d)}function Qt(d,y,C){return y=xr(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function xr(d){var y=mn(d,"string");return La(y)==="symbol"?y:String(y)}function mn(d,y){if(La(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(La(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}var Wn=0,tr=function(d){Fo(C,d);var y=Ua(C);function C(F){var J;return Ko(this,C),J=y.call(this),Qt(be(J),"scene",void 0),Qt(be(J),"options",void 0),Qt(be(J),"layerMap",new Map),J.scene=F.scene,J.options=F,J}return ha(C,[{key:"hasLayer",value:function(J){return this.layerMap.has(J)}},{key:"addLayer",value:function(J){var ie=this.getLayerId(J);this.layerMap.set(ie,J),J.addTo(this.scene),this.emit("add",J)}},{key:"addLayers",value:function(J){var ie=this;J.forEach(function(me){ie.addLayer(me)})}},{key:"removeLayer",value:function(J){var ie=typeof J=="string"?J:this.getLayerId(J),me=this.layerMap.get(ie);return me?(this.layerMap.delete(ie),me.remove(),this.emit("remove",ie),!0):!1}},{key:"getLayers",value:function(){return Array.from(this.layerMap.values())}},{key:"getLayerById",value:function(J){return this.layerMap.get(J)}},{key:"getLayer",value:function(J){return this.getLayerById(J)}},{key:"removeAllLayer",value:function(){var J=$i(this.layerMap.values()),ie;try{for(J.s();!(ie=J.n()).done;){var me=ie.value;me.remove()}}catch(ke){J.e(ke)}finally{J.f()}this.layerMap.clear()}},{key:"isEmpty",value:function(){return this.layerMap.size===0}},{key:"getLayerId",value:function(J){return"id"in J?J.id:"".concat(Wn++)}},{key:"destroy",value:function(){this.removeAllLayer()}}]),C}(po);function Hr(d,y,C,F){var J=-1,ie=d==null?0:d.length;for(F&&ie&&(C=d[++J]);++J<ie;)C=y(C,d[J],J,d);return C}var dr=Hr;function Un(d){return function(y){return d==null?void 0:d[y]}}var ti=Un,Yi={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},ea=ti(Yi),on=ea;function Xn(d,y){for(var C=-1,F=d==null?0:d.length,J=Array(F);++C<F;)J[C]=y(d[C],C,d);return J}var Pi=Xn,Pa=Array.isArray,zo=Pa,ya="[object Symbol]";function Xu(d){return typeof d=="symbol"||xn(d)&&Nr(d)==ya}var Wt=Xu,qe=1/0,se=Rr?Rr.prototype:void 0,ve=se?se.toString:void 0;function Ae(d){if(typeof d=="string")return d;if(zo(d))return Pi(d,Ae)+"";if(Wt(d))return ve?ve.call(d):"";var y=d+"";return y=="0"&&1/d==-qe?"-0":y}var Re=Ae;function Xe(d){return d==null?"":Re(d)}var Qe=Xe,Ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Fe="\\u0300-\\u036f",Me="\\ufe20-\\ufe2f",Be="\\u20d0-\\u20ff",yt=Fe+Me+Be,zt="["+yt+"]",Ze=RegExp(zt,"g");function Yr(d){return d=Qe(d),d&&d.replace(Ye,on).replace(Ze,"")}var Fn=Yr,Nn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function qr(d){return d.match(Nn)||[]}var li=qr,zn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function jn(d){return zn.test(d)}var Ca=jn,ni="\\ud800-\\udfff",za="\\u0300-\\u036f",Ao="\\ufe20-\\ufe2f",io="\\u20d0-\\u20ff",ys=za+Ao+io,oo="\\u2700-\\u27bf",el="a-z\\xdf-\\xf6\\xf8-\\xff",Qs="\\xac\\xb1\\xd7\\xf7",vo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",as="\\u2000-\\u206f",To=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",to="A-Z\\xc0-\\xd6\\xd8-\\xde",js="\\ufe0e\\ufe0f",Vc=Qs+vo+as+To,ws="['\u2019]",Ss="["+Vc+"]",eh="["+ys+"]",kc="\\d+",Io="["+oo+"]",bo="["+el+"]",du="[^"+ni+Vc+kc+oo+el+to+"]",Zo="\\ud83c[\\udffb-\\udfff]",Il="(?:"+eh+"|"+Zo+")",Uo="[^"+ni+"]",Ws="(?:\\ud83c[\\udde6-\\uddff]){2}",eu="[\\ud800-\\udbff][\\udc00-\\udfff]",sl="["+to+"]",ul="\\u200d",ll="(?:"+bo+"|"+du+")",_c="(?:"+sl+"|"+du+")",zu="(?:"+ws+"(?:d|ll|m|re|s|t|ve))?",cl="(?:"+ws+"(?:D|LL|M|RE|S|T|VE))?",iu=Il+"?",_t="["+js+"]?",Ut="(?:"+ul+"(?:"+[Uo,Ws,eu].join("|")+")"+_t+iu+")*",Er="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Sn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",kr=_t+iu+Ut,wa="(?:"+[Io,Ws,eu].join("|")+")"+kr,Xa=RegExp([sl+"?"+bo+"+"+zu+"(?="+[Ss,sl,"$"].join("|")+")",_c+"+"+cl+"(?="+[Ss,sl+ll,"$"].join("|")+")",sl+"?"+ll+"+"+zu,sl+"+"+cl,Sn,Er,kc,wa].join("|"),"g");function yl(d){return d.match(Xa)||[]}var Jo=yl;function au(d,y,C){return d=Qe(d),y=C?void 0:y,y===void 0?Ca(d)?Jo(d):li(d):d.match(y)||[]}var ou=au,Ra="['\u2019]",Mp=RegExp(Ra,"g");function th(d){return function(y){return dr(ou(Fn(y).replace(Mp,"")),d,"")}}var su=th,_a=su(function(d,y,C){return d+(C?"-":"")+y.toLowerCase()}),os=_a;function Su(d,y){return Ja(d)||uu(d,y)||Mo(d,y)||Eh()}function Eh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mo(d,y){if(d){if(typeof d=="string")return cc(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return cc(d,y)}}function cc(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function uu(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Ja(d){if(Array.isArray(d))return d}var rf=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.entries(y!=null?y:{}).map(function(C){var F=Su(C,2),J=F[0],ie=F[1],me=os(J),ke=ie;return typeof ke=="number"?ke="".concat(ke,"px"):typeof ke=="string"&&(ke=ke.replace("'","")),"".concat(me," :").concat(ke)}).join("; ")};function Yu(d,y){return Ch(d)||vu(d,y)||yh(d,y)||Vs()}function Vs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yh(d,y){if(d){if(typeof d=="string")return tl(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return tl(d,y)}}function tl(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function vu(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Ch(d){if(Array.isArray(d))return d}function Hf(d,y){return"".concat(d,"?").concat(Object.entries(y).map(function(C){var F=Yu(C,2),J=F[0],ie=F[1];return"".concat(J,"=").concat(window.encodeURIComponent(String(ie)))}).join("&"))}function Vn(d){"@babel/helpers - typeof";return Vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Vn(d)}function gi(){"use strict";gi=function(){return d};var d={},y=Object.prototype,C=y.hasOwnProperty,F=Object.defineProperty||function($t,vt,Lt){$t[vt]=Lt.value},J=typeof Symbol=="function"?Symbol:{},ie=J.iterator||"@@iterator",me=J.asyncIterator||"@@asyncIterator",ke=J.toStringTag||"@@toStringTag";function je($t,vt,Lt){return Object.defineProperty($t,vt,{value:Lt,enumerable:!0,configurable:!0,writable:!0}),$t[vt]}try{je({},"")}catch($t){je=function(Lt,yr,Or){return Lt[yr]=Or}}function et($t,vt,Lt,yr){var Or=vt&&vt.prototype instanceof sr?vt:sr,Cr=Object.create(Or.prototype),In=new Zi(yr||[]);return F(Cr,"_invoke",{value:ui($t,Lt,In)}),Cr}function bt($t,vt,Lt){try{return{type:"normal",arg:$t.call(vt,Lt)}}catch(yr){return{type:"throw",arg:yr}}}d.wrap=et;var Mt={};function sr(){}function Kt(){}function vr(){}var Sr={};je(Sr,ie,function(){return this});var Ar=Object.getPrototypeOf,jr=Ar&&Ar(Ar(ei([])));jr&&jr!==y&&C.call(jr,ie)&&(Sr=jr);var Kr=vr.prototype=sr.prototype=Object.create(Sr);function Tn($t){["next","throw","return"].forEach(function(vt){je($t,vt,function(Lt){return this._invoke(vt,Lt)})})}function En($t,vt){function Lt(Or,Cr,In,Mi){var Ki=bt($t[Or],$t,Cr);if(Ki.type!=="throw"){var Yo=Ki.arg,Va=Yo.value;return Va&&Vn(Va)=="object"&&C.call(Va,"__await")?vt.resolve(Va.__await).then(function(Co){Lt("next",Co,In,Mi)},function(Co){Lt("throw",Co,In,Mi)}):vt.resolve(Va).then(function(Co){Yo.value=Co,In(Yo)},function(Co){return Lt("throw",Co,In,Mi)})}Mi(Ki.arg)}var yr;F(this,"_invoke",{value:function(Cr,In){function Mi(){return new vt(function(Ki,Yo){Lt(Cr,In,Ki,Yo)})}return yr=yr?yr.then(Mi,Mi):Mi()}})}function ui($t,vt,Lt){var yr="suspendedStart";return function(Or,Cr){if(yr==="executing")throw new Error("Generator is already running");if(yr==="completed"){if(Or==="throw")throw Cr;return mi()}for(Lt.method=Or,Lt.arg=Cr;;){var In=Lt.delegate;if(In){var Mi=ai(In,Lt);if(Mi){if(Mi===Mt)continue;return Mi}}if(Lt.method==="next")Lt.sent=Lt._sent=Lt.arg;else if(Lt.method==="throw"){if(yr==="suspendedStart")throw yr="completed",Lt.arg;Lt.dispatchException(Lt.arg)}else Lt.method==="return"&&Lt.abrupt("return",Lt.arg);yr="executing";var Ki=bt($t,vt,Lt);if(Ki.type==="normal"){if(yr=Lt.done?"completed":"suspendedYield",Ki.arg===Mt)continue;return{value:Ki.arg,done:Lt.done}}Ki.type==="throw"&&(yr="completed",Lt.method="throw",Lt.arg=Ki.arg)}}}function ai($t,vt){var Lt=vt.method,yr=$t.iterator[Lt];if(yr===void 0)return vt.delegate=null,Lt==="throw"&&$t.iterator.return&&(vt.method="return",vt.arg=void 0,ai($t,vt),vt.method==="throw")||Lt!=="return"&&(vt.method="throw",vt.arg=new TypeError("The iterator does not provide a '"+Lt+"' method")),Mt;var Or=bt(yr,$t.iterator,vt.arg);if(Or.type==="throw")return vt.method="throw",vt.arg=Or.arg,vt.delegate=null,Mt;var Cr=Or.arg;return Cr?Cr.done?(vt[$t.resultName]=Cr.value,vt.next=$t.nextLoc,vt.method!=="return"&&(vt.method="next",vt.arg=void 0),vt.delegate=null,Mt):Cr:(vt.method="throw",vt.arg=new TypeError("iterator result is not an object"),vt.delegate=null,Mt)}function Bn($t){var vt={tryLoc:$t[0]};1 in $t&&(vt.catchLoc=$t[1]),2 in $t&&(vt.finallyLoc=$t[2],vt.afterLoc=$t[3]),this.tryEntries.push(vt)}function bi($t){var vt=$t.completion||{};vt.type="normal",delete vt.arg,$t.completion=vt}function Zi($t){this.tryEntries=[{tryLoc:"root"}],$t.forEach(Bn,this),this.reset(!0)}function ei($t){if($t){var vt=$t[ie];if(vt)return vt.call($t);if(typeof $t.next=="function")return $t;if(!isNaN($t.length)){var Lt=-1,yr=function Or(){for(;++Lt<$t.length;)if(C.call($t,Lt))return Or.value=$t[Lt],Or.done=!1,Or;return Or.value=void 0,Or.done=!0,Or};return yr.next=yr}}return{next:mi}}function mi(){return{value:void 0,done:!0}}return Kt.prototype=vr,F(Kr,"constructor",{value:vr,configurable:!0}),F(vr,"constructor",{value:Kt,configurable:!0}),Kt.displayName=je(vr,ke,"GeneratorFunction"),d.isGeneratorFunction=function($t){var vt=typeof $t=="function"&&$t.constructor;return!!vt&&(vt===Kt||(vt.displayName||vt.name)==="GeneratorFunction")},d.mark=function($t){return Object.setPrototypeOf?Object.setPrototypeOf($t,vr):($t.__proto__=vr,je($t,ke,"GeneratorFunction")),$t.prototype=Object.create(Kr),$t},d.awrap=function($t){return{__await:$t}},Tn(En.prototype),je(En.prototype,me,function(){return this}),d.AsyncIterator=En,d.async=function($t,vt,Lt,yr,Or){Or===void 0&&(Or=Promise);var Cr=new En(et($t,vt,Lt,yr),Or);return d.isGeneratorFunction(vt)?Cr:Cr.next().then(function(In){return In.done?In.value:Cr.next()})},Tn(Kr),je(Kr,ke,"Generator"),je(Kr,ie,function(){return this}),je(Kr,"toString",function(){return"[object Generator]"}),d.keys=function($t){var vt=Object($t),Lt=[];for(var yr in vt)Lt.push(yr);return Lt.reverse(),function Or(){for(;Lt.length;){var Cr=Lt.pop();if(Cr in vt)return Or.value=Cr,Or.done=!1,Or}return Or.done=!0,Or}},d.values=ei,Zi.prototype={constructor:Zi,reset:function(vt){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(bi),!vt)for(var Lt in this)Lt.charAt(0)==="t"&&C.call(this,Lt)&&!isNaN(+Lt.slice(1))&&(this[Lt]=void 0)},stop:function(){this.done=!0;var vt=this.tryEntries[0].completion;if(vt.type==="throw")throw vt.arg;return this.rval},dispatchException:function(vt){if(this.done)throw vt;var Lt=this;function yr(Yo,Va){return In.type="throw",In.arg=vt,Lt.next=Yo,Va&&(Lt.method="next",Lt.arg=void 0),!!Va}for(var Or=this.tryEntries.length-1;Or>=0;--Or){var Cr=this.tryEntries[Or],In=Cr.completion;if(Cr.tryLoc==="root")return yr("end");if(Cr.tryLoc<=this.prev){var Mi=C.call(Cr,"catchLoc"),Ki=C.call(Cr,"finallyLoc");if(Mi&&Ki){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0);if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}else if(Mi){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0)}else{if(!Ki)throw new Error("try statement without catch or finally");if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}}}},abrupt:function(vt,Lt){for(var yr=this.tryEntries.length-1;yr>=0;--yr){var Or=this.tryEntries[yr];if(Or.tryLoc<=this.prev&&C.call(Or,"finallyLoc")&&this.prev<Or.finallyLoc){var Cr=Or;break}}Cr&&(vt==="break"||vt==="continue")&&Cr.tryLoc<=Lt&&Lt<=Cr.finallyLoc&&(Cr=null);var In=Cr?Cr.completion:{};return In.type=vt,In.arg=Lt,Cr?(this.method="next",this.next=Cr.finallyLoc,Mt):this.complete(In)},complete:function(vt,Lt){if(vt.type==="throw")throw vt.arg;return vt.type==="break"||vt.type==="continue"?this.next=vt.arg:vt.type==="return"?(this.rval=this.arg=vt.arg,this.method="return",this.next="end"):vt.type==="normal"&&Lt&&(this.next=Lt),Mt},finish:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.finallyLoc===vt)return this.complete(yr.completion,yr.afterLoc),bi(yr),Mt}},catch:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.tryLoc===vt){var Or=yr.completion;if(Or.type==="throw"){var Cr=Or.arg;bi(yr)}return Cr}}throw new Error("illegal catch attempt")},delegateYield:function(vt,Lt,yr){return this.delegate={iterator:ei(vt),resultName:Lt,nextLoc:yr},this.method==="next"&&(this.arg=void 0),Mt}},d}function Hp(d,y,C,F,J,ie,me){try{var ke=d[ie](me),je=ke.value}catch(et){C(et);return}ke.done?y(je):Promise.resolve(je).then(F,J)}function nf(d){return function(){var y=this,C=arguments;return new Promise(function(F,J){var ie=d.apply(y,C);function me(je){Hp(ie,F,J,me,ke,"next",je)}function ke(je){Hp(ie,F,J,me,ke,"throw",je)}me(void 0)})}}var Gc=function(){var d=nf(gi().mark(function y(C,F){return gi().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(C!=="Map"){ie.next=2;break}return ie.abrupt("return",new K.Map(F));case 2:if(C!=="Gaode"){ie.next=6;break}return ie.abrupt("return",new K.GaodeMap(F));case 6:if(C!=="GaodeV1"){ie.next=10;break}return ie.abrupt("return",new K.GaodeMapV1(F));case 10:if(C!=="GaodeV2"){ie.next=12;break}return ie.abrupt("return",new K.GaodeMapV2(F));case 12:return ie.abrupt("return",Promise.resolve(Promise.resolve().then(G.bind(G,53197))).then(function(me){var ke=me.Mapbox;return new ke(F)}));case 13:case"end":return ie.stop()}},y)}));return function(C,F){return d.apply(this,arguments)}}(),sd=function(d,y){return d?d.map(function(C,F){return Object.is(d[F],y==null?void 0:y[F])?-1:F}).filter(function(C){return C>=0}):y?y.map(function(C,F){return F}):[]},Bu=function(d,y){var C=(0,j.useRef)();(0,j.useEffect)(function(){var F=sd(C.current,y),J=C.current;return C.current=y,d(F,J,y)},y)},$d=Bu;function rh(d){var y=(0,j.useRef)(d);return y.current=d,y}var Ah=rh,lp=function(d){return d!==null&&typeof d=="object"},hl=function(d){return typeof d=="function"},$f=function(d){return typeof d=="string"},Th=function(d){return typeof d=="boolean"},_h=function(d){return typeof d=="number"},nh=function(d){return typeof d=="undefined"},$p=!1,cp=$p,Mu=function(d){cp&&(hl(d)||console.error("useUnmount expected parameter is a function, got ".concat(typeof d)));var y=Ah(d);(0,j.useEffect)(function(){return function(){y.current()}},[])},af=Mu,hp={onLoaded:"loaded",onDestroy:"destroy",onResize:"resize",onMapMove:"mapmove",onMoveStart:"movestart",onMoveEnd:"moveend",onZoomChange:"zoomchange",onZoomStart:"zoomstart",onZoomEnd:"zoomend",onClick:"click",onDblclick:"dblclick",onContextMenu:"contextmenu",onMouseMove:"mousemove",onMouseWheel:"mousewheel",onMouseDown:"mousedown",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseUp:"mouseup",onDragStart:"dragstart",onDragging:"dragging",onDragEnd:"dragend"},ih=Object.keys(hp);function fp(d){return Sf(d)||Wf(d)||Nu(d)||Vh()}function Vh(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nu(d,y){if(d){if(typeof d=="string")return ko(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return ko(d,y)}}function Wf(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function Sf(d){if(Array.isArray(d))return ko(d)}function ko(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}var rl=function(y,C){$d(function(F,J,ie){if(y){var me=F.filter(function(ke){return!!ke}).map(function(ke){return ke-1});F.includes(0)&&(me=ih.map(function(ke,je){return je})),me.forEach(function(ke){var je=hp[ih[ke]],et=J[ke+1],bt=ie[ke+1];et&&y.off(je,et),bt&&y.on(je,bt)})}},[y].concat(fp(ih.map(function(F){return C[F]})))),af(function(){y&&ih.forEach(function(F){var J=hp[F],ie=C[F];J&&ie&&y.off(J,ie)})})};function pp(d){"@babel/helpers - typeof";return pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},pp(d)}var jo=["id","style","className","map","mapType","mapOptions","onLayerManagerCreated","onSceneLoaded","children"];function hc(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function _u(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?hc(Object(C),!0).forEach(function(F){mu(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):hc(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function mu(d,y,C){return y=Mh(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function Mh(d){var y=ud(d,"string");return pp(y)==="symbol"?y:String(y)}function ud(d,y){if(pp(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(pp(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function of(d,y){return wd(d)||Ph(d,y)||dp(d,y)||Eu()}function Eu(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dp(d,y){if(d){if(typeof d=="string")return Wp(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Wp(d,y)}}function Wp(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Ph(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function wd(d){if(Array.isArray(d))return d}function Xp(d,y){if(d==null)return{};var C=vp(d,y),F,J;if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(d);for(J=0;J<ie.length;J++)F=ie[J],!(y.indexOf(F)>=0)&&Object.prototype.propertyIsEnumerable.call(d,F)&&(C[F]=d[F])}return C}function vp(d,y){if(d==null)return{};var C={},F=Object.keys(d),J,ie;for(ie=0;ie<F.length;ie++)J=F[ie],!(y.indexOf(J)>=0)&&(C[J]=d[J]);return C}var Ga=j.createContext(null),mp=(0,j.memo)((0,j.forwardRef)(function(y,C){var F=y.id,J=y.style,ie=y.className,me=y.map,ke=y.mapType,je=ke===void 0?"Gaode":ke,et=y.mapOptions,bt=et===void 0?{}:et,Mt=y.onLayerManagerCreated,sr=y.onSceneLoaded,Kt=y.children,vr=Xp(y,jo),Sr=(0,j.useRef)(),Ar=(0,j.useState)(null),jr=of(Ar,2),Kr=jr[0],Tn=jr[1],En=(0,j.useRef)({scene:null,layerManager:null}),ui=En.current;(0,j.useEffect)(function(){var Bn,bi=!0,Zi=xt(me)?Gc(je,bt):typeof me=="function"?me():me;return Promise.resolve(Zi).then(function(ei){if(bi){Bn=new K.Scene(_u(_u({},vr),{},{id:Sr.current,map:ei}));var mi=new tr({scene:Bn});ui.scene=Bn,ui.layerManager=mi,Bn.once("loaded",function(){sr&&sr(Bn),Mt&&Mt(mi),Tn(Bn)})}}).catch(function(ei){console.error(ei)}),function(){bi=!1,Bn&&(ui.scene=null,ui.layerManager=null,Bn.destroy())}},[]),rl(Kr,y),(0,j.useImperativeHandle)(C,function(){return{getScene:function(){return Kr},getMap:function(){return Kr.map}}},[Kr]),(0,j.useEffect)(function(){Kr&&bt.style&&Kr.setMapStyle(bt.style)},[bt.style]),Ce(function(){Ct(Kr)||(bt.center&&Ka(bt.zoom)?Kr.setZoomAndCenter(bt.zoom,bt.center):Ka(bt.zoom)?Kr.setZoom(bt.zoom):bt.center&&Kr.setCenter(bt.center))},[bt.zoom,bt.center]),(0,j.useEffect)(function(){Kr&&Ka(bt.pitch)&&Kr.setPitch(bt.pitch)},[bt.pitch]),(0,j.useEffect)(function(){Kr&&Ka(bt.rotation)&&Kr.setRotation(bt.rotation)},[bt.rotation]);var ai=(0,j.useMemo)(function(){return _u({position:"relative"},J)},[J]);return j.createElement("div",{id:F,ref:Sr,style:ai,className:Ie()("larkmap",ie)},Kr&&j.createElement(Ga.Provider,{value:ui},Kt))})),Hc=function(d){return function(y,C){var F=(0,j.useRef)(!1);d(function(){return function(){F.current=!1}},[]),d(function(){if(!F.current)F.current=!0;else return y()},C)}},gp=null,sf=Hc(j.useEffect),ah=function(){var y=(0,j.useContext)(Ga);if(!y)throw new Error("The useScene must be used in the LarkMap container");var C=y.scene;return C},wo=function(y,C,F){var J=ah(),ie=(0,j.useRef)();(0,j.useEffect)(function(){var me=new K.Control(F);return me.onAdd=function(){return y(J)},me.onRemove=function(){},ie.current=me,J.addControl(me),function(){typeof C=="function"&&C(J),ie.current=null,J.removeControl(me)}},[]),sf(function(){var me;(me=ie.current)===null||me===void 0||me.setOptions(F)},[F])},fl=function(){var y=(0,j.useContext)(Ga);if(!y)throw new Error("The useLayerManager must be used in the LarkMap container");var C=y.layerManager;return C};function pl(d,y){return Vu(d)||Gh(d,y)||Xf(d,y)||bh()}function bh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xf(d,y){if(d){if(typeof d=="string")return yp(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return yp(d,y)}}function yp(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Gh(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Vu(d){if(Array.isArray(d))return d}var Yf=function(y){var C=useLayerManager(),F=useState(C.getLayer(y)),J=pl(F,2),ie=J[0],me=J[1];return useEffect(function(){var ke=function(Mt){y===Mt.id&&me(Mt)},je=function(Mt){y===Mt&&me(void 0)},et=C.getLayer(y);return et?me(et):(C.on("add",ke),C.on("remove",je)),function(){et===void 0&&(C.off("add",ke),C.off("remove",je))}},[y]),ie};function Ll(d,y){return qf(d)||Xs(d,y)||Pp(d,y)||uf()}function uf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pp(d,y){if(d){if(typeof d=="string")return kh(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return kh(d,y)}}function kh(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Xs(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function qf(d){if(Array.isArray(d))return d}var _p=function(){var y=useLayerManager(),C=useState((y==null?void 0:y.getLayers())||[]),F=Ll(C,2),J=F[0],ie=F[1];return useEffect(function(){if(y){var me=function(){ie(y.getLayers())};return y.on("add",me),y.on("remove",me),function(){y.off("add",me),y.off("remove",me)}}},[y]),J};function bp(){this.__data__=[],this.size=0}var Yp=bp;function kp(d,y){return d===y||d!==d&&y!==y}var xp=kp;function Kl(d,y){for(var C=d.length;C--;)if(xp(d[C][0],y))return C;return-1}var $c=Kl,Rl=Array.prototype,Ms=Rl.splice;function Hh(d){var y=this.__data__,C=$c(y,d);if(C<0)return!1;var F=y.length-1;return C==F?y.pop():Ms.call(y,C,1),--this.size,!0}var lf=Hh;function Ef(d){var y=this.__data__,C=$c(y,d);return C<0?void 0:y[C][1]}var vs=Ef;function Ns(d){return $c(this.__data__,d)>-1}var bc=Ns;function fc(d,y){var C=this.__data__,F=$c(C,d);return F<0?(++this.size,C.push([d,y])):C[F][1]=y,this}var xc=fc;function Pe(d){var y=-1,C=d==null?0:d.length;for(this.clear();++y<C;){var F=d[y];this.set(F[0],F[1])}}Pe.prototype.clear=Yp,Pe.prototype.delete=lf,Pe.prototype.get=vs,Pe.prototype.has=bc,Pe.prototype.set=xc;var Ih=Pe;function cf(){this.__data__=new Ih,this.size=0}var Cf=cf;function Af(d){var y=this.__data__,C=y.delete(d);return this.size=y.size,C}var Lh=Af;function Cu(d){return this.__data__.get(d)}var nl=Cu;function Wc(d){return this.__data__.has(d)}var zi=Wc;function Ui(d){var y=typeof d;return d!=null&&(y=="object"||y=="function")}var Gu=Ui,$h="[object AsyncFunction]",Wh="[object Function]",ji="[object GeneratorFunction]",Ic="[object Proxy]";function hf(d){if(!Gu(d))return!1;var y=Nr(d);return y==Wh||y==ji||y==$h||y==Ic}var Gn=hf,ld=er["__core-js_shared__"],xh=ld,Xh=function(){var d=/[^.]+$/.exec(xh&&xh.keys&&xh.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}();function wh(d){return!!Xh&&Xh in d}var oh=wh,ff=Function.prototype,Tf=ff.toString;function Jl(d){if(d!=null){try{return Tf.call(d)}catch(y){}try{return d+""}catch(y){}}return""}var wc=Jl,Ql=/[\\^$.*+?()[\]{}|]/g,Yh=/^\[object .+?Constructor\]$/,Mf=Function.prototype,pf=Object.prototype,Lc=Mf.toString,_l=pf.hasOwnProperty,xo=RegExp("^"+Lc.call(_l).replace(Ql,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Dl(d){if(!Gu(d)||oh(d))return!1;var y=Gn(d)?xo:Yh;return y.test(wc(d))}var Po=Dl;function dl(d,y){return d==null?void 0:d[y]}var Kf=dl;function Pf(d,y){var C=Kf(d,y);return Po(C)?C:void 0}var Sc=Pf,Ec=Sc(er,"Map"),Al=Ec,aa=Sc(Object,"create"),ta=aa;function Da(){this.__data__=ta?ta(null):{},this.size=0}var ba=Da;function bl(d){var y=this.has(d)&&delete this.__data__[d];return this.size-=y?1:0,y}var jl=bl,df="__lodash_hash_undefined__",Pu=Object.prototype,Rh=Pu.hasOwnProperty;function ho(d){var y=this.__data__;if(ta){var C=y[d];return C===df?void 0:C}return Rh.call(y,d)?y[d]:void 0}var vl=ho,kf=Object.prototype,Zu=kf.hasOwnProperty;function il(d){var y=this.__data__;return ta?y[d]!==void 0:Zu.call(y,d)}var sh=il,ec="__lodash_hash_undefined__";function If(d,y){var C=this.__data__;return this.size+=this.has(d)?0:1,C[d]=ta&&y===void 0?ec:y,this}var Rc=If;function Cc(d){var y=-1,C=d==null?0:d.length;for(this.clear();++y<C;){var F=d[y];this.set(F[0],F[1])}}Cc.prototype.clear=ba,Cc.prototype.delete=jl,Cc.prototype.get=vl,Cc.prototype.has=sh,Cc.prototype.set=Rc;var Lf=Cc;function Dh(){this.size=0,this.__data__={hash:new Lf,map:new(Al||Ih),string:new Lf}}var wp=Dh;function Jf(d){var y=typeof d;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?d!=="__proto__":d===null}var mr=Jf;function D(d,y){var C=d.__data__;return mr(y)?C[typeof y=="string"?"string":"hash"]:C.map}var h=D;function x(d){var y=h(this,d).delete(d);return this.size-=y?1:0,y}var O=x;function Z(d){return h(this,d).get(d)}var H=Z;function ae(d){return h(this,d).has(d)}var ue=ae;function ge(d,y){var C=h(this,d),F=C.size;return C.set(d,y),this.size+=C.size==F?0:1,this}var Le=ge;function m(d){var y=-1,C=d==null?0:d.length;for(this.clear();++y<C;){var F=d[y];this.set(F[0],F[1])}}m.prototype.clear=wp,m.prototype.delete=O,m.prototype.get=H,m.prototype.has=ue,m.prototype.set=Le;var w=m,_=200;function T(d,y){var C=this.__data__;if(C instanceof Ih){var F=C.__data__;if(!Al||F.length<_-1)return F.push([d,y]),this.size=++C.size,this;C=this.__data__=new w(F)}return C.set(d,y),this.size=C.size,this}var N=T;function $(d){var y=this.__data__=new Ih(d);this.size=y.size}$.prototype.clear=Cf,$.prototype.delete=Lh,$.prototype.get=nl,$.prototype.has=zi,$.prototype.set=N;var X=$,oe="__lodash_hash_undefined__";function xe(d){return this.__data__.set(d,oe),this}var ye=xe;function De(d){return this.__data__.has(d)}var He=De;function $e(d){var y=-1,C=d==null?0:d.length;for(this.__data__=new w;++y<C;)this.add(d[y])}$e.prototype.add=$e.prototype.push=ye,$e.prototype.has=He;var ft=$e;function pt(d,y){for(var C=-1,F=d==null?0:d.length;++C<F;)if(y(d[C],C,d))return!0;return!1}var wt=pt;function dt(d,y){return d.has(y)}var Ft=dt,ar=1,nr=2;function Ir(d,y,C,F,J,ie){var me=C&ar,ke=d.length,je=y.length;if(ke!=je&&!(me&&je>ke))return!1;var et=ie.get(d),bt=ie.get(y);if(et&&bt)return et==y&&bt==d;var Mt=-1,sr=!0,Kt=C&nr?new ft:void 0;for(ie.set(d,y),ie.set(y,d);++Mt<ke;){var vr=d[Mt],Sr=y[Mt];if(F)var Ar=me?F(Sr,vr,Mt,y,d,ie):F(vr,Sr,Mt,d,y,ie);if(Ar!==void 0){if(Ar)continue;sr=!1;break}if(Kt){if(!wt(y,function(jr,Kr){if(!Ft(Kt,Kr)&&(vr===jr||J(vr,jr,C,F,ie)))return Kt.push(Kr)})){sr=!1;break}}else if(!(vr===Sr||J(vr,Sr,C,F,ie))){sr=!1;break}}return ie.delete(d),ie.delete(y),sr}var _r=Ir,Qr=er.Uint8Array,nn=Qr;function Ln(d){var y=-1,C=Array(d.size);return d.forEach(function(F,J){C[++y]=[J,F]}),C}var Mn=Ln;function yi(d){var y=-1,C=Array(d.size);return d.forEach(function(F){C[++y]=F}),C}var Ri=yi,Qi=1,Vi=2,ao="[object Boolean]",Bi="[object Date]",oa="[object Error]",Ha="[object Map]",ja="[object Number]",Sa="[object RegExp]",Qa="[object Set]",eo="[object String]",va="[object Symbol]",tu="[object ArrayBuffer]",Gs="[object DataView]",Tl=Rr?Rr.prototype:void 0,Ps=Tl?Tl.valueOf:void 0;function Qo(d,y,C,F,J,ie,me){switch(C){case Gs:if(d.byteLength!=y.byteLength||d.byteOffset!=y.byteOffset)return!1;d=d.buffer,y=y.buffer;case tu:return!(d.byteLength!=y.byteLength||!ie(new nn(d),new nn(y)));case ao:case Bi:case ja:return xp(+d,+y);case oa:return d.name==y.name&&d.message==y.message;case Sa:case eo:return d==y+"";case Ha:var ke=Mn;case Qa:var je=F&Qi;if(ke||(ke=Ri),d.size!=y.size&&!je)return!1;var et=me.get(d);if(et)return et==y;F|=Vi,me.set(d,y);var bt=_r(ke(d),ke(y),F,J,ie,me);return me.delete(d),bt;case va:if(Ps)return Ps.call(d)==Ps.call(y)}return!1}var Zs=Qo;function Hs(d,y){for(var C=-1,F=y.length,J=d.length;++C<F;)d[J+C]=y[C];return d}var Uu=Hs;function uh(d,y,C){var F=y(d);return zo(d)?F:Uu(F,C(d))}var pc=uh;function Xc(d,y){for(var C=-1,F=d==null?0:d.length,J=0,ie=[];++C<F;){var me=d[C];y(me,C,d)&&(ie[J++]=me)}return ie}var Yc=Xc;function Qf(){return[]}var dc=Qf,vc=Object.prototype,Dc=vc.propertyIsEnumerable,Vl=Object.getOwnPropertySymbols,Gl=Vl?function(d){return d==null?[]:(d=Object(d),Yc(Vl(d),function(y){return Dc.call(d,y)}))}:dc,vf=Gl;function mc(d,y){for(var C=-1,F=Array(d);++C<d;)F[C]=y(C);return F}var Hl=mc,lh="[object Arguments]";function Os(d){return xn(d)&&Nr(d)==lh}var ch=Os,Es=Object.prototype,Ol=Es.hasOwnProperty,ml=Es.propertyIsEnumerable,mf=ch(function(){return arguments}())?ch:function(d){return xn(d)&&Ol.call(d,"callee")&&!ml.call(d,"callee")},ku=mf;function ep(){return!1}var cd=ep,qh=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Rd=qh&&typeof module=="object"&&module&&!module.nodeType&&module,Rf=Rd&&Rd.exports===qh,hd=Rf?er.Buffer:void 0,Sd=hd?hd.isBuffer:void 0,Ip=Sd||cd,Fl=Ip,Wd=9007199254740991,Qm=/^(?:0|[1-9]\d*)$/;function Tv(d,y){var C=typeof d;return y=y==null?Wd:y,!!y&&(C=="number"||C!="symbol"&&Qm.test(d))&&d>-1&&d%1==0&&d<y}var Mv=Tv,Dd=9007199254740991;function Pv(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=Dd}var fd=Pv,jv="[object Arguments]",hh="[object Array]",dv="[object Boolean]",Df="[object Date]",Xd="[object Error]",Yd="[object Function]",Vv="[object Map]",lm="[object Number]",Om="[object Object]",Fm="[object RegExp]",cm="[object Set]",hm="[object String]",zm="[object WeakMap]",qd="[object ArrayBuffer]",Sp="[object DataView]",Ed="[object Float32Array]",qu="[object Float64Array]",fh="[object Int8Array]",Oh="[object Int16Array]",Ku="[object Int32Array]",Ml="[object Uint8Array]",qp="[object Uint8ClampedArray]",kv="[object Uint16Array]",Kd="[object Uint32Array]",Ju={};Ju[Ed]=Ju[qu]=Ju[fh]=Ju[Oh]=Ju[Ku]=Ju[Ml]=Ju[qp]=Ju[kv]=Ju[Kd]=!0,Ju[jv]=Ju[hh]=Ju[qd]=Ju[dv]=Ju[Sp]=Ju[Df]=Ju[Xd]=Ju[Yd]=Ju[Vv]=Ju[lm]=Ju[Om]=Ju[Fm]=Ju[cm]=Ju[hm]=Ju[zm]=!1;function Od(d){return xn(d)&&fd(d.length)&&!!Ju[Nr(d)]}var _s=Od;function vv(d){return function(y){return d(y)}}var Ac=vv,Sh=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Lp=Sh&&typeof module=="object"&&module&&!module.nodeType&&module,Tc=Lp&&Lp.exports===Sh,Of=Tc&&Vt.process,Fd=function(){try{var d=Lp&&Lp.require&&Lp.require("util").types;return d||Of&&Of.binding&&Of.binding("util")}catch(y){}}(),Oc=Fd,zd=Oc&&Oc.isTypedArray,yg=zd?Ac(zd):_s,Gv=yg,fm=Object.prototype,Ff=fm.hasOwnProperty;function mv(d,y){var C=zo(d),F=!C&&ku(d),J=!C&&!F&&Fl(d),ie=!C&&!F&&!J&&Gv(d),me=C||F||J||ie,ke=me?Hl(d.length,String):[],je=ke.length;for(var et in d)(y||Ff.call(d,et))&&!(me&&(et=="length"||J&&(et=="offset"||et=="parent")||ie&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||Mv(et,je)))&&ke.push(et);return ke}var gc=mv,Hv=Object.prototype;function pm(d){var y=d&&d.constructor,C=typeof y=="function"&&y.prototype||Hv;return d===C}var Cd=pm;function dm(d,y){return function(C){return d(y(C))}}var gf=dm,Jd=gf(Object.keys,Object),Kh=Jd,qc=Object.prototype,Bd=qc.hasOwnProperty;function zf(d){if(!Cd(d))return Kh(d);var y=[];for(var C in Object(d))Bd.call(d,C)&&C!="constructor"&&y.push(C);return y}var gv=zf;function eg(d){return d!=null&&fd(d.length)&&!Gn(d)}var Fh=eg;function yf(d){return Fh(d)?gc(d):gv(d)}var tc=yf;function _f(d){return pc(d,tc,vf)}var $v=_f,vm=1,zl=Object.prototype,Wv=zl.hasOwnProperty;function al(d,y,C,F,J,ie){var me=C&vm,ke=$v(d),je=ke.length,et=$v(y),bt=et.length;if(je!=bt&&!me)return!1;for(var Mt=je;Mt--;){var sr=ke[Mt];if(!(me?sr in y:Wv.call(y,sr)))return!1}var Kt=ie.get(d),vr=ie.get(y);if(Kt&&vr)return Kt==y&&vr==d;var Sr=!0;ie.set(d,y),ie.set(y,d);for(var Ar=me;++Mt<je;){sr=ke[Mt];var jr=d[sr],Kr=y[sr];if(F)var Tn=me?F(Kr,jr,sr,y,d,ie):F(jr,Kr,sr,d,y,ie);if(!(Tn===void 0?jr===Kr||J(jr,Kr,C,F,ie):Tn)){Sr=!1;break}Ar||(Ar=sr=="constructor")}if(Sr&&!Ar){var En=d.constructor,ui=y.constructor;En!=ui&&"constructor"in d&&"constructor"in y&&!(typeof En=="function"&&En instanceof En&&typeof ui=="function"&&ui instanceof ui)&&(Sr=!1)}return ie.delete(d),ie.delete(y),Sr}var Xv=al,Qd=Sc(er,"DataView"),yv=Qd,_g=Sc(er,"Promise"),mm=_g,bg=Sc(er,"Set"),Kp=bg,Bm=Sc(er,"WeakMap"),Ad=Bm,ev="[object Map]",Fc="[object Object]",tp="[object Promise]",Nd="[object Set]",ze="[object WeakMap]",At="[object DataView]",Gt=wc(yv),fn=wc(Al),Dn=wc(mm),ln=wc(Kp),_n=wc(Ad),Zn=Nr;(yv&&Zn(new yv(new ArrayBuffer(1)))!=At||Al&&Zn(new Al)!=ev||mm&&Zn(mm.resolve())!=tp||Kp&&Zn(new Kp)!=Nd||Ad&&Zn(new Ad)!=ze)&&(Zn=function(d){var y=Nr(d),C=y==Fc?d.constructor:void 0,F=C?wc(C):"";if(F)switch(F){case Gt:return At;case fn:return ev;case Dn:return tp;case ln:return Nd;case _n:return ze}return y});var ri=Zn,Ci=1,_i="[object Arguments]",Li="[object Array]",Fi="[object Object]",hi=Object.prototype,ki=hi.hasOwnProperty;function Wr(d,y,C,F,J,ie){var me=zo(d),ke=zo(y),je=me?Li:ri(d),et=ke?Li:ri(y);je=je==_i?Fi:je,et=et==_i?Fi:et;var bt=je==Fi,Mt=et==Fi,sr=je==et;if(sr&&Fl(d)){if(!Fl(y))return!1;me=!0,bt=!1}if(sr&&!bt)return ie||(ie=new X),me||Gv(d)?_r(d,y,C,F,J,ie):Zs(d,y,je,C,F,J,ie);if(!(C&Ci)){var Kt=bt&&ki.call(d,"__wrapped__"),vr=Mt&&ki.call(y,"__wrapped__");if(Kt||vr){var Sr=Kt?d.value():d,Ar=vr?y.value():y;return ie||(ie=new X),J(Sr,Ar,C,F,ie)}}return sr?(ie||(ie=new X),Xv(d,y,C,F,J,ie)):!1}var bn=Wr;function di(d,y,C,F,J){return d===y?!0:d==null||y==null||!xn(d)&&!xn(y)?d!==d&&y!==y:bn(d,y,C,F,di,J)}var Gi=di;function Yn(d,y){return Gi(d,y)}var ia=Yn;function oi(d,y){for(var C=-1,F=d==null?0:d.length;++C<F&&y(d[C],C,d)!==!1;);return d}var Di=oi,qn=function(){try{var d=Sc(Object,"defineProperty");return d({},"",{}),d}catch(y){}}(),Ai=qn;function Oa(d,y,C){y=="__proto__"&&Ai?Ai(d,y,{configurable:!0,enumerable:!0,value:C,writable:!0}):d[y]=C}var Ya=Oa,Oi=Object.prototype,Qn=Oi.hasOwnProperty;function Hn(d,y,C){var F=d[y];(!(Qn.call(d,y)&&xp(F,C))||C===void 0&&!(y in d))&&Ya(d,y,C)}var mo=Hn;function so(d,y,C,F){var J=!C;C||(C={});for(var ie=-1,me=y.length;++ie<me;){var ke=y[ie],je=F?F(C[ke],d[ke],ke,C,d):void 0;je===void 0&&(je=d[ke]),J?Ya(C,ke,je):mo(C,ke,je)}return C}var sa=so;function Cs(d,y){return d&&sa(y,tc(y),d)}var Vo=Cs;function Go(d){var y=[];if(d!=null)for(var C in Object(d))y.push(C);return y}var Fs=Go,xl=Object.prototype,ks=xl.hasOwnProperty;function Ho(d){if(!Gu(d))return Fs(d);var y=Cd(d),C=[];for(var F in d)F=="constructor"&&(y||!ks.call(d,F))||C.push(F);return C}var ss=Ho;function As(d){return Fh(d)?gc(d,!0):ss(d)}var Lo=As;function Pl(d,y){return d&&sa(y,Lo(y),d)}var $l=Pl,bu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hu=bu&&typeof module=="object"&&module&&!module.nodeType&&module,Du=Hu&&Hu.exports===bu,Ro=Du?er.Buffer:void 0,Kc=Ro?Ro.allocUnsafe:void 0;function lu(d,y){if(y)return d.slice();var C=d.length,F=Kc?Kc(C):new d.constructor(C);return d.copy(F),F}var Fa=lu;function Ts(d,y){var C=-1,F=d.length;for(y||(y=Array(F));++C<F;)y[C]=d[C];return y}var us=Ts;function Iu(d,y){return sa(d,vf(d),y)}var zh=Iu,rp=gf(Object.getPrototypeOf,Object),qt=rp,pn=Object.getOwnPropertySymbols,en=pn?function(d){for(var y=[];d;)Uu(y,vf(d)),d=qt(d);return y}:dc,ua=en;function ls(d,y){return sa(d,ua(d),y)}var Nt=ls;function Et(d){return pc(d,Lo,ua)}var gr=Et,Vr=Object.prototype,$r=Vr.hasOwnProperty;function wr(d){var y=d.length,C=new d.constructor(y);return y&&typeof d[0]=="string"&&$r.call(d,"index")&&(C.index=d.index,C.input=d.input),C}var ur=wr;function Lr(d){var y=new d.constructor(d.byteLength);return new nn(y).set(new nn(d)),y}var Zt=Lr;function lr(d,y){var C=y?Zt(d.buffer):d.buffer;return new d.constructor(C,d.byteOffset,d.byteLength)}var It=lr,Zr=/\w*$/;function Xr(d){var y=new d.constructor(d.source,Zr.exec(d));return y.lastIndex=d.lastIndex,y}var Rn=Xr,dn=Rr?Rr.prototype:void 0,Pn=dn?dn.valueOf:void 0;function vi(d){return Pn?Object(Pn.call(d)):{}}var Ea=vi;function ts(d,y){var C=y?Zt(d.buffer):d.buffer;return new d.constructor(C,d.byteOffset,d.length)}var ma=ts,uo="[object Boolean]",Do="[object Date]",Ys="[object Map]",Wl="[object Number]",bf="[object RegExp]",Iv="[object Set]",Bh="[object String]",Rp="[object Symbol]",ph="[object ArrayBuffer]",tv="[object DataView]",Td="[object Float32Array]",_v="[object Float64Array]",Lv="[object Int8Array]",gm="[object Int16Array]",rc="[object Int32Array]",wl="[object Uint8Array]",Nm="[object Uint8ClampedArray]",Yv="[object Uint16Array]",rv="[object Uint32Array]";function ym(d,y,C){var F=d.constructor;switch(y){case ph:return Zt(d);case uo:case Do:return new F(+d);case tv:return It(d,C);case Td:case _v:case Lv:case gm:case rc:case wl:case Nm:case Yv:case rv:return ma(d,C);case Ys:return new F;case Wl:case Bh:return new F(d);case bf:return Rn(d);case Iv:return new F;case Rp:return Ea(d)}}var Zm=ym,Rv=Object.create,Zd=function(){function d(){}return function(y){if(!Gu(y))return{};if(Rv)return Rv(y);d.prototype=y;var C=new d;return d.prototype=void 0,C}}(),pd=Zd;function _m(d){return typeof d.constructor=="function"&&!Cd(d)?pd(qt(d)):{}}var Jc=_m,Ii="[object Map]";function Ud(d){return xn(d)&&ri(d)==Ii}var cn=Ud,nv=Oc&&Oc.isMap,tg=nv?Ac(nv):cn,bv=tg,dd="[object Set]";function jd(d){return xn(d)&&ri(d)==dd}var rg=jd,Um=Oc&&Oc.isSet,yc=Um?Ac(Um):rg,iv=yc,L=1,i=2,s=4,l="[object Arguments]",p="[object Array]",S="[object Boolean]",A="[object Date]",I="[object Error]",U="[object Function]",q="[object GeneratorFunction]",re="[object Map]",de="[object Number]",we="[object Object]",Oe="[object RegExp]",Ge="[object Set]",it="[object String]",tt="[object Symbol]",ct="[object WeakMap]",ut="[object ArrayBuffer]",Je="[object DataView]",Pt="[object Float32Array]",Xt="[object Float64Array]",pr="[object Int8Array]",Ur="[object Int16Array]",tn="[object Int32Array]",An="[object Uint8Array]",xi="[object Uint8ClampedArray]",On="[object Uint16Array]",si="[object Uint32Array]",kn={};kn[l]=kn[p]=kn[ut]=kn[Je]=kn[S]=kn[A]=kn[Pt]=kn[Xt]=kn[pr]=kn[Ur]=kn[tn]=kn[re]=kn[de]=kn[we]=kn[Oe]=kn[Ge]=kn[it]=kn[tt]=kn[An]=kn[xi]=kn[On]=kn[si]=!0,kn[I]=kn[U]=kn[ct]=!1;function ci(d,y,C,F,J,ie){var me,ke=y&L,je=y&i,et=y&s;if(C&&(me=J?C(d,F,J,ie):C(d)),me!==void 0)return me;if(!Gu(d))return d;var bt=zo(d);if(bt){if(me=ur(d),!ke)return us(d,me)}else{var Mt=ri(d),sr=Mt==U||Mt==q;if(Fl(d))return Fa(d,ke);if(Mt==we||Mt==l||sr&&!J){if(me=je||sr?{}:Jc(d),!ke)return je?Nt(d,$l(me,d)):zh(d,Vo(me,d))}else{if(!kn[Mt])return J?d:{};me=Zm(d,Mt,ke)}}ie||(ie=new X);var Kt=ie.get(d);if(Kt)return Kt;ie.set(d,me),iv(d)?d.forEach(function(Ar){me.add(ci(Ar,y,C,Ar,d,ie))}):bv(d)&&d.forEach(function(Ar,jr){me.set(jr,ci(Ar,y,C,jr,d,ie))});var vr=et?je?gr:$v:je?Lo:tc,Sr=bt?void 0:vr(d);return Di(Sr||d,function(Ar,jr){Sr&&(jr=Ar,Ar=d[jr]),mo(me,jr,ci(Ar,y,C,jr,d,ie))}),me}var wi=ci,$n=1,Si=4;function Kn(d){return wi(d,$n|Si)}var la=Kn;function yn(d){"@babel/helpers - typeof";return yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},yn(d)}var Ti=["onCreated","source"],Aa=["data"],$o=["data"];function lo(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function Oo(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?lo(Object(C),!0).forEach(function(F){So(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):lo(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function So(d,y,C){return y=cs(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function cs(d){var y=Wo(d,"string");return yn(y)==="symbol"?y:String(y)}function Wo(d,y){if(yn(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(yn(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function Bo(d,y){if(d==null)return{};var C=Xo(d,y),F,J;if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(d);for(J=0;J<ie.length;J++)F=ie[J],!(y.indexOf(F)>=0)&&Object.prototype.propertyIsEnumerable.call(d,F)&&(C[F]=d[F])}return C}function Xo(d,y){if(d==null)return{};var C={},F=Object.keys(d),J,ie;for(ie=0;ie<F.length;ie++)J=F[ie],!(y.indexOf(J)>=0)&&(C[J]=d[J]);return C}var Au=function(y,C){var F=C.onCreated,J=C.source,ie=Bo(C,Ti),me=fl(),ke=(0,j.useRef)(),je=(0,j.useRef)(ie),et=(0,j.useRef)(J);return ke.current||(ke.current=new y(C),F&&ke.current.once("inited",function(){return F(ke.current)}),me.addLayer(ke.current)),sf(function(){if(ke.current){var bt=!ia(je.current,ie);bt&&(ke.current.update(ie),je.current=la(ie))}},[ie]),sf(function(){if(ke.current){var bt=J.data,Mt=Bo(J,Aa),sr=et.current,Kt=sr.data,vr=Bo(sr,$o),Sr=bt!==Kt||!ia(Mt,vr);Sr&&(ke.current.changeData(J),et.current=Oo({},J))}},[J]),(0,j.useEffect)(function(){return function(){ke.current&&(me.removeLayer(ke.current),ke.current=null)}},[]),ke},Wi={onRemove:"remove",onShow:"show",onHide:"hide",onDataUpdate:"dataUpdate",onLegend:"legend",onLegendColor:"legend:color",onLegendSize:"legend:size",onClick:"click",onUnClick:"unclick",onDblClick:"dblclick",onUndblclick:"undblclick",onContextMenu:"contextmenu",onUnContextMenu:"uncontextmenu",onMouseEnter:"mouseenter",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseUp:"mouseup",onMouseDown:"mousedown",onUnMousemove:"unmousemove",onUnMouseup:"unmouseup",onUnMousedown:"unmousedown",onUnPick:"unpick"},hs=function(y,C){var F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wi,J=(0,j.useMemo)(function(){return Object.keys(F)},[F]),ie=function(bt){J.forEach(function(Mt){var sr=F[Mt],Kt=C[Mt];Mt&&Kt&&y[bt](sr,Kt)})},me=function(){return ie("on")},ke=function(){return ie("off")},je=(0,j.useRef)(!0);je.current&&me(),(0,j.useEffect)(function(){return je.current?je.current=!1:me(),function(){ke()}},J.map(function(et){return C[et]})),af(function(){ke()})},Ba=null,bs=null,ms=null,Eo=function(d,y){return Eo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,F){C.__proto__=F}||function(C,F){for(var J in F)Object.prototype.hasOwnProperty.call(F,J)&&(C[J]=F[J])},Eo(d,y)};function gu(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");Eo(d,y);function C(){this.constructor=d}d.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}var fs=function(){return fs=Object.assign||function(y){for(var C,F=1,J=arguments.length;F<J;F++){C=arguments[F];for(var ie in C)Object.prototype.hasOwnProperty.call(C,ie)&&(y[ie]=C[ie])}return y},fs.apply(this,arguments)};function Cn(d,y){var C={};for(var F in d)Object.prototype.hasOwnProperty.call(d,F)&&y.indexOf(F)<0&&(C[F]=d[F]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var J=0,F=Object.getOwnPropertySymbols(d);J<F.length;J++)y.indexOf(F[J])<0&&Object.prototype.propertyIsEnumerable.call(d,F[J])&&(C[F[J]]=d[F[J]]);return C}function Ma(d,y,C,F){var J=arguments.length,ie=J<3?y:F===null?F=Object.getOwnPropertyDescriptor(y,C):F,me;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ie=Reflect.decorate(d,y,C,F);else for(var ke=d.length-1;ke>=0;ke--)(me=d[ke])&&(ie=(J<3?me(ie):J>3?me(y,C,ie):me(y,C))||ie);return J>3&&ie&&Object.defineProperty(y,C,ie),ie}function go(d,y){return function(C,F){y(C,F,d)}}function Na(d,y,C,F,J,ie){function me(jr){if(jr!==void 0&&typeof jr!="function")throw new TypeError("Function expected");return jr}for(var ke=F.kind,je=ke==="getter"?"get":ke==="setter"?"set":"value",et=!y&&d?F.static?d:d.prototype:null,bt=y||(et?Object.getOwnPropertyDescriptor(et,F.name):{}),Mt,sr=!1,Kt=C.length-1;Kt>=0;Kt--){var vr={};for(var Sr in F)vr[Sr]=Sr==="access"?{}:F[Sr];for(var Sr in F.access)vr.access[Sr]=F.access[Sr];vr.addInitializer=function(jr){if(sr)throw new TypeError("Cannot add initializers after decoration has completed");ie.push(me(jr||null))};var Ar=(0,C[Kt])(ke==="accessor"?{get:bt.get,set:bt.set}:bt[je],vr);if(ke==="accessor"){if(Ar===void 0)continue;if(Ar===null||typeof Ar!="object")throw new TypeError("Object expected");(Mt=me(Ar.get))&&(bt.get=Mt),(Mt=me(Ar.set))&&(bt.set=Mt),(Mt=me(Ar.init))&&J.unshift(Mt)}else(Mt=me(Ar))&&(ke==="field"?J.unshift(Mt):bt[je]=Mt)}et&&Object.defineProperty(et,F.name,bt),sr=!0}function v(d,y,C){for(var F=arguments.length>2,J=0;J<y.length;J++)C=F?y[J].call(d,C):y[J].call(d);return F?C:void 0}function c(d){return typeof d=="symbol"?d:"".concat(d)}function b(d,y,C){return typeof y=="symbol"&&(y=y.description?"[".concat(y.description,"]"):""),Object.defineProperty(d,"name",{configurable:!0,value:C?"".concat(C," ",y):y})}function k(d,y){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,y)}function z(d,y,C,F){function J(ie){return ie instanceof C?ie:new C(function(me){me(ie)})}return new(C||(C=Promise))(function(ie,me){function ke(bt){try{et(F.next(bt))}catch(Mt){me(Mt)}}function je(bt){try{et(F.throw(bt))}catch(Mt){me(Mt)}}function et(bt){bt.done?ie(bt.value):J(bt.value).then(ke,je)}et((F=F.apply(d,y||[])).next())})}function V(d,y){var C={label:0,sent:function(){if(ie[0]&1)throw ie[1];return ie[1]},trys:[],ops:[]},F,J,ie,me;return me={next:ke(0),throw:ke(1),return:ke(2)},typeof Symbol=="function"&&(me[Symbol.iterator]=function(){return this}),me;function ke(et){return function(bt){return je([et,bt])}}function je(et){if(F)throw new TypeError("Generator is already executing.");for(;me&&(me=0,et[0]&&(C=0)),C;)try{if(F=1,J&&(ie=et[0]&2?J.return:et[0]?J.throw||((ie=J.return)&&ie.call(J),0):J.next)&&!(ie=ie.call(J,et[1])).done)return ie;switch(J=0,ie&&(et=[et[0]&2,ie.value]),et[0]){case 0:case 1:ie=et;break;case 4:return C.label++,{value:et[1],done:!1};case 5:C.label++,J=et[1],et=[0];continue;case 7:et=C.ops.pop(),C.trys.pop();continue;default:if(ie=C.trys,!(ie=ie.length>0&&ie[ie.length-1])&&(et[0]===6||et[0]===2)){C=0;continue}if(et[0]===3&&(!ie||et[1]>ie[0]&&et[1]<ie[3])){C.label=et[1];break}if(et[0]===6&&C.label<ie[1]){C.label=ie[1],ie=et;break}if(ie&&C.label<ie[2]){C.label=ie[2],C.ops.push(et);break}ie[2]&&C.ops.pop(),C.trys.pop();continue}et=y.call(d,C)}catch(bt){et=[6,bt],J=0}finally{F=ie=0}if(et[0]&5)throw et[1];return{value:et[0]?et[1]:void 0,done:!0}}}var W=Object.create?function(d,y,C,F){F===void 0&&(F=C);var J=Object.getOwnPropertyDescriptor(y,C);(!J||("get"in J?!y.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return y[C]}}),Object.defineProperty(d,F,J)}:function(d,y,C,F){F===void 0&&(F=C),d[F]=y[C]};function ne(d,y){for(var C in d)C!=="default"&&!Object.prototype.hasOwnProperty.call(y,C)&&W(y,d,C)}function he(d){var y=typeof Symbol=="function"&&Symbol.iterator,C=y&&d[y],F=0;if(C)return C.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&F>=d.length&&(d=void 0),{value:d&&d[F++],done:!d}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")}function Se(d,y){var C=typeof Symbol=="function"&&d[Symbol.iterator];if(!C)return d;var F=C.call(d),J,ie=[],me;try{for(;(y===void 0||y-- >0)&&!(J=F.next()).done;)ie.push(J.value)}catch(ke){me={error:ke}}finally{try{J&&!J.done&&(C=F.return)&&C.call(F)}finally{if(me)throw me.error}}return ie}function Ne(){for(var d=[],y=0;y<arguments.length;y++)d=d.concat(Se(arguments[y]));return d}function We(){for(var d=0,y=0,C=arguments.length;y<C;y++)d+=arguments[y].length;for(var F=Array(d),J=0,y=0;y<C;y++)for(var ie=arguments[y],me=0,ke=ie.length;me<ke;me++,J++)F[J]=ie[me];return F}function ht(d,y,C){if(C||arguments.length===2)for(var F=0,J=y.length,ie;F<J;F++)(ie||!(F in y))&&(ie||(ie=Array.prototype.slice.call(y,0,F)),ie[F]=y[F]);return d.concat(ie||Array.prototype.slice.call(y))}function gt(d){return this instanceof gt?(this.v=d,this):new gt(d)}function St(d,y,C){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=C.apply(d,y||[]),J,ie=[];return J={},me("next"),me("throw"),me("return"),J[Symbol.asyncIterator]=function(){return this},J;function me(sr){F[sr]&&(J[sr]=function(Kt){return new Promise(function(vr,Sr){ie.push([sr,Kt,vr,Sr])>1||ke(sr,Kt)})})}function ke(sr,Kt){try{je(F[sr](Kt))}catch(vr){Mt(ie[0][3],vr)}}function je(sr){sr.value instanceof gt?Promise.resolve(sr.value.v).then(et,bt):Mt(ie[0][2],sr)}function et(sr){ke("next",sr)}function bt(sr){ke("throw",sr)}function Mt(sr,Kt){sr(Kt),ie.shift(),ie.length&&ke(ie[0][0],ie[0][1])}}function Ht(d){var y,C;return y={},F("next"),F("throw",function(J){throw J}),F("return"),y[Symbol.iterator]=function(){return this},y;function F(J,ie){y[J]=d[J]?function(me){return(C=!C)?{value:gt(d[J](me)),done:!1}:ie?ie(me):me}:ie}}function ir(d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d[Symbol.asyncIterator],C;return y?y.call(d):(d=typeof he=="function"?he(d):d[Symbol.iterator](),C={},F("next"),F("throw"),F("return"),C[Symbol.asyncIterator]=function(){return this},C);function F(ie){C[ie]=d[ie]&&function(me){return new Promise(function(ke,je){me=d[ie](me),J(ke,je,me.done,me.value)})}}function J(ie,me,ke,je){Promise.resolve(je).then(function(et){ie({value:et,done:ke})},me)}}function fr(d,y){return Object.defineProperty?Object.defineProperty(d,"raw",{value:y}):d.raw=y,d}var Gr=Object.create?function(d,y){Object.defineProperty(d,"default",{enumerable:!0,value:y})}:function(d,y){d.default=y};function Tr(d){if(d&&d.__esModule)return d;var y={};if(d!=null)for(var C in d)C!=="default"&&Object.prototype.hasOwnProperty.call(d,C)&&W(y,d,C);return Gr(y,d),y}function Jr(d){return d&&d.__esModule?d:{default:d}}function wn(d,y,C,F){if(C==="a"&&!F)throw new TypeError("Private accessor was defined without a getter");if(typeof y=="function"?d!==y||!F:!y.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return C==="m"?F:C==="a"?F.call(d):F?F.value:y.get(d)}function ii(d,y,C,F,J){if(F==="m")throw new TypeError("Private method is not writable");if(F==="a"&&!J)throw new TypeError("Private accessor was defined without a setter");if(typeof y=="function"?d!==y||!J:!y.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return F==="a"?J.call(d,C):J?J.value=C:y.set(d,C),C}function da(d,y){if(y===null||typeof y!="object"&&typeof y!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof d=="function"?y===d:d.has(y)}function $a(d,y,C){if(y!=null){if(typeof y!="object"&&typeof y!="function")throw new TypeError("Object expected.");var F;if(C){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");F=y[Symbol.asyncDispose]}if(F===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");F=y[Symbol.dispose]}if(typeof F!="function")throw new TypeError("Object not disposable.");d.stack.push({value:y,dispose:F,async:C})}else C&&d.stack.push({async:!0});return y}var fa=typeof SuppressedError=="function"?SuppressedError:function(d,y,C){var F=new Error(C);return F.name="SuppressedError",F.error=d,F.suppressed=y,F};function ra(d){function y(F){d.error=d.hasError?new fa(F,d.error,"An error was suppressed during disposal."):F,d.hasError=!0}function C(){for(;d.stack.length;){var F=d.stack.pop();try{var J=F.dispose&&F.dispose.call(F.value);if(F.async)return Promise.resolve(J).then(C,function(ie){return y(ie),C()})}catch(ie){y(ie)}}if(d.hasError)throw d.error}return C()}var Xi={__extends:gu,__assign:fs,__rest:Cn,__decorate:Ma,__param:go,__metadata:k,__awaiter:z,__generator:V,__createBinding:W,__exportStar:ne,__values:he,__read:Se,__spread:Ne,__spreadArrays:We,__spreadArray:ht,__await:gt,__asyncGenerator:St,__asyncDelegator:Ht,__asyncValues:ir,__makeTemplateObject:fr,__importStar:Tr,__importDefault:Jr,__classPrivateFieldGet:wn,__classPrivateFieldSet:ii,__classPrivateFieldIn:da,__addDisposableResource:$a,__disposeResources:ra},ga={}.toString,qi=function(d,y){return ga.call(d)==="[object "+y+"]"},Ei=qi,Wa=function(d){return Ei(d,"Function")},Ta=function(d){return Array.isArray?Array.isArray(d):Ei(d,"Array")},gs=function(d){var y=typeof d;return d!==null&&y==="object"||y==="function"};function gl(d,y){if(d){var C;if(Ta(d))for(var F=0,J=d.length;F<J&&(C=y(d[F],F),C!==!1);F++);else if(gs(d)){for(var ie in d)if(d.hasOwnProperty(ie)&&(C=y(d[ie],ie),C===!1))break}}}var Sl=gl,zc=Object.keys?function(d){return Object.keys(d)}:function(d){var y=[];return Sl(d,function(C,F){Wa(d)&&F==="prototype"||y.push(F)}),y},Dp=null;function Op(d,y){var C=keys(y),F=C.length;if(isNil(d))return!F;for(var J=0;J<F;J+=1){var ie=C[J];if(y[ie]!==d[ie]||!(ie in d))return!1}return!0}var dh=null,Jh=function(d){return typeof d=="object"&&d!==null},Nh=Jh,vh=function(d){if(!Nh(d)||!Ei(d,"Object"))return!1;if(Object.getPrototypeOf(d)===null)return!0;for(var y=d;Object.getPrototypeOf(y)!==null;)y=Object.getPrototypeOf(y);return Object.getPrototypeOf(d)===y},nc=vh;function Us(d,y){if(!isArray(d))return null;var C;if(isFunction(y)&&(C=y),isPlainObject(y)&&(C=function(J){return isMatch(J,y)}),C){for(var F=0;F<d.length;F+=1)if(C(d[F]))return d[F]}return null}var zs=null,Fp=function(d,y){for(var C=null,F=0;F<d.length;F++){var J=d[F],ie=J[y];if(!isNil(ie)){isArray(ie)?C=ie[0]:C=ie;break}}return C},Zh=null,Bf=function(d){if(!isArray(d))return[];for(var y=[],C=0;C<d.length;C++)y=y.concat(d[C]);return y},zp=null,np=function(d,y){if(y===void 0&&(y=[]),!isArray(d))y.push(d);else for(var C=0;C<d.length;C+=1)np(d[C],y);return y},ic=null,yu=function(d){if(isArray(d))return d.reduce(function(y,C){return Math.max(y,C)},d[0])},xf=function(d){if(isArray(d))return d.reduce(function(y,C){return Math.min(y,C)},d[0])},yo=function(d){var y=d.filter(function(me){return!isNaN(me)});if(!y.length)return{min:0,max:0};if(isArray(d[0])){for(var C=[],F=0;F<d.length;F++)C=C.concat(d[F]);y=C}var J=getMax(y),ie=getMin(y);return{min:ie,max:J}},ro=null,Bp=Array.prototype,av=Bp.splice,Np=Bp.indexOf,qv=function(d){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];for(var F=0;F<y.length;F++)for(var J=y[F],ie=-1;(ie=Np.call(d,J))>-1;)av.call(d,ie,1);return d},ov=null,Md=Array.prototype.splice,vd=function(y,C){if(!isArrayLike(y))return[];for(var F=y?C.length:0,J=F-1;F--;){var ie=void 0,me=C[F];(F===J||me!==ie)&&(ie=me,Md.call(y,me,1))}return y},Kv=null,Ep=function(d,y,C){if(!Ta(d)&&!nc(d))return d;var F=C;return Sl(d,function(J,ie){F=y(F,J,ie)}),F},xg=Ep,y0=function(d,y){var C=[];if(!isArrayLike(d))return C;for(var F=-1,J=[],ie=d.length;++F<ie;){var me=d[F];y(me,F,d)&&(C.push(me),J.push(F))}return pullAt(d,J),C},xv=null,Cp=function(d){return Ei(d,"String")};function W0(d,y){var C;if(isFunction(y))C=function(J,ie){return y(J)-y(ie)};else{var F=[];isString(y)?F.push(y):isArray(y)&&(F=y),C=function(J,ie){for(var me=0;me<F.length;me+=1){var ke=F[me];if(J[ke]>ie[ke])return 1;if(J[ke]<ie[ke])return-1}return 0}}return d.sort(C),d}var bm=null,wg=function(d,y){for(var C=[],F={},J=0;J<d.length;J++){var ie=d[J],me=ie[y];if(!isNil(me)){isArray(me)||(me=[me]);for(var ke=0;ke<me.length;ke++){var je=me[ke];F[je]||(C.push(je),F[je]=!0)}}}return C};function Sg(d,y){return isArray(d)||isString(d)?d[0]===y:!1}var Eg=null;function Cg(d,y){return isArray(d)||isString(d)?d[d.length-1]===y:!1}var Xy=null,X0=Object.prototype.hasOwnProperty;function Yy(d,y){if(!y||!isArray(d))return{};for(var C={},F=isFunction(y)?y:function(ke){return ke[y]},J,ie=0;ie<d.length;ie++){var me=d[ie];J=F(me),X0.call(C,J)?C[J].push(me):C[J]=[me]}return C}var qy=null;function sv(d,y){if(!y)return{0:d};if(!isFunction(y)){var C=isArray(y)?y:y.replace(/\s+/g,"").split("*");y=function(F){for(var J="_",ie=0,me=C.length;ie<me;ie++)J+=F[C[ie]]&&F[C[ie]].toString();return J}}return groupBy(d,y)}var Ag=function(d,y){if(!y)return[d];var C=groupToMap(d,y),F=[];for(var J in C)F.push(C[J]);return F},wv={};function Ky(d){var y=wv[d];if(!y){for(var C=d.toString(16),F=C.length;F<6;F++)C="0"+C;y="#"+C,wv[d]=y}return y}var Jv=null;function Y0(d){var y=0,C=0,F=0,J=0;return isArray(d)?d.length===1?y=C=F=J=d[0]:d.length===2?(y=F=d[0],C=J=d[1]):d.length===3?(y=d[0],C=J=d[1],F=d[2]):(y=d[0],C=d[1],F=d[2],J=d[3]):y=C=F=J=d,{r1:y,r2:C,r3:F,r4:J}}var Zp=null,md=function(d){return Ei(d,"Number")},Qv=md,Sv=function(d){return isNumber(d)&&d%1!==0},xm=null,Dv=function(d){return isNumber(d)&&d%2===0},q0=null,bx=Number.isInteger?Number.isInteger:function(d){return Qv(d)&&d%1===0},Jy=null,dE=function(d){return isNumber(d)&&d<0},xx=null,vE=function(d){return isNumber(d)&&d%2!==0},Qy=null,Sx=function(d){return isNumber(d)&&d>0},o_=null,s_=function(d,y){if(isArray(d)){for(var C,F=-1/0,J=0;J<d.length;J++){var ie=d[J],me=isFunction(y)?y(ie):ie[y];me>F&&(C=ie,F=me)}return C}},gd=function(d,y){if(isArray(d)){for(var C,F=1/0,J=0;J<d.length;J++){var ie=d[J],me=isFunction(y)?y(ie):ie[y];me<F&&(C=ie,F=me)}return C}},jm=180/Math.PI,u_=function(d){return jm*d},em=null,Yg=Math.PI/180,K0=function(d){return Yg*d},qg=null,l_=null,mE=Object.values?function(d){return Object.values(d)}:function(d){var y=[];return Sl(d,function(C,F){Wa(d)&&F==="prototype"||y.push(C)}),y},Ex=mE,gE=function(d,y){return contains(values(d),y)},yE={}.toString,xP=function(d){return yE.call(d).replace(/^\[object /,"").replace(/]$/,"")},wP=null,SP=function(d){return isType(d,"Arguments")},e1=null,Vd=function(d){return Ei(d,"Boolean")},Cx=Vd,_E=function(d){return isType(d,"Date")},bE=null,Ax=function(d){return isType(d,"Error")},xE=null;function EP(d){return isNumber(d)&&isFinite(d)}var wE=Object.prototype,CP=function(d){var y=d&&d.constructor,C=typeof y=="function"&&y.prototype||wE;return d===C},AP=null,TP=function(d){return isType(d,"RegExp")},MP=null,SE=function(d){return d===void 0},Ke=SE,EE=function(){for(var d=[],y=0;y<arguments.length;y++)d[y]=arguments[y];for(var C=d[0],F=1;F<d.length;F++){var J=d[F];isFunction(J)&&(J=J.prototype),mix(C.prototype,J)}},CE=null,t1=function(d){if(typeof d!="object"||d===null)return d;var y;if(Ta(d)){y=[];for(var C=0,F=d.length;C<F;C++)typeof d[C]=="object"&&d[C]!=null?y[C]=t1(d[C]):y[C]=d[C]}else{y={};for(var J in d)typeof d[J]=="object"&&d[J]!=null?y[J]=t1(d[J]):y[J]=d[J]}return y},r1=t1,Tx=function(d,y){if(!Wa(d))throw new TypeError("Expected a function");var C=function(){for(var F=[],J=0;J<arguments.length;J++)F[J]=arguments[J];var ie=y?y.apply(this,F):F[0],me=C.cache;if(me.has(ie))return me.get(ie);var ke=d.apply(this,F);return me.set(ie,ke),ke};return C.cache=new Map,C},Mx=5;function c_(d,y,C,F){C=C||0,F=F||Mx;for(var J in y)if(y.hasOwnProperty(J)){var ie=y[J];ie!==null&&nc(ie)?(nc(d[J])||(d[J]={}),C<F?c_(d[J],ie,C+1,F):d[J]=y[J]):Ta(ie)?(d[J]=[],d[J]=d[J].concat(ie)):ie!==void 0&&(d[J]=ie)}}var Kg=function(d){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];for(var F=0;F<y.length;F+=1)c_(d,y[F]);return d},Px=Kg,AE=function(d,y,C,F){isFunction(y)||(C=y,y=d,d=function(){});var J=Object.create?function(me,ke){return Object.create(me,{constructor:{value:ke}})}:function(me,ke){function je(){}je.prototype=me;var et=new je;return et.constructor=ke,et},ie=J(y.prototype,d);return d.prototype=mix(ie,d.prototype),d.superclass=J(y.prototype,y),mix(ie,C),mix(d,F),d},TE=null,kx=Object.prototype.hasOwnProperty;function ME(d){if(isNil(d))return!0;if(isArrayLike(d))return!d.length;var y=getType(d);if(y==="Map"||y==="Set")return!d.size;if(isPrototype(d))return!Object.keys(d).length;for(var C in d)if(kx.call(d,C))return!1;return!0}var PP=null,PE=function(d){return d!==null&&typeof d!="function"&&isFinite(d.length)},h_=PE,n1=function(d,y){if(d===y)return!0;if(!d||!y||Cp(d)||Cp(y))return!1;if(h_(d)||h_(y)){if(d.length!==y.length)return!1;for(var C=!0,F=0;F<d.length&&(C=n1(d[F],y[F]),!!C);F++);return C}if(Nh(d)||Nh(y)){var J=Object.keys(d),ie=Object.keys(y);if(J.length!==ie.length)return!1;for(var C=!0,F=0;F<J.length&&(C=n1(d[J[F]],y[J[F]]),!!C);F++);return C}return!1},ng=n1,kE=function(d,y,C){return isFunction(C)?!!C(d,y):isEqual(d,y)},IE=function(d,y,C){for(var F=0,J=isString(y)?y.split("."):y;d&&F<J.length;)d=d[J[F++]];return d===void 0||F<J.length?C:d},i1=function(d,y,C){var F=d,J=isString(y)?y.split("."):y;return J.forEach(function(ie,me){me<J.length-1?(isObject(F[ie])||(F[ie]=isNumber(J[me+1])?[]:{}),F=F[ie]):F[ie]=C}),d},Ix=Object.prototype.hasOwnProperty,LE=function(d,y){if(d===null||!isPlainObject(d))return{};var C={};return each(y,function(F){Ix.call(d,F)&&(C[F]=d[F])}),C},f_=function(d,y){return xg(d,function(C,F,J){return y.includes(J)||(C[J]=F),C},{})},_0={},p_=function(d){return d=d||"g",_0[d]?_0[d]+=1:_0[d]=1,d+_0[d]},J0,kP=Tx(function(d,y){y===void 0&&(y={});var C=y.fontSize,F=y.fontFamily,J=y.fontWeight,ie=y.fontStyle,me=y.fontVariant;return J0||(J0=document.createElement("canvas").getContext("2d")),J0.font=[ie,me,J,C+"px",F].join(" "),J0.measureText(Cp(d)?d:"").width},function(d,y){return y===void 0&&(y={}),We([d],Ex(y)).join("")}),IP=function(d,y,C,F){F===void 0&&(F="...");var J=16,ie=measureTextWidth(F,C),me=isString(d)?d:toString(d),ke=y,je=[],et,bt;if(measureTextWidth(d,C)<=y)return d;for(;et=me.substr(0,J),bt=measureTextWidth(et,C),!(bt+ie>ke&&bt>ke);)if(je.push(et),ke-=bt,me=me.substr(J),!me)return je.join("");for(;et=me.substr(0,1),bt=measureTextWidth(et,C),!(bt+ie>ke);)if(je.push(et),ke-=bt,me=me.substr(1),!me)return je.join("");return""+je.join("")+F},RE=function(){function d(){this.map={}}return d.prototype.has=function(y){return this.map[y]!==void 0},d.prototype.get=function(y,C){var F=this.map[y];return F===void 0?C:F},d.prototype.set=function(y,C){this.map[y]=C},d.prototype.clear=function(){this.map={}},d.prototype.delete=function(y){delete this.map[y]},d.prototype.size=function(){return Object.keys(this.map).length},d}(),LP=null;function Uh(d,y){return function(){for(var C=[],F=0;F<arguments.length;F++)C[F]=arguments[F];var J={};return d.forEach(function(ie,me){J[ie]=C[me]}),delete J.undefined,y(J)}}var DE=function(){function d(){}return d.shape=function(y,C){if(Cp(C))y.shape(C);else if(Wa(C)){var F=[];y.shape(F.join("*"),Uh(F,C))}else if(gs(C)){var J=C.field?C.field:"";if(Wa(C.value)){var F=Ta(J)?J:J.split("*");y.shape(J,Uh(F,C.value))}else y.shape(J,C.value);Cp(J)&&C.scale&&d.scale(y,J,C.scale)}},d.size=function(y,C){if(Qv(C))y.size(C);else if(Ta(C))y.size(C);else if(Wa(C)){var F=[];y.size(F.join("*"),Uh(F,C))}else if(gs(C)){var J=C.field?C.field:"";if(Wa(C.value)){var F=Ta(J)?J:J.split("*");y.size(J,Uh(F,C.value))}else y.size(J,C.value);Cp(J)&&C.scale&&d.scale(y,J,C.scale)}},d.color=function(y,C){if(Cp(C))y.color(C);else if(Wa(C)){var F=[];y.color(F.join("*"),Uh(F,C))}else if(gs(C)){var J=C.field?C.field:"";if(Wa(C.value)){var F=Ta(J)?J:J.split("*");y.color(J,Uh(F,C.value))}else y.color(J,C.value);Cp(J)&&C.scale&&d.scale(y,J,C.scale)}},d.scale=function(y,C,F){y.scale(C,F)},d.rotate=function(y,C){Cp(C)||Wa(C)||gs(C)},d.texture=function(y,C){Cp(C)&&y.texture(C)},d.animate=function(y,C){(Cx(C)||gs(C))&&y.animate(C)},d.filter=function(y,C){var F=C.field?C.field:"",J=Ta(F)?F:F.split("*");y.filter(J.join("*"),Uh(J,C.value))},d.style=function(y,C){C&&y.style(C)},d.state=function(y,C){var F=C.active,J=C.select;F&&y.active(F),J&&y.select(J)},d}(),a1=function(d,y){var C=d.source,F=Cn(d,["source"]),J=y.source,ie=Cn(y,["source"]),me=fs({},Px({},F,ie));return J instanceof K.Source?me.source=J:C instanceof K.Source?me.source=C:me.source=fs(fs({},C),J),me},Lx=function(d,y){if(d instanceof K.Source&&y instanceof K.Source)return d!==y;var C=d.data,F=Cn(d,["data"]),J=y.data,ie=Cn(y,["data"]),me=C!==J||!ng(F,ie);return me},OE=["click","dblclick","unclick","undblclick","contextmenu","uncontextmenu","mouseenter","unmouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","unpick"],Vm=ht(["show","hide","dataUpdate","destroy","legend","legend:color","legend:size"],Se(OE),!1),ig;(function(d){d.CREATED="created",d.INITED="inited",d.ADD="add",d.REMOVE="remove"})(ig||(ig={}));var Gm;(function(d){d.CREATED="created",d.INITED="inited",d.ADD="add",d.REMOVE="remove"})(Gm||(Gm={}));var Tg;(function(d){d.INITED_LAYER="inited-layer",d.INITED_LAYERS="inited-layers"})(Tg||(Tg={}));var Q0=function(d){gu(y,d);function y(C){var F=d.call(this)||this;F.isComposite=!1;var J=C.id,ie=C.name,me=C.source,ke=C.interaction,je=ke===void 0?!1:ke;return F.id=J||p_("core-layer"),F.name=ie||F.id,F.interaction=je,F.options=a1(F.getDefaultOptions(),C),F.lastOptions=F.options,F.layer=F.createLayer(),F.adaptorLayerAttr(!1),F.setSource(me),F.emit(ig.CREATED,F),F}return Object.defineProperty(y.prototype,"inited",{get:function(){return this.layer.inited},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"source",{get:function(){return this.layer.getSource()},enumerable:!1,configurable:!0}),y.prototype.getDefaultOptions=function(){return y.DefaultOptions},y.prototype.getLayerConfig=function(){var C=f_(this.options,["source","shape","color","size","scale","texture","style","animate","state"]);return C},y.prototype.adaptorAttrOptions=function(C){return C},y.prototype.adaptorLayerAttr=function(C){C===void 0&&(C=!0);for(var F=["shape","color","size","scale","texture","filter","style","animate","state"],J=this.adaptorAttrOptions(this.options),ie=this.adaptorAttrOptions(this.lastOptions),me=0;me<F.length;me++){var ke=F[me],je=J[ke],et=ie[ke];!Ke(je)&&(!C||!ng(je,et))&&DE[ke](this.layer,je)}},y.prototype.setSource=function(C){if(C instanceof K.Source)this.layer.setSource(C);else{var F=C.data,J=Cn(C,["data"]),ie=this.layer.getSource();ie?this.layer.setData(F,J):this.layer.source(F,J)}},y.prototype.getSource=function(){return this.source},y.prototype.addTo=function(C){var F=this;this.scene=C,this.layer.once(ig.INITED,function(){F.emit(ig.INITED,F)}),this.layer.once(ig.ADD,function(){F.emit(ig.ADD,F)}),C.addLayer(this.layer)},y.prototype.remove=function(){this.scene&&(this.scene.removeLayer(this.layer),this.emit(ig.REMOVE))},y.prototype.update=function(C,F){var J,ie;F===void 0&&(F=!0),this.updateOption(C),this.updateConfig(C),F&&((J=this.scene)===null||J===void 0||J.setEnableRender(!1)),(Ke(this.options.visible)||this.options.visible)&&this.adaptorLayerAttr(),C.source&&Lx(C.source,this.lastOptions.source)&&this.changeData(C.source),F&&((ie=this.scene)===null||ie===void 0||ie.setEnableRender(!0),this.render())},y.prototype.updateOption=function(C){this.lastOptions=this.options,this.options=a1(this.options,C)},y.prototype.updateConfig=function(C){!Ke(C.zIndex)&&!ng(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(C.zIndex),!Ke(C.blend)&&!ng(this.lastOptions.blend,this.options.blend)&&this.setBlend(C.blend),!Ke(C.minZoom)&&!ng(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(C.minZoom),!Ke(C.maxZoom)&&!ng(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMaxZoom(C.maxZoom),!Ke(C.visible)&&!ng(this.lastOptions.visible,this.options.visible)&&(C.visible?this.show():this.hide())},y.prototype.render=function(){this.scene&&this.scene.render()},y.prototype.changeData=function(C){this.setSource(C)},y.prototype.setIndex=function(C){this.layer.setIndex(C)},y.prototype.setBlend=function(C){this.layer.setBlend(C)},y.prototype.setMinZoom=function(C){this.layer.setMinZoom(C)},y.prototype.setMaxZoom=function(C){this.layer.setMaxZoom(C)},y.prototype.show=function(){this.layer.inited&&this.layer.show()},y.prototype.hide=function(){this.layer.inited&&this.layer.hide()},y.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},y.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():Ke(this.options.visible)?!0:this.options.visible},y.prototype.boxSelect=function(C,F){this.layer.boxSelect(C,F)},y.prototype.fitBounds=function(C){this.layer.fitBounds(C)},y.prototype.getLegend=function(C){return this.layer.getLegend(C)},y.prototype.getLegendItems=function(C){return this.layer.getLegendItems(C)},y.prototype.on=function(C,F,J){return Vm.indexOf(C)!==-1?this.layer.on(C,F):d.prototype.on.call(this,C,F,J),this},y.prototype.once=function(C,F){return Vm.indexOf(C)!==-1?this.layer.once(C,F):d.prototype.once.call(this,C,F),this},y.prototype.off=function(C,F){return Vm.indexOf(C)!==-1?this.layer.off(C,F):d.prototype.off.call(this,C,F),this},y.prototype.destroy=function(){this.layer.destroy()},y.DefaultOptions={},y}(po),o1=function(d){gu(y,d);function y(){var C=d!==null&&d.apply(this,arguments)||this;return C.type="pointLayer",C}return y.prototype.createLayer=function(){var C=this.getLayerConfig(),F=new K.PointLayer(C);return F},y}(Q0),FE=(0,j.memo)((0,j.forwardRef)(function(y,C){var F=Au(o1,y);return hs(F.current,y),(0,j.useImperativeHandle)(C,function(){return F.current}),null})),zE=function(d){gu(y,d);function y(){var C=d!==null&&d.apply(this,arguments)||this;return C.type="polygonLayer",C}return y.prototype.createLayer=function(){var C=this.getLayerConfig(),F=new K.PolygonLayer(C);return F},y}(Q0),d_=(0,j.memo)((0,j.forwardRef)(function(y,C){var F=Au(zE,y);return hs(F.current,y),(0,j.useImperativeHandle)(C,function(){return F.current}),null})),Rx=null,Dx=null,v_=Object.assign(Wi,{onSelect:"select",onUnselect:"unselect"}),m_=null,Ox=Object.assign(Wi,{onSelect:"select",onUnselect:"unselect"}),Fx=null,g_={onRemove:Wi.onRemove,onShow:Wi.onShow,onHide:Wi.onHide,onDataUpdate:Wi.onDataUpdate,onLegend:Wi.onLegend,onLegendColor:Wi.onLegendColor,onLegendSize:Wi.onLegendSize,onCircleLayerClick:"circleLayer:"+Wi.onClick,onCircleLayerUnClick:"circleLayer:"+Wi.onUnClick,onCircleLayerDblClick:"circleLayer:"+Wi.onDblClick,onCircleLayerUndblclick:"circleLayer:"+Wi.onUndblclick,onCircleLayerContextMenu:"circleLayer:"+Wi.onContextMenu,onCircleLayerUnContextMenu:"circleLayer:"+Wi.onUnContextMenu,onCircleLayerMouseEnter:"circleLayer:"+Wi.onMouseEnter,onCircleLayerMouseMove:"circleLayer:"+Wi.onMouseMove,onCircleLayerMouseOut:"circleLayer:"+Wi.onMouseOut,onCircleLayerMouseUp:"circleLayer:"+Wi.onMouseUp,onCircleLayerMouseDown:"circleLayer:"+Wi.onMouseDown,onCircleLayerUnMousemove:"circleLayer:"+Wi.onUnMousemove,onCircleLayerUnMouseup:"circleLayer:"+Wi.onUnMouseup,onCircleLayerUnMousedown:"circleLayer:"+Wi.onUnMousedown,onCircleLayerUnPick:"circleLayer:"+Wi.onUnPick,onLineLayerClick:"lineLayer:"+Wi.onClick,onLineLayerUnClick:"lineLayer:"+Wi.onUnClick,onLineLayerDblClick:"lineLayer:"+Wi.onDblClick,onLineLayerUndblclick:"lineLayer:"+Wi.onUndblclick,onLineLayerContextMenu:"lineLayer:"+Wi.onContextMenu,onLineLayerUnContextMenu:"lineLayer:"+Wi.onUnContextMenu,onLineLayerMouseEnter:"lineLayer:"+Wi.onMouseEnter,onLineLayerMouseMove:"lineLayer:"+Wi.onMouseMove,onLineLayerMouseOut:"lineLayer:"+Wi.onMouseOut,onLineLayerMouseUp:"lineLayer:"+Wi.onMouseUp,onLineLayerMouseDown:"lineLayer:"+Wi.onMouseDown,onLineLayerUnMousemove:"lineLayer:"+Wi.onUnMousemove,onLineLayerUnMouseup:"lineLayer:"+Wi.onUnMouseup,onLineLayerUnMousedown:"lineLayer:"+Wi.onUnMousedown,onLineLayerUnPick:"lineLayer:"+Wi.onUnPick},s1=null,Ov=null,ey;(function(d){d.BubbleLayer="bubbleLayer",d.ChoroplethLayer="choroplethLayer",d.IconImageLayer="iconImageLayer",d.IconFontLayer="iconFontLayer",d.FlowLayer="flowLayer"})(ey||(ey={}));var y_=function(d){gu(y,d);function y(C,F){C===void 0&&(C=[]),F===void 0&&(F={});var J=d.call(this)||this;J.layerMap=new Map,J.name=F.name?F.name:p_("layerGroup");for(var ie=0;ie<C.length;ie++){var me=C[ie];J.addLayer(me)}return J}return y.prototype.addTo=function(C){var F,J,ie=this;this.scene=C;var me=0,ke=this.layerMap.size;try{for(var je=he(this.layerMap.values()),et=je.next();!et.done;et=je.next()){var bt=et.value;bt.once("inited",function(Mt){me++,ie.emit(Tg.INITED_LAYER,Mt),me===ke&&ie.emit(Tg.INITED_LAYERS)}),bt.addTo(C)}}catch(Mt){F={error:Mt}}finally{try{et&&!et.done&&(J=je.return)&&J.call(je)}finally{if(F)throw F.error}}},y.prototype.remove=function(){this.scene&&this.getLayers().forEach(function(C){return C.remove()})},y.prototype.hasLayer=function(C){var F=typeof C=="string"?C:this.getLayerId(C);return this.layerMap.has(F)},y.prototype.addLayer=function(C){var F=this,J=this.getLayerId(C);this.layerMap.set(J,C),this.scene&&(C.once("inited",function(ie){return F.emit(Tg.INITED_LAYER,ie)}),C.addTo(this.scene))},y.prototype.addLayers=function(C){var F=this;C.forEach(function(J){F.addLayer(J)})},y.prototype.removeLayer=function(C){var F=typeof C=="string"?C:this.getLayerId(C),J=this.layerMap.get(F);return J?(this.layerMap.delete(F),this.scene&&J.remove(),!0):!1},y.prototype.getLayers=function(){return Array.from(this.layerMap.values())},y.prototype.getLayer=function(C){return this.layerMap.get(C)},y.prototype.getLayerByName=function(C){return this.getLayers().find(function(F){return F.name===C})},y.prototype.removeAllLayer=function(){var C,F;try{for(var J=he(this.layerMap.values()),ie=J.next();!ie.done;ie=J.next()){var me=ie.value;this.scene&&me.remove()}}catch(ke){C={error:ke}}finally{try{ie&&!ie.done&&(F=J.return)&&F.call(J)}finally{if(C)throw C.error}}this.layerMap.clear()},y.prototype.isEmpty=function(){return this.layerMap.size===0},y.prototype.setZIndex=function(C){var F,J;try{for(var ie=he(this.layerMap.values()),me=ie.next();!me.done;me=ie.next()){var ke=me.value;ke.setIndex(C)}}catch(je){F={error:je}}finally{try{me&&!me.done&&(J=ie.return)&&J.call(ie)}finally{if(F)throw F.error}}},y.prototype.getLayerId=function(C){return C.id},y.prototype.destroy=function(){this.remove(),this.off("*")},y}(po),Hm=function(d){gu(y,d);function y(C){var F=d.call(this)||this;F.isComposite=!0;var J=C.id,ie=C.name;F.id=J||p_("composite-layer"),F.name=ie||F.id,F.options=a1(F.getDefaultOptions(),C),F.lastOptions=F.options,F.source=F.createSource();var me=F.createSubLayers();return F.subLayers=new y_(me),F.emit(Gm.CREATED,F),F}return y.prototype.getDefaultOptions=function(){return y.DefaultOptions},y.prototype.createSource=function(){var C=this.options.source,F=C.data,J=Cn(C,["data"]),ie=this.isSourceInstance(C)?C:new K.Source(F,J);return ie},y.prototype.isSourceInstance=function(C){return C instanceof K.Source},y.prototype.setSubLayersSource=function(C){this.layer.changeData(C)},y.prototype.initSubLayersEvent=function(){},y.prototype.addTo=function(C){var F=this;this.scene=C,this.subLayers.once(Tg.INITED_LAYERS,function(){F.emit(Gm.INITED,F),F.emit(Gm.ADD,F)}),this.subLayers.addTo(C)},y.prototype.remove=function(){this.scene&&(this.subLayers.remove(),this.emit(Gm.REMOVE))},y.prototype.update=function(C,F){var J,ie;F===void 0&&(F=!0),this.updateOption(C),F&&((J=this.scene)===null||J===void 0||J.setEnableRender(!1)),C.source&&Lx(C.source,this.lastOptions.source)&&this.changeData(C.source),this.updateSubLayers(C),F&&((ie=this.scene)===null||ie===void 0||ie.setEnableRender(!0),this.render())},y.prototype.updateOption=function(C){this.lastOptions=this.options,this.options=a1(this.options,C)},y.prototype.render=function(){this.scene&&this.scene.render()},y.prototype.changeData=function(C){this.setSubLayersSource(C)},y.prototype.setIndex=function(C){this.subLayers.setZIndex(C)},y.prototype.setBlend=function(C){this.layer.setBlend(C)},y.prototype.setMinZoom=function(C){this.subLayers.getLayers().forEach(function(F){F.setMinZoom(C)})},y.prototype.setMaxZoom=function(C){this.subLayers.getLayers().forEach(function(F){F.setMaxZoom(C)})},y.prototype.show=function(){this.layer.inited&&this.update({visible:!0})},y.prototype.hide=function(){this.layer.inited&&this.update({visible:!1})},y.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},y.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():Ke(this.options.visible)?!0:this.options.visible},y.prototype.boxSelect=function(C,F){this.layer.boxSelect(C,F)},y.prototype.fitBounds=function(C){this.layer.fitBounds(C)},y.prototype.getLegend=function(C){return this.layer.getLegend(C)},y.prototype.getLegendItems=function(C){return this.layer.getLegendItems(C)},y.prototype.getColorLegendItems=function(){var C=this.layer.getLegendItems("color");if(Array.isArray(C)&&C.length!==0){var F=C;return F}return[]},y.prototype.getInteractionSubLayers=function(){var C=this.subLayers.getLayers().filter(function(F){return F.interaction===!0});return C},y.prototype.destroy=function(){this.subLayers.destroy()},y.prototype.on=function(C,F,J){return Vm.indexOf(C)!==-1?this.layer.on(C,F):d.prototype.on.call(this,C,F,J),this},y.prototype.once=function(C,F){return Vm.indexOf(C)!==-1?this.layer.once(C,F):d.prototype.once.call(this,C,F),this},y.prototype.off=function(C,F){return Vm.indexOf(C)!==-1?this.layer.off(C,F):d.prototype.off.call(this,C,F),this},y.LayerType=ey,y.DefaultOptions={},y}(po),__={data:[],parser:{type:"json",x:"x",y:"y"}},RP={data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}},BE="#2f54eb",b_={active:{enable:!1,color:BE},select:{enable:!1,radius:10,opacity:1}},x_={visible:!0,source:__,radius:12,icon:{value:"1"},state:{active:!1,select:!1},blend:"normal",enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},ty=function(d){gu(y,d);function y(){var C=d!==null&&d.apply(this,arguments)||this;return C.type="textLayer",C}return y.prototype.createLayer=function(){var C=this.getLayerConfig(),F=new K.PointLayer(C);return F},y.prototype.adaptorAttrOptions=function(C){var F=C.field,J=C.style,ie=J===void 0?{}:J,me=ie||{},ke=me.fill,je=me.fontSize,et={field:F,value:"text"};return fs({shape:et,color:ke,size:je},C)},y}(Q0),zx=function(d){var y=d.visible,C=d.minZoom,F=d.maxZoom,J=d.zIndex,ie=J===void 0?0:J,me=d.label,ke=d.filter,je=y&&!!me&&(Ke(me==null?void 0:me.visible)||(me==null?void 0:me.visible)),et=fs(fs({zIndex:ie+.1,minZoom:C,maxZoom:F,filter:ke},me),{visible:je});return et},w_={};window.addEventListener("keydown",function(d){d.isComposing||d.keyCode===229||(w_[d.key]=!0)}),window.addEventListener("keyup",function(d){w_[d.key]=!1});var NE=function(d){return!!w_[d]},Bx=function(d,y){var C=d&&(y?NE(y):!0);return C},Nx=function(d){return fs(fs({},b_),d)},ZE=function(d){gu(y,d);function y(C){var F=d.call(this,C)||this;return F.layerState=b_,F.type=Hm.LayerType.IconImageLayer,F.selectData=[],F.onSelectHandle=function(J){var ie=J.feature,me=J.featureId;F.handleSelectData(me,ie)},F.initSubLayersEvent(),F}return Object.defineProperty(y.prototype,"layer",{get:function(){return this.iconLayer},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"iconLayer",{get:function(){return this.subLayers.getLayer("iconLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"iconLabelLayer",{get:function(){return this.subLayers.getLayer("labelLayer")},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"selectIconLayer",{get:function(){return this.subLayers.getLayer("selectIconLayer")},enumerable:!1,configurable:!0}),y.prototype.getDefaultOptions=function(){return y.DefaultOptions},y.prototype.addTo=function(C){this.scene=C,this.initAssets(),this.subLayers.addTo(C),this.emit(Gm.ADD)},y.prototype.getIconLayerOptions=function(){var C,F=f_(this.options,["source"]),J=F.visible,ie=F.minZoom,me=F.maxZoom,ke=F.zIndex,je=ke===void 0?0:ke,et=F.radius,bt=F.opacity,Mt=F.icon,sr=F.fillColor,Kt=F.iconStyle,vr=Cn(F,["visible","minZoom","maxZoom","zIndex","radius","opacity","icon","fillColor","iconStyle"]),Sr={active:(C=this.options.state)===null||C===void 0?void 0:C.active,select:!1},Ar=fs({opacity:bt},Kt),jr=fs(fs({},vr),{visible:J,minZoom:ie,maxZoom:me,zIndex:je,shape:Mt,size:et,state:Sr,color:sr,style:Ar});return jr},y.prototype.getHighLightLayerOptions=function(){var C,F=this.options,J=F.visible,ie=F.minZoom,me=F.maxZoom,ke=F.zIndex,je=ke===void 0?0:ke,et=F.icon,bt=(C=this.layerState)===null||C===void 0?void 0:C.select,Mt=bt.radius,sr=Mt===void 0?5:Mt,Kt=bt.opacity,vr=Kt===void 0?1:Kt,Sr={opacity:vr},Ar={visible:J,blend:K.BlendType.normal,zIndex:je+.1,minZoom:ie,maxZoom:me,source:__,size:sr,style:Sr,shape:(bt==null?void 0:bt.icon)||et,state:{select:!1,active:!1}};return Ar},y.prototype.handleSelectData=function(C,F,J){var ie=this.options,me=ie.enabledMultiSelect,ke=ie.triggerMultiSelectKey,je=Bx(me,ke)||J,et=r1(this.selectData),bt=et.findIndex(function(sr){return sr.featureId===C});if(bt===-1)je?et.push({feature:F,featureId:C}):et=[{feature:F,featureId:C}],this.emit("select",F,r1(et));else{var Mt=et[bt];je?et.splice(bt,1):et=[],this.emit("unselect",Mt,r1(et))}this.setSelectLayerSource(et)},y.prototype.createSubLayers=function(){var C=this.source;this.layerState=Nx(this.options.state);var F=new o1(fs(fs({},this.getIconLayerOptions()),{id:"iconLayer",source:C,interaction:!0})),J=new o1(fs({id:"selectIconLayer"},this.getHighLightLayerOptions())),ie=new ty(fs(fs({},zx(this.options)),{id:"labelLayer",source:C})),me=[F,ie,J];return me},y.prototype.updateSubLayers=function(){this.iconLayer.update(this.getIconLayerOptions(),!1),this.iconLabelLayer.update(zx(this.options),!1)},y.prototype.setSelectLayerSource=function(C){if(C===void 0&&(C=[]),!(this.selectData.length===C.length&&ng(this.selectData.map(function(me){var ke=me.featureId;return ke}),C.map(function(me){var ke=me.featureId;return ke})))){var F=C.map(function(me){var ke=me.feature;return ke}),J=this.source.parser,ie=J.type==="geojson"?{type:"FeatureCollection",features:F}:F;this.selectIconLayer.changeData({data:ie,parser:J}),this.selectData=C}},y.prototype.setSubLayersSource=function(C){if(this.isSourceInstance(C))this.source=C,this.iconLayer.setSource(C),this.iconLabelLayer.setSource(C);else{var F=C.data,J=Cn(C,["data"]);this.source.setData(F,J)}this.selectIconLayer.changeData(__)},y.prototype.initSubLayersEvent=function(){this.iconLayer.off("click",this.onSelectHandle),this.selectData=[],this.options.state&&this.options.state.select&&this.iconLayer.on("click",this.onSelectHandle)},y.prototype.updateOption=function(C){d.prototype.updateOption.call(this,C),this.layerState=Nx(this.options.state)},y.prototype.setIndex=function(C){this.iconLayer.setIndex(C),this.iconLabelLayer.setIndex(C),this.selectIconLayer.setIndex(C+.1)},y.prototype.setActive=function(C,F){var J=this.iconLayer.source,ie=J.getFeatureId(C,F);if(Ke(ie)){console.warn("Feature non-existent by field: ".concat(C,",value: ").concat(F));return}this.iconLayer.layer.setActive(ie)},y.prototype.update=function(C){d.prototype.update.call(this,C),this.initSubLayersEvent()},y.prototype.setSelect=function(C,F){var J,ie,me=this.iconLayer.source,ke=me.getFeatureId(C,F);if(Ke(ke)){console.warn("Feature non-existent by field: ".concat(C,",value: ").concat(F));return}if(!(!((J=this.layerState)===null||J===void 0)&&J.select&&((ie=this.layerState)===null||ie===void 0?void 0:ie.select).enable!==!1)){var je=me.getFeatureById(ke);this.handleSelectData(ke,je,!0)}},y.prototype.boxSelect=function(C,F){this.iconLayer.boxSelect(C,F)},y.DefaultOptions=x_,y}(Hm),UE=function(d){gu(y,d);function y(){var C=d!==null&&d.apply(this,arguments)||this;return C.type=Hm.LayerType.IconImageLayer,C}return y.prototype.addTo=function(C){var F=this;this.scene=C,this.initAssets().then(function(){F.subLayers.once(Tg.INITED_LAYERS,function(){F.emit(Gm.INITED,F),F.emit(Gm.ADD,F)}),F.subLayers.addTo(C)})},y.prototype.initAssets=function(){return z(this,void 0,void 0,function(){return V(this,function(C){switch(C.label){case 0:return[4,this.loadIconAtlas()];case 1:return C.sent(),[2]}})})},y.prototype.loadIconAtlas=function(){return z(this,void 0,void 0,function(){var C,F,J=this;return V(this,function(ie){switch(ie.label){case 0:return C=this.options.iconAtlas,F=this.scene,[4,Promise.all(Object.keys(C).map(function(me){return z(J,void 0,void 0,function(){return V(this,function(ke){switch(ke.label){case 0:return[4,F==null?void 0:F.addImage(me,C[me])];case 1:return ke.sent(),[2]}})})}))];case 1:return ie.sent(),[2]}})})},y.DefaultOptions=x_,y}(ZE),Jg=(0,j.memo)((0,j.forwardRef)(function(y,C){var F=Au(UE,y);return hs(F.current,y),(0,j.useImperativeHandle)(C,function(){return F.current}),null})),$m=G(73935),u1=function(y){var C=y.className,F=y.style,J=y.children,ie=y.position,me=y.name,ke=(0,j.useRef)(document.createElement("div")),je=rf(F),et=(0,j.useCallback)(function(){return ke.current},[]),bt=(0,j.useMemo)(function(){return{position:ie,name:me,className:C,style:je}},[ie,me,C,je]);return wo(et,void 0,bt),(0,$m.createPortal)(J,ke.current)};u1.defaultProps={position:"topleft"};function S_(d){return ny(d)||C_(d)||E_(d)||ry()}function ry(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E_(d,y){if(d){if(typeof d=="string")return iy(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return iy(d,y)}}function C_(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function ny(d){if(Array.isArray(d))return iy(d)}function iy(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}var l1=function(y,C){var F=useMemo(function(){return Object.keys(C)},[C]);useEffect(function(){return y&&F.forEach(function(J){var ie=C[J];ie&&y.on(J,ie)}),function(){y&&F.forEach(function(J){var ie=C[J];ie&&y.off(J,ie)})}},[y].concat(S_(Object.values(C)))),useUnmount(function(){y&&F.forEach(function(J){var ie=C[J];ie&&y.off(J,ie)})})},A_=function(y,C){var F=useRef(!0),J=useMemo(function(){return Object.keys(C)},[C]);useTrackedEffect(function(ie){if(F.current){F.current=!1;return}var me={};ie.forEach(function(ke){var je=J[ke];me[je]=C[je]}),y==null||y.setOptions(me)},Object.values(C))},ag=function(y){var C=useRef(document.createElement("span"));return{portal:y?createPortal(y,C.current):null,dom:y?C.current:void 0}};function T_(d,y){return Zx(d)||P_(d,y)||jE(d,y)||M_()}function M_(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jE(d,y){if(d){if(typeof d=="string")return VE(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return VE(d,y)}}function VE(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function P_(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Zx(d){if(Array.isArray(d))return d}var uR=function(y){var C=y.onExport,F=y.onShow,J=y.onHide,ie=y.onAdd,me=y.onRemove,ke=y.imageType,je=y.btnIcon,et=y.btnText,bt=y.title,Mt=y.vertical,sr=y.position,Kt=y.className,vr=y.style,Sr=useScene(),Ar=useState(),jr=T_(Ar,2),Kr=jr[0],Tn=jr[1],En=useMemo(function(){return getStyleText(vr)},[vr]),ui=useL7ComponentPortal(je),ai=ui.portal,Bn=ui.dom,bi=useMemo(function(){return{btnText:et,title:bt,vertical:Mt,position:sr,className:Kt,imageType:ke,style:En,btnIcon:Bn,onExport:C}},[et,bt,Mt,sr,Kt,En,ke,C,Bn]);return useEffect(function(){var Zi=new L7ExportImage(omitBy(bi,function(ei){return ei===void 0}));return Tn(Zi),Sr.addControl(Zi),function(){Sr.removeControl(Zi),Tn(void 0)}},[]),useL7ComponentUpdate(Kr,bi),useL7ComponentEvent(Kr,{add:ie,remove:me,show:F,hide:J}),React.createElement(React.Fragment,null,ai)};function Ux(d,y){return $E(d)||Vx(d,y)||HE(d,y)||GE()}function GE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HE(d,y){if(d){if(typeof d=="string")return jx(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return jx(d,y)}}function jx(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Vx(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function $E(d){if(Array.isArray(d))return d}var WE=function(y){var C=y.onShow,F=y.onHide,J=y.onAdd,ie=y.onRemove,me=y.onFullscreenChange,ke=y.btnIcon,je=y.btnText,et=y.title,bt=y.vertical,Mt=y.exitBtnIcon,sr=y.exitBtnText,Kt=y.exitTitle,vr=y.position,Sr=y.className,Ar=y.style,jr=useScene(),Kr=useState(),Tn=Ux(Kr,2),En=Tn[0],ui=Tn[1],ai=useMemo(function(){return getStyleText(Ar)},[Ar]),Bn=useL7ComponentPortal(ke),bi=Bn.portal,Zi=Bn.dom,ei=useL7ComponentPortal(Mt),mi=ei.portal,$t=ei.dom,vt=useMemo(function(){return{btnText:je,title:et,vertical:bt,exitBtnText:sr,exitTitle:Kt,position:vr,className:Sr,style:ai,btnIcon:Zi,exitBtnIcon:$t}},[je,et,bt,sr,Kt,vr,Sr,ai,Zi,$t]);return useEffect(function(){var Lt=new L7Fullscreen(omitBy(vt,function(yr){return yr===void 0}));return ui(Lt),jr.addControl(Lt),function(){jr.removeControl(Lt),ui(void 0)}},[]),useL7ComponentUpdate(En,vt),useL7ComponentEvent(En,{add:J,remove:ie,show:C,hide:F,fullscreenChange:me}),React.createElement(React.Fragment,null,bi,mi)};function Gx(d,y){return Xx(d)||Wx(d,y)||$x(d,y)||Hx()}function Hx(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $x(d,y){if(d){if(typeof d=="string")return k_(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return k_(d,y)}}function k_(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Wx(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Xx(d){if(Array.isArray(d))return d}var XE=function(y){var C=y.transform,F=y.onShow,J=y.onHide,ie=y.onAdd,me=y.onRemove,ke=y.btnIcon,je=y.btnText,et=y.title,bt=y.vertical,Mt=y.position,sr=y.className,Kt=y.style,vr=useScene(),Sr=useState(),Ar=Gx(Sr,2),jr=Ar[0],Kr=Ar[1],Tn=useMemo(function(){return getStyleText(Kt)},[Kt]),En=useL7ComponentPortal(ke),ui=En.portal,ai=En.dom,Bn=useMemo(function(){return{btnText:je,title:et,vertical:bt,position:Mt,className:sr,style:Tn,transform:C,btnIcon:ai}},[je,et,bt,Mt,sr,Tn,C,ai]);return useEffect(function(){var bi=new L7GeoLocate(omitBy(Bn,function(Zi){return Zi===void 0}));return Kr(bi),vr.addControl(bi),function(){vr.removeControl(bi),Kr(void 0)}},[]),useL7ComponentUpdate(jr,Bn),useL7ComponentEvent(jr,{add:ie,remove:me,show:F,hide:J}),React.createElement(React.Fragment,null,ui)};function Yx(d,y){return Qx(d)||Jx(d,y)||Kx(d,y)||qx()}function qx(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kx(d,y){if(d){if(typeof d=="string")return I_(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return I_(d,y)}}function I_(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Jx(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function Qx(d){if(Array.isArray(d))return d}var YE=function(y){var C=y.layers,F=y.popperPlacement,J=y.popperTrigger,ie=y.popperClassName,me=y.btnIcon,ke=y.btnText,je=y.title,et=y.vertical,bt=y.position,Mt=y.className,sr=y.style,Kt=y.onAdd,vr=y.onRemove,Sr=y.onShow,Ar=y.onHide,jr=y.onPopperShow,Kr=y.onPopperHide,Tn=y.onSelectChange,En=useScene(),ui=useLayerList(),ai=useState(),Bn=Yx(ai,2),bi=Bn[0],Zi=Bn[1],ei=useMemo(function(){return getStyleText(sr)},[sr]),mi=useL7ComponentPortal(me),$t=mi.portal,vt=mi.dom,Lt=useMemo(function(){return C!=null&&C.length?C.map(function(Or){return typeof Or=="string"?ui.find(function(Cr){return Cr.id===Or}):Or}).filter(function(Or){return!!Or}):ui},[C,ui]),yr=useMemo(function(){return{layers:Lt,popperPlacement:F,popperTrigger:J,popperClassName:ie,btnText:ke,title:je,vertical:et,position:bt,className:Mt,style:ei,btnIcon:vt}},[Lt,F,J,ie,ke,je,et,bt,Mt,ei,vt]);return useEffect(function(){var Or=new L7LayerSwitch(omitBy(yr,function(Cr){return Cr===void 0}));return Zi(Or),En.addControl(Or),function(){En.removeControl(Or),Zi(void 0)}},[]),useL7ComponentUpdate(bi,yr),useL7ComponentEvent(bi,{add:Kt,remove:vr,show:Sr,hide:Ar,popperShow:jr,popperHide:Kr,selectChange:Tn}),React.createElement(React.Fragment,null,$t)};function e2(d,y){return i2(d)||n2(d,y)||r2(d,y)||t2()}function t2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r2(d,y){if(d){if(typeof d=="string")return Jp(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Jp(d,y)}}function Jp(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function n2(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function i2(d){if(Array.isArray(d))return d}var qE=function(y){var C=y.popperPlacement,F=y.btnText,J=y.title,ie=y.vertical,me=y.position,ke=y.className,je=y.options,et=y.popperTrigger,bt=y.popperClassName,Mt=y.btnIcon,sr=y.style,Kt=y.onAdd,vr=y.onRemove,Sr=y.onShow,Ar=y.onHide,jr=y.onPopperShow,Kr=y.onPopperHide,Tn=y.onSelectChange,En=useScene(),ui=useState(),ai=e2(ui,2),Bn=ai[0],bi=ai[1],Zi=useMemo(function(){return getStyleText(sr)},[sr]),ei=useL7ComponentPortal(Mt),mi=ei.portal,$t=ei.dom,vt=useMemo(function(){return{popperPlacement:C,popperTrigger:et,popperClassName:bt,btnText:F,title:J,vertical:ie,position:me,className:ke,options:je,style:Zi,btnIcon:$t}},[je,C,et,bt,F,J,ie,me,ke,Zi,$t]);return useEffect(function(){var Lt=new L7MapTheme(omitBy(vt,function(yr){return yr===void 0}));return bi(Lt),En.addControl(Lt),function(){En.removeControl(Lt),bi(void 0)}},[]),useL7ComponentUpdate(Bn,vt),useL7ComponentEvent(Bn,{add:Kt,remove:vr,show:Sr,hide:Ar,popperShow:jr,popperHide:Kr,selectChange:Tn}),React.createElement(React.Fragment,null,mi)};function a2(d,y){return l2(d)||u2(d,y)||s2(d,y)||o2()}function o2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s2(d,y){if(d){if(typeof d=="string")return L_(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return L_(d,y)}}function L_(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function u2(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function l2(d){if(Array.isArray(d))return d}var KE=function(y){var C=y.position,F=y.className,J=y.style,ie=y.onLocationChange,me=y.transform,ke=y.onAdd,je=y.onRemove,et=y.onShow,bt=y.onHide,Mt=useScene(),sr=useState(),Kt=a2(sr,2),vr=Kt[0],Sr=Kt[1],Ar=useMemo(function(){return getStyleText(J)},[J]),jr=useMemo(function(){return{transform:me,position:C,className:F,style:Ar}},[me,C,F,Ar]);return useEffect(function(){var Kr=new L7MouseLocation(omitBy(jr,function(Tn){return Tn===void 0}));return Sr(Kr),Mt.addControl(Kr),function(){Mt.removeControl(Kr),Sr(void 0)}},[]),useL7ComponentUpdate(vr,jr),useL7ComponentEvent(vr,{add:ke,remove:je,show:et,hide:bt,locationChange:ie}),null};function c2(d,y){return d2(d)||p2(d,y)||f2(d,y)||h2()}function h2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f2(d,y){if(d){if(typeof d=="string")return R_(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return R_(d,y)}}function R_(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function p2(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function d2(d){if(Array.isArray(d))return d}var DP=function(y){var C=y.onShow,F=y.onHide,J=y.onAdd,ie=y.onRemove,me=y.position,ke=y.className,je=y.style,et=y.lockWidth,bt=y.maxWidth,Mt=y.metric,sr=y.imperial,Kt=y.updateWhenIdle,vr=useScene(),Sr=useState(),Ar=c2(Sr,2),jr=Ar[0],Kr=Ar[1],Tn=useMemo(function(){return getStyleText(je)},[je]),En=useMemo(function(){return{position:me,className:ke,style:Tn,lockWidth:et,maxWidth:bt,metric:Mt,imperial:sr,updateWhenIdle:Kt}},[me,ke,Tn,et,bt,Mt,sr,Kt]);return useEffect(function(){var ui=new L7Scale(omitBy(En,function(ai){return ai===void 0}));return Kr(ui),vr.addControl(ui),function(){vr.removeControl(ui),Kr(void 0)}},[]),useL7ComponentUpdate(jr,En),useL7ComponentEvent(jr,{add:J,remove:ie,show:C,hide:F}),null};function JE(d,y){return m2(d)||D_(d,y)||eC(d,y)||QE()}function QE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eC(d,y){if(d){if(typeof d=="string")return v2(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return v2(d,y)}}function v2(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function D_(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function m2(d){if(Array.isArray(d))return d}var tC=function(y){var C=y.onShow,F=y.onHide,J=y.onAdd,ie=y.onRemove,me=y.position,ke=y.name,je=y.className,et=y.style,bt=y.zoomInText,Mt=y.zoomOutText,sr=y.zoomInTitle,Kt=y.zoomOutTitle,vr=y.showZoom,Sr=useScene(),Ar=useState(),jr=JE(Ar,2),Kr=jr[0],Tn=jr[1],En=useMemo(function(){return getStyleText(et)},[et]),ui=useL7ComponentPortal(bt),ai=ui.portal,Bn=ui.dom,bi=useL7ComponentPortal(Mt),Zi=bi.portal,ei=bi.dom,mi=useMemo(function(){return{position:me,name:ke,className:je,zoomInTitle:sr,zoomOutTitle:Kt,showZoom:vr,style:En,zoomInText:Bn,zoomOutText:ei}},[me,ke,je,En,sr,Kt,Bn,ei,vr]);return useEffect(function(){var $t=new L7Zoom(omitBy(mi,function(vt){return vt===void 0}));return Tn($t),Sr.addControl($t),function(){Sr.removeControl($t),Tn(void 0)}},[]),useL7ComponentUpdate(Kr,mi),useL7ComponentEvent(Kr,{add:J,remove:ie,show:C,hide:F}),React.createElement(React.Fragment,null,ai,Zi)};function rC(d,y){return aC(d)||iC(d,y)||nC(d,y)||g2()}function g2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nC(d,y){if(d){if(typeof d=="string")return y2(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return y2(d,y)}}function y2(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function iC(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function aC(d){if(Array.isArray(d))return d}var OP=function(y){var C=y.img,F=y.href,J=y.position,ie=y.className,me=y.style,ke=y.onShow,je=y.onHide,et=y.onAdd,bt=y.onRemove,Mt=useScene(),sr=useState(),Kt=rC(sr,2),vr=Kt[0],Sr=Kt[1],Ar=useMemo(function(){return getStyleText(me)},[me]),jr=useMemo(function(){return{img:C,href:F,position:J,className:ie,style:Ar}},[C,F,J,ie,Ar]);return useEffect(function(){var Kr=new L7Logo(omitBy(jr,function(Tn){return Tn===void 0}));return Sr(Kr),Mt.addControl(Kr),function(){Mt.removeControl(Kr),Sr(void 0)}},[]),useL7ComponentUpdate(vr,jr),useL7ComponentEvent(vr,{add:et,remove:bt,show:ke,hide:je}),null},FP=function(y){var C=y.title,F=y.className,J=y.style;return React.createElement("h1",{className:classNames("".concat(CLS_PREFIX,"_decoration"),F),style:J},C)};function ay(d){"@babel/helpers - typeof";return ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},ay(d)}function _2(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function b2(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?_2(Object(C),!0).forEach(function(F){oC(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):_2(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function oC(d,y,C){return y=sC(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function sC(d){var y=uC(d,"string");return ay(y)==="symbol"?y:String(y)}function uC(d,y){if(ay(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(ay(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}var lC=(0,j.memo)(function(y){var C=ah(),F=(0,j.useRef)({props:y});F.current.props=y;var J=(0,j.useMemo)(function(){var ie=!1;j.Children.forEach(y.children,function(je){je&&(ie=!0)});var me=b2(b2({},y),{},{element:ie?document.createElement("div"):null}),ke=new K.Marker(me);return ke.on("click",function(je){var et,bt;(et=(bt=F.current.props).onClick)===null||et===void 0||et.call(bt,je)}),ke},[]);return Ce(function(){J.setLnglat(y.lngLat)},[y.lngLat]),(0,j.useEffect)(function(){return C.addMarker(J),function(){J.remove()}},[]),(0,$m.createPortal)(y.children,J.getElement())});function zP(d,y){return x2(d)||Qg(d,y)||hC(d,y)||cC()}function cC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hC(d,y){if(d){if(typeof d=="string")return Ou(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Ou(d,y)}}function Ou(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function Qg(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function x2(d){if(Array.isArray(d))return d}var fC=function(y){var C=y.style,F=y.closeButton,J=y.closeButtonOffsets,ie=y.closeOnClick,me=y.closeOnEsc,ke=y.maxWidth,je=y.anchor,et=y.offsets,bt=y.stopPropagation,Mt=y.autoPan,sr=y.autoClose,Kt=y.followCursor,vr=y.className,Sr=y.lngLat,Ar=y.children,jr=y.title,Kr=y.onOpen,Tn=y.onClose,En=y.onShow,ui=y.onHide,ai=useScene(),Bn=useState(),bi=zP(Bn,2),Zi=bi[0],ei=bi[1],mi=useMemo(function(){return getStyleText(C)},[C]),$t=useL7ComponentPortal(Ar),vt=$t.portal,Lt=$t.dom,yr=useL7ComponentPortal(jr),Or=yr.portal,Cr=yr.dom,In=useMemo(function(){return{style:mi,closeButton:F,closeButtonOffsets:J,closeOnClick:ie,closeOnEsc:me,maxWidth:ke,anchor:je,offsets:et,stopPropagation:bt,autoPan:Mt,autoClose:sr,followCursor:Kt,className:vr,lngLat:Sr,html:Lt,title:Cr}},[mi,F,JSON.stringify(J),ie,me,ke,je,JSON.stringify(et),bt,Mt,sr,Kt,vr,Lt,Cr,JSON.stringify(Sr)]);return useEffect(function(){var Mi=new L7Popup(omitBy(In,function(Ki){return Ki===void 0}));return ei(Mi),ai.addPopup(Mi),function(){ai.removePopup(Mi),ei(void 0)}},[]),useL7ComponentUpdate(Zi,In),useL7ComponentEvent(Zi,{open:Kr,close:Tn,show:En,hide:ui}),React.createElement(React.Fragment,null,vt,Or)},O_=function(y,C){if(y instanceof Function){var F=document.createElement(C);return function(){var me=y.apply(void 0,arguments),ke=ReactDOM.createPortal(me,F);return ReactDOM.render(ke,F),F}}else{var J=document.createElement(C),ie=ReactDOM.createPortal(y,J);return ReactDOM.render(ie,J),J}};function w2(d){return dC(d)||pC(d)||F_(d)||S2()}function S2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pC(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function dC(d){if(Array.isArray(d))return c1(d)}function vC(d,y){return C2(d)||z_(d,y)||F_(d,y)||E2()}function E2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F_(d,y){if(d){if(typeof d=="string")return c1(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return c1(d,y)}}function c1(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function z_(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function C2(d){if(Array.isArray(d))return d}var BP=function(y){var C=y.style,F=y.closeButton,J=y.closeButtonOffsets,ie=y.closeOnClick,me=y.closeOnEsc,ke=y.maxWidth,je=y.anchor,et=y.offsets,bt=y.stopPropagation,Mt=y.autoPan,sr=y.autoClose,Kt=y.className,vr=y.lngLat,Sr=y.items,Ar=y.trigger,jr=y.onOpen,Kr=y.onClose,Tn=y.onShow,En=y.onHide,ui=useScene(),ai=useState(),Bn=vC(ai,2),bi=Bn[0],Zi=Bn[1],ei=useMemo(function(){return getStyleText(C)},[C]),mi=useLayerList(),$t=useMemo(function(){var Lt=[];return Sr.forEach(function(yr){var Or;if(typeof yr.layer=="string"){var Cr=mi.find(function(Mi){return Mi.id===yr.layer});if(Cr)Or=Cr;else return}else Or=yr.layer;var In=[];Or.isComposite?In.push.apply(In,w2(Or.getInteractionSubLayers())):In.push(Or),In.forEach(function(Mi){var Ki,Yo={layer:Mi};yr.title&&(Yo.title=getElementTypePortal(yr.title,"div")),yr.customContent&&(Yo.customContent=getElementTypePortal(yr.customContent,"div")),(Ki=yr.fields)!==null&&Ki!==void 0&&Ki.length&&(Yo.fields=yr.fields.map(function(Va){if(typeof Va=="string")return Va;var Co={field:Va.field,getValue:Va.getValue};return Va.formatField&&(Co.formatField=getElementTypePortal(Va.formatField,"span")),Va.formatValue&&(Co.formatValue=getElementTypePortal(Va.formatValue,"span")),Co})),Lt.push(Yo)})}),Lt},[mi,Sr]),vt=useMemo(function(){return{style:ei,closeButton:F,closeButtonOffsets:J,closeOnClick:ie,closeOnEsc:me,maxWidth:ke,anchor:je,offsets:et,stopPropagation:bt,autoPan:Mt,autoClose:sr,followCursor:Ar==="hover",className:Kt,lngLat:vr,items:$t,trigger:Ar}},[ei,F,JSON.stringify(J),ie,me,ke,je,JSON.stringify(et),bt,Mt,sr,Kt,Ar,JSON.stringify(vr),$t]);return useEffect(function(){var Lt=new L7LayerPopup(omitBy(vt,function(yr){return yr===void 0}));return Zi(Lt),ui.addPopup(Lt),function(){ui.removePopup(Lt),Zi(void 0)}},[]),useL7ComponentUpdate(bi,vt),useL7ComponentEvent(bi,{open:jr,close:Kr,show:Tn,hide:En}),React.createElement(React.Fragment,null)},A2="larkmap-context-menu",T2="[object Map]",mC="[object Set]",M2=Object.prototype,P2=M2.hasOwnProperty;function gC(d){if(d==null)return!0;if(Fh(d)&&(zo(d)||typeof d=="string"||typeof d.splice=="function"||Fl(d)||Gv(d)||ku(d)))return!d.length;var y=ri(d);if(y==T2||y==mC)return!d.size;if(Cd(d))return!gv(d).length;for(var C in d)if(P2.call(d,C))return!1;return!0}var yC=gC,_C=(0,j.memo)(function(y){var C=y.text,F=C===void 0?"":C,J=y.onClick;return yC(F)?null:j.createElement("li",{className:Ie()("".concat(A2,"__menu-item"),y==null?void 0:y.className),style:y==null?void 0:y.style,onClick:J},F)});function k2(d,y){return bC(d)||R2(d,y)||L2(d,y)||I2()}function I2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L2(d,y){if(d){if(typeof d=="string")return h1(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return h1(d,y)}}function h1(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function R2(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function bC(d){if(Array.isArray(d))return d}var xC=function(y){var C=ah(),F=(0,j.useState)({visible:!1,position:void 0}),J=k2(F,2),ie=J[0],me=J[1],ke=(0,j.useMemo)(function(){return j.createElement("div",{className:Ie()("".concat(A2),y==null?void 0:y.className),style:y==null?void 0:y.style},y==null?void 0:y.children)},[y]),je=function(Mt){var sr=Mt.lnglat,Kt=sr.lng,vr=sr.lat;me({visible:!0,position:{lng:Kt,lat:vr}})},et=function(){var Mt=setTimeout(function(){Mt&&(clearTimeout(Mt),me({visible:!1,position:void 0}))},0)};return(0,j.useEffect)(function(){return C&&(C.on("contextmenu",je),C.on("click",et)),function(){C.off("contextmenu",je),C.off("click",et)}},[C]),ie.visible?j.createElement(lC,{lngLat:ie.position,anchor:"top-left"},ke):null};xC.Item=_C;var wC=G(23279),SC=G.n(wC);function Wm(d,y){var C;cp&&(hl(d)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof d)));var F=Ah(d),J=(C=y==null?void 0:y.wait)!==null&&C!==void 0?C:1e3,ie=(0,j.useMemo)(function(){return SC()(function(){for(var me=[],ke=0;ke<arguments.length;ke++)me[ke]=arguments[ke];return F.current.apply(F,ht([],Se(me),!1))},J,y)},[]);return af(function(){ie.cancel()}),{run:ie,cancel:ie.cancel,flush:ie.flush}}var D2=Wm,f1="larkmap-location-search",EC="https://restapi.amap.com/v3/assistant/inputtips",CC=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,AC=/^\w*$/;function TC(d,y){if(zo(d))return!1;var C=typeof d;return C=="number"||C=="symbol"||C=="boolean"||d==null||Wt(d)?!0:AC.test(d)||!CC.test(d)||y!=null&&d in Object(y)}var B_=TC,MC="Expected a function";function p1(d,y){if(typeof d!="function"||y!=null&&typeof y!="function")throw new TypeError(MC);var C=function(){var F=arguments,J=y?y.apply(this,F):F[0],ie=C.cache;if(ie.has(J))return ie.get(J);var me=d.apply(this,F);return C.cache=ie.set(J,me)||ie,me};return C.cache=new(p1.Cache||w),C}p1.Cache=w;var O2=p1,PC=500;function kC(d){var y=O2(d,function(F){return C.size===PC&&C.clear(),F}),C=y.cache;return y}var IC=kC,LC=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,RC=/\\(\\)?/g,DC=IC(function(d){var y=[];return d.charCodeAt(0)===46&&y.push(""),d.replace(LC,function(C,F,J,ie){y.push(J?ie.replace(RC,"$1"):F||C)}),y}),F2=DC;function z2(d,y){return zo(d)?d:B_(d,y)?[d]:F2(Qe(d))}var N_=z2;function OC(d){var y=d==null?0:d.length;return y?d[y-1]:void 0}var FC=OC,zC=1/0;function BC(d){if(typeof d=="string"||Wt(d))return d;var y=d+"";return y=="0"&&1/d==-zC?"-0":y}var B2=BC;function N2(d,y){y=N_(y,d);for(var C=0,F=y.length;d!=null&&C<F;)d=d[B2(y[C++])];return C&&C==F?d:void 0}var Z2=N2;function NC(d,y,C){var F=-1,J=d.length;y<0&&(y=-y>J?0:J+y),C=C>J?J:C,C<0&&(C+=J),J=y>C?0:C-y>>>0,y>>>=0;for(var ie=Array(J);++F<J;)ie[F]=d[F+y];return ie}var ZC=NC;function UC(d,y){return y.length<2?d:Z2(d,ZC(y,0,-1))}var jC=UC;function VC(d,y){return y=N_(y,d),d=jC(d,y),d==null||delete d[B2(FC(y))]}var U2=VC,j2="[object Object]",GC=Function.prototype,HC=Object.prototype,V2=GC.toString,$C=HC.hasOwnProperty,WC=V2.call(Object);function G2(d){if(!xn(d)||Nr(d)!=j2)return!1;var y=qt(d);if(y===null)return!0;var C=$C.call(y,"constructor")&&y.constructor;return typeof C=="function"&&C instanceof C&&V2.call(C)==WC}var H2=G2;function XC(d){return H2(d)?void 0:d}var YC=XC,$2=Rr?Rr.isConcatSpreadable:void 0;function qC(d){return zo(d)||ku(d)||!!($2&&d&&d[$2])}var KC=qC;function Z_(d,y,C,F,J){var ie=-1,me=d.length;for(C||(C=KC),J||(J=[]);++ie<me;){var ke=d[ie];y>0&&C(ke)?y>1?Z_(ke,y-1,C,F,J):Uu(J,ke):F||(J[J.length]=ke)}return J}var W2=Z_;function JC(d){var y=d==null?0:d.length;return y?W2(d,1):[]}var QC=JC;function e5(d,y,C){switch(C.length){case 0:return d.call(y);case 1:return d.call(y,C[0]);case 2:return d.call(y,C[0],C[1]);case 3:return d.call(y,C[0],C[1],C[2])}return d.apply(y,C)}var t5=e5,X2=Math.max;function Y2(d,y,C){return y=X2(y===void 0?d.length-1:y,0),function(){for(var F=arguments,J=-1,ie=X2(F.length-y,0),me=Array(ie);++J<ie;)me[J]=F[y+J];J=-1;for(var ke=Array(y+1);++J<y;)ke[J]=F[J];return ke[y]=C(me),t5(d,this,ke)}}var q2=Y2;function r5(d){return function(){return d}}var n5=r5;function i5(d){return d}var K2=i5,a5=Ai?function(d,y){return Ai(d,"toString",{configurable:!0,enumerable:!1,value:n5(y),writable:!0})}:K2,J2=a5,Q2=800,o5=16,s5=Date.now;function u5(d){var y=0,C=0;return function(){var F=s5(),J=o5-(F-C);if(C=F,J>0){if(++y>=Q2)return arguments[0]}else y=0;return d.apply(void 0,arguments)}}var l5=u5,c5=l5(J2),ew=c5;function tw(d){return ew(q2(d,void 0,QC),d+"")}var rw=tw,nw=1,b0=2,iw=4,h5=rw(function(d,y){var C={};if(d==null)return C;var F=!1;y=Pi(y,function(ie){return ie=N_(ie,d),F||(F=ie.length>1),ie}),sa(d,gr(d),C),F&&(C=wi(C,nw|b0|iw,YC));for(var J=y.length;J--;)U2(C,y[J]);return C}),aw=h5,Nf=G(87462),uv=G(74902),xu=G(4942),ka=G(1413),Ia=G(97685),Gd=G(91),Fv=G(71002);function Ev(d){var y=j.useRef();y.current=d;var C=j.useCallback(function(){for(var F,J=arguments.length,ie=new Array(J),me=0;me<J;me++)ie[me]=arguments[me];return(F=y.current)===null||F===void 0?void 0:F.call.apply(F,[y].concat(ie))},[]);return C}function wm(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var ow=wm()?j.useLayoutEffect:j.useEffect,sw=function(y,C){var F=j.useRef(!0);ow(function(){return y(F.current)},C),ow(function(){return F.current=!1,function(){F.current=!0}},[])},uw=function(y,C){sw(function(F){if(!F)return y()},C)},Ap=sw;function x0(d){var y=j.useRef(!1),C=j.useState(d),F=(0,Ia.Z)(C,2),J=F[0],ie=F[1];j.useEffect(function(){return y.current=!1,function(){y.current=!0}},[]);function me(ke,je){je&&y.current||ie(ke)}return[J,me]}function d1(d){return d!==void 0}function U_(d,y){var C=y||{},F=C.defaultValue,J=C.value,ie=C.onChange,me=C.postState,ke=x0(function(){return d1(J)?J:d1(F)?typeof F=="function"?F():F:typeof d=="function"?d():d}),je=(0,Ia.Z)(ke,2),et=je[0],bt=je[1],Mt=J!==void 0?J:et,sr=me?me(Mt):Mt,Kt=Ev(ie),vr=x0([Mt]),Sr=(0,Ia.Z)(vr,2),Ar=Sr[0],jr=Sr[1];uw(function(){var Tn=Ar[0];et!==Tn&&Kt(et,Tn)},[Ar]),uw(function(){d1(J)||bt(J)},[J]);var Kr=Ev(function(Tn,En){bt(Tn,En),jr([Mt],En)});return[sr,Kr]}var j_={},oy=[],lw=function(y){oy.push(y)};function sy(d,y){if(!1)var C}function f5(d,y){if(!1)var C}function lv(){j_={}}function cw(d,y,C){!y&&!j_[C]&&(d(!1,C),j_[C]=!0)}function uy(d,y){cw(sy,d,y)}function w0(d,y){cw(f5,d,y)}uy.preMessage=lw,uy.resetWarned=lv,uy.noteOnce=w0;var p5=uy,hw=function(){if(typeof navigator=="undefined"||typeof window=="undefined")return!1;var d=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(d==null?void 0:d.substr(0,4))},qs={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(y){var C=y.keyCode;if(y.altKey&&!y.ctrlKey||y.metaKey||C>=qs.F1&&C<=qs.F12)return!1;switch(C){case qs.ALT:case qs.CAPS_LOCK:case qs.CONTEXT_MENU:case qs.CTRL:case qs.DOWN:case qs.END:case qs.ESC:case qs.HOME:case qs.INSERT:case qs.LEFT:case qs.MAC_FF_META:case qs.META:case qs.NUMLOCK:case qs.NUM_CENTER:case qs.PAGE_DOWN:case qs.PAGE_UP:case qs.PAUSE:case qs.PRINT_SCREEN:case qs.RIGHT:case qs.SHIFT:case qs.UP:case qs.WIN_KEY:case qs.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(y){if(y>=qs.ZERO&&y<=qs.NINE||y>=qs.NUM_ZERO&&y<=qs.NUM_MULTIPLY||y>=qs.A&&y<=qs.Z||window.navigator.userAgent.indexOf("WebKit")!==-1&&y===0)return!0;switch(y){case qs.SPACE:case qs.QUESTION_MARK:case qs.NUM_PLUS:case qs.NUM_MINUS:case qs.NUM_PERIOD:case qs.NUM_DIVISION:case qs.SEMICOLON:case qs.DASH:case qs.EQUALS:case qs.COMMA:case qs.PERIOD:case qs.SLASH:case qs.APOSTROPHE:case qs.SINGLE_QUOTE:case qs.OPEN_SQUARE_BRACKET:case qs.BACKSLASH:case qs.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}},Qu=qs,d5=G(11805);function fw(d,y,C){var F=j.useRef({});return(!("value"in F.current)||C(F.current.condition,y))&&(F.current.value=d(),F.current.condition=y),F.current.value}function pw(d,y){typeof d=="function"?d(y):(0,Fv.Z)(d)==="object"&&d&&"current"in d&&(d.current=y)}function V_(){for(var d=arguments.length,y=new Array(d),C=0;C<d;C++)y[C]=arguments[C];var F=y.filter(function(J){return J});return F.length<=1?F[0]:function(J){y.forEach(function(ie){pw(ie,J)})}}function v1(){for(var d=arguments.length,y=new Array(d),C=0;C<d;C++)y[C]=arguments[C];return fw(function(){return V_.apply(void 0,y)},y,function(F,J){return F.length!==J.length||F.every(function(ie,me){return ie!==J[me]})})}function m1(d){var y,C,F=(0,d5.isMemo)(d)?d.type.type:d.type;return!(typeof F=="function"&&!((y=F.prototype)!==null&&y!==void 0&&y.render)||typeof d=="function"&&!((C=d.prototype)!==null&&C!==void 0&&C.render))}function lR(d){return!isValidElement(d)||isFragment(d)?!1:m1(d)}var NP=function(y){var C=y.className,F=y.customizeIcon,J=y.customizeIconProps,ie=y.onMouseDown,me=y.onClick,ke=y.children,je;return typeof F=="function"?je=F(J):je=F,j.createElement("span",{className:C,onMouseDown:function(bt){bt.preventDefault(),ie&&ie(bt)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:me,"aria-hidden":!0},je!==void 0?je:j.createElement("span",{className:Ie()(C.split(/\s+/).map(function(et){return"".concat(et,"-icon")}))},ke))},g1=NP;function dw(d,y,C,F,J){var ie=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,me=arguments.length>6?arguments[6]:void 0,ke=arguments.length>7?arguments[7]:void 0,je=j.useMemo(function(){if((0,Fv.Z)(F)==="object")return F.clearIcon;if(J)return J},[F,J]),et=j.useMemo(function(){return!!(!ie&&F&&(C.length||me)&&!(ke==="combobox"&&me===""))},[F,ie,C.length,me,ke]);return{allowClear:et,clearIcon:j.createElement(g1,{className:"".concat(d,"-clear"),onMouseDown:y,customizeIcon:je},"\xD7")}}var v5=j.createContext(null);function m5(){return j.useContext(v5)}function ZP(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,y=j.useState(!1),C=(0,Ia.Z)(y,2),F=C[0],J=C[1],ie=j.useRef(null),me=function(){window.clearTimeout(ie.current)};j.useEffect(function(){return me},[]);var ke=function(et,bt){me(),ie.current=window.setTimeout(function(){J(et),bt&&bt()},d)};return[F,ke,me]}function vw(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:250,y=j.useRef(null),C=j.useRef(null);j.useEffect(function(){return function(){window.clearTimeout(C.current)}},[]);function F(J){(J||y.current===null)&&(y.current=J),window.clearTimeout(C.current),C.current=window.setTimeout(function(){y.current=null},d)}return[function(){return y.current},F]}function UP(d,y,C,F){var J=j.useRef(null);J.current={open:y,triggerOpen:C,customizedTrigger:F},j.useEffect(function(){function ie(me){var ke;if(!((ke=J.current)!==null&&ke!==void 0&&ke.customizedTrigger)){var je=me.target;je.shadowRoot&&me.composed&&(je=me.composedPath()[0]||je),J.current.open&&d().filter(function(et){return et}).every(function(et){return!et.contains(je)&&et!==je})&&J.current.triggerOpen(!1)}}return window.addEventListener("mousedown",ie),function(){return window.removeEventListener("mousedown",ie)}},[])}var g5=`accept acceptCharset accessKey action allowFullScreen allowTransparency
    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge
    charSet checked classID className colSpan cols content contentEditable contextMenu
    controls coords crossOrigin data dateTime default defer dir disabled download draggable
    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder
    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity
    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media
    mediaGroup method min minLength multiple muted name noValidate nonce open
    optimum pattern placeholder poster preload radioGroup readOnly rel required
    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected
    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style
    summary tabIndex target title type useMap value width wmode wrap`,y5=`onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown
    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick
    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown
    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel
    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough
    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata
    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError`,_5="".concat(g5," ").concat(y5).split(/[\s\n]+/),y1="aria-",b5="data-";function x5(d,y){return d.indexOf(y)===0}function Sm(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,C;y===!1?C={aria:!0,data:!0,attr:!0}:y===!0?C={aria:!0}:C=(0,ka.Z)({},y);var F={};return Object.keys(d).forEach(function(J){(C.aria&&(J==="role"||x5(J,y1))||C.data&&x5(J,b5)||C.attr&&_5.includes(J))&&(F[J]=d[J])}),F}function Qh(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=[];return j.Children.forEach(d,function(F){F==null&&!y.keepEmpty||(Array.isArray(F)?C=C.concat(Qh(F)):(0,d5.isFragment)(F)&&F.props?C=C.concat(Qh(F.props.children,y)):C.push(F))}),C}function Xl(d){return d instanceof HTMLElement||d instanceof SVGElement}function Em(d){return Xl(d)?d:d instanceof j.Component?$m.findDOMNode(d):null}var Ni=j.createContext(null);function Mg(d){var y=d.children,C=d.onBatchResize,F=j.useRef(0),J=j.useRef([]),ie=j.useContext(Ni),me=j.useCallback(function(ke,je,et){F.current+=1;var bt=F.current;J.current.push({size:ke,element:je,data:et}),Promise.resolve().then(function(){bt===F.current&&(C==null||C(J.current),J.current=[])}),ie==null||ie(ke,je,et)},[C,ie]);return j.createElement(Ni.Provider,{value:me},y)}var S0=function(){if(typeof Map!="undefined")return Map;function d(y,C){var F=-1;return y.some(function(J,ie){return J[0]===C?(F=ie,!0):!1}),F}return function(){function y(){this.__entries__=[]}return Object.defineProperty(y.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),y.prototype.get=function(C){var F=d(this.__entries__,C),J=this.__entries__[F];return J&&J[1]},y.prototype.set=function(C,F){var J=d(this.__entries__,C);~J?this.__entries__[J][1]=F:this.__entries__.push([C,F])},y.prototype.delete=function(C){var F=this.__entries__,J=d(F,C);~J&&F.splice(J,1)},y.prototype.has=function(C){return!!~d(this.__entries__,C)},y.prototype.clear=function(){this.__entries__.splice(0)},y.prototype.forEach=function(C,F){F===void 0&&(F=null);for(var J=0,ie=this.__entries__;J<ie.length;J++){var me=ie[J];C.call(F,me[1],me[0])}},y}()}(),Up=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,_1=function(){return typeof G.g!="undefined"&&G.g.Math===Math?G.g:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),w5=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(_1):function(d){return setTimeout(function(){return d(Date.now())},1e3/60)}}(),S5=2;function E5(d,y){var C=!1,F=!1,J=0;function ie(){C&&(C=!1,d()),F&&ke()}function me(){w5(ie)}function ke(){var je=Date.now();if(C){if(je-J<S5)return;F=!0}else C=!0,F=!1,setTimeout(me,y);J=je}return ke}var mw=20,C5=["top","right","bottom","left","width","height","size","weight"],A5=typeof MutationObserver!="undefined",G_=function(){function d(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=E5(this.refresh.bind(this),mw)}return d.prototype.addObserver=function(y){~this.observers_.indexOf(y)||this.observers_.push(y),this.connected_||this.connect_()},d.prototype.removeObserver=function(y){var C=this.observers_,F=C.indexOf(y);~F&&C.splice(F,1),!C.length&&this.connected_&&this.disconnect_()},d.prototype.refresh=function(){var y=this.updateObservers_();y&&this.refresh()},d.prototype.updateObservers_=function(){var y=this.observers_.filter(function(C){return C.gatherActive(),C.hasActive()});return y.forEach(function(C){return C.broadcastActive()}),y.length>0},d.prototype.connect_=function(){!Up||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A5?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},d.prototype.disconnect_=function(){!Up||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},d.prototype.onTransitionEnd_=function(y){var C=y.propertyName,F=C===void 0?"":C,J=C5.some(function(ie){return!!~F.indexOf(ie)});J&&this.refresh()},d.getInstance=function(){return this.instance_||(this.instance_=new d),this.instance_},d.instance_=null,d}(),gw=function(d,y){for(var C=0,F=Object.keys(y);C<F.length;C++){var J=F[C];Object.defineProperty(d,J,{value:y[J],enumerable:!1,writable:!1,configurable:!0})}return d},e0=function(d){var y=d&&d.ownerDocument&&d.ownerDocument.defaultView;return y||_1},H_=x1(0,0,0,0);function b1(d){return parseFloat(d)||0}function T5(d){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];return y.reduce(function(F,J){var ie=d["border-"+J+"-width"];return F+b1(ie)},0)}function M5(d){for(var y=["top","right","bottom","left"],C={},F=0,J=y;F<J.length;F++){var ie=J[F],me=d["padding-"+ie];C[ie]=b1(me)}return C}function P5(d){var y=d.getBBox();return x1(0,0,y.width,y.height)}function k5(d){var y=d.clientWidth,C=d.clientHeight;if(!y&&!C)return H_;var F=e0(d).getComputedStyle(d),J=M5(F),ie=J.left+J.right,me=J.top+J.bottom,ke=b1(F.width),je=b1(F.height);if(F.boxSizing==="border-box"&&(Math.round(ke+ie)!==y&&(ke-=T5(F,"left","right")+ie),Math.round(je+me)!==C&&(je-=T5(F,"top","bottom")+me)),!L5(d)){var et=Math.round(ke+ie)-y,bt=Math.round(je+me)-C;Math.abs(et)!==1&&(ke-=et),Math.abs(bt)!==1&&(je-=bt)}return x1(J.left,J.top,ke,je)}var I5=function(){return typeof SVGGraphicsElement!="undefined"?function(d){return d instanceof e0(d).SVGGraphicsElement}:function(d){return d instanceof e0(d).SVGElement&&typeof d.getBBox=="function"}}();function L5(d){return d===e0(d).document.documentElement}function R5(d){return Up?I5(d)?P5(d):k5(d):H_}function D5(d){var y=d.x,C=d.y,F=d.width,J=d.height,ie=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,me=Object.create(ie.prototype);return gw(me,{x:y,y:C,width:F,height:J,top:C,right:y+F,bottom:J+C,left:y}),me}function x1(d,y,C,F){return{x:d,y,width:C,height:F}}var yw=function(){function d(y){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=x1(0,0,0,0),this.target=y}return d.prototype.isActive=function(){var y=R5(this.target);return this.contentRect_=y,y.width!==this.broadcastWidth||y.height!==this.broadcastHeight},d.prototype.broadcastRect=function(){var y=this.contentRect_;return this.broadcastWidth=y.width,this.broadcastHeight=y.height,y},d}(),_w=function(){function d(y,C){var F=D5(C);gw(this,{target:y,contentRect:F})}return d}(),O5=function(){function d(y,C,F){if(this.activeObservations_=[],this.observations_=new S0,typeof y!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=y,this.controller_=C,this.callbackCtx_=F}return d.prototype.observe=function(y){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(y instanceof e0(y).Element))throw new TypeError('parameter 1 is not of type "Element".');var C=this.observations_;C.has(y)||(C.set(y,new yw(y)),this.controller_.addObserver(this),this.controller_.refresh())}},d.prototype.unobserve=function(y){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(y instanceof e0(y).Element))throw new TypeError('parameter 1 is not of type "Element".');var C=this.observations_;C.has(y)&&(C.delete(y),C.size||this.controller_.removeObserver(this))}},d.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},d.prototype.gatherActive=function(){var y=this;this.clearActive(),this.observations_.forEach(function(C){C.isActive()&&y.activeObservations_.push(C)})},d.prototype.broadcastActive=function(){if(this.hasActive()){var y=this.callbackCtx_,C=this.activeObservations_.map(function(F){return new _w(F.target,F.broadcastRect())});this.callback_.call(y,C,y),this.clearActive()}},d.prototype.clearActive=function(){this.activeObservations_.splice(0)},d.prototype.hasActive=function(){return this.activeObservations_.length>0},d}(),bw=typeof WeakMap!="undefined"?new WeakMap:new S0,xw=function(){function d(y){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var C=G_.getInstance(),F=new O5(y,C,this);bw.set(this,F)}return d}();["observe","unobserve","disconnect"].forEach(function(d){xw.prototype[d]=function(){var y;return(y=bw.get(this))[d].apply(y,arguments)}});var ww=function(){return typeof _1.ResizeObserver!="undefined"?_1.ResizeObserver:xw}(),Sw=ww,Pg=new Map;function F5(d){d.forEach(function(y){var C,F=y.target;(C=Pg.get(F))===null||C===void 0||C.forEach(function(J){return J(F)})})}var Ew=new Sw(F5),jP=null,z5=null;function B5(d,y){Pg.has(d)||(Pg.set(d,new Set),Ew.observe(d)),Pg.get(d).add(y)}function N5(d,y){Pg.has(d)&&(Pg.get(d).delete(y),Pg.get(d).size||(Ew.unobserve(d),Pg.delete(d)))}var w1=G(15671),S1=G(43144),$_=G(60136),W_=G(61120),Z5=G(78814),Cw=G(82963);function ly(d){var y=(0,Z5.Z)();return function(){var F=(0,W_.Z)(d),J;if(y){var ie=(0,W_.Z)(this).constructor;J=Reflect.construct(F,arguments,ie)}else J=F.apply(this,arguments);return(0,Cw.Z)(this,J)}}var U5=function(d){(0,$_.Z)(C,d);var y=ly(C);function C(){return(0,w1.Z)(this,C),y.apply(this,arguments)}return(0,S1.Z)(C,[{key:"render",value:function(){return this.props.children}}]),C}(j.Component);function j5(d,y){var C=d.children,F=d.disabled,J=j.useRef(null),ie=j.useRef(null),me=j.useContext(Ni),ke=typeof C=="function",je=ke?C(J):C,et=j.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),bt=!ke&&j.isValidElement(je)&&m1(je),Mt=bt?je.ref:null,sr=v1(Mt,J),Kt=function(){var jr;return Em(J.current)||(J.current&&(0,Fv.Z)(J.current)==="object"?Em((jr=J.current)===null||jr===void 0?void 0:jr.nativeElement):null)||Em(ie.current)};j.useImperativeHandle(y,function(){return Kt()});var vr=j.useRef(d);vr.current=d;var Sr=j.useCallback(function(Ar){var jr=vr.current,Kr=jr.onResize,Tn=jr.data,En=Ar.getBoundingClientRect(),ui=En.width,ai=En.height,Bn=Ar.offsetWidth,bi=Ar.offsetHeight,Zi=Math.floor(ui),ei=Math.floor(ai);if(et.current.width!==Zi||et.current.height!==ei||et.current.offsetWidth!==Bn||et.current.offsetHeight!==bi){var mi={width:Zi,height:ei,offsetWidth:Bn,offsetHeight:bi};et.current=mi;var $t=Bn===Math.round(ui)?ui:Bn,vt=bi===Math.round(ai)?ai:bi,Lt=(0,ka.Z)((0,ka.Z)({},mi),{},{offsetWidth:$t,offsetHeight:vt});me==null||me(Lt,Ar,Tn),Kr&&Promise.resolve().then(function(){Kr(Lt,Ar)})}},[]);return j.useEffect(function(){var Ar=Kt();return Ar&&!F&&B5(Ar,Sr),function(){return N5(Ar,Sr)}},[J.current,F]),j.createElement(U5,{ref:ie},bt?j.cloneElement(je,{ref:sr}):je)}var V5=j.forwardRef(j5),G5=V5,H5="rc-observer-key";function $5(d,y){var C=d.children,F=typeof C=="function"?[C]:Qh(C);return F.map(function(J,ie){var me=(J==null?void 0:J.key)||"".concat(H5,"-").concat(ie);return j.createElement(G5,(0,Nf.Z)({},d,{key:me,ref:ie===0?y:void 0}),J)})}var t0=j.forwardRef($5);t0.Collection=Mg;var E0=t0,W5=["prefixCls","invalidate","item","renderItem","responsive","responsiveDisabled","registerSize","itemKey","className","style","children","display","order","component"],C0=void 0;function X5(d,y){var C=d.prefixCls,F=d.invalidate,J=d.item,ie=d.renderItem,me=d.responsive,ke=d.responsiveDisabled,je=d.registerSize,et=d.itemKey,bt=d.className,Mt=d.style,sr=d.children,Kt=d.display,vr=d.order,Sr=d.component,Ar=Sr===void 0?"div":Sr,jr=(0,Gd.Z)(d,W5),Kr=me&&!Kt;function Tn(bi){je(et,bi)}j.useEffect(function(){return function(){Tn(null)}},[]);var En=ie&&J!==C0?ie(J):sr,ui;F||(ui={opacity:Kr?0:1,height:Kr?0:C0,overflowY:Kr?"hidden":C0,order:me?vr:C0,pointerEvents:Kr?"none":C0,position:Kr?"absolute":C0});var ai={};Kr&&(ai["aria-hidden"]=!0);var Bn=j.createElement(Ar,(0,Nf.Z)({className:Ie()(!F&&C,bt),style:(0,ka.Z)((0,ka.Z)({},ui),Mt)},ai,jr,{ref:y}),En);return me&&(Bn=j.createElement(E0,{onResize:function(Zi){var ei=Zi.offsetWidth;Tn(ei)},disabled:ke},Bn)),Bn}var Aw=j.forwardRef(X5);Aw.displayName="Item";var E1=Aw,Tw=function(y){return+setTimeout(y,16)},Mw=function(y){return clearTimeout(y)};typeof window!="undefined"&&"requestAnimationFrame"in window&&(Tw=function(y){return window.requestAnimationFrame(y)},Mw=function(y){return window.cancelAnimationFrame(y)});var cy=0,X_=new Map;function Pw(d){X_.delete(d)}var Y_=function(y){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;cy+=1;var F=cy;function J(ie){if(ie===0)Pw(F),y();else{var me=Tw(function(){J(ie-1)});X_.set(F,me)}}return J(C),F};Y_.cancel=function(d){var y=X_.get(d);return Pw(y),Mw(y)};var cv=Y_;function Y5(d){if(typeof MessageChannel=="undefined")cv(d);else{var y=new MessageChannel;y.port1.onmessage=function(){return d()},y.port2.postMessage(void 0)}}function q5(){var d=j.useRef(null),y=function(F){d.current||(d.current=[],Y5(function(){(0,$m.unstable_batchedUpdates)(function(){d.current.forEach(function(J){J()}),d.current=null})})),d.current.push(F)};return y}function hy(d,y){var C=j.useState(y),F=(0,Ia.Z)(C,2),J=F[0],ie=F[1],me=Ev(function(ke){d(function(){ie(ke)})});return[J,me]}var q_=j.createContext(null),K5=["component"],J5=["className"],r0=["className"],Q5=function(y,C){var F=j.useContext(q_);if(!F){var J=y.component,ie=J===void 0?"div":J,me=(0,Gd.Z)(y,K5);return j.createElement(ie,(0,Nf.Z)({},me,{ref:C}))}var ke=F.className,je=(0,Gd.Z)(F,J5),et=y.className,bt=(0,Gd.Z)(y,r0);return j.createElement(q_.Provider,{value:null},j.createElement(E1,(0,Nf.Z)({ref:C,className:Ie()(ke,et)},je,bt)))},kw=j.forwardRef(Q5);kw.displayName="RawItem";var fy=kw,eA=["prefixCls","data","renderItem","renderRawItem","itemKey","itemWidth","ssr","style","className","maxCount","renderRest","renderRawRest","suffix","component","itemComponent","onVisibleChange"],Iw="responsive",K_="invalidate";function tA(d){return"+ ".concat(d.length," ...")}function rA(d,y){var C=d.prefixCls,F=C===void 0?"rc-overflow":C,J=d.data,ie=J===void 0?[]:J,me=d.renderItem,ke=d.renderRawItem,je=d.itemKey,et=d.itemWidth,bt=et===void 0?10:et,Mt=d.ssr,sr=d.style,Kt=d.className,vr=d.maxCount,Sr=d.renderRest,Ar=d.renderRawRest,jr=d.suffix,Kr=d.component,Tn=Kr===void 0?"div":Kr,En=d.itemComponent,ui=d.onVisibleChange,ai=(0,Gd.Z)(d,eA),Bn=Mt==="full",bi=q5(),Zi=hy(bi,null),ei=(0,Ia.Z)(Zi,2),mi=ei[0],$t=ei[1],vt=mi||0,Lt=hy(bi,new Map),yr=(0,Ia.Z)(Lt,2),Or=yr[0],Cr=yr[1],In=hy(bi,0),Mi=(0,Ia.Z)(In,2),Ki=Mi[0],Yo=Mi[1],Va=hy(bi,0),Co=(0,Ia.Z)(Va,2),kl=Co[0],cu=Co[1],Bc=hy(bi,0),El=(0,Ia.Z)(Bc,2),fo=El[0],qa=El[1],_o=(0,j.useState)(null),Is=(0,Ia.Z)(_o,2),xs=Is[0],no=Is[1],ps=(0,j.useState)(null),wu=(0,Ia.Z)(ps,2),$u=wu[0],ol=wu[1],ds=j.useMemo(function(){return $u===null&&Bn?Number.MAX_SAFE_INTEGER:$u||0},[$u,mi]),Ks=(0,j.useState)(!1),ru=(0,Ia.Z)(Ks,2),Ru=ru[0],Js=ru[1],Nc="".concat(F,"-item"),Vp=Math.max(Ki,kl),jh=vr===Iw,hu=ie.length&&jh,mh=vr===K_,Qc=hu||typeof vr=="number"&&ie.length>vr,Bl=(0,j.useMemo)(function(){var Ls=ie;return hu?mi===null&&Bn?Ls=ie:Ls=ie.slice(0,Math.min(ie.length,vt/bt)):typeof vr=="number"&&(Ls=ie.slice(0,vr)),Ls},[ie,bt,mi,vr,hu]),Zf=(0,j.useMemo)(function(){return hu?ie.slice(ds+1):ie.slice(Bl.length)},[ie,Bl,hu,ds]),Cl=(0,j.useCallback)(function(Ls,ju){var pa;return typeof je=="function"?je(Ls):(pa=je&&(Ls==null?void 0:Ls[je]))!==null&&pa!==void 0?pa:ju},[je]),Qp=(0,j.useCallback)(me||function(Ls){return Ls},[me]);function ed(Ls,ju,pa){$u===Ls&&(ju===void 0||ju===xs)||(ol(Ls),pa||(Js(Ls<ie.length-1),ui==null||ui(Ls)),ju!==void 0&&no(ju))}function hv(Ls,ju){$t(ju.clientWidth)}function td(Ls,ju){Cr(function(pa){var No=new Map(pa);return ju===null?No.delete(Ls):No.set(Ls,ju),No})}function Uf(Ls,ju){cu(ju),Yo(kl)}function jf(Ls,ju){qa(ju)}function Vf(Ls){return Or.get(Cl(Bl[Ls],Ls))}Ap(function(){if(vt&&typeof Vp=="number"&&Bl){var Ls=fo,ju=Bl.length,pa=ju-1;if(!ju){ed(0,null);return}for(var No=0;No<ju;No+=1){var co=Vf(No);if(Bn&&(co=co||0),co===void 0){ed(No-1,void 0,!0);break}if(Ls+=co,pa===0&&Ls<=vt||No===pa-1&&Ls+Vf(pa)<=vt){ed(pa,null);break}else if(Ls+Vp>vt){ed(No-1,Ls-co-fo+kl);break}}jr&&Vf(0)+fo>vt&&no(null)}},[vt,Or,kl,fo,Cl,Bl]);var Mc=Ru&&!!Zf.length,Nv={};xs!==null&&hu&&(Nv={position:"absolute",left:xs,top:0});var yd={prefixCls:Nc,responsive:hu,component:En,invalidate:mh},Gp=ke?function(Ls,ju){var pa=Cl(Ls,ju);return j.createElement(q_.Provider,{key:pa,value:(0,ka.Z)((0,ka.Z)({},yd),{},{order:ju,item:Ls,itemKey:pa,registerSize:td,display:ju<=ds})},ke(Ls,ju))}:function(Ls,ju){var pa=Cl(Ls,ju);return j.createElement(E1,(0,Nf.Z)({},yd,{order:ju,key:pa,item:Ls,renderItem:Qp,itemKey:pa,registerSize:td,display:ju<=ds}))},ac,oc={order:Mc?ds:Number.MAX_SAFE_INTEGER,className:"".concat(Nc,"-rest"),registerSize:Uf,display:Mc};if(Ar)Ar&&(ac=j.createElement(q_.Provider,{value:(0,ka.Z)((0,ka.Z)({},yd),oc)},Ar(Zf)));else{var sc=Sr||tA;ac=j.createElement(E1,(0,Nf.Z)({},yd,oc),typeof sc=="function"?sc(Zf):sc)}var rd=j.createElement(Tn,(0,Nf.Z)({className:Ie()(!mh&&F,Kt),style:sr,ref:y},ai),Bl.map(Gp),Qc?ac:null,jr&&j.createElement(E1,(0,Nf.Z)({},yd,{responsive:jh,responsiveDisabled:!hu,order:ds,className:"".concat(Nc,"-suffix"),registerSize:jf,display:!0,style:Nv}),jr));return jh&&(rd=j.createElement(E0,{onResize:hv,disabled:!hu},rd)),rd}var py=j.forwardRef(rA);py.displayName="Overflow",py.Item=fy,py.RESPONSIVE=Iw,py.INVALIDATE=K_;var Lw=py,nA=Lw,iA=function(y,C){var F,J=y.prefixCls,ie=y.id,me=y.inputElement,ke=y.disabled,je=y.tabIndex,et=y.autoFocus,bt=y.autoComplete,Mt=y.editable,sr=y.activeDescendantId,Kt=y.value,vr=y.maxLength,Sr=y.onKeyDown,Ar=y.onMouseDown,jr=y.onChange,Kr=y.onPaste,Tn=y.onCompositionStart,En=y.onCompositionEnd,ui=y.open,ai=y.attrs,Bn=me||j.createElement("input",null),bi=Bn,Zi=bi.ref,ei=bi.props,mi=ei.onKeyDown,$t=ei.onChange,vt=ei.onMouseDown,Lt=ei.onCompositionStart,yr=ei.onCompositionEnd,Or=ei.style;return sy(!("maxLength"in Bn.props),"Passing 'maxLength' to input element directly may not work because input in BaseSelect is controlled."),Bn=j.cloneElement(Bn,(0,ka.Z)((0,ka.Z)((0,ka.Z)({type:"search"},ei),{},{id:ie,ref:V_(C,Zi),disabled:ke,tabIndex:je,autoComplete:bt||"off",autoFocus:et,className:Ie()("".concat(J,"-selection-search-input"),(F=Bn)===null||F===void 0||(F=F.props)===null||F===void 0?void 0:F.className),role:"combobox","aria-expanded":ui||!1,"aria-haspopup":"listbox","aria-owns":"".concat(ie,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(ie,"_list"),"aria-activedescendant":ui?sr:void 0},ai),{},{value:Mt?Kt:"",maxLength:vr,readOnly:!Mt,unselectable:Mt?null:"on",style:(0,ka.Z)((0,ka.Z)({},Or),{},{opacity:Mt?null:0}),onKeyDown:function(In){Sr(In),mi&&mi(In)},onMouseDown:function(In){Ar(In),vt&&vt(In)},onChange:function(In){jr(In),$t&&$t(In)},onCompositionStart:function(In){Tn(In),Lt&&Lt(In)},onCompositionEnd:function(In){En(In),yr&&yr(In)},onPaste:Kr})),Bn},og=j.forwardRef(iA);og.displayName="Input";var C1=og;function Xm(d){return Array.isArray(d)?d:d!==void 0?[d]:[]}var aA=typeof window!="undefined"&&window.document&&window.document.documentElement,oA=aA;function sA(d){return d!=null}function uA(d){return!d&&d!==0}function Rw(d){return["string","number"].includes((0,Fv.Z)(d))}function J_(d){var y=void 0;return d&&(Rw(d.title)?y=d.title.toString():Rw(d.label)&&(y=d.label.toString())),y}function Dw(d,y){oA?j.useLayoutEffect(d,y):j.useEffect(d,y)}function sg(d){var y;return(y=d.key)!==null&&y!==void 0?y:d.value}var Q_=function(y){y.preventDefault(),y.stopPropagation()},zv=function(y){var C=y.id,F=y.prefixCls,J=y.values,ie=y.open,me=y.searchValue,ke=y.autoClearSearchValue,je=y.inputRef,et=y.placeholder,bt=y.disabled,Mt=y.mode,sr=y.showSearch,Kt=y.autoFocus,vr=y.autoComplete,Sr=y.activeDescendantId,Ar=y.tabIndex,jr=y.removeIcon,Kr=y.maxTagCount,Tn=y.maxTagTextLength,En=y.maxTagPlaceholder,ui=En===void 0?function(no){return"+ ".concat(no.length," ...")}:En,ai=y.tagRender,Bn=y.onToggleOpen,bi=y.onRemove,Zi=y.onInputChange,ei=y.onInputPaste,mi=y.onInputKeyDown,$t=y.onInputMouseDown,vt=y.onInputCompositionStart,Lt=y.onInputCompositionEnd,yr=j.useRef(null),Or=(0,j.useState)(0),Cr=(0,Ia.Z)(Or,2),In=Cr[0],Mi=Cr[1],Ki=(0,j.useState)(!1),Yo=(0,Ia.Z)(Ki,2),Va=Yo[0],Co=Yo[1],kl="".concat(F,"-selection"),cu=ie||Mt==="multiple"&&ke===!1||Mt==="tags"?me:"",Bc=Mt==="tags"||Mt==="multiple"&&ke===!1||sr&&(ie||Va);Dw(function(){Mi(yr.current.scrollWidth)},[cu]);function El(no,ps,wu,$u,ol){return j.createElement("span",{className:Ie()("".concat(kl,"-item"),(0,xu.Z)({},"".concat(kl,"-item-disabled"),wu)),title:J_(no)},j.createElement("span",{className:"".concat(kl,"-item-content")},ps),$u&&j.createElement(g1,{className:"".concat(kl,"-item-remove"),onMouseDown:Q_,onClick:ol,customizeIcon:jr},"\xD7"))}function fo(no,ps,wu,$u,ol){var ds=function(ru){Q_(ru),Bn(!ie)};return j.createElement("span",{onMouseDown:ds},ai({label:ps,value:no,disabled:wu,closable:$u,onClose:ol}))}function qa(no){var ps=no.disabled,wu=no.label,$u=no.value,ol=!bt&&!ps,ds=wu;if(typeof Tn=="number"&&(typeof wu=="string"||typeof wu=="number")){var Ks=String(ds);Ks.length>Tn&&(ds="".concat(Ks.slice(0,Tn),"..."))}var ru=function(Js){Js&&Js.stopPropagation(),bi(no)};return typeof ai=="function"?fo($u,ds,ps,ol,ru):El(no,ds,ps,ol,ru)}function _o(no){var ps=typeof ui=="function"?ui(no):ui;return El({title:ps},ps,!1)}var Is=j.createElement("div",{className:"".concat(kl,"-search"),style:{width:In},onFocus:function(){Co(!0)},onBlur:function(){Co(!1)}},j.createElement(C1,{ref:je,open:ie,prefixCls:F,id:C,inputElement:null,disabled:bt,autoFocus:Kt,autoComplete:vr,editable:Bc,activeDescendantId:Sr,value:cu,onKeyDown:mi,onMouseDown:$t,onChange:Zi,onPaste:ei,onCompositionStart:vt,onCompositionEnd:Lt,tabIndex:Ar,attrs:Sm(y,!0)}),j.createElement("span",{ref:yr,className:"".concat(kl,"-search-mirror"),"aria-hidden":!0},cu,"\xA0")),xs=j.createElement(nA,{prefixCls:"".concat(kl,"-overflow"),data:J,renderItem:qa,renderRest:_o,suffix:Is,itemKey:sg,maxCount:Kr});return j.createElement(j.Fragment,null,xs,!J.length&&!cu&&j.createElement("span",{className:"".concat(kl,"-placeholder")},et))},eb=zv,lA=function(y){var C=y.inputElement,F=y.prefixCls,J=y.id,ie=y.inputRef,me=y.disabled,ke=y.autoFocus,je=y.autoComplete,et=y.activeDescendantId,bt=y.mode,Mt=y.open,sr=y.values,Kt=y.placeholder,vr=y.tabIndex,Sr=y.showSearch,Ar=y.searchValue,jr=y.activeValue,Kr=y.maxLength,Tn=y.onInputKeyDown,En=y.onInputMouseDown,ui=y.onInputChange,ai=y.onInputPaste,Bn=y.onInputCompositionStart,bi=y.onInputCompositionEnd,Zi=y.title,ei=j.useState(!1),mi=(0,Ia.Z)(ei,2),$t=mi[0],vt=mi[1],Lt=bt==="combobox",yr=Lt||Sr,Or=sr[0],Cr=Ar||"";Lt&&jr&&!$t&&(Cr=jr),j.useEffect(function(){Lt&&vt(!1)},[Lt,jr]);var In=bt!=="combobox"&&!Mt&&!Sr?!1:!!Cr,Mi=Zi===void 0?J_(Or):Zi,Ki=function(){if(Or)return null;var Va=In?{visibility:"hidden"}:void 0;return j.createElement("span",{className:"".concat(F,"-selection-placeholder"),style:Va},Kt)};return j.createElement(j.Fragment,null,j.createElement("span",{className:"".concat(F,"-selection-search")},j.createElement(C1,{ref:ie,prefixCls:F,id:J,open:Mt,inputElement:C,disabled:me,autoFocus:ke,autoComplete:je,editable:yr,activeDescendantId:et,value:Cr,onKeyDown:Tn,onMouseDown:En,onChange:function(Va){vt(!0),ui(Va)},onPaste:ai,onCompositionStart:Bn,onCompositionEnd:bi,tabIndex:vr,attrs:Sm(y,!0),maxLength:Lt?Kr:void 0})),!Lt&&Or?j.createElement("span",{className:"".concat(F,"-selection-item"),title:Mi,style:In?{visibility:"hidden"}:void 0},Or.label):null,Ki())},cA=lA;function hA(d){return![Qu.ESC,Qu.SHIFT,Qu.BACKSPACE,Qu.TAB,Qu.WIN_KEY,Qu.ALT,Qu.META,Qu.WIN_KEY_RIGHT,Qu.CTRL,Qu.SEMICOLON,Qu.EQUALS,Qu.CAPS_LOCK,Qu.CONTEXT_MENU,Qu.F1,Qu.F2,Qu.F3,Qu.F4,Qu.F5,Qu.F6,Qu.F7,Qu.F8,Qu.F9,Qu.F10,Qu.F11,Qu.F12].includes(d)}var fA=function(y,C){var F=(0,j.useRef)(null),J=(0,j.useRef)(!1),ie=y.prefixCls,me=y.open,ke=y.mode,je=y.showSearch,et=y.tokenWithEnter,bt=y.autoClearSearchValue,Mt=y.onSearch,sr=y.onSearchSubmit,Kt=y.onToggleOpen,vr=y.onInputKeyDown,Sr=y.domRef;j.useImperativeHandle(C,function(){return{focus:function(){F.current.focus()},blur:function(){F.current.blur()}}});var Ar=vw(0),jr=(0,Ia.Z)(Ar,2),Kr=jr[0],Tn=jr[1],En=function(Cr){var In=Cr.which;(In===Qu.UP||In===Qu.DOWN)&&Cr.preventDefault(),vr&&vr(Cr),In===Qu.ENTER&&ke==="tags"&&!J.current&&!me&&(sr==null||sr(Cr.target.value)),hA(In)&&Kt(!0)},ui=function(){Tn(!0)},ai=(0,j.useRef)(null),Bn=function(Cr){Mt(Cr,!0,J.current)!==!1&&Kt(!0)},bi=function(){J.current=!0},Zi=function(Cr){J.current=!1,ke!=="combobox"&&Bn(Cr.target.value)},ei=function(Cr){var In=Cr.target.value;if(et&&ai.current&&/[\r\n]/.test(ai.current)){var Mi=ai.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");In=In.replace(Mi,ai.current)}ai.current=null,Bn(In)},mi=function(Cr){var In=Cr.clipboardData,Mi=In.getData("text");ai.current=Mi},$t=function(Cr){var In=Cr.target;if(In!==F.current){var Mi=document.body.style.msTouchAction!==void 0;Mi?setTimeout(function(){F.current.focus()}):F.current.focus()}},vt=function(Cr){var In=Kr();Cr.target!==F.current&&!In&&ke!=="combobox"&&Cr.preventDefault(),(ke!=="combobox"&&(!je||!In)||!me)&&(me&&bt!==!1&&Mt("",!0,!1),Kt())},Lt={inputRef:F,onInputKeyDown:En,onInputMouseDown:ui,onInputChange:ei,onInputPaste:mi,onInputCompositionStart:bi,onInputCompositionEnd:Zi},yr=ke==="multiple"||ke==="tags"?j.createElement(eb,(0,Nf.Z)({},y,Lt)):j.createElement(cA,(0,Nf.Z)({},y,Lt));return j.createElement("div",{ref:Sr,className:"".concat(ie,"-selector"),onClick:$t,onMouseDown:vt},yr)},Ow=j.forwardRef(fA);Ow.displayName="Selector";var pA=Ow,dA=j.createContext(null),Fw=dA,tb=[];function vA(d,y){var C=j.useState(function(){if(!wm())return null;var vr=document.createElement("div");return vr}),F=(0,Ia.Z)(C,1),J=F[0],ie=j.useRef(!1),me=j.useContext(Fw),ke=j.useState(tb),je=(0,Ia.Z)(ke,2),et=je[0],bt=je[1],Mt=me||(ie.current?void 0:function(vr){bt(function(Sr){var Ar=[vr].concat((0,uv.Z)(Sr));return Ar})});function sr(){J.parentElement||document.body.appendChild(J),ie.current=!0}function Kt(){var vr;(vr=J.parentElement)===null||vr===void 0||vr.removeChild(J),ie.current=!1}return Ap(function(){return d?me?me(sr):sr():Kt(),Kt},[d]),Ap(function(){et.length&&(et.forEach(function(vr){return vr()}),bt(tb))},[et]),[J,Mt]}function mA(d,y){if(!d)return!1;if(d.contains)return d.contains(y);for(var C=y;C;){if(C===d)return!0;C=C.parentNode}return!1}var zw="data-rc-order",rb="data-rc-priority",gA="rc-util-key",A1=new Map;function Bw(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=d.mark;return y?y.startsWith("data-")?y:"data-".concat(y):gA}function T1(d){if(d.attachTo)return d.attachTo;var y=document.querySelector("head");return y||document.body}function yA(d){return d==="queue"?"prependQueue":d?"prepend":"append"}function Nw(d){return Array.from((A1.get(d)||d).children).filter(function(y){return y.tagName==="STYLE"})}function Zw(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wm())return null;var C=y.csp,F=y.prepend,J=y.priority,ie=J===void 0?0:J,me=yA(F),ke=me==="prependQueue",je=document.createElement("style");je.setAttribute(zw,me),ke&&ie&&je.setAttribute(rb,"".concat(ie)),C!=null&&C.nonce&&(je.nonce=C==null?void 0:C.nonce),je.innerHTML=d;var et=T1(y),bt=et.firstChild;if(F){if(ke){var Mt=Nw(et).filter(function(sr){if(!["prepend","prependQueue"].includes(sr.getAttribute(zw)))return!1;var Kt=Number(sr.getAttribute(rb)||0);return ie>=Kt});if(Mt.length)return et.insertBefore(je,Mt[Mt.length-1].nextSibling),je}et.insertBefore(je,bt)}else et.appendChild(je);return je}function Uw(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=T1(y);return Nw(C).find(function(F){return F.getAttribute(Bw(y))===d})}function jw(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=Uw(d,y);if(C){var F=T1(y);F.removeChild(C)}}function _A(d,y){var C=A1.get(d);if(!C||!mA(document,C)){var F=Zw("",y),J=F.parentNode;A1.set(d,J),d.removeChild(F)}}function VP(){A1.clear()}function bA(d,y){var C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},F=T1(C);_A(F,C);var J=Uw(y,C);if(J){var ie,me;if((ie=C.csp)!==null&&ie!==void 0&&ie.nonce&&J.nonce!==((me=C.csp)===null||me===void 0?void 0:me.nonce)){var ke;J.nonce=(ke=C.csp)===null||ke===void 0?void 0:ke.nonce}return J.innerHTML!==d&&(J.innerHTML=d),J}var je=Zw(d,C);return je.setAttribute(Bw(C),y),je}var nb;function xA(d){if(typeof document=="undefined")return 0;if(d||nb===void 0){var y=document.createElement("div");y.style.width="100%",y.style.height="200px";var C=document.createElement("div"),F=C.style;F.position="absolute",F.top="0",F.left="0",F.pointerEvents="none",F.visibility="hidden",F.width="200px",F.height="150px",F.overflow="hidden",C.appendChild(y),document.body.appendChild(C);var J=y.offsetWidth;C.style.overflow="scroll";var ie=y.offsetWidth;J===ie&&(ie=C.clientWidth),document.body.removeChild(C),nb=J-ie}return nb}function Vw(d){var y=d.match(/^(.*)px$/),C=Number(y==null?void 0:y[1]);return Number.isNaN(C)?xA():C}function wA(d){if(typeof document=="undefined"||!d||!(d instanceof Element))return{width:0,height:0};var y=getComputedStyle(d,"::-webkit-scrollbar"),C=y.width,F=y.height;return{width:Vw(C),height:Vw(F)}}function Gw(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var SA="rc-util-locker-".concat(Date.now()),Hw=0;function EA(d){var y=!!d,C=j.useState(function(){return Hw+=1,"".concat(SA,"_").concat(Hw)}),F=(0,Ia.Z)(C,1),J=F[0];Ap(function(){if(y){var ie=wA(document.body).width,me=Gw();bA(`
html body {
  overflow-y: hidden;
  `.concat(me?"width: calc(100% - ".concat(ie,"px);"):"",`
}`),J)}else jw(J);return function(){jw(J)}},[y,J])}var $w=!1;function CA(d){return typeof d=="boolean"&&($w=d),$w}var ug=function(y){return y===!1?!1:!wm()||!y?null:typeof y=="string"?document.querySelector(y):typeof y=="function"?y():y},Ww=j.forwardRef(function(d,y){var C=d.open,F=d.autoLock,J=d.getContainer,ie=d.debug,me=d.autoDestroy,ke=me===void 0?!0:me,je=d.children,et=j.useState(C),bt=(0,Ia.Z)(et,2),Mt=bt[0],sr=bt[1],Kt=Mt||C;j.useEffect(function(){(ke||C)&&sr(C)},[C,ke]);var vr=j.useState(function(){return ug(J)}),Sr=(0,Ia.Z)(vr,2),Ar=Sr[0],jr=Sr[1];j.useEffect(function(){var $t=ug(J);jr($t!=null?$t:null)});var Kr=vA(Kt&&!Ar,ie),Tn=(0,Ia.Z)(Kr,2),En=Tn[0],ui=Tn[1],ai=Ar!=null?Ar:En;EA(F&&C&&wm()&&(ai===En||ai===document.body));var Bn=null;if(je&&m1(je)&&y){var bi=je;Bn=bi.ref}var Zi=v1(Bn,y);if(!Kt||!wm()||Ar===void 0)return null;var ei=ai===!1||CA(),mi=je;return y&&(mi=j.cloneElement(je,{ref:Zi})),j.createElement(Fw.Provider,{value:ui},ei?mi:(0,$m.createPortal)(mi,ai))}),ip=Ww,ib=ip;function Xw(d){var y;return d==null||(y=d.getRootNode)===null||y===void 0?void 0:y.call(d)}function AA(d){return Xw(d)instanceof ShadowRoot}function ab(d){return AA(d)?Xw(d):null}function TA(){var d=(0,ka.Z)({},P);return d.useId}var Yw=0;function GP(){}var qw=TA(),Kw=qw?function(y){var C=qw();return y||C}:function(y){var C=j.useState("ssr-id"),F=(0,Ia.Z)(C,2),J=F[0],ie=F[1];return j.useEffect(function(){var me=Yw;Yw+=1,ie("rc_unique_".concat(me))},[]),y||J},Jw=null,Qw=j.createContext({});function HP(d){var y=d.children,C=_objectWithoutProperties(d,Jw);return React.createElement(Qw.Provider,{value:C},y)}var MA=function(d){(0,$_.Z)(C,d);var y=ly(C);function C(){return(0,w1.Z)(this,C),y.apply(this,arguments)}return(0,S1.Z)(C,[{key:"render",value:function(){return this.props.children}}]),C}(j.Component),PA=MA,kg="none",A0="appear",dy="enter",M1="leave",eS="none",tm="prepare",T0="start",M0="active",vy="end",ob="prepared";function sb(d,y){var C={};return C[d.toLowerCase()]=y.toLowerCase(),C["Webkit".concat(d)]="webkit".concat(y),C["Moz".concat(d)]="moz".concat(y),C["ms".concat(d)]="MS".concat(y),C["O".concat(d)]="o".concat(y.toLowerCase()),C}function Pd(d,y){var C={animationend:sb("Animation","AnimationEnd"),transitionend:sb("Transition","TransitionEnd")};return d&&("AnimationEvent"in y||delete C.animationend.animation,"TransitionEvent"in y||delete C.transitionend.transition),C}var kA=Pd(wm(),typeof window!="undefined"?window:{}),tS={};if(wm()){var rS=document.createElement("div");tS=rS.style}var kd={};function nS(d){if(kd[d])return kd[d];var y=kA[d];if(y)for(var C=Object.keys(y),F=C.length,J=0;J<F;J+=1){var ie=C[J];if(Object.prototype.hasOwnProperty.call(y,ie)&&ie in tS)return kd[d]=y[ie],kd[d]}return""}var ub=nS("animationend"),iS=nS("transitionend"),lb=!!(ub&&iS),P1=ub||"animationend",cb=iS||"transitionend";function Lu(d,y){if(!d)return null;if((0,Fv.Z)(d)==="object"){var C=y.replace(/-\w/g,function(F){return F[1].toUpperCase()});return d[C]}return"".concat(d,"-").concat(y)}var IA=function(d){var y=(0,j.useRef)(),C=(0,j.useRef)(d);C.current=d;var F=j.useCallback(function(me){C.current(me)},[]);function J(me){me&&(me.removeEventListener(cb,F),me.removeEventListener(P1,F))}function ie(me){y.current&&y.current!==me&&J(y.current),me&&me!==y.current&&(me.addEventListener(cb,F),me.addEventListener(P1,F),y.current=me)}return j.useEffect(function(){return function(){J(y.current)}},[]),[ie,J]},gy=wm()?j.useLayoutEffect:j.useEffect,hb=gy,k1=function(){var d=j.useRef(null);function y(){cv.cancel(d.current)}function C(F){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;y();var ie=cv(function(){J<=1?F({isCanceled:function(){return ie!==d.current}}):C(F,J-1)});d.current=ie}return j.useEffect(function(){return function(){y()}},[]),[C,y]},P0=[tm,T0,M0,vy],LA=[tm,ob],aS=!1,RA=!0;function oS(d){return d===M0||d===vy}var DA=function(d,y,C){var F=x0(eS),J=(0,Ia.Z)(F,2),ie=J[0],me=J[1],ke=k1(),je=(0,Ia.Z)(ke,2),et=je[0],bt=je[1];function Mt(){me(tm,!0)}var sr=y?LA:P0;return hb(function(){if(ie!==eS&&ie!==vy){var Kt=sr.indexOf(ie),vr=sr[Kt+1],Sr=C(ie);Sr===aS?me(vr,!0):vr&&et(function(Ar){function jr(){Ar.isCanceled()||me(vr,!0)}Sr===!0?jr():Promise.resolve(Sr).then(jr)})}},[d,ie]),j.useEffect(function(){return function(){bt()}},[]),[Mt,ie]};function OA(d,y,C,F){var J=F.motionEnter,ie=J===void 0?!0:J,me=F.motionAppear,ke=me===void 0?!0:me,je=F.motionLeave,et=je===void 0?!0:je,bt=F.motionDeadline,Mt=F.motionLeaveImmediately,sr=F.onAppearPrepare,Kt=F.onEnterPrepare,vr=F.onLeavePrepare,Sr=F.onAppearStart,Ar=F.onEnterStart,jr=F.onLeaveStart,Kr=F.onAppearActive,Tn=F.onEnterActive,En=F.onLeaveActive,ui=F.onAppearEnd,ai=F.onEnterEnd,Bn=F.onLeaveEnd,bi=F.onVisibleChanged,Zi=x0(),ei=(0,Ia.Z)(Zi,2),mi=ei[0],$t=ei[1],vt=x0(kg),Lt=(0,Ia.Z)(vt,2),yr=Lt[0],Or=Lt[1],Cr=x0(null),In=(0,Ia.Z)(Cr,2),Mi=In[0],Ki=In[1],Yo=(0,j.useRef)(!1),Va=(0,j.useRef)(null);function Co(){return C()}var kl=(0,j.useRef)(!1);function cu(){Or(kg,!0),Ki(null,!0)}function Bc(Ks){var ru=Co();if(!(Ks&&!Ks.deadline&&Ks.target!==ru)){var Ru=kl.current,Js;yr===A0&&Ru?Js=ui==null?void 0:ui(ru,Ks):yr===dy&&Ru?Js=ai==null?void 0:ai(ru,Ks):yr===M1&&Ru&&(Js=Bn==null?void 0:Bn(ru,Ks)),yr!==kg&&Ru&&Js!==!1&&cu()}}var El=IA(Bc),fo=(0,Ia.Z)(El,1),qa=fo[0],_o=function(ru){var Ru,Js,Nc;switch(ru){case A0:return Ru={},(0,xu.Z)(Ru,tm,sr),(0,xu.Z)(Ru,T0,Sr),(0,xu.Z)(Ru,M0,Kr),Ru;case dy:return Js={},(0,xu.Z)(Js,tm,Kt),(0,xu.Z)(Js,T0,Ar),(0,xu.Z)(Js,M0,Tn),Js;case M1:return Nc={},(0,xu.Z)(Nc,tm,vr),(0,xu.Z)(Nc,T0,jr),(0,xu.Z)(Nc,M0,En),Nc;default:return{}}},Is=j.useMemo(function(){return _o(yr)},[yr]),xs=DA(yr,!d,function(Ks){if(Ks===tm){var ru=Is[tm];return ru?ru(Co()):aS}if(wu in Is){var Ru;Ki(((Ru=Is[wu])===null||Ru===void 0?void 0:Ru.call(Is,Co(),null))||null)}return wu===M0&&(qa(Co()),bt>0&&(clearTimeout(Va.current),Va.current=setTimeout(function(){Bc({deadline:!0})},bt))),wu===ob&&cu(),RA}),no=(0,Ia.Z)(xs,2),ps=no[0],wu=no[1],$u=oS(wu);kl.current=$u,hb(function(){$t(y);var Ks=Yo.current;Yo.current=!0;var ru;!Ks&&y&&ke&&(ru=A0),Ks&&y&&ie&&(ru=dy),(Ks&&!y&&et||!Ks&&Mt&&!y&&et)&&(ru=M1);var Ru=_o(ru);ru&&(d||Ru[tm])?(Or(ru),ps()):Or(kg)},[y]),(0,j.useEffect)(function(){(yr===A0&&!ke||yr===dy&&!ie||yr===M1&&!et)&&Or(kg)},[ke,ie,et]),(0,j.useEffect)(function(){return function(){Yo.current=!1,clearTimeout(Va.current)}},[]);var ol=j.useRef(!1);(0,j.useEffect)(function(){mi&&(ol.current=!0),mi!==void 0&&yr===kg&&((ol.current||mi)&&(bi==null||bi(mi)),ol.current=!0)},[mi,yr]);var ds=Mi;return Is[tm]&&wu===T0&&(ds=(0,ka.Z)({transition:"none"},ds)),[yr,wu,ds,mi!=null?mi:y]}function FA(d){var y=d;(0,Fv.Z)(d)==="object"&&(y=d.transitionSupport);function C(J,ie){return!!(J.motionName&&y&&ie!==!1)}var F=j.forwardRef(function(J,ie){var me=J.visible,ke=me===void 0?!0:me,je=J.removeOnLeave,et=je===void 0?!0:je,bt=J.forceRender,Mt=J.children,sr=J.motionName,Kt=J.leavedClassName,vr=J.eventProps,Sr=j.useContext(Qw),Ar=Sr.motion,jr=C(J,Ar),Kr=(0,j.useRef)(),Tn=(0,j.useRef)();function En(){try{return Kr.current instanceof HTMLElement?Kr.current:Em(Tn.current)}catch(Ki){return null}}var ui=OA(jr,ke,En,J),ai=(0,Ia.Z)(ui,4),Bn=ai[0],bi=ai[1],Zi=ai[2],ei=ai[3],mi=j.useRef(ei);ei&&(mi.current=!0);var $t=j.useCallback(function(Ki){Kr.current=Ki,pw(ie,Ki)},[ie]),vt,Lt=(0,ka.Z)((0,ka.Z)({},vr),{},{visible:ke});if(!Mt)vt=null;else if(Bn===kg)ei?vt=Mt((0,ka.Z)({},Lt),$t):!et&&mi.current&&Kt?vt=Mt((0,ka.Z)((0,ka.Z)({},Lt),{},{className:Kt}),$t):bt||!et&&!Kt?vt=Mt((0,ka.Z)((0,ka.Z)({},Lt),{},{style:{display:"none"}}),$t):vt=null;else{var yr,Or;bi===tm?Or="prepare":oS(bi)?Or="active":bi===T0&&(Or="start");var Cr=Lu(sr,"".concat(Bn,"-").concat(Or));vt=Mt((0,ka.Z)((0,ka.Z)({},Lt),{},{className:Ie()(Lu(sr,Bn),(yr={},(0,xu.Z)(yr,Cr,Cr&&Or),(0,xu.Z)(yr,sr,typeof sr=="string"),yr)),style:Zi}),$t)}if(j.isValidElement(vt)&&m1(vt)){var In=vt,Mi=In.ref;Mi||(vt=j.cloneElement(vt,{ref:$t}))}return j.createElement(PA,{ref:Tn},vt)});return F.displayName="CSSMotion",F}var sS=FA(lb),lg=G(97326),fb="add",I1="keep",Fu="remove",pb="removed";function zA(d){var y;return d&&(0,Fv.Z)(d)==="object"&&"key"in d?y=d:y={key:d},(0,ka.Z)((0,ka.Z)({},y),{},{key:String(y.key)})}function db(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return d.map(zA)}function uS(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],C=[],F=0,J=y.length,ie=db(d),me=db(y);ie.forEach(function(et){for(var bt=!1,Mt=F;Mt<J;Mt+=1){var sr=me[Mt];if(sr.key===et.key){F<Mt&&(C=C.concat(me.slice(F,Mt).map(function(Kt){return(0,ka.Z)((0,ka.Z)({},Kt),{},{status:fb})})),F=Mt),C.push((0,ka.Z)((0,ka.Z)({},sr),{},{status:I1})),F+=1,bt=!0;break}}bt||C.push((0,ka.Z)((0,ka.Z)({},et),{},{status:Fu}))}),F<J&&(C=C.concat(me.slice(F).map(function(et){return(0,ka.Z)((0,ka.Z)({},et),{},{status:fb})})));var ke={};C.forEach(function(et){var bt=et.key;ke[bt]=(ke[bt]||0)+1});var je=Object.keys(ke).filter(function(et){return ke[et]>1});return je.forEach(function(et){C=C.filter(function(bt){var Mt=bt.key,sr=bt.status;return Mt!==et||sr!==Fu}),C.forEach(function(bt){bt.key===et&&(bt.status=I1)})}),C}var vb=["component","children","onVisibleChanged","onAllRemoved"],lS=["status"],BA=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function NA(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sS,C=function(F){(0,$_.Z)(ie,F);var J=ly(ie);function ie(){var me;(0,w1.Z)(this,ie);for(var ke=arguments.length,je=new Array(ke),et=0;et<ke;et++)je[et]=arguments[et];return me=J.call.apply(J,[this].concat(je)),(0,xu.Z)((0,lg.Z)(me),"state",{keyEntities:[]}),(0,xu.Z)((0,lg.Z)(me),"removeKey",function(bt){var Mt=me.state.keyEntities,sr=Mt.map(function(Kt){return Kt.key!==bt?Kt:(0,ka.Z)((0,ka.Z)({},Kt),{},{status:pb})});return me.setState({keyEntities:sr}),sr.filter(function(Kt){var vr=Kt.status;return vr!==pb}).length}),me}return(0,S1.Z)(ie,[{key:"render",value:function(){var ke=this,je=this.state.keyEntities,et=this.props,bt=et.component,Mt=et.children,sr=et.onVisibleChanged,Kt=et.onAllRemoved,vr=(0,Gd.Z)(et,vb),Sr=bt||j.Fragment,Ar={};return BA.forEach(function(jr){Ar[jr]=vr[jr],delete vr[jr]}),delete vr.keys,j.createElement(Sr,vr,je.map(function(jr,Kr){var Tn=jr.status,En=(0,Gd.Z)(jr,lS),ui=Tn===fb||Tn===I1;return j.createElement(y,(0,Nf.Z)({},Ar,{key:En.key,visible:ui,eventProps:En,onVisibleChanged:function(Bn){if(sr==null||sr(Bn,{key:En.key}),!Bn){var bi=ke.removeKey(En.key);bi===0&&Kt&&Kt()}}}),function(ai,Bn){return Mt((0,ka.Z)((0,ka.Z)({},ai),{},{index:Kr}),Bn)})}))}}],[{key:"getDerivedStateFromProps",value:function(ke,je){var et=ke.keys,bt=je.keyEntities,Mt=db(et),sr=uS(bt,Mt);return{keyEntities:sr.filter(function(Kt){var vr=bt.find(function(Sr){var Ar=Sr.key;return Kt.key===Ar});return!(vr&&vr.status===pb&&Kt.status===Fu)})}}}]),ie}(j.Component);return(0,xu.Z)(C,"defaultProps",{component:"div"}),C}var $P=NA(lb),cS=sS;function ZA(d){var y=d.prefixCls,C=d.align,F=d.arrow,J=d.arrowPos,ie=F||{},me=ie.className,ke=ie.content,je=J.x,et=je===void 0?0:je,bt=J.y,Mt=bt===void 0?0:bt,sr=j.useRef();if(!C||!C.points)return null;var Kt={position:"absolute"};if(C.autoArrow!==!1){var vr=C.points[0],Sr=C.points[1],Ar=vr[0],jr=vr[1],Kr=Sr[0],Tn=Sr[1];Ar===Kr||!["t","b"].includes(Ar)?Kt.top=Mt:Ar==="t"?Kt.top=0:Kt.bottom=0,jr===Tn||!["l","r"].includes(jr)?Kt.left=et:jr==="l"?Kt.left=0:Kt.right=0}return j.createElement("div",{ref:sr,className:Ie()("".concat(y,"-arrow"),me),style:Kt},ke)}function mb(d){var y=d.prefixCls,C=d.open,F=d.zIndex,J=d.mask,ie=d.motion;return J?j.createElement(cS,(0,Nf.Z)({},ie,{motionAppear:!0,visible:C,removeOnLeave:!0}),function(me){var ke=me.className;return j.createElement("div",{style:{zIndex:F},className:Ie()("".concat(y,"-mask"),ke)})}):null}var UA=j.memo(function(d){var y=d.children;return y},function(d,y){return y.cache}),hS=UA,fS=j.forwardRef(function(d,y){var C=d.popup,F=d.className,J=d.prefixCls,ie=d.style,me=d.target,ke=d.onVisibleChanged,je=d.open,et=d.keepDom,bt=d.fresh,Mt=d.onClick,sr=d.mask,Kt=d.arrow,vr=d.arrowPos,Sr=d.align,Ar=d.motion,jr=d.maskMotion,Kr=d.forceRender,Tn=d.getPopupContainer,En=d.autoDestroy,ui=d.portal,ai=d.zIndex,Bn=d.onMouseEnter,bi=d.onMouseLeave,Zi=d.onPointerEnter,ei=d.ready,mi=d.offsetX,$t=d.offsetY,vt=d.offsetR,Lt=d.offsetB,yr=d.onAlign,Or=d.onPrepare,Cr=d.stretch,In=d.targetWidth,Mi=d.targetHeight,Ki=typeof C=="function"?C():C,Yo=je||et,Va=(Tn==null?void 0:Tn.length)>0,Co=j.useState(!Tn||!Va),kl=(0,Ia.Z)(Co,2),cu=kl[0],Bc=kl[1];if(Ap(function(){!cu&&Va&&me&&Bc(!0)},[cu,Va,me]),!cu)return null;var El="auto",fo={left:"-1000vw",top:"-1000vh",right:El,bottom:El};if(ei||!je){var qa,_o=Sr.points,Is=Sr.dynamicInset||((qa=Sr._experimental)===null||qa===void 0?void 0:qa.dynamicInset),xs=Is&&_o[0][1]==="r",no=Is&&_o[0][0]==="b";xs?(fo.right=vt,fo.left=El):(fo.left=mi,fo.right=El),no?(fo.bottom=Lt,fo.top=El):(fo.top=$t,fo.bottom=El)}var ps={};return Cr&&(Cr.includes("height")&&Mi?ps.height=Mi:Cr.includes("minHeight")&&Mi&&(ps.minHeight=Mi),Cr.includes("width")&&In?ps.width=In:Cr.includes("minWidth")&&In&&(ps.minWidth=In)),je||(ps.pointerEvents="none"),j.createElement(ui,{open:Kr||Yo,getContainer:Tn&&function(){return Tn(me)},autoDestroy:En},j.createElement(mb,{prefixCls:J,open:je,zIndex:ai,mask:sr,motion:jr}),j.createElement(E0,{onResize:yr,disabled:!je},function(wu){return j.createElement(cS,(0,Nf.Z)({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:Kr,leavedClassName:"".concat(J,"-hidden")},Ar,{onAppearPrepare:Or,onEnterPrepare:Or,visible:je,onVisibleChanged:function(ol){var ds;Ar==null||(ds=Ar.onVisibleChanged)===null||ds===void 0||ds.call(Ar,ol),ke(ol)}}),function($u,ol){var ds=$u.className,Ks=$u.style,ru=Ie()(J,ds,F);return j.createElement("div",{ref:V_(wu,y,ol),className:ru,style:(0,ka.Z)((0,ka.Z)((0,ka.Z)((0,ka.Z)({"--arrow-x":"".concat(vr.x||0,"px"),"--arrow-y":"".concat(vr.y||0,"px")},fo),ps),Ks),{},{boxSizing:"border-box",zIndex:ai},ie),onMouseEnter:Bn,onMouseLeave:bi,onPointerEnter:Zi,onClick:Mt},Kt&&j.createElement(ZA,{prefixCls:J,arrow:Kt,arrowPos:vr,align:Sr}),j.createElement(hS,{cache:!je&&!bt},Ki))})}))}),pS=fS,dS=j.forwardRef(function(d,y){var C=d.children,F=d.getTriggerDOMNode,J=m1(C),ie=j.useCallback(function(ke){pw(y,F?F(ke):ke)},[F]),me=v1(ie,C.ref);return J?j.cloneElement(C,{ref:me}):C}),jA=dS,Ig=j.createContext(null),gb=Ig;function yy(d){return d?Array.isArray(d)?d:[d]:[]}function VA(d,y,C,F){return j.useMemo(function(){var J=yy(C!=null?C:y),ie=yy(F!=null?F:y),me=new Set(J),ke=new Set(ie);return d&&(me.has("hover")&&(me.delete("hover"),me.add("click")),ke.has("hover")&&(ke.delete("hover"),ke.add("click"))),[me,ke]},[d,y,C,F])}var GA=function(d){if(!d)return!1;if(d instanceof Element){if(d.offsetParent)return!0;if(d.getBBox){var y=d.getBBox(),C=y.width,F=y.height;if(C||F)return!0}if(d.getBoundingClientRect){var J=d.getBoundingClientRect(),ie=J.width,me=J.height;if(ie||me)return!0}}return!1};function HA(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],C=arguments.length>2?arguments[2]:void 0;return C?d[0]===y[0]:d[0]===y[0]&&d[1]===y[1]}function $A(d,y,C,F){for(var J=C.points,ie=Object.keys(d),me=0;me<ie.length;me+=1){var ke,je=ie[me];if(HA((ke=d[je])===null||ke===void 0?void 0:ke.points,J,F))return"".concat(y,"-placement-").concat(je)}return""}function Lg(d,y,C,F){return y||(C?{motionName:"".concat(d,"-").concat(C)}:F?{motionName:F}:null)}function _y(d){return d.ownerDocument.defaultView}function yb(d){for(var y=[],C=d==null?void 0:d.parentElement,F=["hidden","scroll","clip","auto"];C;){var J=_y(C).getComputedStyle(C),ie=J.overflowX,me=J.overflowY,ke=J.overflow;[ie,me,ke].some(function(je){return F.includes(je)})&&y.push(C),C=C.parentElement}return y}function by(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Number.isNaN(d)?y:d}function xy(d){return by(parseFloat(d),0)}function vS(d,y){var C=(0,ka.Z)({},d);return(y||[]).forEach(function(F){if(!(F instanceof HTMLBodyElement||F instanceof HTMLHtmlElement)){var J=_y(F).getComputedStyle(F),ie=J.overflow,me=J.overflowClipMargin,ke=J.borderTopWidth,je=J.borderBottomWidth,et=J.borderLeftWidth,bt=J.borderRightWidth,Mt=F.getBoundingClientRect(),sr=F.offsetHeight,Kt=F.clientHeight,vr=F.offsetWidth,Sr=F.clientWidth,Ar=xy(ke),jr=xy(je),Kr=xy(et),Tn=xy(bt),En=by(Math.round(Mt.width/vr*1e3)/1e3),ui=by(Math.round(Mt.height/sr*1e3)/1e3),ai=(vr-Sr-Kr-Tn)*En,Bn=(sr-Kt-Ar-jr)*ui,bi=Ar*ui,Zi=jr*ui,ei=Kr*En,mi=Tn*En,$t=0,vt=0;if(ie==="clip"){var Lt=xy(me);$t=Lt*En,vt=Lt*ui}var yr=Mt.x+ei-$t,Or=Mt.y+bi-vt,Cr=yr+Mt.width+2*$t-ei-mi-ai,In=Or+Mt.height+2*vt-bi-Zi-Bn;C.left=Math.max(C.left,yr),C.top=Math.max(C.top,Or),C.right=Math.min(C.right,Cr),C.bottom=Math.min(C.bottom,In)}}),C}function L1(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,C="".concat(y),F=C.match(/^(.*)\%$/);return F?d*(parseFloat(F[1])/100):parseFloat(C)}function mS(d,y){var C=y||[],F=(0,Ia.Z)(C,2),J=F[0],ie=F[1];return[L1(d.width,J),L1(d.height,ie)]}function gS(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[d[0],d[1]]}function k0(d,y){var C=y[0],F=y[1],J,ie;return C==="t"?ie=d.y:C==="b"?ie=d.y+d.height:ie=d.y+d.height/2,F==="l"?J=d.x:F==="r"?J=d.x+d.width:J=d.x+d.width/2,{x:J,y:ie}}function Rg(d,y){var C={t:"b",b:"t",l:"r",r:"l"};return d.map(function(F,J){return J===y?C[F]||"c":F}).join("")}function _b(d,y,C,F,J,ie,me){var ke=j.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:J[F]||{}}),je=(0,Ia.Z)(ke,2),et=je[0],bt=je[1],Mt=j.useRef(0),sr=j.useMemo(function(){return y?yb(y):[]},[y]),Kt=j.useRef({}),vr=function(){Kt.current={}};d||vr();var Sr=Ev(function(){if(y&&C&&d){let om=function(pg,s0){var B0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ks,N0=Mi.x+pg,Z0=Mi.y+s0,U0=N0+fo,u0=Z0+El,Wb=Math.max(N0,B0.left),Xb=Math.max(Z0,B0.top),Yb=Math.min(U0,B0.right),qb=Math.min(u0,B0.bottom);return Math.max(0,(Yb-Wb)*(qb-Xb))},V1=function(){nd=Mi.y+oc,gh=nd+El,id=Mi.x+ac,Id=id+fo};var Kr,Tn,En=y,ui=En.ownerDocument,ai=_y(En),Bn=ai.getComputedStyle(En),bi=Bn.width,Zi=Bn.height,ei=Bn.position,mi=En.style.left,$t=En.style.top,vt=En.style.right,Lt=En.style.bottom,yr=(0,ka.Z)((0,ka.Z)({},J[F]),ie),Or=ui.createElement("div");(Kr=En.parentElement)===null||Kr===void 0||Kr.appendChild(Or),Or.style.left="".concat(En.offsetLeft,"px"),Or.style.top="".concat(En.offsetTop,"px"),Or.style.position=ei,Or.style.height="".concat(En.offsetHeight,"px"),Or.style.width="".concat(En.offsetWidth,"px"),En.style.left="0",En.style.top="0",En.style.right="auto",En.style.bottom="auto";var Cr;if(Array.isArray(C))Cr={x:C[0],y:C[1],width:0,height:0};else{var In=C.getBoundingClientRect();Cr={x:In.x,y:In.y,width:In.width,height:In.height}}var Mi=En.getBoundingClientRect(),Ki=ui.documentElement,Yo=Ki.clientWidth,Va=Ki.clientHeight,Co=Ki.scrollWidth,kl=Ki.scrollHeight,cu=Ki.scrollTop,Bc=Ki.scrollLeft,El=Mi.height,fo=Mi.width,qa=Cr.height,_o=Cr.width,Is={left:0,top:0,right:Yo,bottom:Va},xs={left:-Bc,top:-cu,right:Co-Bc,bottom:kl-cu},no=yr.htmlRegion,ps="visible",wu="visibleFirst";no!=="scroll"&&no!==wu&&(no=ps);var $u=no===wu,ol=vS(xs,sr),ds=vS(Is,sr),Ks=no===ps?ds:ol,ru=$u?ds:Ks;En.style.left="auto",En.style.top="auto",En.style.right="0",En.style.bottom="0";var Ru=En.getBoundingClientRect();En.style.left=mi,En.style.top=$t,En.style.right=vt,En.style.bottom=Lt,(Tn=En.parentElement)===null||Tn===void 0||Tn.removeChild(Or);var Js=by(Math.round(fo/parseFloat(bi)*1e3)/1e3),Nc=by(Math.round(El/parseFloat(Zi)*1e3)/1e3);if(Js===0||Nc===0||Xl(C)&&!GA(C))return;var Vp=yr.offset,jh=yr.targetOffset,hu=mS(Mi,Vp),mh=(0,Ia.Z)(hu,2),Qc=mh[0],Bl=mh[1],Zf=mS(Cr,jh),Cl=(0,Ia.Z)(Zf,2),Qp=Cl[0],ed=Cl[1];Cr.x-=Qp,Cr.y-=ed;var hv=yr.points||[],td=(0,Ia.Z)(hv,2),Uf=td[0],jf=td[1],Vf=gS(jf),Mc=gS(Uf),Nv=k0(Cr,Vf),yd=k0(Mi,Mc),Gp=(0,ka.Z)({},yr),ac=Nv.x-yd.x+Qc,oc=Nv.y-yd.y+Bl,sc=om(ac,oc),rd=om(ac,oc,ds),Ls=k0(Cr,["t","l"]),ju=k0(Mi,["t","l"]),pa=k0(Cr,["b","r"]),No=k0(Mi,["b","r"]),co=yr.overflow||{},Bs=co.adjustX,Nl=co.adjustY,Zl=co.shiftX,_d=co.shiftY,bd=function(s0){return typeof s0=="boolean"?s0:s0>=0},nd,gh,id,Id;V1();var rm=bd(Nl),Rs=Mc[0]===Vf[0];if(rm&&Mc[0]==="t"&&(gh>ru.bottom||Kt.current.bt)){var es=oc;Rs?es-=El-qa:es=Ls.y-No.y-Bl;var nu=om(ac,es),Gf=om(ac,es,ds);nu>sc||nu===sc&&(!$u||Gf>=rd)?(Kt.current.bt=!0,oc=es,Bl=-Bl,Gp.points=[Rg(Mc,0),Rg(Vf,0)]):Kt.current.bt=!1}if(rm&&Mc[0]==="b"&&(nd<ru.top||Kt.current.tb)){var uc=oc;Rs?uc+=El-qa:uc=pa.y-ju.y-Bl;var zg=om(ac,uc),Cm=om(ac,uc,ds);zg>sc||zg===sc&&(!$u||Cm>=rd)?(Kt.current.tb=!0,oc=uc,Bl=-Bl,Gp.points=[Rg(Mc,0),Rg(Vf,0)]):Kt.current.tb=!1}var Bg=bd(Bs),Ng=Mc[1]===Vf[1];if(Bg&&Mc[1]==="l"&&(Id>ru.right||Kt.current.rl)){var nm=ac;Ng?nm-=fo-_o:nm=Ls.x-No.x-Qc;var Am=om(nm,oc),Ry=om(nm,oc,ds);Am>sc||Am===sc&&(!$u||Ry>=rd)?(Kt.current.rl=!0,ac=nm,Qc=-Qc,Gp.points=[Rg(Mc,1),Rg(Vf,1)]):Kt.current.rl=!1}if(Bg&&Mc[1]==="r"&&(id<ru.left||Kt.current.lr)){var Ym=ac;Ng?Ym+=fo-_o:Ym=pa.x-ju.x-Qc;var i0=om(Ym,oc),Zg=om(Ym,oc,ds);i0>sc||i0===sc&&(!$u||Zg>=rd)?(Kt.current.lr=!0,ac=Ym,Qc=-Qc,Gp.points=[Rg(Mc,1),Rg(Vf,1)]):Kt.current.lr=!1}V1();var im=Zl===!0?0:Zl;typeof im=="number"&&(id<ds.left&&(ac-=id-ds.left-Qc,Cr.x+_o<ds.left+im&&(ac+=Cr.x-ds.left+_o-im)),Id>ds.right&&(ac-=Id-ds.right-Qc,Cr.x>ds.right-im&&(ac+=Cr.x-ds.right+im)));var hg=_d===!0?0:_d;typeof hg=="number"&&(nd<ds.top&&(oc-=nd-ds.top-Bl,Cr.y+qa<ds.top+hg&&(oc+=Cr.y-ds.top+qa-hg)),gh>ds.bottom&&(oc-=gh-ds.bottom-Bl,Cr.y>ds.bottom-hg&&(oc+=Cr.y-ds.bottom+hg)));var Ug=Mi.x+ac,jg=Ug+fo,Tm=Mi.y+oc,a0=Tm+El,Mm=Cr.x,Tu=Mm+_o,fu=Cr.y,ap=fu+qa,ad=Math.max(Ug,Mm),Yl=Math.min(jg,Tu),Ld=(ad+Yl)/2,xd=Ld-Ug,Pm=Math.max(Tm,fu),am=Math.min(a0,ap),fg=(Pm+am)/2,km=fg-Tm;me==null||me(y,Gp);var o0=Ru.right-Mi.x-(ac+Mi.width),g3=Ru.bottom-Mi.y-(oc+Mi.height);bt({ready:!0,offsetX:ac/Js,offsetY:oc/Nc,offsetR:o0/Js,offsetB:g3/Nc,arrowX:xd/Js,arrowY:km/Nc,scaleX:Js,scaleY:Nc,align:Gp})}}),Ar=function(){Mt.current+=1;var Tn=Mt.current;Promise.resolve().then(function(){Mt.current===Tn&&Sr()})},jr=function(){bt(function(Tn){return(0,ka.Z)((0,ka.Z)({},Tn),{},{ready:!1})})};return Ap(jr,[F]),Ap(function(){d||jr()},[d]),[et.ready,et.offsetX,et.offsetY,et.offsetR,et.offsetB,et.arrowX,et.arrowY,et.scaleX,et.scaleY,et.align,Ar]}function WA(d,y,C,F,J){Ap(function(){if(d&&y&&C){let Mt=function(){F(),J()};var ie=y,me=C,ke=yb(ie),je=yb(me),et=_y(me),bt=new Set([et].concat((0,uv.Z)(ke),(0,uv.Z)(je)));return bt.forEach(function(sr){sr.addEventListener("scroll",Mt,{passive:!0})}),et.addEventListener("resize",Mt,{passive:!0}),F(),function(){bt.forEach(function(sr){sr.removeEventListener("scroll",Mt),et.removeEventListener("resize",Mt)})}}},[d,y,C])}function XA(d,y,C,F,J,ie,me,ke){var je=j.useRef(d),et=j.useRef(!1);je.current!==d&&(et.current=!0,je.current=d),j.useEffect(function(){var bt=cv(function(){et.current=!1});return function(){cv.cancel(bt)}},[d]),j.useEffect(function(){if(y&&F&&(!J||ie)){var bt=function(){var ei=!1,mi=function(Lt){var yr=Lt.target;ei=me(yr)},$t=function(Lt){var yr=Lt.target;!et.current&&je.current&&!ei&&!me(yr)&&ke(!1)};return[mi,$t]},Mt=bt(),sr=(0,Ia.Z)(Mt,2),Kt=sr[0],vr=sr[1],Sr=bt(),Ar=(0,Ia.Z)(Sr,2),jr=Ar[0],Kr=Ar[1],Tn=_y(F);Tn.addEventListener("mousedown",Kt,!0),Tn.addEventListener("click",vr,!0),Tn.addEventListener("contextmenu",vr,!0);var En=ab(C);if(En&&(En.addEventListener("mousedown",jr,!0),En.addEventListener("click",Kr,!0),En.addEventListener("contextmenu",Kr,!0)),!1)var ui,ai,Bn,bi;return function(){Tn.removeEventListener("mousedown",Kt,!0),Tn.removeEventListener("click",vr,!0),Tn.removeEventListener("contextmenu",vr,!0),En&&(En.removeEventListener("mousedown",jr,!0),En.removeEventListener("click",Kr,!0),En.removeEventListener("contextmenu",Kr,!0))}}},[y,C,F,J,ie])}var YA=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function qA(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ib,y=j.forwardRef(function(C,F){var J=C.prefixCls,ie=J===void 0?"rc-trigger-popup":J,me=C.children,ke=C.action,je=ke===void 0?"hover":ke,et=C.showAction,bt=C.hideAction,Mt=C.popupVisible,sr=C.defaultPopupVisible,Kt=C.onPopupVisibleChange,vr=C.afterPopupVisibleChange,Sr=C.mouseEnterDelay,Ar=C.mouseLeaveDelay,jr=Ar===void 0?.1:Ar,Kr=C.focusDelay,Tn=C.blurDelay,En=C.mask,ui=C.maskClosable,ai=ui===void 0?!0:ui,Bn=C.getPopupContainer,bi=C.forceRender,Zi=C.autoDestroy,ei=C.destroyPopupOnHide,mi=C.popup,$t=C.popupClassName,vt=C.popupStyle,Lt=C.popupPlacement,yr=C.builtinPlacements,Or=yr===void 0?{}:yr,Cr=C.popupAlign,In=C.zIndex,Mi=C.stretch,Ki=C.getPopupClassNameFromAlign,Yo=C.fresh,Va=C.alignPoint,Co=C.onPopupClick,kl=C.onPopupAlign,cu=C.arrow,Bc=C.popupMotion,El=C.maskMotion,fo=C.popupTransitionName,qa=C.popupAnimation,_o=C.maskTransitionName,Is=C.maskAnimation,xs=C.className,no=C.getTriggerDOMNode,ps=(0,Gd.Z)(C,YA),wu=Zi||ei||!1,$u=j.useState(!1),ol=(0,Ia.Z)($u,2),ds=ol[0],Ks=ol[1];Ap(function(){Ks(hw())},[]);var ru=j.useRef({}),Ru=j.useContext(gb),Js=j.useMemo(function(){return{registerSubPopup:function(Wu,op){ru.current[Wu]=op,Ru==null||Ru.registerSubPopup(Wu,op)}}},[Ru]),Nc=Kw(),Vp=j.useState(null),jh=(0,Ia.Z)(Vp,2),hu=jh[0],mh=jh[1],Qc=Ev(function(rs){Xl(rs)&&hu!==rs&&mh(rs),Ru==null||Ru.registerSubPopup(Nc,rs)}),Bl=j.useState(null),Zf=(0,Ia.Z)(Bl,2),Cl=Zf[0],Qp=Zf[1],ed=j.useRef(null),hv=Ev(function(rs){Xl(rs)&&Cl!==rs&&(Qp(rs),ed.current=rs)}),td=j.Children.only(me),Uf=(td==null?void 0:td.props)||{},jf={},Vf=Ev(function(rs){var Wu,op,od=Cl;return(od==null?void 0:od.contains(rs))||((Wu=ab(od))===null||Wu===void 0?void 0:Wu.host)===rs||rs===od||(hu==null?void 0:hu.contains(rs))||((op=ab(hu))===null||op===void 0?void 0:op.host)===rs||rs===hu||Object.values(ru.current).some(function(sp){return(sp==null?void 0:sp.contains(rs))||rs===sp})}),Mc=Lg(ie,Bc,qa,fo),Nv=Lg(ie,El,Is,_o),yd=j.useState(sr||!1),Gp=(0,Ia.Z)(yd,2),ac=Gp[0],oc=Gp[1],sc=Mt!=null?Mt:ac,rd=Ev(function(rs){Mt===void 0&&oc(rs)});Ap(function(){oc(Mt||!1)},[Mt]);var Ls=j.useRef(sc);Ls.current=sc;var ju=Ev(function(rs){(0,$m.flushSync)(function(){sc!==rs&&(rd(rs),Kt==null||Kt(rs))})}),pa=j.useRef(),No=function(){clearTimeout(pa.current)},co=function(Wu){var op=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;No(),op===0?ju(Wu):pa.current=setTimeout(function(){ju(Wu)},op*1e3)};j.useEffect(function(){return No},[]);var Bs=j.useState(!1),Nl=(0,Ia.Z)(Bs,2),Zl=Nl[0],_d=Nl[1];Ap(function(rs){(!rs||sc)&&_d(!0)},[sc]);var bd=j.useState(null),nd=(0,Ia.Z)(bd,2),gh=nd[0],id=nd[1],Id=j.useState([0,0]),rm=(0,Ia.Z)(Id,2),Rs=rm[0],es=rm[1],nu=function(Wu){es([Wu.clientX,Wu.clientY])},Gf=_b(sc,hu,Va?Rs:Cl,Lt,Or,Cr,kl),uc=(0,Ia.Z)(Gf,11),zg=uc[0],Cm=uc[1],Bg=uc[2],Ng=uc[3],nm=uc[4],Am=uc[5],Ry=uc[6],Ym=uc[7],i0=uc[8],Zg=uc[9],im=uc[10],hg=VA(ds,je,et,bt),Ug=(0,Ia.Z)(hg,2),jg=Ug[0],Tm=Ug[1],a0=jg.has("click"),Mm=Tm.has("click")||Tm.has("contextMenu"),Tu=Ev(function(){Zl||im()}),fu=function(){Ls.current&&Va&&Mm&&co(!1)};WA(sc,Cl,hu,Tu,fu),Ap(function(){Tu()},[Rs,Lt]),Ap(function(){sc&&!(Or!=null&&Or[Lt])&&Tu()},[JSON.stringify(Cr)]);var ap=j.useMemo(function(){var rs=$A(Or,ie,Zg,Va);return Ie()(rs,Ki==null?void 0:Ki(Zg))},[Zg,Ki,Or,ie,Va]);j.useImperativeHandle(F,function(){return{nativeElement:ed.current,forceAlign:Tu}});var ad=j.useState(0),Yl=(0,Ia.Z)(ad,2),Ld=Yl[0],xd=Yl[1],Pm=j.useState(0),am=(0,Ia.Z)(Pm,2),fg=am[0],km=am[1],o0=function(){if(Mi&&Cl){var Wu=Cl.getBoundingClientRect();xd(Wu.width),km(Wu.height)}},g3=function(){o0(),Tu()},om=function(Wu){_d(!1),im(),vr==null||vr(Wu)},V1=function(){return new Promise(function(Wu){o0(),id(function(){return Wu})})};Ap(function(){gh&&(im(),gh(),id(null))},[gh]);function pg(rs,Wu,op,od){jf[rs]=function(sp){var G1;od==null||od(sp),co(Wu,op);for(var Kb=arguments.length,y3=new Array(Kb>1?Kb-1:0),Dy=1;Dy<Kb;Dy++)y3[Dy-1]=arguments[Dy];(G1=Uf[rs])===null||G1===void 0||G1.call.apply(G1,[Uf,sp].concat(y3))}}(a0||Mm)&&(jf.onClick=function(rs){var Wu;Ls.current&&Mm?co(!1):!Ls.current&&a0&&(nu(rs),co(!0));for(var op=arguments.length,od=new Array(op>1?op-1:0),sp=1;sp<op;sp++)od[sp-1]=arguments[sp];(Wu=Uf.onClick)===null||Wu===void 0||Wu.call.apply(Wu,[Uf,rs].concat(od))}),XA(sc,Mm,Cl,hu,En,ai,Vf,co);var s0=jg.has("hover"),B0=Tm.has("hover"),N0,Z0;s0&&(pg("onMouseEnter",!0,Sr,function(rs){nu(rs)}),pg("onPointerEnter",!0,Sr,function(rs){nu(rs)}),N0=function(){(sc||Zl)&&co(!0,Sr)},Va&&(jf.onMouseMove=function(rs){var Wu;(Wu=Uf.onMouseMove)===null||Wu===void 0||Wu.call(Uf,rs)})),B0&&(pg("onMouseLeave",!1,jr),pg("onPointerLeave",!1,jr),Z0=function(){co(!1,jr)}),jg.has("focus")&&pg("onFocus",!0,Kr),Tm.has("focus")&&pg("onBlur",!1,Tn),jg.has("contextMenu")&&(jf.onContextMenu=function(rs){var Wu;Ls.current&&Tm.has("contextMenu")?co(!1):(nu(rs),co(!0)),rs.preventDefault();for(var op=arguments.length,od=new Array(op>1?op-1:0),sp=1;sp<op;sp++)od[sp-1]=arguments[sp];(Wu=Uf.onContextMenu)===null||Wu===void 0||Wu.call.apply(Wu,[Uf,rs].concat(od))}),xs&&(jf.className=Ie()(Uf.className,xs));var U0=(0,ka.Z)((0,ka.Z)({},Uf),jf),u0={},Wb=["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"];Wb.forEach(function(rs){ps[rs]&&(u0[rs]=function(){for(var Wu,op=arguments.length,od=new Array(op),sp=0;sp<op;sp++)od[sp]=arguments[sp];(Wu=U0[rs])===null||Wu===void 0||Wu.call.apply(Wu,[U0].concat(od)),ps[rs].apply(ps,od)})});var Xb=j.cloneElement(td,(0,ka.Z)((0,ka.Z)({},U0),u0)),Yb={x:Am,y:Ry},qb=cu?(0,ka.Z)({},cu!==!0?cu:{}):null;return j.createElement(j.Fragment,null,j.createElement(E0,{disabled:!sc,ref:hv,onResize:g3},j.createElement(jA,{getTriggerDOMNode:no},Xb)),j.createElement(gb.Provider,{value:Js},j.createElement(pS,{portal:d,ref:Qc,prefixCls:ie,popup:mi,className:Ie()($t,ap),style:vt,target:Cl,onMouseEnter:N0,onMouseLeave:Z0,onPointerEnter:N0,zIndex:In,open:sc,keepDom:Zl,fresh:Yo,onClick:Co,mask:En,motion:Mc,maskMotion:Nv,onVisibleChanged:om,onPrepare:V1,forceRender:bi,autoDestroy:wu,getPopupContainer:Bn,align:Zg,arrow:qb,arrowPos:Yb,ready:zg,offsetX:Cm,offsetY:Bg,offsetR:Ng,offsetB:nm,onAlign:Tu,stretch:Mi,targetWidth:Ld/Ym,targetHeight:fg/i0})))});return y}var KA=qA(ib),JA=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],QA=function(y){var C=y===!0?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:C,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:C,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:C,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:C,adjustY:1},htmlRegion:"scroll"}}},wy=function(y,C){var F=y.prefixCls,J=y.disabled,ie=y.visible,me=y.children,ke=y.popupElement,je=y.animation,et=y.transitionName,bt=y.dropdownStyle,Mt=y.dropdownClassName,sr=y.direction,Kt=sr===void 0?"ltr":sr,vr=y.placement,Sr=y.builtinPlacements,Ar=y.dropdownMatchSelectWidth,jr=y.dropdownRender,Kr=y.dropdownAlign,Tn=y.getPopupContainer,En=y.empty,ui=y.getTriggerDOMNode,ai=y.onPopupVisibleChange,Bn=y.onPopupMouseEnter,bi=(0,Gd.Z)(y,JA),Zi="".concat(F,"-dropdown"),ei=ke;jr&&(ei=jr(ke));var mi=j.useMemo(function(){return Sr||QA(Ar)},[Sr,Ar]),$t=je?"".concat(Zi,"-").concat(je):et,vt=typeof Ar=="number",Lt=j.useMemo(function(){return vt?null:Ar===!1?"minWidth":"width"},[Ar,vt]),yr=bt;vt&&(yr=(0,ka.Z)((0,ka.Z)({},yr),{},{width:Ar}));var Or=j.useRef(null);return j.useImperativeHandle(C,function(){return{getPopupElement:function(){return Or.current}}}),j.createElement(KA,(0,Nf.Z)({},bi,{showAction:ai?["click"]:[],hideAction:ai?["click"]:[],popupPlacement:vr||(Kt==="rtl"?"bottomRight":"bottomLeft"),builtinPlacements:mi,prefixCls:Zi,popupTransitionName:$t,popup:j.createElement("div",{ref:Or,onMouseEnter:Bn},ei),stretch:Lt,popupAlign:Kr,popupVisible:ie,getPopupContainer:Tn,popupClassName:Ie()(Mt,(0,xu.Z)({},"".concat(Zi,"-empty"),En)),popupStyle:yr,getTriggerDOMNode:ui,onPopupVisibleChange:ai}),me)},bb=j.forwardRef(wy);bb.displayName="SelectTrigger";var eT=bb,yS=G(84506);function xb(d,y){var C=d.key,F;return"value"in d&&(F=d.value),C!=null?C:F!==void 0?F:"rc-index-key-".concat(y)}function wb(d,y){var C=d||{},F=C.label,J=C.value,ie=C.options,me=C.groupLabel,ke=F||(y?"children":"label");return{label:ke,value:J||"value",options:ie||"options",groupLabel:me||ke}}function R1(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=y.fieldNames,F=y.childrenAsData,J=[],ie=wb(C,!1),me=ie.label,ke=ie.value,je=ie.options,et=ie.groupLabel;function bt(Mt,sr){Mt.forEach(function(Kt){if(sr||!(je in Kt)){var vr=Kt[ke];J.push({key:xb(Kt,J.length),groupOption:sr,data:Kt,label:Kt[me],value:vr})}else{var Sr=Kt[et];Sr===void 0&&F&&(Sr=Kt.label),J.push({key:xb(Kt,J.length),group:!0,data:Kt,label:Sr}),bt(Kt[je],!0)}})}return bt(d,!1),J}function _S(d){var y=(0,ka.Z)({},d);return"props"in y||Object.defineProperty(y,"props",{get:function(){return p5(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),y}}),y}function jp(d,y){if(!y||!y.length)return null;var C=!1;function F(ie,me){var ke=(0,yS.Z)(me),je=ke[0],et=ke.slice(1);if(!je)return[ie];var bt=ie.split(je);return C=C||bt.length>1,bt.reduce(function(Mt,sr){return[].concat((0,uv.Z)(Mt),(0,uv.Z)(F(sr,et)))},[]).filter(function(Mt){return Mt})}var J=F(d,y);return C?J:null}var Dg=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],I0=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"];function Sy(d){return d==="tags"||d==="multiple"}var Og=j.forwardRef(function(d,y){var C,F,J=d.id,ie=d.prefixCls,me=d.className,ke=d.showSearch,je=d.tagRender,et=d.direction,bt=d.omitDomProps,Mt=d.displayValues,sr=d.onDisplayValuesChange,Kt=d.emptyOptions,vr=d.notFoundContent,Sr=vr===void 0?"Not Found":vr,Ar=d.onClear,jr=d.mode,Kr=d.disabled,Tn=d.loading,En=d.getInputElement,ui=d.getRawInputElement,ai=d.open,Bn=d.defaultOpen,bi=d.onDropdownVisibleChange,Zi=d.activeValue,ei=d.onActiveValueChange,mi=d.activeDescendantId,$t=d.searchValue,vt=d.autoClearSearchValue,Lt=d.onSearch,yr=d.onSearchSplit,Or=d.tokenSeparators,Cr=d.allowClear,In=d.suffixIcon,Mi=d.clearIcon,Ki=d.OptionList,Yo=d.animation,Va=d.transitionName,Co=d.dropdownStyle,kl=d.dropdownClassName,cu=d.dropdownMatchSelectWidth,Bc=d.dropdownRender,El=d.dropdownAlign,fo=d.placement,qa=d.builtinPlacements,_o=d.getPopupContainer,Is=d.showAction,xs=Is===void 0?[]:Is,no=d.onFocus,ps=d.onBlur,wu=d.onKeyUp,$u=d.onKeyDown,ol=d.onMouseDown,ds=(0,Gd.Z)(d,Dg),Ks=Sy(jr),ru=(ke!==void 0?ke:Ks)||jr==="combobox",Ru=(0,ka.Z)({},ds);I0.forEach(function(Tu){delete Ru[Tu]}),bt==null||bt.forEach(function(Tu){delete Ru[Tu]});var Js=j.useState(!1),Nc=(0,Ia.Z)(Js,2),Vp=Nc[0],jh=Nc[1];j.useEffect(function(){jh(hw())},[]);var hu=j.useRef(null),mh=j.useRef(null),Qc=j.useRef(null),Bl=j.useRef(null),Zf=j.useRef(null),Cl=j.useRef(!1),Qp=ZP(),ed=(0,Ia.Z)(Qp,3),hv=ed[0],td=ed[1],Uf=ed[2];j.useImperativeHandle(y,function(){var Tu,fu;return{focus:(Tu=Bl.current)===null||Tu===void 0?void 0:Tu.focus,blur:(fu=Bl.current)===null||fu===void 0?void 0:fu.blur,scrollTo:function(ad){var Yl;return(Yl=Zf.current)===null||Yl===void 0?void 0:Yl.scrollTo(ad)}}});var jf=j.useMemo(function(){var Tu;if(jr!=="combobox")return $t;var fu=(Tu=Mt[0])===null||Tu===void 0?void 0:Tu.value;return typeof fu=="string"||typeof fu=="number"?String(fu):""},[$t,jr,Mt]),Vf=jr==="combobox"&&typeof En=="function"&&En()||null,Mc=typeof ui=="function"&&ui(),Nv=v1(mh,Mc==null||(C=Mc.props)===null||C===void 0?void 0:C.ref),yd=j.useState(!1),Gp=(0,Ia.Z)(yd,2),ac=Gp[0],oc=Gp[1];Ap(function(){oc(!0)},[]);var sc=U_(!1,{defaultValue:Bn,value:ai}),rd=(0,Ia.Z)(sc,2),Ls=rd[0],ju=rd[1],pa=ac?Ls:!1,No=!Sr&&Kt;(Kr||No&&pa&&jr==="combobox")&&(pa=!1);var co=No?!1:pa,Bs=j.useCallback(function(Tu){var fu=Tu!==void 0?Tu:!pa;Kr||(ju(fu),pa!==fu&&(bi==null||bi(fu)))},[Kr,pa,ju,bi]),Nl=j.useMemo(function(){return(Or||[]).some(function(Tu){return[`
`,`\r
`].includes(Tu)})},[Or]),Zl=function(fu,ap,ad){var Yl=!0,Ld=fu;ei==null||ei(null);var xd=ad?null:jp(fu,Or);return jr!=="combobox"&&xd&&(Ld="",yr==null||yr(xd),Bs(!1),Yl=!1),Lt&&jf!==Ld&&Lt(Ld,{source:ap?"typing":"effect"}),Yl},_d=function(fu){!fu||!fu.trim()||Lt(fu,{source:"submit"})};j.useEffect(function(){!pa&&!Ks&&jr!=="combobox"&&Zl("",!1,!1)},[pa]),j.useEffect(function(){Ls&&Kr&&ju(!1),Kr&&!Cl.current&&td(!1)},[Kr]);var bd=vw(),nd=(0,Ia.Z)(bd,2),gh=nd[0],id=nd[1],Id=function(fu){var ap=gh(),ad=fu.which;if(ad===Qu.ENTER&&(jr!=="combobox"&&fu.preventDefault(),pa||Bs(!0)),id(!!jf),ad===Qu.BACKSPACE&&!ap&&Ks&&!jf&&Mt.length){for(var Yl=(0,uv.Z)(Mt),Ld=null,xd=Yl.length-1;xd>=0;xd-=1){var Pm=Yl[xd];if(!Pm.disabled){Yl.splice(xd,1),Ld=Pm;break}}Ld&&sr(Yl,{type:"remove",values:[Ld]})}for(var am=arguments.length,fg=new Array(am>1?am-1:0),km=1;km<am;km++)fg[km-1]=arguments[km];if(pa&&Zf.current){var o0;(o0=Zf.current).onKeyDown.apply(o0,[fu].concat(fg))}$u==null||$u.apply(void 0,[fu].concat(fg))},rm=function(fu){for(var ap=arguments.length,ad=new Array(ap>1?ap-1:0),Yl=1;Yl<ap;Yl++)ad[Yl-1]=arguments[Yl];if(pa&&Zf.current){var Ld;(Ld=Zf.current).onKeyUp.apply(Ld,[fu].concat(ad))}wu==null||wu.apply(void 0,[fu].concat(ad))},Rs=function(fu){var ap=Mt.filter(function(ad){return ad!==fu});sr(ap,{type:"remove",values:[fu]})},es=j.useRef(!1),nu=function(){td(!0),Kr||(no&&!es.current&&no.apply(void 0,arguments),xs.includes("focus")&&Bs(!0)),es.current=!0},Gf=function(){Cl.current=!0,td(!1,function(){es.current=!1,Cl.current=!1,Bs(!1)}),!Kr&&(jf&&(jr==="tags"?Lt(jf,{source:"submit"}):jr==="multiple"&&Lt("",{source:"blur"})),ps&&ps.apply(void 0,arguments))},uc=[];j.useEffect(function(){return function(){uc.forEach(function(Tu){return clearTimeout(Tu)}),uc.splice(0,uc.length)}},[]);var zg=function(fu){var ap,ad=fu.target,Yl=(ap=Qc.current)===null||ap===void 0?void 0:ap.getPopupElement();if(Yl&&Yl.contains(ad)){var Ld=setTimeout(function(){var fg=uc.indexOf(Ld);if(fg!==-1&&uc.splice(fg,1),Uf(),!Vp&&!Yl.contains(document.activeElement)){var km;(km=Bl.current)===null||km===void 0||km.focus()}});uc.push(Ld)}for(var xd=arguments.length,Pm=new Array(xd>1?xd-1:0),am=1;am<xd;am++)Pm[am-1]=arguments[am];ol==null||ol.apply(void 0,[fu].concat(Pm))},Cm=j.useState({}),Bg=(0,Ia.Z)(Cm,2),Ng=Bg[1];function nm(){Ng({})}var Am;Mc&&(Am=function(fu){Bs(fu)}),UP(function(){var Tu;return[hu.current,(Tu=Qc.current)===null||Tu===void 0?void 0:Tu.getPopupElement()]},co,Bs,!!Mc);var Ry=j.useMemo(function(){return(0,ka.Z)((0,ka.Z)({},d),{},{notFoundContent:Sr,open:pa,triggerOpen:co,id:J,showSearch:ru,multiple:Ks,toggleOpen:Bs})},[d,Sr,co,pa,J,ru,Ks,Bs]),Ym=!!In||Tn,i0;Ym&&(i0=j.createElement(g1,{className:Ie()("".concat(ie,"-arrow"),(0,xu.Z)({},"".concat(ie,"-arrow-loading"),Tn)),customizeIcon:In,customizeIconProps:{loading:Tn,searchValue:jf,open:pa,focused:hv,showSearch:ru}}));var Zg=function(){var fu;Ar==null||Ar(),(fu=Bl.current)===null||fu===void 0||fu.focus(),sr([],{type:"clear",values:Mt}),Zl("",!1,!1)},im=dw(ie,Zg,Mt,Cr,Mi,Kr,jf,jr),hg=im.allowClear,Ug=im.clearIcon,jg=j.createElement(Ki,{ref:Zf}),Tm=Ie()(ie,me,(F={},(0,xu.Z)(F,"".concat(ie,"-focused"),hv),(0,xu.Z)(F,"".concat(ie,"-multiple"),Ks),(0,xu.Z)(F,"".concat(ie,"-single"),!Ks),(0,xu.Z)(F,"".concat(ie,"-allow-clear"),Cr),(0,xu.Z)(F,"".concat(ie,"-show-arrow"),Ym),(0,xu.Z)(F,"".concat(ie,"-disabled"),Kr),(0,xu.Z)(F,"".concat(ie,"-loading"),Tn),(0,xu.Z)(F,"".concat(ie,"-open"),pa),(0,xu.Z)(F,"".concat(ie,"-customize-input"),Vf),(0,xu.Z)(F,"".concat(ie,"-show-search"),ru),F)),a0=j.createElement(eT,{ref:Qc,disabled:Kr,prefixCls:ie,visible:co,popupElement:jg,animation:Yo,transitionName:Va,dropdownStyle:Co,dropdownClassName:kl,direction:et,dropdownMatchSelectWidth:cu,dropdownRender:Bc,dropdownAlign:El,placement:fo,builtinPlacements:qa,getPopupContainer:_o,empty:Kt,getTriggerDOMNode:function(){return mh.current},onPopupVisibleChange:Am,onPopupMouseEnter:nm},Mc?j.cloneElement(Mc,{ref:Nv}):j.createElement(pA,(0,Nf.Z)({},d,{domRef:mh,prefixCls:ie,inputElement:Vf,ref:Bl,id:J,showSearch:ru,autoClearSearchValue:vt,mode:jr,activeDescendantId:mi,tagRender:je,values:Mt,open:pa,onToggleOpen:Bs,activeValue:Zi,searchValue:jf,onSearch:Zl,onSearchSubmit:_d,onRemove:Rs,tokenWithEnter:Nl}))),Mm;return Mc?Mm=a0:Mm=j.createElement("div",(0,Nf.Z)({className:Tm},Ru,{ref:hu,onMouseDown:zg,onKeyDown:Id,onKeyUp:rm,onFocus:nu,onBlur:Gf}),hv&&!pa&&j.createElement("span",{style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0},"aria-live":"polite"},"".concat(Mt.map(function(Tu){var fu=Tu.label,ap=Tu.value;return["number","string"].includes((0,Fv.Z)(fu))?fu:ap}).join(", "))),a0,i0,hg&&Ug),j.createElement(v5.Provider,{value:Ry},Mm)}),L0=Og,D1=function(){return null};D1.isSelectOptGroup=!0;var tT=D1,bS=function(){return null};bS.isSelectOption=!0;var xS=bS;function rT(d,y){var C=(0,ka.Z)({},d);return Array.isArray(y)&&y.forEach(function(F){delete C[F]}),C}var Sb=j.forwardRef(function(d,y){var C=d.height,F=d.offsetY,J=d.offsetX,ie=d.children,me=d.prefixCls,ke=d.onInnerResize,je=d.innerProps,et=d.rtl,bt=d.extra,Mt={},sr={display:"flex",flexDirection:"column"};if(F!==void 0){var Kt;Mt={height:C,position:"relative",overflow:"hidden"},sr=(0,ka.Z)((0,ka.Z)({},sr),{},(Kt={transform:"translateY(".concat(F,"px)")},(0,xu.Z)(Kt,et?"marginRight":"marginLeft",-J),(0,xu.Z)(Kt,"position","absolute"),(0,xu.Z)(Kt,"left",0),(0,xu.Z)(Kt,"right",0),(0,xu.Z)(Kt,"top",0),Kt))}return j.createElement("div",{style:Mt},j.createElement(E0,{onResize:function(Sr){var Ar=Sr.offsetHeight;Ar&&ke&&ke()}},j.createElement("div",(0,Nf.Z)({style:sr,className:Ie()((0,xu.Z)({},"".concat(me,"-holder-inner"),me)),ref:y},je),ie,bt)))});Sb.displayName="Filler";var nT=Sb;function Bv(d,y){var C="touches"in d?d.touches[0]:d;return C[y?"pageX":"pageY"]}var Ey=j.forwardRef(function(d,y){var C,F=d.prefixCls,J=d.rtl,ie=d.scrollOffset,me=d.scrollRange,ke=d.onStartMove,je=d.onStopMove,et=d.onScroll,bt=d.horizontal,Mt=d.spinSize,sr=d.containerSize,Kt=d.style,vr=d.thumbStyle,Sr=j.useState(!1),Ar=(0,Ia.Z)(Sr,2),jr=Ar[0],Kr=Ar[1],Tn=j.useState(null),En=(0,Ia.Z)(Tn,2),ui=En[0],ai=En[1],Bn=j.useState(null),bi=(0,Ia.Z)(Bn,2),Zi=bi[0],ei=bi[1],mi=!J,$t=j.useRef(),vt=j.useRef(),Lt=j.useState(!1),yr=(0,Ia.Z)(Lt,2),Or=yr[0],Cr=yr[1],In=j.useRef(),Mi=function(){clearTimeout(In.current),Cr(!0),In.current=setTimeout(function(){Cr(!1)},3e3)},Ki=me-sr||0,Yo=sr-Mt||0,Va=Ki>0,Co=j.useMemo(function(){if(ie===0||Ki===0)return 0;var xs=ie/Ki;return xs*Yo},[ie,Ki,Yo]),kl=function(no){no.stopPropagation(),no.preventDefault()},cu=j.useRef({top:Co,dragging:jr,pageY:ui,startTop:Zi});cu.current={top:Co,dragging:jr,pageY:ui,startTop:Zi};var Bc=function(no){Kr(!0),ai(Bv(no,bt)),ei(cu.current.top),ke(),no.stopPropagation(),no.preventDefault()};j.useEffect(function(){var xs=function($u){$u.preventDefault()},no=$t.current,ps=vt.current;return no.addEventListener("touchstart",xs),ps.addEventListener("touchstart",Bc),function(){no.removeEventListener("touchstart",xs),ps.removeEventListener("touchstart",Bc)}},[]);var El=j.useRef();El.current=Ki;var fo=j.useRef();fo.current=Yo,j.useEffect(function(){if(jr){var xs,no=function($u){var ol=cu.current,ds=ol.dragging,Ks=ol.pageY,ru=ol.startTop;if(cv.cancel(xs),ds){var Ru=Bv($u,bt)-Ks,Js=ru;!mi&&bt?Js-=Ru:Js+=Ru;var Nc=El.current,Vp=fo.current,jh=Vp?Js/Vp:0,hu=Math.ceil(jh*Nc);hu=Math.max(hu,0),hu=Math.min(hu,Nc),xs=cv(function(){et(hu,bt)})}},ps=function(){Kr(!1),je()};return window.addEventListener("mousemove",no),window.addEventListener("touchmove",no),window.addEventListener("mouseup",ps),window.addEventListener("touchend",ps),function(){window.removeEventListener("mousemove",no),window.removeEventListener("touchmove",no),window.removeEventListener("mouseup",ps),window.removeEventListener("touchend",ps),cv.cancel(xs)}}},[jr]),j.useEffect(function(){Mi()},[ie]),j.useImperativeHandle(y,function(){return{delayHidden:Mi}});var qa="".concat(F,"-scrollbar"),_o={position:"absolute",visibility:Or&&Va?null:"hidden"},Is={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return bt?(_o.height=8,_o.left=0,_o.right=0,_o.bottom=0,Is.height="100%",Is.width=Mt,mi?Is.left=Co:Is.right=Co):(_o.width=8,_o.top=0,_o.bottom=0,mi?_o.right=0:_o.left=0,Is.width="100%",Is.height=Mt,Is.top=Co),j.createElement("div",{ref:$t,className:Ie()(qa,(C={},(0,xu.Z)(C,"".concat(qa,"-horizontal"),bt),(0,xu.Z)(C,"".concat(qa,"-vertical"),!bt),(0,xu.Z)(C,"".concat(qa,"-visible"),Or),C)),style:(0,ka.Z)((0,ka.Z)({},_o),Kt),onMouseDown:kl,onMouseMove:Mi},j.createElement("div",{ref:vt,className:Ie()("".concat(qa,"-thumb"),(0,xu.Z)({},"".concat(qa,"-thumb-moving"),jr)),style:(0,ka.Z)((0,ka.Z)({},Is),vr),onMouseDown:Bc}))}),R0=Ey;function Cy(d){var y=d.children,C=d.setRef,F=j.useCallback(function(J){C(J)},[]);return j.cloneElement(y,{ref:F})}function wS(d,y,C,F,J,ie,me){var ke=me.getKey;return d.slice(y,C+1).map(function(je,et){var bt=y+et,Mt=ie(je,bt,{style:{width:F}}),sr=ke(je);return j.createElement(Cy,{key:sr,setRef:function(vr){return J(je,vr)}},Mt)})}var SS=function(){function d(){(0,w1.Z)(this,d),this.maps=void 0,this.id=0,this.maps=Object.create(null)}return(0,S1.Z)(d,[{key:"set",value:function(C,F){this.maps[C]=F,this.id+=1}},{key:"get",value:function(C){return this.maps[C]}}]),d}(),ES=SS;function CS(d,y,C){var F=j.useState(0),J=(0,Ia.Z)(F,2),ie=J[0],me=J[1],ke=(0,j.useRef)(new Map),je=(0,j.useRef)(new ES),et=(0,j.useRef)();function bt(){cv.cancel(et.current)}function Mt(){var Kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;bt();var vr=function(){ke.current.forEach(function(Ar,jr){if(Ar&&Ar.offsetParent){var Kr=Em(Ar),Tn=Kr.offsetHeight;je.current.get(jr)!==Tn&&je.current.set(jr,Kr.offsetHeight)}}),me(function(Ar){return Ar+1})};Kt?vr():et.current=cv(vr)}function sr(Kt,vr){var Sr=d(Kt),Ar=ke.current.get(Sr);vr?(ke.current.set(Sr,vr),Mt()):ke.current.delete(Sr),!Ar!=!vr&&(vr?y==null||y(Kt):C==null||C(Kt))}return(0,j.useEffect)(function(){return bt},[]),[sr,Mt,je.current,ie]}function Eb(d,y,C,F){if(!y.length)return C;var J=_toArray(y),ie=J[0],me=J.slice(1),ke;return!d&&typeof ie=="number"?ke=[]:Array.isArray(d)?ke=_toConsumableArray(d):ke=_objectSpread({},d),F&&C===void 0&&me.length===1?delete ke[ie][me[0]]:ke[ie]=Eb(ke[ie],me,C,F),ke}function Fg(d,y,C){var F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return y.length&&F&&C===void 0&&!get(d,y.slice(0,-1))?d:Eb(d,y,C,F)}function O1(d){return _typeof(d)==="object"&&d!==null&&Object.getPrototypeOf(d)===Object.prototype}function Ay(d){return Array.isArray(d)?[]:{}}var AS=typeof Reflect=="undefined"?Object.keys:Reflect.ownKeys;function TS(){for(var d=arguments.length,y=new Array(d),C=0;C<d;C++)y[C]=arguments[C];var F=Ay(y[0]);return y.forEach(function(J){function ie(me,ke){var je=new Set(ke),et=get(J,me),bt=Array.isArray(et);if(bt||O1(et)){if(!je.has(et)){je.add(et);var Mt=get(F,me);bt?F=Fg(F,me,[]):(!Mt||_typeof(Mt)!=="object")&&(F=Fg(F,me,Ay(et))),AS(et).forEach(function(sr){ie([].concat(_toConsumableArray(me),[sr]),je)})}}else F=Fg(F,me,et)}ie([])}),F}var iT=10;function Cb(d,y,C,F,J,ie,me,ke){var je=j.useRef(),et=j.useState(null),bt=(0,Ia.Z)(et,2),Mt=bt[0],sr=bt[1];return Ap(function(){if(Mt&&Mt.times<iT){if(!d.current){sr(function(Mi){return(0,ka.Z)({},Mi)});return}ie();var Kt=Mt.targetAlign,vr=Mt.originAlign,Sr=Mt.index,Ar=Mt.offset,jr=d.current.clientHeight,Kr=!1,Tn=Kt,En=null;if(jr){for(var ui=Kt||vr,ai=0,Bn=0,bi=0,Zi=Math.min(y.length-1,Sr),ei=0;ei<=Zi;ei+=1){var mi=J(y[ei]);Bn=ai;var $t=C.get(mi);bi=Bn+($t===void 0?F:$t),ai=bi}for(var vt=ui==="top"?Ar:jr-Ar,Lt=Zi;Lt>=0;Lt-=1){var yr=J(y[Lt]),Or=C.get(yr);if(Or===void 0){Kr=!0;break}if(vt-=Or,vt<=0)break}switch(ui){case"top":En=Bn-Ar;break;case"bottom":En=bi-jr+Ar;break;default:{var Cr=d.current.scrollTop,In=Cr+jr;Bn<Cr?Tn="top":bi>In&&(Tn="bottom")}}En!==null&&me(En),En!==Mt.lastTop&&(Kr=!0)}Kr&&sr((0,ka.Z)((0,ka.Z)({},Mt),{},{times:Mt.times+1,targetAlign:Tn,lastTop:En}))}},[Mt,d.current]),function(Kt){if(Kt==null){ke();return}if(cv.cancel(je.current),typeof Kt=="number")me(Kt);else if(Kt&&(0,Fv.Z)(Kt)==="object"){var vr,Sr=Kt.align;"index"in Kt?vr=Kt.index:vr=y.findIndex(function(Kr){return J(Kr)===Kt.key});var Ar=Kt.offset,jr=Ar===void 0?0:Ar;sr({times:0,index:vr,offset:jr,originAlign:Sr})}}}function WP(d,y,C,F){var J=C-d,ie=y-C,me=Math.min(J,ie)*2;if(F<=me){var ke=Math.floor(F/2);return F%2?C+ke+1:C-ke}return J>ie?C-(F-ie):C+(F-J)}function XP(d,y,C){var F=d.length,J=y.length,ie,me;if(F===0&&J===0)return null;F<J?(ie=d,me=y):(ie=y,me=d);var ke={__EMPTY_ITEM__:!0};function je(vr){return vr!==void 0?C(vr):ke}for(var et=null,bt=Math.abs(F-J)!==1,Mt=0;Mt<me.length;Mt+=1){var sr=je(ie[Mt]),Kt=je(me[Mt]);if(sr!==Kt){et=Mt,bt=bt||sr!==je(me[Mt+1]);break}}return et===null?null:{index:et,multiple:bt}}function aT(d,y,C){var F=j.useState(d),J=(0,Ia.Z)(F,2),ie=J[0],me=J[1],ke=j.useState(null),je=(0,Ia.Z)(ke,2),et=je[0],bt=je[1];return j.useEffect(function(){var Mt=XP(ie||[],d||[],y);(Mt==null?void 0:Mt.index)!==void 0&&(C==null||C(Mt.index),bt(d[Mt.index])),me(d)},[d]),[et]}var YP=(typeof navigator=="undefined"?"undefined":(0,Fv.Z)(navigator))==="object"&&/Firefox/i.test(navigator.userAgent),Ab=YP,n0=function(d,y){var C=(0,j.useRef)(!1),F=(0,j.useRef)(null);function J(){clearTimeout(F.current),C.current=!0,F.current=setTimeout(function(){C.current=!1},50)}var ie=(0,j.useRef)({top:d,bottom:y});return ie.current.top=d,ie.current.bottom=y,function(me){var ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,je=me<0&&ie.current.top||me>0&&ie.current.bottom;return ke&&je?(clearTimeout(F.current),C.current=!1):(!je||C.current)&&J(),!C.current&&je}};function oT(d,y,C,F,J){var ie=(0,j.useRef)(0),me=(0,j.useRef)(null),ke=(0,j.useRef)(null),je=(0,j.useRef)(!1),et=n0(y,C);function bt(Ar,jr){cv.cancel(me.current),ie.current+=jr,ke.current=jr,!et(jr)&&(Ab||Ar.preventDefault(),me.current=cv(function(){var Kr=je.current?10:1;J(ie.current*Kr),ie.current=0}))}function Mt(Ar,jr){J(jr,!0),Ab||Ar.preventDefault()}var sr=(0,j.useRef)(null),Kt=(0,j.useRef)(null);function vr(Ar){if(d){cv.cancel(Kt.current),Kt.current=cv(function(){sr.current=null},2);var jr=Ar.deltaX,Kr=Ar.deltaY,Tn=Ar.shiftKey,En=jr,ui=Kr;(sr.current==="sx"||!sr.current&&Tn&&Kr&&!jr)&&(En=Kr,ui=0,sr.current="sx");var ai=Math.abs(En),Bn=Math.abs(ui);sr.current===null&&(sr.current=F&&ai>Bn?"x":"y"),sr.current==="y"?bt(Ar,ui):Mt(Ar,En)}}function Sr(Ar){d&&(je.current=Ar.detail===ke.current)}return[vr,Sr]}var sT=14/15;function Tb(d,y,C){var F=(0,j.useRef)(!1),J=(0,j.useRef)(0),ie=(0,j.useRef)(null),me=(0,j.useRef)(null),ke,je=function(sr){if(F.current){var Kt=Math.ceil(sr.touches[0].pageY),vr=J.current-Kt;J.current=Kt,C(vr)&&sr.preventDefault(),clearInterval(me.current),me.current=setInterval(function(){vr*=sT,(!C(vr,!0)||Math.abs(vr)<=.1)&&clearInterval(me.current)},16)}},et=function(){F.current=!1,ke()},bt=function(sr){ke(),sr.touches.length===1&&!F.current&&(F.current=!0,J.current=Math.ceil(sr.touches[0].pageY),ie.current=sr.target,ie.current.addEventListener("touchmove",je),ie.current.addEventListener("touchend",et))};ke=function(){ie.current&&(ie.current.removeEventListener("touchmove",je),ie.current.removeEventListener("touchend",et))},Ap(function(){return d&&y.current.addEventListener("touchstart",bt),function(){var Mt;(Mt=y.current)===null||Mt===void 0||Mt.removeEventListener("touchstart",bt),ke(),clearInterval(me.current)}},[d])}var uT=20;function MS(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,C=d/y*100;return isNaN(C)&&(C=0),C=Math.max(C,uT),C=Math.min(C,d/2),Math.floor(C)}function Mb(d,y,C,F){var J=j.useMemo(function(){return[new Map,[]]},[d,C.id,F]),ie=(0,Ia.Z)(J,2),me=ie[0],ke=ie[1],je=function(bt){var Mt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bt,sr=me.get(bt),Kt=me.get(Mt);if(sr===void 0||Kt===void 0)for(var vr=d.length,Sr=ke.length;Sr<vr;Sr+=1){var Ar,jr=d[Sr],Kr=y(jr);me.set(Kr,Sr);var Tn=(Ar=C.get(Kr))!==null&&Ar!==void 0?Ar:F;if(ke[Sr]=(ke[Sr-1]||0)+Tn,Kr===bt&&(sr=Sr),Kr===Mt&&(Kt=Sr),sr!==void 0&&Kt!==void 0)break}return{top:ke[sr-1]||0,bottom:ke[Kt]}};return je}var PS=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles"],Ty=[],F1={overflowY:"auto",overflowAnchor:"none"};function kS(d,y){var C=d.prefixCls,F=C===void 0?"rc-virtual-list":C,J=d.className,ie=d.height,me=d.itemHeight,ke=d.fullHeight,je=ke===void 0?!0:ke,et=d.style,bt=d.data,Mt=d.children,sr=d.itemKey,Kt=d.virtual,vr=d.direction,Sr=d.scrollWidth,Ar=d.component,jr=Ar===void 0?"div":Ar,Kr=d.onScroll,Tn=d.onVirtualScroll,En=d.onVisibleChange,ui=d.innerProps,ai=d.extraRender,Bn=d.styles,bi=(0,Gd.Z)(d,PS),Zi=!!(Kt!==!1&&ie&&me),ei=Zi&&bt&&(me*bt.length>ie||!!Sr),mi=vr==="rtl",$t=Ie()(F,(0,xu.Z)({},"".concat(F,"-rtl"),mi),J),vt=bt||Ty,Lt=(0,j.useRef)(),yr=(0,j.useRef)(),Or=(0,j.useState)(0),Cr=(0,Ia.Z)(Or,2),In=Cr[0],Mi=Cr[1],Ki=(0,j.useState)(0),Yo=(0,Ia.Z)(Ki,2),Va=Yo[0],Co=Yo[1],kl=(0,j.useState)(!1),cu=(0,Ia.Z)(kl,2),Bc=cu[0],El=cu[1],fo=function(){El(!0)},qa=function(){El(!1)},_o=j.useCallback(function(Rs){return typeof sr=="function"?sr(Rs):Rs==null?void 0:Rs[sr]},[sr]),Is={getKey:_o};function xs(Rs){Mi(function(es){var nu;typeof Rs=="function"?nu=Rs(es):nu=Rs;var Gf=Nv(nu);return Lt.current.scrollTop=Gf,Gf})}var no=(0,j.useRef)({start:0,end:vt.length}),ps=(0,j.useRef)(),wu=aT(vt,_o),$u=(0,Ia.Z)(wu,1),ol=$u[0];ps.current=ol;var ds=CS(_o,null,null),Ks=(0,Ia.Z)(ds,4),ru=Ks[0],Ru=Ks[1],Js=Ks[2],Nc=Ks[3],Vp=j.useMemo(function(){if(!Zi)return{scrollHeight:void 0,start:0,end:vt.length-1,offset:void 0};if(!ei){var Rs;return{scrollHeight:((Rs=yr.current)===null||Rs===void 0?void 0:Rs.offsetHeight)||0,start:0,end:vt.length-1,offset:void 0}}for(var es=0,nu,Gf,uc,zg=vt.length,Cm=0;Cm<zg;Cm+=1){var Bg=vt[Cm],Ng=_o(Bg),nm=Js.get(Ng),Am=es+(nm===void 0?me:nm);Am>=In&&nu===void 0&&(nu=Cm,Gf=es),Am>In+ie&&uc===void 0&&(uc=Cm),es=Am}return nu===void 0&&(nu=0,Gf=0,uc=Math.ceil(ie/me)),uc===void 0&&(uc=vt.length-1),uc=Math.min(uc+1,vt.length-1),{scrollHeight:es,start:nu,end:uc,offset:Gf}},[ei,Zi,In,vt,Nc,ie]),jh=Vp.scrollHeight,hu=Vp.start,mh=Vp.end,Qc=Vp.offset;no.current.start=hu,no.current.end=mh;var Bl=j.useState({width:0,height:ie}),Zf=(0,Ia.Z)(Bl,2),Cl=Zf[0],Qp=Zf[1],ed=function(es){Qp({width:es.width||es.offsetWidth,height:es.height||es.offsetHeight})},hv=(0,j.useRef)(),td=(0,j.useRef)(),Uf=j.useMemo(function(){return MS(Cl.width,Sr)},[Cl.width,Sr]),jf=j.useMemo(function(){return MS(Cl.height,jh)},[Cl.height,jh]),Vf=jh-ie,Mc=(0,j.useRef)(Vf);Mc.current=Vf;function Nv(Rs){var es=Rs;return Number.isNaN(Mc.current)||(es=Math.min(es,Mc.current)),es=Math.max(es,0),es}var yd=In<=0,Gp=In>=Vf,ac=n0(yd,Gp),oc=function(){return{x:mi?-Va:Va,y:In}},sc=(0,j.useRef)(oc()),rd=Ev(function(){if(Tn){var Rs=oc();(sc.current.x!==Rs.x||sc.current.y!==Rs.y)&&(Tn(Rs),sc.current=Rs)}});function Ls(Rs,es){var nu=Rs;es?((0,$m.flushSync)(function(){Co(nu)}),rd()):xs(nu)}function ju(Rs){var es=Rs.currentTarget.scrollTop;es!==In&&xs(es),Kr==null||Kr(Rs),rd()}var pa=function(es){var nu=es,Gf=Sr-Cl.width;return nu=Math.max(nu,0),nu=Math.min(nu,Gf),nu},No=Ev(function(Rs,es){es?((0,$m.flushSync)(function(){Co(function(nu){var Gf=nu+(mi?-Rs:Rs);return pa(Gf)})}),rd()):xs(function(nu){var Gf=nu+Rs;return Gf})}),co=oT(Zi,yd,Gp,!!Sr,No),Bs=(0,Ia.Z)(co,2),Nl=Bs[0],Zl=Bs[1];Tb(Zi,Lt,function(Rs,es){return ac(Rs,es)?!1:(Nl({preventDefault:function(){},deltaY:Rs}),!0)}),Ap(function(){function Rs(nu){Zi&&nu.preventDefault()}var es=Lt.current;return es.addEventListener("wheel",Nl),es.addEventListener("DOMMouseScroll",Zl),es.addEventListener("MozMousePixelScroll",Rs),function(){es.removeEventListener("wheel",Nl),es.removeEventListener("DOMMouseScroll",Zl),es.removeEventListener("MozMousePixelScroll",Rs)}},[Zi]),Ap(function(){Sr&&Co(function(Rs){return pa(Rs)})},[Cl.width,Sr]);var _d=function(){var es,nu;(es=hv.current)===null||es===void 0||es.delayHidden(),(nu=td.current)===null||nu===void 0||nu.delayHidden()},bd=Cb(Lt,vt,Js,me,_o,function(){return Ru(!0)},xs,_d);j.useImperativeHandle(y,function(){return{getScrollInfo:oc,scrollTo:function(es){function nu(Gf){return Gf&&(0,Fv.Z)(Gf)==="object"&&("left"in Gf||"top"in Gf)}nu(es)?(es.left!==void 0&&Co(pa(es.left)),bd(es.top)):bd(es)}}}),Ap(function(){if(En){var Rs=vt.slice(hu,mh+1);En(Rs,vt)}},[hu,mh,vt]);var nd=Mb(vt,_o,Js,me),gh=ai==null?void 0:ai({start:hu,end:mh,virtual:ei,offsetX:Va,offsetY:Qc,rtl:mi,getSize:nd}),id=wS(vt,hu,mh,Sr,ru,Mt,Is),Id=null;ie&&(Id=(0,ka.Z)((0,xu.Z)({},je?"height":"maxHeight",ie),F1),Zi&&(Id.overflowY="hidden",Sr&&(Id.overflowX="hidden"),Bc&&(Id.pointerEvents="none")));var rm={};return mi&&(rm.dir="rtl"),j.createElement("div",(0,Nf.Z)({style:(0,ka.Z)((0,ka.Z)({},et),{},{position:"relative"}),className:$t},rm,bi),j.createElement(E0,{onResize:ed},j.createElement(jr,{className:"".concat(F,"-holder"),style:Id,ref:Lt,onScroll:ju,onMouseEnter:_d},j.createElement(nT,{prefixCls:F,height:jh,offsetX:Va,offsetY:Qc,scrollWidth:Sr,onInnerResize:Ru,ref:yr,innerProps:ui,rtl:mi,extra:gh},id))),ei&&jh>ie&&j.createElement(R0,{ref:hv,prefixCls:F,scrollOffset:In,scrollRange:jh,rtl:mi,onScroll:Ls,onStartMove:fo,onStopMove:qa,spinSize:jf,containerSize:Cl.height,style:Bn==null?void 0:Bn.verticalScrollBar,thumbStyle:Bn==null?void 0:Bn.verticalScrollBarThumb}),ei&&Sr&&j.createElement(R0,{ref:td,prefixCls:F,scrollOffset:Va,scrollRange:Sr,rtl:mi,onScroll:Ls,onStartMove:fo,onStopMove:qa,spinSize:Uf,containerSize:Cl.width,horizontal:!0,style:Bn==null?void 0:Bn.horizontalScrollBar,thumbStyle:Bn==null?void 0:Bn.horizontalScrollBarThumb}))}var IS=j.forwardRef(kS);IS.displayName="List";var qP=IS,lT=qP,KP=j.createContext(null),LS=KP;function z1(){return/(mac\sos|macintosh)/i.test(navigator.appVersion)}var RS=["disabled","title","children","style","className"];function DS(d){return typeof d=="string"||typeof d=="number"}var cT=function(y,C){var F=m5(),J=F.prefixCls,ie=F.id,me=F.open,ke=F.multiple,je=F.mode,et=F.searchValue,bt=F.toggleOpen,Mt=F.notFoundContent,sr=F.onPopupScroll,Kt=j.useContext(LS),vr=Kt.flattenOptions,Sr=Kt.onActiveValue,Ar=Kt.defaultActiveFirstOption,jr=Kt.onSelect,Kr=Kt.menuItemSelectedIcon,Tn=Kt.rawValues,En=Kt.fieldNames,ui=Kt.virtual,ai=Kt.direction,Bn=Kt.listHeight,bi=Kt.listItemHeight,Zi=Kt.optionRender,ei="".concat(J,"-item"),mi=fw(function(){return vr},[me,vr],function(fo,qa){return qa[0]&&fo[1]!==qa[1]}),$t=j.useRef(null),vt=function(qa){qa.preventDefault()},Lt=function(qa){$t.current&&$t.current.scrollTo(typeof qa=="number"?{index:qa}:qa)},yr=function(qa){for(var _o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,Is=mi.length,xs=0;xs<Is;xs+=1){var no=(qa+xs*_o+Is)%Is,ps=mi[no],wu=ps.group,$u=ps.data;if(!wu&&!$u.disabled)return no}return-1},Or=j.useState(function(){return yr(0)}),Cr=(0,Ia.Z)(Or,2),In=Cr[0],Mi=Cr[1],Ki=function(qa){var _o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;Mi(qa);var Is={source:_o?"keyboard":"mouse"},xs=mi[qa];if(!xs){Sr(null,-1,Is);return}Sr(xs.value,qa,Is)};(0,j.useEffect)(function(){Ki(Ar!==!1?yr(0):-1)},[mi.length,et]);var Yo=j.useCallback(function(fo){return Tn.has(fo)&&je!=="combobox"},[je,(0,uv.Z)(Tn).toString(),Tn.size]);(0,j.useEffect)(function(){var fo=setTimeout(function(){if(!ke&&me&&Tn.size===1){var _o=Array.from(Tn)[0],Is=mi.findIndex(function(xs){var no=xs.data;return no.value===_o});Is!==-1&&(Ki(Is),Lt(Is))}});if(me){var qa;(qa=$t.current)===null||qa===void 0||qa.scrollTo(void 0)}return function(){return clearTimeout(fo)}},[me,et]);var Va=function(qa){qa!==void 0&&jr(qa,{selected:!Tn.has(qa)}),ke||bt(!1)};if(j.useImperativeHandle(C,function(){return{onKeyDown:function(qa){var _o=qa.which,Is=qa.ctrlKey;switch(_o){case Qu.N:case Qu.P:case Qu.UP:case Qu.DOWN:{var xs=0;if(_o===Qu.UP?xs=-1:_o===Qu.DOWN?xs=1:z1()&&Is&&(_o===Qu.N?xs=1:_o===Qu.P&&(xs=-1)),xs!==0){var no=yr(In+xs,xs);Lt(no),Ki(no,!0)}break}case Qu.ENTER:{var ps=mi[In];ps&&!ps.data.disabled?Va(ps.value):Va(void 0),me&&qa.preventDefault();break}case Qu.ESC:bt(!1),me&&qa.stopPropagation()}},onKeyUp:function(){},scrollTo:function(qa){Lt(qa)}}}),mi.length===0)return j.createElement("div",{role:"listbox",id:"".concat(ie,"_list"),className:"".concat(ei,"-empty"),onMouseDown:vt},Mt);var Co=Object.keys(En).map(function(fo){return En[fo]}),kl=function(qa){return qa.label};function cu(fo,qa){var _o=fo.group;return{role:_o?"presentation":"option",id:"".concat(ie,"_list_").concat(qa)}}var Bc=function(qa){var _o=mi[qa];if(!_o)return null;var Is=_o.data||{},xs=Is.value,no=_o.group,ps=Sm(Is,!0),wu=kl(_o);return _o?j.createElement("div",(0,Nf.Z)({"aria-label":typeof wu=="string"&&!no?wu:null},ps,{key:qa},cu(_o,qa),{"aria-selected":Yo(xs)}),xs):null},El={role:"listbox",id:"".concat(ie,"_list")};return j.createElement(j.Fragment,null,ui&&j.createElement("div",(0,Nf.Z)({},El,{style:{height:0,width:0,overflow:"hidden"}}),Bc(In-1),Bc(In),Bc(In+1)),j.createElement(lT,{itemKey:"key",ref:$t,data:mi,height:Bn,itemHeight:bi,fullHeight:!1,onMouseDown:vt,onScroll:sr,virtual:ui,direction:ai,innerProps:ui?null:El},function(fo,qa){var _o,Is=fo.group,xs=fo.groupOption,no=fo.data,ps=fo.label,wu=fo.value,$u=no.key;if(Is){var ol,ds=(ol=no.title)!==null&&ol!==void 0?ol:DS(ps)?ps.toString():void 0;return j.createElement("div",{className:Ie()(ei,"".concat(ei,"-group")),title:ds},ps!==void 0?ps:$u)}var Ks=no.disabled,ru=no.title,Ru=no.children,Js=no.style,Nc=no.className,Vp=(0,Gd.Z)(no,RS),jh=rT(Vp,Co),hu=Yo(wu),mh="".concat(ei,"-option"),Qc=Ie()(ei,mh,Nc,(_o={},(0,xu.Z)(_o,"".concat(mh,"-grouped"),xs),(0,xu.Z)(_o,"".concat(mh,"-active"),In===qa&&!Ks),(0,xu.Z)(_o,"".concat(mh,"-disabled"),Ks),(0,xu.Z)(_o,"".concat(mh,"-selected"),hu),_o)),Bl=kl(fo),Zf=!Kr||typeof Kr=="function"||hu,Cl=typeof Bl=="number"?Bl:Bl||wu,Qp=DS(Cl)?Cl.toString():void 0;return ru!==void 0&&(Qp=ru),j.createElement("div",(0,Nf.Z)({},Sm(jh),ui?{}:cu(fo,qa),{"aria-selected":hu,className:Qc,title:Qp,onMouseMove:function(){In===qa||Ks||Ki(qa)},onClick:function(){Ks||Va(wu)},style:Js}),j.createElement("div",{className:"".concat(mh,"-content")},typeof Zi=="function"?Zi(fo,{index:qa}):Cl),j.isValidElement(Kr)||hu,Zf&&j.createElement(g1,{className:"".concat(ei,"-option-state"),customizeIcon:Kr,customizeIconProps:{value:wu,disabled:Ks,isSelected:hu}},hu?"\u2713":null))}))},OS=j.forwardRef(cT);OS.displayName="OptionList";var hT=OS,fT=function(d,y){var C=j.useRef({values:new Map,options:new Map}),F=j.useMemo(function(){var ie=C.current,me=ie.values,ke=ie.options,je=d.map(function(Mt){if(Mt.label===void 0){var sr;return(0,ka.Z)((0,ka.Z)({},Mt),{},{label:(sr=me.get(Mt.value))===null||sr===void 0?void 0:sr.label})}return Mt}),et=new Map,bt=new Map;return je.forEach(function(Mt){et.set(Mt.value,Mt),bt.set(Mt.value,y.get(Mt.value)||ke.get(Mt.value))}),C.current.values=et,C.current.options=bt,je},[d,y]),J=j.useCallback(function(ie){return y.get(ie)||C.current.options.get(ie)},[y]);return[F,J]};function Pb(d,y){return Xm(d).join("").toUpperCase().includes(y)}var pT=function(d,y,C,F,J){return j.useMemo(function(){if(!C||F===!1)return d;var ie=y.options,me=y.label,ke=y.value,je=[],et=typeof F=="function",bt=C.toUpperCase(),Mt=et?F:function(Kt,vr){return J?Pb(vr[J],bt):vr[ie]?Pb(vr[me!=="children"?me:"label"],bt):Pb(vr[ke],bt)},sr=et?function(Kt){return _S(Kt)}:function(Kt){return Kt};return d.forEach(function(Kt){if(Kt[ie]){var vr=Mt(C,sr(Kt));if(vr)je.push(Kt);else{var Sr=Kt[ie].filter(function(Ar){return Mt(C,sr(Ar))});Sr.length&&je.push((0,ka.Z)((0,ka.Z)({},Kt),{},(0,xu.Z)({},ie,Sr)))}return}Mt(C,sr(Kt))&&je.push(Kt)}),je},[d,F,J,C,y])},FS=0,dT=wm();function vT(){var d;return dT?(d=FS,FS+=1):d="TEST_OR_SSR",d}function mT(d){var y=j.useState(),C=(0,Ia.Z)(y,2),F=C[0],J=C[1];return j.useEffect(function(){J("rc_select_".concat(vT()))},[]),d||F}var gT=["children","value"],yT=["children"];function _T(d){var y=d,C=y.key,F=y.props,J=F.children,ie=F.value,me=(0,Gd.Z)(F,gT);return(0,ka.Z)({key:C,value:ie!==void 0?ie:C,children:J},me)}function zS(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return Qh(d).map(function(C,F){if(!j.isValidElement(C)||!C.type)return null;var J=C,ie=J.type.isSelectOptGroup,me=J.key,ke=J.props,je=ke.children,et=(0,Gd.Z)(ke,yT);return y||!ie?_T(C):(0,ka.Z)((0,ka.Z)({key:"__RC_SELECT_GRP__".concat(me===null?F:me,"__"),label:me},et),{},{options:zS(je)})}).filter(function(C){return C})}function bT(d,y,C,F,J){return j.useMemo(function(){var ie=d,me=!d;me&&(ie=zS(y));var ke=new Map,je=new Map,et=function(sr,Kt,vr){vr&&typeof vr=="string"&&sr.set(Kt[vr],Kt)};function bt(Mt){for(var sr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,Kt=0;Kt<Mt.length;Kt+=1){var vr=Mt[Kt];!vr[C.options]||sr?(ke.set(vr[C.value],vr),et(je,vr,C.label),et(je,vr,F),et(je,vr,J)):bt(vr[C.options],!0)}}return bt(ie),{options:ie,valueOptions:ke,labelOptions:je}},[d,y,C,F,J])}function BS(d){var y=j.useRef();y.current=d;var C=j.useCallback(function(){return y.current.apply(y,arguments)},[]);return C}function JP(d){var y=d.mode,C=d.options,F=d.children,J=d.backfill,ie=d.allowClear,me=d.placeholder,ke=d.getInputElement,je=d.showSearch,et=d.onSearch,bt=d.defaultOpen,Mt=d.autoFocus,sr=d.labelInValue,Kt=d.value,vr=d.inputValue,Sr=d.optionLabelProp,Ar=isMultiple(y),jr=je!==void 0?je:Ar||y==="combobox",Kr=C||convertChildrenToData(F);if(warning(y!=="tags"||Kr.every(function(ai){return!ai.disabled}),"Please avoid setting option to disabled in tags mode since user can always type text as tag."),y==="tags"||y==="combobox"){var Tn=Kr.some(function(ai){return ai.options?ai.options.some(function(Bn){return typeof("value"in Bn?Bn.value:Bn.key)=="number"}):typeof("value"in ai?ai.value:ai.key)=="number"});warning(!Tn,"`value` of Option should not use number type when `mode` is `tags` or `combobox`.")}if(warning(y!=="combobox"||!Sr,"`combobox` mode not support `optionLabelProp`. Please set `value` on Option directly."),warning(y==="combobox"||!J,"`backfill` only works with `combobox` mode."),warning(y==="combobox"||!ke,"`getInputElement` only work with `combobox` mode."),noteOnce(y!=="combobox"||!ke||!ie||!me,"Customize `getInputElement` should customize clear and placeholder logic instead of configuring `allowClear` and `placeholder`."),et&&!jr&&y!=="combobox"&&y!=="tags"&&warning(!1,"`onSearch` should work with `showSearch` instead of use alone."),noteOnce(!bt||Mt,"`defaultOpen` makes Select open without focus which means it will not close by click outside. You can set `autoFocus` if needed."),Kt!=null){var En=toArray(Kt);warning(!sr||En.every(function(ai){return _typeof(ai)==="object"&&("key"in ai||"value"in ai)}),"`value` should in shape of `{ value: string | number, label?: ReactNode }` when you set `labelInValue` to `true`"),warning(!Ar||Array.isArray(Kt),"`value` should be array when `mode` is `multiple` or `tags`")}if(F){var ui=null;toNodeArray(F).some(function(ai){if(!React.isValidElement(ai)||!ai.type)return!1;var Bn=ai,bi=Bn.type;if(bi.isSelectOption)return!1;if(bi.isSelectOptGroup){var Zi=toNodeArray(ai.props.children).every(function(ei){return!React.isValidElement(ei)||!ai.type||ei.type.isSelectOption?!0:(ui=ei.type,!1)});return!Zi}return ui=bi,!0}),ui&&warning(!1,"`children` should be `Select.Option` or `Select.OptGroup` instead of `".concat(ui.displayName||ui.name||ui,"`.")),warning(vr===void 0,"`inputValue` is deprecated, please use `searchValue` instead.")}}function QP(d,y){if(d){var C=function F(J){for(var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,me=0;me<J.length;me++){var ke=J[me];if(ke[y==null?void 0:y.value]===null)return warning(!1,"`value` in Select options should not be `null`."),!0;if(!ie&&Array.isArray(ke[y==null?void 0:y.options])&&F(ke[y==null?void 0:y.options],!0))break}};C(d)}}var ek=null,xT=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","value","defaultValue","labelInValue","onChange"],wT=["inputValue"];function ST(d){return!d||(0,Fv.Z)(d)!=="object"}var D0=j.forwardRef(function(d,y){var C=d.id,F=d.mode,J=d.prefixCls,ie=J===void 0?"rc-select":J,me=d.backfill,ke=d.fieldNames,je=d.inputValue,et=d.searchValue,bt=d.onSearch,Mt=d.autoClearSearchValue,sr=Mt===void 0?!0:Mt,Kt=d.onSelect,vr=d.onDeselect,Sr=d.dropdownMatchSelectWidth,Ar=Sr===void 0?!0:Sr,jr=d.filterOption,Kr=d.filterSort,Tn=d.optionFilterProp,En=d.optionLabelProp,ui=d.options,ai=d.optionRender,Bn=d.children,bi=d.defaultActiveFirstOption,Zi=d.menuItemSelectedIcon,ei=d.virtual,mi=d.direction,$t=d.listHeight,vt=$t===void 0?200:$t,Lt=d.listItemHeight,yr=Lt===void 0?20:Lt,Or=d.value,Cr=d.defaultValue,In=d.labelInValue,Mi=d.onChange,Ki=(0,Gd.Z)(d,xT),Yo=mT(C),Va=Sy(F),Co=!!(!ui&&Bn),kl=j.useMemo(function(){return jr===void 0&&F==="combobox"?!1:jr},[jr,F]),cu=j.useMemo(function(){return wb(ke,Co)},[JSON.stringify(ke),Co]),Bc=U_("",{value:et!==void 0?et:je,postState:function(No){return No||""}}),El=(0,Ia.Z)(Bc,2),fo=El[0],qa=El[1],_o=bT(ui,Bn,cu,Tn,En),Is=_o.valueOptions,xs=_o.labelOptions,no=_o.options,ps=j.useCallback(function(pa){var No=Xm(pa);return No.map(function(co){var Bs,Nl,Zl,_d,bd;if(ST(co))Bs=co;else{var nd;Zl=co.key,Nl=co.label,Bs=(nd=co.value)!==null&&nd!==void 0?nd:Zl}var gh=Is.get(Bs);if(gh){var id;if(Nl===void 0&&(Nl=gh==null?void 0:gh[En||cu.label]),Zl===void 0&&(Zl=(id=gh==null?void 0:gh.key)!==null&&id!==void 0?id:Bs),_d=gh==null?void 0:gh.disabled,bd=gh==null?void 0:gh.title,!1)var Id}return{label:Nl,value:Bs,key:Zl,disabled:_d,title:bd}})},[cu,En,Is]),wu=U_(Cr,{value:Or}),$u=(0,Ia.Z)(wu,2),ol=$u[0],ds=$u[1],Ks=j.useMemo(function(){var pa,No=ps(ol);return F==="combobox"&&uA((pa=No[0])===null||pa===void 0?void 0:pa.value)?[]:No},[ol,ps,F]),ru=fT(Ks,Is),Ru=(0,Ia.Z)(ru,2),Js=Ru[0],Nc=Ru[1],Vp=j.useMemo(function(){if(!F&&Js.length===1){var pa=Js[0];if(pa.value===null&&(pa.label===null||pa.label===void 0))return[]}return Js.map(function(No){var co;return(0,ka.Z)((0,ka.Z)({},No),{},{label:(co=No.label)!==null&&co!==void 0?co:No.value})})},[F,Js]),jh=j.useMemo(function(){return new Set(Js.map(function(pa){return pa.value}))},[Js]);j.useEffect(function(){if(F==="combobox"){var pa,No=(pa=Js[0])===null||pa===void 0?void 0:pa.value;qa(sA(No)?String(No):"")}},[Js]);var hu=BS(function(pa,No){var co,Bs=No!=null?No:pa;return co={},(0,xu.Z)(co,cu.value,pa),(0,xu.Z)(co,cu.label,Bs),co}),mh=j.useMemo(function(){if(F!=="tags")return no;var pa=(0,uv.Z)(no),No=function(Bs){return Is.has(Bs)};return(0,uv.Z)(Js).sort(function(co,Bs){return co.value<Bs.value?-1:1}).forEach(function(co){var Bs=co.value;No(Bs)||pa.push(hu(Bs,co.label))}),pa},[hu,no,Is,Js,F]),Qc=pT(mh,cu,fo,kl,Tn),Bl=j.useMemo(function(){return F!=="tags"||!fo||Qc.some(function(pa){return pa[Tn||"value"]===fo})||Qc.some(function(pa){return pa[cu.value]===fo})?Qc:[hu(fo)].concat((0,uv.Z)(Qc))},[hu,Tn,F,Qc,fo,cu]),Zf=j.useMemo(function(){return Kr?(0,uv.Z)(Bl).sort(function(pa,No){return Kr(pa,No)}):Bl},[Bl,Kr]),Cl=j.useMemo(function(){return R1(Zf,{fieldNames:cu,childrenAsData:Co})},[Zf,cu,Co]),Qp=function(No){var co=ps(No);if(ds(co),Mi&&(co.length!==Js.length||co.some(function(Zl,_d){var bd;return((bd=Js[_d])===null||bd===void 0?void 0:bd.value)!==(Zl==null?void 0:Zl.value)}))){var Bs=In?co:co.map(function(Zl){return Zl.value}),Nl=co.map(function(Zl){return _S(Nc(Zl.value))});Mi(Va?Bs:Bs[0],Va?Nl:Nl[0])}},ed=j.useState(null),hv=(0,Ia.Z)(ed,2),td=hv[0],Uf=hv[1],jf=j.useState(0),Vf=(0,Ia.Z)(jf,2),Mc=Vf[0],Nv=Vf[1],yd=bi!==void 0?bi:F!=="combobox",Gp=j.useCallback(function(pa,No){var co=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Bs=co.source,Nl=Bs===void 0?"keyboard":Bs;Nv(No),me&&F==="combobox"&&pa!==null&&Nl==="keyboard"&&Uf(String(pa))},[me,F]),ac=function(No,co,Bs){var Nl=function(){var es,nu=Nc(No);return[In?{label:nu==null?void 0:nu[cu.label],value:No,key:(es=nu==null?void 0:nu.key)!==null&&es!==void 0?es:No}:No,_S(nu)]};if(co&&Kt){var Zl=Nl(),_d=(0,Ia.Z)(Zl,2),bd=_d[0],nd=_d[1];Kt(bd,nd)}else if(!co&&vr&&Bs!=="clear"){var gh=Nl(),id=(0,Ia.Z)(gh,2),Id=id[0],rm=id[1];vr(Id,rm)}},oc=BS(function(pa,No){var co,Bs=Va?No.selected:!0;Bs?co=Va?[].concat((0,uv.Z)(Js),[pa]):[pa]:co=Js.filter(function(Nl){return Nl.value!==pa}),Qp(co),ac(pa,Bs),F==="combobox"?Uf(""):(!Sy||sr)&&(qa(""),Uf(""))}),sc=function(No,co){Qp(No);var Bs=co.type,Nl=co.values;(Bs==="remove"||Bs==="clear")&&Nl.forEach(function(Zl){ac(Zl.value,!1,Bs)})},rd=function(No,co){if(qa(No),Uf(null),co.source==="submit"){var Bs=(No||"").trim();if(Bs){var Nl=Array.from(new Set([].concat((0,uv.Z)(jh),[Bs])));Qp(Nl),ac(Bs,!0),qa("")}return}co.source!=="blur"&&(F==="combobox"&&Qp(No),bt==null||bt(No))},Ls=function(No){var co=No;F!=="tags"&&(co=No.map(function(Nl){var Zl=xs.get(Nl);return Zl==null?void 0:Zl.value}).filter(function(Nl){return Nl!==void 0}));var Bs=Array.from(new Set([].concat((0,uv.Z)(jh),(0,uv.Z)(co))));Qp(Bs),Bs.forEach(function(Nl){ac(Nl,!0)})},ju=j.useMemo(function(){var pa=ei!==!1&&Ar!==!1;return(0,ka.Z)((0,ka.Z)({},_o),{},{flattenOptions:Cl,onActiveValue:Gp,defaultActiveFirstOption:yd,onSelect:oc,menuItemSelectedIcon:Zi,rawValues:jh,fieldNames:cu,virtual:pa,direction:mi,listHeight:vt,listItemHeight:yr,childrenAsData:Co,optionRender:ai})},[_o,Cl,Gp,yd,oc,Zi,jh,cu,ei,Ar,vt,yr,Co,ai]);return j.createElement(LS.Provider,{value:ju},j.createElement(L0,(0,Nf.Z)({},Ki,{id:Yo,prefixCls:ie,ref:y,omitDomProps:wT,mode:F,displayValues:Vp,onDisplayValuesChange:sc,direction:mi,searchValue:fo,onSearch:rd,autoClearSearchValue:sr,onSearchSplit:Ls,dropdownMatchSelectWidth:Ar,OptionList:hT,emptyOptions:!Cl.length,activeValue:td,activeDescendantId:"".concat(Yo,"_list_").concat(Mc)})))}),kb=D0;kb.Option=xS,kb.OptGroup=tT;var ET=kb,CT=ET;function My(d){"@babel/helpers - typeof";return My=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},My(d)}var AT=["prefixCls","bordered","className","getPopupContainer","dropdownClassName","popupClassName","listHeight","placement","listItemHeight","disabled","notFoundContent"];function Ib(){return Ib=Object.assign?Object.assign.bind():function(d){for(var y=1;y<arguments.length;y++){var C=arguments[y];for(var F in C)Object.prototype.hasOwnProperty.call(C,F)&&(d[F]=C[F])}return d},Ib.apply(this,arguments)}function TT(d,y,C){return y=MT(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function MT(d){var y=PT(d,"string");return My(y)==="symbol"?y:String(y)}function PT(d,y){if(My(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(My(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function kT(d,y){if(d==null)return{};var C=IT(d,y),F,J;if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(d);for(J=0;J<ie.length;J++)F=ie[J],!(y.indexOf(F)>=0)&&Object.prototype.propertyIsEnumerable.call(d,F)&&(C[F]=d[F])}return C}function IT(d,y){if(d==null)return{};var C={},F=Object.keys(d),J,ie;for(ie=0;ie<F.length;ie++)J=F[ie],!(y.indexOf(J)>=0)&&(C[J]=d[J]);return C}var NS="SECRET_COMBOBOX_MODE_DO_NOT_USE",ZS="larkmap-select",LT=function(y,C){var F=y.prefixCls,J=y.bordered,ie=J===void 0?!0:J,me=y.className,ke=y.getPopupContainer,je=y.dropdownClassName,et=y.popupClassName,bt=y.listHeight,Mt=bt===void 0?256:bt,sr=y.placement,Kt=y.listItemHeight,vr=Kt===void 0?24:Kt,Sr=y.disabled,Ar=y.notFoundContent,jr=kT(y,AT),Kr=j.useMemo(function(){var ui=jr,ai=ui.mode;if(ai!=="combobox")return ai===NS?"combobox":ai},[jr]),Tn=aw(jr,"suffixIcon","itemIcon"),En=Ie()(TT({},"".concat(ZS,"-borderless"),!ie),me);return j.createElement(CT,Ib({ref:C},Tn,{listHeight:Mt,listItemHeight:vr,mode:Kr,prefixCls:ZS,placement:sr,notFoundContent:Ar!=null?Ar:"\u5F53\u524D\u65E0\u6570\u636E",className:En,getPopupContainer:ke,dropdownClassName:et,disabled:Sr}))},B1=j.forwardRef(LT);B1.SECRET_COMBOBOX_MODE_DO_NOT_USE=NS,B1.Option=xS,B1.OptGroup=tT;var US=B1;function O0(d){"@babel/helpers - typeof";return O0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},O0(d)}var jS=["searchParams","showDistrict","showAddress","onSearchFinish","onChange"];function N1(){return N1=Object.assign?Object.assign.bind():function(d){for(var y=1;y<arguments.length;y++){var C=arguments[y];for(var F in C)Object.prototype.hasOwnProperty.call(C,F)&&(d[F]=C[F])}return d},N1.apply(this,arguments)}function Lb(){"use strict";Lb=function(){return d};var d={},y=Object.prototype,C=y.hasOwnProperty,F=Object.defineProperty||function($t,vt,Lt){$t[vt]=Lt.value},J=typeof Symbol=="function"?Symbol:{},ie=J.iterator||"@@iterator",me=J.asyncIterator||"@@asyncIterator",ke=J.toStringTag||"@@toStringTag";function je($t,vt,Lt){return Object.defineProperty($t,vt,{value:Lt,enumerable:!0,configurable:!0,writable:!0}),$t[vt]}try{je({},"")}catch($t){je=function(Lt,yr,Or){return Lt[yr]=Or}}function et($t,vt,Lt,yr){var Or=vt&&vt.prototype instanceof sr?vt:sr,Cr=Object.create(Or.prototype),In=new Zi(yr||[]);return F(Cr,"_invoke",{value:ui($t,Lt,In)}),Cr}function bt($t,vt,Lt){try{return{type:"normal",arg:$t.call(vt,Lt)}}catch(yr){return{type:"throw",arg:yr}}}d.wrap=et;var Mt={};function sr(){}function Kt(){}function vr(){}var Sr={};je(Sr,ie,function(){return this});var Ar=Object.getPrototypeOf,jr=Ar&&Ar(Ar(ei([])));jr&&jr!==y&&C.call(jr,ie)&&(Sr=jr);var Kr=vr.prototype=sr.prototype=Object.create(Sr);function Tn($t){["next","throw","return"].forEach(function(vt){je($t,vt,function(Lt){return this._invoke(vt,Lt)})})}function En($t,vt){function Lt(Or,Cr,In,Mi){var Ki=bt($t[Or],$t,Cr);if(Ki.type!=="throw"){var Yo=Ki.arg,Va=Yo.value;return Va&&O0(Va)=="object"&&C.call(Va,"__await")?vt.resolve(Va.__await).then(function(Co){Lt("next",Co,In,Mi)},function(Co){Lt("throw",Co,In,Mi)}):vt.resolve(Va).then(function(Co){Yo.value=Co,In(Yo)},function(Co){return Lt("throw",Co,In,Mi)})}Mi(Ki.arg)}var yr;F(this,"_invoke",{value:function(Cr,In){function Mi(){return new vt(function(Ki,Yo){Lt(Cr,In,Ki,Yo)})}return yr=yr?yr.then(Mi,Mi):Mi()}})}function ui($t,vt,Lt){var yr="suspendedStart";return function(Or,Cr){if(yr==="executing")throw new Error("Generator is already running");if(yr==="completed"){if(Or==="throw")throw Cr;return mi()}for(Lt.method=Or,Lt.arg=Cr;;){var In=Lt.delegate;if(In){var Mi=ai(In,Lt);if(Mi){if(Mi===Mt)continue;return Mi}}if(Lt.method==="next")Lt.sent=Lt._sent=Lt.arg;else if(Lt.method==="throw"){if(yr==="suspendedStart")throw yr="completed",Lt.arg;Lt.dispatchException(Lt.arg)}else Lt.method==="return"&&Lt.abrupt("return",Lt.arg);yr="executing";var Ki=bt($t,vt,Lt);if(Ki.type==="normal"){if(yr=Lt.done?"completed":"suspendedYield",Ki.arg===Mt)continue;return{value:Ki.arg,done:Lt.done}}Ki.type==="throw"&&(yr="completed",Lt.method="throw",Lt.arg=Ki.arg)}}}function ai($t,vt){var Lt=vt.method,yr=$t.iterator[Lt];if(yr===void 0)return vt.delegate=null,Lt==="throw"&&$t.iterator.return&&(vt.method="return",vt.arg=void 0,ai($t,vt),vt.method==="throw")||Lt!=="return"&&(vt.method="throw",vt.arg=new TypeError("The iterator does not provide a '"+Lt+"' method")),Mt;var Or=bt(yr,$t.iterator,vt.arg);if(Or.type==="throw")return vt.method="throw",vt.arg=Or.arg,vt.delegate=null,Mt;var Cr=Or.arg;return Cr?Cr.done?(vt[$t.resultName]=Cr.value,vt.next=$t.nextLoc,vt.method!=="return"&&(vt.method="next",vt.arg=void 0),vt.delegate=null,Mt):Cr:(vt.method="throw",vt.arg=new TypeError("iterator result is not an object"),vt.delegate=null,Mt)}function Bn($t){var vt={tryLoc:$t[0]};1 in $t&&(vt.catchLoc=$t[1]),2 in $t&&(vt.finallyLoc=$t[2],vt.afterLoc=$t[3]),this.tryEntries.push(vt)}function bi($t){var vt=$t.completion||{};vt.type="normal",delete vt.arg,$t.completion=vt}function Zi($t){this.tryEntries=[{tryLoc:"root"}],$t.forEach(Bn,this),this.reset(!0)}function ei($t){if($t){var vt=$t[ie];if(vt)return vt.call($t);if(typeof $t.next=="function")return $t;if(!isNaN($t.length)){var Lt=-1,yr=function Or(){for(;++Lt<$t.length;)if(C.call($t,Lt))return Or.value=$t[Lt],Or.done=!1,Or;return Or.value=void 0,Or.done=!0,Or};return yr.next=yr}}return{next:mi}}function mi(){return{value:void 0,done:!0}}return Kt.prototype=vr,F(Kr,"constructor",{value:vr,configurable:!0}),F(vr,"constructor",{value:Kt,configurable:!0}),Kt.displayName=je(vr,ke,"GeneratorFunction"),d.isGeneratorFunction=function($t){var vt=typeof $t=="function"&&$t.constructor;return!!vt&&(vt===Kt||(vt.displayName||vt.name)==="GeneratorFunction")},d.mark=function($t){return Object.setPrototypeOf?Object.setPrototypeOf($t,vr):($t.__proto__=vr,je($t,ke,"GeneratorFunction")),$t.prototype=Object.create(Kr),$t},d.awrap=function($t){return{__await:$t}},Tn(En.prototype),je(En.prototype,me,function(){return this}),d.AsyncIterator=En,d.async=function($t,vt,Lt,yr,Or){Or===void 0&&(Or=Promise);var Cr=new En(et($t,vt,Lt,yr),Or);return d.isGeneratorFunction(vt)?Cr:Cr.next().then(function(In){return In.done?In.value:Cr.next()})},Tn(Kr),je(Kr,ke,"Generator"),je(Kr,ie,function(){return this}),je(Kr,"toString",function(){return"[object Generator]"}),d.keys=function($t){var vt=Object($t),Lt=[];for(var yr in vt)Lt.push(yr);return Lt.reverse(),function Or(){for(;Lt.length;){var Cr=Lt.pop();if(Cr in vt)return Or.value=Cr,Or.done=!1,Or}return Or.done=!0,Or}},d.values=ei,Zi.prototype={constructor:Zi,reset:function(vt){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(bi),!vt)for(var Lt in this)Lt.charAt(0)==="t"&&C.call(this,Lt)&&!isNaN(+Lt.slice(1))&&(this[Lt]=void 0)},stop:function(){this.done=!0;var vt=this.tryEntries[0].completion;if(vt.type==="throw")throw vt.arg;return this.rval},dispatchException:function(vt){if(this.done)throw vt;var Lt=this;function yr(Yo,Va){return In.type="throw",In.arg=vt,Lt.next=Yo,Va&&(Lt.method="next",Lt.arg=void 0),!!Va}for(var Or=this.tryEntries.length-1;Or>=0;--Or){var Cr=this.tryEntries[Or],In=Cr.completion;if(Cr.tryLoc==="root")return yr("end");if(Cr.tryLoc<=this.prev){var Mi=C.call(Cr,"catchLoc"),Ki=C.call(Cr,"finallyLoc");if(Mi&&Ki){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0);if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}else if(Mi){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0)}else{if(!Ki)throw new Error("try statement without catch or finally");if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}}}},abrupt:function(vt,Lt){for(var yr=this.tryEntries.length-1;yr>=0;--yr){var Or=this.tryEntries[yr];if(Or.tryLoc<=this.prev&&C.call(Or,"finallyLoc")&&this.prev<Or.finallyLoc){var Cr=Or;break}}Cr&&(vt==="break"||vt==="continue")&&Cr.tryLoc<=Lt&&Lt<=Cr.finallyLoc&&(Cr=null);var In=Cr?Cr.completion:{};return In.type=vt,In.arg=Lt,Cr?(this.method="next",this.next=Cr.finallyLoc,Mt):this.complete(In)},complete:function(vt,Lt){if(vt.type==="throw")throw vt.arg;return vt.type==="break"||vt.type==="continue"?this.next=vt.arg:vt.type==="return"?(this.rval=this.arg=vt.arg,this.method="return",this.next="end"):vt.type==="normal"&&Lt&&(this.next=Lt),Mt},finish:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.finallyLoc===vt)return this.complete(yr.completion,yr.afterLoc),bi(yr),Mt}},catch:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.tryLoc===vt){var Or=yr.completion;if(Or.type==="throw"){var Cr=Or.arg;bi(yr)}return Cr}}throw new Error("illegal catch attempt")},delegateYield:function(vt,Lt,yr){return this.delegate={iterator:ei(vt),resultName:Lt,nextLoc:yr},this.method==="next"&&(this.arg=void 0),Mt}},d}function RT(d){return FT(d)||OT(d)||XS(d)||DT()}function DT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OT(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function FT(d){if(Array.isArray(d))return Rb(d)}function VS(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function GS(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?VS(Object(C),!0).forEach(function(F){zT(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):VS(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function zT(d,y,C){return y=BT(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function BT(d){var y=HS(d,"string");return O0(y)==="symbol"?y:String(y)}function HS(d,y){if(O0(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(O0(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function $S(d,y,C,F,J,ie,me){try{var ke=d[ie](me),je=ke.value}catch(et){C(et);return}ke.done?y(je):Promise.resolve(je).then(F,J)}function NT(d){return function(){var y=this,C=arguments;return new Promise(function(F,J){var ie=d.apply(y,C);function me(je){$S(ie,F,J,me,ke,"next",je)}function ke(je){$S(ie,F,J,me,ke,"throw",je)}me(void 0)})}}function WS(d,y){return jT(d)||UT(d,y)||XS(d,y)||ZT()}function ZT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XS(d,y){if(d){if(typeof d=="string")return Rb(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Rb(d,y)}}function Rb(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function UT(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function jT(d){if(Array.isArray(d))return d}function VT(d,y){if(d==null)return{};var C=GT(d,y),F,J;if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(d);for(J=0;J<ie.length;J++)F=ie[J],!(y.indexOf(F)>=0)&&Object.prototype.propertyIsEnumerable.call(d,F)&&(C[F]=d[F])}return C}function GT(d,y){if(d==null)return{};var C={},F=Object.keys(d),J,ie;for(ie=0;ie<F.length;ie++)J=F[ie],!(y.indexOf(J)>=0)&&(C[J]=d[J]);return C}var HT=US.Option,$T=function(y){var C=y.searchParams,F=y.showDistrict,J=y.showAddress,ie=y.onSearchFinish,me=y.onChange,ke=VT(y,jS),je=(0,j.useState)([]),et=WS(je,2),bt=et[0],Mt=et[1];(0,j.useEffect)(function(){ie==null||ie(bt)},[ie,bt]);var sr=D2(function(){var Sr=NT(Lb().mark(function Ar(jr){var Kr,Tn,En,ui;return Lb().wrap(function(Bn){for(;;)switch(Bn.prev=Bn.next){case 0:if(jr){Bn.next=3;break}return Mt([]),Bn.abrupt("return");case 3:return En=Hf(EC,GS(GS({},C),{},{keywords:[].concat(RT(((Kr=C.keywords)!==null&&Kr!==void 0?Kr:"").split("|")),[jr]).filter(function(bi){return!!bi}).join("|")})),Bn.next=6,fetch(En);case 6:return Bn.next=8,Bn.sent.json();case 8:ui=Bn.sent,Mt(((Tn=ui==null?void 0:ui.tips)!==null&&Tn!==void 0?Tn:[]).filter(function(bi){return bi.location&&bi.location.length}).map(function(bi){var Zi=bi.location.split(","),ei=WS(Zi,2),mi=ei[0],$t=ei[1];return bi.longitude=+mi,bi.latitude=+$t,bi}));case 10:case"end":return Bn.stop()}},Ar)}));return function(Ar){return Sr.apply(this,arguments)}}(),{wait:1e3}),Kt=sr.run,vr=(0,j.useCallback)(function(Sr){var Ar=Sr&&bt.find(function(jr){return jr.name===Sr});me==null||me(Sr||void 0,Ar||void 0)},[me,bt]);return j.createElement(US,N1({className:"".concat(f1),onSearch:Kt,onChange:vr,clearIcon:function(){return null}},ke),bt.map(function(Sr){var Ar="".concat(F?Sr.district:"").concat(J?Sr.address:"");return j.createElement(HT,{key:Sr.id,value:Sr.name},j.createElement("div",{title:Sr.name,className:"".concat(f1,"__option-name")},Sr.name),Ar&&j.createElement("div",{title:Ar,className:"".concat(f1,"__option-tip")},Ar))}))};$T.defaultProps={placeholder:"\u8BF7\u8F93\u5165\u8981\u641C\u7D22\u5730\u540D",showSearch:!0,allowClear:!0,filterOption:!1,defaultActiveFirstOption:!1,showAddress:!0,showDistrict:!0};function F0(d){"@babel/helpers - typeof";return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},F0(d)}function Db(){"use strict";Db=function(){return d};var d={},y=Object.prototype,C=y.hasOwnProperty,F=Object.defineProperty||function($t,vt,Lt){$t[vt]=Lt.value},J=typeof Symbol=="function"?Symbol:{},ie=J.iterator||"@@iterator",me=J.asyncIterator||"@@asyncIterator",ke=J.toStringTag||"@@toStringTag";function je($t,vt,Lt){return Object.defineProperty($t,vt,{value:Lt,enumerable:!0,configurable:!0,writable:!0}),$t[vt]}try{je({},"")}catch($t){je=function(Lt,yr,Or){return Lt[yr]=Or}}function et($t,vt,Lt,yr){var Or=vt&&vt.prototype instanceof sr?vt:sr,Cr=Object.create(Or.prototype),In=new Zi(yr||[]);return F(Cr,"_invoke",{value:ui($t,Lt,In)}),Cr}function bt($t,vt,Lt){try{return{type:"normal",arg:$t.call(vt,Lt)}}catch(yr){return{type:"throw",arg:yr}}}d.wrap=et;var Mt={};function sr(){}function Kt(){}function vr(){}var Sr={};je(Sr,ie,function(){return this});var Ar=Object.getPrototypeOf,jr=Ar&&Ar(Ar(ei([])));jr&&jr!==y&&C.call(jr,ie)&&(Sr=jr);var Kr=vr.prototype=sr.prototype=Object.create(Sr);function Tn($t){["next","throw","return"].forEach(function(vt){je($t,vt,function(Lt){return this._invoke(vt,Lt)})})}function En($t,vt){function Lt(Or,Cr,In,Mi){var Ki=bt($t[Or],$t,Cr);if(Ki.type!=="throw"){var Yo=Ki.arg,Va=Yo.value;return Va&&F0(Va)=="object"&&C.call(Va,"__await")?vt.resolve(Va.__await).then(function(Co){Lt("next",Co,In,Mi)},function(Co){Lt("throw",Co,In,Mi)}):vt.resolve(Va).then(function(Co){Yo.value=Co,In(Yo)},function(Co){return Lt("throw",Co,In,Mi)})}Mi(Ki.arg)}var yr;F(this,"_invoke",{value:function(Cr,In){function Mi(){return new vt(function(Ki,Yo){Lt(Cr,In,Ki,Yo)})}return yr=yr?yr.then(Mi,Mi):Mi()}})}function ui($t,vt,Lt){var yr="suspendedStart";return function(Or,Cr){if(yr==="executing")throw new Error("Generator is already running");if(yr==="completed"){if(Or==="throw")throw Cr;return mi()}for(Lt.method=Or,Lt.arg=Cr;;){var In=Lt.delegate;if(In){var Mi=ai(In,Lt);if(Mi){if(Mi===Mt)continue;return Mi}}if(Lt.method==="next")Lt.sent=Lt._sent=Lt.arg;else if(Lt.method==="throw"){if(yr==="suspendedStart")throw yr="completed",Lt.arg;Lt.dispatchException(Lt.arg)}else Lt.method==="return"&&Lt.abrupt("return",Lt.arg);yr="executing";var Ki=bt($t,vt,Lt);if(Ki.type==="normal"){if(yr=Lt.done?"completed":"suspendedYield",Ki.arg===Mt)continue;return{value:Ki.arg,done:Lt.done}}Ki.type==="throw"&&(yr="completed",Lt.method="throw",Lt.arg=Ki.arg)}}}function ai($t,vt){var Lt=vt.method,yr=$t.iterator[Lt];if(yr===void 0)return vt.delegate=null,Lt==="throw"&&$t.iterator.return&&(vt.method="return",vt.arg=void 0,ai($t,vt),vt.method==="throw")||Lt!=="return"&&(vt.method="throw",vt.arg=new TypeError("The iterator does not provide a '"+Lt+"' method")),Mt;var Or=bt(yr,$t.iterator,vt.arg);if(Or.type==="throw")return vt.method="throw",vt.arg=Or.arg,vt.delegate=null,Mt;var Cr=Or.arg;return Cr?Cr.done?(vt[$t.resultName]=Cr.value,vt.next=$t.nextLoc,vt.method!=="return"&&(vt.method="next",vt.arg=void 0),vt.delegate=null,Mt):Cr:(vt.method="throw",vt.arg=new TypeError("iterator result is not an object"),vt.delegate=null,Mt)}function Bn($t){var vt={tryLoc:$t[0]};1 in $t&&(vt.catchLoc=$t[1]),2 in $t&&(vt.finallyLoc=$t[2],vt.afterLoc=$t[3]),this.tryEntries.push(vt)}function bi($t){var vt=$t.completion||{};vt.type="normal",delete vt.arg,$t.completion=vt}function Zi($t){this.tryEntries=[{tryLoc:"root"}],$t.forEach(Bn,this),this.reset(!0)}function ei($t){if($t){var vt=$t[ie];if(vt)return vt.call($t);if(typeof $t.next=="function")return $t;if(!isNaN($t.length)){var Lt=-1,yr=function Or(){for(;++Lt<$t.length;)if(C.call($t,Lt))return Or.value=$t[Lt],Or.done=!1,Or;return Or.value=void 0,Or.done=!0,Or};return yr.next=yr}}return{next:mi}}function mi(){return{value:void 0,done:!0}}return Kt.prototype=vr,F(Kr,"constructor",{value:vr,configurable:!0}),F(vr,"constructor",{value:Kt,configurable:!0}),Kt.displayName=je(vr,ke,"GeneratorFunction"),d.isGeneratorFunction=function($t){var vt=typeof $t=="function"&&$t.constructor;return!!vt&&(vt===Kt||(vt.displayName||vt.name)==="GeneratorFunction")},d.mark=function($t){return Object.setPrototypeOf?Object.setPrototypeOf($t,vr):($t.__proto__=vr,je($t,ke,"GeneratorFunction")),$t.prototype=Object.create(Kr),$t},d.awrap=function($t){return{__await:$t}},Tn(En.prototype),je(En.prototype,me,function(){return this}),d.AsyncIterator=En,d.async=function($t,vt,Lt,yr,Or){Or===void 0&&(Or=Promise);var Cr=new En(et($t,vt,Lt,yr),Or);return d.isGeneratorFunction(vt)?Cr:Cr.next().then(function(In){return In.done?In.value:Cr.next()})},Tn(Kr),je(Kr,ke,"Generator"),je(Kr,ie,function(){return this}),je(Kr,"toString",function(){return"[object Generator]"}),d.keys=function($t){var vt=Object($t),Lt=[];for(var yr in vt)Lt.push(yr);return Lt.reverse(),function Or(){for(;Lt.length;){var Cr=Lt.pop();if(Cr in vt)return Or.value=Cr,Or.done=!1,Or}return Or.done=!0,Or}},d.values=ei,Zi.prototype={constructor:Zi,reset:function(vt){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(bi),!vt)for(var Lt in this)Lt.charAt(0)==="t"&&C.call(this,Lt)&&!isNaN(+Lt.slice(1))&&(this[Lt]=void 0)},stop:function(){this.done=!0;var vt=this.tryEntries[0].completion;if(vt.type==="throw")throw vt.arg;return this.rval},dispatchException:function(vt){if(this.done)throw vt;var Lt=this;function yr(Yo,Va){return In.type="throw",In.arg=vt,Lt.next=Yo,Va&&(Lt.method="next",Lt.arg=void 0),!!Va}for(var Or=this.tryEntries.length-1;Or>=0;--Or){var Cr=this.tryEntries[Or],In=Cr.completion;if(Cr.tryLoc==="root")return yr("end");if(Cr.tryLoc<=this.prev){var Mi=C.call(Cr,"catchLoc"),Ki=C.call(Cr,"finallyLoc");if(Mi&&Ki){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0);if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}else if(Mi){if(this.prev<Cr.catchLoc)return yr(Cr.catchLoc,!0)}else{if(!Ki)throw new Error("try statement without catch or finally");if(this.prev<Cr.finallyLoc)return yr(Cr.finallyLoc)}}}},abrupt:function(vt,Lt){for(var yr=this.tryEntries.length-1;yr>=0;--yr){var Or=this.tryEntries[yr];if(Or.tryLoc<=this.prev&&C.call(Or,"finallyLoc")&&this.prev<Or.finallyLoc){var Cr=Or;break}}Cr&&(vt==="break"||vt==="continue")&&Cr.tryLoc<=Lt&&Lt<=Cr.finallyLoc&&(Cr=null);var In=Cr?Cr.completion:{};return In.type=vt,In.arg=Lt,Cr?(this.method="next",this.next=Cr.finallyLoc,Mt):this.complete(In)},complete:function(vt,Lt){if(vt.type==="throw")throw vt.arg;return vt.type==="break"||vt.type==="continue"?this.next=vt.arg:vt.type==="return"?(this.rval=this.arg=vt.arg,this.method="return",this.next="end"):vt.type==="normal"&&Lt&&(this.next=Lt),Mt},finish:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.finallyLoc===vt)return this.complete(yr.completion,yr.afterLoc),bi(yr),Mt}},catch:function(vt){for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var yr=this.tryEntries[Lt];if(yr.tryLoc===vt){var Or=yr.completion;if(Or.type==="throw"){var Cr=Or.arg;bi(yr)}return Cr}}throw new Error("illegal catch attempt")},delegateYield:function(vt,Lt,yr){return this.delegate={iterator:ei(vt),resultName:Lt,nextLoc:yr},this.method==="next"&&(this.arg=void 0),Mt}},d}function YS(d){return YT(d)||XT(d)||JS(d)||WT()}function WT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XT(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function YT(d){if(Array.isArray(d))return Fb(d)}function qS(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function Ob(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?qS(Object(C),!0).forEach(function(F){qT(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):qS(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function qT(d,y,C){return y=KT(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function KT(d){var y=JT(d,"string");return F0(y)==="symbol"?y:String(y)}function JT(d,y){if(F0(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(F0(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function KS(d,y,C,F,J,ie,me){try{var ke=d[ie](me),je=ke.value}catch(et){C(et);return}ke.done?y(je):Promise.resolve(je).then(F,J)}function QT(d){return function(){var y=this,C=arguments;return new Promise(function(F,J){var ie=d.apply(y,C);function me(je){KS(ie,F,J,me,ke,"next",je)}function ke(je){KS(ie,F,J,me,ke,"throw",je)}me(void 0)})}}function Z1(d,y){return rM(d)||tM(d,y)||JS(d,y)||eM()}function eM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JS(d,y){if(d){if(typeof d=="string")return Fb(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Fb(d,y)}}function Fb(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function tM(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function rM(d){if(Array.isArray(d))return d}var tk=function(y){var C=y.className,F=y.style,J=y.searchParams,ie=y.transformBounds,me=y.onChange,ke=useScene(),je=useState("-"),et=Z1(je,2),bt=et[0],Mt=et[1];return useEffect(function(){var sr=function(){var vr=QT(Db().mark(function Sr(){var Ar,jr,Kr,Tn,En,ui,ai,Bn,bi,Zi,ei,mi;return Db().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:if(ke){vt.next=2;break}return vt.abrupt("return");case 2:return Ar=function(yr,Or){return new Promise(function(Cr,In){fetch(urlStringify(GAO_DE_API_URL,Ob(Ob({},J),{},{location:"".concat(yr,",").concat(Or)}))).then(function(Mi){return Mi.json()}).then(function(Mi){if(Mi.status==="1"){var Ki=Mi.regeocode.addressComponent,Yo=Ki.country,Va=Ki.province,Co=Ki.city,kl=Ki.district,cu=Ki.township;Cr([Yo,Va,Co,kl,cu].filter(function(Bc){return typeof Bc=="string"&&Bc}))}else In(Mi)})})},jr=ke.getBounds(),Kr=Z1(jr,2),Tn=Kr[0],En=Kr[1],ie&&(ui=ie([Tn,En]),ai=Z1(ui,2),Tn=ai[0],En=ai[1]),vt.next=7,Promise.all([Ar.apply(void 0,YS(Tn)),Ar.apply(void 0,YS(En))]);case 7:Bn=vt.sent,bi=Z1(Bn,2),Zi=bi[0],ei=bi[1],mi=Zi.length&&ei.length?intersection(Zi,ei).join(" "):"-",Mt(mi),me==null||me(mi,[Tn,En]);case 14:case"end":return vt.stop()}},Sr)}));return function(){return vr.apply(this,arguments)}}(),Kt=debounce(sr,500,{maxWait:500});return sr(),ke==null||ke.on("mapchange",Kt),function(){ke==null||ke.off("mapchange",Kt)}},[me,ke,J,ie]),React.createElement("div",{className:classNames([C,CLS_PREFIX]),style:F},bt)},zb="larkmap-legend-icon",rk=function(y){var C=y.labels,F=y.icons,J=y.className,ie=y.style;return React.createElement("div",{className:classnames("".concat(zb),J),style:ie},C.map(function(me,ke){return React.createElement("div",{key:me,className:"".concat(zb,"__content")},React.createElement("img",{src:F[ke],className:"".concat(zb,"__content__icon")}),React.createElement("div",null,me))}))};function nM(d){return Ka(d)&&d!=+d}var QS=nM,iM=0;function aM(d){var y=++iM;return Qe(d)+y}var oM=aM;function sM(d){return cM(d)||lM(d)||e3(d)||uM()}function uM(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lM(d){if(typeof Symbol!="undefined"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}function cM(d){if(Array.isArray(d))return Bb(d)}function hM(d,y){return dM(d)||pM(d,y)||e3(d,y)||fM()}function fM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e3(d,y){if(d){if(typeof d=="string")return Bb(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return Bb(d,y)}}function Bb(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function pM(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function dM(d){if(Array.isArray(d))return d}var U1="larkmap-legend-proportion",vM=function(y){var C=y.labels,F=y.fillColor,J=F===void 0?"#f9f9f9":F,ie=y.className,me=y.style,ke=hM(C,2),je=ke[0],et=ke[1],bt=[86,62,38,24];function Mt(Sr,Ar){var jr=(Ar-Sr)/4,Kr=Math.floor(Sr+jr),Tn=Math.floor(Ar-jr);return[Kr,Tn]}function sr(){var Sr=je,Ar=et;(!Ka(Sr)||!Ka(Sr))&&(Sr=Ar=0),QS(Sr)&&(Sr=0),QS(Ar)&&(Ar=0);var jr=Mt(Sr,Ar),Kr=[{prefix:"MIN:",val:Sr}].concat(sM(jr),[{prefix:"MAX:",val:Ar}]);return Kr}function Kt(){return j.createElement("div",{className:"".concat(U1,"__circlebox"),style:{width:bt[0]}},bt.map(function(Sr){return j.createElement("div",{key:Sr,style:{width:Sr,height:Sr,background:J},className:"".concat(U1,"__circlebox__item")})}))}function vr(){return j.createElement("div",{style:{height:bt[0]}},sr().reverse().map(function(Sr){return j.createElement("div",{key:oM(),className:"".concat(U1,"__labelitem")},Sr==null?void 0:Sr.prefix,typeof Sr=="number"?Sr:Sr.val)}))}return j.createElement("div",{className:Ie()("".concat(U1),ie),style:me},j.createElement(Kt,null),j.createElement(vr,null))};vM.defaultProps={fillColor:"#f9f9f9"};var mM=G(6767),Nb=G.n(mM);function gM(d){return function(y,C,F){for(var J=-1,ie=Object(y),me=F(y),ke=me.length;ke--;){var je=me[d?ke:++J];if(C(ie[je],je,ie)===!1)break}return y}}var yM=gM,_M=yM(),bM=_M;function xM(d,y){return d&&bM(d,y,tc)}var wM=xM;function SM(d,y){return function(C,F){if(C==null)return C;if(!Fh(C))return d(C,F);for(var J=C.length,ie=y?J:-1,me=Object(C);(y?ie--:++ie<J)&&F(me[ie],ie,me)!==!1;);return C}}var EM=SM,CM=EM(wM),AM=CM;function t3(d){return typeof d=="function"?d:K2}var TM=t3;function MM(d,y){var C=zo(d)?Di:AM;return C(d,TM(y))}var r3=MM,PM=/\s/;function kM(d){for(var y=d.length;y--&&PM.test(d.charAt(y)););return y}var IM=kM,LM=/^\s+/;function RM(d){return d&&d.slice(0,IM(d)+1).replace(LM,"")}var DM=RM,n3=0/0,OM=/^[-+]0x[0-9a-f]+$/i,FM=/^0b[01]+$/i,zM=/^0o[0-7]+$/i,i3=parseInt;function BM(d){if(typeof d=="number")return d;if(Wt(d))return n3;if(Gu(d)){var y=typeof d.valueOf=="function"?d.valueOf():d;d=Gu(y)?y+"":y}if(typeof d!="string")return d===0?d:+d;d=DM(d);var C=FM.test(d);return C||zM.test(d)?i3(d.slice(2),C?2:8):OM.test(d)?n3:+d}var a3=BM,o3=1/0,NM=17976931348623157e292;function ZM(d){if(!d)return d===0?d:0;if(d=a3(d),d===o3||d===-o3){var y=d<0?-1:1;return y*NM}return d===d?d:0}var UM=ZM;function jM(d){var y=UM(d),C=y%1;return y===y?C?y-C:y:0}var VM=jM,GM=er.isFinite,HM=Math.min;function $M(d){var y=Math[d];return function(C,F){if(C=a3(C),F=F==null?0:HM(VM(F),292),F&&GM(C)){var J=(Qe(C)+"e").split("e"),ie=y(J[0]+"e"+(+J[1]+F));return J=(Qe(ie)+"e").split("e"),+(J[0]+"e"+(+J[1]-F))}return y(C)}}var WM=$M,Zb=WM("round"),Ub=Zb,XM=function(y,C){var F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5,J=[y],ie=Nb()(y).object(),me=Nb()(C).object();if(F<2)return F<1?[]:J;var ke={r:(ie.r-me.r)/(F-1),g:(ie.g-me.g)/(F-1),b:(ie.b-me.b)/(F-1)};return r3(new Array(F-2),function(je,et){return J.push(Nb()({r:Ub(ie.r-ke.r*(et+1),0),g:Ub(ie.g-ke.g*(et+1),0),b:Ub(ie.b-ke.b*(et+1),0)}).hex())}),J.push(C),J};function Py(d){"@babel/helpers - typeof";return Py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Py(d)}function YM(d,y,C){return y=s3(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function s3(d){var y=qM(d,"string");return Py(y)==="symbol"?y:String(y)}function qM(d,y){if(Py(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(Py(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}var ky="larkmap-legend-category";function KM(d){var y=d.labels,C=d.colors,F=d.geometryType,J=F===void 0?"circle":F,ie=d.isStrokeColor,me=d.style,ke=d.className;function je(Mt){return ie?{border:"2px solid ".concat(Mt)}:{background:Mt}}function et(Mt){return j.createElement("div",{className:Ie()(ky,ke),style:me},y.map(function(sr,Kt){return j.createElement("div",{className:"".concat(ky,"__content"),key:sr},j.createElement("div",{className:Ie()("".concat(ky,"__content__shape"),YM({},"".concat(ky,"__content__").concat(J),J)),style:je(Mt[Kt])}),j.createElement("div",{className:"".concat(ky,"labels")},sr))}))}function bt(){if(Array.isArray(C))return et(C);var Mt=XM(C.startColor,C.endColor,y.length);return et(Mt)}return j.createElement(bt,null)}KM.defaultProps={geometryType:"circle",isStrokeColor:!1};function JM(d){var y=(0,j.useRef)(0),C=Se((0,j.useState)(d),2),F=C[0],J=C[1],ie=(0,j.useCallback)(function(me){cancelAnimationFrame(y.current),y.current=requestAnimationFrame(function(){J(me)})},[]);return af(function(){cancelAnimationFrame(y.current)}),[F,ie]}var QM=JM,e4=!!(typeof window!="undefined"&&window.document&&window.document.createElement),u3=e4;function jb(d,y){if(u3){if(!d)return y;var C;return hl(d)?C=d():"current"in d?C=d.current:C=d,C}}function l3(d,y){if(d===y)return!0;for(var C=0;C<d.length;C++)if(!Object.is(d[C],y[C]))return!1;return!0}var t4=function(d){var y=function(C,F,J){var ie=(0,j.useRef)(!1),me=(0,j.useRef)([]),ke=(0,j.useRef)([]),je=(0,j.useRef)();d(function(){var et,bt=Array.isArray(J)?J:[J],Mt=bt.map(function(sr){return jb(sr)});if(!ie.current){ie.current=!0,me.current=Mt,ke.current=F,je.current=C();return}(Mt.length!==me.current.length||!l3(Mt,me.current)||!l3(F,ke.current))&&((et=je.current)===null||et===void 0||et.call(je),me.current=Mt,ke.current=F,je.current=C())}),af(function(){var et;(et=je.current)===null||et===void 0||et.call(je),ie.current=!1})};return y},c3=t4,r4=c3(j.useEffect),n4=r4,i4=c3(j.useLayoutEffect),a4=i4,o4=u3?a4:n4,h3=o4;function s4(d){var y=Se(QM(function(){var J=jb(d);return J?{width:J.clientWidth,height:J.clientHeight}:void 0}),2),C=y[0],F=y[1];return h3(function(){var J=jb(d);if(J){var ie=new Sw(function(me){me.forEach(function(ke){var je=ke.target,et=je.clientWidth,bt=je.clientHeight;F({width:et,height:bt})})});return ie.observe(J),function(){ie.disconnect()}}},[],d),C}var u4=s4,cg="larkmap-legend-ramp",nk=function(y){var C=y[y.length-1],F=y[0];return Number.isFinite(F)||(F=parseInt(F,10)),Number.isFinite(C)||(C=parseInt(C,10)),[F,C]};function Vb(d){var y=d.labels,C=d.labelUnit,F=C===void 0?"":C,J=d.colors,ie=y[0]+F,me=y[y.length-1]+F;return j.createElement(j.Fragment,null,j.createElement("div",{className:"".concat(cg,"__continuous"),style:{background:"linear-gradient(to right,".concat(J,")")}}),j.createElement("div",{className:"".concat(cg,"__continuous-labelbar")},j.createElement("span",null,ie),j.createElement("span",null,me)))}function f3(d){var y=d.labels,C=d.labelUnit,F=C===void 0?"":C,J=d.colors,ie=(0,j.useRef)(null),me=u4(ie),ke=(me==null?void 0:me.width)/(J.length+1),je=y;if(y.length+1===J.length){var et="< "+y[0],bt="\u2265 "+y[y.length-1];je.unshift(et),je.push(bt)}var Mt=function(Kt){var vr="".concat(y[Kt]).concat(F," - ").concat(y[Kt+1]).concat(F);return vr};return j.createElement("div",{className:"".concat(cg,"__dis-continuous"),ref:ie},Number.isNaN(ke)?null:j.createElement(j.Fragment,null,j.createElement("div",{className:"".concat(cg,"__dis-continuous__colors"),style:{paddingLeft:ke/2}},J==null?void 0:J.map(function(sr,Kt){return j.createElement("div",{key:sr,title:Mt(Kt),className:"".concat(cg,"__dis-continuous__color"),style:{background:sr,width:ke}})})),j.createElement("div",{className:"".concat(cg,"__dis-continuous__labels")},y==null?void 0:y.map(function(sr){var Kt=sr+F;return j.createElement("span",{key:sr,className:"".concat(cg,"__dis-continuous__label")},Kt)}))))}function l4(d){var y=d.isContinuous,C=d.labels,F=d.colors,J=d.labelUnit,ie=d.className,me=d.style;return j.createElement("div",{className:Ie()("".concat(cg),ie),style:me},y?j.createElement(Vb,{labels:C,labelUnit:J,colors:F}):j.createElement(f3,{labels:C,labelUnit:J,colors:F}))}l4.defaultProps={isContinuous:!1,labelUnit:""};var Iy=G(67135),ik={point:Iy.DrawPoint,line:Iy.DrawLine,polygon:Iy.DrawPolygon,rect:Iy.DrawRect,circle:Iy.DrawCircle};function Ly(d){"@babel/helpers - typeof";return Ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Ly(d)}function p3(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function Gb(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?p3(Object(C),!0).forEach(function(F){c4(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):p3(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function c4(d,y,C){return y=h4(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function h4(d){var y=f4(d,"string");return Ly(y)==="symbol"?y:String(y)}function f4(d,y){if(Ly(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(Ly(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}function Hb(d,y){return ak(d)||v4(d,y)||d4(d,y)||p4()}function p4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d4(d,y){if(d){if(typeof d=="string")return d3(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return d3(d,y)}}function d3(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function v4(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function ak(d){if(Array.isArray(d))return d}var m4=function(y){var C=useScene(),F=useState(function(){var vr,Sr;return(vr=cloneDeep(y==null||(Sr=y.options)===null||Sr===void 0?void 0:Sr.initialData))!==null&&vr!==void 0?vr:[]}),J=Hb(F,2),ie=J[0],me=J[1],ke=useMemo(function(){if(!C)return console.error("useDraw \u53EA\u80FD\u4F7F\u7528\u5728 LarkMap \u5BB9\u5668\u4E2D"),null;var vr=DRAW_TYPE_MAP[y.type],Sr=new vr(C,Gb(Gb({},y.options),{},{initialData:cloneDeep(ie)}));return Sr},[C,JSON.stringify(omit(y.options,"initialData")),y.type]),je=useState(ke.isEnable()),et=Hb(je,2),bt=et[0],Mt=et[1];useEffect(function(){var vr=function(){return Mt(!0)},Sr=function(){return Mt(!1)},Ar=function(Kr){me(Kr)};return ke==null||ke.setData(ie),ke==null||ke.on(DrawEvent.Enable,vr),ke==null||ke.on(DrawEvent.Disable,Sr),ke==null||ke.on(DrawEvent.Change,Ar),function(){me(ke.getData()),ke==null||ke.off(DrawEvent.Enable,vr),ke==null||ke.off(DrawEvent.Disable,Sr),ke==null||ke.off(DrawEvent.Change,Ar),ke==null||ke.destroy()}},[ke]);var sr=useCallback(function(vr){ke==null||ke.setData(vr),me(vr)},[ke]),Kt=useMemo(function(){return{enable:ke==null?void 0:ke.enable.bind(ke),disable:ke==null?void 0:ke.disable.bind(ke),getDrawData:ke==null?void 0:ke.getData.bind(ke)}},[ke]);return Gb({drawType:y.type,draw:ke,drawData:ie,setDrawData:sr,isEnable:bt},Kt)};function z0(d){"@babel/helpers - typeof";return z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},z0(d)}function j1(d,y){return b4(d)||_4(d,y)||y4(d,y)||g4()}function g4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y4(d,y){if(d){if(typeof d=="string")return v3(d,y);var C=Object.prototype.toString.call(d).slice(8,-1);if(C==="Object"&&d.constructor&&(C=d.constructor.name),C==="Map"||C==="Set")return Array.from(d);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return v3(d,y)}}function v3(d,y){(y==null||y>d.length)&&(y=d.length);for(var C=0,F=new Array(y);C<y;C++)F[C]=d[C];return F}function _4(d,y){var C=d==null?null:typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(C!=null){var F,J,ie,me,ke=[],je=!0,et=!1;try{if(ie=(C=C.call(d)).next,y===0){if(Object(C)!==C)return;je=!1}else for(;!(je=(F=ie.call(C)).done)&&(ke.push(F.value),ke.length!==y);je=!0);}catch(bt){et=!0,J=bt}finally{try{if(!je&&C.return!=null&&(me=C.return(),Object(me)!==me))return}finally{if(et)throw J}}return ke}}function b4(d){if(Array.isArray(d))return d}function m3(d,y){var C=Object.keys(d);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(d);y&&(F=F.filter(function(J){return Object.getOwnPropertyDescriptor(d,J).enumerable})),C.push.apply(C,F)}return C}function $b(d){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?m3(Object(C),!0).forEach(function(F){x4(d,F,C[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(C)):m3(Object(C)).forEach(function(F){Object.defineProperty(d,F,Object.getOwnPropertyDescriptor(C,F))})}return d}function x4(d,y,C){return y=w4(y),y in d?Object.defineProperty(d,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):d[y]=C,d}function w4(d){var y=S4(d,"string");return z0(y)==="symbol"?y:String(y)}function S4(d,y){if(z0(d)!=="object"||d===null)return d;var C=d[Symbol.toPrimitive];if(C!==void 0){var F=C.call(d,y||"default");if(z0(F)!=="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(d)}var E4=function(y,C){var F=y.point,J=y.line,ie=y.polygon,me=y.rect,ke=y.circle,je=!!F,et=!!J,bt=!!ie,Mt=!!me,sr=!!ke,Kt=useCallback(function(ei){return $b($b({},C),ei instanceof Object?ei:{})},[C]),vr=useDraw({type:"point",options:Kt(F)}),Sr=useDraw({type:"line",options:Kt(J)}),Ar=useDraw({type:"polygon",options:Kt(ie)}),jr=useDraw({type:"rect",options:Kt(me)}),Kr=useDraw({type:"circle",options:Kt(ke)}),Tn=useMemo(function(){return fromPairs(toPairs({point:je?vr:void 0,line:et?Sr:void 0,polygon:bt?Ar:void 0,rect:Mt?jr:void 0,circle:sr?Kr:void 0}).filter(function(ei){var mi=j1(ei,2),$t=mi[1];return!!$t}))},[vr,Sr,Ar,jr,Kr,je,et,bt,Mt,sr]),En=useMemo(function(){return fromPairs(toPairs(Tn).map(function(ei){var mi=j1(ei,2),$t=mi[0],vt=mi[1];return[$t,vt.draw]}))},[Tn]),ui=useMemo(function(){return fromPairs(toPairs(Tn).map(function(ei){var mi=j1(ei,2),$t=mi[0],vt=mi[1];return[$t,vt.drawData]}))},[Tn]),ai=useCallback(function(ei){Object.entries(ei).forEach(function(mi){var $t,vt=j1(mi,2),Lt=vt[0],yr=vt[1];($t=Tn[Lt])===null||$t===void 0||$t.setDrawData(yr)})},[Tn]),Bn=useMemo(function(){return Object.values(Tn).find(function(ei){return ei.isEnable})},[Tn]),bi=useMemo(function(){var ei;return(ei=Bn==null?void 0:Bn.draw)!==null&&ei!==void 0?ei:null},[Bn]),Zi=useCallback(function(ei){Object.values(Tn).forEach(function(mi){var $t,vt;if(mi){var Lt=typeof ei=="string"?($t=(vt=Tn[ei])===null||vt===void 0?void 0:vt.draw)!==null&&$t!==void 0?$t:null:ei;if(!Lt){mi.disable();return}var yr=mi.isEnable;Lt===mi.draw?yr||mi.enable():yr&&mi.disable()}})},[Tn]);return{drawMap:En,drawGroupData:ui,setDrawGroupData:ai,activeDraw:bi,activeDrawInfo:Bn,setActiveDraw:Zi}},ok=function(y){var C=y.scenes,F=y.options;return React.useEffect(function(){var J=syncScene(C,F);return J},[C,F]),React.createElement(React.Fragment,null)}},38163:function(Ue){Ue.exports=_e;function _e(j,P){var M=j&&j.type,ee;if(M==="FeatureCollection")for(ee=0;ee<j.features.length;ee++)_e(j.features[ee],P);else if(M==="GeometryCollection")for(ee=0;ee<j.geometries.length;ee++)_e(j.geometries[ee],P);else if(M==="Feature")_e(j.geometry,P);else if(M==="Polygon")G(j.coordinates,P);else if(M==="MultiPolygon")for(ee=0;ee<j.coordinates.length;ee++)G(j.coordinates[ee],P);return j}function G(j,P){if(j.length!==0){K(j[0],P);for(var M=1;M<j.length;M++)K(j[M],!P)}}function K(j,P){for(var M=0,ee=0,te=0,pe=j.length,Ce=pe-1;te<pe;Ce=te++){var le=(j[te][0]-j[Ce][0])*(j[Ce][1]+j[te][1]),Ie=M+le;ee+=Math.abs(M)>=Math.abs(le)?M-Ie+le:le-Ie+M,M=Ie}M+ee>=0!=!!P&&j.reverse()}},75550:function(Ue){"use strict";Ue.exports=_e;function _e(G,K){this.x=G,this.y=K}_e.prototype={clone:function(){return new _e(this.x,this.y)},add:function(G){return this.clone()._add(G)},sub:function(G){return this.clone()._sub(G)},multByPoint:function(G){return this.clone()._multByPoint(G)},divByPoint:function(G){return this.clone()._divByPoint(G)},mult:function(G){return this.clone()._mult(G)},div:function(G){return this.clone()._div(G)},rotate:function(G){return this.clone()._rotate(G)},rotateAround:function(G,K){return this.clone()._rotateAround(G,K)},matMult:function(G){return this.clone()._matMult(G)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(G){return this.x===G.x&&this.y===G.y},dist:function(G){return Math.sqrt(this.distSqr(G))},distSqr:function(G){var K=G.x-this.x,j=G.y-this.y;return K*K+j*j},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(G){return Math.atan2(this.y-G.y,this.x-G.x)},angleWith:function(G){return this.angleWithSep(G.x,G.y)},angleWithSep:function(G,K){return Math.atan2(this.x*K-this.y*G,this.x*G+this.y*K)},_matMult:function(G){var K=G[0]*this.x+G[1]*this.y,j=G[2]*this.x+G[3]*this.y;return this.x=K,this.y=j,this},_add:function(G){return this.x+=G.x,this.y+=G.y,this},_sub:function(G){return this.x-=G.x,this.y-=G.y,this},_mult:function(G){return this.x*=G,this.y*=G,this},_div:function(G){return this.x/=G,this.y/=G,this},_multByPoint:function(G){return this.x*=G.x,this.y*=G.y,this},_divByPoint:function(G){return this.x/=G.x,this.y/=G.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var G=this.y;return this.y=this.x,this.x=-G,this},_rotate:function(G){var K=Math.cos(G),j=Math.sin(G),P=K*this.x-j*this.y,M=j*this.x+K*this.y;return this.x=P,this.y=M,this},_rotateAround:function(G,K){var j=Math.cos(G),P=Math.sin(G),M=K.x+j*(this.x-K.x)-P*(this.y-K.y),ee=K.y+P*(this.x-K.x)+j*(this.y-K.y);return this.x=M,this.y=ee,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_e.convert=function(G){return G instanceof _e?G:Array.isArray(G)?new _e(G[0],G[1]):G}},99874:function(Ue){Ue.exports=_e;function _e(G,K,j,P){this.cx=3*G,this.bx=3*(j-G)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*K,this.by=3*(P-K)-this.cy,this.ay=1-this.cy-this.by,this.p1x=G,this.p1y=P,this.p2x=j,this.p2y=P}_e.prototype.sampleCurveX=function(G){return((this.ax*G+this.bx)*G+this.cx)*G},_e.prototype.sampleCurveY=function(G){return((this.ay*G+this.by)*G+this.cy)*G},_e.prototype.sampleCurveDerivativeX=function(G){return(3*this.ax*G+2*this.bx)*G+this.cx},_e.prototype.solveCurveX=function(G,K){typeof K=="undefined"&&(K=1e-6);var j,P,M,ee,te;for(M=G,te=0;te<8;te++){if(ee=this.sampleCurveX(M)-G,Math.abs(ee)<K)return M;var pe=this.sampleCurveDerivativeX(M);if(Math.abs(pe)<1e-6)break;M=M-ee/pe}if(j=0,P=1,M=G,M<j)return j;if(M>P)return P;for(;j<P;){if(ee=this.sampleCurveX(M),Math.abs(ee-G)<K)return M;G>ee?j=M:P=M,M=(P-j)*.5+j}return M},_e.prototype.solve=function(G,K){return this.sampleCurveY(this.solveCurveX(G,K))}},38929:function(Ue,_e,G){Ue.exports.VectorTile=G(22779),G(66024),G(59701)},22779:function(Ue,_e,G){"use strict";var K=G(59701);Ue.exports=j;function j(M,ee){this.layers=M.readFields(P,{},ee)}function P(M,ee,te){if(M===3){var pe=new K(te,te.readVarint()+te.pos);pe.length&&(ee[pe.name]=pe)}}},66024:function(Ue,_e,G){"use strict";var K=G(75550);Ue.exports=j;function j(pe,Ce,le,Ie,rt){this.properties={},this.extent=le,this.type=0,this._pbf=pe,this._geometry=-1,this._keys=Ie,this._values=rt,pe.readFields(P,this,Ce)}function P(pe,Ce,le){pe==1?Ce.id=le.readVarint():pe==2?M(le,Ce):pe==3?Ce.type=le.readVarint():pe==4&&(Ce._geometry=le.pos)}function M(pe,Ce){for(var le=pe.readVarint()+pe.pos;pe.pos<le;){var Ie=Ce._keys[pe.readVarint()],rt=Ce._values[pe.readVarint()];Ce.properties[Ie]=rt}}j.types=["Unknown","Point","LineString","Polygon"],j.prototype.loadGeometry=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Ce=pe.readVarint()+pe.pos,le=1,Ie=0,rt=0,xt=0,nt=[],Ct;pe.pos<Ce;){if(Ie<=0){var jt=pe.readVarint();le=jt&7,Ie=jt>>3}if(Ie--,le===1||le===2)rt+=pe.readSVarint(),xt+=pe.readSVarint(),le===1&&(Ct&&nt.push(Ct),Ct=[]),Ct.push(new K(rt,xt));else if(le===7)Ct&&Ct.push(Ct[0].clone());else throw new Error("unknown command "+le)}return Ct&&nt.push(Ct),nt},j.prototype.bbox=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Ce=pe.readVarint()+pe.pos,le=1,Ie=0,rt=0,xt=0,nt=1/0,Ct=-1/0,jt=1/0,Vt=-1/0;pe.pos<Ce;){if(Ie<=0){var Rt=pe.readVarint();le=Rt&7,Ie=Rt>>3}if(Ie--,le===1||le===2)rt+=pe.readSVarint(),xt+=pe.readSVarint(),rt<nt&&(nt=rt),rt>Ct&&(Ct=rt),xt<jt&&(jt=xt),xt>Vt&&(Vt=xt);else if(le!==7)throw new Error("unknown command "+le)}return[nt,jt,Ct,Vt]},j.prototype.toGeoJSON=function(pe,Ce,le){var Ie=this.extent*Math.pow(2,le),rt=this.extent*pe,xt=this.extent*Ce,nt=this.loadGeometry(),Ct=j.types[this.type],jt,Vt;function Rt(gn){for(var Rr=0;Rr<gn.length;Rr++){var vn=gn[Rr],rr=180-(vn.y+xt)*360/Ie;gn[Rr]=[(vn.x+rt)*360/Ie-180,360/Math.PI*Math.atan(Math.exp(rr*Math.PI/180))-90]}}switch(this.type){case 1:var hr=[];for(jt=0;jt<nt.length;jt++)hr[jt]=nt[jt][0];nt=hr,Rt(nt);break;case 2:for(jt=0;jt<nt.length;jt++)Rt(nt[jt]);break;case 3:for(nt=ee(nt),jt=0;jt<nt.length;jt++)for(Vt=0;Vt<nt[jt].length;Vt++)Rt(nt[jt][Vt]);break}nt.length===1?nt=nt[0]:Ct="Multi"+Ct;var er={type:"Feature",geometry:{type:Ct,coordinates:nt},properties:this.properties};return"id"in this&&(er.id=this.id),er};function ee(pe){var Ce=pe.length;if(Ce<=1)return[pe];for(var le=[],Ie,rt,xt=0;xt<Ce;xt++){var nt=te(pe[xt]);nt!==0&&(rt===void 0&&(rt=nt<0),rt===nt<0?(Ie&&le.push(Ie),Ie=[pe[xt]]):Ie.push(pe[xt]))}return Ie&&le.push(Ie),le}function te(pe){for(var Ce=0,le=0,Ie=pe.length,rt=Ie-1,xt,nt;le<Ie;rt=le++)xt=pe[le],nt=pe[rt],Ce+=(nt.x-xt.x)*(xt.y+nt.y);return Ce}},59701:function(Ue,_e,G){"use strict";var K=G(66024);Ue.exports=j;function j(ee,te){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=ee,this._keys=[],this._values=[],this._features=[],ee.readFields(P,this,te),this.length=this._features.length}function P(ee,te,pe){ee===15?te.version=pe.readVarint():ee===1?te.name=pe.readString():ee===5?te.extent=pe.readVarint():ee===2?te._features.push(pe.pos):ee===3?te._keys.push(pe.readString()):ee===4&&te._values.push(M(pe))}function M(ee){for(var te=null,pe=ee.readVarint()+ee.pos;ee.pos<pe;){var Ce=ee.readVarint()>>3;te=Ce===1?ee.readString():Ce===2?ee.readFloat():Ce===3?ee.readDouble():Ce===4?ee.readVarint64():Ce===5?ee.readVarint():Ce===6?ee.readSVarint():Ce===7?ee.readBoolean():null}return te}j.prototype.feature=function(ee){if(ee<0||ee>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[ee];var te=this._pbf.readVarint()+this._pbf.pos;return new K(this._pbf,te,this.extent,this._keys,this._values)}},94184:function(Ue,_e){var G,K;(function(){"use strict";var j={}.hasOwnProperty,P="[native code]";function M(){for(var ee=[],te=0;te<arguments.length;te++){var pe=arguments[te];if(pe){var Ce=typeof pe;if(Ce==="string"||Ce==="number")ee.push(pe);else if(Array.isArray(pe)){if(pe.length){var le=M.apply(null,pe);le&&ee.push(le)}}else if(Ce==="object"){if(pe.toString!==Object.prototype.toString&&!pe.toString.toString().includes("[native code]")){ee.push(pe.toString());continue}for(var Ie in pe)j.call(pe,Ie)&&pe[Ie]&&ee.push(Ie)}}}return ee.join(" ")}Ue.exports?(M.default=M,Ue.exports=M):(G=[],K=function(){return M}.apply(_e,G),K!==void 0&&(Ue.exports=K))})()},48168:function(Ue,_e,G){const K=G(8874),j={};for(const ee of Object.keys(K))j[K[ee]]=ee;const P={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Ue.exports=P;for(const ee of Object.keys(P)){if(!("channels"in P[ee]))throw new Error("missing channels property: "+ee);if(!("labels"in P[ee]))throw new Error("missing channel labels property: "+ee);if(P[ee].labels.length!==P[ee].channels)throw new Error("channel and label counts mismatch: "+ee);const{channels:te,labels:pe}=P[ee];delete P[ee].channels,delete P[ee].labels,Object.defineProperty(P[ee],"channels",{value:te}),Object.defineProperty(P[ee],"labels",{value:pe})}P.rgb.hsl=function(ee){const te=ee[0]/255,pe=ee[1]/255,Ce=ee[2]/255,le=Math.min(te,pe,Ce),Ie=Math.max(te,pe,Ce),rt=Ie-le;let xt,nt;Ie===le?xt=0:te===Ie?xt=(pe-Ce)/rt:pe===Ie?xt=2+(Ce-te)/rt:Ce===Ie&&(xt=4+(te-pe)/rt),xt=Math.min(xt*60,360),xt<0&&(xt+=360);const Ct=(le+Ie)/2;return Ie===le?nt=0:Ct<=.5?nt=rt/(Ie+le):nt=rt/(2-Ie-le),[xt,nt*100,Ct*100]},P.rgb.hsv=function(ee){let te,pe,Ce,le,Ie;const rt=ee[0]/255,xt=ee[1]/255,nt=ee[2]/255,Ct=Math.max(rt,xt,nt),jt=Ct-Math.min(rt,xt,nt),Vt=function(Rt){return(Ct-Rt)/6/jt+1/2};return jt===0?(le=0,Ie=0):(Ie=jt/Ct,te=Vt(rt),pe=Vt(xt),Ce=Vt(nt),rt===Ct?le=Ce-pe:xt===Ct?le=1/3+te-Ce:nt===Ct&&(le=2/3+pe-te),le<0?le+=1:le>1&&(le-=1)),[le*360,Ie*100,Ct*100]},P.rgb.hwb=function(ee){const te=ee[0],pe=ee[1];let Ce=ee[2];const le=P.rgb.hsl(ee)[0],Ie=1/255*Math.min(te,Math.min(pe,Ce));return Ce=1-1/255*Math.max(te,Math.max(pe,Ce)),[le,Ie*100,Ce*100]},P.rgb.cmyk=function(ee){const te=ee[0]/255,pe=ee[1]/255,Ce=ee[2]/255,le=Math.min(1-te,1-pe,1-Ce),Ie=(1-te-le)/(1-le)||0,rt=(1-pe-le)/(1-le)||0,xt=(1-Ce-le)/(1-le)||0;return[Ie*100,rt*100,xt*100,le*100]};function M(ee,te){return Tp(ee[0]-te[0],2)+Tp(ee[1]-te[1],2)+Tp(ee[2]-te[2],2)}P.rgb.keyword=function(ee){const te=j[ee];if(te)return te;let pe=1/0,Ce;for(const le of Object.keys(K)){const Ie=K[le],rt=M(ee,Ie);rt<pe&&(pe=rt,Ce=le)}return Ce},P.keyword.rgb=function(ee){return K[ee]},P.rgb.xyz=function(ee){let te=ee[0]/255,pe=ee[1]/255,Ce=ee[2]/255;te=te>.04045?Tp((te+.055)/1.055,2.4):te/12.92,pe=pe>.04045?Tp((pe+.055)/1.055,2.4):pe/12.92,Ce=Ce>.04045?Tp((Ce+.055)/1.055,2.4):Ce/12.92;const le=te*.4124+pe*.3576+Ce*.1805,Ie=te*.2126+pe*.7152+Ce*.0722,rt=te*.0193+pe*.1192+Ce*.9505;return[le*100,Ie*100,rt*100]},P.rgb.lab=function(ee){const te=P.rgb.xyz(ee);let pe=te[0],Ce=te[1],le=te[2];pe/=95.047,Ce/=100,le/=108.883,pe=pe>.008856?Tp(pe,1/3):7.787*pe+16/116,Ce=Ce>.008856?Tp(Ce,1/3):7.787*Ce+16/116,le=le>.008856?Tp(le,1/3):7.787*le+16/116;const Ie=116*Ce-16,rt=500*(pe-Ce),xt=200*(Ce-le);return[Ie,rt,xt]},P.hsl.rgb=function(ee){const te=ee[0]/360,pe=ee[1]/100,Ce=ee[2]/100;let le,Ie,rt;if(pe===0)return rt=Ce*255,[rt,rt,rt];Ce<.5?le=Ce*(1+pe):le=Ce+pe-Ce*pe;const xt=2*Ce-le,nt=[0,0,0];for(let Ct=0;Ct<3;Ct++)Ie=te+1/3*-(Ct-1),Ie<0&&Ie++,Ie>1&&Ie--,6*Ie<1?rt=xt+(le-xt)*6*Ie:2*Ie<1?rt=le:3*Ie<2?rt=xt+(le-xt)*(2/3-Ie)*6:rt=xt,nt[Ct]=rt*255;return nt},P.hsl.hsv=function(ee){const te=ee[0];let pe=ee[1]/100,Ce=ee[2]/100,le=pe;const Ie=Math.max(Ce,.01);Ce*=2,pe*=Ce<=1?Ce:2-Ce,le*=Ie<=1?Ie:2-Ie;const rt=(Ce+pe)/2,xt=Ce===0?2*le/(Ie+le):2*pe/(Ce+pe);return[te,xt*100,rt*100]},P.hsv.rgb=function(ee){const te=ee[0]/60,pe=ee[1]/100;let Ce=ee[2]/100;const le=Math.floor(te)%6,Ie=te-Math.floor(te),rt=255*Ce*(1-pe),xt=255*Ce*(1-pe*Ie),nt=255*Ce*(1-pe*(1-Ie));switch(Ce*=255,le){case 0:return[Ce,nt,rt];case 1:return[xt,Ce,rt];case 2:return[rt,Ce,nt];case 3:return[rt,xt,Ce];case 4:return[nt,rt,Ce];case 5:return[Ce,rt,xt]}},P.hsv.hsl=function(ee){const te=ee[0],pe=ee[1]/100,Ce=ee[2]/100,le=Math.max(Ce,.01);let Ie,rt;rt=(2-pe)*Ce;const xt=(2-pe)*le;return Ie=pe*le,Ie/=xt<=1?xt:2-xt,Ie=Ie||0,rt/=2,[te,Ie*100,rt*100]},P.hwb.rgb=function(ee){const te=ee[0]/360;let pe=ee[1]/100,Ce=ee[2]/100;const le=pe+Ce;let Ie;le>1&&(pe/=le,Ce/=le);const rt=Math.floor(6*te),xt=1-Ce;Ie=6*te-rt,rt&1&&(Ie=1-Ie);const nt=pe+Ie*(xt-pe);let Ct,jt,Vt;switch(rt){default:case 6:case 0:Ct=xt,jt=nt,Vt=pe;break;case 1:Ct=nt,jt=xt,Vt=pe;break;case 2:Ct=pe,jt=xt,Vt=nt;break;case 3:Ct=pe,jt=nt,Vt=xt;break;case 4:Ct=nt,jt=pe,Vt=xt;break;case 5:Ct=xt,jt=pe,Vt=nt;break}return[Ct*255,jt*255,Vt*255]},P.cmyk.rgb=function(ee){const te=ee[0]/100,pe=ee[1]/100,Ce=ee[2]/100,le=ee[3]/100,Ie=1-Math.min(1,te*(1-le)+le),rt=1-Math.min(1,pe*(1-le)+le),xt=1-Math.min(1,Ce*(1-le)+le);return[Ie*255,rt*255,xt*255]},P.xyz.rgb=function(ee){const te=ee[0]/100,pe=ee[1]/100,Ce=ee[2]/100;let le,Ie,rt;return le=te*3.2406+pe*-1.5372+Ce*-.4986,Ie=te*-.9689+pe*1.8758+Ce*.0415,rt=te*.0557+pe*-.204+Ce*1.057,le=le>.0031308?1.055*Tp(le,1/2.4)-.055:le*12.92,Ie=Ie>.0031308?1.055*Tp(Ie,1/2.4)-.055:Ie*12.92,rt=rt>.0031308?1.055*Tp(rt,1/2.4)-.055:rt*12.92,le=Math.min(Math.max(0,le),1),Ie=Math.min(Math.max(0,Ie),1),rt=Math.min(Math.max(0,rt),1),[le*255,Ie*255,rt*255]},P.xyz.lab=function(ee){let te=ee[0],pe=ee[1],Ce=ee[2];te/=95.047,pe/=100,Ce/=108.883,te=te>.008856?Tp(te,1/3):7.787*te+16/116,pe=pe>.008856?Tp(pe,1/3):7.787*pe+16/116,Ce=Ce>.008856?Tp(Ce,1/3):7.787*Ce+16/116;const le=116*pe-16,Ie=500*(te-pe),rt=200*(pe-Ce);return[le,Ie,rt]},P.lab.xyz=function(ee){const te=ee[0],pe=ee[1],Ce=ee[2];let le,Ie,rt;Ie=(te+16)/116,le=pe/500+Ie,rt=Ie-Ce/200;const xt=Tp(Ie,3),nt=Tp(le,3),Ct=Tp(rt,3);return Ie=xt>.008856?xt:(Ie-16/116)/7.787,le=nt>.008856?nt:(le-16/116)/7.787,rt=Ct>.008856?Ct:(rt-16/116)/7.787,le*=95.047,Ie*=100,rt*=108.883,[le,Ie,rt]},P.lab.lch=function(ee){const te=ee[0],pe=ee[1],Ce=ee[2];let le;le=Math.atan2(Ce,pe)*360/2/Math.PI,le<0&&(le+=360);const rt=Math.sqrt(pe*pe+Ce*Ce);return[te,rt,le]},P.lch.lab=function(ee){const te=ee[0],pe=ee[1],le=ee[2]/360*2*Math.PI,Ie=pe*Math.cos(le),rt=pe*Math.sin(le);return[te,Ie,rt]},P.rgb.ansi16=function(ee,te=null){const[pe,Ce,le]=ee;let Ie=te===null?P.rgb.hsv(ee)[2]:te;if(Ie=Math.round(Ie/50),Ie===0)return 30;let rt=30+(Math.round(le/255)<<2|Math.round(Ce/255)<<1|Math.round(pe/255));return Ie===2&&(rt+=60),rt},P.hsv.ansi16=function(ee){return P.rgb.ansi16(P.hsv.rgb(ee),ee[2])},P.rgb.ansi256=function(ee){const te=ee[0],pe=ee[1],Ce=ee[2];return te===pe&&pe===Ce?te<8?16:te>248?231:Math.round((te-8)/247*24)+232:16+36*Math.round(te/255*5)+6*Math.round(pe/255*5)+Math.round(Ce/255*5)},P.ansi16.rgb=function(ee){let te=ee%10;if(te===0||te===7)return ee>50&&(te+=3.5),te=te/10.5*255,[te,te,te];const pe=(~~(ee>50)+1)*.5,Ce=(te&1)*pe*255,le=(te>>1&1)*pe*255,Ie=(te>>2&1)*pe*255;return[Ce,le,Ie]},P.ansi256.rgb=function(ee){if(ee>=232){const Ie=(ee-232)*10+8;return[Ie,Ie,Ie]}ee-=16;let te;const pe=Math.floor(ee/36)/5*255,Ce=Math.floor((te=ee%36)/6)/5*255,le=te%6/5*255;return[pe,Ce,le]},P.rgb.hex=function(ee){const pe=(((Math.round(ee[0])&255)<<16)+((Math.round(ee[1])&255)<<8)+(Math.round(ee[2])&255)).toString(16).toUpperCase();return"000000".substring(pe.length)+pe},P.hex.rgb=function(ee){const te=ee.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!te)return[0,0,0];let pe=te[0];te[0].length===3&&(pe=pe.split("").map(xt=>xt+xt).join(""));const Ce=parseInt(pe,16),le=Ce>>16&255,Ie=Ce>>8&255,rt=Ce&255;return[le,Ie,rt]},P.rgb.hcg=function(ee){const te=ee[0]/255,pe=ee[1]/255,Ce=ee[2]/255,le=Math.max(Math.max(te,pe),Ce),Ie=Math.min(Math.min(te,pe),Ce),rt=le-Ie;let xt,nt;return rt<1?xt=Ie/(1-rt):xt=0,rt<=0?nt=0:le===te?nt=(pe-Ce)/rt%6:le===pe?nt=2+(Ce-te)/rt:nt=4+(te-pe)/rt,nt/=6,nt%=1,[nt*360,rt*100,xt*100]},P.hsl.hcg=function(ee){const te=ee[1]/100,pe=ee[2]/100,Ce=pe<.5?2*te*pe:2*te*(1-pe);let le=0;return Ce<1&&(le=(pe-.5*Ce)/(1-Ce)),[ee[0],Ce*100,le*100]},P.hsv.hcg=function(ee){const te=ee[1]/100,pe=ee[2]/100,Ce=te*pe;let le=0;return Ce<1&&(le=(pe-Ce)/(1-Ce)),[ee[0],Ce*100,le*100]},P.hcg.rgb=function(ee){const te=ee[0]/360,pe=ee[1]/100,Ce=ee[2]/100;if(pe===0)return[Ce*255,Ce*255,Ce*255];const le=[0,0,0],Ie=te%1*6,rt=Ie%1,xt=1-rt;let nt=0;switch(Math.floor(Ie)){case 0:le[0]=1,le[1]=rt,le[2]=0;break;case 1:le[0]=xt,le[1]=1,le[2]=0;break;case 2:le[0]=0,le[1]=1,le[2]=rt;break;case 3:le[0]=0,le[1]=xt,le[2]=1;break;case 4:le[0]=rt,le[1]=0,le[2]=1;break;default:le[0]=1,le[1]=0,le[2]=xt}return nt=(1-pe)*Ce,[(pe*le[0]+nt)*255,(pe*le[1]+nt)*255,(pe*le[2]+nt)*255]},P.hcg.hsv=function(ee){const te=ee[1]/100,pe=ee[2]/100,Ce=te+pe*(1-te);let le=0;return Ce>0&&(le=te/Ce),[ee[0],le*100,Ce*100]},P.hcg.hsl=function(ee){const te=ee[1]/100,Ce=ee[2]/100*(1-te)+.5*te;let le=0;return Ce>0&&Ce<.5?le=te/(2*Ce):Ce>=.5&&Ce<1&&(le=te/(2*(1-Ce))),[ee[0],le*100,Ce*100]},P.hcg.hwb=function(ee){const te=ee[1]/100,pe=ee[2]/100,Ce=te+pe*(1-te);return[ee[0],(Ce-te)*100,(1-Ce)*100]},P.hwb.hcg=function(ee){const te=ee[1]/100,Ce=1-ee[2]/100,le=Ce-te;let Ie=0;return le<1&&(Ie=(Ce-le)/(1-le)),[ee[0],le*100,Ie*100]},P.apple.rgb=function(ee){return[ee[0]/65535*255,ee[1]/65535*255,ee[2]/65535*255]},P.rgb.apple=function(ee){return[ee[0]/255*65535,ee[1]/255*65535,ee[2]/255*65535]},P.gray.rgb=function(ee){return[ee[0]/100*255,ee[0]/100*255,ee[0]/100*255]},P.gray.hsl=function(ee){return[0,0,ee[0]]},P.gray.hsv=P.gray.hsl,P.gray.hwb=function(ee){return[0,100,ee[0]]},P.gray.cmyk=function(ee){return[0,0,0,ee[0]]},P.gray.lab=function(ee){return[ee[0],0,0]},P.gray.hex=function(ee){const te=Math.round(ee[0]/100*255)&255,Ce=((te<<16)+(te<<8)+te).toString(16).toUpperCase();return"000000".substring(Ce.length)+Ce},P.rgb.gray=function(ee){return[(ee[0]+ee[1]+ee[2])/3/255*100]}},12085:function(Ue,_e,G){const K=G(48168),j=G(4111),P={},M=Object.keys(K);function ee(pe){const Ce=function(...le){const Ie=le[0];return Ie==null?Ie:(Ie.length>1&&(le=Ie),pe(le))};return"conversion"in pe&&(Ce.conversion=pe.conversion),Ce}function te(pe){const Ce=function(...le){const Ie=le[0];if(Ie==null)return Ie;Ie.length>1&&(le=Ie);const rt=pe(le);if(typeof rt=="object")for(let xt=rt.length,nt=0;nt<xt;nt++)rt[nt]=Math.round(rt[nt]);return rt};return"conversion"in pe&&(Ce.conversion=pe.conversion),Ce}M.forEach(pe=>{P[pe]={},Object.defineProperty(P[pe],"channels",{value:K[pe].channels}),Object.defineProperty(P[pe],"labels",{value:K[pe].labels});const Ce=j(pe);Object.keys(Ce).forEach(Ie=>{const rt=Ce[Ie];P[pe][Ie]=te(rt),P[pe][Ie].raw=ee(rt)})}),Ue.exports=P},4111:function(Ue,_e,G){const K=G(48168);function j(){const te={},pe=Object.keys(K);for(let Ce=pe.length,le=0;le<Ce;le++)te[pe[le]]={distance:-1,parent:null};return te}function P(te){const pe=j(),Ce=[te];for(pe[te].distance=0;Ce.length;){const le=Ce.pop(),Ie=Object.keys(K[le]);for(let rt=Ie.length,xt=0;xt<rt;xt++){const nt=Ie[xt],Ct=pe[nt];Ct.distance===-1&&(Ct.distance=pe[le].distance+1,Ct.parent=le,Ce.unshift(nt))}}return pe}function M(te,pe){return function(Ce){return pe(te(Ce))}}function ee(te,pe){const Ce=[pe[te].parent,te];let le=K[pe[te].parent][te],Ie=pe[te].parent;for(;pe[Ie].parent;)Ce.unshift(pe[Ie].parent),le=M(K[pe[Ie].parent][Ie],le),Ie=pe[Ie].parent;return le.conversion=Ce,le}Ue.exports=function(te){const pe=P(te),Ce={},le=Object.keys(pe);for(let Ie=le.length,rt=0;rt<Ie;rt++){const xt=le[rt];pe[xt].parent!==null&&(Ce[xt]=ee(xt,pe))}return Ce}},8874:function(Ue){"use strict";Ue.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},19818:function(Ue,_e,G){var K=G(8874),j=G(86851),P=Object.hasOwnProperty,M=Object.create(null);for(var ee in K)P.call(K,ee)&&(M[K[ee]]=ee);var te=Ue.exports={to:{},get:{}};te.get=function(le){var Ie=le.substring(0,3).toLowerCase(),rt,xt;switch(Ie){case"hsl":rt=te.get.hsl(le),xt="hsl";break;case"hwb":rt=te.get.hwb(le),xt="hwb";break;default:rt=te.get.rgb(le),xt="rgb";break}return rt?{model:xt,value:rt}:null},te.get.rgb=function(le){if(!le)return null;var Ie=/^#([a-f0-9]{3,4})$/i,rt=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,xt=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,nt=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,Ct=/^(\w+)$/,jt=[0,0,0,1],Vt,Rt,hr;if(Vt=le.match(rt)){for(hr=Vt[2],Vt=Vt[1],Rt=0;Rt<3;Rt++){var er=Rt*2;jt[Rt]=parseInt(Vt.slice(er,er+2),16)}hr&&(jt[3]=parseInt(hr,16)/255)}else if(Vt=le.match(Ie)){for(Vt=Vt[1],hr=Vt[3],Rt=0;Rt<3;Rt++)jt[Rt]=parseInt(Vt[Rt]+Vt[Rt],16);hr&&(jt[3]=parseInt(hr+hr,16)/255)}else if(Vt=le.match(xt)){for(Rt=0;Rt<3;Rt++)jt[Rt]=parseInt(Vt[Rt+1],0);Vt[4]&&(Vt[5]?jt[3]=parseFloat(Vt[4])*.01:jt[3]=parseFloat(Vt[4]))}else if(Vt=le.match(nt)){for(Rt=0;Rt<3;Rt++)jt[Rt]=Math.round(parseFloat(Vt[Rt+1])*2.55);Vt[4]&&(Vt[5]?jt[3]=parseFloat(Vt[4])*.01:jt[3]=parseFloat(Vt[4]))}else return(Vt=le.match(Ct))?Vt[1]==="transparent"?[0,0,0,0]:P.call(K,Vt[1])?(jt=K[Vt[1]],jt[3]=1,jt):null:null;for(Rt=0;Rt<3;Rt++)jt[Rt]=pe(jt[Rt],0,255);return jt[3]=pe(jt[3],0,1),jt},te.get.hsl=function(le){if(!le)return null;var Ie=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,rt=le.match(Ie);if(rt){var xt=parseFloat(rt[4]),nt=(parseFloat(rt[1])%360+360)%360,Ct=pe(parseFloat(rt[2]),0,100),jt=pe(parseFloat(rt[3]),0,100),Vt=pe(isNaN(xt)?1:xt,0,1);return[nt,Ct,jt,Vt]}return null},te.get.hwb=function(le){if(!le)return null;var Ie=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,rt=le.match(Ie);if(rt){var xt=parseFloat(rt[4]),nt=(parseFloat(rt[1])%360+360)%360,Ct=pe(parseFloat(rt[2]),0,100),jt=pe(parseFloat(rt[3]),0,100),Vt=pe(isNaN(xt)?1:xt,0,1);return[nt,Ct,jt,Vt]}return null},te.to.hex=function(){var le=j(arguments);return"#"+Ce(le[0])+Ce(le[1])+Ce(le[2])+(le[3]<1?Ce(Math.round(le[3]*255)):"")},te.to.rgb=function(){var le=j(arguments);return le.length<4||le[3]===1?"rgb("+Math.round(le[0])+", "+Math.round(le[1])+", "+Math.round(le[2])+")":"rgba("+Math.round(le[0])+", "+Math.round(le[1])+", "+Math.round(le[2])+", "+le[3]+")"},te.to.rgb.percent=function(){var le=j(arguments),Ie=Math.round(le[0]/255*100),rt=Math.round(le[1]/255*100),xt=Math.round(le[2]/255*100);return le.length<4||le[3]===1?"rgb("+Ie+"%, "+rt+"%, "+xt+"%)":"rgba("+Ie+"%, "+rt+"%, "+xt+"%, "+le[3]+")"},te.to.hsl=function(){var le=j(arguments);return le.length<4||le[3]===1?"hsl("+le[0]+", "+le[1]+"%, "+le[2]+"%)":"hsla("+le[0]+", "+le[1]+"%, "+le[2]+"%, "+le[3]+")"},te.to.hwb=function(){var le=j(arguments),Ie="";return le.length>=4&&le[3]!==1&&(Ie=", "+le[3]),"hwb("+le[0]+", "+le[1]+"%, "+le[2]+"%"+Ie+")"},te.to.keyword=function(le){return M[le.slice(0,3)]};function pe(le,Ie,rt){return Math.min(Math.max(Ie,le),rt)}function Ce(le){var Ie=Math.round(le).toString(16).toUpperCase();return Ie.length<2?"0"+Ie:Ie}},6767:function(Ue,_e,G){const K=G(19818),j=G(12085),P=["keyword","gray","hex"],M={};for(const nt of Object.keys(j))M[[...j[nt].labels].sort().join("")]=nt;const ee={};function te(nt,Ct){if(!(this instanceof te))return new te(nt,Ct);if(Ct&&Ct in P&&(Ct=null),Ct&&!(Ct in j))throw new Error("Unknown model: "+Ct);let jt,Vt;if(nt==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(nt instanceof te)this.model=nt.model,this.color=[...nt.color],this.valpha=nt.valpha;else if(typeof nt=="string"){const Rt=K.get(nt);if(Rt===null)throw new Error("Unable to parse color from string: "+nt);this.model=Rt.model,Vt=j[this.model].channels,this.color=Rt.value.slice(0,Vt),this.valpha=typeof Rt.value[Vt]=="number"?Rt.value[Vt]:1}else if(nt.length>0){this.model=Ct||"rgb",Vt=j[this.model].channels;const Rt=Array.prototype.slice.call(nt,0,Vt);this.color=xt(Rt,Vt),this.valpha=typeof nt[Vt]=="number"?nt[Vt]:1}else if(typeof nt=="number")this.model="rgb",this.color=[nt>>16&255,nt>>8&255,nt&255],this.valpha=1;else{this.valpha=1;const Rt=Object.keys(nt);"alpha"in nt&&(Rt.splice(Rt.indexOf("alpha"),1),this.valpha=typeof nt.alpha=="number"?nt.alpha:0);const hr=Rt.sort().join("");if(!(hr in M))throw new Error("Unable to parse color from object: "+JSON.stringify(nt));this.model=M[hr];const{labels:er}=j[this.model],gn=[];for(jt=0;jt<er.length;jt++)gn.push(nt[er[jt]]);this.color=xt(gn)}if(ee[this.model])for(Vt=j[this.model].channels,jt=0;jt<Vt;jt++){const Rt=ee[this.model][jt];Rt&&(this.color[jt]=Rt(this.color[jt]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}te.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(nt){let Ct=this.model in K.to?this:this.rgb();Ct=Ct.round(typeof nt=="number"?nt:1);const jt=Ct.valpha===1?Ct.color:[...Ct.color,this.valpha];return K.to[Ct.model](jt)},percentString(nt){const Ct=this.rgb().round(typeof nt=="number"?nt:1),jt=Ct.valpha===1?Ct.color:[...Ct.color,this.valpha];return K.to.rgb.percent(jt)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const nt={},{channels:Ct}=j[this.model],{labels:jt}=j[this.model];for(let Vt=0;Vt<Ct;Vt++)nt[jt[Vt]]=this.color[Vt];return this.valpha!==1&&(nt.alpha=this.valpha),nt},unitArray(){const nt=this.rgb().color;return nt[0]/=255,nt[1]/=255,nt[2]/=255,this.valpha!==1&&nt.push(this.valpha),nt},unitObject(){const nt=this.rgb().object();return nt.r/=255,nt.g/=255,nt.b/=255,this.valpha!==1&&(nt.alpha=this.valpha),nt},round(nt){return nt=Math.max(nt||0,0),new te([...this.color.map(Ce(nt)),this.valpha],this.model)},alpha(nt){return nt!==void 0?new te([...this.color,Math.max(0,Math.min(1,nt))],this.model):this.valpha},red:le("rgb",0,Ie(255)),green:le("rgb",1,Ie(255)),blue:le("rgb",2,Ie(255)),hue:le(["hsl","hsv","hsl","hwb","hcg"],0,nt=>(nt%360+360)%360),saturationl:le("hsl",1,Ie(100)),lightness:le("hsl",2,Ie(100)),saturationv:le("hsv",1,Ie(100)),value:le("hsv",2,Ie(100)),chroma:le("hcg",1,Ie(100)),gray:le("hcg",2,Ie(100)),white:le("hwb",1,Ie(100)),wblack:le("hwb",2,Ie(100)),cyan:le("cmyk",0,Ie(100)),magenta:le("cmyk",1,Ie(100)),yellow:le("cmyk",2,Ie(100)),black:le("cmyk",3,Ie(100)),x:le("xyz",0,Ie(95.047)),y:le("xyz",1,Ie(100)),z:le("xyz",2,Ie(108.833)),l:le("lab",0,Ie(100)),a:le("lab",1),b:le("lab",2),keyword(nt){return nt!==void 0?new te(nt):j[this.model].keyword(this.color)},hex(nt){return nt!==void 0?new te(nt):K.to.hex(this.rgb().round().color)},hexa(nt){if(nt!==void 0)return new te(nt);const Ct=this.rgb().round().color;let jt=Math.round(this.valpha*255).toString(16).toUpperCase();return jt.length===1&&(jt="0"+jt),K.to.hex(Ct)+jt},rgbNumber(){const nt=this.rgb().color;return(nt[0]&255)<<16|(nt[1]&255)<<8|nt[2]&255},luminosity(){const nt=this.rgb().color,Ct=[];for(const[jt,Vt]of nt.entries()){const Rt=Vt/255;Ct[jt]=Rt<=.04045?Rt/12.92:Tp((Rt+.055)/1.055,2.4)}return .2126*Ct[0]+.7152*Ct[1]+.0722*Ct[2]},contrast(nt){const Ct=this.luminosity(),jt=nt.luminosity();return Ct>jt?(Ct+.05)/(jt+.05):(jt+.05)/(Ct+.05)},level(nt){const Ct=this.contrast(nt);return Ct>=7?"AAA":Ct>=4.5?"AA":""},isDark(){const nt=this.rgb().color;return(nt[0]*2126+nt[1]*7152+nt[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const nt=this.rgb();for(let Ct=0;Ct<3;Ct++)nt.color[Ct]=255-nt.color[Ct];return nt},lighten(nt){const Ct=this.hsl();return Ct.color[2]+=Ct.color[2]*nt,Ct},darken(nt){const Ct=this.hsl();return Ct.color[2]-=Ct.color[2]*nt,Ct},saturate(nt){const Ct=this.hsl();return Ct.color[1]+=Ct.color[1]*nt,Ct},desaturate(nt){const Ct=this.hsl();return Ct.color[1]-=Ct.color[1]*nt,Ct},whiten(nt){const Ct=this.hwb();return Ct.color[1]+=Ct.color[1]*nt,Ct},blacken(nt){const Ct=this.hwb();return Ct.color[2]+=Ct.color[2]*nt,Ct},grayscale(){const nt=this.rgb().color,Ct=nt[0]*.3+nt[1]*.59+nt[2]*.11;return te.rgb(Ct,Ct,Ct)},fade(nt){return this.alpha(this.valpha-this.valpha*nt)},opaquer(nt){return this.alpha(this.valpha+this.valpha*nt)},rotate(nt){const Ct=this.hsl();let jt=Ct.color[0];return jt=(jt+nt)%360,jt=jt<0?360+jt:jt,Ct.color[0]=jt,Ct},mix(nt,Ct){if(!nt||!nt.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof nt);const jt=nt.rgb(),Vt=this.rgb(),Rt=Ct===void 0?.5:Ct,hr=2*Rt-1,er=jt.alpha()-Vt.alpha(),gn=((hr*er===-1?hr:(hr+er)/(1+hr*er))+1)/2,Rr=1-gn;return te.rgb(gn*jt.red()+Rr*Vt.red(),gn*jt.green()+Rr*Vt.green(),gn*jt.blue()+Rr*Vt.blue(),jt.alpha()*Rt+Vt.alpha()*(1-Rt))}};for(const nt of Object.keys(j)){if(P.includes(nt))continue;const{channels:Ct}=j[nt];te.prototype[nt]=function(...jt){return this.model===nt?new te(this):jt.length>0?new te(jt,nt):new te([...rt(j[this.model][nt].raw(this.color)),this.valpha],nt)},te[nt]=function(...jt){let Vt=jt[0];return typeof Vt=="number"&&(Vt=xt(jt,Ct)),new te(Vt,nt)}}function pe(nt,Ct){return Number(nt.toFixed(Ct))}function Ce(nt){return function(Ct){return pe(Ct,nt)}}function le(nt,Ct,jt){nt=Array.isArray(nt)?nt:[nt];for(const Vt of nt)(ee[Vt]||(ee[Vt]=[]))[Ct]=jt;return nt=nt[0],function(Vt){let Rt;return Vt!==void 0?(jt&&(Vt=jt(Vt)),Rt=this[nt](),Rt.color[Ct]=Vt,Rt):(Rt=this[nt]().color[Ct],jt&&(Rt=jt(Rt)),Rt)}}function Ie(nt){return function(Ct){return Math.max(0,Math.min(nt,Ct))}}function rt(nt){return Array.isArray(nt)?nt:[nt]}function xt(nt,Ct){for(let jt=0;jt<Ct;jt++)typeof nt[jt]!="number"&&(nt[jt]=0);return nt}Ue.exports=te},9187:function(Ue){"use strict";Ue.exports=_e,Ue.exports.default=_e;function _e(Ee,Bt,Ot){Ot=Ot||2;var Pr=Bt&&Bt.length,Fr=Pr?Bt[0]*Ot:Ee.length,Nr=G(Ee,0,Fr,Ot,!0),hn=[];if(!Nr||Nr.next===Nr.prev)return hn;var xn,Ji,pi,Ka,na,ca,po;if(Pr&&(Nr=pe(Ee,Bt,Nr,Ot)),Ee.length>80*Ot){xn=pi=Ee[0],Ji=Ka=Ee[1];for(var La=Ot;La<Fr;La+=Ot)na=Ee[La],ca=Ee[La+1],na<xn&&(xn=na),ca<Ji&&(Ji=ca),na>pi&&(pi=na),ca>Ka&&(Ka=ca);po=Math.max(pi-xn,Ka-Ji),po=po!==0?32767/po:0}return j(Nr,hn,Ot,xn,Ji,po,0),hn}function G(Ee,Bt,Ot,Pr,Fr){var Nr,hn;if(Fr===Dt(Ee,Bt,Ot,Pr)>0)for(Nr=Bt;Nr<Ot;Nr+=Pr)hn=Br(Nr,Ee[Nr],Ee[Nr+1],hn);else for(Nr=Ot-Pr;Nr>=Bt;Nr-=Pr)hn=Br(Nr,Ee[Nr],Ee[Nr+1],hn);return hn&&er(hn,hn.next)&&(an(hn),hn=hn.next),hn}function K(Ee,Bt){if(!Ee)return Ee;Bt||(Bt=Ee);var Ot=Ee,Pr;do if(Pr=!1,!Ot.steiner&&(er(Ot,Ot.next)||hr(Ot.prev,Ot,Ot.next)===0)){if(an(Ot),Ot=Bt=Ot.prev,Ot===Ot.next)break;Pr=!0}else Ot=Ot.next;while(Pr||Ot!==Bt);return Bt}function j(Ee,Bt,Ot,Pr,Fr,Nr,hn){if(Ee){!hn&&Nr&&xt(Ee,Pr,Fr,Nr);for(var xn=Ee,Ji,pi;Ee.prev!==Ee.next;){if(Ji=Ee.prev,pi=Ee.next,Nr?M(Ee,Pr,Fr,Nr):P(Ee)){Bt.push(Ji.i/Ot|0),Bt.push(Ee.i/Ot|0),Bt.push(pi.i/Ot|0),an(Ee),Ee=pi.next,xn=pi.next;continue}if(Ee=pi,Ee===xn){hn?hn===1?(Ee=ee(K(Ee),Bt,Ot),j(Ee,Bt,Ot,Pr,Fr,Nr,2)):hn===2&&te(Ee,Bt,Ot,Pr,Fr,Nr):j(K(Ee),Bt,Ot,Pr,Fr,Nr,1);break}}}}function P(Ee){var Bt=Ee.prev,Ot=Ee,Pr=Ee.next;if(hr(Bt,Ot,Pr)>=0)return!1;for(var Fr=Bt.x,Nr=Ot.x,hn=Pr.x,xn=Bt.y,Ji=Ot.y,pi=Pr.y,Ka=Fr<Nr?Fr<hn?Fr:hn:Nr<hn?Nr:hn,na=xn<Ji?xn<pi?xn:pi:Ji<pi?Ji:pi,ca=Fr>Nr?Fr>hn?Fr:hn:Nr>hn?Nr:hn,po=xn>Ji?xn>pi?xn:pi:Ji>pi?Ji:pi,La=Pr.next;La!==Bt;){if(La.x>=Ka&&La.x<=ca&&La.y>=na&&La.y<=po&&Vt(Fr,xn,Nr,Ji,hn,pi,La.x,La.y)&&hr(La.prev,La,La.next)>=0)return!1;La=La.next}return!0}function M(Ee,Bt,Ot,Pr){var Fr=Ee.prev,Nr=Ee,hn=Ee.next;if(hr(Fr,Nr,hn)>=0)return!1;for(var xn=Fr.x,Ji=Nr.x,pi=hn.x,Ka=Fr.y,na=Nr.y,ca=hn.y,po=xn<Ji?xn<pi?xn:pi:Ji<pi?Ji:pi,La=Ka<na?Ka<ca?Ka:ca:na<ca?na:ca,$i=xn>Ji?xn>pi?xn:pi:Ji>pi?Ji:pi,qo=Ka>na?Ka>ca?Ka:ca:na>ca?na:ca,is=Ct(po,La,Bt,Ot,Pr),Ko=Ct($i,qo,Bt,Ot,Pr),Za=Ee.prevZ,ha=Ee.nextZ;Za&&Za.z>=is&&ha&&ha.z<=Ko;){if(Za.x>=po&&Za.x<=$i&&Za.y>=La&&Za.y<=qo&&Za!==Fr&&Za!==hn&&Vt(xn,Ka,Ji,na,pi,ca,Za.x,Za.y)&&hr(Za.prev,Za,Za.next)>=0||(Za=Za.prevZ,ha.x>=po&&ha.x<=$i&&ha.y>=La&&ha.y<=qo&&ha!==Fr&&ha!==hn&&Vt(xn,Ka,Ji,na,pi,ca,ha.x,ha.y)&&hr(ha.prev,ha,ha.next)>=0))return!1;ha=ha.nextZ}for(;Za&&Za.z>=is;){if(Za.x>=po&&Za.x<=$i&&Za.y>=La&&Za.y<=qo&&Za!==Fr&&Za!==hn&&Vt(xn,Ka,Ji,na,pi,ca,Za.x,Za.y)&&hr(Za.prev,Za,Za.next)>=0)return!1;Za=Za.prevZ}for(;ha&&ha.z<=Ko;){if(ha.x>=po&&ha.x<=$i&&ha.y>=La&&ha.y<=qo&&ha!==Fr&&ha!==hn&&Vt(xn,Ka,Ji,na,pi,ca,ha.x,ha.y)&&hr(ha.prev,ha,ha.next)>=0)return!1;ha=ha.nextZ}return!0}function ee(Ee,Bt,Ot){var Pr=Ee;do{var Fr=Pr.prev,Nr=Pr.next.next;!er(Fr,Nr)&&gn(Fr,Pr,Pr.next,Nr)&&Jt(Fr,Nr)&&Jt(Nr,Fr)&&(Bt.push(Fr.i/Ot|0),Bt.push(Pr.i/Ot|0),Bt.push(Nr.i/Ot|0),an(Pr),an(Pr.next),Pr=Ee=Nr),Pr=Pr.next}while(Pr!==Ee);return K(Pr)}function te(Ee,Bt,Ot,Pr,Fr,Nr){var hn=Ee;do{for(var xn=hn.next.next;xn!==hn.prev;){if(hn.i!==xn.i&&Rt(hn,xn)){var Ji=or(hn,xn);hn=K(hn,hn.next),Ji=K(Ji,Ji.next),j(hn,Bt,Ot,Pr,Fr,Nr,0),j(Ji,Bt,Ot,Pr,Fr,Nr,0);return}xn=xn.next}hn=hn.next}while(hn!==Ee)}function pe(Ee,Bt,Ot,Pr){var Fr=[],Nr,hn,xn,Ji,pi;for(Nr=0,hn=Bt.length;Nr<hn;Nr++)xn=Bt[Nr]*Pr,Ji=Nr<hn-1?Bt[Nr+1]*Pr:Ee.length,pi=G(Ee,xn,Ji,Pr,!1),pi===pi.next&&(pi.steiner=!0),Fr.push(jt(pi));for(Fr.sort(Ce),Nr=0;Nr<Fr.length;Nr++)Ot=le(Fr[Nr],Ot);return Ot}function Ce(Ee,Bt){return Ee.x-Bt.x}function le(Ee,Bt){var Ot=Ie(Ee,Bt);if(!Ot)return Bt;var Pr=or(Ot,Ee);return K(Pr,Pr.next),K(Ot,Ot.next)}function Ie(Ee,Bt){var Ot=Bt,Pr=Ee.x,Fr=Ee.y,Nr=-1/0,hn;do{if(Fr<=Ot.y&&Fr>=Ot.next.y&&Ot.next.y!==Ot.y){var xn=Ot.x+(Fr-Ot.y)*(Ot.next.x-Ot.x)/(Ot.next.y-Ot.y);if(xn<=Pr&&xn>Nr&&(Nr=xn,hn=Ot.x<Ot.next.x?Ot:Ot.next,xn===Pr))return hn}Ot=Ot.next}while(Ot!==Bt);if(!hn)return null;var Ji=hn,pi=hn.x,Ka=hn.y,na=1/0,ca;Ot=hn;do Pr>=Ot.x&&Ot.x>=pi&&Pr!==Ot.x&&Vt(Fr<Ka?Pr:Nr,Fr,pi,Ka,Fr<Ka?Nr:Pr,Fr,Ot.x,Ot.y)&&(ca=Math.abs(Fr-Ot.y)/(Pr-Ot.x),Jt(Ot,Ee)&&(ca<na||ca===na&&(Ot.x>hn.x||Ot.x===hn.x&&rt(hn,Ot)))&&(hn=Ot,na=ca)),Ot=Ot.next;while(Ot!==Ji);return hn}function rt(Ee,Bt){return hr(Ee.prev,Ee,Bt.prev)<0&&hr(Bt.next,Ee,Ee.next)<0}function xt(Ee,Bt,Ot,Pr){var Fr=Ee;do Fr.z===0&&(Fr.z=Ct(Fr.x,Fr.y,Bt,Ot,Pr)),Fr.prevZ=Fr.prev,Fr.nextZ=Fr.next,Fr=Fr.next;while(Fr!==Ee);Fr.prevZ.nextZ=null,Fr.prevZ=null,nt(Fr)}function nt(Ee){var Bt,Ot,Pr,Fr,Nr,hn,xn,Ji,pi=1;do{for(Ot=Ee,Ee=null,Nr=null,hn=0;Ot;){for(hn++,Pr=Ot,xn=0,Bt=0;Bt<pi&&(xn++,Pr=Pr.nextZ,!!Pr);Bt++);for(Ji=pi;xn>0||Ji>0&&Pr;)xn!==0&&(Ji===0||!Pr||Ot.z<=Pr.z)?(Fr=Ot,Ot=Ot.nextZ,xn--):(Fr=Pr,Pr=Pr.nextZ,Ji--),Nr?Nr.nextZ=Fr:Ee=Fr,Fr.prevZ=Nr,Nr=Fr;Ot=Pr}Nr.nextZ=null,pi*=2}while(hn>1);return Ee}function Ct(Ee,Bt,Ot,Pr,Fr){return Ee=(Ee-Ot)*Fr|0,Bt=(Bt-Pr)*Fr|0,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,Bt=(Bt|Bt<<8)&16711935,Bt=(Bt|Bt<<4)&252645135,Bt=(Bt|Bt<<2)&858993459,Bt=(Bt|Bt<<1)&1431655765,Ee|Bt<<1}function jt(Ee){var Bt=Ee,Ot=Ee;do(Bt.x<Ot.x||Bt.x===Ot.x&&Bt.y<Ot.y)&&(Ot=Bt),Bt=Bt.next;while(Bt!==Ee);return Ot}function Vt(Ee,Bt,Ot,Pr,Fr,Nr,hn,xn){return(Fr-hn)*(Bt-xn)>=(Ee-hn)*(Nr-xn)&&(Ee-hn)*(Pr-xn)>=(Ot-hn)*(Bt-xn)&&(Ot-hn)*(Nr-xn)>=(Fr-hn)*(Pr-xn)}function Rt(Ee,Bt){return Ee.next.i!==Bt.i&&Ee.prev.i!==Bt.i&&!rr(Ee,Bt)&&(Jt(Ee,Bt)&&Jt(Bt,Ee)&&br(Ee,Bt)&&(hr(Ee.prev,Ee,Bt.prev)||hr(Ee,Bt.prev,Bt))||er(Ee,Bt)&&hr(Ee.prev,Ee,Ee.next)>0&&hr(Bt.prev,Bt,Bt.next)>0)}function hr(Ee,Bt,Ot){return(Bt.y-Ee.y)*(Ot.x-Bt.x)-(Bt.x-Ee.x)*(Ot.y-Bt.y)}function er(Ee,Bt){return Ee.x===Bt.x&&Ee.y===Bt.y}function gn(Ee,Bt,Ot,Pr){var Fr=vn(hr(Ee,Bt,Ot)),Nr=vn(hr(Ee,Bt,Pr)),hn=vn(hr(Ot,Pr,Ee)),xn=vn(hr(Ot,Pr,Bt));return!!(Fr!==Nr&&hn!==xn||Fr===0&&Rr(Ee,Ot,Bt)||Nr===0&&Rr(Ee,Pr,Bt)||hn===0&&Rr(Ot,Ee,Pr)||xn===0&&Rr(Ot,Bt,Pr))}function Rr(Ee,Bt,Ot){return Bt.x<=Math.max(Ee.x,Ot.x)&&Bt.x>=Math.min(Ee.x,Ot.x)&&Bt.y<=Math.max(Ee.y,Ot.y)&&Bt.y>=Math.min(Ee.y,Ot.y)}function vn(Ee){return Ee>0?1:Ee<0?-1:0}function rr(Ee,Bt){var Ot=Ee;do{if(Ot.i!==Ee.i&&Ot.next.i!==Ee.i&&Ot.i!==Bt.i&&Ot.next.i!==Bt.i&&gn(Ot,Ot.next,Ee,Bt))return!0;Ot=Ot.next}while(Ot!==Ee);return!1}function Jt(Ee,Bt){return hr(Ee.prev,Ee,Ee.next)<0?hr(Ee,Bt,Ee.next)>=0&&hr(Ee,Ee.prev,Bt)>=0:hr(Ee,Bt,Ee.prev)<0||hr(Ee,Ee.next,Bt)<0}function br(Ee,Bt){var Ot=Ee,Pr=!1,Fr=(Ee.x+Bt.x)/2,Nr=(Ee.y+Bt.y)/2;do Ot.y>Nr!=Ot.next.y>Nr&&Ot.next.y!==Ot.y&&Fr<(Ot.next.x-Ot.x)*(Nr-Ot.y)/(Ot.next.y-Ot.y)+Ot.x&&(Pr=!Pr),Ot=Ot.next;while(Ot!==Ee);return Pr}function or(Ee,Bt){var Ot=new ot(Ee.i,Ee.x,Ee.y),Pr=new ot(Bt.i,Bt.x,Bt.y),Fr=Ee.next,Nr=Bt.prev;return Ee.next=Bt,Bt.prev=Ee,Ot.next=Fr,Fr.prev=Ot,Pr.next=Ot,Ot.prev=Pr,Nr.next=Pr,Pr.prev=Nr,Pr}function Br(Ee,Bt,Ot,Pr){var Fr=new ot(Ee,Bt,Ot);return Pr?(Fr.next=Pr.next,Fr.prev=Pr,Pr.next.prev=Fr,Pr.next=Fr):(Fr.prev=Fr,Fr.next=Fr),Fr}function an(Ee){Ee.next.prev=Ee.prev,Ee.prev.next=Ee.next,Ee.prevZ&&(Ee.prevZ.nextZ=Ee.nextZ),Ee.nextZ&&(Ee.nextZ.prevZ=Ee.prevZ)}function ot(Ee,Bt,Ot){this.i=Ee,this.x=Bt,this.y=Ot,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}_e.deviation=function(Ee,Bt,Ot,Pr){var Fr=Bt&&Bt.length,Nr=Fr?Bt[0]*Ot:Ee.length,hn=Math.abs(Dt(Ee,0,Nr,Ot));if(Fr)for(var xn=0,Ji=Bt.length;xn<Ji;xn++){var pi=Bt[xn]*Ot,Ka=xn<Ji-1?Bt[xn+1]*Ot:Ee.length;hn-=Math.abs(Dt(Ee,pi,Ka,Ot))}var na=0;for(xn=0;xn<Pr.length;xn+=3){var ca=Pr[xn]*Ot,po=Pr[xn+1]*Ot,La=Pr[xn+2]*Ot;na+=Math.abs((Ee[ca]-Ee[La])*(Ee[po+1]-Ee[ca+1])-(Ee[ca]-Ee[po])*(Ee[La+1]-Ee[ca+1]))}return hn===0&&na===0?0:Math.abs((na-hn)/hn)};function Dt(Ee,Bt,Ot,Pr){for(var Fr=0,Nr=Bt,hn=Ot-Pr;Nr<Ot;Nr+=Pr)Fr+=(Ee[hn]-Ee[Nr])*(Ee[Nr+1]+Ee[hn+1]),hn=Nr;return Fr}_e.flatten=function(Ee){for(var Bt=Ee[0][0].length,Ot={vertices:[],holes:[],dimensions:Bt},Pr=0,Fr=0;Fr<Ee.length;Fr++){for(var Nr=0;Nr<Ee[Fr].length;Nr++)for(var hn=0;hn<Bt;hn++)Ot.vertices.push(Ee[Fr][Nr][hn]);Fr>0&&(Pr+=Ee[Fr-1].length,Ot.holes.push(Pr))}return Ot}},67709:function(Ue){function _e(K){var j=K.target||K.srcElement;j.__resizeRAF__&&cancelAnimationFrame(j.__resizeRAF__),j.__resizeRAF__=requestAnimationFrame(function(){var P=j.__resizeTrigger__,M=P&&P.__resizeListeners__;M&&M.forEach(function(ee){ee.call(P,K)})})}var G=function(j,P){var M=this,ee=M.document,te,pe=ee.attachEvent;typeof navigator!="undefined"&&(te=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ce(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",_e)}if(!j.__resizeListeners__)if(j.__resizeListeners__=[],pe)j.__resizeTrigger__=j,j.attachEvent("onresize",_e);else{getComputedStyle(j).position==="static"&&(j.style.position="relative");var le=j.__resizeTrigger__=ee.createElement("object");le.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),le.setAttribute("class","resize-sensor"),le.setAttribute("tabindex","-1"),le.setAttribute("title",""),le.__resizeElement__=j,le.onload=Ce,le.type="text/html",te&&j.appendChild(le),le.data="about:blank",te||j.appendChild(le)}j.__resizeListeners__.push(P)};Ue.exports=typeof window=="undefined"?G:G.bind(window),Ue.exports.unbind=function(K,j){var P=document.attachEvent,M=K.__resizeListeners__||[];if(j){var ee=M.indexOf(j);ee!==-1&&M.splice(ee,1)}else M=K.__resizeListeners__=[];if(!M.length){if(P)K.detachEvent("onresize",_e);else if(K.__resizeTrigger__){var te=K.__resizeTrigger__.contentDocument,pe=te&&te.defaultView;pe&&(pe.removeEventListener("resize",_e),delete pe.__resizeTrigger__),K.__resizeTrigger__=!K.removeChild(K.__resizeTrigger__)}delete K.__resizeListeners__}}},26729:function(Ue){"use strict";var _e=Object.prototype.hasOwnProperty,G="~";function K(){}Object.create&&(K.prototype=Object.create(null),new K().__proto__||(G=!1));function j(te,pe,Ce){this.fn=te,this.context=pe,this.once=Ce||!1}function P(te,pe,Ce,le,Ie){if(typeof Ce!="function")throw new TypeError("The listener must be a function");var rt=new j(Ce,le||te,Ie),xt=G?G+pe:pe;return te._events[xt]?te._events[xt].fn?te._events[xt]=[te._events[xt],rt]:te._events[xt].push(rt):(te._events[xt]=rt,te._eventsCount++),te}function M(te,pe){--te._eventsCount===0?te._events=new K:delete te._events[pe]}function ee(){this._events=new K,this._eventsCount=0}ee.prototype.eventNames=function(){var pe=[],Ce,le;if(this._eventsCount===0)return pe;for(le in Ce=this._events)_e.call(Ce,le)&&pe.push(G?le.slice(1):le);return Object.getOwnPropertySymbols?pe.concat(Object.getOwnPropertySymbols(Ce)):pe},ee.prototype.listeners=function(pe){var Ce=G?G+pe:pe,le=this._events[Ce];if(!le)return[];if(le.fn)return[le.fn];for(var Ie=0,rt=le.length,xt=new Array(rt);Ie<rt;Ie++)xt[Ie]=le[Ie].fn;return xt},ee.prototype.listenerCount=function(pe){var Ce=G?G+pe:pe,le=this._events[Ce];return le?le.fn?1:le.length:0},ee.prototype.emit=function(pe,Ce,le,Ie,rt,xt){var nt=G?G+pe:pe;if(!this._events[nt])return!1;var Ct=this._events[nt],jt=arguments.length,Vt,Rt;if(Ct.fn){switch(Ct.once&&this.removeListener(pe,Ct.fn,void 0,!0),jt){case 1:return Ct.fn.call(Ct.context),!0;case 2:return Ct.fn.call(Ct.context,Ce),!0;case 3:return Ct.fn.call(Ct.context,Ce,le),!0;case 4:return Ct.fn.call(Ct.context,Ce,le,Ie),!0;case 5:return Ct.fn.call(Ct.context,Ce,le,Ie,rt),!0;case 6:return Ct.fn.call(Ct.context,Ce,le,Ie,rt,xt),!0}for(Rt=1,Vt=new Array(jt-1);Rt<jt;Rt++)Vt[Rt-1]=arguments[Rt];Ct.fn.apply(Ct.context,Vt)}else{var hr=Ct.length,er;for(Rt=0;Rt<hr;Rt++)switch(Ct[Rt].once&&this.removeListener(pe,Ct[Rt].fn,void 0,!0),jt){case 1:Ct[Rt].fn.call(Ct[Rt].context);break;case 2:Ct[Rt].fn.call(Ct[Rt].context,Ce);break;case 3:Ct[Rt].fn.call(Ct[Rt].context,Ce,le);break;case 4:Ct[Rt].fn.call(Ct[Rt].context,Ce,le,Ie);break;default:if(!Vt)for(er=1,Vt=new Array(jt-1);er<jt;er++)Vt[er-1]=arguments[er];Ct[Rt].fn.apply(Ct[Rt].context,Vt)}}return!0},ee.prototype.on=function(pe,Ce,le){return P(this,pe,Ce,le,!1)},ee.prototype.once=function(pe,Ce,le){return P(this,pe,Ce,le,!0)},ee.prototype.removeListener=function(pe,Ce,le,Ie){var rt=G?G+pe:pe;if(!this._events[rt])return this;if(!Ce)return M(this,rt),this;var xt=this._events[rt];if(xt.fn)xt.fn===Ce&&(!Ie||xt.once)&&(!le||xt.context===le)&&M(this,rt);else{for(var nt=0,Ct=[],jt=xt.length;nt<jt;nt++)(xt[nt].fn!==Ce||Ie&&!xt[nt].once||le&&xt[nt].context!==le)&&Ct.push(xt[nt]);Ct.length?this._events[rt]=Ct.length===1?Ct[0]:Ct:M(this,rt)}return this},ee.prototype.removeAllListeners=function(pe){var Ce;return pe?(Ce=G?G+pe:pe,this._events[Ce]&&M(this,Ce)):(this._events=new K,this._eventsCount=0),this},ee.prototype.off=ee.prototype.removeListener,ee.prototype.addListener=ee.prototype.on,ee.prefixed=G,ee.EventEmitter=ee,Ue.exports=ee},50840:function(Ue,_e,G){var K;(function(j,P,M,ee){"use strict";var te=["","webkit","Moz","MS","ms","o"],pe=P.createElement("div"),Ce="function",le=Math.round,Ie=Math.abs,rt=Date.now;function xt(_t,Ut,Er){return setTimeout(gn(_t,Er),Ut)}function nt(_t,Ut,Er){return Array.isArray(_t)?(Ct(_t,Er[Ut],Er),!0):!1}function Ct(_t,Ut,Er){var Sn;if(_t)if(_t.forEach)_t.forEach(Ut,Er);else if(_t.length!==ee)for(Sn=0;Sn<_t.length;)Ut.call(Er,_t[Sn],Sn,_t),Sn++;else for(Sn in _t)_t.hasOwnProperty(Sn)&&Ut.call(Er,_t[Sn],Sn,_t)}function jt(_t,Ut,Er){var Sn="DEPRECATED METHOD: "+Ut+`
`+Er+` AT 
`;return function(){var kr=new Error("get-stack-trace"),wa=kr&&kr.stack?kr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Xa=j.console&&(j.console.warn||j.console.log);return Xa&&Xa.call(j.console,Sn,wa),_t.apply(this,arguments)}}var Vt;typeof Object.assign!="function"?Vt=function(Ut){if(Ut===ee||Ut===null)throw new TypeError("Cannot convert undefined or null to object");for(var Er=Object(Ut),Sn=1;Sn<arguments.length;Sn++){var kr=arguments[Sn];if(kr!==ee&&kr!==null)for(var wa in kr)kr.hasOwnProperty(wa)&&(Er[wa]=kr[wa])}return Er}:Vt=Object.assign;var Rt=jt(function(Ut,Er,Sn){for(var kr=Object.keys(Er),wa=0;wa<kr.length;)(!Sn||Sn&&Ut[kr[wa]]===ee)&&(Ut[kr[wa]]=Er[kr[wa]]),wa++;return Ut},"extend","Use `assign`."),hr=jt(function(Ut,Er){return Rt(Ut,Er,!0)},"merge","Use `assign`.");function er(_t,Ut,Er){var Sn=Ut.prototype,kr;kr=_t.prototype=Object.create(Sn),kr.constructor=_t,kr._super=Sn,Er&&Vt(kr,Er)}function gn(_t,Ut){return function(){return _t.apply(Ut,arguments)}}function Rr(_t,Ut){return typeof _t==Ce?_t.apply(Ut&&Ut[0]||ee,Ut):_t}function vn(_t,Ut){return _t===ee?Ut:_t}function rr(_t,Ut,Er){Ct(Br(Ut),function(Sn){_t.addEventListener(Sn,Er,!1)})}function Jt(_t,Ut,Er){Ct(Br(Ut),function(Sn){_t.removeEventListener(Sn,Er,!1)})}function br(_t,Ut){for(;_t;){if(_t==Ut)return!0;_t=_t.parentNode}return!1}function or(_t,Ut){return _t.indexOf(Ut)>-1}function Br(_t){return _t.trim().split(/\s+/g)}function an(_t,Ut,Er){if(_t.indexOf&&!Er)return _t.indexOf(Ut);for(var Sn=0;Sn<_t.length;){if(Er&&_t[Sn][Er]==Ut||!Er&&_t[Sn]===Ut)return Sn;Sn++}return-1}function ot(_t){return Array.prototype.slice.call(_t,0)}function Dt(_t,Ut,Er){for(var Sn=[],kr=[],wa=0;wa<_t.length;){var Xa=Ut?_t[wa][Ut]:_t[wa];an(kr,Xa)<0&&Sn.push(_t[wa]),kr[wa]=Xa,wa++}return Er&&(Ut?Sn=Sn.sort(function(Jo,au){return Jo[Ut]>au[Ut]}):Sn=Sn.sort()),Sn}function Ee(_t,Ut){for(var Er,Sn,kr=Ut[0].toUpperCase()+Ut.slice(1),wa=0;wa<te.length;){if(Er=te[wa],Sn=Er?Er+kr:Ut,Sn in _t)return Sn;wa++}return ee}var Bt=1;function Ot(){return Bt++}function Pr(_t){var Ut=_t.ownerDocument||_t;return Ut.defaultView||Ut.parentWindow||j}var Fr=/mobile|tablet|ip(ad|hone|od)|android/i,Nr="ontouchstart"in j,hn=Ee(j,"PointerEvent")!==ee,xn=Nr&&Fr.test(navigator.userAgent),Ji="touch",pi="pen",Ka="mouse",na="kinect",ca=25,po=1,La=2,$i=4,qo=8,is=1,Ko=2,Za=4,ha=8,Fo=16,un=Ko|Za,Ua=ha|Fo,zr=un|Ua,be=["x","y"],lt=["clientX","clientY"];function mt(_t,Ut){var Er=this;this.manager=_t,this.callback=Ut,this.element=_t.element,this.target=_t.options.inputTarget,this.domHandler=function(Sn){Rr(_t.options.enable,[_t])&&Er.handler(Sn)},this.init()}mt.prototype={handler:function(){},init:function(){this.evEl&&rr(this.element,this.evEl,this.domHandler),this.evTarget&&rr(this.target,this.evTarget,this.domHandler),this.evWin&&rr(Pr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Jt(this.element,this.evEl,this.domHandler),this.evTarget&&Jt(this.target,this.evTarget,this.domHandler),this.evWin&&Jt(Pr(this.element),this.evWin,this.domHandler)}};function Qt(_t){var Ut,Er=_t.options.inputClass;return Er?Ut=Er:hn?Ut=ve:xn?Ut=Be:Nr?Ut=Yr:Ut=ya,new Ut(_t,xr)}function xr(_t,Ut,Er){var Sn=Er.pointers.length,kr=Er.changedPointers.length,wa=Ut&po&&Sn-kr===0,Xa=Ut&($i|qo)&&Sn-kr===0;Er.isFirst=!!wa,Er.isFinal=!!Xa,wa&&(_t.session={}),Er.eventType=Ut,mn(_t,Er),_t.emit("hammer.input",Er),_t.recognize(Er),_t.session.prevInput=Er}function mn(_t,Ut){var Er=_t.session,Sn=Ut.pointers,kr=Sn.length;Er.firstInput||(Er.firstInput=Hr(Ut)),kr>1&&!Er.firstMultiple?Er.firstMultiple=Hr(Ut):kr===1&&(Er.firstMultiple=!1);var wa=Er.firstInput,Xa=Er.firstMultiple,yl=Xa?Xa.center:wa.center,Jo=Ut.center=dr(Sn);Ut.timeStamp=rt(),Ut.deltaTime=Ut.timeStamp-wa.timeStamp,Ut.angle=ea(yl,Jo),Ut.distance=Yi(yl,Jo),Wn(Er,Ut),Ut.offsetDirection=ti(Ut.deltaX,Ut.deltaY);var au=Un(Ut.deltaTime,Ut.deltaX,Ut.deltaY);Ut.overallVelocityX=au.x,Ut.overallVelocityY=au.y,Ut.overallVelocity=Ie(au.x)>Ie(au.y)?au.x:au.y,Ut.scale=Xa?Xn(Xa.pointers,Sn):1,Ut.rotation=Xa?on(Xa.pointers,Sn):0,Ut.maxPointers=Er.prevInput?Ut.pointers.length>Er.prevInput.maxPointers?Ut.pointers.length:Er.prevInput.maxPointers:Ut.pointers.length,tr(Er,Ut);var ou=_t.element;br(Ut.srcEvent.target,ou)&&(ou=Ut.srcEvent.target),Ut.target=ou}function Wn(_t,Ut){var Er=Ut.center,Sn=_t.offsetDelta||{},kr=_t.prevDelta||{},wa=_t.prevInput||{};(Ut.eventType===po||wa.eventType===$i)&&(kr=_t.prevDelta={x:wa.deltaX||0,y:wa.deltaY||0},Sn=_t.offsetDelta={x:Er.x,y:Er.y}),Ut.deltaX=kr.x+(Er.x-Sn.x),Ut.deltaY=kr.y+(Er.y-Sn.y)}function tr(_t,Ut){var Er=_t.lastInterval||Ut,Sn=Ut.timeStamp-Er.timeStamp,kr,wa,Xa,yl;if(Ut.eventType!=qo&&(Sn>ca||Er.velocity===ee)){var Jo=Ut.deltaX-Er.deltaX,au=Ut.deltaY-Er.deltaY,ou=Un(Sn,Jo,au);wa=ou.x,Xa=ou.y,kr=Ie(ou.x)>Ie(ou.y)?ou.x:ou.y,yl=ti(Jo,au),_t.lastInterval=Ut}else kr=Er.velocity,wa=Er.velocityX,Xa=Er.velocityY,yl=Er.direction;Ut.velocity=kr,Ut.velocityX=wa,Ut.velocityY=Xa,Ut.direction=yl}function Hr(_t){for(var Ut=[],Er=0;Er<_t.pointers.length;)Ut[Er]={clientX:le(_t.pointers[Er].clientX),clientY:le(_t.pointers[Er].clientY)},Er++;return{timeStamp:rt(),pointers:Ut,center:dr(Ut),deltaX:_t.deltaX,deltaY:_t.deltaY}}function dr(_t){var Ut=_t.length;if(Ut===1)return{x:le(_t[0].clientX),y:le(_t[0].clientY)};for(var Er=0,Sn=0,kr=0;kr<Ut;)Er+=_t[kr].clientX,Sn+=_t[kr].clientY,kr++;return{x:le(Er/Ut),y:le(Sn/Ut)}}function Un(_t,Ut,Er){return{x:Ut/_t||0,y:Er/_t||0}}function ti(_t,Ut){return _t===Ut?is:Ie(_t)>=Ie(Ut)?_t<0?Ko:Za:Ut<0?ha:Fo}function Yi(_t,Ut,Er){Er||(Er=be);var Sn=Ut[Er[0]]-_t[Er[0]],kr=Ut[Er[1]]-_t[Er[1]];return Math.sqrt(Sn*Sn+kr*kr)}function ea(_t,Ut,Er){Er||(Er=be);var Sn=Ut[Er[0]]-_t[Er[0]],kr=Ut[Er[1]]-_t[Er[1]];return Math.atan2(kr,Sn)*180/Math.PI}function on(_t,Ut){return ea(Ut[1],Ut[0],lt)+ea(_t[1],_t[0],lt)}function Xn(_t,Ut){return Yi(Ut[0],Ut[1],lt)/Yi(_t[0],_t[1],lt)}var Pi={mousedown:po,mousemove:La,mouseup:$i},Pa="mousedown",zo="mousemove mouseup";function ya(){this.evEl=Pa,this.evWin=zo,this.pressed=!1,mt.apply(this,arguments)}er(ya,mt,{handler:function(Ut){var Er=Pi[Ut.type];Er&po&&Ut.button===0&&(this.pressed=!0),Er&La&&Ut.which!==1&&(Er=$i),this.pressed&&(Er&$i&&(this.pressed=!1),this.callback(this.manager,Er,{pointers:[Ut],changedPointers:[Ut],pointerType:Ka,srcEvent:Ut}))}});var Xu={pointerdown:po,pointermove:La,pointerup:$i,pointercancel:qo,pointerout:qo},Wt={2:Ji,3:pi,4:Ka,5:na},qe="pointerdown",se="pointermove pointerup pointercancel";j.MSPointerEvent&&!j.PointerEvent&&(qe="MSPointerDown",se="MSPointerMove MSPointerUp MSPointerCancel");function ve(){this.evEl=qe,this.evWin=se,mt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}er(ve,mt,{handler:function(Ut){var Er=this.store,Sn=!1,kr=Ut.type.toLowerCase().replace("ms",""),wa=Xu[kr],Xa=Wt[Ut.pointerType]||Ut.pointerType,yl=Xa==Ji,Jo=an(Er,Ut.pointerId,"pointerId");wa&po&&(Ut.button===0||yl)?Jo<0&&(Er.push(Ut),Jo=Er.length-1):wa&($i|qo)&&(Sn=!0),!(Jo<0)&&(Er[Jo]=Ut,this.callback(this.manager,wa,{pointers:Er,changedPointers:[Ut],pointerType:Xa,srcEvent:Ut}),Sn&&Er.splice(Jo,1))}});var Ae={touchstart:po,touchmove:La,touchend:$i,touchcancel:qo},Re="touchstart",Xe="touchstart touchmove touchend touchcancel";function Qe(){this.evTarget=Re,this.evWin=Xe,this.started=!1,mt.apply(this,arguments)}er(Qe,mt,{handler:function(Ut){var Er=Ae[Ut.type];if(Er===po&&(this.started=!0),!!this.started){var Sn=Ye.call(this,Ut,Er);Er&($i|qo)&&Sn[0].length-Sn[1].length===0&&(this.started=!1),this.callback(this.manager,Er,{pointers:Sn[0],changedPointers:Sn[1],pointerType:Ji,srcEvent:Ut})}}});function Ye(_t,Ut){var Er=ot(_t.touches),Sn=ot(_t.changedTouches);return Ut&($i|qo)&&(Er=Dt(Er.concat(Sn),"identifier",!0)),[Er,Sn]}var Fe={touchstart:po,touchmove:La,touchend:$i,touchcancel:qo},Me="touchstart touchmove touchend touchcancel";function Be(){this.evTarget=Me,this.targetIds={},mt.apply(this,arguments)}er(Be,mt,{handler:function(Ut){var Er=Fe[Ut.type],Sn=yt.call(this,Ut,Er);Sn&&this.callback(this.manager,Er,{pointers:Sn[0],changedPointers:Sn[1],pointerType:Ji,srcEvent:Ut})}});function yt(_t,Ut){var Er=ot(_t.touches),Sn=this.targetIds;if(Ut&(po|La)&&Er.length===1)return Sn[Er[0].identifier]=!0,[Er,Er];var kr,wa,Xa=ot(_t.changedTouches),yl=[],Jo=this.target;if(wa=Er.filter(function(au){return br(au.target,Jo)}),Ut===po)for(kr=0;kr<wa.length;)Sn[wa[kr].identifier]=!0,kr++;for(kr=0;kr<Xa.length;)Sn[Xa[kr].identifier]&&yl.push(Xa[kr]),Ut&($i|qo)&&delete Sn[Xa[kr].identifier],kr++;if(yl.length)return[Dt(wa.concat(yl),"identifier",!0),yl]}var zt=2500,Ze=25;function Yr(){mt.apply(this,arguments);var _t=gn(this.handler,this);this.touch=new Be(this.manager,_t),this.mouse=new ya(this.manager,_t),this.primaryTouch=null,this.lastTouches=[]}er(Yr,mt,{handler:function(Ut,Er,Sn){var kr=Sn.pointerType==Ji,wa=Sn.pointerType==Ka;if(!(wa&&Sn.sourceCapabilities&&Sn.sourceCapabilities.firesTouchEvents)){if(kr)Fn.call(this,Er,Sn);else if(wa&&qr.call(this,Sn))return;this.callback(Ut,Er,Sn)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Fn(_t,Ut){_t&po?(this.primaryTouch=Ut.changedPointers[0].identifier,Nn.call(this,Ut)):_t&($i|qo)&&Nn.call(this,Ut)}function Nn(_t){var Ut=_t.changedPointers[0];if(Ut.identifier===this.primaryTouch){var Er={x:Ut.clientX,y:Ut.clientY};this.lastTouches.push(Er);var Sn=this.lastTouches,kr=function(){var wa=Sn.indexOf(Er);wa>-1&&Sn.splice(wa,1)};setTimeout(kr,zt)}}function qr(_t){for(var Ut=_t.srcEvent.clientX,Er=_t.srcEvent.clientY,Sn=0;Sn<this.lastTouches.length;Sn++){var kr=this.lastTouches[Sn],wa=Math.abs(Ut-kr.x),Xa=Math.abs(Er-kr.y);if(wa<=Ze&&Xa<=Ze)return!0}return!1}var li=Ee(pe.style,"touchAction"),zn=li!==ee,jn="compute",Ca="auto",ni="manipulation",za="none",Ao="pan-x",io="pan-y",ys=Qs();function oo(_t,Ut){this.manager=_t,this.set(Ut)}oo.prototype={set:function(_t){_t==jn&&(_t=this.compute()),zn&&this.manager.element.style&&ys[_t]&&(this.manager.element.style[li]=_t),this.actions=_t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var _t=[];return Ct(this.manager.recognizers,function(Ut){Rr(Ut.options.enable,[Ut])&&(_t=_t.concat(Ut.getTouchAction()))}),el(_t.join(" "))},preventDefaults:function(_t){var Ut=_t.srcEvent,Er=_t.offsetDirection;if(this.manager.session.prevented){Ut.preventDefault();return}var Sn=this.actions,kr=or(Sn,za)&&!ys[za],wa=or(Sn,io)&&!ys[io],Xa=or(Sn,Ao)&&!ys[Ao];if(kr){var yl=_t.pointers.length===1,Jo=_t.distance<2,au=_t.deltaTime<250;if(yl&&Jo&&au)return}if(!(Xa&&wa)&&(kr||wa&&Er&un||Xa&&Er&Ua))return this.preventSrc(Ut)},preventSrc:function(_t){this.manager.session.prevented=!0,_t.preventDefault()}};function el(_t){if(or(_t,za))return za;var Ut=or(_t,Ao),Er=or(_t,io);return Ut&&Er?za:Ut||Er?Ut?Ao:io:or(_t,ni)?ni:Ca}function Qs(){if(!zn)return!1;var _t={},Ut=j.CSS&&j.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Er){_t[Er]=Ut?j.CSS.supports("touch-action",Er):!0}),_t}var vo=1,as=2,To=4,to=8,js=to,Vc=16,ws=32;function Ss(_t){this.options=Vt({},this.defaults,_t||{}),this.id=Ot(),this.manager=null,this.options.enable=vn(this.options.enable,!0),this.state=vo,this.simultaneous={},this.requireFail=[]}Ss.prototype={defaults:{},set:function(_t){return Vt(this.options,_t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(_t){if(nt(_t,"recognizeWith",this))return this;var Ut=this.simultaneous;return _t=Io(_t,this),Ut[_t.id]||(Ut[_t.id]=_t,_t.recognizeWith(this)),this},dropRecognizeWith:function(_t){return nt(_t,"dropRecognizeWith",this)?this:(_t=Io(_t,this),delete this.simultaneous[_t.id],this)},requireFailure:function(_t){if(nt(_t,"requireFailure",this))return this;var Ut=this.requireFail;return _t=Io(_t,this),an(Ut,_t)===-1&&(Ut.push(_t),_t.requireFailure(this)),this},dropRequireFailure:function(_t){if(nt(_t,"dropRequireFailure",this))return this;_t=Io(_t,this);var Ut=an(this.requireFail,_t);return Ut>-1&&this.requireFail.splice(Ut,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(_t){return!!this.simultaneous[_t.id]},emit:function(_t){var Ut=this,Er=this.state;function Sn(kr){Ut.manager.emit(kr,_t)}Er<to&&Sn(Ut.options.event+eh(Er)),Sn(Ut.options.event),_t.additionalEvent&&Sn(_t.additionalEvent),Er>=to&&Sn(Ut.options.event+eh(Er))},tryEmit:function(_t){if(this.canEmit())return this.emit(_t);this.state=ws},canEmit:function(){for(var _t=0;_t<this.requireFail.length;){if(!(this.requireFail[_t].state&(ws|vo)))return!1;_t++}return!0},recognize:function(_t){var Ut=Vt({},_t);if(!Rr(this.options.enable,[this,Ut])){this.reset(),this.state=ws;return}this.state&(js|Vc|ws)&&(this.state=vo),this.state=this.process(Ut),this.state&(as|To|to|Vc)&&this.tryEmit(Ut)},process:function(_t){},getTouchAction:function(){},reset:function(){}};function eh(_t){return _t&Vc?"cancel":_t&to?"end":_t&To?"move":_t&as?"start":""}function kc(_t){return _t==Fo?"down":_t==ha?"up":_t==Ko?"left":_t==Za?"right":""}function Io(_t,Ut){var Er=Ut.manager;return Er?Er.get(_t):_t}function bo(){Ss.apply(this,arguments)}er(bo,Ss,{defaults:{pointers:1},attrTest:function(_t){var Ut=this.options.pointers;return Ut===0||_t.pointers.length===Ut},process:function(_t){var Ut=this.state,Er=_t.eventType,Sn=Ut&(as|To),kr=this.attrTest(_t);return Sn&&(Er&qo||!kr)?Ut|Vc:Sn||kr?Er&$i?Ut|to:Ut&as?Ut|To:as:ws}});function du(){bo.apply(this,arguments),this.pX=null,this.pY=null}er(du,bo,{defaults:{event:"pan",threshold:10,pointers:1,direction:zr},getTouchAction:function(){var _t=this.options.direction,Ut=[];return _t&un&&Ut.push(io),_t&Ua&&Ut.push(Ao),Ut},directionTest:function(_t){var Ut=this.options,Er=!0,Sn=_t.distance,kr=_t.direction,wa=_t.deltaX,Xa=_t.deltaY;return kr&Ut.direction||(Ut.direction&un?(kr=wa===0?is:wa<0?Ko:Za,Er=wa!=this.pX,Sn=Math.abs(_t.deltaX)):(kr=Xa===0?is:Xa<0?ha:Fo,Er=Xa!=this.pY,Sn=Math.abs(_t.deltaY))),_t.direction=kr,Er&&Sn>Ut.threshold&&kr&Ut.direction},attrTest:function(_t){return bo.prototype.attrTest.call(this,_t)&&(this.state&as||!(this.state&as)&&this.directionTest(_t))},emit:function(_t){this.pX=_t.deltaX,this.pY=_t.deltaY;var Ut=kc(_t.direction);Ut&&(_t.additionalEvent=this.options.event+Ut),this._super.emit.call(this,_t)}});function Zo(){bo.apply(this,arguments)}er(Zo,bo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[za]},attrTest:function(_t){return this._super.attrTest.call(this,_t)&&(Math.abs(_t.scale-1)>this.options.threshold||this.state&as)},emit:function(_t){if(_t.scale!==1){var Ut=_t.scale<1?"in":"out";_t.additionalEvent=this.options.event+Ut}this._super.emit.call(this,_t)}});function Il(){Ss.apply(this,arguments),this._timer=null,this._input=null}er(Il,Ss,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ca]},process:function(_t){var Ut=this.options,Er=_t.pointers.length===Ut.pointers,Sn=_t.distance<Ut.threshold,kr=_t.deltaTime>Ut.time;if(this._input=_t,!Sn||!Er||_t.eventType&($i|qo)&&!kr)this.reset();else if(_t.eventType&po)this.reset(),this._timer=xt(function(){this.state=js,this.tryEmit()},Ut.time,this);else if(_t.eventType&$i)return js;return ws},reset:function(){clearTimeout(this._timer)},emit:function(_t){this.state===js&&(_t&&_t.eventType&$i?this.manager.emit(this.options.event+"up",_t):(this._input.timeStamp=rt(),this.manager.emit(this.options.event,this._input)))}});function Uo(){bo.apply(this,arguments)}er(Uo,bo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[za]},attrTest:function(_t){return this._super.attrTest.call(this,_t)&&(Math.abs(_t.rotation)>this.options.threshold||this.state&as)}});function Ws(){bo.apply(this,arguments)}er(Ws,bo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:un|Ua,pointers:1},getTouchAction:function(){return du.prototype.getTouchAction.call(this)},attrTest:function(_t){var Ut=this.options.direction,Er;return Ut&(un|Ua)?Er=_t.overallVelocity:Ut&un?Er=_t.overallVelocityX:Ut&Ua&&(Er=_t.overallVelocityY),this._super.attrTest.call(this,_t)&&Ut&_t.offsetDirection&&_t.distance>this.options.threshold&&_t.maxPointers==this.options.pointers&&Ie(Er)>this.options.velocity&&_t.eventType&$i},emit:function(_t){var Ut=kc(_t.offsetDirection);Ut&&this.manager.emit(this.options.event+Ut,_t),this.manager.emit(this.options.event,_t)}});function eu(){Ss.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}er(eu,Ss,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ni]},process:function(_t){var Ut=this.options,Er=_t.pointers.length===Ut.pointers,Sn=_t.distance<Ut.threshold,kr=_t.deltaTime<Ut.time;if(this.reset(),_t.eventType&po&&this.count===0)return this.failTimeout();if(Sn&&kr&&Er){if(_t.eventType!=$i)return this.failTimeout();var wa=this.pTime?_t.timeStamp-this.pTime<Ut.interval:!0,Xa=!this.pCenter||Yi(this.pCenter,_t.center)<Ut.posThreshold;this.pTime=_t.timeStamp,this.pCenter=_t.center,!Xa||!wa?this.count=1:this.count+=1,this._input=_t;var yl=this.count%Ut.taps;if(yl===0)return this.hasRequireFailures()?(this._timer=xt(function(){this.state=js,this.tryEmit()},Ut.interval,this),as):js}return ws},failTimeout:function(){return this._timer=xt(function(){this.state=ws},this.options.interval,this),ws},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==js&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sl(_t,Ut){return Ut=Ut||{},Ut.recognizers=vn(Ut.recognizers,sl.defaults.preset),new _c(_t,Ut)}sl.VERSION="2.0.7",sl.defaults={domEvents:!1,touchAction:jn,enable:!0,inputTarget:null,inputClass:null,preset:[[Uo,{enable:!1}],[Zo,{enable:!1},["rotate"]],[Ws,{direction:un}],[du,{direction:un},["swipe"]],[eu],[eu,{event:"doubletap",taps:2},["tap"]],[Il]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ul=1,ll=2;function _c(_t,Ut){this.options=Vt({},sl.defaults,Ut||{}),this.options.inputTarget=this.options.inputTarget||_t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=_t,this.input=Qt(this),this.touchAction=new oo(this,this.options.touchAction),zu(this,!0),Ct(this.options.recognizers,function(Er){var Sn=this.add(new Er[0](Er[1]));Er[2]&&Sn.recognizeWith(Er[2]),Er[3]&&Sn.requireFailure(Er[3])},this)}_c.prototype={set:function(_t){return Vt(this.options,_t),_t.touchAction&&this.touchAction.update(),_t.inputTarget&&(this.input.destroy(),this.input.target=_t.inputTarget,this.input.init()),this},stop:function(_t){this.session.stopped=_t?ll:ul},recognize:function(_t){var Ut=this.session;if(!Ut.stopped){this.touchAction.preventDefaults(_t);var Er,Sn=this.recognizers,kr=Ut.curRecognizer;(!kr||kr&&kr.state&js)&&(kr=Ut.curRecognizer=null);for(var wa=0;wa<Sn.length;)Er=Sn[wa],Ut.stopped!==ll&&(!kr||Er==kr||Er.canRecognizeWith(kr))?Er.recognize(_t):Er.reset(),!kr&&Er.state&(as|To|to)&&(kr=Ut.curRecognizer=Er),wa++}},get:function(_t){if(_t instanceof Ss)return _t;for(var Ut=this.recognizers,Er=0;Er<Ut.length;Er++)if(Ut[Er].options.event==_t)return Ut[Er];return null},add:function(_t){if(nt(_t,"add",this))return this;var Ut=this.get(_t.options.event);return Ut&&this.remove(Ut),this.recognizers.push(_t),_t.manager=this,this.touchAction.update(),_t},remove:function(_t){if(nt(_t,"remove",this))return this;if(_t=this.get(_t),_t){var Ut=this.recognizers,Er=an(Ut,_t);Er!==-1&&(Ut.splice(Er,1),this.touchAction.update())}return this},on:function(_t,Ut){if(_t!==ee&&Ut!==ee){var Er=this.handlers;return Ct(Br(_t),function(Sn){Er[Sn]=Er[Sn]||[],Er[Sn].push(Ut)}),this}},off:function(_t,Ut){if(_t!==ee){var Er=this.handlers;return Ct(Br(_t),function(Sn){Ut?Er[Sn]&&Er[Sn].splice(an(Er[Sn],Ut),1):delete Er[Sn]}),this}},emit:function(_t,Ut){this.options.domEvents&&cl(_t,Ut);var Er=this.handlers[_t]&&this.handlers[_t].slice();if(!(!Er||!Er.length)){Ut.type=_t,Ut.preventDefault=function(){Ut.srcEvent.preventDefault()};for(var Sn=0;Sn<Er.length;)Er[Sn](Ut),Sn++}},destroy:function(){this.element&&zu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function zu(_t,Ut){var Er=_t.element;if(Er.style){var Sn;Ct(_t.options.cssProps,function(kr,wa){Sn=Ee(Er.style,wa),Ut?(_t.oldCssProps[Sn]=Er.style[Sn],Er.style[Sn]=kr):Er.style[Sn]=_t.oldCssProps[Sn]||""}),Ut||(_t.oldCssProps={})}}function cl(_t,Ut){var Er=P.createEvent("Event");Er.initEvent(_t,!0,!0),Er.gesture=Ut,Ut.target.dispatchEvent(Er)}Vt(sl,{INPUT_START:po,INPUT_MOVE:La,INPUT_END:$i,INPUT_CANCEL:qo,STATE_POSSIBLE:vo,STATE_BEGAN:as,STATE_CHANGED:To,STATE_ENDED:to,STATE_RECOGNIZED:js,STATE_CANCELLED:Vc,STATE_FAILED:ws,DIRECTION_NONE:is,DIRECTION_LEFT:Ko,DIRECTION_RIGHT:Za,DIRECTION_UP:ha,DIRECTION_DOWN:Fo,DIRECTION_HORIZONTAL:un,DIRECTION_VERTICAL:Ua,DIRECTION_ALL:zr,Manager:_c,Input:mt,TouchAction:oo,TouchInput:Be,MouseInput:ya,PointerEventInput:ve,TouchMouseInput:Yr,SingleTouchInput:Qe,Recognizer:Ss,AttrRecognizer:bo,Tap:eu,Pan:du,Swipe:Ws,Pinch:Zo,Rotate:Uo,Press:Il,on:rr,off:Jt,each:Ct,merge:hr,extend:Rt,assign:Vt,inherit:er,bindFn:gn,prefixed:Ee});var iu=typeof j!="undefined"?j:typeof self!="undefined"?self:{};iu.Hammer=sl,K=function(){return sl}.call(_e,G,_e,Ue),K!==ee&&(Ue.exports=K)})(window,document,"Hammer")},80645:function(Ue,_e){_e.read=function(G,K,j,P,M){var ee,te,pe=M*8-P-1,Ce=(1<<pe)-1,le=Ce>>1,Ie=-7,rt=j?M-1:0,xt=j?-1:1,nt=G[K+rt];for(rt+=xt,ee=nt&(1<<-Ie)-1,nt>>=-Ie,Ie+=pe;Ie>0;ee=ee*256+G[K+rt],rt+=xt,Ie-=8);for(te=ee&(1<<-Ie)-1,ee>>=-Ie,Ie+=P;Ie>0;te=te*256+G[K+rt],rt+=xt,Ie-=8);if(ee===0)ee=1-le;else{if(ee===Ce)return te?NaN:(nt?-1:1)*(1/0);te=te+Math.pow(2,P),ee=ee-le}return(nt?-1:1)*te*Math.pow(2,ee-P)},_e.write=function(G,K,j,P,M,ee){var te,pe,Ce,le=ee*8-M-1,Ie=(1<<le)-1,rt=Ie>>1,xt=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,nt=P?0:ee-1,Ct=P?1:-1,jt=K<0||K===0&&1/K<0?1:0;for(K=Math.abs(K),isNaN(K)||K===1/0?(pe=isNaN(K)?1:0,te=Ie):(te=Math.floor(Math.log(K)/Math.LN2),K*(Ce=Math.pow(2,-te))<1&&(te--,Ce*=2),te+rt>=1?K+=xt/Ce:K+=xt*Math.pow(2,1-rt),K*Ce>=2&&(te++,Ce/=2),te+rt>=Ie?(pe=0,te=Ie):te+rt>=1?(pe=(K*Ce-1)*Math.pow(2,M),te=te+rt):(pe=K*Math.pow(2,rt-1)*Math.pow(2,M),te=0));M>=8;G[j+nt]=pe&255,nt+=Ct,pe/=256,M-=8);for(te=te<<M|pe,le+=M;le>0;G[j+nt]=te&255,nt+=Ct,te/=256,le-=8);G[j+nt-Ct]|=jt*128}},7375:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0});var G=Symbol.for("INJECTION");function K(te,pe,Ce,le){function Ie(){return le&&!Reflect.hasMetadata(G,this,pe)&&Reflect.defineMetadata(G,Ce(),this,pe),Reflect.hasMetadata(G,this,pe)?Reflect.getMetadata(G,this,pe):Ce()}function rt(xt){Reflect.defineMetadata(G,xt,this,pe)}Object.defineProperty(te,pe,{configurable:!0,enumerable:!0,get:Ie,set:rt})}function j(te,pe){return function(Ce){return function(le,Ie){var rt=function(){return te.get(Ce)};K(le,Ie,rt,pe)}}}_e.makePropertyInjectDecorator=j;function P(te,pe){return function(Ce,le){return function(Ie,rt){var xt=function(){return te.getNamed(Ce,le)};K(Ie,rt,xt,pe)}}}_e.makePropertyInjectNamedDecorator=P;function M(te,pe){return function(Ce,le,Ie){return function(rt,xt){var nt=function(){return te.getTagged(Ce,le,Ie)};K(rt,xt,nt,pe)}}}_e.makePropertyInjectTaggedDecorator=M;function ee(te,pe){return function(Ce){return function(le,Ie){var rt=function(){return te.getAll(Ce)};K(le,Ie,rt,pe)}}}_e.makePropertyMultiInjectDecorator=ee},84879:function(Ue,_e,G){"use strict";var K;K={value:!0};var j=G(7375);function P(M,ee){ee===void 0&&(ee=!0);var te=j.makePropertyInjectDecorator(M,ee),pe=j.makePropertyInjectNamedDecorator(M,ee),Ce=j.makePropertyInjectTaggedDecorator(M,ee),le=j.makePropertyMultiInjectDecorator(M,ee);return{lazyInject:te,lazyInjectNamed:pe,lazyInjectTagged:Ce,lazyMultiInject:le}}_e.Z=P},99934:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.tagProperty=_e.tagParameter=_e.decorate=void 0;var K=G(16674),j=G(6867);function P(le,Ie,rt,xt){var nt=j.TAGGED;ee(nt,le,Ie,xt,rt)}_e.tagParameter=P;function M(le,Ie,rt){var xt=j.TAGGED_PROP;ee(xt,le.constructor,Ie,rt)}_e.tagProperty=M;function ee(le,Ie,rt,xt,nt){var Ct={},jt=typeof nt=="number",Vt=nt!==void 0&&jt?nt.toString():rt;if(jt&&rt!==void 0)throw new Error(K.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(le,Ie)&&(Ct=Reflect.getMetadata(le,Ie));var Rt=Ct[Vt];if(!Array.isArray(Rt))Rt=[];else for(var hr=0,er=Rt;hr<er.length;hr++){var gn=er[hr];if(gn.key===xt.key)throw new Error(K.DUPLICATED_METADATA+" "+gn.key.toString())}Rt.push(xt),Ct[Vt]=Rt,Reflect.defineMetadata(le,Ct,Ie)}function te(le,Ie){Reflect.decorate(le,Ie)}function pe(le,Ie){return function(rt,xt){Ie(rt,xt,le)}}function Ce(le,Ie,rt){typeof rt=="number"?te([pe(rt,le)],Ie):typeof rt=="string"?Reflect.decorate([le],Ie,rt):te([le],Ie)}_e.decorate=Ce},5744:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.inject=_e.LazyServiceIdentifer=void 0;var K=G(16674),j=G(6867),P=G(47738),M=G(99934),ee=function(){function pe(Ce){this._cb=Ce}return pe.prototype.unwrap=function(){return this._cb()},pe}();_e.LazyServiceIdentifer=ee;function te(pe){return function(Ce,le,Ie){if(pe===void 0)throw new Error(K.UNDEFINED_INJECT_ANNOTATION(Ce.name));var rt=new P.Metadata(j.INJECT_TAG,pe);typeof Ie=="number"?M.tagParameter(Ce,le,Ie,rt):M.tagProperty(Ce,le,rt)}}_e.inject=te},64315:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.injectable=void 0;var K=G(16674),j=G(6867);function P(){return function(M){if(Reflect.hasOwnMetadata(j.PARAM_TYPES,M))throw new Error(K.DUPLICATED_INJECTABLE_DECORATOR);var ee=Reflect.getMetadata(j.DESIGN_PARAM_TYPES,M)||[];return Reflect.defineMetadata(j.PARAM_TYPES,ee,M),M}}_e.injectable=P},71693:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.multiInject=void 0;var K=G(6867),j=G(47738),P=G(99934);function M(ee){return function(te,pe,Ce){var le=new j.Metadata(K.MULTI_INJECT_TAG,ee);typeof Ce=="number"?P.tagParameter(te,pe,Ce,le):P.tagProperty(te,pe,le)}}_e.multiInject=M},38085:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.named=void 0;var K=G(6867),j=G(47738),P=G(99934);function M(ee){return function(te,pe,Ce){var le=new j.Metadata(K.NAMED_TAG,ee);typeof Ce=="number"?P.tagParameter(te,pe,Ce,le):P.tagProperty(te,pe,le)}}_e.named=M},6515:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.optional=void 0;var K=G(6867),j=G(47738),P=G(99934);function M(){return function(ee,te,pe){var Ce=new j.Metadata(K.OPTIONAL_TAG,!0);typeof pe=="number"?P.tagParameter(ee,te,pe,Ce):P.tagProperty(ee,te,Ce)}}_e.optional=M},7014:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.postConstruct=void 0;var K=G(16674),j=G(6867),P=G(47738);function M(){return function(ee,te,pe){var Ce=new P.Metadata(j.POST_CONSTRUCT,te);if(Reflect.hasOwnMetadata(j.POST_CONSTRUCT,ee.constructor))throw new Error(K.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(j.POST_CONSTRUCT,Ce,ee.constructor)}}_e.postConstruct=M},32052:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.tagged=void 0;var K=G(47738),j=G(99934);function P(M,ee){return function(te,pe,Ce){var le=new K.Metadata(M,ee);typeof Ce=="number"?j.tagParameter(te,pe,Ce,le):j.tagProperty(te,pe,le)}}_e.tagged=P},55638:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.targetName=void 0;var K=G(6867),j=G(47738),P=G(99934);function M(ee){return function(te,pe,Ce){var le=new j.Metadata(K.NAME_TAG,ee);P.tagParameter(te,pe,Ce,le)}}_e.targetName=M},86757:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.unmanaged=void 0;var K=G(6867),j=G(47738),P=G(99934);function M(){return function(ee,te,pe){var Ce=new j.Metadata(K.UNMANAGED_TAG,!0);P.tagParameter(ee,te,pe,Ce)}}_e.unmanaged=M},44290:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Binding=void 0;var K=G(28421),j=G(37791),P=function(){function M(ee,te){this.id=j.id(),this.activated=!1,this.serviceIdentifier=ee,this.scope=te,this.type=K.BindingTypeEnum.Invalid,this.constraint=function(pe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return M.prototype.clone=function(){var ee=new M(this.serviceIdentifier,this.scope);return ee.activated=ee.scope===K.BindingScopeEnum.Singleton?this.activated:!1,ee.implementationType=this.implementationType,ee.dynamicValue=this.dynamicValue,ee.scope=this.scope,ee.type=this.type,ee.factory=this.factory,ee.provider=this.provider,ee.constraint=this.constraint,ee.onActivation=this.onActivation,ee.cache=this.cache,ee},M}();_e.Binding=P},23184:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingCount=void 0;var G={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};_e.BindingCount=G},16674:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.STACK_OVERFLOW=_e.CIRCULAR_DEPENDENCY_IN_FACTORY=_e.POST_CONSTRUCT_ERROR=_e.MULTIPLE_POST_CONSTRUCT_METHODS=_e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=_e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=_e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=_e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=_e.ARGUMENTS_LENGTH_MISMATCH=_e.INVALID_DECORATOR_OPERATION=_e.INVALID_TO_SELF_VALUE=_e.INVALID_FUNCTION_BINDING=_e.INVALID_MIDDLEWARE_RETURN=_e.NO_MORE_SNAPSHOTS_AVAILABLE=_e.INVALID_BINDING_TYPE=_e.NOT_IMPLEMENTED=_e.CIRCULAR_DEPENDENCY=_e.UNDEFINED_INJECT_ANNOTATION=_e.MISSING_INJECT_ANNOTATION=_e.MISSING_INJECTABLE_ANNOTATION=_e.NOT_REGISTERED=_e.CANNOT_UNBIND=_e.AMBIGUOUS_MATCH=_e.KEY_NOT_FOUND=_e.NULL_ARGUMENT=_e.DUPLICATED_METADATA=_e.DUPLICATED_INJECTABLE_DECORATOR=void 0,_e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",_e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",_e.NULL_ARGUMENT="NULL argument",_e.KEY_NOT_FOUND="Key Not Found",_e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",_e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",_e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",_e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",_e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var G=function(M){return"@inject called with undefined this could mean that the class "+M+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};_e.UNDEFINED_INJECT_ANNOTATION=G,_e.CIRCULAR_DEPENDENCY="Circular dependency found:",_e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",_e.INVALID_BINDING_TYPE="Invalid binding type:",_e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",_e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",_e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",_e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",_e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var K=function(){for(var M=[],ee=0;ee<arguments.length;ee++)M[ee]=arguments[ee];return"The number of constructor arguments in the derived class "+(M[0]+" must be >= than the number of constructor arguments of its base class.")};_e.ARGUMENTS_LENGTH_MISMATCH=K,_e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",_e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",_e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",_e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",_e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var j=function(){for(var M=[],ee=0;ee<arguments.length;ee++)M[ee]=arguments[ee];return"@postConstruct error in class "+M[0]+": "+M[1]};_e.POST_CONSTRUCT_ERROR=j;var P=function(){for(var M=[],ee=0;ee<arguments.length;ee++)M[ee]=arguments[ee];return"It looks like there is a circular dependency "+("in one of the '"+M[0]+"' bindings. Please investigate bindings with")+("service identifier '"+M[1]+"'.")};_e.CIRCULAR_DEPENDENCY_IN_FACTORY=P,_e.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.TargetTypeEnum=_e.BindingTypeEnum=_e.BindingScopeEnum=void 0;var G={Request:"Request",Singleton:"Singleton",Transient:"Transient"};_e.BindingScopeEnum=G;var K={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};_e.BindingTypeEnum=K;var j={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};_e.TargetTypeEnum=j},6867:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.NON_CUSTOM_TAG_KEYS=_e.POST_CONSTRUCT=_e.DESIGN_PARAM_TYPES=_e.PARAM_TYPES=_e.TAGGED_PROP=_e.TAGGED=_e.MULTI_INJECT_TAG=_e.INJECT_TAG=_e.OPTIONAL_TAG=_e.UNMANAGED_TAG=_e.NAME_TAG=_e.NAMED_TAG=void 0,_e.NAMED_TAG="named",_e.NAME_TAG="name",_e.UNMANAGED_TAG="unmanaged",_e.OPTIONAL_TAG="optional",_e.INJECT_TAG="inject",_e.MULTI_INJECT_TAG="multi_inject",_e.TAGGED="inversify:tagged",_e.TAGGED_PROP="inversify:tagged_props",_e.PARAM_TYPES="inversify:paramtypes",_e.DESIGN_PARAM_TYPES="design:paramtypes",_e.POST_CONSTRUCT="post_construct";function G(){return[_e.INJECT_TAG,_e.MULTI_INJECT_TAG,_e.NAME_TAG,_e.UNMANAGED_TAG,_e.NAMED_TAG,_e.OPTIONAL_TAG]}_e.NON_CUSTOM_TAG_KEYS=G()},51389:function(Ue,_e,G){"use strict";var K=this&&this.__awaiter||function(Rt,hr,er,gn){function Rr(vn){return vn instanceof er?vn:new er(function(rr){rr(vn)})}return new(er||(er=Promise))(function(vn,rr){function Jt(Br){try{or(gn.next(Br))}catch(an){rr(an)}}function br(Br){try{or(gn.throw(Br))}catch(an){rr(an)}}function or(Br){Br.done?vn(Br.value):Rr(Br.value).then(Jt,br)}or((gn=gn.apply(Rt,hr||[])).next())})},j=this&&this.__generator||function(Rt,hr){var er={label:0,sent:function(){if(vn[0]&1)throw vn[1];return vn[1]},trys:[],ops:[]},gn,Rr,vn,rr;return rr={next:Jt(0),throw:Jt(1),return:Jt(2)},typeof Symbol=="function"&&(rr[Symbol.iterator]=function(){return this}),rr;function Jt(or){return function(Br){return br([or,Br])}}function br(or){if(gn)throw new TypeError("Generator is already executing.");for(;er;)try{if(gn=1,Rr&&(vn=or[0]&2?Rr.return:or[0]?Rr.throw||((vn=Rr.return)&&vn.call(Rr),0):Rr.next)&&!(vn=vn.call(Rr,or[1])).done)return vn;switch(Rr=0,vn&&(or=[or[0]&2,vn.value]),or[0]){case 0:case 1:vn=or;break;case 4:return er.label++,{value:or[1],done:!1};case 5:er.label++,Rr=or[1],or=[0];continue;case 7:or=er.ops.pop(),er.trys.pop();continue;default:if(vn=er.trys,!(vn=vn.length>0&&vn[vn.length-1])&&(or[0]===6||or[0]===2)){er=0;continue}if(or[0]===3&&(!vn||or[1]>vn[0]&&or[1]<vn[3])){er.label=or[1];break}if(or[0]===6&&er.label<vn[1]){er.label=vn[1],vn=or;break}if(vn&&er.label<vn[2]){er.label=vn[2],er.ops.push(or);break}vn[2]&&er.ops.pop(),er.trys.pop();continue}or=hr.call(Rt,er)}catch(Br){or=[6,Br],Rr=0}finally{gn=vn=0}if(or[0]&5)throw or[1];return{value:or[0]?or[1]:void 0,done:!0}}},P=this&&this.__spreadArray||function(Rt,hr){for(var er=0,gn=hr.length,Rr=Rt.length;er<gn;er++,Rr++)Rt[Rr]=hr[er];return Rt};Object.defineProperty(_e,"__esModule",{value:!0}),_e.Container=void 0;var M=G(44290),ee=G(16674),te=G(28421),pe=G(6867),Ce=G(51377),le=G(86311),Ie=G(31927),rt=G(51860),xt=G(37791),nt=G(55800),Ct=G(85700),jt=G(80175),Vt=function(){function Rt(hr){this._appliedMiddleware=[];var er=hr||{};if(typeof er!="object")throw new Error(""+ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(er.defaultScope===void 0)er.defaultScope=te.BindingScopeEnum.Transient;else if(er.defaultScope!==te.BindingScopeEnum.Singleton&&er.defaultScope!==te.BindingScopeEnum.Transient&&er.defaultScope!==te.BindingScopeEnum.Request)throw new Error(""+ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(er.autoBindInjectable===void 0)er.autoBindInjectable=!1;else if(typeof er.autoBindInjectable!="boolean")throw new Error(""+ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(er.skipBaseClassChecks===void 0)er.skipBaseClassChecks=!1;else if(typeof er.skipBaseClassChecks!="boolean")throw new Error(""+ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:er.autoBindInjectable,defaultScope:er.defaultScope,skipBaseClassChecks:er.skipBaseClassChecks},this.id=xt.id(),this._bindingDictionary=new jt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ce.MetadataReader}return Rt.merge=function(hr,er){for(var gn=[],Rr=2;Rr<arguments.length;Rr++)gn[Rr-2]=arguments[Rr];var vn=new Rt,rr=P([hr,er],gn).map(function(or){return le.getBindingDictionary(or)}),Jt=le.getBindingDictionary(vn);function br(or,Br){or.traverse(function(an,ot){ot.forEach(function(Dt){Br.add(Dt.serviceIdentifier,Dt.clone())})})}return rr.forEach(function(or){br(or,Jt)}),vn},Rt.prototype.load=function(){for(var hr=[],er=0;er<arguments.length;er++)hr[er]=arguments[er];for(var gn=this._getContainerModuleHelpersFactory(),Rr=0,vn=hr;Rr<vn.length;Rr++){var rr=vn[Rr],Jt=gn(rr.id);rr.registry(Jt.bindFunction,Jt.unbindFunction,Jt.isboundFunction,Jt.rebindFunction)}},Rt.prototype.loadAsync=function(){for(var hr=[],er=0;er<arguments.length;er++)hr[er]=arguments[er];return K(this,void 0,void 0,function(){var gn,Rr,vn,rr,Jt;return j(this,function(br){switch(br.label){case 0:gn=this._getContainerModuleHelpersFactory(),Rr=0,vn=hr,br.label=1;case 1:return Rr<vn.length?(rr=vn[Rr],Jt=gn(rr.id),[4,rr.registry(Jt.bindFunction,Jt.unbindFunction,Jt.isboundFunction,Jt.rebindFunction)]):[3,4];case 2:br.sent(),br.label=3;case 3:return Rr++,[3,1];case 4:return[2]}})})},Rt.prototype.unload=function(){for(var hr=this,er=[],gn=0;gn<arguments.length;gn++)er[gn]=arguments[gn];var Rr=function(vn){return function(rr){return rr.moduleId===vn}};er.forEach(function(vn){var rr=Rr(vn.id);hr._bindingDictionary.removeByCondition(rr)})},Rt.prototype.bind=function(hr){var er=this.options.defaultScope||te.BindingScopeEnum.Transient,gn=new M.Binding(hr,er);return this._bindingDictionary.add(hr,gn),new rt.BindingToSyntax(gn)},Rt.prototype.rebind=function(hr){return this.unbind(hr),this.bind(hr)},Rt.prototype.unbind=function(hr){try{this._bindingDictionary.remove(hr)}catch(er){throw new Error(ee.CANNOT_UNBIND+" "+nt.getServiceIdentifierAsString(hr))}},Rt.prototype.unbindAll=function(){this._bindingDictionary=new jt.Lookup},Rt.prototype.isBound=function(hr){var er=this._bindingDictionary.hasKey(hr);return!er&&this.parent&&(er=this.parent.isBound(hr)),er},Rt.prototype.isBoundNamed=function(hr,er){return this.isBoundTagged(hr,pe.NAMED_TAG,er)},Rt.prototype.isBoundTagged=function(hr,er,gn){var Rr=!1;if(this._bindingDictionary.hasKey(hr)){var vn=this._bindingDictionary.get(hr),rr=le.createMockRequest(this,hr,er,gn);Rr=vn.some(function(Jt){return Jt.constraint(rr)})}return!Rr&&this.parent&&(Rr=this.parent.isBoundTagged(hr,er,gn)),Rr},Rt.prototype.snapshot=function(){this._snapshots.push(Ct.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Rt.prototype.restore=function(){var hr=this._snapshots.pop();if(hr===void 0)throw new Error(ee.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=hr.bindings,this._middleware=hr.middleware},Rt.prototype.createChild=function(hr){var er=new Rt(hr||this.options);return er.parent=this,er},Rt.prototype.applyMiddleware=function(){for(var hr=[],er=0;er<arguments.length;er++)hr[er]=arguments[er];this._appliedMiddleware=this._appliedMiddleware.concat(hr);var gn=this._middleware?this._middleware:this._planAndResolve();this._middleware=hr.reduce(function(Rr,vn){return vn(Rr)},gn)},Rt.prototype.applyCustomMetadataReader=function(hr){this._metadataReader=hr},Rt.prototype.get=function(hr){return this._get(!1,!1,te.TargetTypeEnum.Variable,hr)},Rt.prototype.getTagged=function(hr,er,gn){return this._get(!1,!1,te.TargetTypeEnum.Variable,hr,er,gn)},Rt.prototype.getNamed=function(hr,er){return this.getTagged(hr,pe.NAMED_TAG,er)},Rt.prototype.getAll=function(hr){return this._get(!0,!0,te.TargetTypeEnum.Variable,hr)},Rt.prototype.getAllTagged=function(hr,er,gn){return this._get(!1,!0,te.TargetTypeEnum.Variable,hr,er,gn)},Rt.prototype.getAllNamed=function(hr,er){return this.getAllTagged(hr,pe.NAMED_TAG,er)},Rt.prototype.resolve=function(hr){var er=this.createChild();return er.bind(hr).toSelf(),this._appliedMiddleware.forEach(function(gn){er.applyMiddleware(gn)}),er.get(hr)},Rt.prototype._getContainerModuleHelpersFactory=function(){var hr=this,er=function(Jt,br){Jt._binding.moduleId=br},gn=function(Jt){return function(br){var or=hr.bind.bind(hr),Br=or(br);return er(Br,Jt),Br}},Rr=function(Jt){return function(br){var or=hr.unbind.bind(hr);or(br)}},vn=function(Jt){return function(br){var or=hr.isBound.bind(hr);return or(br)}},rr=function(Jt){return function(br){var or=hr.rebind.bind(hr),Br=or(br);return er(Br,Jt),Br}};return function(Jt){return{bindFunction:gn(Jt),isboundFunction:vn(Jt),rebindFunction:rr(Jt),unbindFunction:Rr(Jt)}}},Rt.prototype._get=function(hr,er,gn,Rr,vn,rr){var Jt=null,br={avoidConstraints:hr,contextInterceptor:function(or){return or},isMultiInject:er,key:vn,serviceIdentifier:Rr,targetType:gn,value:rr};if(this._middleware){if(Jt=this._middleware(br),Jt==null)throw new Error(ee.INVALID_MIDDLEWARE_RETURN)}else Jt=this._planAndResolve()(br);return Jt},Rt.prototype._planAndResolve=function(){var hr=this;return function(er){var gn=le.plan(hr._metadataReader,hr,er.isMultiInject,er.targetType,er.serviceIdentifier,er.key,er.value,er.avoidConstraints);gn=er.contextInterceptor(gn);var Rr=Ie.resolve(gn);return Rr}},Rt}();_e.Container=Vt},33244:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.AsyncContainerModule=_e.ContainerModule=void 0;var K=G(37791),j=function(){function M(ee){this.id=K.id(),this.registry=ee}return M}();_e.ContainerModule=j;var P=function(){function M(ee){this.id=K.id(),this.registry=ee}return M}();_e.AsyncContainerModule=P},85700:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.ContainerSnapshot=void 0;var G=function(){function K(){}return K.of=function(j,P){var M=new K;return M.bindings=j,M.middleware=P,M},K}();_e.ContainerSnapshot=G},80175:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Lookup=void 0;var K=G(16674),j=function(){function P(){this._map=new Map}return P.prototype.getMap=function(){return this._map},P.prototype.add=function(M,ee){if(M==null)throw new Error(K.NULL_ARGUMENT);if(ee==null)throw new Error(K.NULL_ARGUMENT);var te=this._map.get(M);te!==void 0?(te.push(ee),this._map.set(M,te)):this._map.set(M,[ee])},P.prototype.get=function(M){if(M==null)throw new Error(K.NULL_ARGUMENT);var ee=this._map.get(M);if(ee!==void 0)return ee;throw new Error(K.KEY_NOT_FOUND)},P.prototype.remove=function(M){if(M==null)throw new Error(K.NULL_ARGUMENT);if(!this._map.delete(M))throw new Error(K.KEY_NOT_FOUND)},P.prototype.removeByCondition=function(M){var ee=this;this._map.forEach(function(te,pe){var Ce=te.filter(function(le){return!M(le)});Ce.length>0?ee._map.set(pe,Ce):ee._map.delete(pe)})},P.prototype.hasKey=function(M){if(M==null)throw new Error(K.NULL_ARGUMENT);return this._map.has(M)},P.prototype.clone=function(){var M=new P;return this._map.forEach(function(ee,te){ee.forEach(function(pe){return M.add(te,pe.clone())})}),M},P.prototype.traverse=function(M){this._map.forEach(function(ee,te){M(te,ee)})},P}();_e.Lookup=j},86700:function(Ue,_e,G){"use strict";var K;K={value:!0},K=K=K=K=K=K=_e.GW=K=K=_e.zY=K=K=K=K=K=_e.f3=K=K=_e.b2=K=K=K=K=K=_e.W2=K=void 0;var j=G(6867);K=j;var P=G(51389);Object.defineProperty(_e,"W2",{enumerable:!0,get:function(){return P.Container}});var M=G(28421);K={enumerable:!0,get:function(){return M.BindingScopeEnum}},K={enumerable:!0,get:function(){return M.BindingTypeEnum}},K={enumerable:!0,get:function(){return M.TargetTypeEnum}};var ee=G(33244);K={enumerable:!0,get:function(){return ee.AsyncContainerModule}},K={enumerable:!0,get:function(){return ee.ContainerModule}};var te=G(64315);Object.defineProperty(_e,"b2",{enumerable:!0,get:function(){return te.injectable}});var pe=G(32052);K={enumerable:!0,get:function(){return pe.tagged}};var Ce=G(38085);K={enumerable:!0,get:function(){return Ce.named}};var le=G(5744);Object.defineProperty(_e,"f3",{enumerable:!0,get:function(){return le.inject}}),K={enumerable:!0,get:function(){return le.LazyServiceIdentifer}};var Ie=G(6515);K={enumerable:!0,get:function(){return Ie.optional}};var rt=G(86757);K={enumerable:!0,get:function(){return rt.unmanaged}};var xt=G(71693);K={enumerable:!0,get:function(){return xt.multiInject}};var nt=G(55638);K={enumerable:!0,get:function(){return nt.targetName}};var Ct=G(7014);Object.defineProperty(_e,"zY",{enumerable:!0,get:function(){return Ct.postConstruct}});var jt=G(51377);K={enumerable:!0,get:function(){return jt.MetadataReader}};var Vt=G(37791);K={enumerable:!0,get:function(){return Vt.id}};var Rt=G(99934);Object.defineProperty(_e,"GW",{enumerable:!0,get:function(){return Rt.decorate}});var hr=G(80758);K={enumerable:!0,get:function(){return hr.traverseAncerstors}},K={enumerable:!0,get:function(){return hr.taggedConstraint}},K={enumerable:!0,get:function(){return hr.namedConstraint}},K={enumerable:!0,get:function(){return hr.typeConstraint}};var er=G(55800);K={enumerable:!0,get:function(){return er.getServiceIdentifierAsString}};var gn=G(70600);K={enumerable:!0,get:function(){return gn.multiBindToService}}},95228:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Context=void 0;var K=G(37791),j=function(){function P(M){this.id=K.id(),this.container=M}return P.prototype.addPlan=function(M){this.plan=M},P.prototype.setCurrentRequest=function(M){this.currentRequest=M},P}();_e.Context=j},47738:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Metadata=void 0;var K=G(6867),j=function(){function P(M,ee){this.key=M,this.value=ee}return P.prototype.toString=function(){return this.key===K.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},P}();_e.Metadata=j},51377:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.MetadataReader=void 0;var K=G(6867),j=function(){function P(){}return P.prototype.getConstructorMetadata=function(M){var ee=Reflect.getMetadata(K.PARAM_TYPES,M),te=Reflect.getMetadata(K.TAGGED,M);return{compilerGeneratedMetadata:ee,userGeneratedMetadata:te||{}}},P.prototype.getPropertiesMetadata=function(M){var ee=Reflect.getMetadata(K.TAGGED_PROP,M)||[];return ee},P}();_e.MetadataReader=j},55314:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Plan=void 0;var G=function(){function K(j,P){this.parentContext=j,this.rootRequest=P}return K}();_e.Plan=G},86311:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.getBindingDictionary=_e.createMockRequest=_e.plan=void 0;var K=G(23184),j=G(16674),P=G(28421),M=G(6867),ee=G(85265),te=G(55800),pe=G(95228),Ce=G(47738),le=G(55314),Ie=G(6e3),rt=G(6748),xt=G(18924);function nt(Rr){return Rr._bindingDictionary}_e.getBindingDictionary=nt;function Ct(Rr,vn,rr,Jt,br,or){var Br=Rr?M.MULTI_INJECT_TAG:M.INJECT_TAG,an=new Ce.Metadata(Br,rr),ot=new xt.Target(vn,Jt,rr,an);if(br!==void 0){var Dt=new Ce.Metadata(br,or);ot.metadata.push(Dt)}return ot}function jt(Rr,vn,rr,Jt,br){var or=hr(rr.container,br.serviceIdentifier),Br=[];return or.length===K.BindingCount.NoBindingsAvailable&&rr.container.options.autoBindInjectable&&typeof br.serviceIdentifier=="function"&&Rr.getConstructorMetadata(br.serviceIdentifier).compilerGeneratedMetadata&&(rr.container.bind(br.serviceIdentifier).toSelf(),or=hr(rr.container,br.serviceIdentifier)),vn?Br=or:Br=or.filter(function(an){var ot=new rt.Request(an.serviceIdentifier,rr,Jt,an,br);return an.constraint(ot)}),Vt(br.serviceIdentifier,Br,br,rr.container),Br}function Vt(Rr,vn,rr,Jt){switch(vn.length){case K.BindingCount.NoBindingsAvailable:if(rr.isOptional())return vn;var br=te.getServiceIdentifierAsString(Rr),or=j.NOT_REGISTERED;throw or+=te.listMetadataForTarget(br,rr),or+=te.listRegisteredBindingsForServiceIdentifier(Jt,br,hr),new Error(or);case K.BindingCount.OnlyOneBindingAvailable:if(!rr.isArray())return vn;case K.BindingCount.MultipleBindingsAvailable:default:if(rr.isArray())return vn;var br=te.getServiceIdentifierAsString(Rr),or=j.AMBIGUOUS_MATCH+" "+br;throw or+=te.listRegisteredBindingsForServiceIdentifier(Jt,br,hr),new Error(or)}}function Rt(Rr,vn,rr,Jt,br,or){var Br,an;if(br===null){Br=jt(Rr,vn,Jt,null,or),an=new rt.Request(rr,Jt,null,Br,or);var ot=new le.Plan(Jt,an);Jt.addPlan(ot)}else Br=jt(Rr,vn,Jt,br,or),an=br.addChildRequest(or.serviceIdentifier,Br,or);Br.forEach(function(Dt){var Ee=null;if(or.isArray())Ee=an.addChildRequest(Dt.serviceIdentifier,Dt,or);else{if(Dt.cache)return;Ee=an}if(Dt.type===P.BindingTypeEnum.Instance&&Dt.implementationType!==null){var Bt=Ie.getDependencies(Rr,Dt.implementationType);if(!Jt.container.options.skipBaseClassChecks){var Ot=Ie.getBaseClassDependencyCount(Rr,Dt.implementationType);if(Bt.length<Ot){var Pr=j.ARGUMENTS_LENGTH_MISMATCH(Ie.getFunctionName(Dt.implementationType));throw new Error(Pr)}}Bt.forEach(function(Fr){Rt(Rr,!1,Fr.serviceIdentifier,Jt,Ee,Fr)})}})}function hr(Rr,vn){var rr=[],Jt=nt(Rr);return Jt.hasKey(vn)?rr=Jt.get(vn):Rr.parent!==null&&(rr=hr(Rr.parent,vn)),rr}function er(Rr,vn,rr,Jt,br,or,Br,an){an===void 0&&(an=!1);var ot=new pe.Context(vn),Dt=Ct(rr,Jt,br,"",or,Br);try{return Rt(Rr,an,br,ot,null,Dt),ot}catch(Ee){throw ee.isStackOverflowExeption(Ee)&&ot.plan&&te.circularDependencyToException(ot.plan.rootRequest),Ee}}_e.plan=er;function gn(Rr,vn,rr,Jt){var br=new xt.Target(P.TargetTypeEnum.Variable,"",vn,new Ce.Metadata(rr,Jt)),or=new pe.Context(Rr),Br=new rt.Request(vn,or,null,[],br);return Br}_e.createMockRequest=gn},88460:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.QueryableString=void 0;var G=function(){function K(j){this.str=j}return K.prototype.startsWith=function(j){return this.str.indexOf(j)===0},K.prototype.endsWith=function(j){var P="",M=j.split("").reverse().join("");return P=this.str.split("").reverse().join(""),this.startsWith.call({str:P},M)},K.prototype.contains=function(j){return this.str.indexOf(j)!==-1},K.prototype.equals=function(j){return this.str===j},K.prototype.value=function(){return this.str},K}();_e.QueryableString=G},6e3:function(Ue,_e,G){"use strict";var K=this&&this.__spreadArray||function(jt,Vt){for(var Rt=0,hr=Vt.length,er=jt.length;Rt<hr;Rt++,er++)jt[er]=Vt[Rt];return jt};Object.defineProperty(_e,"__esModule",{value:!0}),_e.getFunctionName=_e.getBaseClassDependencyCount=_e.getDependencies=void 0;var j=G(5744),P=G(16674),M=G(28421),ee=G(6867),te=G(55800);Object.defineProperty(_e,"getFunctionName",{enumerable:!0,get:function(){return te.getFunctionName}});var pe=G(18924);function Ce(jt,Vt){var Rt=te.getFunctionName(Vt),hr=le(jt,Rt,Vt,!1);return hr}_e.getDependencies=Ce;function le(jt,Vt,Rt,hr){var er=jt.getConstructorMetadata(Rt),gn=er.compilerGeneratedMetadata;if(gn===void 0){var Rr=P.MISSING_INJECTABLE_ANNOTATION+" "+Vt+".";throw new Error(Rr)}var vn=er.userGeneratedMetadata,rr=Object.keys(vn),Jt=Rt.length===0&&rr.length>0,br=rr.length>Rt.length,or=Jt||br?rr.length:Rt.length,Br=rt(hr,Vt,gn,vn,or),an=xt(jt,Rt),ot=K(K([],Br),an);return ot}function Ie(jt,Vt,Rt,hr,er){var gn=er[jt.toString()]||[],Rr=Ct(gn),vn=Rr.unmanaged!==!0,rr=hr[jt],Jt=Rr.inject||Rr.multiInject;if(rr=Jt||rr,rr instanceof j.LazyServiceIdentifer&&(rr=rr.unwrap()),vn){var br=rr===Object,or=rr===Function,Br=rr===void 0,an=br||or||Br;if(!Vt&&an){var ot=P.MISSING_INJECT_ANNOTATION+" argument "+jt+" in class "+Rt+".";throw new Error(ot)}var Dt=new pe.Target(M.TargetTypeEnum.ConstructorArgument,Rr.targetName,rr);return Dt.metadata=gn,Dt}return null}function rt(jt,Vt,Rt,hr,er){for(var gn=[],Rr=0;Rr<er;Rr++){var vn=Rr,rr=Ie(vn,jt,Vt,Rt,hr);rr!==null&&gn.push(rr)}return gn}function xt(jt,Vt){for(var Rt=jt.getPropertiesMetadata(Vt),hr=[],er=Object.keys(Rt),gn=0,Rr=er;gn<Rr.length;gn++){var vn=Rr[gn],rr=Rt[vn],Jt=Ct(Rt[vn]),br=Jt.targetName||vn,or=Jt.inject||Jt.multiInject,Br=new pe.Target(M.TargetTypeEnum.ClassProperty,br,or);Br.metadata=rr,hr.push(Br)}var an=Object.getPrototypeOf(Vt.prototype).constructor;if(an!==Object){var ot=xt(jt,an);hr=K(K([],hr),ot)}return hr}function nt(jt,Vt){var Rt=Object.getPrototypeOf(Vt.prototype).constructor;if(Rt!==Object){var hr=te.getFunctionName(Rt),er=le(jt,hr,Rt,!0),gn=er.map(function(rr){return rr.metadata.filter(function(Jt){return Jt.key===ee.UNMANAGED_TAG})}),Rr=[].concat.apply([],gn).length,vn=er.length-Rr;return vn>0?vn:nt(jt,Rt)}else return 0}_e.getBaseClassDependencyCount=nt;function Ct(jt){var Vt={};return jt.forEach(function(Rt){Vt[Rt.key.toString()]=Rt.value}),{inject:Vt[ee.INJECT_TAG],multiInject:Vt[ee.MULTI_INJECT_TAG],targetName:Vt[ee.NAME_TAG],unmanaged:Vt[ee.UNMANAGED_TAG]}}},6748:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Request=void 0;var K=G(37791),j=function(){function P(M,ee,te,pe,Ce){this.id=K.id(),this.serviceIdentifier=M,this.parentContext=ee,this.parentRequest=te,this.target=Ce,this.childRequests=[],this.bindings=Array.isArray(pe)?pe:[pe],this.requestScope=te===null?new Map:null}return P.prototype.addChildRequest=function(M,ee,te){var pe=new P(M,this.parentContext,this,ee,te);return this.childRequests.push(pe),pe},P}();_e.Request=j},18924:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Target=void 0;var K=G(6867),j=G(37791),P=G(47738),M=G(88460),ee=function(){function te(pe,Ce,le,Ie){this.id=j.id(),this.type=pe,this.serviceIdentifier=le,this.name=new M.QueryableString(Ce||""),this.metadata=new Array;var rt=null;typeof Ie=="string"?rt=new P.Metadata(K.NAMED_TAG,Ie):Ie instanceof P.Metadata&&(rt=Ie),rt!==null&&this.metadata.push(rt)}return te.prototype.hasTag=function(pe){for(var Ce=0,le=this.metadata;Ce<le.length;Ce++){var Ie=le[Ce];if(Ie.key===pe)return!0}return!1},te.prototype.isArray=function(){return this.hasTag(K.MULTI_INJECT_TAG)},te.prototype.matchesArray=function(pe){return this.matchesTag(K.MULTI_INJECT_TAG)(pe)},te.prototype.isNamed=function(){return this.hasTag(K.NAMED_TAG)},te.prototype.isTagged=function(){return this.metadata.some(function(pe){return K.NON_CUSTOM_TAG_KEYS.every(function(Ce){return pe.key!==Ce})})},te.prototype.isOptional=function(){return this.matchesTag(K.OPTIONAL_TAG)(!0)},te.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(pe){return pe.key===K.NAMED_TAG})[0]:null},te.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(pe){return K.NON_CUSTOM_TAG_KEYS.every(function(Ce){return pe.key!==Ce})}):null},te.prototype.matchesNamedTag=function(pe){return this.matchesTag(K.NAMED_TAG)(pe)},te.prototype.matchesTag=function(pe){var Ce=this;return function(le){for(var Ie=0,rt=Ce.metadata;Ie<rt.length;Ie++){var xt=rt[Ie];if(xt.key===pe&&xt.value===le)return!0}return!1}},te}();_e.Target=ee},52279:function(Ue,_e,G){"use strict";var K=this&&this.__spreadArray||function(le,Ie){for(var rt=0,xt=Ie.length,nt=le.length;rt<xt;rt++,nt++)le[nt]=Ie[rt];return le};Object.defineProperty(_e,"__esModule",{value:!0}),_e.resolveInstance=void 0;var j=G(16674),P=G(28421),M=G(6867);function ee(le,Ie,rt){var xt=Ie.filter(function(Ct){return Ct.target!==null&&Ct.target.type===P.TargetTypeEnum.ClassProperty}),nt=xt.map(rt);return xt.forEach(function(Ct,jt){var Vt="";Vt=Ct.target.name.value();var Rt=nt[jt];le[Vt]=Rt}),le}function te(le,Ie){return new(le.bind.apply(le,K([void 0],Ie)))}function pe(le,Ie){if(Reflect.hasMetadata(M.POST_CONSTRUCT,le)){var rt=Reflect.getMetadata(M.POST_CONSTRUCT,le);try{Ie[rt.value]()}catch(xt){throw new Error(j.POST_CONSTRUCT_ERROR(le.name,xt.message))}}}function Ce(le,Ie,rt){var xt=null;if(Ie.length>0){var nt=Ie.filter(function(jt){return jt.target!==null&&jt.target.type===P.TargetTypeEnum.ConstructorArgument}),Ct=nt.map(rt);xt=te(le,Ct),xt=ee(xt,Ie,rt)}else xt=new le;return pe(le,xt),xt}_e.resolveInstance=Ce},31927:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.resolve=void 0;var K=G(16674),j=G(28421),P=G(85265),M=G(55800),ee=G(52279),te=function(le,Ie,rt){try{return rt()}catch(xt){throw P.isStackOverflowExeption(xt)?new Error(K.CIRCULAR_DEPENDENCY_IN_FACTORY(le,Ie.toString())):xt}},pe=function(le){return function(Ie){Ie.parentContext.setCurrentRequest(Ie);var rt=Ie.bindings,xt=Ie.childRequests,nt=Ie.target&&Ie.target.isArray(),Ct=!Ie.parentRequest||!Ie.parentRequest.target||!Ie.target||!Ie.parentRequest.target.matchesArray(Ie.target.serviceIdentifier);if(nt&&Ct)return xt.map(function(gn){var Rr=pe(le);return Rr(gn)});var jt=null;if(Ie.target.isOptional()&&rt.length===0)return;var Vt=rt[0],Rt=Vt.scope===j.BindingScopeEnum.Singleton,hr=Vt.scope===j.BindingScopeEnum.Request;if(Rt&&Vt.activated)return Vt.cache;if(hr&&le!==null&&le.has(Vt.id))return le.get(Vt.id);if(Vt.type===j.BindingTypeEnum.ConstantValue)jt=Vt.cache,Vt.activated=!0;else if(Vt.type===j.BindingTypeEnum.Function)jt=Vt.cache,Vt.activated=!0;else if(Vt.type===j.BindingTypeEnum.Constructor)jt=Vt.implementationType;else if(Vt.type===j.BindingTypeEnum.DynamicValue&&Vt.dynamicValue!==null)jt=te("toDynamicValue",Vt.serviceIdentifier,function(){return Vt.dynamicValue(Ie.parentContext)});else if(Vt.type===j.BindingTypeEnum.Factory&&Vt.factory!==null)jt=te("toFactory",Vt.serviceIdentifier,function(){return Vt.factory(Ie.parentContext)});else if(Vt.type===j.BindingTypeEnum.Provider&&Vt.provider!==null)jt=te("toProvider",Vt.serviceIdentifier,function(){return Vt.provider(Ie.parentContext)});else if(Vt.type===j.BindingTypeEnum.Instance&&Vt.implementationType!==null)jt=ee.resolveInstance(Vt.implementationType,xt,pe(le));else{var er=M.getServiceIdentifierAsString(Ie.serviceIdentifier);throw new Error(K.INVALID_BINDING_TYPE+" "+er)}return typeof Vt.onActivation=="function"&&(jt=Vt.onActivation(Ie.parentContext,jt)),Rt&&(Vt.cache=jt,Vt.activated=!0),hr&&le!==null&&!le.has(Vt.id)&&le.set(Vt.id,jt),jt}};function Ce(le){var Ie=pe(le.plan.rootRequest.requestScope);return Ie(le.plan.rootRequest)}_e.resolve=Ce},83366:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingInSyntax=void 0;var K=G(28421),j=G(71325),P=function(){function M(ee){this._binding=ee}return M.prototype.inRequestScope=function(){return this._binding.scope=K.BindingScopeEnum.Request,new j.BindingWhenOnSyntax(this._binding)},M.prototype.inSingletonScope=function(){return this._binding.scope=K.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},M.prototype.inTransientScope=function(){return this._binding.scope=K.BindingScopeEnum.Transient,new j.BindingWhenOnSyntax(this._binding)},M}();_e.BindingInSyntax=P},99812:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingInWhenOnSyntax=void 0;var K=G(83366),j=G(51811),P=G(98370),M=function(){function ee(te){this._binding=te,this._bindingWhenSyntax=new P.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new j.BindingOnSyntax(this._binding),this._bindingInSyntax=new K.BindingInSyntax(te)}return ee.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},ee.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},ee.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},ee.prototype.when=function(te){return this._bindingWhenSyntax.when(te)},ee.prototype.whenTargetNamed=function(te){return this._bindingWhenSyntax.whenTargetNamed(te)},ee.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ee.prototype.whenTargetTagged=function(te,pe){return this._bindingWhenSyntax.whenTargetTagged(te,pe)},ee.prototype.whenInjectedInto=function(te){return this._bindingWhenSyntax.whenInjectedInto(te)},ee.prototype.whenParentNamed=function(te){return this._bindingWhenSyntax.whenParentNamed(te)},ee.prototype.whenParentTagged=function(te,pe){return this._bindingWhenSyntax.whenParentTagged(te,pe)},ee.prototype.whenAnyAncestorIs=function(te){return this._bindingWhenSyntax.whenAnyAncestorIs(te)},ee.prototype.whenNoAncestorIs=function(te){return this._bindingWhenSyntax.whenNoAncestorIs(te)},ee.prototype.whenAnyAncestorNamed=function(te){return this._bindingWhenSyntax.whenAnyAncestorNamed(te)},ee.prototype.whenAnyAncestorTagged=function(te,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(te,pe)},ee.prototype.whenNoAncestorNamed=function(te){return this._bindingWhenSyntax.whenNoAncestorNamed(te)},ee.prototype.whenNoAncestorTagged=function(te,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(te,pe)},ee.prototype.whenAnyAncestorMatches=function(te){return this._bindingWhenSyntax.whenAnyAncestorMatches(te)},ee.prototype.whenNoAncestorMatches=function(te){return this._bindingWhenSyntax.whenNoAncestorMatches(te)},ee.prototype.onActivation=function(te){return this._bindingOnSyntax.onActivation(te)},ee}();_e.BindingInWhenOnSyntax=M},51811:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingOnSyntax=void 0;var K=G(98370),j=function(){function P(M){this._binding=M}return P.prototype.onActivation=function(M){return this._binding.onActivation=M,new K.BindingWhenSyntax(this._binding)},P}();_e.BindingOnSyntax=j},51860:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingToSyntax=void 0;var K=G(16674),j=G(28421),P=G(99812),M=G(71325),ee=function(){function te(pe){this._binding=pe}return te.prototype.to=function(pe){return this._binding.type=j.BindingTypeEnum.Instance,this._binding.implementationType=pe,new P.BindingInWhenOnSyntax(this._binding)},te.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+K.INVALID_TO_SELF_VALUE);var pe=this._binding.serviceIdentifier;return this.to(pe)},te.prototype.toConstantValue=function(pe){return this._binding.type=j.BindingTypeEnum.ConstantValue,this._binding.cache=pe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=j.BindingScopeEnum.Singleton,new M.BindingWhenOnSyntax(this._binding)},te.prototype.toDynamicValue=function(pe){return this._binding.type=j.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=pe,this._binding.implementationType=null,new P.BindingInWhenOnSyntax(this._binding)},te.prototype.toConstructor=function(pe){return this._binding.type=j.BindingTypeEnum.Constructor,this._binding.implementationType=pe,this._binding.scope=j.BindingScopeEnum.Singleton,new M.BindingWhenOnSyntax(this._binding)},te.prototype.toFactory=function(pe){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=pe,this._binding.scope=j.BindingScopeEnum.Singleton,new M.BindingWhenOnSyntax(this._binding)},te.prototype.toFunction=function(pe){if(typeof pe!="function")throw new Error(K.INVALID_FUNCTION_BINDING);var Ce=this.toConstantValue(pe);return this._binding.type=j.BindingTypeEnum.Function,this._binding.scope=j.BindingScopeEnum.Singleton,Ce},te.prototype.toAutoFactory=function(pe){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=function(Ce){var le=function(){return Ce.container.get(pe)};return le},this._binding.scope=j.BindingScopeEnum.Singleton,new M.BindingWhenOnSyntax(this._binding)},te.prototype.toProvider=function(pe){return this._binding.type=j.BindingTypeEnum.Provider,this._binding.provider=pe,this._binding.scope=j.BindingScopeEnum.Singleton,new M.BindingWhenOnSyntax(this._binding)},te.prototype.toService=function(pe){this.toDynamicValue(function(Ce){return Ce.container.get(pe)})},te}();_e.BindingToSyntax=ee},71325:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingWhenOnSyntax=void 0;var K=G(51811),j=G(98370),P=function(){function M(ee){this._binding=ee,this._bindingWhenSyntax=new j.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new K.BindingOnSyntax(this._binding)}return M.prototype.when=function(ee){return this._bindingWhenSyntax.when(ee)},M.prototype.whenTargetNamed=function(ee){return this._bindingWhenSyntax.whenTargetNamed(ee)},M.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},M.prototype.whenTargetTagged=function(ee,te){return this._bindingWhenSyntax.whenTargetTagged(ee,te)},M.prototype.whenInjectedInto=function(ee){return this._bindingWhenSyntax.whenInjectedInto(ee)},M.prototype.whenParentNamed=function(ee){return this._bindingWhenSyntax.whenParentNamed(ee)},M.prototype.whenParentTagged=function(ee,te){return this._bindingWhenSyntax.whenParentTagged(ee,te)},M.prototype.whenAnyAncestorIs=function(ee){return this._bindingWhenSyntax.whenAnyAncestorIs(ee)},M.prototype.whenNoAncestorIs=function(ee){return this._bindingWhenSyntax.whenNoAncestorIs(ee)},M.prototype.whenAnyAncestorNamed=function(ee){return this._bindingWhenSyntax.whenAnyAncestorNamed(ee)},M.prototype.whenAnyAncestorTagged=function(ee,te){return this._bindingWhenSyntax.whenAnyAncestorTagged(ee,te)},M.prototype.whenNoAncestorNamed=function(ee){return this._bindingWhenSyntax.whenNoAncestorNamed(ee)},M.prototype.whenNoAncestorTagged=function(ee,te){return this._bindingWhenSyntax.whenNoAncestorTagged(ee,te)},M.prototype.whenAnyAncestorMatches=function(ee){return this._bindingWhenSyntax.whenAnyAncestorMatches(ee)},M.prototype.whenNoAncestorMatches=function(ee){return this._bindingWhenSyntax.whenNoAncestorMatches(ee)},M.prototype.onActivation=function(ee){return this._bindingOnSyntax.onActivation(ee)},M}();_e.BindingWhenOnSyntax=P},98370:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.BindingWhenSyntax=void 0;var K=G(51811),j=G(80758),P=function(){function M(ee){this._binding=ee}return M.prototype.when=function(ee){return this._binding.constraint=ee,new K.BindingOnSyntax(this._binding)},M.prototype.whenTargetNamed=function(ee){return this._binding.constraint=j.namedConstraint(ee),new K.BindingOnSyntax(this._binding)},M.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(ee){var te=ee.target!==null&&!ee.target.isNamed()&&!ee.target.isTagged();return te},new K.BindingOnSyntax(this._binding)},M.prototype.whenTargetTagged=function(ee,te){return this._binding.constraint=j.taggedConstraint(ee)(te),new K.BindingOnSyntax(this._binding)},M.prototype.whenInjectedInto=function(ee){return this._binding.constraint=function(te){return j.typeConstraint(ee)(te.parentRequest)},new K.BindingOnSyntax(this._binding)},M.prototype.whenParentNamed=function(ee){return this._binding.constraint=function(te){return j.namedConstraint(ee)(te.parentRequest)},new K.BindingOnSyntax(this._binding)},M.prototype.whenParentTagged=function(ee,te){return this._binding.constraint=function(pe){return j.taggedConstraint(ee)(te)(pe.parentRequest)},new K.BindingOnSyntax(this._binding)},M.prototype.whenAnyAncestorIs=function(ee){return this._binding.constraint=function(te){return j.traverseAncerstors(te,j.typeConstraint(ee))},new K.BindingOnSyntax(this._binding)},M.prototype.whenNoAncestorIs=function(ee){return this._binding.constraint=function(te){return!j.traverseAncerstors(te,j.typeConstraint(ee))},new K.BindingOnSyntax(this._binding)},M.prototype.whenAnyAncestorNamed=function(ee){return this._binding.constraint=function(te){return j.traverseAncerstors(te,j.namedConstraint(ee))},new K.BindingOnSyntax(this._binding)},M.prototype.whenNoAncestorNamed=function(ee){return this._binding.constraint=function(te){return!j.traverseAncerstors(te,j.namedConstraint(ee))},new K.BindingOnSyntax(this._binding)},M.prototype.whenAnyAncestorTagged=function(ee,te){return this._binding.constraint=function(pe){return j.traverseAncerstors(pe,j.taggedConstraint(ee)(te))},new K.BindingOnSyntax(this._binding)},M.prototype.whenNoAncestorTagged=function(ee,te){return this._binding.constraint=function(pe){return!j.traverseAncerstors(pe,j.taggedConstraint(ee)(te))},new K.BindingOnSyntax(this._binding)},M.prototype.whenAnyAncestorMatches=function(ee){return this._binding.constraint=function(te){return j.traverseAncerstors(te,ee)},new K.BindingOnSyntax(this._binding)},M.prototype.whenNoAncestorMatches=function(ee){return this._binding.constraint=function(te){return!j.traverseAncerstors(te,ee)},new K.BindingOnSyntax(this._binding)},M}();_e.BindingWhenSyntax=P},80758:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.typeConstraint=_e.namedConstraint=_e.taggedConstraint=_e.traverseAncerstors=void 0;var K=G(6867),j=G(47738),P=function(pe,Ce){var le=pe.parentRequest;return le!==null?Ce(le)?!0:P(le,Ce):!1};_e.traverseAncerstors=P;var M=function(pe){return function(Ce){var le=function(Ie){return Ie!==null&&Ie.target!==null&&Ie.target.matchesTag(pe)(Ce)};return le.metaData=new j.Metadata(pe,Ce),le}};_e.taggedConstraint=M;var ee=M(K.NAMED_TAG);_e.namedConstraint=ee;var te=function(pe){return function(Ce){var le=null;if(Ce!==null)if(le=Ce.bindings[0],typeof pe=="string"){var Ie=le.serviceIdentifier;return Ie===pe}else{var rt=Ce.bindings[0].implementationType;return pe===rt}return!1}};_e.typeConstraint=te},70600:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.multiBindToService=void 0;var G=function(K){return function(j){return function(){for(var P=[],M=0;M<arguments.length;M++)P[M]=arguments[M];return P.forEach(function(ee){return K.bind(ee).toService(j)})}}};_e.multiBindToService=G},85265:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.isStackOverflowExeption=void 0;var K=G(16674);function j(P){return P instanceof RangeError||P.message===K.STACK_OVERFLOW}_e.isStackOverflowExeption=j},37791:function(Ue,_e){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.id=void 0;var G=0;function K(){return G++}_e.id=K},55800:function(Ue,_e,G){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.circularDependencyToException=_e.listMetadataForTarget=_e.listRegisteredBindingsForServiceIdentifier=_e.getServiceIdentifierAsString=_e.getFunctionName=void 0;var K=G(16674);function j(le){if(typeof le=="function"){var Ie=le;return Ie.name}else{if(typeof le=="symbol")return le.toString();var Ie=le;return Ie}}_e.getServiceIdentifierAsString=j;function P(le,Ie,rt){var xt="",nt=rt(le,Ie);return nt.length!==0&&(xt=`
Registered bindings:`,nt.forEach(function(Ct){var jt="Object";Ct.implementationType!==null&&(jt=Ce(Ct.implementationType)),xt=xt+`
 `+jt,Ct.constraint.metaData&&(xt=xt+" - "+Ct.constraint.metaData)})),xt}_e.listRegisteredBindingsForServiceIdentifier=P;function M(le,Ie){return le.parentRequest===null?!1:le.parentRequest.serviceIdentifier===Ie?!0:M(le.parentRequest,Ie)}function ee(le){function Ie(xt,nt){nt===void 0&&(nt=[]);var Ct=j(xt.serviceIdentifier);return nt.push(Ct),xt.parentRequest!==null?Ie(xt.parentRequest,nt):nt}var rt=Ie(le);return rt.reverse().join(" --> ")}function te(le){le.childRequests.forEach(function(Ie){if(M(Ie,Ie.serviceIdentifier)){var rt=ee(Ie);throw new Error(K.CIRCULAR_DEPENDENCY+" "+rt)}else te(Ie)})}_e.circularDependencyToException=te;function pe(le,Ie){if(Ie.isTagged()||Ie.isNamed()){var rt="",xt=Ie.getNamedTag(),nt=Ie.getCustomTags();return xt!==null&&(rt+=xt.toString()+`
`),nt!==null&&nt.forEach(function(Ct){rt+=Ct.toString()+`
`})," "+le+`
 `+le+" - "+rt}else return" "+le}_e.listMetadataForTarget=pe;function Ce(le){if(le.name)return le.name;var Ie=le.toString(),rt=Ie.match(/^function\s*([^\s(]+)/);return rt?rt[1]:"Anonymous function: "+Ie}_e.getFunctionName=Ce},35171:function(Ue){Ue.exports=function(G){return!G||typeof G=="string"?!1:G instanceof Array||Array.isArray(G)||G.length>=0&&(G.splice instanceof Function||Object.getOwnPropertyDescriptor(G,G.length-1)&&G.constructor.name!=="String")}},18552:function(Ue,_e,G){var K=G(10852),j=G(55639),P=K(j,"DataView");Ue.exports=P},1989:function(Ue,_e,G){var K=G(51789),j=G(80401),P=G(57667),M=G(21327),ee=G(81866);function te(pe){var Ce=-1,le=pe==null?0:pe.length;for(this.clear();++Ce<le;){var Ie=pe[Ce];this.set(Ie[0],Ie[1])}}te.prototype.clear=K,te.prototype.delete=j,te.prototype.get=P,te.prototype.has=M,te.prototype.set=ee,Ue.exports=te},38407:function(Ue,_e,G){var K=G(27040),j=G(14125),P=G(82117),M=G(67518),ee=G(13399);function te(pe){var Ce=-1,le=pe==null?0:pe.length;for(this.clear();++Ce<le;){var Ie=pe[Ce];this.set(Ie[0],Ie[1])}}te.prototype.clear=K,te.prototype.delete=j,te.prototype.get=P,te.prototype.has=M,te.prototype.set=ee,Ue.exports=te},57071:function(Ue,_e,G){var K=G(10852),j=G(55639),P=K(j,"Map");Ue.exports=P},83369:function(Ue,_e,G){var K=G(24785),j=G(11285),P=G(96e3),M=G(49916),ee=G(95265);function te(pe){var Ce=-1,le=pe==null?0:pe.length;for(this.clear();++Ce<le;){var Ie=pe[Ce];this.set(Ie[0],Ie[1])}}te.prototype.clear=K,te.prototype.delete=j,te.prototype.get=P,te.prototype.has=M,te.prototype.set=ee,Ue.exports=te},53818:function(Ue,_e,G){var K=G(10852),j=G(55639),P=K(j,"Promise");Ue.exports=P},58525:function(Ue,_e,G){var K=G(10852),j=G(55639),P=K(j,"Set");Ue.exports=P},88668:function(Ue,_e,G){var K=G(83369),j=G(90619),P=G(72385);function M(ee){var te=-1,pe=ee==null?0:ee.length;for(this.__data__=new K;++te<pe;)this.add(ee[te])}M.prototype.add=M.prototype.push=j,M.prototype.has=P,Ue.exports=M},46384:function(Ue,_e,G){var K=G(38407),j=G(37465),P=G(63779),M=G(67599),ee=G(44758),te=G(34309);function pe(Ce){var le=this.__data__=new K(Ce);this.size=le.size}pe.prototype.clear=j,pe.prototype.delete=P,pe.prototype.get=M,pe.prototype.has=ee,pe.prototype.set=te,Ue.exports=pe},62705:function(Ue,_e,G){var K=G(55639),j=K.Symbol;Ue.exports=j},11149:function(Ue,_e,G){var K=G(55639),j=K.Uint8Array;Ue.exports=j},70577:function(Ue,_e,G){var K=G(10852),j=G(55639),P=K(j,"WeakMap");Ue.exports=P},96874:function(Ue){function _e(G,K,j){switch(j.length){case 0:return G.call(K);case 1:return G.call(K,j[0]);case 2:return G.call(K,j[0],j[1]);case 3:return G.call(K,j[0],j[1],j[2])}return G.apply(K,j)}Ue.exports=_e},77412:function(Ue){function _e(G,K){for(var j=-1,P=G==null?0:G.length;++j<P&&K(G[j],j,G)!==!1;);return G}Ue.exports=_e},34963:function(Ue){function _e(G,K){for(var j=-1,P=G==null?0:G.length,M=0,ee=[];++j<P;){var te=G[j];K(te,j,G)&&(ee[M++]=te)}return ee}Ue.exports=_e},47443:function(Ue,_e,G){var K=G(42118);function j(P,M){var ee=P==null?0:P.length;return!!ee&&K(P,M,0)>-1}Ue.exports=j},1196:function(Ue){function _e(G,K,j){for(var P=-1,M=G==null?0:G.length;++P<M;)if(j(K,G[P]))return!0;return!1}Ue.exports=_e},14636:function(Ue,_e,G){var K=G(22545),j=G(35694),P=G(1469),M=G(44144),ee=G(65776),te=G(36719),pe=Object.prototype,Ce=pe.hasOwnProperty;function le(Ie,rt){var xt=P(Ie),nt=!xt&&j(Ie),Ct=!xt&&!nt&&M(Ie),jt=!xt&&!nt&&!Ct&&te(Ie),Vt=xt||nt||Ct||jt,Rt=Vt?K(Ie.length,String):[],hr=Rt.length;for(var er in Ie)(rt||Ce.call(Ie,er))&&!(Vt&&(er=="length"||Ct&&(er=="offset"||er=="parent")||jt&&(er=="buffer"||er=="byteLength"||er=="byteOffset")||ee(er,hr)))&&Rt.push(er);return Rt}Ue.exports=le},29932:function(Ue){function _e(G,K){for(var j=-1,P=G==null?0:G.length,M=Array(P);++j<P;)M[j]=K(G[j],j,G);return M}Ue.exports=_e},62488:function(Ue){function _e(G,K){for(var j=-1,P=K.length,M=G.length;++j<P;)G[M+j]=K[j];return G}Ue.exports=_e},62663:function(Ue){function _e(G,K,j,P){var M=-1,ee=G==null?0:G.length;for(P&&ee&&(j=G[++M]);++M<ee;)j=K(j,G[M],M,G);return j}Ue.exports=_e},82908:function(Ue){function _e(G,K){for(var j=-1,P=G==null?0:G.length;++j<P;)if(K(G[j],j,G))return!0;return!1}Ue.exports=_e},44286:function(Ue){function _e(G){return G.split("")}Ue.exports=_e},49029:function(Ue){var _e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function G(K){return K.match(_e)||[]}Ue.exports=G},86556:function(Ue,_e,G){var K=G(89465),j=G(77813);function P(M,ee,te){(te!==void 0&&!j(M[ee],te)||te===void 0&&!(ee in M))&&K(M,ee,te)}Ue.exports=P},34865:function(Ue,_e,G){var K=G(89465),j=G(77813),P=Object.prototype,M=P.hasOwnProperty;function ee(te,pe,Ce){var le=te[pe];(!(M.call(te,pe)&&j(le,Ce))||Ce===void 0&&!(pe in te))&&K(te,pe,Ce)}Ue.exports=ee},18470:function(Ue,_e,G){var K=G(77813);function j(P,M){for(var ee=P.length;ee--;)if(K(P[ee][0],M))return ee;return-1}Ue.exports=j},44037:function(Ue,_e,G){var K=G(98363),j=G(3674);function P(M,ee){return M&&K(ee,j(ee),M)}Ue.exports=P},63886:function(Ue,_e,G){var K=G(98363),j=G(81704);function P(M,ee){return M&&K(ee,j(ee),M)}Ue.exports=P},89465:function(Ue,_e,G){var K=G(38777);function j(P,M,ee){M=="__proto__"&&K?K(P,M,{configurable:!0,enumerable:!0,value:ee,writable:!0}):P[M]=ee}Ue.exports=j},29750:function(Ue){function _e(G,K,j){return G===G&&(j!==void 0&&(G=G<=j?G:j),K!==void 0&&(G=G>=K?G:K)),G}Ue.exports=_e},85990:function(Ue,_e,G){var K=G(46384),j=G(77412),P=G(34865),M=G(44037),ee=G(63886),te=G(64626),pe=G(278),Ce=G(18805),le=G(1911),Ie=G(58234),rt=G(46904),xt=G(64160),nt=G(43824),Ct=G(29148),jt=G(38517),Vt=G(1469),Rt=G(44144),hr=G(56688),er=G(13218),gn=G(72928),Rr=G(3674),vn=G(81704),rr=1,Jt=2,br=4,or="[object Arguments]",Br="[object Array]",an="[object Boolean]",ot="[object Date]",Dt="[object Error]",Ee="[object Function]",Bt="[object GeneratorFunction]",Ot="[object Map]",Pr="[object Number]",Fr="[object Object]",Nr="[object RegExp]",hn="[object Set]",xn="[object String]",Ji="[object Symbol]",pi="[object WeakMap]",Ka="[object ArrayBuffer]",na="[object DataView]",ca="[object Float32Array]",po="[object Float64Array]",La="[object Int8Array]",$i="[object Int16Array]",qo="[object Int32Array]",is="[object Uint8Array]",Ko="[object Uint8ClampedArray]",Za="[object Uint16Array]",ha="[object Uint32Array]",Fo={};Fo[or]=Fo[Br]=Fo[Ka]=Fo[na]=Fo[an]=Fo[ot]=Fo[ca]=Fo[po]=Fo[La]=Fo[$i]=Fo[qo]=Fo[Ot]=Fo[Pr]=Fo[Fr]=Fo[Nr]=Fo[hn]=Fo[xn]=Fo[Ji]=Fo[is]=Fo[Ko]=Fo[Za]=Fo[ha]=!0,Fo[Dt]=Fo[Ee]=Fo[pi]=!1;function un(Ua,zr,be,lt,mt,Qt){var xr,mn=zr&rr,Wn=zr&Jt,tr=zr&br;if(be&&(xr=mt?be(Ua,lt,mt,Qt):be(Ua)),xr!==void 0)return xr;if(!er(Ua))return Ua;var Hr=Vt(Ua);if(Hr){if(xr=nt(Ua),!mn)return pe(Ua,xr)}else{var dr=xt(Ua),Un=dr==Ee||dr==Bt;if(Rt(Ua))return te(Ua,mn);if(dr==Fr||dr==or||Un&&!mt){if(xr=Wn||Un?{}:jt(Ua),!mn)return Wn?le(Ua,ee(xr,Ua)):Ce(Ua,M(xr,Ua))}else{if(!Fo[dr])return mt?Ua:{};xr=Ct(Ua,dr,mn)}}Qt||(Qt=new K);var ti=Qt.get(Ua);if(ti)return ti;Qt.set(Ua,xr),gn(Ua)?Ua.forEach(function(on){xr.add(un(on,zr,be,on,Ua,Qt))}):hr(Ua)&&Ua.forEach(function(on,Xn){xr.set(Xn,un(on,zr,be,Xn,Ua,Qt))});var Yi=tr?Wn?rt:Ie:Wn?vn:Rr,ea=Hr?void 0:Yi(Ua);return j(ea||Ua,function(on,Xn){ea&&(Xn=on,on=Ua[Xn]),P(xr,Xn,un(on,zr,be,Xn,Ua,Qt))}),xr}Ue.exports=un},3118:function(Ue,_e,G){var K=G(13218),j=Object.create,P=function(){function M(){}return function(ee){if(!K(ee))return{};if(j)return j(ee);M.prototype=ee;var te=new M;return M.prototype=void 0,te}}();Ue.exports=P},41848:function(Ue){function _e(G,K,j,P){for(var M=G.length,ee=j+(P?1:-1);P?ee--:++ee<M;)if(K(G[ee],ee,G))return ee;return-1}Ue.exports=_e},28483:function(Ue,_e,G){var K=G(25063),j=K();Ue.exports=j},97786:function(Ue,_e,G){var K=G(71811),j=G(40327);function P(M,ee){ee=K(ee,M);for(var te=0,pe=ee.length;M!=null&&te<pe;)M=M[j(ee[te++])];return te&&te==pe?M:void 0}Ue.exports=P},68866:function(Ue,_e,G){var K=G(62488),j=G(1469);function P(M,ee,te){var pe=ee(M);return j(M)?pe:K(pe,te(M))}Ue.exports=P},44239:function(Ue,_e,G){var K=G(62705),j=G(89607),P=G(2333),M="[object Null]",ee="[object Undefined]",te=K?K.toStringTag:void 0;function pe(Ce){return Ce==null?Ce===void 0?ee:M:te&&te in Object(Ce)?j(Ce):P(Ce)}Ue.exports=pe},42118:function(Ue,_e,G){var K=G(41848),j=G(62722),P=G(42351);function M(ee,te,pe){return te===te?P(ee,te,pe):K(ee,j,pe)}Ue.exports=M},74221:function(Ue){function _e(G,K,j,P){for(var M=j-1,ee=G.length;++M<ee;)if(P(G[M],K))return M;return-1}Ue.exports=_e},9454:function(Ue,_e,G){var K=G(44239),j=G(37005),P="[object Arguments]";function M(ee){return j(ee)&&K(ee)==P}Ue.exports=M},90939:function(Ue,_e,G){var K=G(21299),j=G(37005);function P(M,ee,te,pe,Ce){return M===ee?!0:M==null||ee==null||!j(M)&&!j(ee)?M!==M&&ee!==ee:K(M,ee,te,pe,P,Ce)}Ue.exports=P},21299:function(Ue,_e,G){var K=G(46384),j=G(67114),P=G(18351),M=G(16096),ee=G(64160),te=G(1469),pe=G(44144),Ce=G(36719),le=1,Ie="[object Arguments]",rt="[object Array]",xt="[object Object]",nt=Object.prototype,Ct=nt.hasOwnProperty;function jt(Vt,Rt,hr,er,gn,Rr){var vn=te(Vt),rr=te(Rt),Jt=vn?rt:ee(Vt),br=rr?rt:ee(Rt);Jt=Jt==Ie?xt:Jt,br=br==Ie?xt:br;var or=Jt==xt,Br=br==xt,an=Jt==br;if(an&&pe(Vt)){if(!pe(Rt))return!1;vn=!0,or=!1}if(an&&!or)return Rr||(Rr=new K),vn||Ce(Vt)?j(Vt,Rt,hr,er,gn,Rr):P(Vt,Rt,Jt,hr,er,gn,Rr);if(!(hr&le)){var ot=or&&Ct.call(Vt,"__wrapped__"),Dt=Br&&Ct.call(Rt,"__wrapped__");if(ot||Dt){var Ee=ot?Vt.value():Vt,Bt=Dt?Rt.value():Rt;return Rr||(Rr=new K),gn(Ee,Bt,hr,er,Rr)}}return an?(Rr||(Rr=new K),M(Vt,Rt,hr,er,gn,Rr)):!1}Ue.exports=jt},25588:function(Ue,_e,G){var K=G(64160),j=G(37005),P="[object Map]";function M(ee){return j(ee)&&K(ee)==P}Ue.exports=M},62722:function(Ue){function _e(G){return G!==G}Ue.exports=_e},28458:function(Ue,_e,G){var K=G(23560),j=G(15346),P=G(13218),M=G(80346),ee=/[\\^$.*+?()[\]{}|]/g,te=/^\[object .+?Constructor\]$/,pe=Function.prototype,Ce=Object.prototype,le=pe.toString,Ie=Ce.hasOwnProperty,rt=RegExp("^"+le.call(Ie).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function xt(nt){if(!P(nt)||j(nt))return!1;var Ct=K(nt)?rt:te;return Ct.test(M(nt))}Ue.exports=xt},29221:function(Ue,_e,G){var K=G(64160),j=G(37005),P="[object Set]";function M(ee){return j(ee)&&K(ee)==P}Ue.exports=M},38749:function(Ue,_e,G){var K=G(44239),j=G(41780),P=G(37005),M="[object Arguments]",ee="[object Array]",te="[object Boolean]",pe="[object Date]",Ce="[object Error]",le="[object Function]",Ie="[object Map]",rt="[object Number]",xt="[object Object]",nt="[object RegExp]",Ct="[object Set]",jt="[object String]",Vt="[object WeakMap]",Rt="[object ArrayBuffer]",hr="[object DataView]",er="[object Float32Array]",gn="[object Float64Array]",Rr="[object Int8Array]",vn="[object Int16Array]",rr="[object Int32Array]",Jt="[object Uint8Array]",br="[object Uint8ClampedArray]",or="[object Uint16Array]",Br="[object Uint32Array]",an={};an[er]=an[gn]=an[Rr]=an[vn]=an[rr]=an[Jt]=an[br]=an[or]=an[Br]=!0,an[M]=an[ee]=an[Rt]=an[te]=an[hr]=an[pe]=an[Ce]=an[le]=an[Ie]=an[rt]=an[xt]=an[nt]=an[Ct]=an[jt]=an[Vt]=!1;function ot(Dt){return P(Dt)&&j(Dt.length)&&!!an[K(Dt)]}Ue.exports=ot},280:function(Ue,_e,G){var K=G(25726),j=G(86916),P=Object.prototype,M=P.hasOwnProperty;function ee(te){if(!K(te))return j(te);var pe=[];for(var Ce in Object(te))M.call(te,Ce)&&Ce!="constructor"&&pe.push(Ce);return pe}Ue.exports=ee},35014:function(Ue,_e,G){var K=G(13218),j=G(25726),P=G(33498),M=Object.prototype,ee=M.hasOwnProperty;function te(pe){if(!K(pe))return P(pe);var Ce=j(pe),le=[];for(var Ie in pe)Ie=="constructor"&&(Ce||!ee.call(pe,Ie))||le.push(Ie);return le}Ue.exports=te},42980:function(Ue,_e,G){var K=G(46384),j=G(86556),P=G(28483),M=G(59783),ee=G(13218),te=G(81704),pe=G(36390);function Ce(le,Ie,rt,xt,nt){le!==Ie&&P(Ie,function(Ct,jt){if(nt||(nt=new K),ee(Ct))M(le,Ie,jt,rt,Ce,xt,nt);else{var Vt=xt?xt(pe(le,jt),Ct,jt+"",le,Ie,nt):void 0;Vt===void 0&&(Vt=Ct),j(le,jt,Vt)}},te)}Ue.exports=Ce},59783:function(Ue,_e,G){var K=G(86556),j=G(64626),P=G(77133),M=G(278),ee=G(38517),te=G(35694),pe=G(1469),Ce=G(29246),le=G(44144),Ie=G(23560),rt=G(13218),xt=G(68630),nt=G(36719),Ct=G(36390),jt=G(59881);function Vt(Rt,hr,er,gn,Rr,vn,rr){var Jt=Ct(Rt,er),br=Ct(hr,er),or=rr.get(br);if(or){K(Rt,er,or);return}var Br=vn?vn(Jt,br,er+"",Rt,hr,rr):void 0,an=Br===void 0;if(an){var ot=pe(br),Dt=!ot&&le(br),Ee=!ot&&!Dt&&nt(br);Br=br,ot||Dt||Ee?pe(Jt)?Br=Jt:Ce(Jt)?Br=M(Jt):Dt?(an=!1,Br=j(br,!0)):Ee?(an=!1,Br=P(br,!0)):Br=[]:xt(br)||te(br)?(Br=Jt,te(Jt)?Br=jt(Jt):(!rt(Jt)||Ie(Jt))&&(Br=ee(br))):an=!1}an&&(rr.set(br,Br),Rr(Br,br,gn,vn,rr),rr.delete(br)),K(Rt,er,Br)}Ue.exports=Vt},18674:function(Ue){function _e(G){return function(K){return G==null?void 0:G[K]}}Ue.exports=_e},65464:function(Ue,_e,G){var K=G(29932),j=G(42118),P=G(74221),M=G(7518),ee=G(278),te=Array.prototype,pe=te.splice;function Ce(le,Ie,rt,xt){var nt=xt?P:j,Ct=-1,jt=Ie.length,Vt=le;for(le===Ie&&(Ie=ee(Ie)),rt&&(Vt=K(le,M(rt)));++Ct<jt;)for(var Rt=0,hr=Ie[Ct],er=rt?rt(hr):hr;(Rt=nt(Vt,er,Rt,xt))>-1;)Vt!==le&&pe.call(Vt,Rt,1),pe.call(le,Rt,1);return le}Ue.exports=Ce},5976:function(Ue,_e,G){var K=G(6557),j=G(45357),P=G(30061);function M(ee,te){return P(j(ee,te,K),ee+"")}Ue.exports=M},56560:function(Ue,_e,G){var K=G(75703),j=G(38777),P=G(6557),M=j?function(ee,te){return j(ee,"toString",{configurable:!0,enumerable:!1,value:K(te),writable:!0})}:P;Ue.exports=M},14259:function(Ue){function _e(G,K,j){var P=-1,M=G.length;K<0&&(K=-K>M?0:M+K),j=j>M?M:j,j<0&&(j+=M),M=K>j?0:j-K>>>0,K>>>=0;for(var ee=Array(M);++P<M;)ee[P]=G[P+K];return ee}Ue.exports=_e},22545:function(Ue){function _e(G,K){for(var j=-1,P=Array(G);++j<G;)P[j]=K(j);return P}Ue.exports=_e},80531:function(Ue,_e,G){var K=G(62705),j=G(29932),P=G(1469),M=G(33448),ee=1/0,te=K?K.prototype:void 0,pe=te?te.toString:void 0;function Ce(le){if(typeof le=="string")return le;if(P(le))return j(le,Ce)+"";if(M(le))return pe?pe.call(le):"";var Ie=le+"";return Ie=="0"&&1/le==-ee?"-0":Ie}Ue.exports=Ce},4107:function(Ue,_e,G){var K=G(67990),j=/^\s+/;function P(M){return M&&M.slice(0,K(M)+1).replace(j,"")}Ue.exports=P},7518:function(Ue){function _e(G){return function(K){return G(K)}}Ue.exports=_e},45652:function(Ue,_e,G){var K=G(88668),j=G(47443),P=G(1196),M=G(74757),ee=G(23593),te=G(21814),pe=200;function Ce(le,Ie,rt){var xt=-1,nt=j,Ct=le.length,jt=!0,Vt=[],Rt=Vt;if(rt)jt=!1,nt=P;else if(Ct>=pe){var hr=Ie?null:ee(le);if(hr)return te(hr);jt=!1,nt=M,Rt=new K}else Rt=Ie?[]:Vt;e:for(;++xt<Ct;){var er=le[xt],gn=Ie?Ie(er):er;if(er=rt||er!==0?er:0,jt&&gn===gn){for(var Rr=Rt.length;Rr--;)if(Rt[Rr]===gn)continue e;Ie&&Rt.push(gn),Vt.push(er)}else nt(Rt,gn,rt)||(Rt!==Vt&&Rt.push(gn),Vt.push(er))}return Vt}Ue.exports=Ce},74757:function(Ue){function _e(G,K){return G.has(K)}Ue.exports=_e},71811:function(Ue,_e,G){var K=G(1469),j=G(15403),P=G(55514),M=G(79833);function ee(te,pe){return K(te)?te:j(te,pe)?[te]:P(M(te))}Ue.exports=ee},40180:function(Ue,_e,G){var K=G(14259);function j(P,M,ee){var te=P.length;return ee=ee===void 0?te:ee,!M&&ee>=te?P:K(P,M,ee)}Ue.exports=j},74318:function(Ue,_e,G){var K=G(11149);function j(P){var M=new P.constructor(P.byteLength);return new K(M).set(new K(P)),M}Ue.exports=j},64626:function(Ue,_e,G){Ue=G.nmd(Ue);var K=G(55639),j=_e&&!_e.nodeType&&_e,P=j&&!0&&Ue&&!Ue.nodeType&&Ue,M=P&&P.exports===j,ee=M?K.Buffer:void 0,te=ee?ee.allocUnsafe:void 0;function pe(Ce,le){if(le)return Ce.slice();var Ie=Ce.length,rt=te?te(Ie):new Ce.constructor(Ie);return Ce.copy(rt),rt}Ue.exports=pe},57157:function(Ue,_e,G){var K=G(74318);function j(P,M){var ee=M?K(P.buffer):P.buffer;return new P.constructor(ee,P.byteOffset,P.byteLength)}Ue.exports=j},93147:function(Ue){var _e=/\w*$/;function G(K){var j=new K.constructor(K.source,_e.exec(K));return j.lastIndex=K.lastIndex,j}Ue.exports=G},40419:function(Ue,_e,G){var K=G(62705),j=K?K.prototype:void 0,P=j?j.valueOf:void 0;function M(ee){return P?Object(P.call(ee)):{}}Ue.exports=M},77133:function(Ue,_e,G){var K=G(74318);function j(P,M){var ee=M?K(P.buffer):P.buffer;return new P.constructor(ee,P.byteOffset,P.length)}Ue.exports=j},278:function(Ue){function _e(G,K){var j=-1,P=G.length;for(K||(K=Array(P));++j<P;)K[j]=G[j];return K}Ue.exports=_e},98363:function(Ue,_e,G){var K=G(34865),j=G(89465);function P(M,ee,te,pe){var Ce=!te;te||(te={});for(var le=-1,Ie=ee.length;++le<Ie;){var rt=ee[le],xt=pe?pe(te[rt],M[rt],rt,te,M):void 0;xt===void 0&&(xt=M[rt]),Ce?j(te,rt,xt):K(te,rt,xt)}return te}Ue.exports=P},18805:function(Ue,_e,G){var K=G(98363),j=G(99551);function P(M,ee){return K(M,j(M),ee)}Ue.exports=P},1911:function(Ue,_e,G){var K=G(98363),j=G(51442);function P(M,ee){return K(M,j(M),ee)}Ue.exports=P},14429:function(Ue,_e,G){var K=G(55639),j=K["__core-js_shared__"];Ue.exports=j},21463:function(Ue,_e,G){var K=G(5976),j=G(16612);function P(M){return K(function(ee,te){var pe=-1,Ce=te.length,le=Ce>1?te[Ce-1]:void 0,Ie=Ce>2?te[2]:void 0;for(le=M.length>3&&typeof le=="function"?(Ce--,le):void 0,Ie&&j(te[0],te[1],Ie)&&(le=Ce<3?void 0:le,Ce=1),ee=Object(ee);++pe<Ce;){var rt=te[pe];rt&&M(ee,rt,pe,le)}return ee})}Ue.exports=P},25063:function(Ue){function _e(G){return function(K,j,P){for(var M=-1,ee=Object(K),te=P(K),pe=te.length;pe--;){var Ce=te[G?pe:++M];if(j(ee[Ce],Ce,ee)===!1)break}return K}}Ue.exports=_e},98805:function(Ue,_e,G){var K=G(40180),j=G(62689),P=G(83140),M=G(79833);function ee(te){return function(pe){pe=M(pe);var Ce=j(pe)?P(pe):void 0,le=Ce?Ce[0]:pe.charAt(0),Ie=Ce?K(Ce,1).join(""):pe.slice(1);return le[te]()+Ie}}Ue.exports=ee},35393:function(Ue,_e,G){var K=G(62663),j=G(53816),P=G(58748),M="['\u2019]",ee=RegExp(M,"g");function te(pe){return function(Ce){return K(P(j(Ce).replace(ee,"")),pe,"")}}Ue.exports=te},23593:function(Ue,_e,G){var K=G(58525),j=G(50308),P=G(21814),M=1/0,ee=K&&1/P(new K([,-0]))[1]==M?function(te){return new K(te)}:j;Ue.exports=ee},69389:function(Ue,_e,G){var K=G(18674),j={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},P=K(j);Ue.exports=P},38777:function(Ue,_e,G){var K=G(10852),j=function(){try{var P=K(Object,"defineProperty");return P({},"",{}),P}catch(M){}}();Ue.exports=j},67114:function(Ue,_e,G){var K=G(88668),j=G(82908),P=G(74757),M=1,ee=2;function te(pe,Ce,le,Ie,rt,xt){var nt=le&M,Ct=pe.length,jt=Ce.length;if(Ct!=jt&&!(nt&&jt>Ct))return!1;var Vt=xt.get(pe),Rt=xt.get(Ce);if(Vt&&Rt)return Vt==Ce&&Rt==pe;var hr=-1,er=!0,gn=le&ee?new K:void 0;for(xt.set(pe,Ce),xt.set(Ce,pe);++hr<Ct;){var Rr=pe[hr],vn=Ce[hr];if(Ie)var rr=nt?Ie(vn,Rr,hr,Ce,pe,xt):Ie(Rr,vn,hr,pe,Ce,xt);if(rr!==void 0){if(rr)continue;er=!1;break}if(gn){if(!j(Ce,function(Jt,br){if(!P(gn,br)&&(Rr===Jt||rt(Rr,Jt,le,Ie,xt)))return gn.push(br)})){er=!1;break}}else if(!(Rr===vn||rt(Rr,vn,le,Ie,xt))){er=!1;break}}return xt.delete(pe),xt.delete(Ce),er}Ue.exports=te},18351:function(Ue,_e,G){var K=G(62705),j=G(11149),P=G(77813),M=G(67114),ee=G(68776),te=G(21814),pe=1,Ce=2,le="[object Boolean]",Ie="[object Date]",rt="[object Error]",xt="[object Map]",nt="[object Number]",Ct="[object RegExp]",jt="[object Set]",Vt="[object String]",Rt="[object Symbol]",hr="[object ArrayBuffer]",er="[object DataView]",gn=K?K.prototype:void 0,Rr=gn?gn.valueOf:void 0;function vn(rr,Jt,br,or,Br,an,ot){switch(br){case er:if(rr.byteLength!=Jt.byteLength||rr.byteOffset!=Jt.byteOffset)return!1;rr=rr.buffer,Jt=Jt.buffer;case hr:return!(rr.byteLength!=Jt.byteLength||!an(new j(rr),new j(Jt)));case le:case Ie:case nt:return P(+rr,+Jt);case rt:return rr.name==Jt.name&&rr.message==Jt.message;case Ct:case Vt:return rr==Jt+"";case xt:var Dt=ee;case jt:var Ee=or&pe;if(Dt||(Dt=te),rr.size!=Jt.size&&!Ee)return!1;var Bt=ot.get(rr);if(Bt)return Bt==Jt;or|=Ce,ot.set(rr,Jt);var Ot=M(Dt(rr),Dt(Jt),or,Br,an,ot);return ot.delete(rr),Ot;case Rt:if(Rr)return Rr.call(rr)==Rr.call(Jt)}return!1}Ue.exports=vn},16096:function(Ue,_e,G){var K=G(58234),j=1,P=Object.prototype,M=P.hasOwnProperty;function ee(te,pe,Ce,le,Ie,rt){var xt=Ce&j,nt=K(te),Ct=nt.length,jt=K(pe),Vt=jt.length;if(Ct!=Vt&&!xt)return!1;for(var Rt=Ct;Rt--;){var hr=nt[Rt];if(!(xt?hr in pe:M.call(pe,hr)))return!1}var er=rt.get(te),gn=rt.get(pe);if(er&&gn)return er==pe&&gn==te;var Rr=!0;rt.set(te,pe),rt.set(pe,te);for(var vn=xt;++Rt<Ct;){hr=nt[Rt];var rr=te[hr],Jt=pe[hr];if(le)var br=xt?le(Jt,rr,hr,pe,te,rt):le(rr,Jt,hr,te,pe,rt);if(!(br===void 0?rr===Jt||Ie(rr,Jt,Ce,le,rt):br)){Rr=!1;break}vn||(vn=hr=="constructor")}if(Rr&&!vn){var or=te.constructor,Br=pe.constructor;or!=Br&&"constructor"in te&&"constructor"in pe&&!(typeof or=="function"&&or instanceof or&&typeof Br=="function"&&Br instanceof Br)&&(Rr=!1)}return rt.delete(te),rt.delete(pe),Rr}Ue.exports=ee},31957:function(Ue,_e,G){var K=typeof G.g=="object"&&G.g&&G.g.Object===Object&&G.g;Ue.exports=K},58234:function(Ue,_e,G){var K=G(68866),j=G(99551),P=G(3674);function M(ee){return K(ee,P,j)}Ue.exports=M},46904:function(Ue,_e,G){var K=G(68866),j=G(51442),P=G(81704);function M(ee){return K(ee,P,j)}Ue.exports=M},45050:function(Ue,_e,G){var K=G(37019);function j(P,M){var ee=P.__data__;return K(M)?ee[typeof M=="string"?"string":"hash"]:ee.map}Ue.exports=j},10852:function(Ue,_e,G){var K=G(28458),j=G(47801);function P(M,ee){var te=j(M,ee);return K(te)?te:void 0}Ue.exports=P},85924:function(Ue,_e,G){var K=G(5569),j=K(Object.getPrototypeOf,Object);Ue.exports=j},89607:function(Ue,_e,G){var K=G(62705),j=Object.prototype,P=j.hasOwnProperty,M=j.toString,ee=K?K.toStringTag:void 0;function te(pe){var Ce=P.call(pe,ee),le=pe[ee];try{pe[ee]=void 0;var Ie=!0}catch(xt){}var rt=M.call(pe);return Ie&&(Ce?pe[ee]=le:delete pe[ee]),rt}Ue.exports=te},99551:function(Ue,_e,G){var K=G(34963),j=G(70479),P=Object.prototype,M=P.propertyIsEnumerable,ee=Object.getOwnPropertySymbols,te=ee?function(pe){return pe==null?[]:(pe=Object(pe),K(ee(pe),function(Ce){return M.call(pe,Ce)}))}:j;Ue.exports=te},51442:function(Ue,_e,G){var K=G(62488),j=G(85924),P=G(99551),M=G(70479),ee=Object.getOwnPropertySymbols,te=ee?function(pe){for(var Ce=[];pe;)K(Ce,P(pe)),pe=j(pe);return Ce}:M;Ue.exports=te},64160:function(Ue,_e,G){var K=G(18552),j=G(57071),P=G(53818),M=G(58525),ee=G(70577),te=G(44239),pe=G(80346),Ce="[object Map]",le="[object Object]",Ie="[object Promise]",rt="[object Set]",xt="[object WeakMap]",nt="[object DataView]",Ct=pe(K),jt=pe(j),Vt=pe(P),Rt=pe(M),hr=pe(ee),er=te;(K&&er(new K(new ArrayBuffer(1)))!=nt||j&&er(new j)!=Ce||P&&er(P.resolve())!=Ie||M&&er(new M)!=rt||ee&&er(new ee)!=xt)&&(er=function(gn){var Rr=te(gn),vn=Rr==le?gn.constructor:void 0,rr=vn?pe(vn):"";if(rr)switch(rr){case Ct:return nt;case jt:return Ce;case Vt:return Ie;case Rt:return rt;case hr:return xt}return Rr}),Ue.exports=er},47801:function(Ue){function _e(G,K){return G==null?void 0:G[K]}Ue.exports=_e},62689:function(Ue){var _e="\\ud800-\\udfff",G="\\u0300-\\u036f",K="\\ufe20-\\ufe2f",j="\\u20d0-\\u20ff",P=G+K+j,M="\\ufe0e\\ufe0f",ee="\\u200d",te=RegExp("["+ee+_e+P+M+"]");function pe(Ce){return te.test(Ce)}Ue.exports=pe},93157:function(Ue){var _e=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function G(K){return _e.test(K)}Ue.exports=G},51789:function(Ue,_e,G){var K=G(94536);function j(){this.__data__=K?K(null):{},this.size=0}Ue.exports=j},80401:function(Ue){function _e(G){var K=this.has(G)&&delete this.__data__[G];return this.size-=K?1:0,K}Ue.exports=_e},57667:function(Ue,_e,G){var K=G(94536),j="__lodash_hash_undefined__",P=Object.prototype,M=P.hasOwnProperty;function ee(te){var pe=this.__data__;if(K){var Ce=pe[te];return Ce===j?void 0:Ce}return M.call(pe,te)?pe[te]:void 0}Ue.exports=ee},21327:function(Ue,_e,G){var K=G(94536),j=Object.prototype,P=j.hasOwnProperty;function M(ee){var te=this.__data__;return K?te[ee]!==void 0:P.call(te,ee)}Ue.exports=M},81866:function(Ue,_e,G){var K=G(94536),j="__lodash_hash_undefined__";function P(M,ee){var te=this.__data__;return this.size+=this.has(M)?0:1,te[M]=K&&ee===void 0?j:ee,this}Ue.exports=P},43824:function(Ue){var _e=Object.prototype,G=_e.hasOwnProperty;function K(j){var P=j.length,M=new j.constructor(P);return P&&typeof j[0]=="string"&&G.call(j,"index")&&(M.index=j.index,M.input=j.input),M}Ue.exports=K},29148:function(Ue,_e,G){var K=G(74318),j=G(57157),P=G(93147),M=G(40419),ee=G(77133),te="[object Boolean]",pe="[object Date]",Ce="[object Map]",le="[object Number]",Ie="[object RegExp]",rt="[object Set]",xt="[object String]",nt="[object Symbol]",Ct="[object ArrayBuffer]",jt="[object DataView]",Vt="[object Float32Array]",Rt="[object Float64Array]",hr="[object Int8Array]",er="[object Int16Array]",gn="[object Int32Array]",Rr="[object Uint8Array]",vn="[object Uint8ClampedArray]",rr="[object Uint16Array]",Jt="[object Uint32Array]";function br(or,Br,an){var ot=or.constructor;switch(Br){case Ct:return K(or);case te:case pe:return new ot(+or);case jt:return j(or,an);case Vt:case Rt:case hr:case er:case gn:case Rr:case vn:case rr:case Jt:return ee(or,an);case Ce:return new ot;case le:case xt:return new ot(or);case Ie:return P(or);case rt:return new ot;case nt:return M(or)}}Ue.exports=br},38517:function(Ue,_e,G){var K=G(3118),j=G(85924),P=G(25726);function M(ee){return typeof ee.constructor=="function"&&!P(ee)?K(j(ee)):{}}Ue.exports=M},65776:function(Ue){var _e=9007199254740991,G=/^(?:0|[1-9]\d*)$/;function K(j,P){var M=typeof j;return P=P==null?_e:P,!!P&&(M=="number"||M!="symbol"&&G.test(j))&&j>-1&&j%1==0&&j<P}Ue.exports=K},16612:function(Ue,_e,G){var K=G(77813),j=G(98612),P=G(65776),M=G(13218);function ee(te,pe,Ce){if(!M(Ce))return!1;var le=typeof pe;return(le=="number"?j(Ce)&&P(pe,Ce.length):le=="string"&&pe in Ce)?K(Ce[pe],te):!1}Ue.exports=ee},15403:function(Ue,_e,G){var K=G(1469),j=G(33448),P=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,M=/^\w*$/;function ee(te,pe){if(K(te))return!1;var Ce=typeof te;return Ce=="number"||Ce=="symbol"||Ce=="boolean"||te==null||j(te)?!0:M.test(te)||!P.test(te)||pe!=null&&te in Object(pe)}Ue.exports=ee},37019:function(Ue){function _e(G){var K=typeof G;return K=="string"||K=="number"||K=="symbol"||K=="boolean"?G!=="__proto__":G===null}Ue.exports=_e},15346:function(Ue,_e,G){var K=G(14429),j=function(){var M=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""}();function P(M){return!!j&&j in M}Ue.exports=P},25726:function(Ue){var _e=Object.prototype;function G(K){var j=K&&K.constructor,P=typeof j=="function"&&j.prototype||_e;return K===P}Ue.exports=G},27040:function(Ue){function _e(){this.__data__=[],this.size=0}Ue.exports=_e},14125:function(Ue,_e,G){var K=G(18470),j=Array.prototype,P=j.splice;function M(ee){var te=this.__data__,pe=K(te,ee);if(pe<0)return!1;var Ce=te.length-1;return pe==Ce?te.pop():P.call(te,pe,1),--this.size,!0}Ue.exports=M},82117:function(Ue,_e,G){var K=G(18470);function j(P){var M=this.__data__,ee=K(M,P);return ee<0?void 0:M[ee][1]}Ue.exports=j},67518:function(Ue,_e,G){var K=G(18470);function j(P){return K(this.__data__,P)>-1}Ue.exports=j},13399:function(Ue,_e,G){var K=G(18470);function j(P,M){var ee=this.__data__,te=K(ee,P);return te<0?(++this.size,ee.push([P,M])):ee[te][1]=M,this}Ue.exports=j},24785:function(Ue,_e,G){var K=G(1989),j=G(38407),P=G(57071);function M(){this.size=0,this.__data__={hash:new K,map:new(P||j),string:new K}}Ue.exports=M},11285:function(Ue,_e,G){var K=G(45050);function j(P){var M=K(this,P).delete(P);return this.size-=M?1:0,M}Ue.exports=j},96e3:function(Ue,_e,G){var K=G(45050);function j(P){return K(this,P).get(P)}Ue.exports=j},49916:function(Ue,_e,G){var K=G(45050);function j(P){return K(this,P).has(P)}Ue.exports=j},95265:function(Ue,_e,G){var K=G(45050);function j(P,M){var ee=K(this,P),te=ee.size;return ee.set(P,M),this.size+=ee.size==te?0:1,this}Ue.exports=j},68776:function(Ue){function _e(G){var K=-1,j=Array(G.size);return G.forEach(function(P,M){j[++K]=[M,P]}),j}Ue.exports=_e},24523:function(Ue,_e,G){var K=G(88306),j=500;function P(M){var ee=K(M,function(pe){return te.size===j&&te.clear(),pe}),te=ee.cache;return ee}Ue.exports=P},94536:function(Ue,_e,G){var K=G(10852),j=K(Object,"create");Ue.exports=j},86916:function(Ue,_e,G){var K=G(5569),j=K(Object.keys,Object);Ue.exports=j},33498:function(Ue){function _e(G){var K=[];if(G!=null)for(var j in Object(G))K.push(j);return K}Ue.exports=_e},31167:function(Ue,_e,G){Ue=G.nmd(Ue);var K=G(31957),j=_e&&!_e.nodeType&&_e,P=j&&!0&&Ue&&!Ue.nodeType&&Ue,M=P&&P.exports===j,ee=M&&K.process,te=function(){try{var pe=P&&P.require&&P.require("util").types;return pe||ee&&ee.binding&&ee.binding("util")}catch(Ce){}}();Ue.exports=te},2333:function(Ue){var _e=Object.prototype,G=_e.toString;function K(j){return G.call(j)}Ue.exports=K},5569:function(Ue){function _e(G,K){return function(j){return G(K(j))}}Ue.exports=_e},45357:function(Ue,_e,G){var K=G(96874),j=Math.max;function P(M,ee,te){return ee=j(ee===void 0?M.length-1:ee,0),function(){for(var pe=arguments,Ce=-1,le=j(pe.length-ee,0),Ie=Array(le);++Ce<le;)Ie[Ce]=pe[ee+Ce];Ce=-1;for(var rt=Array(ee+1);++Ce<ee;)rt[Ce]=pe[Ce];return rt[ee]=te(Ie),K(M,this,rt)}}Ue.exports=P},55639:function(Ue,_e,G){var K=G(31957),j=typeof self=="object"&&self&&self.Object===Object&&self,P=K||j||Function("return this")();Ue.exports=P},36390:function(Ue){function _e(G,K){if(!(K==="constructor"&&typeof G[K]=="function")&&K!="__proto__")return G[K]}Ue.exports=_e},90619:function(Ue){var _e="__lodash_hash_undefined__";function G(K){return this.__data__.set(K,_e),this}Ue.exports=G},72385:function(Ue){function _e(G){return this.__data__.has(G)}Ue.exports=_e},21814:function(Ue){function _e(G){var K=-1,j=Array(G.size);return G.forEach(function(P){j[++K]=P}),j}Ue.exports=_e},30061:function(Ue,_e,G){var K=G(56560),j=G(21275),P=j(K);Ue.exports=P},21275:function(Ue){var _e=800,G=16,K=Date.now;function j(P){var M=0,ee=0;return function(){var te=K(),pe=G-(te-ee);if(ee=te,pe>0){if(++M>=_e)return arguments[0]}else M=0;return P.apply(void 0,arguments)}}Ue.exports=j},37465:function(Ue,_e,G){var K=G(38407);function j(){this.__data__=new K,this.size=0}Ue.exports=j},63779:function(Ue){function _e(G){var K=this.__data__,j=K.delete(G);return this.size=K.size,j}Ue.exports=_e},67599:function(Ue){function _e(G){return this.__data__.get(G)}Ue.exports=_e},44758:function(Ue){function _e(G){return this.__data__.has(G)}Ue.exports=_e},34309:function(Ue,_e,G){var K=G(38407),j=G(57071),P=G(83369),M=200;function ee(te,pe){var Ce=this.__data__;if(Ce instanceof K){var le=Ce.__data__;if(!j||le.length<M-1)return le.push([te,pe]),this.size=++Ce.size,this;Ce=this.__data__=new P(le)}return Ce.set(te,pe),this.size=Ce.size,this}Ue.exports=ee},42351:function(Ue){function _e(G,K,j){for(var P=j-1,M=G.length;++P<M;)if(G[P]===K)return P;return-1}Ue.exports=_e},83140:function(Ue,_e,G){var K=G(44286),j=G(62689),P=G(676);function M(ee){return j(ee)?P(ee):K(ee)}Ue.exports=M},55514:function(Ue,_e,G){var K=G(24523),j=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,P=/\\(\\)?/g,M=K(function(ee){var te=[];return ee.charCodeAt(0)===46&&te.push(""),ee.replace(j,function(pe,Ce,le,Ie){te.push(le?Ie.replace(P,"$1"):Ce||pe)}),te});Ue.exports=M},40327:function(Ue,_e,G){var K=G(33448),j=1/0;function P(M){if(typeof M=="string"||K(M))return M;var ee=M+"";return ee=="0"&&1/M==-j?"-0":ee}Ue.exports=P},80346:function(Ue){var _e=Function.prototype,G=_e.toString;function K(j){if(j!=null){try{return G.call(j)}catch(P){}try{return j+""}catch(P){}}return""}Ue.exports=K},67990:function(Ue){var _e=/\s/;function G(K){for(var j=K.length;j--&&_e.test(K.charAt(j)););return j}Ue.exports=G},676:function(Ue){var _e="\\ud800-\\udfff",G="\\u0300-\\u036f",K="\\ufe20-\\ufe2f",j="\\u20d0-\\u20ff",P=G+K+j,M="\\ufe0e\\ufe0f",ee="["+_e+"]",te="["+P+"]",pe="\\ud83c[\\udffb-\\udfff]",Ce="(?:"+te+"|"+pe+")",le="[^"+_e+"]",Ie="(?:\\ud83c[\\udde6-\\uddff]){2}",rt="[\\ud800-\\udbff][\\udc00-\\udfff]",xt="\\u200d",nt=Ce+"?",Ct="["+M+"]?",jt="(?:"+xt+"(?:"+[le,Ie,rt].join("|")+")"+Ct+nt+")*",Vt=Ct+nt+jt,Rt="(?:"+[le+te+"?",te,Ie,rt,ee].join("|")+")",hr=RegExp(pe+"(?="+pe+")|"+Rt+Vt,"g");function er(gn){return gn.match(hr)||[]}Ue.exports=er},2757:function(Ue){var _e="\\ud800-\\udfff",G="\\u0300-\\u036f",K="\\ufe20-\\ufe2f",j="\\u20d0-\\u20ff",P=G+K+j,M="\\u2700-\\u27bf",ee="a-z\\xdf-\\xf6\\xf8-\\xff",te="\\xac\\xb1\\xd7\\xf7",pe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ce="\\u2000-\\u206f",le=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ie="A-Z\\xc0-\\xd6\\xd8-\\xde",rt="\\ufe0e\\ufe0f",xt=te+pe+Ce+le,nt="['\u2019]",Ct="["+xt+"]",jt="["+P+"]",Vt="\\d+",Rt="["+M+"]",hr="["+ee+"]",er="[^"+_e+xt+Vt+M+ee+Ie+"]",gn="\\ud83c[\\udffb-\\udfff]",Rr="(?:"+jt+"|"+gn+")",vn="[^"+_e+"]",rr="(?:\\ud83c[\\udde6-\\uddff]){2}",Jt="[\\ud800-\\udbff][\\udc00-\\udfff]",br="["+Ie+"]",or="\\u200d",Br="(?:"+hr+"|"+er+")",an="(?:"+br+"|"+er+")",ot="(?:"+nt+"(?:d|ll|m|re|s|t|ve))?",Dt="(?:"+nt+"(?:D|LL|M|RE|S|T|VE))?",Ee=Rr+"?",Bt="["+rt+"]?",Ot="(?:"+or+"(?:"+[vn,rr,Jt].join("|")+")"+Bt+Ee+")*",Pr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nr=Bt+Ee+Ot,hn="(?:"+[Rt,rr,Jt].join("|")+")"+Nr,xn=RegExp([br+"?"+hr+"+"+ot+"(?="+[Ct,br,"$"].join("|")+")",an+"+"+Dt+"(?="+[Ct,br+Br,"$"].join("|")+")",br+"?"+Br+"+"+ot,br+"+"+Dt,Fr,Pr,Vt,hn].join("|"),"g");function Ji(pi){return pi.match(xn)||[]}Ue.exports=Ji},68929:function(Ue,_e,G){var K=G(48403),j=G(35393),P=j(function(M,ee,te){return ee=ee.toLowerCase(),M+(te?K(ee):ee)});Ue.exports=P},48403:function(Ue,_e,G){var K=G(79833),j=G(11700);function P(M){return j(K(M).toLowerCase())}Ue.exports=P},74691:function(Ue,_e,G){var K=G(29750),j=G(14841);function P(M,ee,te){return te===void 0&&(te=ee,ee=void 0),te!==void 0&&(te=j(te),te=te===te?te:0),ee!==void 0&&(ee=j(ee),ee=ee===ee?ee:0),K(j(M),ee,te)}Ue.exports=P},50361:function(Ue,_e,G){var K=G(85990),j=1,P=4;function M(ee){return K(ee,j|P)}Ue.exports=M},75703:function(Ue){function _e(G){return function(){return G}}Ue.exports=_e},23279:function(Ue,_e,G){var K=G(13218),j=G(7771),P=G(14841),M="Expected a function",ee=Math.max,te=Math.min;function pe(Ce,le,Ie){var rt,xt,nt,Ct,jt,Vt,Rt=0,hr=!1,er=!1,gn=!0;if(typeof Ce!="function")throw new TypeError(M);le=P(le)||0,K(Ie)&&(hr=!!Ie.leading,er="maxWait"in Ie,nt=er?ee(P(Ie.maxWait)||0,le):nt,gn="trailing"in Ie?!!Ie.trailing:gn);function Rr(Dt){var Ee=rt,Bt=xt;return rt=xt=void 0,Rt=Dt,Ct=Ce.apply(Bt,Ee),Ct}function vn(Dt){return Rt=Dt,jt=setTimeout(br,le),hr?Rr(Dt):Ct}function rr(Dt){var Ee=Dt-Vt,Bt=Dt-Rt,Ot=le-Ee;return er?te(Ot,nt-Bt):Ot}function Jt(Dt){var Ee=Dt-Vt,Bt=Dt-Rt;return Vt===void 0||Ee>=le||Ee<0||er&&Bt>=nt}function br(){var Dt=j();if(Jt(Dt))return or(Dt);jt=setTimeout(br,rr(Dt))}function or(Dt){return jt=void 0,gn&&rt?Rr(Dt):(rt=xt=void 0,Ct)}function Br(){jt!==void 0&&clearTimeout(jt),Rt=0,rt=Vt=xt=jt=void 0}function an(){return jt===void 0?Ct:or(j())}function ot(){var Dt=j(),Ee=Jt(Dt);if(rt=arguments,xt=this,Vt=Dt,Ee){if(jt===void 0)return vn(Vt);if(er)return clearTimeout(jt),jt=setTimeout(br,le),Rr(Vt)}return jt===void 0&&(jt=setTimeout(br,le)),Ct}return ot.cancel=Br,ot.flush=an,ot}Ue.exports=pe},53816:function(Ue,_e,G){var K=G(69389),j=G(79833),P=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,M="\\u0300-\\u036f",ee="\\ufe20-\\ufe2f",te="\\u20d0-\\u20ff",pe=M+ee+te,Ce="["+pe+"]",le=RegExp(Ce,"g");function Ie(rt){return rt=j(rt),rt&&rt.replace(P,K).replace(le,"")}Ue.exports=Ie},77813:function(Ue){function _e(G,K){return G===K||G!==G&&K!==K}Ue.exports=_e},27361:function(Ue,_e,G){var K=G(97786);function j(P,M,ee){var te=P==null?void 0:K(P,M);return te===void 0?ee:te}Ue.exports=j},6557:function(Ue){function _e(G){return G}Ue.exports=_e},35694:function(Ue,_e,G){var K=G(9454),j=G(37005),P=Object.prototype,M=P.hasOwnProperty,ee=P.propertyIsEnumerable,te=K(function(){return arguments}())?K:function(pe){return j(pe)&&M.call(pe,"callee")&&!ee.call(pe,"callee")};Ue.exports=te},1469:function(Ue){var _e=Array.isArray;Ue.exports=_e},98612:function(Ue,_e,G){var K=G(23560),j=G(41780);function P(M){return M!=null&&j(M.length)&&!K(M)}Ue.exports=P},29246:function(Ue,_e,G){var K=G(98612),j=G(37005);function P(M){return j(M)&&K(M)}Ue.exports=P},51584:function(Ue,_e,G){var K=G(44239),j=G(37005),P="[object Boolean]";function M(ee){return ee===!0||ee===!1||j(ee)&&K(ee)==P}Ue.exports=M},44144:function(Ue,_e,G){Ue=G.nmd(Ue);var K=G(55639),j=G(95062),P=_e&&!_e.nodeType&&_e,M=P&&!0&&Ue&&!Ue.nodeType&&Ue,ee=M&&M.exports===P,te=ee?K.Buffer:void 0,pe=te?te.isBuffer:void 0,Ce=pe||j;Ue.exports=Ce},18446:function(Ue,_e,G){var K=G(90939);function j(P,M){return K(P,M)}Ue.exports=j},23560:function(Ue,_e,G){var K=G(44239),j=G(13218),P="[object AsyncFunction]",M="[object Function]",ee="[object GeneratorFunction]",te="[object Proxy]";function pe(Ce){if(!j(Ce))return!1;var le=K(Ce);return le==M||le==ee||le==P||le==te}Ue.exports=pe},41780:function(Ue){var _e=9007199254740991;function G(K){return typeof K=="number"&&K>-1&&K%1==0&&K<=_e}Ue.exports=G},56688:function(Ue,_e,G){var K=G(25588),j=G(7518),P=G(31167),M=P&&P.isMap,ee=M?j(M):K;Ue.exports=ee},14293:function(Ue){function _e(G){return G==null}Ue.exports=_e},81763:function(Ue,_e,G){var K=G(44239),j=G(37005),P="[object Number]";function M(ee){return typeof ee=="number"||j(ee)&&K(ee)==P}Ue.exports=M},13218:function(Ue){function _e(G){var K=typeof G;return G!=null&&(K=="object"||K=="function")}Ue.exports=_e},37005:function(Ue){function _e(G){return G!=null&&typeof G=="object"}Ue.exports=_e},68630:function(Ue,_e,G){var K=G(44239),j=G(85924),P=G(37005),M="[object Object]",ee=Function.prototype,te=Object.prototype,pe=ee.toString,Ce=te.hasOwnProperty,le=pe.call(Object);function Ie(rt){if(!P(rt)||K(rt)!=M)return!1;var xt=j(rt);if(xt===null)return!0;var nt=Ce.call(xt,"constructor")&&xt.constructor;return typeof nt=="function"&&nt instanceof nt&&pe.call(nt)==le}Ue.exports=Ie},72928:function(Ue,_e,G){var K=G(29221),j=G(7518),P=G(31167),M=P&&P.isSet,ee=M?j(M):K;Ue.exports=ee},47037:function(Ue,_e,G){var K=G(44239),j=G(1469),P=G(37005),M="[object String]";function ee(te){return typeof te=="string"||!j(te)&&P(te)&&K(te)==M}Ue.exports=ee},33448:function(Ue,_e,G){var K=G(44239),j=G(37005),P="[object Symbol]";function M(ee){return typeof ee=="symbol"||j(ee)&&K(ee)==P}Ue.exports=M},36719:function(Ue,_e,G){var K=G(38749),j=G(7518),P=G(31167),M=P&&P.isTypedArray,ee=M?j(M):K;Ue.exports=ee},52353:function(Ue){function _e(G){return G===void 0}Ue.exports=_e},3674:function(Ue,_e,G){var K=G(14636),j=G(280),P=G(98612);function M(ee){return P(ee)?K(ee):j(ee)}Ue.exports=M},81704:function(Ue,_e,G){var K=G(14636),j=G(35014),P=G(98612);function M(ee){return P(ee)?K(ee,!0):j(ee)}Ue.exports=M},88306:function(Ue,_e,G){var K=G(83369),j="Expected a function";function P(M,ee){if(typeof M!="function"||ee!=null&&typeof ee!="function")throw new TypeError(j);var te=function(){var pe=arguments,Ce=ee?ee.apply(this,pe):pe[0],le=te.cache;if(le.has(Ce))return le.get(Ce);var Ie=M.apply(this,pe);return te.cache=le.set(Ce,Ie)||le,Ie};return te.cache=new(P.Cache||K),te}P.Cache=K,Ue.exports=P},82492:function(Ue,_e,G){var K=G(42980),j=G(21463),P=j(function(M,ee,te){K(M,ee,te)});Ue.exports=P},30236:function(Ue,_e,G){var K=G(42980),j=G(21463),P=j(function(M,ee,te,pe){K(M,ee,te,pe)});Ue.exports=P},50308:function(Ue){function _e(){}Ue.exports=_e},7771:function(Ue,_e,G){var K=G(55639),j=function(){return K.Date.now()};Ue.exports=j},97019:function(Ue,_e,G){var K=G(5976),j=G(45604),P=K(j);Ue.exports=P},45604:function(Ue,_e,G){var K=G(65464);function j(P,M){return P&&P.length&&M&&M.length?K(P,M):P}Ue.exports=j},70479:function(Ue){function _e(){return[]}Ue.exports=_e},95062:function(Ue){function _e(){return!1}Ue.exports=_e},23493:function(Ue,_e,G){var K=G(23279),j=G(13218),P="Expected a function";function M(ee,te,pe){var Ce=!0,le=!0;if(typeof ee!="function")throw new TypeError(P);return j(pe)&&(Ce="leading"in pe?!!pe.leading:Ce,le="trailing"in pe?!!pe.trailing:le),K(ee,te,{leading:Ce,maxWait:te,trailing:le})}Ue.exports=M},14841:function(Ue,_e,G){var K=G(4107),j=G(13218),P=G(33448),M=0/0,ee=/^[-+]0x[0-9a-f]+$/i,te=/^0b[01]+$/i,pe=/^0o[0-7]+$/i,Ce=parseInt;function le(Ie){if(typeof Ie=="number")return Ie;if(P(Ie))return M;if(j(Ie)){var rt=typeof Ie.valueOf=="function"?Ie.valueOf():Ie;Ie=j(rt)?rt+"":rt}if(typeof Ie!="string")return Ie===0?Ie:+Ie;Ie=K(Ie);var xt=te.test(Ie);return xt||pe.test(Ie)?Ce(Ie.slice(2),xt?2:8):ee.test(Ie)?M:+Ie}Ue.exports=le},59881:function(Ue,_e,G){var K=G(98363),j=G(81704);function P(M){return K(M,j(M))}Ue.exports=P},79833:function(Ue,_e,G){var K=G(80531);function j(P){return P==null?"":K(P)}Ue.exports=j},44908:function(Ue,_e,G){var K=G(45652);function j(P){return P&&P.length?K(P):[]}Ue.exports=j},11700:function(Ue,_e,G){var K=G(98805),j=K("toUpperCase");Ue.exports=j},58748:function(Ue,_e,G){var K=G(49029),j=G(93157),P=G(79833),M=G(2757);function ee(te,pe,Ce){return te=P(te),pe=Ce?void 0:pe,pe===void 0?j(te)?M(te):K(te):te.match(pe)||[]}Ue.exports=ee},6158:function(Ue){(function(_e,G){Ue.exports=G()})(this,function(){"use strict";var _e,G,K;function j(P,M){if(!_e)_e=M;else if(!G)G=M;else{var ee="var sharedChunk = {}; ("+_e+")(sharedChunk); ("+G+")(sharedChunk);",te={};_e(te),K=M(te),typeof window!="undefined"&&(K.workerUrl=window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"})))}}return j(["exports"],function(P){"use strict";function M(i,s){return i(s={exports:{}},s.exports),s.exports}var ee=te;function te(i,s,l,p){this.cx=3*i,this.bx=3*(l-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=p,this.p2x=l,this.p2y=p}te.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},te.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},te.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},te.prototype.solveCurveX=function(i,s){var l,p,S,A,I;for(s===void 0&&(s=1e-6),S=i,I=0;I<8;I++){if(A=this.sampleCurveX(S)-i,Math.abs(A)<s)return S;var U=this.sampleCurveDerivativeX(S);if(Math.abs(U)<1e-6)break;S-=A/U}if((S=i)<(l=0))return l;if(S>(p=1))return p;for(;l<p;){if(A=this.sampleCurveX(S),Math.abs(A-i)<s)return S;i>A?l=S:p=S,S=.5*(p-l)+l}return S},te.prototype.solve=function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))};var pe=Ce;function Ce(i,s){this.x=i,this.y=s}Ce.prototype={clone:function(){return new Ce(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,s){return this.clone()._rotateAround(i,s)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var s=i.x-this.x,l=i.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,s){return Math.atan2(this.x*s-this.y*i,this.x*i+this.y*s)},_matMult:function(i){var s=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=s,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var s=Math.cos(i),l=Math.sin(i),p=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=p,this},_rotateAround:function(i,s){var l=Math.cos(i),p=Math.sin(i),S=s.y+p*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-p*(this.y-s.y),this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ce.convert=function(i){return i instanceof Ce?i:Array.isArray(i)?new Ce(i[0],i[1]):i};var le=typeof self!="undefined"?self:{},Ie=Math.pow(2,53)-1;function rt(i,s,l,p){var S=new ee(i,s,l,p);return function(A){return S.solve(A)}}var xt=rt(.25,.1,.25,1);function nt(i,s,l){return Math.min(l,Math.max(s,i))}function Ct(i,s,l){var p=l-s,S=((i-s)%p+p)%p+s;return S===s?l:S}function jt(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var p=0,S=s;p<S.length;p+=1){var A=S[p];for(var I in A)i[I]=A[I]}return i}var Vt=1;function Rt(){return Vt++}function hr(){return function i(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function er(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function gn(i,s){i.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function Rr(i,s){return i.indexOf(s,i.length-s.length)!==-1}function vn(i,s,l){var p={};for(var S in i)p[S]=s.call(l||this,i[S],S,i);return p}function rr(i,s,l){var p={};for(var S in i)s.call(l||this,i[S],S,i)&&(p[S]=i[S]);return p}function Jt(i){return Array.isArray(i)?i.map(Jt):typeof i=="object"&&i?vn(i,Jt):i}var br={};function or(i){br[i]||(typeof console!="undefined"&&console.warn(i),br[i]=!0)}function Br(i,s,l){return(l.y-i.y)*(s.x-i.x)>(s.y-i.y)*(l.x-i.x)}function an(i){for(var s=0,l=0,p=i.length,S=p-1,A=void 0,I=void 0;l<p;S=l++)s+=((I=i[S]).x-(A=i[l]).x)*(A.y+I.y);return s}function ot(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Dt(i){var s={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,S,A,I){var U=A||I;return s[S]=!U||U.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var Ee=null;function Bt(i){if(Ee==null){var s=i.navigator?i.navigator.userAgent:null;Ee=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ee}function Ot(i){try{var s=le[i];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var Pr,Fr,Nr,hn,xn=le.performance&&le.performance.now?le.performance.now.bind(le.performance):Date.now.bind(Date),Ji=le.requestAnimationFrame||le.mozRequestAnimationFrame||le.webkitRequestAnimationFrame||le.msRequestAnimationFrame,pi=le.cancelAnimationFrame||le.mozCancelAnimationFrame||le.webkitCancelAnimationFrame||le.msCancelAnimationFrame,Ka={now:xn,frame:function(i){var s=Ji(i);return{cancel:function(){return pi(s)}}},getImageData:function(i,s){s===void 0&&(s=0);var l=le.document.createElement("canvas"),p=l.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return l.width=i.width,l.height=i.height,p.drawImage(i,0,0,i.width,i.height),p.getImageData(-s,-s,i.width+2*s,i.height+2*s)},resolveURL:function(i){return Pr||(Pr=le.document.createElement("a")),Pr.href=i,Pr.href},hardwareConcurrency:le.navigator&&le.navigator.hardwareConcurrency||4,get devicePixelRatio(){return le.devicePixelRatio},get prefersReducedMotion(){return!!le.matchMedia&&(Fr==null&&(Fr=le.matchMedia("(prefers-reduced-motion: reduce)")),Fr.matches)}},na={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ca={supported:!1,testSupport:function(i){!po&&hn&&(La?$i(i):Nr=i)}},po=!1,La=!1;function $i(i){var s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,hn),i.isContextLost())return;ca.supported=!0}catch(l){}i.deleteTexture(s),po=!0}le.document&&((hn=le.document.createElement("img")).onload=function(){Nr&&$i(Nr),Nr=null,La=!0},hn.onerror=function(){po=!0,Nr=null},hn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var qo="01",is=function(i,s){this._transformRequestFn=i,this._customAccessToken=s,this._createSkuToken()};function Ko(i){return i.indexOf("mapbox:")===0}is.prototype._createSkuToken=function(){var i=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qo,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},is.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},is.prototype.transformRequest=function(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}},is.prototype.normalizeStyleURL=function(i,s){if(!Ko(i))return i;var l=un(i);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},is.prototype.normalizeGlyphsURL=function(i,s){if(!Ko(i))return i;var l=un(i);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},is.prototype.normalizeSourceURL=function(i,s){if(!Ko(i))return i;var l=un(i);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},is.prototype.normalizeSpriteURL=function(i,s,l,p){var S=un(i);return Ko(i)?(S.path="/styles/v1"+S.path+"/sprite"+s+l,this._makeAPIURL(S,this._customAccessToken||p)):(S.path+=""+s+l,Ua(S))},is.prototype.normalizeTileURL=function(i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ko(i))return i;var l=un(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ka.devicePixelRatio>=2||s===512?"@2x":"")+(ca.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var p=this._customAccessToken||function(S){for(var A=0,I=S;A<I.length;A+=1){var U=I[A].match(/^access_token=(.*)$/);if(U)return U[1]}return null}(l.params)||na.ACCESS_TOKEN;return na.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,p)},is.prototype.canonicalizeTileURL=function(i,s){var l=un(i);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return i;var p="mapbox://tiles/";p+=l.path.replace("/v4/","");var S=l.params;return s&&(S=S.filter(function(A){return!A.match(/^access_token=/)})),S.length&&(p+="?"+S.join("&")),p},is.prototype.canonicalizeTileset=function(i,s){for(var l=!!s&&Ko(s),p=[],S=0,A=i.tiles||[];S<A.length;S+=1){var I=A[S];ha(I)?p.push(this.canonicalizeTileURL(I,l)):p.push(I)}return p},is.prototype._makeAPIURL=function(i,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=un(na.API_URL);if(i.protocol=p.protocol,i.authority=p.authority,i.protocol==="http"){var S=i.params.indexOf("secure");S>=0&&i.params.splice(S,1)}if(p.path!=="/"&&(i.path=""+p.path+i.path),!na.REQUIRE_ACCESS_TOKEN)return Ua(i);if(!(s=s||na.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return i.params=i.params.filter(function(A){return A.indexOf("access_token")===-1}),i.params.push("access_token="+s),Ua(i)};var Za=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ha(i){return Za.test(i)}var Fo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function un(i){var s=i.match(Fo);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ua(i){var s=i.params.length?"?"+i.params.join("&"):"";return i.protocol+"://"+i.authority+i.path+s}function zr(i){if(!i)return null;var s=i.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(le.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var be=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};be.prototype.getStorageKey=function(i){var s,l=zr(na.ACCESS_TOKEN);return s=l&&l.u?le.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(p,S){return String.fromCharCode(+("0x"+S))})):na.ACCESS_TOKEN||"",i?"mapbox.eventData."+i+":"+s:"mapbox.eventData:"+s},be.prototype.fetchEventData=function(){var i=Ot("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{var p=le.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));var S=le.localStorage.getItem(l);S&&(this.anonId=S)}catch(A){or("Unable to read from LocalStorage")}},be.prototype.saveEventData=function(){var i=Ot("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{le.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&le.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(p){or("Unable to write to LocalStorage")}},be.prototype.processRequests=function(i){},be.prototype.postEvent=function(i,s,l,p){var S=this;if(na.EVENTS_URL){var A=un(na.EVENTS_URL);A.params.push("access_token="+(p||na.ACCESS_TOKEN||""));var I={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:qo,userId:this.anonId},U=s?jt(I,s):I,q={url:Ua(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([U])};this.pendingRequest=qe(q,function(re){S.pendingRequest=null,l(re),S.saveEventData(),S.processRequests(p)})}},be.prototype.queueRequest=function(i,s){this.queue.push(i),this.processRequests(s)};var lt,mt,Qt=function(i){function s(){i.call(this,"map.load"),this.success={},this.skuToken=""}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,p,S,A){this.skuToken=S;var I=!(!A&&!na.ACCESS_TOKEN),U=Array.isArray(l)&&l.some(function(q){return Ko(q)||ha(q)});na.EVENTS_URL&&I&&U&&this.queueRequest({id:p,timestamp:Date.now()},A)},s.prototype.processRequests=function(l){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var S=this.queue.shift(),A=S.id,I=S.timestamp;A&&this.success[A]||(this.anonId||this.fetchEventData(),er(this.anonId)||(this.anonId=hr()),this.postEvent(I,{skuToken:this.skuToken},function(U){U||A&&(p.success[A]=!0)},l))}},s}(be),xr=new(function(i){function s(l){i.call(this,"appUserTurnstile"),this._customAccessToken=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,p){na.EVENTS_URL&&na.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(S){return Ko(S)||ha(S)})&&this.queueRequest(Date.now(),p)},s.prototype.processRequests=function(l){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var S=zr(na.ACCESS_TOKEN),A=S?S.u:na.ACCESS_TOKEN,I=A!==this.eventData.tokenU;er(this.anonId)||(this.anonId=hr(),I=!0);var U=this.queue.shift();if(this.eventData.lastSuccess){var q=new Date(this.eventData.lastSuccess),re=new Date(U),de=(U-this.eventData.lastSuccess)/864e5;I=I||de>=1||de<-1||q.getDate()!==re.getDate()}else I=!0;if(!I)return this.processRequests();this.postEvent(U,{"enabled.telemetry":!1},function(we){we||(p.eventData.lastSuccess=U,p.eventData.tokenU=A)},l)}},s}(be)),mn=xr.postTurnstileEvent.bind(xr),Wn=new Qt,tr=Wn.postMapLoadEvent.bind(Wn),Hr=500,dr=50;function Un(){le.caches&&!lt&&(lt=le.caches.open("mapbox-tiles"))}function ti(i){var s=i.indexOf("?");return s<0?i:i.slice(0,s)}var Yi,ea=1/0;function on(){return Yi==null&&(Yi=le.OffscreenCanvas&&new le.OffscreenCanvas(1,1).getContext("2d")&&typeof le.createImageBitmap=="function"),Yi}var Xn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Xn);var Pi=function(i){function s(l,p,S){p===401&&ha(S)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),i.call(this,l),this.status=p,this.url=S,this.name=this.constructor.name,this.message=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Pa=ot()?function(){return self.worker&&self.worker.referrer}:function(){return(le.location.protocol==="blob:"?le.parent:le).location.href},zo,ya,Xu=function(i,s){if(!(/^file:/.test(l=i.url)||/^file:/.test(Pa())&&!/^\w+:/.test(l))){if(le.fetch&&le.Request&&le.AbortController&&le.Request.prototype.hasOwnProperty("signal"))return function(p,S){var A,I=new le.AbortController,U=new le.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Pa(),signal:I.signal}),q=!1,re=!1,de=(A=U.url).indexOf("sku=")>0&&ha(A);p.type==="json"&&U.headers.set("Accept","application/json");var we=function(Ge,it,tt){if(!re){if(Ge&&Ge.message!=="SecurityError"&&or(Ge),it&&tt)return Oe(it);var ct=Date.now();le.fetch(U).then(function(ut){if(ut.ok){var Je=de?ut.clone():null;return Oe(ut,Je,ct)}return S(new Pi(ut.statusText,ut.status,p.url))}).catch(function(ut){ut.code!==20&&S(new Error(ut.message))})}},Oe=function(Ge,it,tt){(p.type==="arrayBuffer"?Ge.arrayBuffer():p.type==="json"?Ge.json():Ge.text()).then(function(ct){re||(it&&tt&&function(ut,Je,Pt){if(Un(),lt){var Xt={status:Je.status,statusText:Je.statusText,headers:new le.Headers};Je.headers.forEach(function(Ur,tn){return Xt.headers.set(tn,Ur)});var pr=Dt(Je.headers.get("Cache-Control")||"");pr["no-store"]||(pr["max-age"]&&Xt.headers.set("Expires",new Date(Pt+1e3*pr["max-age"]).toUTCString()),new Date(Xt.headers.get("Expires")).getTime()-Pt<42e4||function(Ur,tn){if(mt===void 0)try{new Response(new ReadableStream),mt=!0}catch(An){mt=!1}mt?tn(Ur.body):Ur.blob().then(tn)}(Je,function(Ur){var tn=new le.Response(Ur,Xt);Un(),lt&&lt.then(function(An){return An.put(ti(ut.url),tn)}).catch(function(An){return or(An.message)})}))}}(U,it,tt),q=!0,S(null,ct,Ge.headers.get("Cache-Control"),Ge.headers.get("Expires")))}).catch(function(ct){re||S(new Error(ct.message))})};return de?function(Ge,it){if(Un(),!lt)return it(null);var tt=ti(Ge.url);lt.then(function(ct){ct.match(tt).then(function(ut){var Je=function(Pt){if(!Pt)return!1;var Xt=new Date(Pt.headers.get("Expires")||0),pr=Dt(Pt.headers.get("Cache-Control")||"");return Xt>Date.now()&&!pr["no-cache"]}(ut);ct.delete(tt),Je&&ct.put(tt,ut.clone()),it(null,ut,Je)}).catch(it)}).catch(it)}(U,we):we(null,null),{cancel:function(){re=!0,q||I.abort()}}}(i,s);if(ot()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,s,void 0,!0)}var l;return function(p,S){var A=new le.XMLHttpRequest;for(var I in A.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(A.responseType="arraybuffer"),p.headers)A.setRequestHeader(I,p.headers[I]);return p.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=p.credentials==="include",A.onerror=function(){S(new Error(A.statusText))},A.onload=function(){if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){var U=A.response;if(p.type==="json")try{U=JSON.parse(A.response)}catch(q){return S(q)}S(null,U,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else S(new Pi(A.statusText,A.status,p.url))},A.send(p.body),{cancel:function(){return A.abort()}}}(i,s)},Wt=function(i,s){return Xu(jt(i,{type:"arrayBuffer"}),s)},qe=function(i,s){return Xu(jt(i,{method:"POST"}),s)},se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";zo=[],ya=0;var ve=function(i,s){if(ca.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ya>=na.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:i,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return zo.push(l),l}ya++;var p=!1,S=function(){if(!p)for(p=!0,ya--;zo.length&&ya<na.MAX_PARALLEL_IMAGE_REQUESTS;){var I=zo.shift();I.cancelled||(I.cancel=ve(I.requestParameters,I.callback).cancel)}},A=Wt(i,function(I,U,q,re){S(),I?s(I):U&&(on()?function(de,we){var Oe=new le.Blob([new Uint8Array(de)],{type:"image/png"});le.createImageBitmap(Oe).then(function(Ge){we(null,Ge)}).catch(function(Ge){we(new Error("Could not load image because of "+Ge.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(U,s):function(de,we,Oe,Ge){var it=new le.Image,tt=le.URL;it.onload=function(){we(null,it),tt.revokeObjectURL(it.src),it.onload=null,le.requestAnimationFrame(function(){it.src=se})},it.onerror=function(){return we(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ct=new le.Blob([new Uint8Array(de)],{type:"image/png"});it.cacheControl=Oe,it.expires=Ge,it.src=de.byteLength?tt.createObjectURL(ct):se}(U,s,q,re))});return{cancel:function(){A.cancel(),S()}}};function Ae(i,s,l){l[i]&&l[i].indexOf(s)!==-1||(l[i]=l[i]||[],l[i].push(s))}function Re(i,s,l){if(l&&l[i]){var p=l[i].indexOf(s);p!==-1&&l[i].splice(p,1)}}var Xe=function(i,s){s===void 0&&(s={}),jt(this,s),this.type=i},Qe=function(i){function s(l,p){p===void 0&&(p={}),i.call(this,"error",jt({error:l},p))}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Xe),Ye=function(){};Ye.prototype.on=function(i,s){return this._listeners=this._listeners||{},Ae(i,s,this._listeners),this},Ye.prototype.off=function(i,s){return Re(i,s,this._listeners),Re(i,s,this._oneTimeListeners),this},Ye.prototype.once=function(i,s){return this._oneTimeListeners=this._oneTimeListeners||{},Ae(i,s,this._oneTimeListeners),this},Ye.prototype.fire=function(i,s){typeof i=="string"&&(i=new Xe(i,s||{}));var l=i.type;if(this.listens(l)){i.target=this;for(var p=0,S=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];p<S.length;p+=1)S[p].call(this,i);for(var A=0,I=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];A<I.length;A+=1){var U=I[A];Re(l,U,this._oneTimeListeners),U.call(this,i)}var q=this._eventedParent;q&&(jt(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),q.fire(i))}else i instanceof Qe&&console.error(i.error);return this},Ye.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},Ye.prototype.setEventedParent=function(i,s){return this._eventedParent=i,this._eventedParentData=s,this};var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Me=function(i,s,l,p){this.message=(i?i+": ":"")+l,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)};function Be(i){var s=i.value;return s?[new Me(i.key,s,"constants have been deprecated as of v8")]:[]}function yt(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var p=0,S=s;p<S.length;p+=1){var A=S[p];for(var I in A)i[I]=A[I]}return i}function zt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ze(i){if(Array.isArray(i))return i.map(Ze);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){var s={};for(var l in i)s[l]=Ze(i[l]);return s}return zt(i)}var Yr=function(i){function s(l,p){i.call(this,p),this.message=p,this.key=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Error),Fn=function(i,s){s===void 0&&(s=[]),this.parent=i,this.bindings={};for(var l=0,p=s;l<p.length;l+=1){var S=p[l];this.bindings[S[0]]=S[1]}};Fn.prototype.concat=function(i){return new Fn(this,i)},Fn.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},Fn.prototype.has=function(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)};var Nn={kind:"null"},qr={kind:"number"},li={kind:"string"},zn={kind:"boolean"},jn={kind:"color"},Ca={kind:"object"},ni={kind:"value"},za={kind:"collator"},Ao={kind:"formatted"},io={kind:"resolvedImage"};function ys(i,s){return{kind:"array",itemType:i,N:s}}function oo(i){if(i.kind==="array"){var s=oo(i.itemType);return typeof i.N=="number"?"array<"+s+", "+i.N+">":i.itemType.kind==="value"?"array":"array<"+s+">"}return i.kind}var el=[Nn,qr,li,zn,jn,Ao,Ca,ys(ni),io];function Qs(i,s){if(s.kind==="error")return null;if(i.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Qs(i.itemType,s.itemType))&&(typeof i.N!="number"||i.N===s.N))return null}else{if(i.kind===s.kind)return null;if(i.kind==="value"){for(var l=0,p=el;l<p.length;l+=1)if(!Qs(p[l],s))return null}}return"Expected "+oo(i)+" but found "+oo(s)+" instead."}function vo(i,s){return s.some(function(l){return l.kind===i.kind})}function as(i,s){return s.some(function(l){return l==="null"?i===null:l==="array"?Array.isArray(i):l==="object"?i&&!Array.isArray(i)&&typeof i=="object":l===typeof i})}var To=M(function(i,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(U){return(U=Math.round(U))<0?0:U>255?255:U}function S(U){return p(U[U.length-1]==="%"?parseFloat(U)/100*255:parseInt(U))}function A(U){return(q=U[U.length-1]==="%"?parseFloat(U)/100:parseFloat(U))<0?0:q>1?1:q;var q}function I(U,q,re){return re<0?re+=1:re>1&&(re-=1),6*re<1?U+(q-U)*re*6:2*re<1?q:3*re<2?U+(q-U)*(2/3-re)*6:U}try{s.parseCSSColor=function(U){var q,re=U.replace(/ /g,"").toLowerCase();if(re in l)return l[re].slice();if(re[0]==="#")return re.length===4?(q=parseInt(re.substr(1),16))>=0&&q<=4095?[(3840&q)>>4|(3840&q)>>8,240&q|(240&q)>>4,15&q|(15&q)<<4,1]:null:re.length===7&&(q=parseInt(re.substr(1),16))>=0&&q<=16777215?[(16711680&q)>>16,(65280&q)>>8,255&q,1]:null;var de=re.indexOf("("),we=re.indexOf(")");if(de!==-1&&we+1===re.length){var Oe=re.substr(0,de),Ge=re.substr(de+1,we-(de+1)).split(","),it=1;switch(Oe){case"rgba":if(Ge.length!==4)return null;it=A(Ge.pop());case"rgb":return Ge.length!==3?null:[S(Ge[0]),S(Ge[1]),S(Ge[2]),it];case"hsla":if(Ge.length!==4)return null;it=A(Ge.pop());case"hsl":if(Ge.length!==3)return null;var tt=(parseFloat(Ge[0])%360+360)%360/360,ct=A(Ge[1]),ut=A(Ge[2]),Je=ut<=.5?ut*(ct+1):ut+ct-ut*ct,Pt=2*ut-Je;return[p(255*I(Pt,Je,tt+1/3)),p(255*I(Pt,Je,tt)),p(255*I(Pt,Je,tt-1/3)),it];default:return null}}return null}}catch(U){}}).parseCSSColor,to=function(i,s,l,p){p===void 0&&(p=1),this.r=i,this.g=s,this.b=l,this.a=p};to.parse=function(i){if(i){if(i instanceof to)return i;if(typeof i=="string"){var s=To(i);if(s)return new to(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},to.prototype.toString=function(){var i=this.toArray(),s=i[1],l=i[2],p=i[3];return"rgba("+Math.round(i[0])+","+Math.round(s)+","+Math.round(l)+","+p+")"},to.prototype.toArray=function(){var i=this.a;return i===0?[0,0,0,0]:[255*this.r/i,255*this.g/i,255*this.b/i,i]},to.black=new to(0,0,0,1),to.white=new to(1,1,1,1),to.transparent=new to(0,0,0,0),to.red=new to(1,0,0,1);var js=function(i,s,l){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};js.prototype.compare=function(i,s){return this.collator.compare(i,s)},js.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Vc=function(i,s,l,p,S){this.text=i,this.image=s,this.scale=l,this.fontStack=p,this.textColor=S},ws=function(i){this.sections=i};ws.fromString=function(i){return new ws([new Vc(i,null,null,null,null)])},ws.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},ws.factory=function(i){return i instanceof ws?i:ws.fromString(i)},ws.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},ws.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var p=l[s];if(p.image)i.push(["image",p.image.name]);else{i.push(p.text);var S={};p.fontStack&&(S["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(S["font-scale"]=p.scale),p.textColor&&(S["text-color"]=["rgba"].concat(p.textColor.toArray())),i.push(S)}}return i};var Ss=function(i){this.name=i.name,this.available=i.available};function eh(i,s,l,p){return typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[i,s,l,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[i,s,l,p]:[i,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function kc(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof to||i instanceof js||i instanceof ws||i instanceof Ss)return!0;if(Array.isArray(i)){for(var s=0,l=i;s<l.length;s+=1)if(!kc(l[s]))return!1;return!0}if(typeof i=="object"){for(var p in i)if(!kc(i[p]))return!1;return!0}return!1}function Io(i){if(i===null)return Nn;if(typeof i=="string")return li;if(typeof i=="boolean")return zn;if(typeof i=="number")return qr;if(i instanceof to)return jn;if(i instanceof js)return za;if(i instanceof ws)return Ao;if(i instanceof Ss)return io;if(Array.isArray(i)){for(var s,l=i.length,p=0,S=i;p<S.length;p+=1){var A=Io(S[p]);if(s){if(s===A)continue;s=ni;break}s=A}return ys(s||ni,l)}return Ca}function bo(i){var s=typeof i;return i===null?"":s==="string"||s==="number"||s==="boolean"?String(i):i instanceof to||i instanceof ws||i instanceof Ss?i.toString():JSON.stringify(i)}Ss.prototype.toString=function(){return this.name},Ss.fromString=function(i){return i?new Ss({name:i,available:!1}):null},Ss.prototype.serialize=function(){return["image",this.name]};var du=function(i,s){this.type=i,this.value=s};du.parse=function(i,s){if(i.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!kc(i[1]))return s.error("invalid value");var l=i[1],p=Io(l),S=s.expectedType;return p.kind!=="array"||p.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(p=S),new du(p,l)},du.prototype.evaluate=function(){return this.value},du.prototype.eachChild=function(){},du.prototype.outputDefined=function(){return!0},du.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof to?["rgba"].concat(this.value.toArray()):this.value instanceof ws?this.value.serialize():this.value};var Zo=function(i){this.name="ExpressionEvaluationError",this.message=i};Zo.prototype.toJSON=function(){return this.message};var Il={string:li,number:qr,boolean:zn,object:Ca},Uo=function(i,s){this.type=i,this.args=s};Uo.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l,p=1,S=i[0];if(S==="array"){var A,I;if(i.length>2){var U=i[1];if(typeof U!="string"||!(U in Il)||U==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);A=Il[U],p++}else A=ni;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);I=i[2],p++}l=ys(A,I)}else l=Il[S];for(var q=[];p<i.length;p++){var re=s.parse(i[p],p,ni);if(!re)return null;q.push(re)}return new Uo(l,q)},Uo.prototype.evaluate=function(i){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(i);if(!Qs(this.type,Io(l)))return l;if(s===this.args.length-1)throw new Zo("Expected value to be of type "+oo(this.type)+", but found "+oo(Io(l))+" instead.")}return null},Uo.prototype.eachChild=function(i){this.args.forEach(i)},Uo.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Uo.prototype.serialize=function(){var i=this.type,s=[i.kind];if(i.kind==="array"){var l=i.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var p=i.N;(typeof p=="number"||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(function(S){return S.serialize()}))};var Ws=function(i){this.type=Ao,this.sections=i};Ws.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var p=[],S=!1,A=1;A<=i.length-1;++A){var I=i[A];if(S&&typeof I=="object"&&!Array.isArray(I)){S=!1;var U=null;if(I["font-scale"]&&!(U=s.parse(I["font-scale"],1,qr)))return null;var q=null;if(I["text-font"]&&!(q=s.parse(I["text-font"],1,ys(li))))return null;var re=null;if(I["text-color"]&&!(re=s.parse(I["text-color"],1,jn)))return null;var de=p[p.length-1];de.scale=U,de.font=q,de.textColor=re}else{var we=s.parse(i[A],1,ni);if(!we)return null;var Oe=we.type.kind;if(Oe!=="string"&&Oe!=="value"&&Oe!=="null"&&Oe!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,p.push({content:we,scale:null,font:null,textColor:null})}}return new Ws(p)},Ws.prototype.evaluate=function(i){return new ws(this.sections.map(function(s){var l=s.content.evaluate(i);return Io(l)===io?new Vc("",l,null,null,null):new Vc(bo(l),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))},Ws.prototype.eachChild=function(i){for(var s=0,l=this.sections;s<l.length;s+=1){var p=l[s];i(p.content),p.scale&&i(p.scale),p.font&&i(p.font),p.textColor&&i(p.textColor)}},Ws.prototype.outputDefined=function(){return!1},Ws.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var p=l[s];i.push(p.content.serialize());var S={};p.scale&&(S["font-scale"]=p.scale.serialize()),p.font&&(S["text-font"]=p.font.serialize()),p.textColor&&(S["text-color"]=p.textColor.serialize()),i.push(S)}return i};var eu=function(i){this.type=io,this.input=i};eu.parse=function(i,s){if(i.length!==2)return s.error("Expected two arguments.");var l=s.parse(i[1],1,li);return l?new eu(l):s.error("No image name provided.")},eu.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=Ss.fromString(s);return l&&i.availableImages&&(l.available=i.availableImages.indexOf(s)>-1),l},eu.prototype.eachChild=function(i){i(this.input)},eu.prototype.outputDefined=function(){return!1},eu.prototype.serialize=function(){return["image",this.input.serialize()]};var sl={"to-boolean":zn,"to-color":jn,"to-number":qr,"to-string":li},ul=function(i,s){this.type=i,this.args=s};ul.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[0];if((l==="to-boolean"||l==="to-string")&&i.length!==2)return s.error("Expected one argument.");for(var p=sl[l],S=[],A=1;A<i.length;A++){var I=s.parse(i[A],A,ni);if(!I)return null;S.push(I)}return new ul(p,S)},ul.prototype.evaluate=function(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){for(var s,l,p=0,S=this.args;p<S.length;p+=1){if(l=null,(s=S[p].evaluate(i))instanceof to)return s;if(typeof s=="string"){var A=i.parseColor(s);if(A)return A}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":eh(s[0],s[1],s[2],s[3])))return new to(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Zo(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var I=null,U=0,q=this.args;U<q.length;U+=1){if((I=q[U].evaluate(i))===null)return 0;var re=Number(I);if(!isNaN(re))return re}throw new Zo("Could not convert "+JSON.stringify(I)+" to number.")}return this.type.kind==="formatted"?ws.fromString(bo(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Ss.fromString(bo(this.args[0].evaluate(i))):bo(this.args[0].evaluate(i))},ul.prototype.eachChild=function(i){this.args.forEach(i)},ul.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},ul.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ws([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new eu(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(s){i.push(s.serialize())}),i};var ll=["Unknown","Point","LineString","Polygon"],_c=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};_c.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},_c.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ll[this.feature.type]:this.feature.type:null},_c.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},_c.prototype.canonicalID=function(){return this.canonical},_c.prototype.properties=function(){return this.feature&&this.feature.properties||{}},_c.prototype.parseColor=function(i){var s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=to.parse(i)),s};var zu=function(i,s,l,p){this.name=i,this.type=s,this._evaluate=l,this.args=p};zu.prototype.evaluate=function(i){return this._evaluate(i,this.args)},zu.prototype.eachChild=function(i){this.args.forEach(i)},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},zu.parse=function(i,s){var l,p=i[0],S=zu.definitions[p];if(!S)return s.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var A=Array.isArray(S)?S[0]:S.type,I=Array.isArray(S)?[[S[1],S[2]]]:S.overloads,U=I.filter(function(si){var kn=si[0];return!Array.isArray(kn)||kn.length===i.length-1}),q=null,re=0,de=U;re<de.length;re+=1){var we=de[re],Oe=we[0],Ge=we[1];q=new Mo(s.registry,s.path,null,s.scope);for(var it=[],tt=!1,ct=1;ct<i.length;ct++){var ut=i[ct],Je=Array.isArray(Oe)?Oe[ct-1]:Oe.type,Pt=q.parse(ut,1+it.length,Je);if(!Pt){tt=!0;break}it.push(Pt)}if(!tt)if(Array.isArray(Oe)&&Oe.length!==it.length)q.error("Expected "+Oe.length+" arguments, but found "+it.length+" instead.");else{for(var Xt=0;Xt<it.length;Xt++){var pr=Array.isArray(Oe)?Oe[Xt]:Oe.type,Ur=it[Xt];q.concat(Xt+1).checkSubtype(pr,Ur.type)}if(q.errors.length===0)return new zu(p,A,Ge,it)}}if(U.length===1)(l=s.errors).push.apply(l,q.errors);else{for(var tn=(U.length?U:I).map(function(si){var kn;return kn=si[0],Array.isArray(kn)?"("+kn.map(oo).join(", ")+")":"("+oo(kn.type)+"...)"}).join(" | "),An=[],xi=1;xi<i.length;xi++){var On=s.parse(i[xi],1+An.length);if(!On)return null;An.push(oo(On.type))}s.error("Expected arguments of type "+tn+", but found ("+An.join(", ")+") instead.")}return null},zu.register=function(i,s){for(var l in zu.definitions=s,s)i[l]=zu};var cl=function(i,s,l){this.type=za,this.locale=l,this.caseSensitive=i,this.diacriticSensitive=s};function iu(i,s){i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.max(i[2],s[0]),i[3]=Math.max(i[3],s[1])}function _t(i,s){return!(i[0]<=s[0]||i[2]>=s[2]||i[1]<=s[1]||i[3]>=s[3])}function Ut(i,s){var l=(180+i[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,S=Math.pow(2,s.z);return[Math.round(l*S*8192),Math.round(p*S*8192)]}function Er(i,s,l){return s[1]>i[1]!=l[1]>i[1]&&i[0]<(l[0]-s[0])*(i[1]-s[1])/(l[1]-s[1])+s[0]}function Sn(i,s){for(var l,p,S,A,I,U,q,re=!1,de=0,we=s.length;de<we;de++)for(var Oe=s[de],Ge=0,it=Oe.length;Ge<it-1;Ge++){if((A=(l=i)[0]-(p=Oe[Ge])[0])*(q=l[1]-(S=Oe[Ge+1])[1])-(U=l[0]-S[0])*(I=l[1]-p[1])==0&&A*U<=0&&I*q<=0)return!1;Er(i,Oe[Ge],Oe[Ge+1])&&(re=!re)}return re}function kr(i,s){for(var l=0;l<s.length;l++)if(Sn(i,s[l]))return!0;return!1}function wa(i,s,l,p){var S=p[0]-l[0],A=p[1]-l[1],I=(i[0]-l[0])*A-S*(i[1]-l[1]),U=(s[0]-l[0])*A-S*(s[1]-l[1]);return I>0&&U<0||I<0&&U>0}function Xa(i,s,l){for(var p=0,S=l;p<S.length;p+=1)for(var A=S[p],I=0;I<A.length-1;++I)if((we=[(de=A[I+1])[0]-(re=A[I])[0],de[1]-re[1]])[0]*(Oe=[(q=s)[0]-(U=i)[0],q[1]-U[1]])[1]-we[1]*Oe[0]!=0&&wa(U,q,re,de)&&wa(re,de,U,q))return!0;var U,q,re,de,we,Oe;return!1}function yl(i,s){for(var l=0;l<i.length;++l)if(!Sn(i[l],s))return!1;for(var p=0;p<i.length-1;++p)if(Xa(i[p],i[p+1],s))return!1;return!0}function Jo(i,s){for(var l=0;l<s.length;l++)if(yl(i,s[l]))return!0;return!1}function au(i,s,l){for(var p=[],S=0;S<i.length;S++){for(var A=[],I=0;I<i[S].length;I++){var U=Ut(i[S][I],l);iu(s,U),A.push(U)}p.push(A)}return p}function ou(i,s,l){for(var p=[],S=0;S<i.length;S++){var A=au(i[S],s,l);p.push(A)}return p}function Ra(i,s,l,p){if(i[0]<l[0]||i[0]>l[2]){var S=.5*p,A=i[0]-l[0]>S?-p:l[0]-i[0]>S?p:0;A===0&&(A=i[0]-l[2]>S?-p:l[2]-i[0]>S?p:0),i[0]+=A}iu(s,i)}function Mp(i,s,l,p){for(var S=8192*Math.pow(2,p.z),A=[8192*p.x,8192*p.y],I=[],U=0,q=i;U<q.length;U+=1)for(var re=0,de=q[U];re<de.length;re+=1){var we=de[re],Oe=[we.x+A[0],we.y+A[1]];Ra(Oe,s,l,S),I.push(Oe)}return I}function th(i,s,l,p){for(var S,A=8192*Math.pow(2,p.z),I=[8192*p.x,8192*p.y],U=[],q=0,re=i;q<re.length;q+=1){for(var de=[],we=0,Oe=re[q];we<Oe.length;we+=1){var Ge=Oe[we],it=[Ge.x+I[0],Ge.y+I[1]];iu(s,it),de.push(it)}U.push(de)}if(s[2]-s[0]<=A/2){(S=s)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(var tt=0,ct=U;tt<ct.length;tt+=1)for(var ut=0,Je=ct[tt];ut<Je.length;ut+=1)Ra(Je[ut],s,l,A)}return U}cl.parse=function(i,s){if(i.length!==2)return s.error("Expected one argument.");var l=i[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var p=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,zn);if(!p)return null;var S=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,zn);if(!S)return null;var A=null;return l.locale&&!(A=s.parse(l.locale,1,li))?null:new cl(p,S,A)},cl.prototype.evaluate=function(i){return new js(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},cl.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},cl.prototype.outputDefined=function(){return!1},cl.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var su=function(i,s){this.type=zn,this.geojson=i,this.geometries=s};function _a(i){if(i instanceof zu&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof su)return!1;var s=!0;return i.eachChild(function(l){s&&!_a(l)&&(s=!1)}),s}function os(i){if(i instanceof zu&&i.name==="feature-state")return!1;var s=!0;return i.eachChild(function(l){s&&!os(l)&&(s=!1)}),s}function Su(i,s){if(i instanceof zu&&s.indexOf(i.name)>=0)return!1;var l=!0;return i.eachChild(function(p){l&&!Su(p,s)&&(l=!1)}),l}su.parse=function(i,s){if(i.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(kc(i[1])){var l=i[1];if(l.type==="FeatureCollection")for(var p=0;p<l.features.length;++p){var S=l.features[p].geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new su(l,l.features[p].geometry)}else if(l.type==="Feature"){var A=l.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new su(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new su(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},su.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,l){var p=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(l.type==="Polygon"){var I=au(l.coordinates,S,A),U=Mp(s.geometry(),p,S,A);if(!_t(p,S))return!1;for(var q=0,re=U;q<re.length;q+=1)if(!Sn(re[q],I))return!1}if(l.type==="MultiPolygon"){var de=ou(l.coordinates,S,A),we=Mp(s.geometry(),p,S,A);if(!_t(p,S))return!1;for(var Oe=0,Ge=we;Oe<Ge.length;Oe+=1)if(!kr(Ge[Oe],de))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,l){var p=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(l.type==="Polygon"){var I=au(l.coordinates,S,A),U=th(s.geometry(),p,S,A);if(!_t(p,S))return!1;for(var q=0,re=U;q<re.length;q+=1)if(!yl(re[q],I))return!1}if(l.type==="MultiPolygon"){var de=ou(l.coordinates,S,A),we=th(s.geometry(),p,S,A);if(!_t(p,S))return!1;for(var Oe=0,Ge=we;Oe<Ge.length;Oe+=1)if(!Jo(Ge[Oe],de))return!1}return!0}(i,this.geometries)}return!1},su.prototype.eachChild=function(){},su.prototype.outputDefined=function(){return!0},su.prototype.serialize=function(){return["within",this.geojson]};var Eh=function(i,s){this.type=s.type,this.name=i,this.boundExpression=s};Eh.parse=function(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=i[1];return s.scope.has(l)?new Eh(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},Eh.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},Eh.prototype.eachChild=function(){},Eh.prototype.outputDefined=function(){return!1},Eh.prototype.serialize=function(){return["var",this.name]};var Mo=function(i,s,l,p,S){s===void 0&&(s=[]),p===void 0&&(p=new Fn),S===void 0&&(S=[]),this.registry=i,this.path=s,this.key=s.map(function(A){return"["+A+"]"}).join(""),this.scope=p,this.errors=S,this.expectedType=l};function cc(i,s){for(var l,p=i.length-1,S=0,A=p,I=0;S<=A;)if((l=i[I=Math.floor((S+A)/2)])<=s){if(I===p||s<i[I+1])return I;S=I+1}else{if(!(l>s))throw new Zo("Input is not a number.");A=I-1}return 0}Mo.prototype.parse=function(i,s,l,p,S){return S===void 0&&(S={}),s?this.concat(s,l,p)._parse(i,S):this._parse(i,S)},Mo.prototype._parse=function(i,s){function l(re,de,we){return we==="assert"?new Uo(de,[re]):we==="coerce"?new ul(de,[re]):re}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=i[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var S=this.registry[p];if(S){var A=S.parse(i,this);if(!A)return null;if(this.expectedType){var I=this.expectedType,U=A.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||U.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||U.kind!=="value"&&U.kind!=="string"){if(this.checkSubtype(I,U))return null}else A=l(A,I,s.typeAnnotation||"coerce");else A=l(A,I,s.typeAnnotation||"assert")}if(!(A instanceof du)&&A.type.kind!=="resolvedImage"&&function re(de){if(de instanceof Eh)return re(de.boundExpression);if(de instanceof zu&&de.name==="error"||de instanceof cl||de instanceof su)return!1;var we=de instanceof ul||de instanceof Uo,Oe=!0;return de.eachChild(function(Ge){Oe=we?Oe&&re(Ge):Oe&&Ge instanceof du}),!!Oe&&_a(de)&&Su(de,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(A)){var q=new _c;try{A=new du(A.type,A.evaluate(q))}catch(re){return this.error(re.message),null}}return A}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof i+" instead.")},Mo.prototype.concat=function(i,s,l){var p=typeof i=="number"?this.path.concat(i):this.path,S=l?this.scope.concat(l):this.scope;return new Mo(this.registry,p,s||null,S,this.errors)},Mo.prototype.error=function(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var p=""+this.key+s.map(function(S){return"["+S+"]"}).join("");this.errors.push(new Yr(p,i))},Mo.prototype.checkSubtype=function(i,s){var l=Qs(i,s);return l&&this.error(l),l};var uu=function(i,s,l){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(var p=0,S=l;p<S.length;p+=1){var A=S[p],I=A[1];this.labels.push(A[0]),this.outputs.push(I)}};function Ja(i,s,l){return i*(1-l)+s*l}uu.parse=function(i,s){if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(i[1],1,qr);if(!l)return null;var p=[],S=null;s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType);for(var A=1;A<i.length;A+=2){var I=A===1?-1/0:i[A],U=i[A+1],q=A,re=A+1;if(typeof I!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(p.length&&p[p.length-1][0]>=I)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',q);var de=s.parse(U,re,S);if(!de)return null;S=S||de.type,p.push([I,de])}return new uu(S,l,p)},uu.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var p=this.input.evaluate(i);if(p<=s[0])return l[0].evaluate(i);var S=s.length;return p>=s[S-1]?l[S-1].evaluate(i):l[cc(s,p)].evaluate(i)},uu.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},uu.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},uu.prototype.serialize=function(){for(var i=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i};var rf=Object.freeze({__proto__:null,number:Ja,color:function(i,s,l){return new to(Ja(i.r,s.r,l),Ja(i.g,s.g,l),Ja(i.b,s.b,l),Ja(i.a,s.a,l))},array:function(i,s,l){return i.map(function(p,S){return Ja(p,s[S],l)})}}),Yu=6/29*3*(6/29),Vs=Math.PI/180,yh=180/Math.PI;function tl(i){return i>.008856451679035631?Math.pow(i,1/3):i/Yu+4/29}function vu(i){return i>6/29?i*i*i:Yu*(i-4/29)}function Ch(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Hf(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Vn(i){var s=Hf(i.r),l=Hf(i.g),p=Hf(i.b),S=tl((.4124564*s+.3575761*l+.1804375*p)/.95047),A=tl((.2126729*s+.7151522*l+.072175*p)/1);return{l:116*A-16,a:500*(S-A),b:200*(A-tl((.0193339*s+.119192*l+.9503041*p)/1.08883)),alpha:i.a}}function gi(i){var s=(i.l+16)/116,l=isNaN(i.a)?s:s+i.a/500,p=isNaN(i.b)?s:s-i.b/200;return s=1*vu(s),l=.95047*vu(l),p=1.08883*vu(p),new to(Ch(3.2404542*l-1.5371385*s-.4985314*p),Ch(-.969266*l+1.8760108*s+.041556*p),Ch(.0556434*l-.2040259*s+1.0572252*p),i.alpha)}function Hp(i,s,l){var p=s-i;return i+l*(p>180||p<-180?p-360*Math.round(p/360):p)}var nf={forward:Vn,reverse:gi,interpolate:function(i,s,l){return{l:Ja(i.l,s.l,l),a:Ja(i.a,s.a,l),b:Ja(i.b,s.b,l),alpha:Ja(i.alpha,s.alpha,l)}}},Gc={forward:function(i){var s=Vn(i),l=s.l,p=s.a,S=s.b,A=Math.atan2(S,p)*yh;return{h:A<0?A+360:A,c:Math.sqrt(p*p+S*S),l,alpha:i.a}},reverse:function(i){var s=i.h*Vs,l=i.c;return gi({l:i.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:i.alpha})},interpolate:function(i,s,l){return{h:Hp(i.h,s.h,l),c:Ja(i.c,s.c,l),l:Ja(i.l,s.l,l),alpha:Ja(i.alpha,s.alpha,l)}}},sd=Object.freeze({__proto__:null,lab:nf,hcl:Gc}),Bu=function(i,s,l,p,S){this.type=i,this.operator=s,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(var A=0,I=S;A<I.length;A+=1){var U=I[A],q=U[1];this.labels.push(U[0]),this.outputs.push(q)}};function $d(i,s,l,p){var S=p-l,A=i-l;return S===0?0:s===1?A/S:(Math.pow(s,A)-1)/(Math.pow(s,S)-1)}Bu.interpolationFactor=function(i,s,l,p){var S=0;if(i.name==="exponential")S=$d(s,i.base,l,p);else if(i.name==="linear")S=$d(s,1,l,p);else if(i.name==="cubic-bezier"){var A=i.controlPoints;S=new ee(A[0],A[1],A[2],A[3]).solve($d(s,1,l,p))}return S},Bu.parse=function(i,s){var l=i[0],p=i[1],S=i[2],A=i.slice(3);if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var I=p[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(p[0]),1,0);var U=p.slice(1);if(U.length!==4||U.some(function(ct){return typeof ct!="number"||ct<0||ct>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:U}}if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(S=s.parse(S,2,qr)))return null;var q=[],re=null;l==="interpolate-hcl"||l==="interpolate-lab"?re=jn:s.expectedType&&s.expectedType.kind!=="value"&&(re=s.expectedType);for(var de=0;de<A.length;de+=2){var we=A[de],Oe=A[de+1],Ge=de+3,it=de+4;if(typeof we!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ge);if(q.length&&q[q.length-1][0]>=we)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ge);var tt=s.parse(Oe,it,re);if(!tt)return null;re=re||tt.type,q.push([we,tt])}return re.kind==="number"||re.kind==="color"||re.kind==="array"&&re.itemType.kind==="number"&&typeof re.N=="number"?new Bu(re,l,p,S,q):s.error("Type "+oo(re)+" is not interpolatable.")},Bu.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var p=this.input.evaluate(i);if(p<=s[0])return l[0].evaluate(i);var S=s.length;if(p>=s[S-1])return l[S-1].evaluate(i);var A=cc(s,p),I=Bu.interpolationFactor(this.interpolation,p,s[A],s[A+1]),U=l[A].evaluate(i),q=l[A+1].evaluate(i);return this.operator==="interpolate"?rf[this.type.kind.toLowerCase()](U,q,I):this.operator==="interpolate-hcl"?Gc.reverse(Gc.interpolate(Gc.forward(U),Gc.forward(q),I)):nf.reverse(nf.interpolate(nf.forward(U),nf.forward(q),I))},Bu.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},Bu.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Bu.prototype.serialize=function(){var i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,i,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var rh=function(i,s){this.type=i,this.args=s};rh.parse=function(i,s){if(i.length<2)return s.error("Expectected at least one argument.");var l=null,p=s.expectedType;p&&p.kind!=="value"&&(l=p);for(var S=[],A=0,I=i.slice(1);A<I.length;A+=1){var U=s.parse(I[A],1+S.length,l,void 0,{typeAnnotation:"omit"});if(!U)return null;l=l||U.type,S.push(U)}var q=p&&S.some(function(re){return Qs(p,re.type)});return new rh(q?ni:l,S)},rh.prototype.evaluate=function(i){for(var s,l=null,p=0,S=0,A=this.args;S<A.length&&(p++,(l=A[S].evaluate(i))&&l instanceof Ss&&!l.available&&(s||(s=l.name),l=null,p===this.args.length&&(l=s)),l===null);S+=1);return l},rh.prototype.eachChild=function(i){this.args.forEach(i)},rh.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},rh.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(s){i.push(s.serialize())}),i};var Ah=function(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s};Ah.prototype.evaluate=function(i){return this.result.evaluate(i)},Ah.prototype.eachChild=function(i){for(var s=0,l=this.bindings;s<l.length;s+=1)i(l[s][1]);i(this.result)},Ah.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var l=[],p=1;p<i.length-1;p+=2){var S=i[p];if(typeof S!="string")return s.error("Expected string, but found "+typeof S+" instead.",p);if(/[^a-zA-Z0-9_]/.test(S))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);var A=s.parse(i[p+1],p+1);if(!A)return null;l.push([S,A])}var I=s.parse(i[i.length-1],i.length-1,s.expectedType,l);return I?new Ah(l,I):null},Ah.prototype.outputDefined=function(){return this.result.outputDefined()},Ah.prototype.serialize=function(){for(var i=["let"],s=0,l=this.bindings;s<l.length;s+=1){var p=l[s];i.push(p[0],p[1].serialize())}return i.push(this.result.serialize()),i};var lp=function(i,s,l){this.type=i,this.index=s,this.input=l};lp.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,qr),p=s.parse(i[2],2,ys(s.expectedType||ni));return l&&p?new lp(p.type.itemType,l,p):null},lp.prototype.evaluate=function(i){var s=this.index.evaluate(i),l=this.input.evaluate(i);if(s<0)throw new Zo("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Zo("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Zo("Array index must be an integer, but found "+s+" instead.");return l[s]},lp.prototype.eachChild=function(i){i(this.index),i(this.input)},lp.prototype.outputDefined=function(){return!1},lp.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hl=function(i,s){this.type=zn,this.needle=i,this.haystack=s};hl.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,ni),p=s.parse(i[2],2,ni);return l&&p?vo(l.type,[zn,li,qr,Nn,ni])?new hl(l,p):s.error("Expected first argument to be of type boolean, string, number or null, but found "+oo(l.type)+" instead"):null},hl.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!l)return!1;if(!as(s,["boolean","string","number","null"]))throw new Zo("Expected first argument to be of type boolean, string, number or null, but found "+oo(Io(s))+" instead.");if(!as(l,["string","array"]))throw new Zo("Expected second argument to be of type array or string, but found "+oo(Io(l))+" instead.");return l.indexOf(s)>=0},hl.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},hl.prototype.outputDefined=function(){return!0},hl.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var $f=function(i,s,l){this.type=qr,this.needle=i,this.haystack=s,this.fromIndex=l};$f.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,ni),p=s.parse(i[2],2,ni);if(!l||!p)return null;if(!vo(l.type,[zn,li,qr,Nn,ni]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+oo(l.type)+" instead");if(i.length===4){var S=s.parse(i[3],3,qr);return S?new $f(l,p,S):null}return new $f(l,p)},$f.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!as(s,["boolean","string","number","null"]))throw new Zo("Expected first argument to be of type boolean, string, number or null, but found "+oo(Io(s))+" instead.");if(!as(l,["string","array"]))throw new Zo("Expected second argument to be of type array or string, but found "+oo(Io(l))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(i);return l.indexOf(s,p)}return l.indexOf(s)},$f.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},$f.prototype.outputDefined=function(){return!1},$f.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Th=function(i,s,l,p,S,A){this.inputType=i,this.type=s,this.input=l,this.cases=p,this.outputs=S,this.otherwise=A};Th.parse=function(i,s){if(i.length<5)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!=1)return s.error("Expected an even number of arguments.");var l,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(var S={},A=[],I=2;I<i.length-1;I+=2){var U=i[I],q=i[I+1];Array.isArray(U)||(U=[U]);var re=s.concat(I);if(U.length===0)return re.error("Expected at least one branch label.");for(var de=0,we=U;de<we.length;de+=1){var Oe=we[de];if(typeof Oe!="number"&&typeof Oe!="string")return re.error("Branch labels must be numbers or strings.");if(typeof Oe=="number"&&Math.abs(Oe)>Number.MAX_SAFE_INTEGER)return re.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Oe=="number"&&Math.floor(Oe)!==Oe)return re.error("Numeric branch labels must be integer values.");if(l){if(re.checkSubtype(l,Io(Oe)))return null}else l=Io(Oe);if(S[String(Oe)]!==void 0)return re.error("Branch labels must be unique.");S[String(Oe)]=A.length}var Ge=s.parse(q,I,p);if(!Ge)return null;p=p||Ge.type,A.push(Ge)}var it=s.parse(i[1],1,ni);if(!it)return null;var tt=s.parse(i[i.length-1],i.length-1,p);return tt?it.type.kind!=="value"&&s.concat(1).checkSubtype(l,it.type)?null:new Th(l,p,it,S,A,tt):null},Th.prototype.evaluate=function(i){var s=this.input.evaluate(i);return(Io(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)},Th.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},Th.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},Th.prototype.serialize=function(){for(var i=this,s=["match",this.input.serialize()],l=[],p={},S=0,A=Object.keys(this.cases).sort();S<A.length;S+=1){var I=A[S];(we=p[this.cases[I]])===void 0?(p[this.cases[I]]=l.length,l.push([this.cases[I],[I]])):l[we][1].push(I)}for(var U=function(Ge){return i.inputType.kind==="number"?Number(Ge):Ge},q=0,re=l;q<re.length;q+=1){var de=re[q],we=de[0],Oe=de[1];s.push(Oe.length===1?U(Oe[0]):Oe.map(U)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var _h=function(i,s,l){this.type=i,this.branches=s,this.otherwise=l};_h.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var p=[],S=1;S<i.length-1;S+=2){var A=s.parse(i[S],S,zn);if(!A)return null;var I=s.parse(i[S+1],S+1,l);if(!I)return null;p.push([A,I]),l=l||I.type}var U=s.parse(i[i.length-1],i.length-1,l);return U?new _h(l,p,U):null},_h.prototype.evaluate=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var p=l[s],S=p[1];if(p[0].evaluate(i))return S.evaluate(i)}return this.otherwise.evaluate(i)},_h.prototype.eachChild=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var p=l[s],S=p[1];i(p[0]),i(S)}i(this.otherwise)},_h.prototype.outputDefined=function(){return this.branches.every(function(i){return i[1].outputDefined()})&&this.otherwise.outputDefined()},_h.prototype.serialize=function(){var i=["case"];return this.eachChild(function(s){i.push(s.serialize())}),i};var nh=function(i,s,l,p){this.type=i,this.input=s,this.beginIndex=l,this.endIndex=p};function $p(i,s){return i==="=="||i==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function cp(i,s,l,p){return p.compare(s,l)===0}function Mu(i,s,l){var p=i!=="=="&&i!=="!=";return function(){function S(A,I,U){this.type=zn,this.lhs=A,this.rhs=I,this.collator=U,this.hasUntypedArgument=A.type.kind==="value"||I.type.kind==="value"}return S.parse=function(A,I){if(A.length!==3&&A.length!==4)return I.error("Expected two or three arguments.");var U=A[0],q=I.parse(A[1],1,ni);if(!q)return null;if(!$p(U,q.type))return I.concat(1).error('"'+U+`" comparisons are not supported for type '`+oo(q.type)+"'.");var re=I.parse(A[2],2,ni);if(!re)return null;if(!$p(U,re.type))return I.concat(2).error('"'+U+`" comparisons are not supported for type '`+oo(re.type)+"'.");if(q.type.kind!==re.type.kind&&q.type.kind!=="value"&&re.type.kind!=="value")return I.error("Cannot compare types '"+oo(q.type)+"' and '"+oo(re.type)+"'.");p&&(q.type.kind==="value"&&re.type.kind!=="value"?q=new Uo(re.type,[q]):q.type.kind!=="value"&&re.type.kind==="value"&&(re=new Uo(q.type,[re])));var de=null;if(A.length===4){if(q.type.kind!=="string"&&re.type.kind!=="string"&&q.type.kind!=="value"&&re.type.kind!=="value")return I.error("Cannot use collator to compare non-string types.");if(!(de=I.parse(A[3],3,za)))return null}return new S(q,re,de)},S.prototype.evaluate=function(A){var I=this.lhs.evaluate(A),U=this.rhs.evaluate(A);if(p&&this.hasUntypedArgument){var q=Io(I),re=Io(U);if(q.kind!==re.kind||q.kind!=="string"&&q.kind!=="number")throw new Zo('Expected arguments for "'+i+'" to be (string, string) or (number, number), but found ('+q.kind+", "+re.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var de=Io(I),we=Io(U);if(de.kind!=="string"||we.kind!=="string")return s(A,I,U)}return this.collator?l(A,I,U,this.collator.evaluate(A)):s(A,I,U)},S.prototype.eachChild=function(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)},S.prototype.outputDefined=function(){return!0},S.prototype.serialize=function(){var A=[i];return this.eachChild(function(I){A.push(I.serialize())}),A},S}()}nh.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,ni),p=s.parse(i[2],2,qr);if(!l||!p)return null;if(!vo(l.type,[ys(ni),li,ni]))return s.error("Expected first argument to be of type array or string, but found "+oo(l.type)+" instead");if(i.length===4){var S=s.parse(i[3],3,qr);return S?new nh(l.type,l,p,S):null}return new nh(l.type,l,p)},nh.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=this.beginIndex.evaluate(i);if(!as(s,["string","array"]))throw new Zo("Expected first argument to be of type array or string, but found "+oo(Io(s))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(i);return s.slice(l,p)}return s.slice(l)},nh.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},nh.prototype.outputDefined=function(){return!1},nh.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var af=Mu("==",function(i,s,l){return s===l},cp),hp=Mu("!=",function(i,s,l){return s!==l},function(i,s,l,p){return!cp(0,s,l,p)}),ih=Mu("<",function(i,s,l){return s<l},function(i,s,l,p){return p.compare(s,l)<0}),fp=Mu(">",function(i,s,l){return s>l},function(i,s,l,p){return p.compare(s,l)>0}),Vh=Mu("<=",function(i,s,l){return s<=l},function(i,s,l,p){return p.compare(s,l)<=0}),Nu=Mu(">=",function(i,s,l){return s>=l},function(i,s,l,p){return p.compare(s,l)>=0}),Wf=function(i,s,l,p,S){this.type=li,this.number=i,this.locale=s,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=S};Wf.parse=function(i,s){if(i.length!==3)return s.error("Expected two arguments.");var l=s.parse(i[1],1,qr);if(!l)return null;var p=i[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");var S=null;if(p.locale&&!(S=s.parse(p.locale,1,li)))return null;var A=null;if(p.currency&&!(A=s.parse(p.currency,1,li)))return null;var I=null;if(p["min-fraction-digits"]&&!(I=s.parse(p["min-fraction-digits"],1,qr)))return null;var U=null;return p["max-fraction-digits"]&&!(U=s.parse(p["max-fraction-digits"],1,qr))?null:new Wf(l,S,A,I,U)},Wf.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},Wf.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},Wf.prototype.outputDefined=function(){return!1},Wf.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var Sf=function(i){this.type=qr,this.input=i};Sf.parse=function(i,s){if(i.length!==2)return s.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+oo(l.type)+" instead."):new Sf(l):null},Sf.prototype.evaluate=function(i){var s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Zo("Expected value to be of type string or array, but found "+oo(Io(s))+" instead.")},Sf.prototype.eachChild=function(i){i(this.input)},Sf.prototype.outputDefined=function(){return!1},Sf.prototype.serialize=function(){var i=["length"];return this.eachChild(function(s){i.push(s.serialize())}),i};var ko={"==":af,"!=":hp,">":fp,"<":ih,">=":Nu,"<=":Vh,array:Uo,at:lp,boolean:Uo,case:_h,coalesce:rh,collator:cl,format:Ws,image:eu,in:hl,"index-of":$f,interpolate:Bu,"interpolate-hcl":Bu,"interpolate-lab":Bu,length:Sf,let:Ah,literal:du,match:Th,number:Uo,"number-format":Wf,object:Uo,slice:nh,step:uu,string:Uo,"to-boolean":ul,"to-color":ul,"to-number":ul,"to-string":ul,var:Eh,within:su};function rl(i,s){var l=s[0],p=s[1],S=s[2],A=s[3];l=l.evaluate(i),p=p.evaluate(i),S=S.evaluate(i);var I=A?A.evaluate(i):1,U=eh(l,p,S,I);if(U)throw new Zo(U);return new to(l/255*I,p/255*I,S/255*I,I)}function pp(i,s){return i in s}function jo(i,s){var l=s[i];return l===void 0?null:l}function hc(i){return{type:i}}function _u(i){return{result:"success",value:i}}function mu(i){return{result:"error",value:i}}function Mh(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ud(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function of(i){return!!i.expression&&i.expression.interpolated}function Eu(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function dp(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Wp(i){return i}function Ph(i,s,l){return i!==void 0?i:s!==void 0?s:l!==void 0?l:void 0}function wd(i,s,l,p,S){return Ph(typeof l===S?p[l]:void 0,i.default,s.default)}function Xp(i,s,l){if(Eu(l)!=="number")return Ph(i.default,s.default);var p=i.stops.length;if(p===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[p-1][0])return i.stops[p-1][1];var S=cc(i.stops.map(function(A){return A[0]}),l);return i.stops[S][1]}function vp(i,s,l){var p=i.base!==void 0?i.base:1;if(Eu(l)!=="number")return Ph(i.default,s.default);var S=i.stops.length;if(S===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[S-1][0])return i.stops[S-1][1];var A=cc(i.stops.map(function(we){return we[0]}),l),I=function(we,Oe,Ge,it){var tt=it-Ge,ct=we-Ge;return tt===0?0:Oe===1?ct/tt:(Math.pow(Oe,ct)-1)/(Math.pow(Oe,tt)-1)}(l,p,i.stops[A][0],i.stops[A+1][0]),U=i.stops[A][1],q=i.stops[A+1][1],re=rf[s.type]||Wp;if(i.colorSpace&&i.colorSpace!=="rgb"){var de=sd[i.colorSpace];re=function(we,Oe){return de.reverse(de.interpolate(de.forward(we),de.forward(Oe),I))}}return typeof U.evaluate=="function"?{evaluate:function(){for(var we=[],Oe=arguments.length;Oe--;)we[Oe]=arguments[Oe];var Ge=U.evaluate.apply(void 0,we),it=q.evaluate.apply(void 0,we);if(Ge!==void 0&&it!==void 0)return re(Ge,it,I)}}:re(U,q,I)}function Ga(i,s,l){return s.type==="color"?l=to.parse(l):s.type==="formatted"?l=ws.fromString(l.toString()):s.type==="resolvedImage"?l=Ss.fromString(l.toString()):Eu(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),Ph(l,i.default,s.default)}zu.register(ko,{error:[{kind:"error"},[li],function(i,s){throw new Zo(s[0].evaluate(i))}],typeof:[li,[ni],function(i,s){return oo(Io(s[0].evaluate(i)))}],"to-rgba":[ys(qr,4),[jn],function(i,s){return s[0].evaluate(i).toArray()}],rgb:[jn,[qr,qr,qr],rl],rgba:[jn,[qr,qr,qr,qr],rl],has:{type:zn,overloads:[[[li],function(i,s){return pp(s[0].evaluate(i),i.properties())}],[[li,Ca],function(i,s){var l=s[1];return pp(s[0].evaluate(i),l.evaluate(i))}]]},get:{type:ni,overloads:[[[li],function(i,s){return jo(s[0].evaluate(i),i.properties())}],[[li,Ca],function(i,s){var l=s[1];return jo(s[0].evaluate(i),l.evaluate(i))}]]},"feature-state":[ni,[li],function(i,s){return jo(s[0].evaluate(i),i.featureState||{})}],properties:[Ca,[],function(i){return i.properties()}],"geometry-type":[li,[],function(i){return i.geometryType()}],id:[ni,[],function(i){return i.id()}],zoom:[qr,[],function(i){return i.globals.zoom}],"heatmap-density":[qr,[],function(i){return i.globals.heatmapDensity||0}],"line-progress":[qr,[],function(i){return i.globals.lineProgress||0}],accumulated:[ni,[],function(i){return i.globals.accumulated===void 0?null:i.globals.accumulated}],"+":[qr,hc(qr),function(i,s){for(var l=0,p=0,S=s;p<S.length;p+=1)l+=S[p].evaluate(i);return l}],"*":[qr,hc(qr),function(i,s){for(var l=1,p=0,S=s;p<S.length;p+=1)l*=S[p].evaluate(i);return l}],"-":{type:qr,overloads:[[[qr,qr],function(i,s){var l=s[1];return s[0].evaluate(i)-l.evaluate(i)}],[[qr],function(i,s){return-s[0].evaluate(i)}]]},"/":[qr,[qr,qr],function(i,s){var l=s[1];return s[0].evaluate(i)/l.evaluate(i)}],"%":[qr,[qr,qr],function(i,s){var l=s[1];return s[0].evaluate(i)%l.evaluate(i)}],ln2:[qr,[],function(){return Math.LN2}],pi:[qr,[],function(){return Math.PI}],e:[qr,[],function(){return Math.E}],"^":[qr,[qr,qr],function(i,s){var l=s[1];return Math.pow(s[0].evaluate(i),l.evaluate(i))}],sqrt:[qr,[qr],function(i,s){return Math.sqrt(s[0].evaluate(i))}],log10:[qr,[qr],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN10}],ln:[qr,[qr],function(i,s){return Math.log(s[0].evaluate(i))}],log2:[qr,[qr],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN2}],sin:[qr,[qr],function(i,s){return Math.sin(s[0].evaluate(i))}],cos:[qr,[qr],function(i,s){return Math.cos(s[0].evaluate(i))}],tan:[qr,[qr],function(i,s){return Math.tan(s[0].evaluate(i))}],asin:[qr,[qr],function(i,s){return Math.asin(s[0].evaluate(i))}],acos:[qr,[qr],function(i,s){return Math.acos(s[0].evaluate(i))}],atan:[qr,[qr],function(i,s){return Math.atan(s[0].evaluate(i))}],min:[qr,hc(qr),function(i,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(i)}))}],max:[qr,hc(qr),function(i,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(i)}))}],abs:[qr,[qr],function(i,s){return Math.abs(s[0].evaluate(i))}],round:[qr,[qr],function(i,s){var l=s[0].evaluate(i);return l<0?-Math.round(-l):Math.round(l)}],floor:[qr,[qr],function(i,s){return Math.floor(s[0].evaluate(i))}],ceil:[qr,[qr],function(i,s){return Math.ceil(s[0].evaluate(i))}],"filter-==":[zn,[li,ni],function(i,s){var l=s[0],p=s[1];return i.properties()[l.value]===p.value}],"filter-id-==":[zn,[ni],function(i,s){var l=s[0];return i.id()===l.value}],"filter-type-==":[zn,[li],function(i,s){var l=s[0];return i.geometryType()===l.value}],"filter-<":[zn,[li,ni],function(i,s){var l=s[0],p=s[1],S=i.properties()[l.value],A=p.value;return typeof S==typeof A&&S<A}],"filter-id-<":[zn,[ni],function(i,s){var l=s[0],p=i.id(),S=l.value;return typeof p==typeof S&&p<S}],"filter->":[zn,[li,ni],function(i,s){var l=s[0],p=s[1],S=i.properties()[l.value],A=p.value;return typeof S==typeof A&&S>A}],"filter-id->":[zn,[ni],function(i,s){var l=s[0],p=i.id(),S=l.value;return typeof p==typeof S&&p>S}],"filter-<=":[zn,[li,ni],function(i,s){var l=s[0],p=s[1],S=i.properties()[l.value],A=p.value;return typeof S==typeof A&&S<=A}],"filter-id-<=":[zn,[ni],function(i,s){var l=s[0],p=i.id(),S=l.value;return typeof p==typeof S&&p<=S}],"filter->=":[zn,[li,ni],function(i,s){var l=s[0],p=s[1],S=i.properties()[l.value],A=p.value;return typeof S==typeof A&&S>=A}],"filter-id->=":[zn,[ni],function(i,s){var l=s[0],p=i.id(),S=l.value;return typeof p==typeof S&&p>=S}],"filter-has":[zn,[ni],function(i,s){return s[0].value in i.properties()}],"filter-has-id":[zn,[],function(i){return i.id()!==null&&i.id()!==void 0}],"filter-type-in":[zn,[ys(li)],function(i,s){return s[0].value.indexOf(i.geometryType())>=0}],"filter-id-in":[zn,[ys(ni)],function(i,s){return s[0].value.indexOf(i.id())>=0}],"filter-in-small":[zn,[li,ys(ni)],function(i,s){var l=s[0];return s[1].value.indexOf(i.properties()[l.value])>=0}],"filter-in-large":[zn,[li,ys(ni)],function(i,s){var l=s[0],p=s[1];return function(S,A,I,U){for(;I<=U;){var q=I+U>>1;if(A[q]===S)return!0;A[q]>S?U=q-1:I=q+1}return!1}(i.properties()[l.value],p.value,0,p.value.length-1)}],all:{type:zn,overloads:[[[zn,zn],function(i,s){var l=s[1];return s[0].evaluate(i)&&l.evaluate(i)}],[hc(zn),function(i,s){for(var l=0,p=s;l<p.length;l+=1)if(!p[l].evaluate(i))return!1;return!0}]]},any:{type:zn,overloads:[[[zn,zn],function(i,s){var l=s[1];return s[0].evaluate(i)||l.evaluate(i)}],[hc(zn),function(i,s){for(var l=0,p=s;l<p.length;l+=1)if(p[l].evaluate(i))return!0;return!1}]]},"!":[zn,[zn],function(i,s){return!s[0].evaluate(i)}],"is-supported-script":[zn,[li],function(i,s){var l=i.globals&&i.globals.isSupportedScript;return!l||l(s[0].evaluate(i))}],upcase:[li,[li],function(i,s){return s[0].evaluate(i).toUpperCase()}],downcase:[li,[li],function(i,s){return s[0].evaluate(i).toLowerCase()}],concat:[li,hc(ni),function(i,s){return s.map(function(l){return bo(l.evaluate(i))}).join("")}],"resolved-locale":[li,[za],function(i,s){return s[0].evaluate(i).resolvedLocale()}]});var mp=function(i,s){this.expression=i,this._warningHistory={},this._evaluator=new _c,this._defaultValue=s?function(l){return l.type==="color"&&dp(l.default)?new to(0,0,0,0):l.type==="color"?to.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Hc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ko}function gp(i,s){var l=new Mo(ko,[],s?function(S){var A={color:jn,string:li,number:qr,enum:li,boolean:zn,formatted:Ao,resolvedImage:io};return S.type==="array"?ys(A[S.value]||ni,S.length):A[S.type]}(s):void 0),p=l.parse(i,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?_u(new mp(p,s)):mu(l.errors)}mp.prototype.evaluateWithoutErrorHandling=function(i,s,l,p,S,A){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)},mp.prototype.evaluate=function(i,s,l,p,S,A){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=A||null;try{var I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Zo("Expected value to be one of "+Object.keys(this._enumValues).map(function(U){return JSON.stringify(U)}).join(", ")+", but found "+JSON.stringify(I)+" instead.");return I}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console!="undefined"&&console.warn(U.message)),this._defaultValue}};var sf=function(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent=i!=="constant"&&!os(s.expression)};sf.prototype.evaluateWithoutErrorHandling=function(i,s,l,p,S,A){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,p,S,A)},sf.prototype.evaluate=function(i,s,l,p,S,A){return this._styleExpression.evaluate(i,s,l,p,S,A)};var ah=function(i,s,l,p){this.kind=i,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!os(s.expression),this.interpolationType=p};function wo(i,s){if((i=gp(i,s)).result==="error")return i;var l=i.value.expression,p=_a(l);if(!p&&!Mh(s))return mu([new Yr("","data expressions not supported")]);var S=Su(l,["zoom"]);if(!S&&!ud(s))return mu([new Yr("","zoom expressions not supported")]);var A=function I(U){var q=null;if(U instanceof Ah)q=I(U.result);else if(U instanceof rh)for(var re=0,de=U.args;re<de.length&&!(q=I(de[re]));re+=1);else(U instanceof uu||U instanceof Bu)&&U.input instanceof zu&&U.input.name==="zoom"&&(q=U);return q instanceof Yr||U.eachChild(function(we){var Oe=I(we);Oe instanceof Yr?q=Oe:!q&&Oe?q=new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):q&&Oe&&q!==Oe&&(q=new Yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),q}(l);return A||S?A instanceof Yr?mu([A]):A instanceof Bu&&!of(s)?mu([new Yr("",'"interpolate" expressions cannot be used with this property')]):_u(A?new ah(p?"camera":"composite",i.value,A.labels,A instanceof Bu?A.interpolation:void 0):new sf(p?"constant":"source",i.value)):mu([new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ah.prototype.evaluateWithoutErrorHandling=function(i,s,l,p,S,A){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,p,S,A)},ah.prototype.evaluate=function(i,s,l,p,S,A){return this._styleExpression.evaluate(i,s,l,p,S,A)},ah.prototype.interpolationFactor=function(i,s,l){return this.interpolationType?Bu.interpolationFactor(this.interpolationType,i,s,l):0};var fl=function(i,s){this._parameters=i,this._specification=s,yt(this,function l(p,S){var A,I,U,q=S.type==="color",re=p.stops&&typeof p.stops[0][0]=="object",de=re||!(re||p.property!==void 0),we=p.type||(of(S)?"exponential":"interval");if(q&&((p=yt({},p)).stops&&(p.stops=p.stops.map(function(On){return[On[0],to.parse(On[1])]})),p.default=to.parse(p.default?p.default:S.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!sd[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(we==="exponential")A=vp;else if(we==="interval")A=Xp;else if(we==="categorical"){A=wd,I=Object.create(null);for(var Oe=0,Ge=p.stops;Oe<Ge.length;Oe+=1){var it=Ge[Oe];I[it[0]]=it[1]}U=typeof p.stops[0][0]}else{if(we!=="identity")throw new Error('Unknown function type "'+we+'"');A=Ga}if(re){for(var tt={},ct=[],ut=0;ut<p.stops.length;ut++){var Je=p.stops[ut],Pt=Je[0].zoom;tt[Pt]===void 0&&(tt[Pt]={zoom:Pt,type:p.type,property:p.property,default:p.default,stops:[]},ct.push(Pt)),tt[Pt].stops.push([Je[0].value,Je[1]])}for(var Xt=[],pr=0,Ur=ct;pr<Ur.length;pr+=1){var tn=Ur[pr];Xt.push([tt[tn].zoom,l(tt[tn],S)])}var An={name:"linear"};return{kind:"composite",interpolationType:An,interpolationFactor:Bu.interpolationFactor.bind(void 0,An),zoomStops:Xt.map(function(On){return On[0]}),evaluate:function(On,si){var kn=On.zoom;return vp({stops:Xt,base:p.base},S,kn).evaluate(kn,si)}}}if(de){var xi=we==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:xi,interpolationFactor:Bu.interpolationFactor.bind(void 0,xi),zoomStops:p.stops.map(function(On){return On[0]}),evaluate:function(On){return A(p,S,On.zoom,I,U)}}}return{kind:"source",evaluate:function(On,si){var kn=si&&si.properties?si.properties[p.property]:void 0;return kn===void 0?Ph(p.default,S.default):A(p,S,kn,I,U)}}}(this._parameters,this._specification))};function pl(i){var s=i.key,l=i.value,p=i.valueSpec||{},S=i.objectElementValidators||{},A=i.style,I=i.styleSpec,U=[],q=Eu(l);if(q!=="object")return[new Me(s,l,"object expected, "+q+" found")];for(var re in l){var de=re.split(".")[0],we=p[de]||p["*"],Oe=void 0;if(S[de])Oe=S[de];else if(p[de])Oe=vs;else if(S["*"])Oe=S["*"];else{if(!p["*"]){U.push(new Me(s,l[re],'unknown property "'+re+'"'));continue}Oe=vs}U=U.concat(Oe({key:(s&&s+".")+re,value:l[re],valueSpec:we,style:A,styleSpec:I,object:l,objectKey:re},l))}for(var Ge in p)S[Ge]||p[Ge].required&&p[Ge].default===void 0&&l[Ge]===void 0&&U.push(new Me(s,l,'missing required property "'+Ge+'"'));return U}function bh(i){var s=i.value,l=i.valueSpec,p=i.style,S=i.styleSpec,A=i.key,I=i.arrayElementValidator||vs;if(Eu(s)!=="array")return[new Me(A,s,"array expected, "+Eu(s)+" found")];if(l.length&&s.length!==l.length)return[new Me(A,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new Me(A,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var U={type:l.value,values:l.values};S.$version<7&&(U.function=l.function),Eu(l.value)==="object"&&(U=l.value);for(var q=[],re=0;re<s.length;re++)q=q.concat(I({array:s,arrayIndex:re,value:s[re],valueSpec:U,style:p,styleSpec:S,key:A+"["+re+"]"}));return q}function Xf(i){var s=i.key,l=i.value,p=i.valueSpec,S=Eu(l);return S==="number"&&l!=l&&(S="NaN"),S!=="number"?[new Me(s,l,"number expected, "+S+" found")]:"minimum"in p&&l<p.minimum?[new Me(s,l,l+" is less than the minimum value "+p.minimum)]:"maximum"in p&&l>p.maximum?[new Me(s,l,l+" is greater than the maximum value "+p.maximum)]:[]}function yp(i){var s,l,p,S=i.valueSpec,A=zt(i.value.type),I={},U=A!=="categorical"&&i.value.property===void 0,q=!U,re=Eu(i.value.stops)==="array"&&Eu(i.value.stops[0])==="array"&&Eu(i.value.stops[0][0])==="object",de=pl({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Ge){if(A==="identity")return[new Me(Ge.key,Ge.value,'identity function may not have a "stops" property')];var it=[],tt=Ge.value;return it=it.concat(bh({key:Ge.key,value:tt,valueSpec:Ge.valueSpec,style:Ge.style,styleSpec:Ge.styleSpec,arrayElementValidator:we})),Eu(tt)==="array"&&tt.length===0&&it.push(new Me(Ge.key,tt,"array must have at least one stop")),it},default:function(Ge){return vs({key:Ge.key,value:Ge.value,valueSpec:S,style:Ge.style,styleSpec:Ge.styleSpec})}}});return A==="identity"&&U&&de.push(new Me(i.key,i.value,'missing required property "property"')),A==="identity"||i.value.stops||de.push(new Me(i.key,i.value,'missing required property "stops"')),A==="exponential"&&i.valueSpec.expression&&!of(i.valueSpec)&&de.push(new Me(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(q&&!Mh(i.valueSpec)?de.push(new Me(i.key,i.value,"property functions not supported")):U&&!ud(i.valueSpec)&&de.push(new Me(i.key,i.value,"zoom functions not supported"))),A!=="categorical"&&!re||i.value.property!==void 0||de.push(new Me(i.key,i.value,'"property" property is required')),de;function we(Ge){var it=[],tt=Ge.value,ct=Ge.key;if(Eu(tt)!=="array")return[new Me(ct,tt,"array expected, "+Eu(tt)+" found")];if(tt.length!==2)return[new Me(ct,tt,"array length 2 expected, length "+tt.length+" found")];if(re){if(Eu(tt[0])!=="object")return[new Me(ct,tt,"object expected, "+Eu(tt[0])+" found")];if(tt[0].zoom===void 0)return[new Me(ct,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new Me(ct,tt,"object stop key must have value")];if(p&&p>zt(tt[0].zoom))return[new Me(ct,tt[0].zoom,"stop zoom values must appear in ascending order")];zt(tt[0].zoom)!==p&&(p=zt(tt[0].zoom),l=void 0,I={}),it=it.concat(pl({key:ct+"[0]",value:tt[0],valueSpec:{zoom:{}},style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{zoom:Xf,value:Oe}}))}else it=it.concat(Oe({key:ct+"[0]",value:tt[0],valueSpec:{},style:Ge.style,styleSpec:Ge.styleSpec},tt));return Hc(Ze(tt[1]))?it.concat([new Me(ct+"[1]",tt[1],"expressions are not allowed in function stops.")]):it.concat(vs({key:ct+"[1]",value:tt[1],valueSpec:S,style:Ge.style,styleSpec:Ge.styleSpec}))}function Oe(Ge,it){var tt=Eu(Ge.value),ct=zt(Ge.value),ut=Ge.value!==null?Ge.value:it;if(s){if(tt!==s)return[new Me(Ge.key,ut,tt+" stop domain type must match previous stop domain type "+s)]}else s=tt;if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new Me(Ge.key,ut,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&A!=="categorical"){var Je="number expected, "+tt+" found";return Mh(S)&&A===void 0&&(Je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(Ge.key,ut,Je)]}return A!=="categorical"||tt!=="number"||isFinite(ct)&&Math.floor(ct)===ct?A!=="categorical"&&tt==="number"&&l!==void 0&&ct<l?[new Me(Ge.key,ut,"stop domain values must appear in ascending order")]:(l=ct,A==="categorical"&&ct in I?[new Me(Ge.key,ut,"stop domain values must be unique")]:(I[ct]=!0,[])):[new Me(Ge.key,ut,"integer expected, found "+ct)]}}function Gh(i){var s=(i.expressionContext==="property"?wo:gp)(Ze(i.value),i.valueSpec);if(s.result==="error")return s.value.map(function(p){return new Me(""+i.key+p.key,i.value,p.message)});var l=s.value.expression||s.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!l.outputDefined())return[new Me(i.key,i.value,'Invalid data expression for "'+i.propertyKey+'". Output values must be contained as literals within the expression.')];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!os(l))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!os(l))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Su(l,["zoom","feature-state"]))return[new Me(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!_a(l))return[new Me(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vu(i){var s=i.key,l=i.value,p=i.valueSpec,S=[];return Array.isArray(p.values)?p.values.indexOf(zt(l))===-1&&S.push(new Me(s,l,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(p.values).indexOf(zt(l))===-1&&S.push(new Me(s,l,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(l)+" found")),S}function Yf(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(var s=0,l=i.slice(1);s<l.length;s+=1){var p=l[s];if(!Yf(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}fl.deserialize=function(i){return new fl(i._parameters,i._specification)},fl.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};var Ll={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uf(i){if(i==null)return{filter:function(){return!0},needGeometry:!1};Yf(i)||(i=kh(i));var s=gp(i,Ll);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,p,S){return s.value.evaluate(l,p,{},S)},needGeometry:function l(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var S=1;S<p.length;S++)if(l(p[S]))return!0;return!1}(i)}}function Pp(i,s){return i<s?-1:i>s?1:0}function kh(i){if(!i)return!0;var s,l=i[0];return i.length<=1?l!=="any":l==="=="?Xs(i[1],i[2],"=="):l==="!="?bp(Xs(i[1],i[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Xs(i[1],i[2],l):l==="any"?(s=i.slice(1),["any"].concat(s.map(kh))):l==="all"?["all"].concat(i.slice(1).map(kh)):l==="none"?["all"].concat(i.slice(1).map(kh).map(bp)):l==="in"?qf(i[1],i.slice(2)):l==="!in"?bp(qf(i[1],i.slice(2))):l==="has"?_p(i[1]):l==="!has"?bp(_p(i[1])):l!=="within"||i}function Xs(i,s,l){switch(i){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,i,s]}}function qf(i,s){if(s.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",i,["literal",s.sort(Pp)]]:["filter-in-small",i,["literal",s]]}}function _p(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function bp(i){return["!",i]}function Yp(i){return Yf(Ze(i.value))?Gh(yt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var p=l.value,S=l.key;if(Eu(p)!=="array")return[new Me(S,p,"array expected, "+Eu(p)+" found")];var A,I=l.styleSpec,U=[];if(p.length<1)return[new Me(S,p,"filter array must have at least 1 element")];switch(U=U.concat(Vu({key:S+"[0]",value:p[0],valueSpec:I.filter_operator,style:l.style,styleSpec:l.styleSpec})),zt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&zt(p[1])==="$type"&&U.push(new Me(S,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&U.push(new Me(S,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(A=Eu(p[1]))!=="string"&&U.push(new Me(S+"[1]",p[1],"string expected, "+A+" found"));for(var q=2;q<p.length;q++)A=Eu(p[q]),zt(p[1])==="$type"?U=U.concat(Vu({key:S+"["+q+"]",value:p[q],valueSpec:I.geometry_type,style:l.style,styleSpec:l.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&U.push(new Me(S+"["+q+"]",p[q],"string, number, or boolean expected, "+A+" found"));break;case"any":case"all":case"none":for(var re=1;re<p.length;re++)U=U.concat(s({key:S+"["+re+"]",value:p[re],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":A=Eu(p[1]),p.length!==2?U.push(new Me(S,p,'filter array for "'+p[0]+'" operator must have 2 elements')):A!=="string"&&U.push(new Me(S+"[1]",p[1],"string expected, "+A+" found"));break;case"within":A=Eu(p[1]),p.length!==2?U.push(new Me(S,p,'filter array for "'+p[0]+'" operator must have 2 elements')):A!=="object"&&U.push(new Me(S+"[1]",p[1],"object expected, "+A+" found"))}return U}(i)}function kp(i,s){var l=i.key,p=i.style,S=i.styleSpec,A=i.value,I=i.objectKey,U=S[s+"_"+i.layerType];if(!U)return[];var q=I.match(/^(.*)-transition$/);if(s==="paint"&&q&&U[q[1]]&&U[q[1]].transition)return vs({key:l,value:A,valueSpec:S.transition,style:p,styleSpec:S});var re,de=i.valueSpec||U[I];if(!de)return[new Me(l,A,'unknown property "'+I+'"')];if(Eu(A)==="string"&&Mh(de)&&!de.tokens&&(re=/^{([^}]+)}$/.exec(A)))return[new Me(l,A,'"'+I+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(re[1])+" }`.")];var we=[];return i.layerType==="symbol"&&(I==="text-field"&&p&&!p.glyphs&&we.push(new Me(l,A,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&dp(Ze(A))&&zt(A.type)==="identity"&&we.push(new Me(l,A,'"text-font" does not support identity functions'))),we.concat(vs({key:i.key,value:A,valueSpec:de,style:p,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:I}))}function xp(i){return kp(i,"paint")}function Kl(i){return kp(i,"layout")}function $c(i){var s=[],l=i.value,p=i.key,S=i.style,A=i.styleSpec;l.type||l.ref||s.push(new Me(p,l,'either "type" or "ref" is required'));var I,U=zt(l.type),q=zt(l.ref);if(l.id)for(var re=zt(l.id),de=0;de<i.arrayIndex;de++){var we=S.layers[de];zt(we.id)===re&&s.push(new Me(p,l.id,'duplicate layer id "'+l.id+'", previously used at line '+we.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(it){it in l&&s.push(new Me(p,l[it],'"'+it+'" is prohibited for ref layers'))}),S.layers.forEach(function(it){zt(it.id)===q&&(I=it)}),I?I.ref?s.push(new Me(p,l.ref,"ref cannot reference another ref layer")):U=zt(I.type):s.push(new Me(p,l.ref,'ref layer "'+q+'" not found'));else if(U!=="background")if(l.source){var Oe=S.sources&&S.sources[l.source],Ge=Oe&&zt(Oe.type);Oe?Ge==="vector"&&U==="raster"?s.push(new Me(p,l.source,'layer "'+l.id+'" requires a raster source')):Ge==="raster"&&U!=="raster"?s.push(new Me(p,l.source,'layer "'+l.id+'" requires a vector source')):Ge!=="vector"||l["source-layer"]?Ge==="raster-dem"&&U!=="hillshade"?s.push(new Me(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):U!=="line"||!l.paint||!l.paint["line-gradient"]||Ge==="geojson"&&Oe.lineMetrics||s.push(new Me(p,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new Me(p,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new Me(p,l.source,'source "'+l.source+'" not found'))}else s.push(new Me(p,l,'missing required property "source"'));return s=s.concat(pl({key:p,value:l,valueSpec:A.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return vs({key:p+".type",value:l.type,valueSpec:A.layer.type,style:i.style,styleSpec:i.styleSpec,object:l,objectKey:"type"})},filter:Yp,layout:function(it){return pl({layer:l,key:it.key,value:it.value,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{"*":function(tt){return Kl(yt({layerType:U},tt))}}})},paint:function(it){return pl({layer:l,key:it.key,value:it.value,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{"*":function(tt){return xp(yt({layerType:U},tt))}}})}}}))}function Rl(i){var s=i.value,l=i.key,p=Eu(s);return p!=="string"?[new Me(l,s,"string expected, "+p+" found")]:[]}var Ms={promoteId:function(i){var s=i.key,l=i.value;if(Eu(l)==="string")return Rl({key:s,value:l});var p=[];for(var S in l)p.push.apply(p,Rl({key:s+"."+S,value:l[S]}));return p}};function Hh(i){var s=i.value,l=i.key,p=i.styleSpec,S=i.style;if(!s.type)return[new Me(l,s,'"type" is required')];var A,I=zt(s.type);switch(I){case"vector":case"raster":case"raster-dem":return pl({key:l,value:s,valueSpec:p["source_"+I.replace("-","_")],style:i.style,styleSpec:p,objectElementValidators:Ms});case"geojson":if(A=pl({key:l,value:s,valueSpec:p.source_geojson,style:S,styleSpec:p,objectElementValidators:Ms}),s.cluster)for(var U in s.clusterProperties){var q=s.clusterProperties[U],re=q[0],de=typeof re=="string"?[re,["accumulated"],["get",U]]:re;A.push.apply(A,Gh({key:l+"."+U+".map",value:q[1],expressionContext:"cluster-map"})),A.push.apply(A,Gh({key:l+"."+U+".reduce",value:de,expressionContext:"cluster-reduce"}))}return A;case"video":return pl({key:l,value:s,valueSpec:p.source_video,style:S,styleSpec:p});case"image":return pl({key:l,value:s,valueSpec:p.source_image,style:S,styleSpec:p});case"canvas":return[new Me(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vu({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:S,styleSpec:p})}}function lf(i){var s=i.value,l=i.styleSpec,p=l.light,S=i.style,A=[],I=Eu(s);if(s===void 0)return A;if(I!=="object")return A.concat([new Me("light",s,"object expected, "+I+" found")]);for(var U in s){var q=U.match(/^(.*)-transition$/);A=A.concat(q&&p[q[1]]&&p[q[1]].transition?vs({key:U,value:s[U],valueSpec:l.transition,style:S,styleSpec:l}):p[U]?vs({key:U,value:s[U],valueSpec:p[U],style:S,styleSpec:l}):[new Me(U,s[U],'unknown property "'+U+'"')])}return A}var Ef={"*":function(){return[]},array:bh,boolean:function(i){var s=i.value,l=i.key,p=Eu(s);return p!=="boolean"?[new Me(l,s,"boolean expected, "+p+" found")]:[]},number:Xf,color:function(i){var s=i.key,l=i.value,p=Eu(l);return p!=="string"?[new Me(s,l,"color expected, "+p+" found")]:To(l)===null?[new Me(s,l,'color expected, "'+l+'" found')]:[]},constants:Be,enum:Vu,filter:Yp,function:yp,layer:$c,object:pl,source:Hh,light:lf,string:Rl,formatted:function(i){return Rl(i).length===0?[]:Gh(i)},resolvedImage:function(i){return Rl(i).length===0?[]:Gh(i)}};function vs(i){var s=i.value,l=i.valueSpec,p=i.styleSpec;return l.expression&&dp(zt(s))?yp(i):l.expression&&Hc(Ze(s))?Gh(i):l.type&&Ef[l.type]?Ef[l.type](i):pl(yt({},i,{valueSpec:l.type?p[l.type]:l}))}function Ns(i){var s=i.value,l=i.key,p=Rl(i);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new Me(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new Me(l,s,'"glyphs" url must include a "{range}" token'))),p}function bc(i,s){s===void 0&&(s=Fe);var l=[];return l=l.concat(vs({key:"",value:i,valueSpec:s.$root,styleSpec:s,style:i,objectElementValidators:{glyphs:Ns,"*":function(){return[]}}})),i.constants&&(l=l.concat(Be({key:"constants",value:i.constants,style:i,styleSpec:s}))),fc(l)}function fc(i){return[].concat(i).sort(function(s,l){return s.line-l.line})}function xc(i){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return fc(i.apply(this,s))}}bc.source=xc(Hh),bc.light=xc(lf),bc.layer=xc($c),bc.filter=xc(Yp),bc.paintProperty=xc(xp),bc.layoutProperty=xc(Kl);var Pe=bc,Ih=Pe.light,cf=Pe.paintProperty,Cf=Pe.layoutProperty;function Af(i,s){var l=!1;if(s&&s.length)for(var p=0,S=s;p<S.length;p+=1)i.fire(new Qe(new Error(S[p].message))),l=!0;return l}var Lh=Cu;function Cu(i,s,l){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var S=new Int32Array(this.arrayBuffer);i=S[0],this.d=(s=S[1])+2*(l=S[2]);for(var A=0;A<this.d*this.d;A++){var I=S[3+A],U=S[3+A+1];p.push(I===U?null:S.subarray(I,U))}var q=S[3+p.length+1];this.keys=S.subarray(S[3+p.length],q),this.bboxes=S.subarray(q),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var re=0;re<this.d*this.d;re++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=l,this.scale=s/i,this.uid=0;var de=l/s*i;this.min=-de,this.max=i+de}Cu.prototype.insert=function(i,s,l,p,S){this._forEachCell(s,l,p,S,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(S)},Cu.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Cu.prototype._insertCell=function(i,s,l,p,S,A){this.cells[S].push(A)},Cu.prototype.query=function(i,s,l,p,S){var A=this.min,I=this.max;if(i<=A&&s<=A&&I<=l&&I<=p&&!S)return Array.prototype.slice.call(this.keys);var U=[];return this._forEachCell(i,s,l,p,this._queryCell,U,{},S),U},Cu.prototype._queryCell=function(i,s,l,p,S,A,I,U){var q=this.cells[S];if(q!==null)for(var re=this.keys,de=this.bboxes,we=0;we<q.length;we++){var Oe=q[we];if(I[Oe]===void 0){var Ge=4*Oe;(U?U(de[Ge+0],de[Ge+1],de[Ge+2],de[Ge+3]):i<=de[Ge+2]&&s<=de[Ge+3]&&l>=de[Ge+0]&&p>=de[Ge+1])?(I[Oe]=!0,A.push(re[Oe])):I[Oe]=!1}}},Cu.prototype._forEachCell=function(i,s,l,p,S,A,I,U){for(var q=this._convertToCellCoord(i),re=this._convertToCellCoord(s),de=this._convertToCellCoord(l),we=this._convertToCellCoord(p),Oe=q;Oe<=de;Oe++)for(var Ge=re;Ge<=we;Ge++){var it=this.d*Ge+Oe;if((!U||U(this._convertFromCellCoord(Oe),this._convertFromCellCoord(Ge),this._convertFromCellCoord(Oe+1),this._convertFromCellCoord(Ge+1)))&&S.call(this,i,s,l,p,it,A,I,U))return}},Cu.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Cu.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Cu.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=3+this.cells.length+1+1,l=0,p=0;p<this.cells.length;p++)l+=this.cells[p].length;var S=new Int32Array(s+l+this.keys.length+this.bboxes.length);S[0]=this.extent,S[1]=this.n,S[2]=this.padding;for(var A=s,I=0;I<i.length;I++){var U=i[I];S[3+I]=A,S.set(U,A),A+=U.length}return S[3+i.length]=A,S.set(this.keys,A),S[3+i.length+1]=A+=this.keys.length,S.set(this.bboxes,A),A+=this.bboxes.length,S.buffer};var nl=le.ImageData,Wc=le.ImageBitmap,zi={};function Ui(i,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),zi[i]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var Gu in Ui("Object",Object),Lh.serialize=function(i,s){var l=i.toArrayBuffer();return s&&s.push(l),{buffer:l}},Lh.deserialize=function(i){return new Lh(i.buffer)},Ui("Grid",Lh),Ui("Color",to),Ui("Error",Error),Ui("ResolvedImage",Ss),Ui("StylePropertyFunction",fl),Ui("StyleExpression",mp,{omit:["_evaluator"]}),Ui("ZoomDependentExpression",ah),Ui("ZoomConstantExpression",sf),Ui("CompoundExpression",zu,{omit:["_evaluate"]}),ko)ko[Gu]._classRegistryKey||Ui("Expression_"+Gu,ko[Gu]);function $h(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Wh(i){return Wc&&i instanceof Wc}function ji(i,s){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if($h(i)||Wh(i))return s&&s.push(i),i;if(ArrayBuffer.isView(i)){var l=i;return s&&s.push(l.buffer),l}if(i instanceof nl)return s&&s.push(i.data.buffer),i;if(Array.isArray(i)){for(var p=[],S=0,A=i;S<A.length;S+=1)p.push(ji(A[S],s));return p}if(typeof i=="object"){var I=i.constructor,U=I._classRegistryKey;if(!U)throw new Error("can't serialize object of unregistered class");var q=I.serialize?I.serialize(i,s):{};if(!I.serialize){for(var re in i)if(i.hasOwnProperty(re)&&!(zi[U].omit.indexOf(re)>=0)){var de=i[re];q[re]=zi[U].shallow.indexOf(re)>=0?de:ji(de,s)}i instanceof Error&&(q.message=i.message)}if(q.$name)throw new Error("$name property is reserved for worker serialization logic.");return U!=="Object"&&(q.$name=U),q}throw new Error("can't serialize object of type "+typeof i)}function Ic(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||$h(i)||Wh(i)||ArrayBuffer.isView(i)||i instanceof nl)return i;if(Array.isArray(i))return i.map(Ic);if(typeof i=="object"){var s=i.$name||"Object",l=zi[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(i);for(var p=Object.create(l.prototype),S=0,A=Object.keys(i);S<A.length;S+=1){var I=A[S];if(I!=="$name"){var U=i[I];p[I]=zi[s].shallow.indexOf(I)>=0?U:Ic(U)}}return p}throw new Error("can't deserialize object of type "+typeof i)}var hf=function(){this.first=!0};hf.prototype.update=function(i,s){var l=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=l,!0))};var Gn={"Latin-1 Supplement":function(i){return i>=128&&i<=255},Arabic:function(i){return i>=1536&&i<=1791},"Arabic Supplement":function(i){return i>=1872&&i<=1919},"Arabic Extended-A":function(i){return i>=2208&&i<=2303},"Hangul Jamo":function(i){return i>=4352&&i<=4607},"Unified Canadian Aboriginal Syllabics":function(i){return i>=5120&&i<=5759},Khmer:function(i){return i>=6016&&i<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(i){return i>=6320&&i<=6399},"General Punctuation":function(i){return i>=8192&&i<=8303},"Letterlike Symbols":function(i){return i>=8448&&i<=8527},"Number Forms":function(i){return i>=8528&&i<=8591},"Miscellaneous Technical":function(i){return i>=8960&&i<=9215},"Control Pictures":function(i){return i>=9216&&i<=9279},"Optical Character Recognition":function(i){return i>=9280&&i<=9311},"Enclosed Alphanumerics":function(i){return i>=9312&&i<=9471},"Geometric Shapes":function(i){return i>=9632&&i<=9727},"Miscellaneous Symbols":function(i){return i>=9728&&i<=9983},"Miscellaneous Symbols and Arrows":function(i){return i>=11008&&i<=11263},"CJK Radicals Supplement":function(i){return i>=11904&&i<=12031},"Kangxi Radicals":function(i){return i>=12032&&i<=12255},"Ideographic Description Characters":function(i){return i>=12272&&i<=12287},"CJK Symbols and Punctuation":function(i){return i>=12288&&i<=12351},Hiragana:function(i){return i>=12352&&i<=12447},Katakana:function(i){return i>=12448&&i<=12543},Bopomofo:function(i){return i>=12544&&i<=12591},"Hangul Compatibility Jamo":function(i){return i>=12592&&i<=12687},Kanbun:function(i){return i>=12688&&i<=12703},"Bopomofo Extended":function(i){return i>=12704&&i<=12735},"CJK Strokes":function(i){return i>=12736&&i<=12783},"Katakana Phonetic Extensions":function(i){return i>=12784&&i<=12799},"Enclosed CJK Letters and Months":function(i){return i>=12800&&i<=13055},"CJK Compatibility":function(i){return i>=13056&&i<=13311},"CJK Unified Ideographs Extension A":function(i){return i>=13312&&i<=19903},"Yijing Hexagram Symbols":function(i){return i>=19904&&i<=19967},"CJK Unified Ideographs":function(i){return i>=19968&&i<=40959},"Yi Syllables":function(i){return i>=40960&&i<=42127},"Yi Radicals":function(i){return i>=42128&&i<=42191},"Hangul Jamo Extended-A":function(i){return i>=43360&&i<=43391},"Hangul Syllables":function(i){return i>=44032&&i<=55215},"Hangul Jamo Extended-B":function(i){return i>=55216&&i<=55295},"Private Use Area":function(i){return i>=57344&&i<=63743},"CJK Compatibility Ideographs":function(i){return i>=63744&&i<=64255},"Arabic Presentation Forms-A":function(i){return i>=64336&&i<=65023},"Vertical Forms":function(i){return i>=65040&&i<=65055},"CJK Compatibility Forms":function(i){return i>=65072&&i<=65103},"Small Form Variants":function(i){return i>=65104&&i<=65135},"Arabic Presentation Forms-B":function(i){return i>=65136&&i<=65279},"Halfwidth and Fullwidth Forms":function(i){return i>=65280&&i<=65519}};function ld(i){for(var s=0,l=i;s<l.length;s+=1)if(xh(l[s].charCodeAt(0)))return!0;return!1}function xh(i){return!(i!==746&&i!==747&&(i<4352||!(Gn["Bopomofo Extended"](i)||Gn.Bopomofo(i)||Gn["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Gn["CJK Compatibility Ideographs"](i)||Gn["CJK Compatibility"](i)||Gn["CJK Radicals Supplement"](i)||Gn["CJK Strokes"](i)||!(!Gn["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Gn["CJK Unified Ideographs Extension A"](i)||Gn["CJK Unified Ideographs"](i)||Gn["Enclosed CJK Letters and Months"](i)||Gn["Hangul Compatibility Jamo"](i)||Gn["Hangul Jamo Extended-A"](i)||Gn["Hangul Jamo Extended-B"](i)||Gn["Hangul Jamo"](i)||Gn["Hangul Syllables"](i)||Gn.Hiragana(i)||Gn["Ideographic Description Characters"](i)||Gn.Kanbun(i)||Gn["Kangxi Radicals"](i)||Gn["Katakana Phonetic Extensions"](i)||Gn.Katakana(i)&&i!==12540||!(!Gn["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Gn["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Gn["Unified Canadian Aboriginal Syllabics"](i)||Gn["Unified Canadian Aboriginal Syllabics Extended"](i)||Gn["Vertical Forms"](i)||Gn["Yijing Hexagram Symbols"](i)||Gn["Yi Syllables"](i)||Gn["Yi Radicals"](i))))}function Xh(i){return!(xh(i)||function(s){return!!(Gn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Gn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Gn["Letterlike Symbols"](s)||Gn["Number Forms"](s)||Gn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Gn["Control Pictures"](s)&&s!==9251||Gn["Optical Character Recognition"](s)||Gn["Enclosed Alphanumerics"](s)||Gn["Geometric Shapes"](s)||Gn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Gn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Gn["CJK Symbols and Punctuation"](s)||Gn.Katakana(s)||Gn["Private Use Area"](s)||Gn["CJK Compatibility Forms"](s)||Gn["Small Form Variants"](s)||Gn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(i))}function wh(i){return i>=1424&&i<=2303||Gn["Arabic Presentation Forms-A"](i)||Gn["Arabic Presentation Forms-B"](i)}function oh(i,s){return!(!s&&wh(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Gn.Khmer(i))}function ff(i){for(var s=0,l=i;s<l.length;s+=1)if(wh(l[s].charCodeAt(0)))return!0;return!1}var Tf=null,Jl="unavailable",wc=null,Ql=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Jl="error"),Tf&&Tf(i)};function Yh(){Mf.fire(new Xe("pluginStateChange",{pluginStatus:Jl,pluginURL:wc}))}var Mf=new Ye,pf=function(){return Jl},Lc=function(){if(Jl!=="deferred"||!wc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jl="loading",Yh(),wc&&Wt({url:wc},function(i){i?Ql(i):(Jl="loaded",Yh())})},_l={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Jl==="loaded"||_l.applyArabicShaping!=null},isLoading:function(){return Jl==="loading"},setState:function(i){Jl=i.pluginStatus,wc=i.pluginURL},isParsed:function(){return _l.applyArabicShaping!=null&&_l.processBidirectionalText!=null&&_l.processStyledBidirectionalText!=null},getPluginURL:function(){return wc}},xo=function(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hf,this.transition={})};xo.prototype.isSupportedScript=function(i){return function(s,l){for(var p=0,S=s;p<S.length;p+=1)if(!oh(S[p].charCodeAt(0),l))return!1;return!0}(i,_l.isLoaded())},xo.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},xo.prototype.getCrossfadeParameters=function(){var i=this.zoom,s=i-Math.floor(i),l=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var Dl=function(i,s){this.property=i,this.value=s,this.expression=function(l,p){if(dp(l))return new fl(l,p);if(Hc(l)){var S=wo(l,p);if(S.result==="error")throw new Error(S.value.map(function(I){return I.key+": "+I.message}).join(", "));return S.value}var A=l;return typeof l=="string"&&p.type==="color"&&(A=to.parse(l)),{kind:"constant",evaluate:function(){return A}}}(s===void 0?i.specification.default:s,i.specification)};Dl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Dl.prototype.possiblyEvaluate=function(i,s,l){return this.property.possiblyEvaluate(this,i,s,l)};var Po=function(i){this.property=i,this.value=new Dl(i,void 0)};Po.prototype.transitioned=function(i,s){return new Kf(this.property,this.value,s,jt({},i.transition,this.transition),i.now)},Po.prototype.untransitioned=function(){return new Kf(this.property,this.value,null,{},0)};var dl=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};dl.prototype.getValue=function(i){return Jt(this._values[i].value.value)},dl.prototype.setValue=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new Po(this._values[i].property)),this._values[i].value=new Dl(this._values[i].property,s===null?void 0:Jt(s))},dl.prototype.getTransition=function(i){return Jt(this._values[i].transition)},dl.prototype.setTransition=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new Po(this._values[i].property)),this._values[i].transition=Jt(s)||void 0},dl.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var p=l[s],S=this.getValue(p);S!==void 0&&(i[p]=S);var A=this.getTransition(p);A!==void 0&&(i[p+"-transition"]=A)}return i},dl.prototype.transitioned=function(i,s){for(var l=new Pf(this._properties),p=0,S=Object.keys(this._values);p<S.length;p+=1){var A=S[p];l._values[A]=this._values[A].transitioned(i,s._values[A])}return l},dl.prototype.untransitioned=function(){for(var i=new Pf(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var p=l[s];i._values[p]=this._values[p].untransitioned()}return i};var Kf=function(i,s,l,p,S){this.property=i,this.value=s,this.begin=S+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=l)};Kf.prototype.possiblyEvaluate=function(i,s,l){var p=i.now||0,S=this.value.possiblyEvaluate(i,s,l),A=this.prior;if(A){if(p>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(p<this.begin)return A.possiblyEvaluate(i,s,l);var I=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(i,s,l),S,function(U){if(U<=0)return 0;if(U>=1)return 1;var q=U*U,re=q*U;return 4*(U<.5?re:3*(U-q)+re-.75)}(I))}return S};var Pf=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Pf.prototype.possiblyEvaluate=function(i,s,l){for(var p=new Al(this._properties),S=0,A=Object.keys(this._values);S<A.length;S+=1){var I=A[S];p._values[I]=this._values[I].possiblyEvaluate(i,s,l)}return p},Pf.prototype.hasTransition=function(){for(var i=0,s=Object.keys(this._values);i<s.length;i+=1)if(this._values[s[i]].prior)return!0;return!1};var Sc=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};Sc.prototype.getValue=function(i){return Jt(this._values[i].value)},Sc.prototype.setValue=function(i,s){this._values[i]=new Dl(this._values[i].property,s===null?void 0:Jt(s))},Sc.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var p=l[s],S=this.getValue(p);S!==void 0&&(i[p]=S)}return i},Sc.prototype.possiblyEvaluate=function(i,s,l){for(var p=new Al(this._properties),S=0,A=Object.keys(this._values);S<A.length;S+=1){var I=A[S];p._values[I]=this._values[I].possiblyEvaluate(i,s,l)}return p};var Ec=function(i,s,l){this.property=i,this.value=s,this.parameters=l};Ec.prototype.isConstant=function(){return this.value.kind==="constant"},Ec.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},Ec.prototype.evaluate=function(i,s,l,p){return this.property.evaluate(this.value,this.parameters,i,s,l,p)};var Al=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};Al.prototype.get=function(i){return this._values[i]};var aa=function(i){this.specification=i};aa.prototype.possiblyEvaluate=function(i,s){return i.expression.evaluate(s)},aa.prototype.interpolate=function(i,s,l){var p=rf[this.specification.type];return p?p(i,s,l):i};var ta=function(i,s){this.specification=i,this.overrides=s};ta.prototype.possiblyEvaluate=function(i,s,l,p){return new Ec(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},l,p)}:i.expression,s)},ta.prototype.interpolate=function(i,s,l){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new Ec(this,{kind:"constant",value:void 0},i.parameters);var p=rf[this.specification.type];return p?new Ec(this,{kind:"constant",value:p(i.value.value,s.value.value,l)},i.parameters):i},ta.prototype.evaluate=function(i,s,l,p,S,A){return i.kind==="constant"?i.value:i.evaluate(s,l,p,S,A)};var Da=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,p,S,A){if(l.value===void 0)return new Ec(this,{kind:"constant",value:void 0},p);if(l.expression.kind==="constant"){var I=l.expression.evaluate(p,null,{},S,A),U=l.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,q=this._calculate(U,U,U,p);return new Ec(this,{kind:"constant",value:q},p)}if(l.expression.kind==="camera"){var re=this._calculate(l.expression.evaluate({zoom:p.zoom-1}),l.expression.evaluate({zoom:p.zoom}),l.expression.evaluate({zoom:p.zoom+1}),p);return new Ec(this,{kind:"constant",value:re},p)}return new Ec(this,l.expression,p)},s.prototype.evaluate=function(l,p,S,A,I,U){if(l.kind==="source"){var q=l.evaluate(p,S,A,I,U);return this._calculate(q,q,q,p)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(p.zoom)-1},S,A),l.evaluate({zoom:Math.floor(p.zoom)},S,A),l.evaluate({zoom:Math.floor(p.zoom)+1},S,A),p):l.value},s.prototype._calculate=function(l,p,S,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:l,to:p}:{from:S,to:p}},s.prototype.interpolate=function(l){return l},s}(ta),ba=function(i){this.specification=i};ba.prototype.possiblyEvaluate=function(i,s,l,p){if(i.value!==void 0){if(i.expression.kind==="constant"){var S=i.expression.evaluate(s,null,{},l,p);return this._calculate(S,S,S,s)}return this._calculate(i.expression.evaluate(new xo(Math.floor(s.zoom-1),s)),i.expression.evaluate(new xo(Math.floor(s.zoom),s)),i.expression.evaluate(new xo(Math.floor(s.zoom+1),s)),s)}},ba.prototype._calculate=function(i,s,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:l,to:s}},ba.prototype.interpolate=function(i){return i};var bl=function(i){this.specification=i};bl.prototype.possiblyEvaluate=function(i,s,l,p){return!!i.expression.evaluate(s,null,{},l,p)},bl.prototype.interpolate=function(){return!1};var jl=function(i){for(var s in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){var l=i[s];l.specification.overridable&&this.overridableProperties.push(s);var p=this.defaultPropertyValues[s]=new Dl(l,void 0),S=this.defaultTransitionablePropertyValues[s]=new Po(l);this.defaultTransitioningPropertyValues[s]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}};Ui("DataDrivenProperty",ta),Ui("DataConstantProperty",aa),Ui("CrossFadedDataDrivenProperty",Da),Ui("CrossFadedProperty",ba),Ui("ColorRampProperty",bl);var df=function(i){function s(l,p){if(i.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),p.layout&&(this._unevaluatedLayout=new Sc(p.layout)),p.paint)){for(var S in this._transitionablePaint=new dl(p.paint),l.paint)this.setPaintProperty(S,l.paint[S],{validate:!1});for(var A in l.layout)this.setLayoutProperty(A,l.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Al(p.paint)}}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,p,S){S===void 0&&(S={}),p!=null&&this._validate(Cf,"layers."+this.id+".layout."+l,l,p,S)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,p):this.visibility=p)},s.prototype.getPaintProperty=function(l){return Rr(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,p,S){if(S===void 0&&(S={}),p!=null&&this._validate(cf,"layers."+this.id+".paint."+l,l,p,S))return!1;if(Rr(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-11),p||void 0),!1;var A=this._transitionablePaint._values[l],I=A.property.specification["property-type"]==="cross-faded-data-driven",U=A.value.isDataDriven(),q=A.value;this._transitionablePaint.setValue(l,p),this._handleSpecialPaintPropertyUpdate(l);var re=this._transitionablePaint._values[l].value;return re.isDataDriven()||U||I||this._handleOverridablePaintPropertyUpdate(l,q,re)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,p,S){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,p){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,p)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),rr(l,function(p,S){return!(p===void 0||S==="layout"&&!Object.keys(p).length||S==="paint"&&!Object.keys(p).length)})},s.prototype._validate=function(l,p,S,A,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&Af(this,l.call(Pe,{key:p,layerType:this.type,objectKey:S,value:A,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var p=this.paint.get(l);if(p instanceof Ec&&Mh(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},s}(Ye),Pu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Rh=function(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ho=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function vl(i,s){s===void 0&&(s=1);var l=0,p=0;return{members:i.map(function(S){var A=Pu[S.type].BYTES_PER_ELEMENT,I=l=kf(l,Math.max(s,A)),U=S.components||1;return p=Math.max(p,A),l+=A*U,{name:S.name,type:S.type,components:U,offset:I}}),size:kf(l,Math.max(p,s)),alignment:s}}function kf(i,s){return Math.ceil(i/s)*s}ho.serialize=function(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},ho.deserialize=function(i){var s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},ho.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ho.prototype.clear=function(){this.length=0},ho.prototype.resize=function(i){this.reserve(i),this.length=i},ho.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},ho.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Zu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p){var S=this.length;return this.resize(S+1),this.emplace(S,l,p)},s.prototype.emplace=function(l,p,S){var A=2*l;return this.int16[A+0]=p,this.int16[A+1]=S,l},s}(ho);Zu.prototype.bytesPerElement=4,Ui("StructArrayLayout2i4",Zu);var il=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A){var I=this.length;return this.resize(I+1),this.emplace(I,l,p,S,A)},s.prototype.emplace=function(l,p,S,A,I){var U=4*l;return this.int16[U+0]=p,this.int16[U+1]=S,this.int16[U+2]=A,this.int16[U+3]=I,l},s}(ho);il.prototype.bytesPerElement=8,Ui("StructArrayLayout4i8",il);var sh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U){var q=this.length;return this.resize(q+1),this.emplace(q,l,p,S,A,I,U)},s.prototype.emplace=function(l,p,S,A,I,U,q){var re=6*l;return this.int16[re+0]=p,this.int16[re+1]=S,this.int16[re+2]=A,this.int16[re+3]=I,this.int16[re+4]=U,this.int16[re+5]=q,l},s}(ho);sh.prototype.bytesPerElement=12,Ui("StructArrayLayout2i4i12",sh);var ec=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U){var q=this.length;return this.resize(q+1),this.emplace(q,l,p,S,A,I,U)},s.prototype.emplace=function(l,p,S,A,I,U,q){var re=4*l,de=8*l;return this.int16[re+0]=p,this.int16[re+1]=S,this.uint8[de+4]=A,this.uint8[de+5]=I,this.uint8[de+6]=U,this.uint8[de+7]=q,l},s}(ho);ec.prototype.bytesPerElement=8,Ui("StructArrayLayout2i4ub8",ec);var If=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p){var S=this.length;return this.resize(S+1),this.emplace(S,l,p)},s.prototype.emplace=function(l,p,S){var A=2*l;return this.float32[A+0]=p,this.float32[A+1]=S,l},s}(ho);If.prototype.bytesPerElement=8,Ui("StructArrayLayout2f8",If);var Rc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U,q,re,de,we){var Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,l,p,S,A,I,U,q,re,de,we)},s.prototype.emplace=function(l,p,S,A,I,U,q,re,de,we,Oe){var Ge=10*l;return this.uint16[Ge+0]=p,this.uint16[Ge+1]=S,this.uint16[Ge+2]=A,this.uint16[Ge+3]=I,this.uint16[Ge+4]=U,this.uint16[Ge+5]=q,this.uint16[Ge+6]=re,this.uint16[Ge+7]=de,this.uint16[Ge+8]=we,this.uint16[Ge+9]=Oe,l},s}(ho);Rc.prototype.bytesPerElement=20,Ui("StructArrayLayout10ui20",Rc);var Cc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge){var it=this.length;return this.resize(it+1),this.emplace(it,l,p,S,A,I,U,q,re,de,we,Oe,Ge)},s.prototype.emplace=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge,it){var tt=12*l;return this.int16[tt+0]=p,this.int16[tt+1]=S,this.int16[tt+2]=A,this.int16[tt+3]=I,this.uint16[tt+4]=U,this.uint16[tt+5]=q,this.uint16[tt+6]=re,this.uint16[tt+7]=de,this.int16[tt+8]=we,this.int16[tt+9]=Oe,this.int16[tt+10]=Ge,this.int16[tt+11]=it,l},s}(ho);Cc.prototype.bytesPerElement=24,Ui("StructArrayLayout4i4ui4i24",Cc);var Lf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S){var A=this.length;return this.resize(A+1),this.emplace(A,l,p,S)},s.prototype.emplace=function(l,p,S,A){var I=3*l;return this.float32[I+0]=p,this.float32[I+1]=S,this.float32[I+2]=A,l},s}(ho);Lf.prototype.bytesPerElement=12,Ui("StructArrayLayout3f12",Lf);var Dh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var p=this.length;return this.resize(p+1),this.emplace(p,l)},s.prototype.emplace=function(l,p){return this.uint32[1*l+0]=p,l},s}(ho);Dh.prototype.bytesPerElement=4,Ui("StructArrayLayout1ul4",Dh);var wp=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U,q,re,de){var we=this.length;return this.resize(we+1),this.emplace(we,l,p,S,A,I,U,q,re,de)},s.prototype.emplace=function(l,p,S,A,I,U,q,re,de,we){var Oe=10*l,Ge=5*l;return this.int16[Oe+0]=p,this.int16[Oe+1]=S,this.int16[Oe+2]=A,this.int16[Oe+3]=I,this.int16[Oe+4]=U,this.int16[Oe+5]=q,this.uint32[Ge+3]=re,this.uint16[Oe+8]=de,this.uint16[Oe+9]=we,l},s}(ho);wp.prototype.bytesPerElement=20,Ui("StructArrayLayout6i1ul2ui20",wp);var Jf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U){var q=this.length;return this.resize(q+1),this.emplace(q,l,p,S,A,I,U)},s.prototype.emplace=function(l,p,S,A,I,U,q){var re=6*l;return this.int16[re+0]=p,this.int16[re+1]=S,this.int16[re+2]=A,this.int16[re+3]=I,this.int16[re+4]=U,this.int16[re+5]=q,l},s}(ho);Jf.prototype.bytesPerElement=12,Ui("StructArrayLayout2i2i2i12",Jf);var mr=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I){var U=this.length;return this.resize(U+1),this.emplace(U,l,p,S,A,I)},s.prototype.emplace=function(l,p,S,A,I,U){var q=4*l,re=8*l;return this.float32[q+0]=p,this.float32[q+1]=S,this.float32[q+2]=A,this.int16[re+6]=I,this.int16[re+7]=U,l},s}(ho);mr.prototype.bytesPerElement=16,Ui("StructArrayLayout2f1f2i16",mr);var D=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A){var I=this.length;return this.resize(I+1),this.emplace(I,l,p,S,A)},s.prototype.emplace=function(l,p,S,A,I){var U=12*l,q=3*l;return this.uint8[U+0]=p,this.uint8[U+1]=S,this.float32[q+1]=A,this.float32[q+2]=I,l},s}(ho);D.prototype.bytesPerElement=12,Ui("StructArrayLayout2ub2f12",D);var h=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S){var A=this.length;return this.resize(A+1),this.emplace(A,l,p,S)},s.prototype.emplace=function(l,p,S,A){var I=3*l;return this.uint16[I+0]=p,this.uint16[I+1]=S,this.uint16[I+2]=A,l},s}(ho);h.prototype.bytesPerElement=6,Ui("StructArrayLayout3ui6",h);var x=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je){var Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je)},s.prototype.emplace=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je,Pt){var Xt=24*l,pr=12*l,Ur=48*l;return this.int16[Xt+0]=p,this.int16[Xt+1]=S,this.uint16[Xt+2]=A,this.uint16[Xt+3]=I,this.uint32[pr+2]=U,this.uint32[pr+3]=q,this.uint32[pr+4]=re,this.uint16[Xt+10]=de,this.uint16[Xt+11]=we,this.uint16[Xt+12]=Oe,this.float32[pr+7]=Ge,this.float32[pr+8]=it,this.uint8[Ur+36]=tt,this.uint8[Ur+37]=ct,this.uint8[Ur+38]=ut,this.uint32[pr+10]=Je,this.int16[Xt+22]=Pt,l},s}(ho);x.prototype.bytesPerElement=48,Ui("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);var O=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je,Pt,Xt,pr,Ur,tn,An,xi,On,si,kn,ci){var wi=this.length;return this.resize(wi+1),this.emplace(wi,l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je,Pt,Xt,pr,Ur,tn,An,xi,On,si,kn,ci)},s.prototype.emplace=function(l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt,ct,ut,Je,Pt,Xt,pr,Ur,tn,An,xi,On,si,kn,ci,wi){var $n=34*l,Si=17*l;return this.int16[$n+0]=p,this.int16[$n+1]=S,this.int16[$n+2]=A,this.int16[$n+3]=I,this.int16[$n+4]=U,this.int16[$n+5]=q,this.int16[$n+6]=re,this.int16[$n+7]=de,this.uint16[$n+8]=we,this.uint16[$n+9]=Oe,this.uint16[$n+10]=Ge,this.uint16[$n+11]=it,this.uint16[$n+12]=tt,this.uint16[$n+13]=ct,this.uint16[$n+14]=ut,this.uint16[$n+15]=Je,this.uint16[$n+16]=Pt,this.uint16[$n+17]=Xt,this.uint16[$n+18]=pr,this.uint16[$n+19]=Ur,this.uint16[$n+20]=tn,this.uint16[$n+21]=An,this.uint16[$n+22]=xi,this.uint32[Si+12]=On,this.float32[Si+13]=si,this.float32[Si+14]=kn,this.float32[Si+15]=ci,this.float32[Si+16]=wi,l},s}(ho);O.prototype.bytesPerElement=68,Ui("StructArrayLayout8i15ui1ul4f68",O);var Z=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var p=this.length;return this.resize(p+1),this.emplace(p,l)},s.prototype.emplace=function(l,p){return this.float32[1*l+0]=p,l},s}(ho);Z.prototype.bytesPerElement=4,Ui("StructArrayLayout1f4",Z);var H=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S){var A=this.length;return this.resize(A+1),this.emplace(A,l,p,S)},s.prototype.emplace=function(l,p,S,A){var I=3*l;return this.int16[I+0]=p,this.int16[I+1]=S,this.int16[I+2]=A,l},s}(ho);H.prototype.bytesPerElement=6,Ui("StructArrayLayout3i6",H);var ae=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S){var A=this.length;return this.resize(A+1),this.emplace(A,l,p,S)},s.prototype.emplace=function(l,p,S,A){var I=4*l;return this.uint32[2*l+0]=p,this.uint16[I+2]=S,this.uint16[I+3]=A,l},s}(ho);ae.prototype.bytesPerElement=8,Ui("StructArrayLayout1ul2ui8",ae);var ue=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p){var S=this.length;return this.resize(S+1),this.emplace(S,l,p)},s.prototype.emplace=function(l,p,S){var A=2*l;return this.uint16[A+0]=p,this.uint16[A+1]=S,l},s}(ho);ue.prototype.bytesPerElement=4,Ui("StructArrayLayout2ui4",ue);var ge=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var p=this.length;return this.resize(p+1),this.emplace(p,l)},s.prototype.emplace=function(l,p){return this.uint16[1*l+0]=p,l},s}(ho);ge.prototype.bytesPerElement=2,Ui("StructArrayLayout1ui2",ge);var Le=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,p,S,A){var I=this.length;return this.resize(I+1),this.emplace(I,l,p,S,A)},s.prototype.emplace=function(l,p,S,A,I){var U=4*l;return this.float32[U+0]=p,this.float32[U+1]=S,this.float32[U+2]=A,this.float32[U+3]=I,l},s}(ho);Le.prototype.bytesPerElement=16,Ui("StructArrayLayout4f16",Le);var m=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new pe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(Rh);m.prototype.size=20;var w=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new m(this,l)},s}(wp);Ui("CollisionBoxArray",w);var _=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(Rh);_.prototype.size=48;var T=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new _(this,l)},s}(x);Ui("PlacedSymbolArray",T);var N=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(Rh);N.prototype.size=68;var $=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new N(this,l)},s}(O);Ui("SymbolInstanceArray",$);var X=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(Z);Ui("GlyphOffsetArray",X);var oe=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(H);Ui("SymbolLineVertexArray",oe);var xe=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(Rh);xe.prototype.size=8;var ye=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new xe(this,l)},s}(ae);Ui("FeatureIndexArray",ye);var De=vl([{name:"a_pos",components:2,type:"Int16"}],4).members,He=function(i){i===void 0&&(i=[]),this.segments=i};function $e(i,s){return 256*(i=nt(Math.floor(i),0,255))+nt(Math.floor(s),0,255)}He.prototype.prepareSegment=function(i,s,l,p){var S=this.segments[this.segments.length-1];return i>He.MAX_VERTEX_ARRAY_LENGTH&&or("Max vertices per segment is "+He.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!S||S.vertexLength+i>He.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==p)&&(S={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(S.sortKey=p),this.segments.push(S)),S},He.prototype.get=function(){return this.segments},He.prototype.destroy=function(){for(var i=0,s=this.segments;i<s.length;i+=1){var l=s[i];for(var p in l.vaos)l.vaos[p].destroy()}},He.simpleSegment=function(i,s,l,p){return new He([{vertexOffset:i,primitiveOffset:s,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])},He.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ui("SegmentVector",He);var ft=vl([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),pt=M(function(i){i.exports=function(s,l){var p,S,A,I,U,q,re,de;for(S=s.length-(p=3&s.length),A=l,U=3432918353,q=461845907,de=0;de<S;)re=255&s.charCodeAt(de)|(255&s.charCodeAt(++de))<<8|(255&s.charCodeAt(++de))<<16|(255&s.charCodeAt(++de))<<24,++de,A=27492+(65535&(I=5*(65535&(A=(A^=re=(65535&(re=(re=(65535&re)*U+(((re>>>16)*U&65535)<<16)&4294967295)<<15|re>>>17))*q+(((re>>>16)*q&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch(re=0,p){case 3:re^=(255&s.charCodeAt(de+2))<<16;case 2:re^=(255&s.charCodeAt(de+1))<<8;case 1:A^=re=(65535&(re=(re=(65535&(re^=255&s.charCodeAt(de)))*U+(((re>>>16)*U&65535)<<16)&4294967295)<<15|re>>>17))*q+(((re>>>16)*q&65535)<<16)&4294967295}return A^=s.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}}),wt=M(function(i){i.exports=function(s,l){for(var p,S=s.length,A=l^S,I=0;S>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24))+((1540483477*(p>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),S-=4,++I;switch(S){case 3:A^=(255&s.charCodeAt(I+2))<<16;case 2:A^=(255&s.charCodeAt(I+1))<<8;case 1:A=1540483477*(65535&(A^=255&s.charCodeAt(I)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}}),dt=pt,Ft=wt;dt.murmur3=pt,dt.murmur2=Ft;var ar=function(){this.ids=[],this.positions=[],this.indexed=!1};ar.prototype.add=function(i,s,l,p){this.ids.push(Ir(i)),this.positions.push(s,l,p)},ar.prototype.getPositions=function(i){for(var s=Ir(i),l=0,p=this.ids.length-1;l<p;){var S=l+p>>1;this.ids[S]>=s?p=S:l=S+1}for(var A=[];this.ids[l]===s;)A.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return A},ar.serialize=function(i,s){var l=new Float64Array(i.ids),p=new Uint32Array(i.positions);return function S(A,I,U,q){for(;U<q;){for(var re=A[U+q>>1],de=U-1,we=q+1;;){do de++;while(A[de]<re);do we--;while(A[we]>re);if(de>=we)break;_r(A,de,we),_r(I,3*de,3*we),_r(I,3*de+1,3*we+1),_r(I,3*de+2,3*we+2)}we-U<q-we?(S(A,I,U,we),U=we+1):(S(A,I,we+1,q),q=we)}}(l,p,0,l.length-1),s&&s.push(l.buffer,p.buffer),{ids:l,positions:p}},ar.deserialize=function(i){var s=new ar;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s};var nr=Math.pow(2,53)-1;function Ir(i){var s=+i;return!isNaN(s)&&s<=nr?s:dt(String(i))}function _r(i,s,l){var p=i[s];i[s]=i[l],i[l]=p}Ui("FeaturePositionMap",ar);var Qr=function(i,s){this.gl=i.gl,this.location=s},nn=function(i){function s(l,p){i.call(this,l,p),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(Qr),Ln=function(i){function s(l,p){i.call(this,l,p),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(Qr),Mn=function(i){function s(l,p){i.call(this,l,p),this.current=[0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(Qr),yi=function(i){function s(l,p){i.call(this,l,p),this.current=[0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(Qr),Ri=function(i){function s(l,p){i.call(this,l,p),this.current=[0,0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(Qr),Qi=function(i){function s(l,p){i.call(this,l,p),this.current=to.transparent}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(Qr),Vi=new Float32Array(16),ao=function(i){function s(l,p){i.call(this,l,p),this.current=Vi}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var p=1;p<16;p++)if(l[p]!==this.current[p]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(Qr);function Bi(i){return[$e(255*i.r,255*i.g),$e(255*i.b,255*i.a)]}var oa=function(i,s,l){this.value=i,this.uniformNames=s.map(function(p){return"u_"+p}),this.type=l};oa.prototype.setUniform=function(i,s,l){i.set(l.constantOr(this.value))},oa.prototype.getBinding=function(i,s,l){return this.type==="color"?new Qi(i,s):new Ln(i,s)};var Ha=function(i,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ha.prototype.setConstantPatternPositions=function(i,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=i.tlbr},Ha.prototype.setUniform=function(i,s,l,p){var S=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&i.set(S)},Ha.prototype.getBinding=function(i,s,l){return l.substr(0,9)==="u_pattern"?new Ri(i,s):new Ln(i,s)};var ja=function(i,s,l,p){this.expression=i,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(S){return{name:"a_"+S,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ja.prototype.populatePaintArray=function(i,s,l,p,S){var A=this.paintVertexArray.length,I=this.expression.evaluate(new xo(0),s,{},p,[],S);this.paintVertexArray.resize(i),this._setPaintValue(A,i,I)},ja.prototype.updatePaintArray=function(i,s,l,p){var S=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(i,s,S)},ja.prototype._setPaintValue=function(i,s,l){if(this.type==="color")for(var p=Bi(l),S=i;S<s;S++)this.paintVertexArray.emplace(S,p[0],p[1]);else{for(var A=i;A<s;A++)this.paintVertexArray.emplace(A,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},ja.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ja.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Sa=function(i,s,l,p,S,A){this.expression=i,this.uniformNames=s.map(function(I){return"u_"+I+"_t"}),this.type=l,this.useIntegerZoom=p,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=s.map(function(I){return{name:"a_"+I,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new A};Sa.prototype.populatePaintArray=function(i,s,l,p,S){var A=this.expression.evaluate(new xo(this.zoom),s,{},p,[],S),I=this.expression.evaluate(new xo(this.zoom+1),s,{},p,[],S),U=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(U,i,A,I)},Sa.prototype.updatePaintArray=function(i,s,l,p){var S=this.expression.evaluate({zoom:this.zoom},l,p),A=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(i,s,S,A)},Sa.prototype._setPaintValue=function(i,s,l,p){if(this.type==="color")for(var S=Bi(l),A=Bi(p),I=i;I<s;I++)this.paintVertexArray.emplace(I,S[0],S[1],A[0],A[1]);else{for(var U=i;U<s;U++)this.paintVertexArray.emplace(U,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}},Sa.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Sa.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Sa.prototype.setUniform=function(i,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=nt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);i.set(p)},Sa.prototype.getBinding=function(i,s,l){return new Ln(i,s)};var Qa=function(i,s,l,p,S,A){this.expression=i,this.type=s,this.useIntegerZoom=l,this.zoom=p,this.layerId=A,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S};Qa.prototype.populatePaintArray=function(i,s,l){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],l)},Qa.prototype.updatePaintArray=function(i,s,l,p,S){this._setPaintValues(i,s,l.patterns&&l.patterns[this.layerId],S)},Qa.prototype._setPaintValues=function(i,s,l,p){if(p&&l){var S=p[l.min],A=p[l.mid],I=p[l.max];if(S&&A&&I)for(var U=i;U<s;U++)this.zoomInPaintVertexArray.emplace(U,A.tl[0],A.tl[1],A.br[0],A.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],A.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,A.tl[0],A.tl[1],A.br[0],A.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],A.pixelRatio,I.pixelRatio)}},Qa.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,ft.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,ft.members,this.expression.isStateDependent))},Qa.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var eo=function(i,s,l){this.binders={},this._buffers=[];var p=[];for(var S in i.paint._values)if(l(S)){var A=i.paint.get(S);if(A instanceof Ec&&Mh(A.property.specification)){var I=tu(S,i.type),U=A.value,q=A.property.specification.type,re=A.property.useIntegerZoom,de=A.property.specification["property-type"],we=de==="cross-faded"||de==="cross-faded-data-driven";if(U.kind==="constant")this.binders[S]=we?new Ha(U.value,I):new oa(U.value,I,q),p.push("/u_"+S);else if(U.kind==="source"||we){var Oe=Gs(S,q,"source");this.binders[S]=we?new Qa(U,q,re,s,Oe,i.id):new ja(U,I,q,Oe),p.push("/a_"+S)}else{var Ge=Gs(S,q,"composite");this.binders[S]=new Sa(U,I,q,re,s,Ge),p.push("/z_"+S)}}}this.cacheKey=p.sort().join("")};eo.prototype.getMaxValue=function(i){var s=this.binders[i];return s instanceof ja||s instanceof Sa?s.maxValue:0},eo.prototype.populatePaintArrays=function(i,s,l,p,S){for(var A in this.binders){var I=this.binders[A];(I instanceof ja||I instanceof Sa||I instanceof Qa)&&I.populatePaintArray(i,s,l,p,S)}},eo.prototype.setConstantPatternPositions=function(i,s){for(var l in this.binders){var p=this.binders[l];p instanceof Ha&&p.setConstantPatternPositions(i,s)}},eo.prototype.updatePaintArrays=function(i,s,l,p,S){var A=!1;for(var I in i)for(var U=0,q=s.getPositions(I);U<q.length;U+=1){var re=q[U],de=l.feature(re.index);for(var we in this.binders){var Oe=this.binders[we];if((Oe instanceof ja||Oe instanceof Sa||Oe instanceof Qa)&&Oe.expression.isStateDependent===!0){var Ge=p.paint.get(we);Oe.expression=Ge.value,Oe.updatePaintArray(re.start,re.end,de,i[I],S),A=!0}}}return A},eo.prototype.defines=function(){var i=[];for(var s in this.binders){var l=this.binders[s];(l instanceof oa||l instanceof Ha)&&i.push.apply(i,l.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return i},eo.prototype.getBinderAttributes=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof ja||l instanceof Sa)for(var p=0;p<l.paintVertexAttributes.length;p++)i.push(l.paintVertexAttributes[p].name);else if(l instanceof Qa)for(var S=0;S<ft.members.length;S++)i.push(ft.members[S].name)}return i},eo.prototype.getBinderUniforms=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof oa||l instanceof Ha||l instanceof Sa)for(var p=0,S=l.uniformNames;p<S.length;p+=1)i.push(S[p])}return i},eo.prototype.getPaintVertexBuffers=function(){return this._buffers},eo.prototype.getUniforms=function(i,s){var l=[];for(var p in this.binders){var S=this.binders[p];if(S instanceof oa||S instanceof Ha||S instanceof Sa)for(var A=0,I=S.uniformNames;A<I.length;A+=1){var U=I[A];if(s[U]){var q=S.getBinding(i,s[U],U);l.push({name:U,property:p,binding:q})}}}return l},eo.prototype.setUniforms=function(i,s,l,p){for(var S=0,A=s;S<A.length;S+=1){var I=A[S],U=I.name,q=I.property;this.binders[q].setUniform(I.binding,p,l.get(q),U)}},eo.prototype.updatePaintBuffers=function(i){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(i&&l instanceof Qa){var p=i.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof ja||l instanceof Sa)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},eo.prototype.upload=function(i){for(var s in this.binders){var l=this.binders[s];(l instanceof ja||l instanceof Sa||l instanceof Qa)&&l.upload(i)}this.updatePaintBuffers()},eo.prototype.destroy=function(){for(var i in this.binders){var s=this.binders[i];(s instanceof ja||s instanceof Sa||s instanceof Qa)&&s.destroy()}};var va=function(i,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var p=0,S=i;p<S.length;p+=1){var A=S[p];this.programConfigurations[A.id]=new eo(A,s,l)}this.needsUpload=!1,this._featureMap=new ar,this._bufferOffset=0};function tu(i,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(s+"-","").replace(/-/g,"_")]}function Gs(i,s,l){var p={color:{source:If,composite:Le},number:{source:Z,composite:If}},S=function(A){return{"line-pattern":{source:Rc,composite:Rc},"fill-pattern":{source:Rc,composite:Rc},"fill-extrusion-pattern":{source:Rc,composite:Rc}}[A]}(i);return S&&S[l]||p[s][l]}va.prototype.populatePaintArrays=function(i,s,l,p,S,A){for(var I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(i,s,p,S,A);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},va.prototype.updatePaintArrays=function(i,s,l,p){for(var S=0,A=l;S<A.length;S+=1){var I=A[S];this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(i,this._featureMap,s,I,p)||this.needsUpload}},va.prototype.get=function(i){return this.programConfigurations[i]},va.prototype.upload=function(i){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}},va.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()},Ui("ConstantBinder",oa),Ui("CrossFadedConstantBinder",Ha),Ui("SourceExpressionBinder",ja),Ui("CrossFadedCompositeBinder",Qa),Ui("CompositeExpressionBinder",Sa),Ui("ProgramConfiguration",eo,{omit:["_buffers"]}),Ui("ProgramConfigurationSet",va);var Tl=Math.pow(2,14)-1,Ps=-Tl-1;function Qo(i){for(var s=8192/i.extent,l=i.loadGeometry(),p=0;p<l.length;p++)for(var S=l[p],A=0;A<S.length;A++){var I=S[A],U=Math.round(I.x*s),q=Math.round(I.y*s);I.x=nt(U,Ps,Tl),I.y=nt(q,Ps,Tl),(U<I.x||U>I.x+1||q<I.y||q>I.y+1)&&or("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function Zs(i,s){return{type:i.type,id:i.id,properties:i.properties,geometry:s?Qo(i):[]}}function Hs(i,s,l,p,S){i.emplaceBack(2*s+(p+1)/2,2*l+(S+1)/2)}var Uu=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Zu,this.indexArray=new h,this.segments=new He,this.programConfigurations=new va(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function uh(i,s){for(var l=0;l<i.length;l++)if(Gl(s,i[l]))return!0;for(var p=0;p<s.length;p++)if(Gl(i,s[p]))return!0;return!!Qf(i,s)}function pc(i,s,l){return!!Gl(i,s)||!!vc(s,i,l)}function Xc(i,s){if(i.length===1)return Vl(s,i[0]);for(var l=0;l<s.length;l++)for(var p=s[l],S=0;S<p.length;S++)if(Gl(i,p[S]))return!0;for(var A=0;A<i.length;A++)if(Vl(s,i[A]))return!0;for(var I=0;I<s.length;I++)if(Qf(i,s[I]))return!0;return!1}function Yc(i,s,l){if(i.length>1){if(Qf(i,s))return!0;for(var p=0;p<s.length;p++)if(vc(s[p],i,l))return!0}for(var S=0;S<i.length;S++)if(vc(i[S],s,l))return!0;return!1}function Qf(i,s){if(i.length===0||s.length===0)return!1;for(var l=0;l<i.length-1;l++)for(var p=i[l],S=i[l+1],A=0;A<s.length-1;A++)if(dc(p,S,s[A],s[A+1]))return!0;return!1}function dc(i,s,l,p){return Br(i,l,p)!==Br(s,l,p)&&Br(i,s,l)!==Br(i,s,p)}function vc(i,s,l){var p=l*l;if(s.length===1)return i.distSqr(s[0])<p;for(var S=1;S<s.length;S++)if(Dc(i,s[S-1],s[S])<p)return!0;return!1}function Dc(i,s,l){var p=s.distSqr(l);if(p===0)return i.distSqr(s);var S=((i.x-s.x)*(l.x-s.x)+(i.y-s.y)*(l.y-s.y))/p;return i.distSqr(S<0?s:S>1?l:l.sub(s)._mult(S)._add(s))}function Vl(i,s){for(var l,p,S,A=!1,I=0;I<i.length;I++)for(var U=0,q=(l=i[I]).length-1;U<l.length;q=U++)(p=l[U]).y>s.y!=(S=l[q]).y>s.y&&s.x<(S.x-p.x)*(s.y-p.y)/(S.y-p.y)+p.x&&(A=!A);return A}function Gl(i,s){for(var l=!1,p=0,S=i.length-1;p<i.length;S=p++){var A=i[p],I=i[S];A.y>s.y!=I.y>s.y&&s.x<(I.x-A.x)*(s.y-A.y)/(I.y-A.y)+A.x&&(l=!l)}return l}function vf(i,s,l){var p=l[0],S=l[2];if(i.x<p.x&&s.x<p.x||i.x>S.x&&s.x>S.x||i.y<p.y&&s.y<p.y||i.y>S.y&&s.y>S.y)return!1;var A=Br(i,s,l[0]);return A!==Br(i,s,l[1])||A!==Br(i,s,l[2])||A!==Br(i,s,l[3])}function mc(i,s,l){var p=s.paint.get(i).value;return p.kind==="constant"?p.value:l.programConfigurations.get(s.id).getMaxValue(i)}function Hl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function lh(i,s,l,p,S){if(!s[0]&&!s[1])return i;var A=pe.convert(s)._mult(S);l==="viewport"&&A._rotate(-p);for(var I=[],U=0;U<i.length;U++)I.push(i[U].sub(A));return I}Uu.prototype.populate=function(i,s,l){var p=this.layers[0],S=[],A=null;p.type==="circle"&&(A=p.layout.get("circle-sort-key"));for(var I=0,U=i;I<U.length;I+=1){var q=U[I],re=q.feature,de=q.id,we=q.index,Oe=q.sourceLayerIndex,Ge=this.layers[0]._featureFilter.needGeometry,it=Zs(re,Ge);if(this.layers[0]._featureFilter.filter(new xo(this.zoom),it,l)){var tt=A?A.evaluate(it,{},l):void 0,ct={id:de,properties:re.properties,type:re.type,sourceLayerIndex:Oe,index:we,geometry:Ge?it.geometry:Qo(re),patterns:{},sortKey:tt};S.push(ct)}}A&&S.sort(function(An,xi){return An.sortKey-xi.sortKey});for(var ut=0,Je=S;ut<Je.length;ut+=1){var Pt=Je[ut],Xt=Pt.geometry,pr=Pt.index,Ur=Pt.sourceLayerIndex,tn=i[pr].feature;this.addFeature(Pt,Xt,pr,l),s.featureIndex.insert(tn,Xt,pr,Ur,this.index)}},Uu.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},Uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uu.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,De),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uu.prototype.addFeature=function(i,s,l,p){for(var S=0,A=s;S<A.length;S+=1)for(var I=0,U=A[S];I<U.length;I+=1){var q=U[I],re=q.x,de=q.y;if(!(re<0||re>=8192||de<0||de>=8192)){var we=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),Oe=we.vertexLength;Hs(this.layoutVertexArray,re,de,-1,-1),Hs(this.layoutVertexArray,re,de,1,-1),Hs(this.layoutVertexArray,re,de,1,1),Hs(this.layoutVertexArray,re,de,-1,1),this.indexArray.emplaceBack(Oe,Oe+1,Oe+2),this.indexArray.emplaceBack(Oe,Oe+3,Oe+2),we.vertexLength+=4,we.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,{},p)},Ui("CircleBucket",Uu,{omit:["layers"]});var Os=new jl({"circle-sort-key":new ta(Fe.layout_circle["circle-sort-key"])}),ch={paint:new jl({"circle-radius":new ta(Fe.paint_circle["circle-radius"]),"circle-color":new ta(Fe.paint_circle["circle-color"]),"circle-blur":new ta(Fe.paint_circle["circle-blur"]),"circle-opacity":new ta(Fe.paint_circle["circle-opacity"]),"circle-translate":new aa(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new aa(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new aa(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new aa(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ta(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ta(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ta(Fe.paint_circle["circle-stroke-opacity"])}),layout:Os},Es=typeof Float32Array!="undefined"?Float32Array:Array;function Ol(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ml(i,s,l){var p=s[0],S=s[1],A=s[2],I=s[3],U=s[4],q=s[5],re=s[6],de=s[7],we=s[8],Oe=s[9],Ge=s[10],it=s[11],tt=s[12],ct=s[13],ut=s[14],Je=s[15],Pt=l[0],Xt=l[1],pr=l[2],Ur=l[3];return i[0]=Pt*p+Xt*U+pr*we+Ur*tt,i[1]=Pt*S+Xt*q+pr*Oe+Ur*ct,i[2]=Pt*A+Xt*re+pr*Ge+Ur*ut,i[3]=Pt*I+Xt*de+pr*it+Ur*Je,i[4]=(Pt=l[4])*p+(Xt=l[5])*U+(pr=l[6])*we+(Ur=l[7])*tt,i[5]=Pt*S+Xt*q+pr*Oe+Ur*ct,i[6]=Pt*A+Xt*re+pr*Ge+Ur*ut,i[7]=Pt*I+Xt*de+pr*it+Ur*Je,i[8]=(Pt=l[8])*p+(Xt=l[9])*U+(pr=l[10])*we+(Ur=l[11])*tt,i[9]=Pt*S+Xt*q+pr*Oe+Ur*ct,i[10]=Pt*A+Xt*re+pr*Ge+Ur*ut,i[11]=Pt*I+Xt*de+pr*it+Ur*Je,i[12]=(Pt=l[12])*p+(Xt=l[13])*U+(pr=l[14])*we+(Ur=l[15])*tt,i[13]=Pt*S+Xt*q+pr*Oe+Ur*ct,i[14]=Pt*A+Xt*re+pr*Ge+Ur*ut,i[15]=Pt*I+Xt*de+pr*it+Ur*Je,i}Math.hypot||(Math.hypot=function(){for(var i=arguments,s=0,l=arguments.length;l--;)s+=i[l]*i[l];return Math.sqrt(s)});var mf,ku=ml;function ep(i,s,l){var p=s[0],S=s[1],A=s[2],I=s[3];return i[0]=l[0]*p+l[4]*S+l[8]*A+l[12]*I,i[1]=l[1]*p+l[5]*S+l[9]*A+l[13]*I,i[2]=l[2]*p+l[6]*S+l[10]*A+l[14]*I,i[3]=l[3]*p+l[7]*S+l[11]*A+l[15]*I,i}mf=new Es(3),Es!=Float32Array&&(mf[0]=0,mf[1]=0,mf[2]=0),function(){var i=new Es(4);Es!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0)}();var cd=(function(){var i=new Es(2);Es!=Float32Array&&(i[0]=0,i[1]=0)}(),function(i){function s(l){i.call(this,l,ch)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Uu(l)},s.prototype.queryRadius=function(l){var p=l;return mc("circle-radius",this,p)+mc("circle-stroke-width",this,p)+Hl(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,p,S,A,I,U,q,re){for(var de=lh(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),U.angle,q),we=this.paint.get("circle-radius").evaluate(p,S)+this.paint.get("circle-stroke-width").evaluate(p,S),Oe=this.paint.get("circle-pitch-alignment")==="map",Ge=Oe?de:function(tn,An){return tn.map(function(xi){return qh(xi,An)})}(de,re),it=Oe?we*q:we,tt=0,ct=A;tt<ct.length;tt+=1)for(var ut=0,Je=ct[tt];ut<Je.length;ut+=1){var Pt=Je[ut],Xt=Oe?Pt:qh(Pt,re),pr=it,Ur=ep([],[Pt.x,Pt.y,0,1],re);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?pr*=Ur[3]/U.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(pr*=U.cameraToCenterDistance/Ur[3]),pc(Ge,Xt,pr))return!0}return!1},s}(df));function qh(i,s){var l=ep([],[i.x,i.y,0,1],s);return new pe(l[0]/l[3],l[1]/l[3])}var Rd=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Uu);function Rf(i,s,l,p){var S=s.width,A=s.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==S*A*l)throw new RangeError("mismatched image size")}else p=new Uint8Array(S*A*l);return i.width=S,i.height=A,i.data=p,i}function hd(i,s,l){var p=s.width,S=s.height;if(p!==i.width||S!==i.height){var A=Rf({},{width:p,height:S},l);Sd(i,A,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,p),height:Math.min(i.height,S)},l),i.width=p,i.height=S,i.data=A.data}}function Sd(i,s,l,p,S,A){if(S.width===0||S.height===0)return s;if(S.width>i.width||S.height>i.height||l.x>i.width-S.width||l.y>i.height-S.height)throw new RangeError("out of range source coordinates for image copy");if(S.width>s.width||S.height>s.height||p.x>s.width-S.width||p.y>s.height-S.height)throw new RangeError("out of range destination coordinates for image copy");for(var I=i.data,U=s.data,q=0;q<S.height;q++)for(var re=((l.y+q)*i.width+l.x)*A,de=((p.y+q)*s.width+p.x)*A,we=0;we<S.width*A;we++)U[de+we]=I[re+we];return s}Ui("HeatmapBucket",Rd,{omit:["layers"]});var Ip=function(i,s){Rf(this,i,1,s)};Ip.prototype.resize=function(i){hd(this,i,1)},Ip.prototype.clone=function(){return new Ip({width:this.width,height:this.height},new Uint8Array(this.data))},Ip.copy=function(i,s,l,p,S){Sd(i,s,l,p,S,1)};var Fl=function(i,s){Rf(this,i,4,s)};Fl.prototype.resize=function(i){hd(this,i,4)},Fl.prototype.replace=function(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i},Fl.prototype.clone=function(){return new Fl({width:this.width,height:this.height},new Uint8Array(this.data))},Fl.copy=function(i,s,l,p,S){Sd(i,s,l,p,S,4)},Ui("AlphaImage",Ip),Ui("RGBAImage",Fl);var Wd={paint:new jl({"heatmap-radius":new ta(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ta(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new aa(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bl(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new aa(Fe.paint_heatmap["heatmap-opacity"])})};function Qm(i){var s={},l=i.resolution||256,p=i.clips?i.clips.length:1,S=i.image||new Fl({width:l,height:p}),A=function(it,tt,ct){s[i.evaluationKey]=ct;var ut=i.expression.evaluate(s);S.data[it+tt+0]=Math.floor(255*ut.r/ut.a),S.data[it+tt+1]=Math.floor(255*ut.g/ut.a),S.data[it+tt+2]=Math.floor(255*ut.b/ut.a),S.data[it+tt+3]=Math.floor(255*ut.a)};if(i.clips)for(var I=0,U=0;I<p;++I,U+=4*l)for(var q=0,re=0;q<l;q++,re+=4){var de=q/(l-1),we=i.clips[I];A(U,re,we.start*(1-de)+we.end*de)}else for(var Oe=0,Ge=0;Oe<l;Oe++,Ge+=4)A(0,Ge,Oe/(l-1));return S}var Tv=function(i){function s(l){i.call(this,l,Wd),this._updateColorRamp()}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Rd(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Qm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(df),Mv={paint:new jl({"hillshade-illumination-direction":new aa(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new aa(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new aa(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new aa(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new aa(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new aa(Fe.paint_hillshade["hillshade-accent-color"])})},Dd=function(i){function s(l){i.call(this,l,Mv)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(df),Pv=vl([{name:"a_pos",components:2,type:"Int16"}],4).members,fd=hh,jv=hh;function hh(i,s,l){l=l||2;var p,S,A,I,U,q,re,de=s&&s.length,we=de?s[0]*l:i.length,Oe=dv(i,0,we,l,!0),Ge=[];if(!Oe||Oe.next===Oe.prev)return Ge;if(de&&(Oe=function(tt,ct,ut,Je){var Pt,Xt,pr,Ur=[];for(Pt=0,Xt=ct.length;Pt<Xt;Pt++)(pr=dv(tt,ct[Pt]*Je,Pt<Xt-1?ct[Pt+1]*Je:tt.length,Je,!1))===pr.next&&(pr.steiner=!0),Ur.push(qd(pr));for(Ur.sort(Fm),Pt=0;Pt<Ur.length;Pt++)cm(Ur[Pt],ut),ut=Df(ut,ut.next);return ut}(i,s,Oe,l)),i.length>80*l){p=A=i[0],S=I=i[1];for(var it=l;it<we;it+=l)(U=i[it])<p&&(p=U),(q=i[it+1])<S&&(S=q),U>A&&(A=U),q>I&&(I=q);re=(re=Math.max(A-p,I-S))!==0?1/re:0}return Xd(Oe,Ge,l,p,S,re),Ge}function dv(i,s,l,p,S){var A,I;if(S===_s(i,s,l,p)>0)for(A=s;A<l;A+=p)I=Kd(A,i[A],i[A+1],I);else for(A=l-p;A>=s;A-=p)I=Kd(A,i[A],i[A+1],I);return I&&fh(I,I.next)&&(Ju(I),I=I.next),I}function Df(i,s){if(!i)return i;s||(s=i);var l,p=i;do if(l=!1,p.steiner||!fh(p,p.next)&&qu(p.prev,p,p.next)!==0)p=p.next;else{if(Ju(p),(p=s=p.prev)===p.next)break;l=!0}while(l||p!==s);return s}function Xd(i,s,l,p,S,A,I){if(i){!I&&A&&function(de,we,Oe,Ge){var it=de;do it.z===null&&(it.z=zm(it.x,it.y,we,Oe,Ge)),it.prevZ=it.prev,it.nextZ=it.next,it=it.next;while(it!==de);it.prevZ.nextZ=null,it.prevZ=null,function(tt){var ct,ut,Je,Pt,Xt,pr,Ur,tn,An=1;do{for(ut=tt,tt=null,Xt=null,pr=0;ut;){for(pr++,Je=ut,Ur=0,ct=0;ct<An&&(Ur++,Je=Je.nextZ);ct++);for(tn=An;Ur>0||tn>0&&Je;)Ur!==0&&(tn===0||!Je||ut.z<=Je.z)?(Pt=ut,ut=ut.nextZ,Ur--):(Pt=Je,Je=Je.nextZ,tn--),Xt?Xt.nextZ=Pt:tt=Pt,Pt.prevZ=Xt,Xt=Pt;ut=Je}Xt.nextZ=null,An*=2}while(pr>1)}(it)}(i,p,S,A);for(var U,q,re=i;i.prev!==i.next;)if(U=i.prev,q=i.next,A?Vv(i,p,S,A):Yd(i))s.push(U.i/l),s.push(i.i/l),s.push(q.i/l),Ju(i),i=q.next,re=q.next;else if((i=q)===re){I?I===1?Xd(i=lm(Df(i),s,l),s,l,p,S,A,2):I===2&&Om(i,s,l,p,S,A):Xd(Df(i),s,l,p,S,A,1);break}}}function Yd(i){var s=i.prev,l=i,p=i.next;if(qu(s,l,p)>=0)return!1;for(var S=i.next.next;S!==i.prev;){if(Sp(s.x,s.y,l.x,l.y,p.x,p.y,S.x,S.y)&&qu(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function Vv(i,s,l,p){var S=i.prev,A=i,I=i.next;if(qu(S,A,I)>=0)return!1;for(var U=S.x>A.x?S.x>I.x?S.x:I.x:A.x>I.x?A.x:I.x,q=S.y>A.y?S.y>I.y?S.y:I.y:A.y>I.y?A.y:I.y,re=zm(S.x<A.x?S.x<I.x?S.x:I.x:A.x<I.x?A.x:I.x,S.y<A.y?S.y<I.y?S.y:I.y:A.y<I.y?A.y:I.y,s,l,p),de=zm(U,q,s,l,p),we=i.prevZ,Oe=i.nextZ;we&&we.z>=re&&Oe&&Oe.z<=de;){if(we!==i.prev&&we!==i.next&&Sp(S.x,S.y,A.x,A.y,I.x,I.y,we.x,we.y)&&qu(we.prev,we,we.next)>=0||(we=we.prevZ,Oe!==i.prev&&Oe!==i.next&&Sp(S.x,S.y,A.x,A.y,I.x,I.y,Oe.x,Oe.y)&&qu(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;we&&we.z>=re;){if(we!==i.prev&&we!==i.next&&Sp(S.x,S.y,A.x,A.y,I.x,I.y,we.x,we.y)&&qu(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;Oe&&Oe.z<=de;){if(Oe!==i.prev&&Oe!==i.next&&Sp(S.x,S.y,A.x,A.y,I.x,I.y,Oe.x,Oe.y)&&qu(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function lm(i,s,l){var p=i;do{var S=p.prev,A=p.next.next;!fh(S,A)&&Oh(S,p,p.next,A)&&qp(S,A)&&qp(A,S)&&(s.push(S.i/l),s.push(p.i/l),s.push(A.i/l),Ju(p),Ju(p.next),p=i=A),p=p.next}while(p!==i);return Df(p)}function Om(i,s,l,p,S,A){var I=i;do{for(var U=I.next.next;U!==I.prev;){if(I.i!==U.i&&Ed(I,U)){var q=kv(I,U);return I=Df(I,I.next),q=Df(q,q.next),Xd(I,s,l,p,S,A),void Xd(q,s,l,p,S,A)}U=U.next}I=I.next}while(I!==i)}function Fm(i,s){return i.x-s.x}function cm(i,s){if(s=function(p,S){var A,I=S,U=p.x,q=p.y,re=-1/0;do{if(q<=I.y&&q>=I.next.y&&I.next.y!==I.y){var de=I.x+(q-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(de<=U&&de>re){if(re=de,de===U){if(q===I.y)return I;if(q===I.next.y)return I.next}A=I.x<I.next.x?I:I.next}}I=I.next}while(I!==S);if(!A)return null;if(U===re)return A;var we,Oe=A,Ge=A.x,it=A.y,tt=1/0;I=A;do U>=I.x&&I.x>=Ge&&U!==I.x&&Sp(q<it?U:re,q,Ge,it,q<it?re:U,q,I.x,I.y)&&(we=Math.abs(q-I.y)/(U-I.x),qp(I,p)&&(we<tt||we===tt&&(I.x>A.x||I.x===A.x&&hm(A,I)))&&(A=I,tt=we)),I=I.next;while(I!==Oe);return A}(i,s)){var l=kv(s,i);Df(s,s.next),Df(l,l.next)}}function hm(i,s){return qu(i.prev,i,s.prev)<0&&qu(s.next,i,i.next)<0}function zm(i,s,l,p,S){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-l)*S)|i<<8))|i<<4))|i<<2))|i<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-p)*S)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function qd(i){var s=i,l=i;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==i);return l}function Sp(i,s,l,p,S,A,I,U){return(S-I)*(s-U)-(i-I)*(A-U)>=0&&(i-I)*(p-U)-(l-I)*(s-U)>=0&&(l-I)*(A-U)-(S-I)*(p-U)>=0}function Ed(i,s){return i.next.i!==s.i&&i.prev.i!==s.i&&!function(l,p){var S=l;do{if(S.i!==l.i&&S.next.i!==l.i&&S.i!==p.i&&S.next.i!==p.i&&Oh(S,S.next,l,p))return!0;S=S.next}while(S!==l);return!1}(i,s)&&(qp(i,s)&&qp(s,i)&&function(l,p){var S=l,A=!1,I=(l.x+p.x)/2,U=(l.y+p.y)/2;do S.y>U!=S.next.y>U&&S.next.y!==S.y&&I<(S.next.x-S.x)*(U-S.y)/(S.next.y-S.y)+S.x&&(A=!A),S=S.next;while(S!==l);return A}(i,s)&&(qu(i.prev,i,s.prev)||qu(i,s.prev,s))||fh(i,s)&&qu(i.prev,i,i.next)>0&&qu(s.prev,s,s.next)>0)}function qu(i,s,l){return(s.y-i.y)*(l.x-s.x)-(s.x-i.x)*(l.y-s.y)}function fh(i,s){return i.x===s.x&&i.y===s.y}function Oh(i,s,l,p){var S=Ml(qu(i,s,l)),A=Ml(qu(i,s,p)),I=Ml(qu(l,p,i)),U=Ml(qu(l,p,s));return S!==A&&I!==U||!(S!==0||!Ku(i,l,s))||!(A!==0||!Ku(i,p,s))||!(I!==0||!Ku(l,i,p))||!(U!==0||!Ku(l,s,p))}function Ku(i,s,l){return s.x<=Math.max(i.x,l.x)&&s.x>=Math.min(i.x,l.x)&&s.y<=Math.max(i.y,l.y)&&s.y>=Math.min(i.y,l.y)}function Ml(i){return i>0?1:i<0?-1:0}function qp(i,s){return qu(i.prev,i,i.next)<0?qu(i,s,i.next)>=0&&qu(i,i.prev,s)>=0:qu(i,s,i.prev)<0||qu(i,i.next,s)<0}function kv(i,s){var l=new Od(i.i,i.x,i.y),p=new Od(s.i,s.x,s.y),S=i.next,A=s.prev;return i.next=s,s.prev=i,l.next=S,S.prev=l,p.next=l,l.prev=p,A.next=p,p.prev=A,p}function Kd(i,s,l,p){var S=new Od(i,s,l);return p?(S.next=p.next,S.prev=p,p.next.prev=S,p.next=S):(S.prev=S,S.next=S),S}function Ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Od(i,s,l){this.i=i,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _s(i,s,l,p){for(var S=0,A=s,I=l-p;A<l;A+=p)S+=(i[I]-i[A])*(i[A+1]+i[I+1]),I=A;return S}function vv(i,s,l,p,S){(function A(I,U,q,re,de){for(;re>q;){if(re-q>600){var we=re-q+1,Oe=U-q+1,Ge=Math.log(we),it=.5*Math.exp(2*Ge/3),tt=.5*Math.sqrt(Ge*it*(we-it)/we)*(Oe-we/2<0?-1:1);A(I,U,Math.max(q,Math.floor(U-Oe*it/we+tt)),Math.min(re,Math.floor(U+(we-Oe)*it/we+tt)),de)}var ct=I[U],ut=q,Je=re;for(Ac(I,q,U),de(I[re],ct)>0&&Ac(I,q,re);ut<Je;){for(Ac(I,ut,Je),ut++,Je--;de(I[ut],ct)<0;)ut++;for(;de(I[Je],ct)>0;)Je--}de(I[q],ct)===0?Ac(I,q,Je):Ac(I,++Je,re),Je<=U&&(q=Je+1),U<=Je&&(re=Je-1)}})(i,s,l||0,p||i.length-1,S||Sh)}function Ac(i,s,l){var p=i[s];i[s]=i[l],i[l]=p}function Sh(i,s){return i<s?-1:i>s?1:0}function Lp(i,s){var l=i.length;if(l<=1)return[i];for(var p,S,A=[],I=0;I<l;I++){var U=an(i[I]);U!==0&&(i[I].area=Math.abs(U),S===void 0&&(S=U<0),S===U<0?(p&&A.push(p),p=[i[I]]):p.push(i[I]))}if(p&&A.push(p),s>1)for(var q=0;q<A.length;q++)A[q].length<=s||(vv(A[q],s,1,A[q].length-1,Tc),A[q]=A[q].slice(0,s));return A}function Tc(i,s){return s.area-i.area}function Of(i,s,l){for(var p=l.patternDependencies,S=!1,A=0,I=s;A<I.length;A+=1){var U=I[A].paint.get(i+"-pattern");U.isConstant()||(S=!0);var q=U.constantOr(null);q&&(S=!0,p[q.to]=!0,p[q.from]=!0)}return S}function Fd(i,s,l,p,S){for(var A=S.patternDependencies,I=0,U=s;I<U.length;I+=1){var q=U[I],re=q.paint.get(i+"-pattern").value;if(re.kind!=="constant"){var de=re.evaluate({zoom:p-1},l,{},S.availableImages),we=re.evaluate({zoom:p},l,{},S.availableImages),Oe=re.evaluate({zoom:p+1},l,{},S.availableImages);we=we&&we.name?we.name:we,Oe=Oe&&Oe.name?Oe.name:Oe,A[de=de&&de.name?de.name:de]=!0,A[we]=!0,A[Oe]=!0,l.patterns[q.id]={min:de,mid:we,max:Oe}}}return l}hh.deviation=function(i,s,l,p){var S=s&&s.length,A=Math.abs(_s(i,0,S?s[0]*l:i.length,l));if(S)for(var I=0,U=s.length;I<U;I++)A-=Math.abs(_s(i,s[I]*l,I<U-1?s[I+1]*l:i.length,l));var q=0;for(I=0;I<p.length;I+=3){var re=p[I]*l,de=p[I+1]*l,we=p[I+2]*l;q+=Math.abs((i[re]-i[we])*(i[de+1]-i[re+1])-(i[re]-i[de])*(i[we+1]-i[re+1]))}return A===0&&q===0?0:Math.abs((q-A)/A)},hh.flatten=function(i){for(var s=i[0][0].length,l={vertices:[],holes:[],dimensions:s},p=0,S=0;S<i.length;S++){for(var A=0;A<i[S].length;A++)for(var I=0;I<s;I++)l.vertices.push(i[S][A][I]);S>0&&l.holes.push(p+=i[S-1].length)}return l},fd.default=jv;var Oc=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zu,this.indexArray=new h,this.indexArray2=new ue,this.programConfigurations=new va(i.layers,i.zoom),this.segments=new He,this.segments2=new He,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Oc.prototype.populate=function(i,s,l){this.hasPattern=Of("fill",this.layers,s);for(var p=this.layers[0].layout.get("fill-sort-key"),S=[],A=0,I=i;A<I.length;A+=1){var U=I[A],q=U.feature,re=U.id,de=U.index,we=U.sourceLayerIndex,Oe=this.layers[0]._featureFilter.needGeometry,Ge=Zs(q,Oe);if(this.layers[0]._featureFilter.filter(new xo(this.zoom),Ge,l)){var it=p?p.evaluate(Ge,{},l,s.availableImages):void 0,tt={id:re,properties:q.properties,type:q.type,sourceLayerIndex:we,index:de,geometry:Oe?Ge.geometry:Qo(q),patterns:{},sortKey:it};S.push(tt)}}p&&S.sort(function(tn,An){return tn.sortKey-An.sortKey});for(var ct=0,ut=S;ct<ut.length;ct+=1){var Je=ut[ct],Pt=Je.geometry,Xt=Je.index,pr=Je.sourceLayerIndex;if(this.hasPattern){var Ur=Fd("fill",this.layers,Je,this.zoom,s);this.patternFeatures.push(Ur)}else this.addFeature(Je,Pt,Xt,l,{});s.featureIndex.insert(i[Xt].feature,Pt,Xt,pr,this.index)}},Oc.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},Oc.prototype.addFeatures=function(i,s,l){for(var p=0,S=this.patternFeatures;p<S.length;p+=1){var A=S[p];this.addFeature(A,A.geometry,A.index,s,l)}},Oc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Oc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Oc.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Pv),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},Oc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Oc.prototype.addFeature=function(i,s,l,p,S){for(var A=0,I=Lp(s,500);A<I.length;A+=1){for(var U=I[A],q=0,re=0,de=U;re<de.length;re+=1)q+=de[re].length;for(var we=this.segments.prepareSegment(q,this.layoutVertexArray,this.indexArray),Oe=we.vertexLength,Ge=[],it=[],tt=0,ct=U;tt<ct.length;tt+=1){var ut=ct[tt];if(ut.length!==0){ut!==U[0]&&it.push(Ge.length/2);var Je=this.segments2.prepareSegment(ut.length,this.layoutVertexArray,this.indexArray2),Pt=Je.vertexLength;this.layoutVertexArray.emplaceBack(ut[0].x,ut[0].y),this.indexArray2.emplaceBack(Pt+ut.length-1,Pt),Ge.push(ut[0].x),Ge.push(ut[0].y);for(var Xt=1;Xt<ut.length;Xt++)this.layoutVertexArray.emplaceBack(ut[Xt].x,ut[Xt].y),this.indexArray2.emplaceBack(Pt+Xt-1,Pt+Xt),Ge.push(ut[Xt].x),Ge.push(ut[Xt].y);Je.vertexLength+=ut.length,Je.primitiveLength+=ut.length}}for(var pr=fd(Ge,it),Ur=0;Ur<pr.length;Ur+=3)this.indexArray.emplaceBack(Oe+pr[Ur],Oe+pr[Ur+1],Oe+pr[Ur+2]);we.vertexLength+=q,we.primitiveLength+=pr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,S,p)},Ui("FillBucket",Oc,{omit:["layers","patternFeatures"]});var zd=new jl({"fill-sort-key":new ta(Fe.layout_fill["fill-sort-key"])}),yg={paint:new jl({"fill-antialias":new aa(Fe.paint_fill["fill-antialias"]),"fill-opacity":new ta(Fe.paint_fill["fill-opacity"]),"fill-color":new ta(Fe.paint_fill["fill-color"]),"fill-outline-color":new ta(Fe.paint_fill["fill-outline-color"]),"fill-translate":new aa(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new aa(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Da(Fe.paint_fill["fill-pattern"])}),layout:zd},Gv=function(i){function s(l){i.call(this,l,yg)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,p){i.prototype.recalculate.call(this,l,p);var S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new Oc(l)},s.prototype.queryRadius=function(){return Hl(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,p,S,A,I,U,q){return Xc(lh(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),U.angle,q),A)},s.prototype.isTileClipped=function(){return!0},s}(df),fm=vl([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ff=mv;function mv(i,s,l,p,S){this.properties={},this.extent=l,this.type=0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=S,i.readFields(gc,this,s)}function gc(i,s,l){i==1?s.id=l.readVarint():i==2?function(p,S){for(var A=p.readVarint()+p.pos;p.pos<A;){var I=S._keys[p.readVarint()],U=S._values[p.readVarint()];S.properties[I]=U}}(l,s):i==3?s.type=l.readVarint():i==4&&(s._geometry=l.pos)}function Hv(i){for(var s,l,p=0,S=0,A=i.length,I=A-1;S<A;I=S++)p+=((l=i[I]).x-(s=i[S]).x)*(s.y+l.y);return p}mv.types=["Unknown","Point","LineString","Polygon"],mv.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var s,l=i.readVarint()+i.pos,p=1,S=0,A=0,I=0,U=[];i.pos<l;){if(S<=0){var q=i.readVarint();p=7&q,S=q>>3}if(S--,p===1||p===2)A+=i.readSVarint(),I+=i.readSVarint(),p===1&&(s&&U.push(s),s=[]),s.push(new pe(A,I));else{if(p!==7)throw new Error("unknown command "+p);s&&s.push(s[0].clone())}}return s&&U.push(s),U},mv.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var s=i.readVarint()+i.pos,l=1,p=0,S=0,A=0,I=1/0,U=-1/0,q=1/0,re=-1/0;i.pos<s;){if(p<=0){var de=i.readVarint();l=7&de,p=de>>3}if(p--,l===1||l===2)(S+=i.readSVarint())<I&&(I=S),S>U&&(U=S),(A+=i.readSVarint())<q&&(q=A),A>re&&(re=A);else if(l!==7)throw new Error("unknown command "+l)}return[I,q,U,re]},mv.prototype.toGeoJSON=function(i,s,l){var p,S,A=this.extent*Math.pow(2,l),I=this.extent*i,U=this.extent*s,q=this.loadGeometry(),re=mv.types[this.type];function de(Ge){for(var it=0;it<Ge.length;it++){var tt=Ge[it];Ge[it]=[360*(tt.x+I)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(tt.y+U)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var we=[];for(p=0;p<q.length;p++)we[p]=q[p][0];de(q=we);break;case 2:for(p=0;p<q.length;p++)de(q[p]);break;case 3:for(q=function(Ge){var it=Ge.length;if(it<=1)return[Ge];for(var tt,ct,ut=[],Je=0;Je<it;Je++){var Pt=Hv(Ge[Je]);Pt!==0&&(ct===void 0&&(ct=Pt<0),ct===Pt<0?(tt&&ut.push(tt),tt=[Ge[Je]]):tt.push(Ge[Je]))}return tt&&ut.push(tt),ut}(q),p=0;p<q.length;p++)for(S=0;S<q[p].length;S++)de(q[p][S])}q.length===1?q=q[0]:re="Multi"+re;var Oe={type:"Feature",geometry:{type:re,coordinates:q},properties:this.properties};return"id"in this&&(Oe.id=this.id),Oe};var pm=Cd;function Cd(i,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(dm,this,s),this.length=this._features.length}function dm(i,s,l){i===15?s.version=l.readVarint():i===1?s.name=l.readString():i===5?s.extent=l.readVarint():i===2?s._features.push(l.pos):i===3?s._keys.push(l.readString()):i===4&&s._values.push(function(p){for(var S=null,A=p.readVarint()+p.pos;p.pos<A;){var I=p.readVarint()>>3;S=I===1?p.readString():I===2?p.readFloat():I===3?p.readDouble():I===4?p.readVarint64():I===5?p.readVarint():I===6?p.readSVarint():I===7?p.readBoolean():null}return S}(l))}function gf(i,s,l){if(i===3){var p=new pm(l,l.readVarint()+l.pos);p.length&&(s[p.name]=p)}}Cd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var s=this._pbf.readVarint()+this._pbf.pos;return new Ff(this._pbf,s,this.extent,this._keys,this._values)};var Jd={VectorTile:function(i,s){this.layers=i.readFields(gf,{},s)},VectorTileFeature:Ff,VectorTileLayer:pm},Kh=Jd.VectorTileFeature.types,qc=Math.pow(2,13);function Bd(i,s,l,p,S,A,I,U){i.emplaceBack(s,l,2*Math.floor(p*qc)+I,S*qc*2,A*qc*2,Math.round(U))}var zf=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new sh,this.indexArray=new h,this.programConfigurations=new va(i.layers,i.zoom),this.segments=new He,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function gv(i,s){return i.x===s.x&&(i.x<0||i.x>8192)||i.y===s.y&&(i.y<0||i.y>8192)}zf.prototype.populate=function(i,s,l){this.features=[],this.hasPattern=Of("fill-extrusion",this.layers,s);for(var p=0,S=i;p<S.length;p+=1){var A=S[p],I=A.feature,U=A.id,q=A.index,re=A.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,we=Zs(I,de);if(this.layers[0]._featureFilter.filter(new xo(this.zoom),we,l)){var Oe={id:U,sourceLayerIndex:re,index:q,geometry:de?we.geometry:Qo(I),properties:I.properties,type:I.type,patterns:{}};this.hasPattern?this.features.push(Fd("fill-extrusion",this.layers,Oe,this.zoom,s)):this.addFeature(Oe,Oe.geometry,q,l,{}),s.featureIndex.insert(I,Oe.geometry,q,re,this.index,!0)}}},zf.prototype.addFeatures=function(i,s,l){for(var p=0,S=this.features;p<S.length;p+=1){var A=S[p];this.addFeature(A,A.geometry,A.index,s,l)}},zf.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},zf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zf.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zf.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,fm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},zf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zf.prototype.addFeature=function(i,s,l,p,S){for(var A=0,I=Lp(s,500);A<I.length;A+=1){for(var U=I[A],q=0,re=0,de=U;re<de.length;re+=1)q+=de[re].length;for(var we=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Oe=0,Ge=U;Oe<Ge.length;Oe+=1){var it=Ge[Oe];if(it.length!==0&&!((Si=it).every(function(Kn){return Kn.x<0})||Si.every(function(Kn){return Kn.x>8192})||Si.every(function(Kn){return Kn.y<0})||Si.every(function(Kn){return Kn.y>8192})))for(var tt=0,ct=0;ct<it.length;ct++){var ut=it[ct];if(ct>=1){var Je=it[ct-1];if(!gv(ut,Je)){we.vertexLength+4>He.MAX_VERTEX_ARRAY_LENGTH&&(we=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Pt=ut.sub(Je)._perp()._unit(),Xt=Je.dist(ut);tt+Xt>32768&&(tt=0),Bd(this.layoutVertexArray,ut.x,ut.y,Pt.x,Pt.y,0,0,tt),Bd(this.layoutVertexArray,ut.x,ut.y,Pt.x,Pt.y,0,1,tt),Bd(this.layoutVertexArray,Je.x,Je.y,Pt.x,Pt.y,0,0,tt+=Xt),Bd(this.layoutVertexArray,Je.x,Je.y,Pt.x,Pt.y,0,1,tt);var pr=we.vertexLength;this.indexArray.emplaceBack(pr,pr+2,pr+1),this.indexArray.emplaceBack(pr+1,pr+2,pr+3),we.vertexLength+=4,we.primitiveLength+=2}}}}if(we.vertexLength+q>He.MAX_VERTEX_ARRAY_LENGTH&&(we=this.segments.prepareSegment(q,this.layoutVertexArray,this.indexArray)),Kh[i.type]==="Polygon"){for(var Ur=[],tn=[],An=we.vertexLength,xi=0,On=U;xi<On.length;xi+=1){var si=On[xi];if(si.length!==0){si!==U[0]&&tn.push(Ur.length/2);for(var kn=0;kn<si.length;kn++){var ci=si[kn];Bd(this.layoutVertexArray,ci.x,ci.y,0,0,1,1,0),Ur.push(ci.x),Ur.push(ci.y)}}}for(var wi=fd(Ur,tn),$n=0;$n<wi.length;$n+=3)this.indexArray.emplaceBack(An+wi[$n],An+wi[$n+2],An+wi[$n+1]);we.primitiveLength+=wi.length/3,we.vertexLength+=q}}var Si;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,S,p)},Ui("FillExtrusionBucket",zf,{omit:["layers","features"]});var eg={paint:new jl({"fill-extrusion-opacity":new aa(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ta(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new aa(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new aa(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Da(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ta(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ta(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new aa(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Fh=function(i){function s(l){i.call(this,l,eg)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new zf(l)},s.prototype.queryRadius=function(){return Hl(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,p,S,A,I,U,q,re){var de=lh(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),U.angle,q),we=this.paint.get("fill-extrusion-height").evaluate(p,S),Oe=this.paint.get("fill-extrusion-base").evaluate(p,S),Ge=function(tt,ct,ut,Je){for(var Pt=[],Xt=0,pr=tt;Xt<pr.length;Xt+=1){var Ur=pr[Xt],tn=[Ur.x,Ur.y,0,1];ep(tn,tn,ct),Pt.push(new pe(tn[0]/tn[3],tn[1]/tn[3]))}return Pt}(de,re),it=function(tt,ct,ut,Je){for(var Pt=[],Xt=[],pr=Je[8]*ct,Ur=Je[9]*ct,tn=Je[10]*ct,An=Je[11]*ct,xi=Je[8]*ut,On=Je[9]*ut,si=Je[10]*ut,kn=Je[11]*ut,ci=0,wi=tt;ci<wi.length;ci+=1){for(var $n=[],Si=[],Kn=0,la=wi[ci];Kn<la.length;Kn+=1){var yn=la[Kn],Ti=yn.x,Aa=yn.y,$o=Je[0]*Ti+Je[4]*Aa+Je[12],lo=Je[1]*Ti+Je[5]*Aa+Je[13],Oo=Je[2]*Ti+Je[6]*Aa+Je[14],So=Je[3]*Ti+Je[7]*Aa+Je[15],cs=Oo+tn,Wo=So+An,Bo=$o+xi,Xo=lo+On,Au=Oo+si,Wi=So+kn,hs=new pe(($o+pr)/Wo,(lo+Ur)/Wo);hs.z=cs/Wo,$n.push(hs);var Ba=new pe(Bo/Wi,Xo/Wi);Ba.z=Au/Wi,Si.push(Ba)}Pt.push($n),Xt.push(Si)}return[Pt,Xt]}(A,Oe,we,re);return function(tt,ct,ut){var Je=1/0;Xc(ut,ct)&&(Je=tc(ut,ct[0]));for(var Pt=0;Pt<ct.length;Pt++)for(var Xt=ct[Pt],pr=tt[Pt],Ur=0;Ur<Xt.length-1;Ur++){var tn=Xt[Ur],An=[tn,Xt[Ur+1],pr[Ur+1],pr[Ur],tn];uh(ut,An)&&(Je=Math.min(Je,tc(ut,An)))}return Je!==1/0&&Je}(it[0],it[1],Ge)},s}(df);function yf(i,s){return i.x*s.x+i.y*s.y}function tc(i,s){if(i.length===1){for(var l,p=0,S=s[p++];!l||S.equals(l);)if(!(l=s[p++]))return 1/0;for(;p<s.length;p++){var A=s[p],I=i[0],U=l.sub(S),q=A.sub(S),re=I.sub(S),de=yf(U,U),we=yf(U,q),Oe=yf(q,q),Ge=yf(re,U),it=yf(re,q),tt=de*Oe-we*we,ct=(Oe*Ge-we*it)/tt,ut=(de*it-we*Ge)/tt,Je=S.z*(1-ct-ut)+l.z*ct+A.z*ut;if(isFinite(Je))return Je}return 1/0}for(var Pt=1/0,Xt=0,pr=s;Xt<pr.length;Xt+=1)Pt=Math.min(Pt,pr[Xt].z);return Pt}var _f=vl([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,$v=vl([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,vm=Jd.VectorTileFeature.types,zl=Math.cos(Math.PI/180*37.5),Wv=Math.pow(2,14)/.5,al=function(i){var s=this;this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new ec,this.layoutVertexArray2=new If,this.indexArray=new h,this.programConfigurations=new va(i.layers,i.zoom),this.segments=new He,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};al.prototype.populate=function(i,s,l){this.hasPattern=Of("line",this.layers,s);for(var p=this.layers[0].layout.get("line-sort-key"),S=[],A=0,I=i;A<I.length;A+=1){var U=I[A],q=U.feature,re=U.id,de=U.index,we=U.sourceLayerIndex,Oe=this.layers[0]._featureFilter.needGeometry,Ge=Zs(q,Oe);if(this.layers[0]._featureFilter.filter(new xo(this.zoom),Ge,l)){var it=p?p.evaluate(Ge,{},l):void 0,tt={id:re,properties:q.properties,type:q.type,sourceLayerIndex:we,index:de,geometry:Oe?Ge.geometry:Qo(q),patterns:{},sortKey:it};S.push(tt)}}p&&S.sort(function(tn,An){return tn.sortKey-An.sortKey});for(var ct=0,ut=S;ct<ut.length;ct+=1){var Je=ut[ct],Pt=Je.geometry,Xt=Je.index,pr=Je.sourceLayerIndex;if(this.hasPattern){var Ur=Fd("line",this.layers,Je,this.zoom,s);this.patternFeatures.push(Ur)}else this.addFeature(Je,Pt,Xt,l,{});s.featureIndex.insert(i[Xt].feature,Pt,Xt,pr,this.index)}},al.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},al.prototype.addFeatures=function(i,s,l){for(var p=0,S=this.patternFeatures;p<S.length;p+=1){var A=S[p];this.addFeature(A,A.geometry,A.index,s,l)}},al.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},al.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},al.prototype.upload=function(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,$v)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_f),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},al.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},al.prototype.lineFeatureClips=function(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}},al.prototype.addFeature=function(i,s,l,p,S){var A=this.layers[0].layout,I=A.get("line-join").evaluate(i,{}),U=A.get("line-cap"),q=A.get("line-miter-limit"),re=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(var de=0,we=s;de<we.length;de+=1)this.addLine(we[de],i,I,U,q,re);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,S,p)},al.prototype.addLine=function(i,s,l,p,S,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var I=0;I<i.length-1;I++)this.totalDistance+=i[I].dist(i[I+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var U=vm[s.type]==="Polygon",q=i.length;q>=2&&i[q-1].equals(i[q-2]);)q--;for(var re=0;re<q-1&&i[re].equals(i[re+1]);)re++;if(!(q<(U?3:2))){l==="bevel"&&(S=1.05);var de,we=this.overscaling<=16?122880/(512*this.overscaling):0,Oe=this.segments.prepareSegment(10*q,this.layoutVertexArray,this.indexArray),Ge=void 0,it=void 0,tt=void 0,ct=void 0;this.e1=this.e2=-1,U&&(ct=i[re].sub(de=i[q-2])._unit()._perp());for(var ut=re;ut<q;ut++)if(!(it=ut===q-1?U?i[re+1]:void 0:i[ut+1])||!i[ut].equals(it)){ct&&(tt=ct),de&&(Ge=de),de=i[ut],ct=it?it.sub(de)._unit()._perp():tt;var Je=(tt=tt||ct).add(ct);Je.x===0&&Je.y===0||Je._unit();var Pt=tt.x*ct.x+tt.y*ct.y,Xt=Je.x*ct.x+Je.y*ct.y,pr=Xt!==0?1/Xt:1/0,Ur=2*Math.sqrt(2-2*Xt),tn=Xt<zl&&Ge&&it,An=tt.x*ct.y-tt.y*ct.x>0;if(tn&&ut>re){var xi=de.dist(Ge);if(xi>2*we){var On=de.sub(de.sub(Ge)._mult(we/xi)._round());this.updateDistance(Ge,On),this.addCurrentVertex(On,tt,0,0,Oe),Ge=On}}var si=Ge&&it,kn=si?l:U?"butt":p;if(si&&kn==="round"&&(pr<A?kn="miter":pr<=2&&(kn="fakeround")),kn==="miter"&&pr>S&&(kn="bevel"),kn==="bevel"&&(pr>2&&(kn="flipbevel"),pr<S&&(kn="miter")),Ge&&this.updateDistance(Ge,de),kn==="miter")Je._mult(pr),this.addCurrentVertex(de,Je,0,0,Oe);else if(kn==="flipbevel"){if(pr>100)Je=ct.mult(-1);else{var ci=pr*tt.add(ct).mag()/tt.sub(ct).mag();Je._perp()._mult(ci*(An?-1:1))}this.addCurrentVertex(de,Je,0,0,Oe),this.addCurrentVertex(de,Je.mult(-1),0,0,Oe)}else if(kn==="bevel"||kn==="fakeround"){var wi=-Math.sqrt(pr*pr-1),$n=An?wi:0,Si=An?0:wi;if(Ge&&this.addCurrentVertex(de,tt,$n,Si,Oe),kn==="fakeround")for(var Kn=Math.round(180*Ur/Math.PI/20),la=1;la<Kn;la++){var yn=la/Kn;if(yn!==.5){var Ti=yn-.5;yn+=yn*Ti*(yn-1)*((1.0904+Pt*(Pt*(3.55645-1.43519*Pt)-3.2452))*Ti*Ti+(.848013+Pt*(.215638*Pt-1.06021)))}var Aa=ct.sub(tt)._mult(yn)._add(tt)._unit()._mult(An?-1:1);this.addHalfVertex(de,Aa.x,Aa.y,!1,An,0,Oe)}it&&this.addCurrentVertex(de,ct,-$n,-Si,Oe)}else if(kn==="butt")this.addCurrentVertex(de,Je,0,0,Oe);else if(kn==="square"){var $o=Ge?1:-1;this.addCurrentVertex(de,Je,$o,$o,Oe)}else kn==="round"&&(Ge&&(this.addCurrentVertex(de,tt,0,0,Oe),this.addCurrentVertex(de,tt,1,1,Oe,!0)),it&&(this.addCurrentVertex(de,ct,-1,-1,Oe,!0),this.addCurrentVertex(de,ct,0,0,Oe)));if(tn&&ut<q-1){var lo=de.dist(it);if(lo>2*we){var Oo=de.add(it.sub(de)._mult(we/lo)._round());this.updateDistance(de,Oo),this.addCurrentVertex(Oo,ct,0,0,Oe),de=Oo}}}}},al.prototype.addCurrentVertex=function(i,s,l,p,S,A){A===void 0&&(A=!1);var I=s.y*p-s.x,U=-s.y-s.x*p;this.addHalfVertex(i,s.x+s.y*l,s.y-s.x*l,A,!1,l,S),this.addHalfVertex(i,I,U,A,!0,-p,S),this.distance>Wv/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,s,l,p,S,A))},al.prototype.addHalfVertex=function(i,s,l,p,S,A,I){var U=.5*(this.lineClips?this.scaledDistance*(Wv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i.x<<1)+(p?1:0),(i.y<<1)+(S?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(A===0?0:A<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var q=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),I.primitiveLength++),S?this.e2=q:this.e1=q},al.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},al.prototype.updateDistance=function(i,s){this.distance+=i.dist(s),this.updateScaledDistance()},Ui("LineBucket",al,{omit:["layers","patternFeatures"]});var Xv=new jl({"line-cap":new aa(Fe.layout_line["line-cap"]),"line-join":new ta(Fe.layout_line["line-join"]),"line-miter-limit":new aa(Fe.layout_line["line-miter-limit"]),"line-round-limit":new aa(Fe.layout_line["line-round-limit"]),"line-sort-key":new ta(Fe.layout_line["line-sort-key"])}),Qd={paint:new jl({"line-opacity":new ta(Fe.paint_line["line-opacity"]),"line-color":new ta(Fe.paint_line["line-color"]),"line-translate":new aa(Fe.paint_line["line-translate"]),"line-translate-anchor":new aa(Fe.paint_line["line-translate-anchor"]),"line-width":new ta(Fe.paint_line["line-width"]),"line-gap-width":new ta(Fe.paint_line["line-gap-width"]),"line-offset":new ta(Fe.paint_line["line-offset"]),"line-blur":new ta(Fe.paint_line["line-blur"]),"line-dasharray":new ba(Fe.paint_line["line-dasharray"]),"line-pattern":new Da(Fe.paint_line["line-pattern"]),"line-gradient":new bl(Fe.paint_line["line-gradient"])}),layout:Xv},yv=new(function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,p){return p=new xo(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),i.prototype.possiblyEvaluate.call(this,l,p)},s.prototype.evaluate=function(l,p,S,A){return p=jt({},p,{zoom:Math.floor(p.zoom)}),i.prototype.evaluate.call(this,l,p,S,A)},s}(ta))(Qd.paint.properties["line-width"].specification);yv.useIntegerZoom=!0;var _g=function(i){function s(l){i.call(this,l,Qd),this.gradientVersion=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof uu,this.gradientVersion=(this.gradientVersion+1)%Ie)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,p){i.prototype.recalculate.call(this,l,p),this.paint._values["line-floorwidth"]=yv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new al(l)},s.prototype.queryRadius=function(l){var p=l,S=mm(mc("line-width",this,p),mc("line-gap-width",this,p)),A=mc("line-offset",this,p);return S/2+Math.abs(A)+Hl(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,p,S,A,I,U,q){var re=lh(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),U.angle,q),de=q/2*mm(this.paint.get("line-width").evaluate(p,S),this.paint.get("line-gap-width").evaluate(p,S)),we=this.paint.get("line-offset").evaluate(p,S);return we&&(A=function(Oe,Ge){for(var it=[],tt=new pe(0,0),ct=0;ct<Oe.length;ct++){for(var ut=Oe[ct],Je=[],Pt=0;Pt<ut.length;Pt++){var Xt=ut[Pt],pr=ut[Pt+1],Ur=Pt===0?tt:Xt.sub(ut[Pt-1])._unit()._perp(),tn=Pt===ut.length-1?tt:pr.sub(Xt)._unit()._perp(),An=Ur._add(tn)._unit();An._mult(1/(An.x*tn.x+An.y*tn.y)),Je.push(An._mult(Ge)._add(Xt))}it.push(Je)}return it}(A,we*q)),function(Oe,Ge,it){for(var tt=0;tt<Ge.length;tt++){var ct=Ge[tt];if(Oe.length>=3){for(var ut=0;ut<ct.length;ut++)if(Gl(Oe,ct[ut]))return!0}if(Yc(Oe,ct,it))return!0}return!1}(re,A,de)},s.prototype.isTileClipped=function(){return!0},s}(df);function mm(i,s){return s>0?s+2*i:i}var bg=vl([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kp=vl([{name:"a_projected_pos",components:3,type:"Float32"}],4),Bm=(vl([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),vl([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ad=(vl([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),vl([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),ev=vl([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fc(i,s,l){return i.sections.forEach(function(p){p.text=function(S,A,I){var U=A.layout.get("text-transform").evaluate(I,{});return U==="uppercase"?S=S.toLocaleUpperCase():U==="lowercase"&&(S=S.toLocaleLowerCase()),_l.applyArabicShaping&&(S=_l.applyArabicShaping(S)),S}(p.text,s,l)}),i}vl([{name:"triangle",components:3,type:"Uint16"}]),vl([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),vl([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),vl([{type:"Float32",name:"offsetX"}]),vl([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var tp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Nd=function(i,s,l,p,S){var A,I,U=8*S-p-1,q=(1<<U)-1,re=q>>1,de=-7,we=l?S-1:0,Oe=l?-1:1,Ge=i[s+we];for(we+=Oe,A=Ge&(1<<-de)-1,Ge>>=-de,de+=U;de>0;A=256*A+i[s+we],we+=Oe,de-=8);for(I=A&(1<<-de)-1,A>>=-de,de+=p;de>0;I=256*I+i[s+we],we+=Oe,de-=8);if(A===0)A=1-re;else{if(A===q)return I?NaN:1/0*(Ge?-1:1);I+=Math.pow(2,p),A-=re}return(Ge?-1:1)*I*Math.pow(2,A-p)},ze=function(i,s,l,p,S,A){var I,U,q,re=8*A-S-1,de=(1<<re)-1,we=de>>1,Oe=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ge=p?0:A-1,it=p?1:-1,tt=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(U=isNaN(s)?1:0,I=de):(I=Math.floor(Math.log(s)/Math.LN2),s*(q=Math.pow(2,-I))<1&&(I--,q*=2),(s+=I+we>=1?Oe/q:Oe*Math.pow(2,1-we))*q>=2&&(I++,q/=2),I+we>=de?(U=0,I=de):I+we>=1?(U=(s*q-1)*Math.pow(2,S),I+=we):(U=s*Math.pow(2,we-1)*Math.pow(2,S),I=0));S>=8;i[l+Ge]=255&U,Ge+=it,U/=256,S-=8);for(I=I<<S|U,re+=S;re>0;i[l+Ge]=255&I,Ge+=it,I/=256,re-=8);i[l+Ge-it]|=128*tt},At=Gt;function Gt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Gt.Varint=0,Gt.Fixed64=1,Gt.Bytes=2,Gt.Fixed32=5;var fn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Dn(i){return i.type===Gt.Bytes?i.readVarint()+i.pos:i.pos+1}function ln(i,s,l){return l?4294967296*s+(i>>>0):4294967296*(s>>>0)+(i>>>0)}function _n(i,s,l){var p=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(p);for(var S=l.pos-1;S>=i;S--)l.buf[S+p]=l.buf[S]}function Zn(i,s){for(var l=0;l<i.length;l++)s.writeVarint(i[l])}function ri(i,s){for(var l=0;l<i.length;l++)s.writeSVarint(i[l])}function Ci(i,s){for(var l=0;l<i.length;l++)s.writeFloat(i[l])}function _i(i,s){for(var l=0;l<i.length;l++)s.writeDouble(i[l])}function Li(i,s){for(var l=0;l<i.length;l++)s.writeBoolean(i[l])}function Fi(i,s){for(var l=0;l<i.length;l++)s.writeFixed32(i[l])}function hi(i,s){for(var l=0;l<i.length;l++)s.writeSFixed32(i[l])}function ki(i,s){for(var l=0;l<i.length;l++)s.writeFixed64(i[l])}function Wr(i,s){for(var l=0;l<i.length;l++)s.writeSFixed64(i[l])}function bn(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+16777216*i[s+3]}function di(i,s,l){i[l]=s,i[l+1]=s>>>8,i[l+2]=s>>>16,i[l+3]=s>>>24}function Gi(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+(i[s+3]<<24)}function Yn(i,s,l){i===1&&l.readMessage(ia,s)}function ia(i,s,l){if(i===3){var p=l.readMessage(oi,{}),S=p.width,A=p.height,I=p.left,U=p.top,q=p.advance;s.push({id:p.id,bitmap:new Ip({width:S+6,height:A+6},p.bitmap),metrics:{width:S,height:A,left:I,top:U,advance:q}})}}function oi(i,s,l){i===1?s.id=l.readVarint():i===2?s.bitmap=l.readBytes():i===3?s.width=l.readVarint():i===4?s.height=l.readVarint():i===5?s.left=l.readSVarint():i===6?s.top=l.readSVarint():i===7&&(s.advance=l.readVarint())}function Di(i){for(var s=0,l=0,p=0,S=i;p<S.length;p+=1){var A=S[p];s+=A.w*A.h,l=Math.max(l,A.w)}i.sort(function(tt,ct){return ct.h-tt.h});for(var I=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],U=0,q=0,re=0,de=i;re<de.length;re+=1)for(var we=de[re],Oe=I.length-1;Oe>=0;Oe--){var Ge=I[Oe];if(!(we.w>Ge.w||we.h>Ge.h)){if(we.x=Ge.x,we.y=Ge.y,q=Math.max(q,we.y+we.h),U=Math.max(U,we.x+we.w),we.w===Ge.w&&we.h===Ge.h){var it=I.pop();Oe<I.length&&(I[Oe]=it)}else we.h===Ge.h?(Ge.x+=we.w,Ge.w-=we.w):we.w===Ge.w?(Ge.y+=we.h,Ge.h-=we.h):(I.push({x:Ge.x+we.w,y:Ge.y,w:Ge.w-we.w,h:we.h}),Ge.y+=we.h,Ge.h-=we.h);break}}return{w:U,h:q,fill:s/(U*q)||0}}Gt.prototype={destroy:function(){this.buf=null},readFields:function(i,s,l){for(l=l||this.length;this.pos<l;){var p=this.readVarint(),S=p>>3,A=this.pos;this.type=7&p,i(S,s,this),this.pos===A&&this.skip(p)}return s},readMessage:function(i,s){return this.readFields(i,s,this.readVarint()+this.pos)},readFixed32:function(){var i=bn(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Gi(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=bn(this.buf,this.pos)+4294967296*bn(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=bn(this.buf,this.pos)+4294967296*Gi(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=Nd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Nd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var s,l,p=this.buf;return s=127&(l=p[this.pos++]),l<128?s:(s|=(127&(l=p[this.pos++]))<<7,l<128?s:(s|=(127&(l=p[this.pos++]))<<14,l<128?s:(s|=(127&(l=p[this.pos++]))<<21,l<128?s:function(S,A,I){var U,q,re=I.buf;if(U=(112&(q=re[I.pos++]))>>4,q<128||(U|=(127&(q=re[I.pos++]))<<3,q<128)||(U|=(127&(q=re[I.pos++]))<<10,q<128)||(U|=(127&(q=re[I.pos++]))<<17,q<128)||(U|=(127&(q=re[I.pos++]))<<24,q<128)||(U|=(1&(q=re[I.pos++]))<<31,q<128))return ln(S,U,A);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=p[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,s=this.pos;return this.pos=i,i-s>=12&&fn?function(l,p,S){return fn.decode(l.subarray(p,S))}(this.buf,s,i):function(l,p,S){for(var A="",I=p;I<S;){var U,q,re,de=l[I],we=null,Oe=de>239?4:de>223?3:de>191?2:1;if(I+Oe>S)break;Oe===1?de<128&&(we=de):Oe===2?(192&(U=l[I+1]))==128&&(we=(31&de)<<6|63&U)<=127&&(we=null):Oe===3?(q=l[I+2],(192&(U=l[I+1]))==128&&(192&q)==128&&((we=(15&de)<<12|(63&U)<<6|63&q)<=2047||we>=55296&&we<=57343)&&(we=null)):Oe===4&&(q=l[I+2],re=l[I+3],(192&(U=l[I+1]))==128&&(192&q)==128&&(192&re)==128&&((we=(15&de)<<18|(63&U)<<12|(63&q)<<6|63&re)<=65535||we>=1114112)&&(we=null)),we===null?(we=65533,Oe=1):we>65535&&(we-=65536,A+=String.fromCharCode(we>>>10&1023|55296),we=56320|1023&we),A+=String.fromCharCode(we),I+=Oe}return A}(this.buf,s,i)},readBytes:function(){var i=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,i);return this.pos=i,s},readPackedVarint:function(i,s){if(this.type!==Gt.Bytes)return i.push(this.readVarint(s));var l=Dn(this);for(i=i||[];this.pos<l;)i.push(this.readVarint(s));return i},readPackedSVarint:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSVarint());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Gt.Bytes)return i.push(this.readBoolean());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFloat());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Gt.Bytes)return i.push(this.readDouble());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed32());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed32());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed64());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed64());var s=Dn(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed64());return i},skip:function(i){var s=7&i;if(s===Gt.Varint)for(;this.buf[this.pos++]>127;);else if(s===Gt.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Gt.Fixed32)this.pos+=4;else{if(s!==Gt.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(i,s){this.writeVarint(i<<3|s)},realloc:function(i){for(var s=this.length||16;s<this.pos+i;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),di(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),di(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),di(this.buf,-1&i,this.pos),di(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),di(this.buf,-1&i,this.pos),di(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(s,l){var p,S;if(s>=0?(p=s%4294967296|0,S=s/4294967296|0):(S=~(-s/4294967296),4294967295^(p=~(-s%4294967296))?p=p+1|0:(p=0,S=S+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(A,I,U){U.buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,U.buf[U.pos]=127&(A>>>=7)}(p,0,l),function(A,I){var U=(7&A)<<4;I.buf[I.pos++]|=U|((A>>>=3)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A)))))}(S,l)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var s=this.pos;this.pos=function(p,S,A){for(var I,U,q=0;q<S.length;q++){if((I=S.charCodeAt(q))>55295&&I<57344){if(!U){I>56319||q+1===S.length?(p[A++]=239,p[A++]=191,p[A++]=189):U=I;continue}if(I<56320){p[A++]=239,p[A++]=191,p[A++]=189,U=I;continue}I=U-55296<<10|I-56320|65536,U=null}else U&&(p[A++]=239,p[A++]=191,p[A++]=189,U=null);I<128?p[A++]=I:(I<2048?p[A++]=I>>6|192:(I<65536?p[A++]=I>>12|224:(p[A++]=I>>18|240,p[A++]=I>>12&63|128),p[A++]=I>>6&63|128),p[A++]=63&I|128)}return A}(this.buf,i,this.pos);var l=this.pos-s;l>=128&&_n(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(i){this.realloc(4),ze(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ze(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var s=i.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=i[l]},writeRawMessage:function(i,s){this.pos++;var l=this.pos;i(s,this);var p=this.pos-l;p>=128&&_n(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p},writeMessage:function(i,s,l){this.writeTag(i,Gt.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(i,s){s.length&&this.writeMessage(i,Zn,s)},writePackedSVarint:function(i,s){s.length&&this.writeMessage(i,ri,s)},writePackedBoolean:function(i,s){s.length&&this.writeMessage(i,Li,s)},writePackedFloat:function(i,s){s.length&&this.writeMessage(i,Ci,s)},writePackedDouble:function(i,s){s.length&&this.writeMessage(i,_i,s)},writePackedFixed32:function(i,s){s.length&&this.writeMessage(i,Fi,s)},writePackedSFixed32:function(i,s){s.length&&this.writeMessage(i,hi,s)},writePackedFixed64:function(i,s){s.length&&this.writeMessage(i,ki,s)},writePackedSFixed64:function(i,s){s.length&&this.writeMessage(i,Wr,s)},writeBytesField:function(i,s){this.writeTag(i,Gt.Bytes),this.writeBytes(s)},writeFixed32Field:function(i,s){this.writeTag(i,Gt.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(i,s){this.writeTag(i,Gt.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(i,s){this.writeTag(i,Gt.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(i,s){this.writeTag(i,Gt.Fixed64),this.writeSFixed64(s)},writeVarintField:function(i,s){this.writeTag(i,Gt.Varint),this.writeVarint(s)},writeSVarintField:function(i,s){this.writeTag(i,Gt.Varint),this.writeSVarint(s)},writeStringField:function(i,s){this.writeTag(i,Gt.Bytes),this.writeString(s)},writeFloatField:function(i,s){this.writeTag(i,Gt.Fixed32),this.writeFloat(s)},writeDoubleField:function(i,s){this.writeTag(i,Gt.Fixed64),this.writeDouble(s)},writeBooleanField:function(i,s){this.writeVarintField(i,!!s)}};var qn=function(i,s){var l=s.pixelRatio,p=s.version,S=s.stretchX,A=s.stretchY,I=s.content;this.paddedRect=i,this.pixelRatio=l,this.stretchX=S,this.stretchY=A,this.content=I,this.version=p},Ai={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ai.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ai.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ai.tlbr.get=function(){return this.tl.concat(this.br)},Ai.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(qn.prototype,Ai);var Oa=function(i,s){var l={},p={};this.haveRenderCallbacks=[];var S=[];this.addImages(i,l,S),this.addImages(s,p,S);var A=Di(S),I=new Fl({width:A.w||1,height:A.h||1});for(var U in i){var q=i[U],re=l[U].paddedRect;Fl.copy(q.data,I,{x:0,y:0},{x:re.x+1,y:re.y+1},q.data)}for(var de in s){var we=s[de],Oe=p[de].paddedRect,Ge=Oe.x+1,it=Oe.y+1,tt=we.data.width,ct=we.data.height;Fl.copy(we.data,I,{x:0,y:0},{x:Ge,y:it},we.data),Fl.copy(we.data,I,{x:0,y:ct-1},{x:Ge,y:it-1},{width:tt,height:1}),Fl.copy(we.data,I,{x:0,y:0},{x:Ge,y:it+ct},{width:tt,height:1}),Fl.copy(we.data,I,{x:tt-1,y:0},{x:Ge-1,y:it},{width:1,height:ct}),Fl.copy(we.data,I,{x:0,y:0},{x:Ge+tt,y:it},{width:1,height:ct})}this.image=I,this.iconPositions=l,this.patternPositions=p};Oa.prototype.addImages=function(i,s,l){for(var p in i){var S=i[p],A={x:0,y:0,w:S.data.width+2,h:S.data.height+2};l.push(A),s[p]=new qn(A,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Oa.prototype.patchUpdatedImages=function(i,s){for(var l in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[l],i.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],i.getImage(l),s)},Oa.prototype.patchUpdatedImage=function(i,s,l){if(i&&s&&i.version!==s.version){i.version=s.version;var p=i.tl;l.update(s.data,void 0,{x:p[0],y:p[1]})}},Ui("ImagePosition",qn),Ui("ImageAtlas",Oa);var Ya={horizontal:1,vertical:2,horizontalOnly:3},Oi=function(){this.scale=1,this.fontStack="",this.imageName=null};Oi.forText=function(i,s){var l=new Oi;return l.scale=i||1,l.fontStack=s,l},Oi.forImage=function(i){var s=new Oi;return s.imageName=i,s};var Qn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Hn(i,s,l,p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt){var ct,ut=Qn.fromFeature(i,S);we===Ya.vertical&&ut.verticalizePunctuation();var Je=_l.processBidirectionalText,Pt=_l.processStyledBidirectionalText;if(Je&&ut.sections.length===1){ct=[];for(var Xt=0,pr=Je(ut.toString(),Fs(ut,re,A,s,p,Ge,it));Xt<pr.length;Xt+=1){var Ur=pr[Xt],tn=new Qn;tn.text=Ur,tn.sections=ut.sections;for(var An=0;An<Ur.length;An++)tn.sectionIndex.push(0);ct.push(tn)}}else if(Pt){ct=[];for(var xi=0,On=Pt(ut.text,ut.sectionIndex,Fs(ut,re,A,s,p,Ge,it));xi<On.length;xi+=1){var si=On[xi],kn=new Qn;kn.text=si[0],kn.sectionIndex=si[1],kn.sections=ut.sections,ct.push(kn)}}else ct=function($n,Si){for(var Kn=[],la=$n.text,yn=0,Ti=0,Aa=Si;Ti<Aa.length;Ti+=1){var $o=Aa[Ti];Kn.push($n.substring(yn,$o)),yn=$o}return yn<la.length&&Kn.push($n.substring(yn,la.length)),Kn}(ut,Fs(ut,re,A,s,p,Ge,it));var ci=[],wi={positionedLines:ci,text:ut.toString(),top:de[1],bottom:de[1],left:de[0],right:de[0],writingMode:we,iconsInText:!1,verticalizable:!1};return function($n,Si,Kn,la,yn,Ti,Aa,$o,lo,Oo,So,cs){for(var Wo=0,Bo=-17,Xo=0,Au=0,Wi=$o==="right"?1:$o==="left"?0:.5,hs=0,Ba=0,bs=yn;Ba<bs.length;Ba+=1){var ms=bs[Ba];ms.trim();var Eo=ms.getMaxScale(),gu=24*(Eo-1),fs={positionedGlyphs:[],lineOffset:0};$n.positionedLines[hs]=fs;var Cn=fs.positionedGlyphs,Ma=0;if(ms.length()){for(var go=0;go<ms.length();go++){var Na=ms.getSection(go),v=ms.getSectionIndex(go),c=ms.getCharCode(go),b=0,k=null,z=null,V=null,W=24,ne=!(lo===Ya.horizontal||!So&&!xh(c)||So&&(mo[c]||(ir=c,Gn.Arabic(ir)||Gn["Arabic Supplement"](ir)||Gn["Arabic Extended-A"](ir)||Gn["Arabic Presentation Forms-A"](ir)||Gn["Arabic Presentation Forms-B"](ir))));if(Na.imageName){var he=la[Na.imageName];if(!he)continue;V=Na.imageName,$n.iconsInText=$n.iconsInText||!0,z=he.paddedRect;var Se=he.displaySize;Na.scale=24*Na.scale/cs,b=gu+(24-Se[1]*Na.scale),W=(k={width:Se[0],height:Se[1],left:1,top:-3,advance:ne?Se[1]:Se[0]}).advance;var Ne=ne?Se[0]*Na.scale-24*Eo:Se[1]*Na.scale-24*Eo;Ne>0&&Ne>Ma&&(Ma=Ne)}else{var We=Kn[Na.fontStack],ht=We&&We[c];if(ht&&ht.rect)z=ht.rect,k=ht.metrics;else{var gt=Si[Na.fontStack],St=gt&&gt[c];if(!St)continue;k=St.metrics}b=24*(Eo-Na.scale)}ne?($n.verticalizable=!0,Cn.push({glyph:c,imageName:V,x:Wo,y:Bo+b,vertical:ne,scale:Na.scale,fontStack:Na.fontStack,sectionIndex:v,metrics:k,rect:z}),Wo+=W*Na.scale+Oo):(Cn.push({glyph:c,imageName:V,x:Wo,y:Bo+b,vertical:ne,scale:Na.scale,fontStack:Na.fontStack,sectionIndex:v,metrics:k,rect:z}),Wo+=k.advance*Na.scale+Oo)}Cn.length!==0&&(Xo=Math.max(Wo-Oo,Xo),ks(Cn,0,Cn.length-1,Wi,Ma)),Wo=0;var Ht=Ti*Eo+Ma;fs.lineOffset=Math.max(Ma,gu),Bo+=Ht,Au=Math.max(Ht,Au),++hs}else Bo+=Ti,++hs}var ir,fr=Bo- -17,Gr=xl(Aa),Tr=Gr.horizontalAlign,Jr=Gr.verticalAlign;(function(wn,ii,da,$a,fa,ra,Xi,ga,qi){var Ei,Wa=(ii-da)*fa;Ei=ra!==Xi?-ga*$a- -17:(-$a*qi+.5)*Xi;for(var Ta=0,gs=wn;Ta<gs.length;Ta+=1)for(var gl=0,Sl=gs[Ta].positionedGlyphs;gl<Sl.length;gl+=1){var zc=Sl[gl];zc.x+=Wa,zc.y+=Ei}})($n.positionedLines,Wi,Tr,Jr,Xo,Au,Ti,fr,yn.length),$n.top+=-Jr*fr,$n.bottom=$n.top+fr,$n.left+=-Tr*Xo,$n.right=$n.left+Xo}(wi,s,l,p,ct,I,U,q,we,re,Oe,tt),!function($n){for(var Si=0,Kn=$n;Si<Kn.length;Si+=1)if(Kn[Si].positionedGlyphs.length!==0)return!1;return!0}(ci)&&wi}Qn.fromFeature=function(i,s){for(var l=new Qn,p=0;p<i.sections.length;p++){var S=i.sections[p];S.image?l.addImageSection(S):l.addTextSection(S,s)}return l},Qn.prototype.length=function(){return this.text.length},Qn.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},Qn.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},Qn.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},Qn.prototype.verticalizePunctuation=function(){this.text=function(i){for(var s="",l=0;l<i.length;l++){var p=i.charCodeAt(l+1)||null,S=i.charCodeAt(l-1)||null;s+=p&&Xh(p)&&!tp[i[l+1]]||S&&Xh(S)&&!tp[i[l-1]]||!tp[i[l]]?i[l]:tp[i[l]]}return s}(this.text)},Qn.prototype.trim=function(){for(var i=0,s=0;s<this.text.length&&mo[this.text.charCodeAt(s)];s++)i++;for(var l=this.text.length,p=this.text.length-1;p>=0&&p>=i&&mo[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)},Qn.prototype.substring=function(i,s){var l=new Qn;return l.text=this.text.substring(i,s),l.sectionIndex=this.sectionIndex.slice(i,s),l.sections=this.sections,l},Qn.prototype.toString=function(){return this.text},Qn.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,i.sections[l].scale)},0)},Qn.prototype.addTextSection=function(i,s){this.text+=i.text,this.sections.push(Oi.forText(i.scale,i.fontStack||s));for(var l=this.sections.length-1,p=0;p<i.text.length;++p)this.sectionIndex.push(l)},Qn.prototype.addImageSection=function(i){var s=i.image?i.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Oi.forImage(s)),this.sectionIndex.push(this.sections.length-1)):or("Reached maximum number of images 6401")}else or("Can't add FormattedSection with an empty image.")},Qn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var mo={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},so={};function sa(i,s,l,p,S,A){if(s.imageName){var I=p[s.imageName];return I?I.displaySize[0]*s.scale*24/A+S:0}var U=l[s.fontStack],q=U&&U[i];return q?q.metrics.advance*s.scale+S:0}function Cs(i,s,l,p){var S=Math.pow(i-s,2);return p?i<s?S/2:2*S:S+Math.abs(l)*l}function Vo(i,s,l){var p=0;return i===10&&(p-=1e4),l&&(p+=150),i!==40&&i!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function Go(i,s,l,p,S,A){for(var I=null,U=Cs(s,l,S,A),q=0,re=p;q<re.length;q+=1){var de=re[q],we=Cs(s-de.x,l,S,A)+de.badness;we<=U&&(I=de,U=we)}return{index:i,x:s,priorBreak:I,badness:U}}function Fs(i,s,l,p,S,A,I){if(A!=="point")return[];if(!i)return[];for(var U,q=[],re=function(ct,ut,Je,Pt,Xt,pr){for(var Ur=0,tn=0;tn<ct.length();tn++){var An=ct.getSection(tn);Ur+=sa(ct.getCharCode(tn),An,Pt,Xt,ut,pr)}return Ur/Math.max(1,Math.ceil(Ur/Je))}(i,s,l,p,S,I),de=i.text.indexOf("\u200B")>=0,we=0,Oe=0;Oe<i.length();Oe++){var Ge=i.getSection(Oe),it=i.getCharCode(Oe);if(mo[it]||(we+=sa(it,Ge,p,S,s,I)),Oe<i.length()-1){var tt=!((U=it)<11904||!(Gn["Bopomofo Extended"](U)||Gn.Bopomofo(U)||Gn["CJK Compatibility Forms"](U)||Gn["CJK Compatibility Ideographs"](U)||Gn["CJK Compatibility"](U)||Gn["CJK Radicals Supplement"](U)||Gn["CJK Strokes"](U)||Gn["CJK Symbols and Punctuation"](U)||Gn["CJK Unified Ideographs Extension A"](U)||Gn["CJK Unified Ideographs"](U)||Gn["Enclosed CJK Letters and Months"](U)||Gn["Halfwidth and Fullwidth Forms"](U)||Gn.Hiragana(U)||Gn["Ideographic Description Characters"](U)||Gn["Kangxi Radicals"](U)||Gn["Katakana Phonetic Extensions"](U)||Gn.Katakana(U)||Gn["Vertical Forms"](U)||Gn["Yi Radicals"](U)||Gn["Yi Syllables"](U)));(so[it]||tt||Ge.imageName)&&q.push(Go(Oe+1,we,re,q,Vo(it,i.getCharCode(Oe+1),tt&&de),!1))}}return function ct(ut){return ut?ct(ut.priorBreak).concat(ut.index):[]}(Go(i.length(),we,re,q,0,!0))}function xl(i){var s=.5,l=.5;switch(i){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function ks(i,s,l,p,S){if(p||S)for(var A=i[l],I=(i[l].x+A.metrics.advance*A.scale)*p,U=s;U<=l;U++)i[U].x-=I,i[U].y+=S}function Ho(i,s,l,p,S,A){var I,U=i.image;if(U.content){var q=U.content,re=U.pixelRatio||1;I=[q[0]/re,q[1]/re,U.displaySize[0]-q[2]/re,U.displaySize[1]-q[3]/re]}var de,we,Oe,Ge,it=s.left*A,tt=s.right*A;l==="width"||l==="both"?(Ge=S[0]+it-p[3],we=S[0]+tt+p[1]):we=(Ge=S[0]+(it+tt-U.displaySize[0])/2)+U.displaySize[0];var ct=s.top*A,ut=s.bottom*A;return l==="height"||l==="both"?(de=S[1]+ct-p[0],Oe=S[1]+ut+p[2]):Oe=(de=S[1]+(ct+ut-U.displaySize[1])/2)+U.displaySize[1],{image:U,top:de,right:we,bottom:Oe,left:Ge,collisionPadding:I}}so[10]=!0,so[32]=!0,so[38]=!0,so[40]=!0,so[41]=!0,so[43]=!0,so[45]=!0,so[47]=!0,so[173]=!0,so[183]=!0,so[8203]=!0,so[8208]=!0,so[8211]=!0,so[8231]=!0;var ss=function(i){function s(l,p,S,A){i.call(this,l,p),this.angle=S,A!==void 0&&(this.segment=A)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(pe);function As(i,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new xo(i+1))};if(l.kind==="source")return{kind:"source"};for(var p=l.zoomStops,S=l.interpolationType,A=0;A<p.length&&p[A]<=i;)A++;for(var I=A=Math.max(0,A-1);I<p.length&&p[I]<i+1;)I++;I=Math.min(p.length-1,I);var U=p[A],q=p[I];return l.kind==="composite"?{kind:"composite",minZoom:U,maxZoom:q,interpolationType:S}:{kind:"camera",minZoom:U,maxZoom:q,minSize:l.evaluate(new xo(U)),maxSize:l.evaluate(new xo(q)),interpolationType:S}}function Lo(i,s,l){var p=s.uSize,S=l.lowerSize;return i.kind==="source"?S/128:i.kind==="composite"?Ja(S/128,l.upperSize/128,s.uSizeT):p}function Pl(i,s){var l=0,p=0;if(i.kind==="constant")p=i.layoutSize;else if(i.kind!=="source"){var S=i.interpolationType,A=S?nt(Bu.interpolationFactor(S,s,i.minZoom,i.maxZoom),0,1):0;i.kind==="camera"?p=Ja(i.minSize,i.maxSize,A):l=A}return{uSizeT:l,uSize:p}}Ui("Anchor",ss);var $l=Object.freeze({__proto__:null,getSizeData:As,evaluateSizeForFeature:Lo,evaluateSizeForZoom:Pl,SIZE_PACK_FACTOR:128});function bu(i,s,l,p,S){if(s.segment===void 0)return!0;for(var A=s,I=s.segment+1,U=0;U>-l/2;){if(--I<0)return!1;U-=i[I].dist(A),A=i[I]}U+=i[I].dist(i[I+1]),I++;for(var q=[],re=0;U<l/2;){var de=i[I],we=i[I+1];if(!we)return!1;var Oe=i[I-1].angleTo(de)-de.angleTo(we);for(Oe=Math.abs((Oe+3*Math.PI)%(2*Math.PI)-Math.PI),q.push({distance:U,angleDelta:Oe}),re+=Oe;U-q[0].distance>p;)re-=q.shift().angleDelta;if(re>S)return!1;I++,U+=de.dist(we)}return!0}function Hu(i){for(var s=0,l=0;l<i.length-1;l++)s+=i[l].dist(i[l+1]);return s}function Du(i,s,l){return i?.6*s*l:0}function Ro(i,s){return Math.max(i?i.right-i.left:0,s?s.right-s.left:0)}function Kc(i,s,l,p,S,A){for(var I=Du(l,S,A),U=Ro(l,p)*A,q=0,re=Hu(i)/2,de=0;de<i.length-1;de++){var we=i[de],Oe=i[de+1],Ge=we.dist(Oe);if(q+Ge>re){var it=(re-q)/Ge,tt=Ja(we.x,Oe.x,it),ct=Ja(we.y,Oe.y,it),ut=new ss(tt,ct,Oe.angleTo(we),de);return ut._round(),!I||bu(i,ut,U,I,s)?ut:void 0}q+=Ge}}function lu(i,s,l,p,S,A,I,U,q){var re=Du(p,A,I),de=Ro(p,S),we=de*I,Oe=i[0].x===0||i[0].x===q||i[0].y===0||i[0].y===q;return s-we<s/4&&(s=we+s/4),function Ge(it,tt,ct,ut,Je,Pt,Xt,pr,Ur){for(var tn=Pt/2,An=Hu(it),xi=0,On=tt-ct,si=[],kn=0;kn<it.length-1;kn++){for(var ci=it[kn],wi=it[kn+1],$n=ci.dist(wi),Si=wi.angleTo(ci);On+ct<xi+$n;){var Kn=((On+=ct)-xi)/$n,la=Ja(ci.x,wi.x,Kn),yn=Ja(ci.y,wi.y,Kn);if(la>=0&&la<Ur&&yn>=0&&yn<Ur&&On-tn>=0&&On+tn<=An){var Ti=new ss(la,yn,Si,kn);Ti._round(),ut&&!bu(it,Ti,Pt,ut,Je)||si.push(Ti)}}xi+=$n}return pr||si.length||Xt||(si=Ge(it,xi/2,ct,ut,Je,Pt,Xt,!0,Ur)),si}(i,Oe?s/2*U%s:(de/2+2*A)*I*U%s,s,re,l,we,Oe,!1,q)}function Fa(i,s,l,p,S){for(var A=[],I=0;I<i.length;I++)for(var U=i[I],q=void 0,re=0;re<U.length-1;re++){var de=U[re],we=U[re+1];de.x<s&&we.x<s||(de.x<s?de=new pe(s,de.y+(s-de.x)/(we.x-de.x)*(we.y-de.y))._round():we.x<s&&(we=new pe(s,de.y+(s-de.x)/(we.x-de.x)*(we.y-de.y))._round()),de.y<l&&we.y<l||(de.y<l?de=new pe(de.x+(l-de.y)/(we.y-de.y)*(we.x-de.x),l)._round():we.y<l&&(we=new pe(de.x+(l-de.y)/(we.y-de.y)*(we.x-de.x),l)._round()),de.x>=p&&we.x>=p||(de.x>=p?de=new pe(p,de.y+(p-de.x)/(we.x-de.x)*(we.y-de.y))._round():we.x>=p&&(we=new pe(p,de.y+(p-de.x)/(we.x-de.x)*(we.y-de.y))._round()),de.y>=S&&we.y>=S||(de.y>=S?de=new pe(de.x+(S-de.y)/(we.y-de.y)*(we.x-de.x),S)._round():we.y>=S&&(we=new pe(de.x+(S-de.y)/(we.y-de.y)*(we.x-de.x),S)._round()),q&&de.equals(q[q.length-1])||A.push(q=[de]),q.push(we)))))}return A}function Ts(i,s,l,p){var S=[],A=i.image,I=A.pixelRatio,U=A.paddedRect.w-2,q=A.paddedRect.h-2,re=i.right-i.left,de=i.bottom-i.top,we=A.stretchX||[[0,U]],Oe=A.stretchY||[[0,q]],Ge=function(la,yn){return la+yn[1]-yn[0]},it=we.reduce(Ge,0),tt=Oe.reduce(Ge,0),ct=U-it,ut=q-tt,Je=0,Pt=it,Xt=0,pr=tt,Ur=0,tn=ct,An=0,xi=ut;if(A.content&&p){var On=A.content;Je=us(we,0,On[0]),Xt=us(Oe,0,On[1]),Pt=us(we,On[0],On[2]),pr=us(Oe,On[1],On[3]),Ur=On[0]-Je,An=On[1]-Xt,tn=On[2]-On[0]-Pt,xi=On[3]-On[1]-pr}var si=function(la,yn,Ti,Aa){var $o=zh(la.stretch-Je,Pt,re,i.left),lo=rp(la.fixed-Ur,tn,la.stretch,it),Oo=zh(yn.stretch-Xt,pr,de,i.top),So=rp(yn.fixed-An,xi,yn.stretch,tt),cs=zh(Ti.stretch-Je,Pt,re,i.left),Wo=rp(Ti.fixed-Ur,tn,Ti.stretch,it),Bo=zh(Aa.stretch-Xt,pr,de,i.top),Xo=rp(Aa.fixed-An,xi,Aa.stretch,tt),Au=new pe($o,Oo),Wi=new pe(cs,Oo),hs=new pe(cs,Bo),Ba=new pe($o,Bo),bs=new pe(lo/I,So/I),ms=new pe(Wo/I,Xo/I),Eo=s*Math.PI/180;if(Eo){var gu=Math.sin(Eo),fs=Math.cos(Eo),Cn=[fs,-gu,gu,fs];Au._matMult(Cn),Wi._matMult(Cn),Ba._matMult(Cn),hs._matMult(Cn)}var Ma=la.stretch+la.fixed,go=yn.stretch+yn.fixed;return{tl:Au,tr:Wi,bl:Ba,br:hs,tex:{x:A.paddedRect.x+1+Ma,y:A.paddedRect.y+1+go,w:Ti.stretch+Ti.fixed-Ma,h:Aa.stretch+Aa.fixed-go},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bs,pixelOffsetBR:ms,minFontScaleX:tn/I/re,minFontScaleY:xi/I/de,isSDF:l}};if(p&&(A.stretchX||A.stretchY))for(var kn=Iu(we,ct,it),ci=Iu(Oe,ut,tt),wi=0;wi<kn.length-1;wi++)for(var $n=kn[wi],Si=kn[wi+1],Kn=0;Kn<ci.length-1;Kn++)S.push(si($n,ci[Kn],Si,ci[Kn+1]));else S.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:U+1},{fixed:0,stretch:q+1}));return S}function us(i,s,l){for(var p=0,S=0,A=i;S<A.length;S+=1){var I=A[S];p+=Math.max(s,Math.min(l,I[1]))-Math.max(s,Math.min(l,I[0]))}return p}function Iu(i,s,l){for(var p=[{fixed:-1,stretch:0}],S=0,A=i;S<A.length;S+=1){var I=A[S],U=I[0],q=I[1],re=p[p.length-1];p.push({fixed:U-re.stretch,stretch:re.stretch}),p.push({fixed:U-re.stretch,stretch:re.stretch+(q-U)})}return p.push({fixed:s+1,stretch:l}),p}function zh(i,s,l,p){return i/s*l+p}function rp(i,s,l,p){return i-s*l/p}var qt=function(i,s,l,p,S,A,I,U,q,re){if(this.boxStartIndex=i.length,q){var de=A.top,we=A.bottom,Oe=A.collisionPadding;Oe&&(de-=Oe[1],we+=Oe[3]);var Ge=we-de;Ge>0&&(Ge=Math.max(10,Ge),this.circleDiameter=Ge)}else{var it=A.top*I-U,tt=A.bottom*I+U,ct=A.left*I-U,ut=A.right*I+U,Je=A.collisionPadding;if(Je&&(ct-=Je[0]*I,it-=Je[1]*I,ut+=Je[2]*I,tt+=Je[3]*I),re){var Pt=new pe(ct,it),Xt=new pe(ut,it),pr=new pe(ct,tt),Ur=new pe(ut,tt),tn=re*Math.PI/180;Pt._rotate(tn),Xt._rotate(tn),pr._rotate(tn),Ur._rotate(tn),ct=Math.min(Pt.x,Xt.x,pr.x,Ur.x),ut=Math.max(Pt.x,Xt.x,pr.x,Ur.x),it=Math.min(Pt.y,Xt.y,pr.y,Ur.y),tt=Math.max(Pt.y,Xt.y,pr.y,Ur.y)}i.emplaceBack(s.x,s.y,ct,it,ut,tt,l,p,S)}this.boxEndIndex=i.length},pn=function(i,s){if(i===void 0&&(i=[]),s===void 0&&(s=en),this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function en(i,s){return i<s?-1:i>s?1:0}function ua(i,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var p=1/0,S=1/0,A=-1/0,I=-1/0,U=i[0],q=0;q<U.length;q++){var re=U[q];(!q||re.x<p)&&(p=re.x),(!q||re.y<S)&&(S=re.y),(!q||re.x>A)&&(A=re.x),(!q||re.y>I)&&(I=re.y)}var de=Math.min(A-p,I-S),we=de/2,Oe=new pn([],ls);if(de===0)return new pe(p,S);for(var Ge=p;Ge<A;Ge+=de)for(var it=S;it<I;it+=de)Oe.push(new Nt(Ge+we,it+we,we,i));for(var tt=function(Je){for(var Pt=0,Xt=0,pr=0,Ur=Je[0],tn=0,An=Ur.length,xi=An-1;tn<An;xi=tn++){var On=Ur[tn],si=Ur[xi],kn=On.x*si.y-si.x*On.y;Xt+=(On.x+si.x)*kn,pr+=(On.y+si.y)*kn,Pt+=3*kn}return new Nt(Xt/Pt,pr/Pt,0,Je)}(i),ct=Oe.length;Oe.length;){var ut=Oe.pop();(ut.d>tt.d||!tt.d)&&(tt=ut,l&&console.log("found best %d after %d probes",Math.round(1e4*ut.d)/1e4,ct)),ut.max-tt.d<=s||(Oe.push(new Nt(ut.p.x-(we=ut.h/2),ut.p.y-we,we,i)),Oe.push(new Nt(ut.p.x+we,ut.p.y-we,we,i)),Oe.push(new Nt(ut.p.x-we,ut.p.y+we,we,i)),Oe.push(new Nt(ut.p.x+we,ut.p.y+we,we,i)),ct+=4)}return l&&(console.log("num probes: "+ct),console.log("best distance: "+tt.d)),tt.p}function ls(i,s){return s.max-i.max}function Nt(i,s,l,p){this.p=new pe(i,s),this.h=l,this.d=function(S,A){for(var I=!1,U=1/0,q=0;q<A.length;q++)for(var re=A[q],de=0,we=re.length,Oe=we-1;de<we;Oe=de++){var Ge=re[de],it=re[Oe];Ge.y>S.y!=it.y>S.y&&S.x<(it.x-Ge.x)*(S.y-Ge.y)/(it.y-Ge.y)+Ge.x&&(I=!I),U=Math.min(U,Dc(S,Ge,it))}return(I?1:-1)*Math.sqrt(U)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}pn.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},pn.prototype.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}},pn.prototype.peek=function(){return this.data[0]},pn.prototype._up=function(i){for(var s=this.data,l=this.compare,p=s[i];i>0;){var S=i-1>>1,A=s[S];if(l(p,A)>=0)break;s[i]=A,i=S}s[i]=p},pn.prototype._down=function(i){for(var s=this.data,l=this.compare,p=this.length>>1,S=s[i];i<p;){var A=1+(i<<1),I=s[A],U=A+1;if(U<this.length&&l(s[U],I)<0&&(A=U,I=s[U]),l(I,S)>=0)break;s[i]=I,i=A}s[i]=S};var Et=Number.POSITIVE_INFINITY;function gr(i,s){return s[1]!==Et?function(l,p,S){var A=0,I=0;switch(p=Math.abs(p),S=Math.abs(S),l){case"top-right":case"top-left":case"top":I=S-7;break;case"bottom-right":case"bottom-left":case"bottom":I=7-S}switch(l){case"top-right":case"bottom-right":case"right":A=-p;break;case"top-left":case"bottom-left":case"left":A=p}return[A,I]}(i,s[0],s[1]):function(l,p){var S=0,A=0;p<0&&(p=0);var I=p/Math.sqrt(2);switch(l){case"top-right":case"top-left":A=I-7;break;case"bottom-right":case"bottom-left":A=7-I;break;case"bottom":A=7-p;break;case"top":A=p-7}switch(l){case"top-right":case"bottom-right":S=-I;break;case"top-left":case"bottom-left":S=I;break;case"left":S=p;break;case"right":S=-p}return[S,A]}(i,s[0])}function Vr(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $r(i,s,l,p,S,A,I,U,q,re,de,we,Oe,Ge,it){var tt=function(Xt,pr,Ur,tn,An,xi,On,si){for(var kn=tn.layout.get("text-rotate").evaluate(xi,{})*Math.PI/180,ci=[],wi=0,$n=pr.positionedLines;wi<$n.length;wi+=1)for(var Si=$n[wi],Kn=0,la=Si.positionedGlyphs;Kn<la.length;Kn+=1){var yn=la[Kn];if(yn.rect){var Ti=yn.rect||{},Aa=4,$o=!0,lo=1,Oo=0,So=(An||si)&&yn.vertical,cs=yn.metrics.advance*yn.scale/2;if(si&&pr.verticalizable&&(Oo=Si.lineOffset/2-(yn.imageName?-(24-yn.metrics.width*yn.scale)/2:24*(yn.scale-1))),yn.imageName){var Wo=On[yn.imageName];$o=Wo.sdf,Aa=1/(lo=Wo.pixelRatio)}var Bo=An?[yn.x+cs,yn.y]:[0,0],Xo=An?[0,0]:[yn.x+cs+Ur[0],yn.y+Ur[1]-Oo],Au=[0,0];So&&(Au=Xo,Xo=[0,0]);var Wi=(yn.metrics.left-Aa)*yn.scale-cs+Xo[0],hs=(-yn.metrics.top-Aa)*yn.scale+Xo[1],Ba=Wi+Ti.w*yn.scale/lo,bs=hs+Ti.h*yn.scale/lo,ms=new pe(Wi,hs),Eo=new pe(Ba,hs),gu=new pe(Wi,bs),fs=new pe(Ba,bs);if(So){var Cn=new pe(-cs,cs- -17),Ma=-Math.PI/2,go=12-cs,Na=new pe(22-go,-(yn.imageName?go:0)),v=new(Function.prototype.bind.apply(pe,[null].concat(Au)));ms._rotateAround(Ma,Cn)._add(Na)._add(v),Eo._rotateAround(Ma,Cn)._add(Na)._add(v),gu._rotateAround(Ma,Cn)._add(Na)._add(v),fs._rotateAround(Ma,Cn)._add(Na)._add(v)}if(kn){var c=Math.sin(kn),b=Math.cos(kn),k=[b,-c,c,b];ms._matMult(k),Eo._matMult(k),gu._matMult(k),fs._matMult(k)}var z=new pe(0,0),V=new pe(0,0);ci.push({tl:ms,tr:Eo,bl:gu,br:fs,tex:Ti,writingMode:pr.writingMode,glyphOffset:Bo,sectionIndex:yn.sectionIndex,isSDF:$o,pixelOffsetTL:z,pixelOffsetBR:V,minFontScaleX:0,minFontScaleY:0})}}return ci}(0,l,U,S,A,I,p,i.allowVerticalPlacement),ct=i.textSizeData,ut=null;ct.kind==="source"?(ut=[128*S.layout.get("text-size").evaluate(I,{})])[0]>32640&&or(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ct.kind==="composite"&&((ut=[128*Ge.compositeTextSizes[0].evaluate(I,{},it),128*Ge.compositeTextSizes[1].evaluate(I,{},it)])[0]>32640||ut[1]>32640)&&or(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),i.addSymbols(i.text,tt,ut,U,A,I,re,s,q.lineStartIndex,q.lineLength,Oe,it);for(var Je=0,Pt=de;Je<Pt.length;Je+=1)we[Pt[Je]]=i.text.placedSymbolArray.length-1;return 4*tt.length}function wr(i){for(var s in i)return i[s];return null}function ur(i,s,l,p){var S=i.compareText;if(s in S){for(var A=S[s],I=A.length-1;I>=0;I--)if(p.dist(A[I])<l)return!0}else S[s]=[];return S[s].push(p),!1}var Lr=Jd.VectorTileFeature.types,Zt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lr(i,s,l,p,S,A,I,U,q,re,de,we,Oe){var Ge=U?Math.min(32640,Math.round(U[0])):0,it=U?Math.min(32640,Math.round(U[1])):0;i.emplaceBack(s,l,Math.round(32*p),Math.round(32*S),A,I,(Ge<<1)+(q?1:0),it,16*re,16*de,256*we,256*Oe)}function It(i,s,l){i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l)}function Zr(i){for(var s=0,l=i.sections;s<l.length;s+=1)if(ff(l[s].text))return!0;return!1}var Xr=function(i){this.layoutVertexArray=new Cc,this.indexArray=new h,this.programConfigurations=i,this.segments=new He,this.dynamicLayoutVertexArray=new Lf,this.opacityVertexArray=new Dh,this.placedSymbolArray=new T};Xr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Xr.prototype.upload=function(i,s,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,bg.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Kp.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Zt,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(i))},Xr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ui("SymbolBuffers",Xr);var Rn=function(i,s,l){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new l,this.segments=new He,this.collisionVertexArray=new D};Rn.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Bm.members,!0)},Rn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ui("CollisionBuffers",Rn);var dn=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ol([]),this.placementViewportMatrix=Ol([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=As(this.zoom,s["text-size"]),this.iconSizeData=As(this.zoom,s["icon-size"]);var l=this.layers[0].layout,p=l.get("symbol-sort-key"),S=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(A){return Ya[A]})),this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id}),this.sourceID=i.sourceID};dn.prototype.createArrays=function(){this.text=new Xr(new va(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new Xr(new va(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new X,this.lineVertexArray=new oe,this.symbolInstances=new $},dn.prototype.calculateGlyphDependencies=function(i,s,l,p,S){for(var A=0;A<i.length;A++)if(s[i.charCodeAt(A)]=!0,(l||p)&&S){var I=tp[i.charAt(A)];I&&(s[I.charCodeAt(0)]=!0)}},dn.prototype.populate=function(i,s,l){var p=this.layers[0],S=p.layout,A=S.get("text-font"),I=S.get("text-field"),U=S.get("icon-image"),q=(I.value.kind!=="constant"||I.value.value instanceof ws&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),re=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,de=S.get("symbol-sort-key");if(this.features=[],q||re){for(var we=s.iconDependencies,Oe=s.glyphDependencies,Ge=s.availableImages,it=new xo(this.zoom),tt=0,ct=i;tt<ct.length;tt+=1){var ut=ct[tt],Je=ut.feature,Pt=ut.id,Xt=ut.index,pr=ut.sourceLayerIndex,Ur=p._featureFilter.needGeometry,tn=Zs(Je,Ur);if(p._featureFilter.filter(it,tn,l)){Ur||(tn.geometry=Qo(Je));var An=void 0;if(q){var xi=p.getValueAndResolveTokens("text-field",tn,l,Ge),On=ws.factory(xi);Zr(On)&&(this.hasRTLText=!0),(!this.hasRTLText||pf()==="unavailable"||this.hasRTLText&&_l.isParsed())&&(An=Fc(On,p,tn))}var si=void 0;if(re){var kn=p.getValueAndResolveTokens("icon-image",tn,l,Ge);si=kn instanceof Ss?kn:Ss.fromString(kn)}if(An||si){var ci=this.sortFeaturesByKey?de.evaluate(tn,{},l):void 0;if(this.features.push({id:Pt,text:An,icon:si,index:Xt,sourceLayerIndex:pr,geometry:tn.geometry,properties:Je.properties,type:Lr[Je.type],sortKey:ci}),si&&(we[si.name]=!0),An){var wi=A.evaluate(tn,{},l).join(","),$n=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ya.vertical)>=0;for(var Si=0,Kn=An.sections;Si<Kn.length;Si+=1){var la=Kn[Si];if(la.image)we[la.image.name]=!0;else{var yn=ld(An.toString()),Ti=la.fontStack||wi,Aa=Oe[Ti]=Oe[Ti]||{};this.calculateGlyphDependencies(la.text,Aa,$n,this.allowVerticalPlacement,yn)}}}}}}S.get("symbol-placement")==="line"&&(this.features=function($o){var lo={},Oo={},So=[],cs=0;function Wo(Cn){So.push($o[Cn]),cs++}function Bo(Cn,Ma,go){var Na=Oo[Cn];return delete Oo[Cn],Oo[Ma]=Na,So[Na].geometry[0].pop(),So[Na].geometry[0]=So[Na].geometry[0].concat(go[0]),Na}function Xo(Cn,Ma,go){var Na=lo[Ma];return delete lo[Ma],lo[Cn]=Na,So[Na].geometry[0].shift(),So[Na].geometry[0]=go[0].concat(So[Na].geometry[0]),Na}function Au(Cn,Ma,go){var Na=go?Ma[0][Ma[0].length-1]:Ma[0][0];return Cn+":"+Na.x+":"+Na.y}for(var Wi=0;Wi<$o.length;Wi++){var hs=$o[Wi],Ba=hs.geometry,bs=hs.text?hs.text.toString():null;if(bs){var ms=Au(bs,Ba),Eo=Au(bs,Ba,!0);if(ms in Oo&&Eo in lo&&Oo[ms]!==lo[Eo]){var gu=Xo(ms,Eo,Ba),fs=Bo(ms,Eo,So[gu].geometry);delete lo[ms],delete Oo[Eo],Oo[Au(bs,So[fs].geometry,!0)]=fs,So[gu].geometry=null}else ms in Oo?Bo(ms,Eo,Ba):Eo in lo?Xo(ms,Eo,Ba):(Wo(Wi),lo[ms]=cs-1,Oo[Eo]=cs-1)}else Wo(Wi)}return So.filter(function(Cn){return Cn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function($o,lo){return $o.sortKey-lo.sortKey})}},dn.prototype.update=function(i,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,l))},dn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},dn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},dn.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},dn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},dn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},dn.prototype.addToLineVertexArray=function(i,s){var l=this.lineVertexArray.length;if(i.segment!==void 0){for(var p=i.dist(s[i.segment+1]),S=i.dist(s[i.segment]),A={},I=i.segment+1;I<s.length;I++)A[I]={x:s[I].x,y:s[I].y,tileUnitDistanceFromAnchor:p},I<s.length-1&&(p+=s[I+1].dist(s[I]));for(var U=i.segment||0;U>=0;U--)A[U]={x:s[U].x,y:s[U].y,tileUnitDistanceFromAnchor:S},U>0&&(S+=s[U-1].dist(s[U]));for(var q=0;q<s.length;q++){var re=A[q];this.lineVertexArray.emplaceBack(re.x,re.y,re.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},dn.prototype.addSymbols=function(i,s,l,p,S,A,I,U,q,re,de,we){for(var Oe=i.indexArray,Ge=i.layoutVertexArray,it=i.segments.prepareSegment(4*s.length,Ge,Oe,this.canOverlap?A.sortKey:void 0),tt=this.glyphOffsetArray.length,ct=it.vertexLength,ut=this.allowVerticalPlacement&&I===Ya.vertical?Math.PI/2:0,Je=A.text&&A.text.sections,Pt=0;Pt<s.length;Pt++){var Xt=s[Pt],pr=Xt.tl,Ur=Xt.tr,tn=Xt.bl,An=Xt.br,xi=Xt.tex,On=Xt.pixelOffsetTL,si=Xt.pixelOffsetBR,kn=Xt.minFontScaleX,ci=Xt.minFontScaleY,wi=Xt.glyphOffset,$n=Xt.isSDF,Si=Xt.sectionIndex,Kn=it.vertexLength,la=wi[1];lr(Ge,U.x,U.y,pr.x,la+pr.y,xi.x,xi.y,l,$n,On.x,On.y,kn,ci),lr(Ge,U.x,U.y,Ur.x,la+Ur.y,xi.x+xi.w,xi.y,l,$n,si.x,On.y,kn,ci),lr(Ge,U.x,U.y,tn.x,la+tn.y,xi.x,xi.y+xi.h,l,$n,On.x,si.y,kn,ci),lr(Ge,U.x,U.y,An.x,la+An.y,xi.x+xi.w,xi.y+xi.h,l,$n,si.x,si.y,kn,ci),It(i.dynamicLayoutVertexArray,U,ut),Oe.emplaceBack(Kn,Kn+1,Kn+2),Oe.emplaceBack(Kn+1,Kn+2,Kn+3),it.vertexLength+=4,it.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wi[0]),Pt!==s.length-1&&Si===s[Pt+1].sectionIndex||i.programConfigurations.populatePaintArrays(Ge.length,A,A.index,{},we,Je&&Je[Si])}i.placedSymbolArray.emplaceBack(U.x,U.y,tt,this.glyphOffsetArray.length-tt,ct,q,re,U.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],I,0,!1,0,de)},dn.prototype._addCollisionDebugVertex=function(i,s,l,p,S,A){return s.emplaceBack(0,0),i.emplaceBack(l.x,l.y,p,S,Math.round(A.x),Math.round(A.y))},dn.prototype.addCollisionDebugVertices=function(i,s,l,p,S,A,I){var U=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),q=U.vertexLength,re=S.layoutVertexArray,de=S.collisionVertexArray,we=I.anchorX,Oe=I.anchorY;this._addCollisionDebugVertex(re,de,A,we,Oe,new pe(i,s)),this._addCollisionDebugVertex(re,de,A,we,Oe,new pe(l,s)),this._addCollisionDebugVertex(re,de,A,we,Oe,new pe(l,p)),this._addCollisionDebugVertex(re,de,A,we,Oe,new pe(i,p)),U.vertexLength+=4;var Ge=S.indexArray;Ge.emplaceBack(q,q+1),Ge.emplaceBack(q+1,q+2),Ge.emplaceBack(q+2,q+3),Ge.emplaceBack(q+3,q),U.primitiveLength+=4},dn.prototype.addDebugCollisionBoxes=function(i,s,l,p){for(var S=i;S<s;S++){var A=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,p?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,l)}},dn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rn(Jf,Ad.members,ue),this.iconCollisionBox=new Rn(Jf,Ad.members,ue);for(var i=0;i<this.symbolInstances.length;i++){var s=this.symbolInstances.get(i);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},dn.prototype._deserializeCollisionBoxesForSymbol=function(i,s,l,p,S,A,I,U,q){for(var re={},de=s;de<l;de++){var we=i.get(de);re.textBox={x1:we.x1,y1:we.y1,x2:we.x2,y2:we.y2,anchorPointX:we.anchorPointX,anchorPointY:we.anchorPointY},re.textFeatureIndex=we.featureIndex;break}for(var Oe=p;Oe<S;Oe++){var Ge=i.get(Oe);re.verticalTextBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},re.verticalTextFeatureIndex=Ge.featureIndex;break}for(var it=A;it<I;it++){var tt=i.get(it);re.iconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},re.iconFeatureIndex=tt.featureIndex;break}for(var ct=U;ct<q;ct++){var ut=i.get(ct);re.verticalIconBox={x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,anchorPointX:ut.anchorPointX,anchorPointY:ut.anchorPointY},re.verticalIconFeatureIndex=ut.featureIndex;break}return re},dn.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},dn.prototype.hasTextData=function(){return this.text.segments.get().length>0},dn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},dn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},dn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},dn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},dn.prototype.addIndicesForPlacedSymbol=function(i,s){for(var l=i.placedSymbolArray.get(s),p=l.vertexStartIndex+4*l.numGlyphs,S=l.vertexStartIndex;S<p;S+=4)i.indexArray.emplaceBack(S,S+1,S+2),i.indexArray.emplaceBack(S+1,S+2,S+3)},dn.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(i),l=Math.cos(i),p=[],S=[],A=[],I=0;I<this.symbolInstances.length;++I){A.push(I);var U=this.symbolInstances.get(I);p.push(0|Math.round(s*U.anchorX+l*U.anchorY)),S.push(U.featureIndex)}return A.sort(function(q,re){return p[q]-p[re]||S[re]-S[q]}),A},dn.prototype.addToSortKeyRanges=function(i,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})},dn.prototype.sortFeatures=function(i){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,p=this.symbolInstanceIndexes;l<p.length;l+=1){var S=this.symbolInstances.get(p[l]);this.featureSortOrder.push(S.featureIndex),[S.rightJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.leftJustifiedTextSymbolIndex].forEach(function(A,I,U){A>=0&&U.indexOf(A)===I&&s.addIndicesForPlacedSymbol(s.text,A)}),S.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,S.verticalPlacedTextSymbolIndex),S.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.placedIconSymbolIndex),S.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ui("SymbolBucket",dn,{omit:["layers","collisionBoxArray","features","compareText"]}),dn.MAX_GLYPHS=65535,dn.addDynamicAttributes=It;var Pn=new jl({"symbol-placement":new aa(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new aa(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new aa(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ta(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new aa(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new aa(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new aa(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new aa(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new aa(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ta(Fe.layout_symbol["icon-size"]),"icon-text-fit":new aa(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new aa(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ta(Fe.layout_symbol["icon-image"]),"icon-rotate":new ta(Fe.layout_symbol["icon-rotate"]),"icon-padding":new aa(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new aa(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ta(Fe.layout_symbol["icon-offset"]),"icon-anchor":new ta(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new aa(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new aa(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new aa(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new ta(Fe.layout_symbol["text-field"]),"text-font":new ta(Fe.layout_symbol["text-font"]),"text-size":new ta(Fe.layout_symbol["text-size"]),"text-max-width":new ta(Fe.layout_symbol["text-max-width"]),"text-line-height":new aa(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ta(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new ta(Fe.layout_symbol["text-justify"]),"text-radial-offset":new ta(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new aa(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new ta(Fe.layout_symbol["text-anchor"]),"text-max-angle":new aa(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new aa(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new ta(Fe.layout_symbol["text-rotate"]),"text-padding":new aa(Fe.layout_symbol["text-padding"]),"text-keep-upright":new aa(Fe.layout_symbol["text-keep-upright"]),"text-transform":new ta(Fe.layout_symbol["text-transform"]),"text-offset":new ta(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new aa(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new aa(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new aa(Fe.layout_symbol["text-optional"])}),vi={paint:new jl({"icon-opacity":new ta(Fe.paint_symbol["icon-opacity"]),"icon-color":new ta(Fe.paint_symbol["icon-color"]),"icon-halo-color":new ta(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ta(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ta(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new aa(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new aa(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ta(Fe.paint_symbol["text-opacity"]),"text-color":new ta(Fe.paint_symbol["text-color"],{runtimeType:jn,getOverride:function(i){return i.textColor},hasOverride:function(i){return!!i.textColor}}),"text-halo-color":new ta(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new ta(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ta(Fe.paint_symbol["text-halo-blur"]),"text-translate":new aa(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new aa(Fe.paint_symbol["text-translate-anchor"])}),layout:Pn},Ea=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Nn,this.defaultValue=i};Ea.prototype.evaluate=function(i){if(i.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},Ea.prototype.eachChild=function(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return null},Ui("FormatSectionOverride",Ea,{omit:["defaultValue"]});var ts=function(i){function s(l){i.call(this,l,vi)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,p){if(i.prototype.recalculate.call(this,l,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var S=this.layout.get("text-writing-mode");if(S){for(var A=[],I=0,U=S;I<U.length;I+=1){var q=U[I];A.indexOf(q)<0&&A.push(q)}this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,p,S,A){var I=this.layout.get(l).evaluate(p,{},S,A),U=this._unevaluatedLayout._values[l];return U.isDataDriven()||Hc(U.value)||!I?I:function(q,re){return re.replace(/{([^{}]+)}/g,function(de,we){return we in q?String(q[we]):""})}(p.properties,I)},s.prototype.createBucket=function(l){return new dn(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,p=vi.paint.overridableProperties;l<p.length;l+=1){var S=p[l];if(s.hasPaintOverride(this.layout,S)){var A,I=this.paint.get(S),U=new Ea(I),q=new mp(U,I.property.specification);A=I.value.kind==="constant"||I.value.kind==="source"?new sf("source",q):new ah("composite",q,I.value.zoomStops,I.value._interpolationType),this.paint._values[S]=new Ec(I.property,A,I.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,p,S){return!(!this.layout||p.isDataDriven()||S.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,p){var S=l.get("text-field"),A=vi.paint.properties[p],I=!1,U=function(de){for(var we=0,Oe=de;we<Oe.length;we+=1)if(A.overrides&&A.overrides.hasOverride(Oe[we]))return void(I=!0)};if(S.value.kind==="constant"&&S.value.value instanceof ws)U(S.value.value.sections);else if(S.value.kind==="source"){var q=function(de){I||(de instanceof du&&Io(de.value)===Ao?U(de.value.sections):de instanceof Ws?U(de.sections):de.eachChild(q))},re=S.value;re._styleExpression&&q(re._styleExpression.expression)}return I},s}(df),ma={paint:new jl({"background-color":new aa(Fe.paint_background["background-color"]),"background-pattern":new ba(Fe.paint_background["background-pattern"]),"background-opacity":new aa(Fe.paint_background["background-opacity"])})},uo=function(i){function s(l){i.call(this,l,ma)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(df),Do={paint:new jl({"raster-opacity":new aa(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new aa(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new aa(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new aa(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new aa(Fe.paint_raster["raster-saturation"]),"raster-contrast":new aa(Fe.paint_raster["raster-contrast"]),"raster-resampling":new aa(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new aa(Fe.paint_raster["raster-fade-duration"])})},Ys=function(i){function s(l){i.call(this,l,Do)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(df),Wl=function(i){function s(l){i.call(this,l,{}),this.implementation=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(df),bf={circle:cd,heatmap:Tv,hillshade:Dd,fill:Gv,"fill-extrusion":Fh,line:_g,symbol:ts,background:uo,raster:Ys},Iv=le.HTMLImageElement,Bh=le.HTMLCanvasElement,Rp=le.HTMLVideoElement,ph=le.ImageData,tv=le.ImageBitmap,Td=function(i,s,l,p){this.context=i,this.format=l,this.texture=i.gl.createTexture(),this.update(s,p)};Td.prototype.update=function(i,s,l){var p=i.width,S=i.height,A=!(this.size&&this.size[0]===p&&this.size[1]===S||l),I=this.context,U=I.gl;if(this.useMipmap=!!(s&&s.useMipmap),U.bindTexture(U.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===U.RGBA&&(!s||s.premultiply!==!1)),A)this.size=[p,S],i instanceof Iv||i instanceof Bh||i instanceof Rp||i instanceof ph||tv&&i instanceof tv?U.texImage2D(U.TEXTURE_2D,0,this.format,this.format,U.UNSIGNED_BYTE,i):U.texImage2D(U.TEXTURE_2D,0,this.format,p,S,0,this.format,U.UNSIGNED_BYTE,i.data);else{var q=l||{x:0,y:0},re=q.x,de=q.y;i instanceof Iv||i instanceof Bh||i instanceof Rp||i instanceof ph||tv&&i instanceof tv?U.texSubImage2D(U.TEXTURE_2D,0,re,de,U.RGBA,U.UNSIGNED_BYTE,i):U.texSubImage2D(U.TEXTURE_2D,0,re,de,p,S,U.RGBA,U.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&U.generateMipmap(U.TEXTURE_2D)},Td.prototype.bind=function(i,s,l){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||i),this.filter=i),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)},Td.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Td.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var _v=function(i){var s=this;this._callback=i,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};_v.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},_v.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Lv=function(i,s,l){this.target=i,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},gn(["receive","process"],this),this.invoker=new _v(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ot()?i:le};function gm(i,s,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[i*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}Lv.prototype.send=function(i,s,l,p,S){var A=this;S===void 0&&(S=!1);var I=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[I]=l);var U=Bt(this.globalScope)?void 0:[];return this.target.postMessage({id:I,type:i,hasCallback:!!l,targetMapId:p,mustQueue:S,sourceMapId:this.mapId,data:ji(s,U)},U),{cancel:function(){l&&delete A.callbacks[I],A.target.postMessage({id:I,type:"<cancel>",targetMapId:p,sourceMapId:A.mapId})}}},Lv.prototype.receive=function(i){var s=i.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var p=this.cancelCallbacks[l];delete this.cancelCallbacks[l],p&&p()}else ot()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},Lv.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),s=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(i,s)}},Lv.prototype.processTask=function(i,s){var l=this;if(s.type==="<response>"){var p=this.callbacks[i];delete this.callbacks[i],p&&(s.error?p(Ic(s.error)):p(null,Ic(s.data)))}else{var S=!1,A=Bt(this.globalScope)?void 0:[],I=s.hasCallback?function(de,we){S=!0,delete l.cancelCallbacks[i],l.target.postMessage({id:i,type:"<response>",sourceMapId:l.mapId,error:de?ji(de):null,data:ji(we,A)},A)}:function(de){S=!0},U=null,q=Ic(s.data);if(this.parent[s.type])U=this.parent[s.type](s.sourceMapId,q,I);else if(this.parent.getWorkerSource){var re=s.type.split(".");U=this.parent.getWorkerSource(s.sourceMapId,re[0],q.source)[re[1]](q,I)}else I(new Error("Could not find function "+s.type));!S&&U&&U.cancel&&(this.cancelCallbacks[i]=U.cancel)}},Lv.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var rc=function(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};rc.prototype.setNorthEast=function(i){return this._ne=i instanceof wl?new wl(i.lng,i.lat):wl.convert(i),this},rc.prototype.setSouthWest=function(i){return this._sw=i instanceof wl?new wl(i.lng,i.lat):wl.convert(i),this},rc.prototype.extend=function(i){var s,l,p=this._sw,S=this._ne;if(i instanceof wl)s=i,l=i;else{if(!(i instanceof rc))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(rc.convert(i)):this.extend(wl.convert(i)):this;if(l=i._ne,!(s=i._sw)||!l)return this}return p||S?(p.lng=Math.min(s.lng,p.lng),p.lat=Math.min(s.lat,p.lat),S.lng=Math.max(l.lng,S.lng),S.lat=Math.max(l.lat,S.lat)):(this._sw=new wl(s.lng,s.lat),this._ne=new wl(l.lng,l.lat)),this},rc.prototype.getCenter=function(){return new wl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},rc.prototype.getSouthWest=function(){return this._sw},rc.prototype.getNorthEast=function(){return this._ne},rc.prototype.getNorthWest=function(){return new wl(this.getWest(),this.getNorth())},rc.prototype.getSouthEast=function(){return new wl(this.getEast(),this.getSouth())},rc.prototype.getWest=function(){return this._sw.lng},rc.prototype.getSouth=function(){return this._sw.lat},rc.prototype.getEast=function(){return this._ne.lng},rc.prototype.getNorth=function(){return this._ne.lat},rc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},rc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},rc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},rc.prototype.contains=function(i){var s=wl.convert(i),l=s.lng,p=s.lat,S=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(S=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&S},rc.convert=function(i){return!i||i instanceof rc?i:new rc(i)};var wl=function(i,s){if(isNaN(i)||isNaN(s))throw new Error("Invalid LngLat object: ("+i+", "+s+")");if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};wl.prototype.wrap=function(){return new wl(Ct(this.lng,-180,180),this.lat)},wl.prototype.toArray=function(){return[this.lng,this.lat]},wl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},wl.prototype.distanceTo=function(i){var s=Math.PI/180,l=this.lat*s,p=i.lat*s,S=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((i.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(S,1))},wl.prototype.toBounds=function(i){i===void 0&&(i=0);var s=360*i/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new rc(new wl(this.lng-l,this.lat-s),new wl(this.lng+l,this.lat+s))},wl.convert=function(i){if(i instanceof wl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new wl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new wl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nm=2*Math.PI*63710088e-1;function Yv(i){return Nm*Math.cos(i*Math.PI/180)}function rv(i){return(180+i)/360}function ym(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Zm(i,s){return i/Yv(s)}function Rv(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}var Zd=function(i,s,l){l===void 0&&(l=0),this.x=+i,this.y=+s,this.z=+l};Zd.fromLngLat=function(i,s){s===void 0&&(s=0);var l=wl.convert(i);return new Zd(rv(l.lng),ym(l.lat),Zm(s,l.lat))},Zd.prototype.toLngLat=function(){return new wl(360*this.x-180,Rv(this.y))},Zd.prototype.toAltitude=function(){return this.z*Yv(Rv(this.y))},Zd.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nm*(i=Rv(this.y),1/Math.cos(i*Math.PI/180));var i};var pd=function(i,s,l){this.z=i,this.x=s,this.y=l,this.key=Ii(0,i,i,s,l)};pd.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},pd.prototype.url=function(i,s){var l,p,S,A,I,U=(p=this.y,S=this.z,A=gm(256*(l=this.x),256*(p=Math.pow(2,S)-p-1),S),I=gm(256*(l+1),256*(p+1),S),A[0]+","+A[1]+","+I[0]+","+I[1]),q=function(re,de,we){for(var Oe,Ge="",it=re;it>0;it--)Ge+=(de&(Oe=1<<it-1)?1:0)+(we&Oe?2:0);return Ge}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",q).replace("{bbox-epsg-3857}",U)},pd.prototype.getTilePoint=function(i){var s=Math.pow(2,this.z);return new pe(8192*(i.x*s-this.x),8192*(i.y*s-this.y))},pd.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var _m=function(i,s){this.wrap=i,this.canonical=s,this.key=Ii(i,s.z,s.z,s.x,s.y)},Jc=function(i,s,l,p,S){this.overscaledZ=i,this.wrap=s,this.canonical=new pd(l,+p,+S),this.key=Ii(s,i,l,p,S)};function Ii(i,s,l,p,S){(i*=2)<0&&(i=-1*i-1);var A=1<<l;return(A*A*i+A*S+p).toString(36)+l.toString(36)+s.toString(36)}Jc.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},Jc.prototype.scaledTo=function(i){var s=this.canonical.z-i;return i>this.canonical.z?new Jc(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jc(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)},Jc.prototype.calculateScaledKey=function(i,s){var l=this.canonical.z-i;return i>this.canonical.z?Ii(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y):Ii(this.wrap*+s,i,i,this.canonical.x>>l,this.canonical.y>>l)},Jc.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s},Jc.prototype.children=function(i){if(this.overscaledZ>=i)return[new Jc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Jc(s,this.wrap,s,l,p),new Jc(s,this.wrap,s,l+1,p),new Jc(s,this.wrap,s,l,p+1),new Jc(s,this.wrap,s,l+1,p+1)]},Jc.prototype.isLessThan=function(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))},Jc.prototype.wrapped=function(){return new Jc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Jc.prototype.unwrapTo=function(i){return new Jc(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},Jc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Jc.prototype.toUnwrapped=function(){return new _m(this.wrap,this.canonical)},Jc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Jc.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new Zd(i.x-this.wrap,i.y))},Ui("CanonicalTileID",pd),Ui("OverscaledTileID",Jc,{omit:["posMatrix"]});var Ud=function(i,s,l){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return or('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var p=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var S=0;S<p;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(p,S)]=this.data[this._idx(p-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,p)]=this.data[this._idx(S,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Ud.prototype.get=function(i,s){var l=new Uint8Array(this.data.buffer),p=4*this._idx(i,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[p],l[p+1],l[p+2])},Ud.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ud.prototype._idx=function(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)},Ud.prototype._unpackMapbox=function(i,s,l){return(256*i*256+256*s+l)/10-1e4},Ud.prototype._unpackTerrarium=function(i,s,l){return 256*i+s+l/256-32768},Ud.prototype.getPixels=function(){return new Fl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ud.prototype.backfillBorder=function(i,s,l){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var p=s*this.dim,S=s*this.dim+this.dim,A=l*this.dim,I=l*this.dim+this.dim;switch(s){case-1:p=S-1;break;case 1:S=p+1}switch(l){case-1:A=I-1;break;case 1:I=A+1}for(var U=-s*this.dim,q=-l*this.dim,re=A;re<I;re++)for(var de=p;de<S;de++)this.data[this._idx(de,re)]=i.data[this._idx(de+U,re+q)]},Ui("DEMData",Ud);var cn=function(i){this._stringToNumber={},this._numberToString=[];for(var s=0;s<i.length;s++){var l=i[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};cn.prototype.encode=function(i){return this._stringToNumber[i]},cn.prototype.decode=function(i){return this._numberToString[i]};var nv=function(i,s,l,p,S){this.type="Feature",this._vectorTileFeature=i,i._z=s,i._x=l,i._y=p,this.properties=i.properties,this.id=S},tg={geometry:{configurable:!0}};tg.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},tg.geometry.set=function(i){this._geometry=i},nv.prototype.toJSON=function(){var i={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(i[s]=this[s]);return i},Object.defineProperties(nv.prototype,tg);var bv=function(){this.state={},this.stateChanges={},this.deletedStates={}};bv.prototype.updateState=function(i,s,l){var p=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},jt(this.stateChanges[i][p],l),this.deletedStates[i]===null)for(var S in this.deletedStates[i]={},this.state[i])S!==p&&(this.deletedStates[i][S]=null);else if(this.deletedStates[i]&&this.deletedStates[i][p]===null)for(var A in this.deletedStates[i][p]={},this.state[i][p])l[A]||(this.deletedStates[i][p][A]=null);else for(var I in l)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][I]===null&&delete this.deletedStates[i][p][I]},bv.prototype.removeFeatureState=function(i,s,l){if(this.deletedStates[i]!==null){var p=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},l&&s!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][l]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(l in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][l]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}},bv.prototype.getState=function(i,s){var l=String(s),p=jt({},(this.state[i]||{})[l],(this.stateChanges[i]||{})[l]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var S=this.deletedStates[i][s];if(S===null)return{};for(var A in S)delete p[A]}return p},bv.prototype.initializeTileState=function(i,s){i.setFeatureState(this.state,s)},bv.prototype.coalesceChanges=function(i,s){var l={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var S={};for(var A in this.stateChanges[p])this.state[p][A]||(this.state[p][A]={}),jt(this.state[p][A],this.stateChanges[p][A]),S[A]=this.state[p][A];l[p]=S}for(var I in this.deletedStates){this.state[I]=this.state[I]||{};var U={};if(this.deletedStates[I]===null)for(var q in this.state[I])U[q]={},this.state[I][q]={};else for(var re in this.deletedStates[I]){if(this.deletedStates[I][re]===null)this.state[I][re]={};else for(var de=0,we=Object.keys(this.deletedStates[I][re]);de<we.length;de+=1)delete this.state[I][re][we[de]];U[re]=this.state[I][re]}l[I]=l[I]||{},jt(l[I],U)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var Oe in i)i[Oe].setFeatureState(l,s)};var dd=function(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Lh(8192,16,0),this.grid3D=new Lh(8192,16,0),this.featureIndexArray=new ye,this.promoteId=s};function jd(i,s,l,p,S){return vn(i,function(A,I){var U=s instanceof Al?s.get(I):null;return U&&U.evaluate?U.evaluate(l,p,S):U})}function rg(i){for(var s=1/0,l=1/0,p=-1/0,S=-1/0,A=0,I=i;A<I.length;A+=1){var U=I[A];s=Math.min(s,U.x),l=Math.min(l,U.y),p=Math.max(p,U.x),S=Math.max(S,U.y)}return{minX:s,minY:l,maxX:p,maxY:S}}function Um(i,s){return s-i}dd.prototype.insert=function(i,s,l,p,S,A){var I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,S);for(var U=A?this.grid3D:this.grid,q=0;q<s.length;q++){for(var re=s[q],de=[1/0,1/0,-1/0,-1/0],we=0;we<re.length;we++){var Oe=re[we];de[0]=Math.min(de[0],Oe.x),de[1]=Math.min(de[1],Oe.y),de[2]=Math.max(de[2],Oe.x),de[3]=Math.max(de[3],Oe.y)}de[0]<8192&&de[1]<8192&&de[2]>=0&&de[3]>=0&&U.insert(I,de[0],de[1],de[2],de[3])}},dd.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Jd.VectorTile(new At(this.rawTileData)).layers,this.sourceLayerCoder=new cn(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},dd.prototype.query=function(i,s,l,p){var S=this;this.loadVTLayers();for(var A=i.params||{},I=8192/i.tileSize/i.scale,U=uf(A.filter),q=i.queryGeometry,re=i.queryPadding*I,de=rg(q),we=this.grid.query(de.minX-re,de.minY-re,de.maxX+re,de.maxY+re),Oe=rg(i.cameraQueryGeometry),Ge=this.grid3D.query(Oe.minX-re,Oe.minY-re,Oe.maxX+re,Oe.maxY+re,function(Xt,pr,Ur,tn){return function(An,xi,On,si,kn){for(var ci=0,wi=An;ci<wi.length;ci+=1){var $n=wi[ci];if(xi<=$n.x&&On<=$n.y&&si>=$n.x&&kn>=$n.y)return!0}var Si=[new pe(xi,On),new pe(xi,kn),new pe(si,kn),new pe(si,On)];if(An.length>2){for(var Kn=0,la=Si;Kn<la.length;Kn+=1)if(Gl(An,la[Kn]))return!0}for(var yn=0;yn<An.length-1;yn++)if(vf(An[yn],An[yn+1],Si))return!0;return!1}(i.cameraQueryGeometry,Xt-re,pr-re,Ur+re,tn+re)}),it=0,tt=Ge;it<tt.length;it+=1)we.push(tt[it]);we.sort(Um);for(var ct,ut={},Je=function(Xt){var pr=we[Xt];if(pr!==ct){ct=pr;var Ur=S.featureIndexArray.get(pr),tn=null;S.loadMatchingFeature(ut,Ur.bucketIndex,Ur.sourceLayerIndex,Ur.featureIndex,U,A.layers,A.availableImages,s,l,p,function(An,xi,On){return tn||(tn=Qo(An)),xi.queryIntersectsFeature(q,An,On,tn,S.z,i.transform,I,i.pixelPosMatrix)})}},Pt=0;Pt<we.length;Pt++)Je(Pt);return ut},dd.prototype.loadMatchingFeature=function(i,s,l,p,S,A,I,U,q,re,de){var we=this.bucketLayerIDs[s];if(!A||function(An,xi){for(var On=0;On<An.length;On++)if(xi.indexOf(An[On])>=0)return!0;return!1}(A,we)){var Oe=this.sourceLayerCoder.decode(l),Ge=this.vtLayers[Oe].feature(p);if(S.needGeometry){var it=Zs(Ge,!0);if(!S.filter(new xo(this.tileID.overscaledZ),it,this.tileID.canonical))return}else if(!S.filter(new xo(this.tileID.overscaledZ),Ge))return;for(var tt=this.getId(Ge,Oe),ct=0;ct<we.length;ct++){var ut=we[ct];if(!(A&&A.indexOf(ut)<0)){var Je=U[ut];if(Je){var Pt={};tt!==void 0&&re&&(Pt=re.getState(Je.sourceLayer||"_geojsonTileLayer",tt));var Xt=jt({},q[ut]);Xt.paint=jd(Xt.paint,Je.paint,Ge,Pt,I),Xt.layout=jd(Xt.layout,Je.layout,Ge,Pt,I);var pr=!de||de(Ge,Je,Pt);if(pr){var Ur=new nv(Ge,this.z,this.x,this.y,tt);Ur.layer=Xt;var tn=i[ut];tn===void 0&&(tn=i[ut]=[]),tn.push({featureIndex:p,feature:Ur,intersectionZ:pr})}}}}}},dd.prototype.lookupSymbolFeatures=function(i,s,l,p,S,A,I,U){var q={};this.loadVTLayers();for(var re=uf(S),de=0,we=i;de<we.length;de+=1)this.loadMatchingFeature(q,l,p,we[de],re,A,I,U,s);return q},dd.prototype.hasLayer=function(i){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var p=0,S=l[s];p<S.length;p+=1)if(i===S[p])return!0;return!1},dd.prototype.getId=function(i,s){var l=i.id;return this.promoteId&&typeof(l=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},Ui("FeatureIndex",dd,{omit:["rawTileData","sourceLayerCoder"]});var yc=function(i,s){this.tileID=i,this.uid=Rt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};yc.prototype.registerFadeDuration=function(i){var s=i+this.timeAdded;s<Ka.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},yc.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},yc.prototype.loadVectorData=function(i,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(var p in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(re,de){var we={};if(!de)return we;for(var Oe=function(){var tt=it[Ge],ct=tt.layerIds.map(function(Pt){return de.getLayer(Pt)}).filter(Boolean);if(ct.length!==0){tt.layers=ct,tt.stateDependentLayerIds&&(tt.stateDependentLayers=tt.stateDependentLayerIds.map(function(Pt){return ct.filter(function(Xt){return Xt.id===Pt})[0]}));for(var ut=0,Je=ct;ut<Je.length;ut+=1)we[Je[ut].id]=tt}},Ge=0,it=re;Ge<it.length;Ge+=1)Oe();return we}(i.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var S=this.buckets[p];if(S instanceof dn){if(this.hasSymbolBuckets=!0,!l)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var A in this.buckets){var I=this.buckets[A];if(I instanceof dn&&I.hasRTLText){this.hasRTLText=!0,_l.isLoading()||_l.isLoaded()||pf()!=="deferred"||Lc();break}}for(var U in this.queryPadding=0,this.buckets){var q=this.buckets[U];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(U).queryRadius(q))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new w},yc.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},yc.prototype.getBucket=function(i){return this.buckets[i.id]},yc.prototype.upload=function(i){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(i)}var p=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Td(i,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Td(i,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},yc.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},yc.prototype.queryRenderedFeatures=function(i,s,l,p,S,A,I,U,q,re){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:S,scale:A,tileSize:this.tileSize,pixelPosMatrix:re,transform:U,params:I,queryPadding:this.queryPadding*q},i,s,l):{}},yc.prototype.querySourceFeatures=function(i,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var p=l.loadVTLayers(),S=s?s.sourceLayer:"",A=p._geojsonTileLayer||p[S];if(A)for(var I=uf(s&&s.filter),U=this.tileID.canonical,q=U.z,re=U.x,de=U.y,we={z:q,x:re,y:de},Oe=0;Oe<A.length;Oe++){var Ge=A.feature(Oe);if(I.needGeometry){var it=Zs(Ge,!0);if(!I.filter(new xo(this.tileID.overscaledZ),it,this.tileID.canonical))continue}else if(!I.filter(new xo(this.tileID.overscaledZ),Ge))continue;var tt=l.getId(Ge,S),ct=new nv(Ge,q,re,de,tt);ct.tile=we,i.push(ct)}}},yc.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},yc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},yc.prototype.setExpiryData=function(i){var s=this.expirationTime;if(i.cacheControl){var l=Dt(i.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var p=Date.now(),S=!1;if(this.expirationTime>p)S=!1;else if(s)if(this.expirationTime<s)S=!0;else{var A=this.expirationTime-s;A?this.expirationTime=p+Math.max(A,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},yc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},yc.prototype.setFeatureState=function(i,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(s.style.hasLayer(p)){var S=this.buckets[p],A=S.layers[0].sourceLayer||"_geojsonTileLayer",I=l[A],U=i[A];if(I&&U&&Object.keys(U).length!==0){S.update(U,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});var q=s&&s.style&&s.style.getLayer(p);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(S)))}}}},yc.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},yc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ka.now()},yc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},yc.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=Ka.now()+i},yc.prototype.setDependencies=function(i,s){for(var l={},p=0,S=s;p<S.length;p+=1)l[S[p]]=!0;this.dependencies[i]=l},yc.prototype.hasDependency=function(i,s){for(var l=0,p=i;l<p.length;l+=1){var S=this.dependencies[p[l]];if(S){for(var A=0,I=s;A<I.length;A+=1)if(S[I[A]])return!0}}return!1};var iv=le.performance,L=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},iv.mark(this._marks.start)};L.prototype.finish=function(){iv.mark(this._marks.end);var i=iv.getEntriesByName(this._marks.measure);return i.length===0&&(iv.measure(this._marks.measure,this._marks.start,this._marks.end),i=iv.getEntriesByName(this._marks.measure),iv.clearMarks(this._marks.start),iv.clearMarks(this._marks.end),iv.clearMeasures(this._marks.measure)),i},P.Actor=Lv,P.AlphaImage=Ip,P.CanonicalTileID=pd,P.CollisionBoxArray=w,P.Color=to,P.DEMData=Ud,P.DataConstantProperty=aa,P.DictionaryCoder=cn,P.EXTENT=8192,P.ErrorEvent=Qe,P.EvaluationParameters=xo,P.Event=Xe,P.Evented=Ye,P.FeatureIndex=dd,P.FillBucket=Oc,P.FillExtrusionBucket=zf,P.ImageAtlas=Oa,P.ImagePosition=qn,P.LineBucket=al,P.LngLat=wl,P.LngLatBounds=rc,P.MercatorCoordinate=Zd,P.ONE_EM=24,P.OverscaledTileID=Jc,P.Point=pe,P.Point$1=pe,P.Properties=jl,P.Protobuf=At,P.RGBAImage=Fl,P.RequestManager=is,P.RequestPerformance=L,P.ResourceType=Xn,P.SegmentVector=He,P.SourceFeatureState=bv,P.StructArrayLayout1ui2=ge,P.StructArrayLayout2f1f2i16=mr,P.StructArrayLayout2i4=Zu,P.StructArrayLayout3ui6=h,P.StructArrayLayout4i8=il,P.SymbolBucket=dn,P.Texture=Td,P.Tile=yc,P.Transitionable=dl,P.Uniform1f=Ln,P.Uniform1i=nn,P.Uniform2f=Mn,P.Uniform3f=yi,P.Uniform4f=Ri,P.UniformColor=Qi,P.UniformMatrix4f=ao,P.UnwrappedTileID=_m,P.ValidationError=Me,P.WritingMode=Ya,P.ZoomHistory=hf,P.add=function(i,s,l){return i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},P.addDynamicAttributes=It,P.asyncAll=function(i,s,l){if(!i.length)return l(null,[]);var p=i.length,S=new Array(i.length),A=null;i.forEach(function(I,U){s(I,function(q,re){q&&(A=q),S[U]=re,--p==0&&l(A,S)})})},P.bezier=rt,P.bindAll=gn,P.browser=Ka,P.cacheEntryPossiblyAdded=function(i){++ea>dr&&(i.getActor().send("enforceCacheSizeLimit",Hr),ea=0)},P.clamp=nt,P.clearTileCache=function(i){var s=le.caches.delete("mapbox-tiles");i&&s.catch(i).then(function(){return i()})},P.clipLine=Fa,P.clone=function(i){var s=new Es(16);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},P.clone$1=Jt,P.clone$2=function(i){var s=new Es(3);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s},P.collisionCircleLayout=ev,P.config=na,P.create=function(){var i=new Es(16);return Es!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},P.create$1=function(){var i=new Es(9);return Es!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},P.create$2=function(){var i=new Es(4);return Es!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},P.createCommonjsModule=M,P.createExpression=gp,P.createLayout=vl,P.createStyleLayer=function(i){return i.type==="custom"?new Wl(i):new bf[i.type](i)},P.cross=function(i,s,l){var p=s[0],S=s[1],A=s[2],I=l[0],U=l[1],q=l[2];return i[0]=S*q-A*U,i[1]=A*I-p*q,i[2]=p*U-S*I,i},P.deepEqual=function i(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var p=0;p<s.length;p++)if(!i(s[p],l[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var S in s)if(!i(s[S],l[S]))return!1;return!0}return s===l},P.dot=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]},P.dot$1=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]},P.ease=xt,P.emitValidationErrors=Af,P.endsWith=Rr,P.enforceCacheSizeLimit=function(i){Un(),lt&&lt.then(function(s){s.keys().then(function(l){for(var p=0;p<l.length-i;p++)s.delete(l[p])})})},P.evaluateSizeForFeature=Lo,P.evaluateSizeForZoom=Pl,P.evaluateVariableOffset=gr,P.evented=Mf,P.extend=jt,P.featureFilter=uf,P.filterObject=rr,P.fromRotation=function(i,s){var l=Math.sin(s),p=Math.cos(s);return i[0]=p,i[1]=l,i[2]=0,i[3]=-l,i[4]=p,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},P.getAnchorAlignment=xl,P.getAnchorJustification=Vr,P.getArrayBuffer=Wt,P.getImage=ve,P.getJSON=function(i,s){return Xu(jt(i,{type:"json"}),s)},P.getRTLTextPluginStatus=pf,P.getReferrer=Pa,P.getVideo=function(i,s){var l,p,S=le.document.createElement("video");S.muted=!0,S.onloadstart=function(){s(null,S)};for(var A=0;A<i.length;A++){var I=le.document.createElement("source");l=i[A],p=void 0,(p=le.document.createElement("a")).href=l,(p.protocol!==le.document.location.protocol||p.host!==le.document.location.host)&&(S.crossOrigin="Anonymous"),I.src=i[A],S.appendChild(I)}return{cancel:function(){}}},P.identity=Ol,P.invert=function(i,s){var l=s[0],p=s[1],S=s[2],A=s[3],I=s[4],U=s[5],q=s[6],re=s[7],de=s[8],we=s[9],Oe=s[10],Ge=s[11],it=s[12],tt=s[13],ct=s[14],ut=s[15],Je=l*U-p*I,Pt=l*q-S*I,Xt=l*re-A*I,pr=p*q-S*U,Ur=p*re-A*U,tn=S*re-A*q,An=de*tt-we*it,xi=de*ct-Oe*it,On=de*ut-Ge*it,si=we*ct-Oe*tt,kn=we*ut-Ge*tt,ci=Oe*ut-Ge*ct,wi=Je*ci-Pt*kn+Xt*si+pr*On-Ur*xi+tn*An;return wi?(i[0]=(U*ci-q*kn+re*si)*(wi=1/wi),i[1]=(S*kn-p*ci-A*si)*wi,i[2]=(tt*tn-ct*Ur+ut*pr)*wi,i[3]=(Oe*Ur-we*tn-Ge*pr)*wi,i[4]=(q*On-I*ci-re*xi)*wi,i[5]=(l*ci-S*On+A*xi)*wi,i[6]=(ct*Xt-it*tn-ut*Pt)*wi,i[7]=(de*tn-Oe*Xt+Ge*Pt)*wi,i[8]=(I*kn-U*On+re*An)*wi,i[9]=(p*On-l*kn-A*An)*wi,i[10]=(it*Ur-tt*Xt+ut*Je)*wi,i[11]=(we*Xt-de*Ur-Ge*Je)*wi,i[12]=(U*xi-I*si-q*An)*wi,i[13]=(l*si-p*xi+S*An)*wi,i[14]=(tt*Pt-it*pr-ct*Je)*wi,i[15]=(de*pr-we*Pt+Oe*Je)*wi,i):null},P.isChar=Gn,P.isMapboxURL=Ko,P.keysDifference=function(i,s){var l=[];for(var p in i)p in s||l.push(p);return l},P.makeRequest=Xu,P.mapObject=vn,P.mercatorXfromLng=rv,P.mercatorYfromLat=ym,P.mercatorZfromAltitude=Zm,P.mul=ku,P.multiply=ml,P.mvt=Jd,P.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},P.normalize=function(i,s){var l=s[0],p=s[1],S=s[2],A=l*l+p*p+S*S;return A>0&&(A=1/Math.sqrt(A)),i[0]=s[0]*A,i[1]=s[1]*A,i[2]=s[2]*A,i},P.number=Ja,P.offscreenCanvasSupported=on,P.ortho=function(i,s,l,p,S,A,I){var U=1/(s-l),q=1/(p-S),re=1/(A-I);return i[0]=-2*U,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*q,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*re,i[11]=0,i[12]=(s+l)*U,i[13]=(S+p)*q,i[14]=(I+A)*re,i[15]=1,i},P.parseGlyphPBF=function(i){return new At(i).readFields(Yn,[])},P.pbf=At,P.performSymbolLayout=function(i,s,l,p,S,A,I){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;var U=i.layers[0].layout,q=i.layers[0]._unevaluatedLayout._values,re={};if(i.textSizeData.kind==="composite"){var de=i.textSizeData,we=de.maxZoom;re.compositeTextSizes=[q["text-size"].possiblyEvaluate(new xo(de.minZoom),I),q["text-size"].possiblyEvaluate(new xo(we),I)]}if(i.iconSizeData.kind==="composite"){var Oe=i.iconSizeData,Ge=Oe.maxZoom;re.compositeIconSizes=[q["icon-size"].possiblyEvaluate(new xo(Oe.minZoom),I),q["icon-size"].possiblyEvaluate(new xo(Ge),I)]}re.layoutTextSize=q["text-size"].possiblyEvaluate(new xo(i.zoom+1),I),re.layoutIconSize=q["icon-size"].possiblyEvaluate(new xo(i.zoom+1),I),re.textMaxSize=q["text-size"].possiblyEvaluate(new xo(18));for(var it=24*U.get("text-line-height"),tt=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",ct=U.get("text-keep-upright"),ut=U.get("text-size"),Je=function(){var pr=Xt[Pt],Ur=U.get("text-font").evaluate(pr,{},I).join(","),tn=ut.evaluate(pr,{},I),An=re.layoutTextSize.evaluate(pr,{},I),xi=re.layoutIconSize.evaluate(pr,{},I),On={horizontal:{},vertical:void 0},si=pr.text,kn=[0,0];if(si){var ci=si.toString(),wi=24*U.get("text-letter-spacing").evaluate(pr,{},I),$n=function(Ba){for(var bs=0,ms=Ba;bs<ms.length;bs+=1)if(Eo=ms[bs].charCodeAt(0),Gn.Arabic(Eo)||Gn["Arabic Supplement"](Eo)||Gn["Arabic Extended-A"](Eo)||Gn["Arabic Presentation Forms-A"](Eo)||Gn["Arabic Presentation Forms-B"](Eo))return!1;var Eo;return!0}(ci)?wi:0,Si=U.get("text-anchor").evaluate(pr,{},I),Kn=U.get("text-variable-anchor");if(!Kn){var la=U.get("text-radial-offset").evaluate(pr,{},I);kn=la?gr(Si,[24*la,Et]):U.get("text-offset").evaluate(pr,{},I).map(function(Ba){return 24*Ba})}var yn=tt?"center":U.get("text-justify").evaluate(pr,{},I),Ti=U.get("symbol-placement"),Aa=Ti==="point"?24*U.get("text-max-width").evaluate(pr,{},I):0,$o=function(){i.allowVerticalPlacement&&ld(ci)&&(On.vertical=Hn(si,s,l,S,Ur,Aa,it,Si,"left",$n,kn,Ya.vertical,!0,Ti,An,tn))};if(!tt&&Kn){for(var lo=yn==="auto"?Kn.map(function(Ba){return Vr(Ba)}):[yn],Oo=!1,So=0;So<lo.length;So++){var cs=lo[So];if(!On.horizontal[cs])if(Oo)On.horizontal[cs]=On.horizontal[0];else{var Wo=Hn(si,s,l,S,Ur,Aa,it,"center",cs,$n,kn,Ya.horizontal,!1,Ti,An,tn);Wo&&(On.horizontal[cs]=Wo,Oo=Wo.positionedLines.length===1)}}$o()}else{yn==="auto"&&(yn=Vr(Si));var Bo=Hn(si,s,l,S,Ur,Aa,it,Si,yn,$n,kn,Ya.horizontal,!1,Ti,An,tn);Bo&&(On.horizontal[yn]=Bo),$o(),ld(ci)&&tt&&ct&&(On.vertical=Hn(si,s,l,S,Ur,Aa,it,Si,yn,$n,kn,Ya.vertical,!1,Ti,An,tn))}}var Xo=void 0,Au=!1;if(pr.icon&&pr.icon.name){var Wi=p[pr.icon.name];Wi&&(Xo=function(Ba,bs,ms){var Eo=xl(ms),gu=bs[0]-Ba.displaySize[0]*Eo.horizontalAlign,fs=bs[1]-Ba.displaySize[1]*Eo.verticalAlign;return{image:Ba,top:fs,bottom:fs+Ba.displaySize[1],left:gu,right:gu+Ba.displaySize[0]}}(S[pr.icon.name],U.get("icon-offset").evaluate(pr,{},I),U.get("icon-anchor").evaluate(pr,{},I)),Au=Wi.sdf,i.sdfIcons===void 0?i.sdfIcons=Wi.sdf:i.sdfIcons!==Wi.sdf&&or("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wi.pixelRatio!==i.pixelRatio||U.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}var hs=wr(On.horizontal)||On.vertical;i.iconsInText=!!hs&&hs.iconsInText,(hs||Xo)&&function(Ba,bs,ms,Eo,gu,fs,Cn,Ma,go,Na,v){var c=fs.textMaxSize.evaluate(bs,{});c===void 0&&(c=Cn);var b,k=Ba.layers[0].layout,z=k.get("icon-offset").evaluate(bs,{},v),V=wr(ms.horizontal),W=Cn/24,ne=Ba.tilePixelRatio*W,he=Ba.tilePixelRatio*c/24,Se=Ba.tilePixelRatio*Ma,Ne=Ba.tilePixelRatio*k.get("symbol-spacing"),We=k.get("text-padding")*Ba.tilePixelRatio,ht=k.get("icon-padding")*Ba.tilePixelRatio,gt=k.get("text-max-angle")/180*Math.PI,St=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ht=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",ir=k.get("symbol-placement"),fr=Ne/2,Gr=k.get("icon-text-fit");Eo&&Gr!=="none"&&(Ba.allowVerticalPlacement&&ms.vertical&&(b=Ho(Eo,ms.vertical,Gr,k.get("icon-text-fit-padding"),z,W)),V&&(Eo=Ho(Eo,V,Gr,k.get("icon-text-fit-padding"),z,W)));var Tr=function(vh,nc){nc.x<0||nc.x>=8192||nc.y<0||nc.y>=8192||function(Us,zs,Fp,Zh,Bf,zp,np,ic,yu,xf,yo,ro,Bp,av,Np,qv,ov,Md,vd,Kv,Ep,xg,y0,xv,Cp){var W0,bm,wg,Sg,Eg,Cg=Us.addToLineVertexArray(zs,Fp),Xy=0,X0=0,Yy=0,qy=0,sv=-1,Ag=-1,wv={},Ky=dt(""),Jv=0,Y0=0;if(ic._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Jv=(W0=ic.layout.get("text-offset").evaluate(Ep,{},xv).map(function(qg){return 24*qg}))[0],Y0=W0[1]):(Jv=24*ic.layout.get("text-radial-offset").evaluate(Ep,{},xv),Y0=Et),Us.allowVerticalPlacement&&Zh.vertical){var Zp=ic.layout.get("text-rotate").evaluate(Ep,{},xv)+90;Sg=new qt(yu,zs,xf,yo,ro,Zh.vertical,Bp,av,Np,Zp),np&&(Eg=new qt(yu,zs,xf,yo,ro,np,ov,Md,Np,Zp))}if(Bf){var md=ic.layout.get("icon-rotate").evaluate(Ep,{}),Qv=ic.layout.get("icon-text-fit")!=="none",Sv=Ts(Bf,md,y0,Qv),xm=np?Ts(np,md,y0,Qv):void 0;wg=new qt(yu,zs,xf,yo,ro,Bf,ov,Md,!1,md),Xy=4*Sv.length;var Dv=Us.iconSizeData,q0=null;Dv.kind==="source"?(q0=[128*ic.layout.get("icon-size").evaluate(Ep,{})])[0]>32640&&or(Us.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Dv.kind==="composite"&&((q0=[128*xg.compositeIconSizes[0].evaluate(Ep,{},xv),128*xg.compositeIconSizes[1].evaluate(Ep,{},xv)])[0]>32640||q0[1]>32640)&&or(Us.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Us.addSymbols(Us.icon,Sv,q0,Kv,vd,Ep,!1,zs,Cg.lineStartIndex,Cg.lineLength,-1,xv),sv=Us.icon.placedSymbolArray.length-1,xm&&(X0=4*xm.length,Us.addSymbols(Us.icon,xm,q0,Kv,vd,Ep,Ya.vertical,zs,Cg.lineStartIndex,Cg.lineLength,-1,xv),Ag=Us.icon.placedSymbolArray.length-1)}for(var bx in Zh.horizontal){var Jy=Zh.horizontal[bx];if(!bm){Ky=dt(Jy.text);var dE=ic.layout.get("text-rotate").evaluate(Ep,{},xv);bm=new qt(yu,zs,xf,yo,ro,Jy,Bp,av,Np,dE)}var xx=Jy.positionedLines.length===1;if(Yy+=$r(Us,zs,Jy,zp,ic,Np,Ep,qv,Cg,Zh.vertical?Ya.horizontal:Ya.horizontalOnly,xx?Object.keys(Zh.horizontal):[bx],wv,sv,xg,xv),xx)break}Zh.vertical&&(qy+=$r(Us,zs,Zh.vertical,zp,ic,Np,Ep,qv,Cg,Ya.vertical,["vertical"],wv,Ag,xg,xv));var vE=bm?bm.boxStartIndex:Us.collisionBoxArray.length,Qy=bm?bm.boxEndIndex:Us.collisionBoxArray.length,Sx=Sg?Sg.boxStartIndex:Us.collisionBoxArray.length,o_=Sg?Sg.boxEndIndex:Us.collisionBoxArray.length,s_=wg?wg.boxStartIndex:Us.collisionBoxArray.length,gd=wg?wg.boxEndIndex:Us.collisionBoxArray.length,jm=Eg?Eg.boxStartIndex:Us.collisionBoxArray.length,u_=Eg?Eg.boxEndIndex:Us.collisionBoxArray.length,em=-1,Yg=function(qg,l_){return qg&&qg.circleDiameter?Math.max(qg.circleDiameter,l_):l_};em=Yg(bm,em),em=Yg(Sg,em),em=Yg(wg,em);var K0=(em=Yg(Eg,em))>-1?1:0;K0&&(em*=Cp/24),Us.glyphOffsetArray.length>=dn.MAX_GLYPHS&&or("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ep.sortKey!==void 0&&Us.addToSortKeyRanges(Us.symbolInstances.length,Ep.sortKey),Us.symbolInstances.emplaceBack(zs.x,zs.y,wv.right>=0?wv.right:-1,wv.center>=0?wv.center:-1,wv.left>=0?wv.left:-1,wv.vertical||-1,sv,Ag,Ky,vE,Qy,Sx,o_,s_,gd,jm,u_,xf,Yy,qy,Xy,X0,K0,0,Bp,Jv,Y0,em)}(Ba,nc,vh,ms,Eo,gu,b,Ba.layers[0],Ba.collisionBoxArray,bs.index,bs.sourceLayerIndex,Ba.index,ne,We,St,go,Se,ht,Ht,z,bs,fs,Na,v,Cn)};if(ir==="line")for(var Jr=0,wn=Fa(bs.geometry,0,0,8192,8192);Jr<wn.length;Jr+=1)for(var ii=wn[Jr],da=0,$a=lu(ii,Ne,gt,ms.vertical||V,Eo,24,he,Ba.overscaling,8192);da<$a.length;da+=1){var fa=$a[da];V&&ur(Ba,V.text,fr,fa)||Tr(ii,fa)}else if(ir==="line-center")for(var ra=0,Xi=bs.geometry;ra<Xi.length;ra+=1){var ga=Xi[ra];if(ga.length>1){var qi=Kc(ga,gt,ms.vertical||V,Eo,24,he);qi&&Tr(ga,qi)}}else if(bs.type==="Polygon")for(var Ei=0,Wa=Lp(bs.geometry,0);Ei<Wa.length;Ei+=1){var Ta=Wa[Ei],gs=ua(Ta,16);Tr(Ta[0],new ss(gs.x,gs.y,0))}else if(bs.type==="LineString")for(var gl=0,Sl=bs.geometry;gl<Sl.length;gl+=1){var zc=Sl[gl];Tr(zc,new ss(zc[0].x,zc[0].y,0))}else if(bs.type==="Point")for(var Dp=0,Op=bs.geometry;Dp<Op.length;Dp+=1)for(var dh=0,Jh=Op[Dp];dh<Jh.length;dh+=1){var Nh=Jh[dh];Tr([Nh],new ss(Nh.x,Nh.y,0))}}(i,pr,On,Xo,p,re,An,xi,kn,Au,I)},Pt=0,Xt=i.features;Pt<Xt.length;Pt+=1)Je();A&&i.generateCollisionDebugBuffers()},P.perspective=function(i,s,l,p,S){var A,I=1/Math.tan(s/2);return i[0]=I/l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=I,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,S!=null&&S!==1/0?(i[10]=(S+p)*(A=1/(p-S)),i[14]=2*S*p*A):(i[10]=-1,i[14]=-2*p),i},P.pick=function(i,s){for(var l={},p=0;p<s.length;p++){var S=s[p];S in i&&(l[S]=i[S])}return l},P.plugin=_l,P.polygonIntersectsPolygon=uh,P.postMapLoadEvent=tr,P.postTurnstileEvent=mn,P.potpack=Di,P.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],P.register=Ui,P.registerForPluginStateChange=function(i){return i({pluginStatus:Jl,pluginURL:wc}),Mf.on("pluginStateChange",i),i},P.renderColorRamp=Qm,P.rotate=function(i,s,l){var p=s[0],S=s[1],A=s[2],I=s[3],U=Math.sin(l),q=Math.cos(l);return i[0]=p*q+A*U,i[1]=S*q+I*U,i[2]=p*-U+A*q,i[3]=S*-U+I*q,i},P.rotateX=function(i,s,l){var p=Math.sin(l),S=Math.cos(l),A=s[4],I=s[5],U=s[6],q=s[7],re=s[8],de=s[9],we=s[10],Oe=s[11];return s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=A*S+re*p,i[5]=I*S+de*p,i[6]=U*S+we*p,i[7]=q*S+Oe*p,i[8]=re*S-A*p,i[9]=de*S-I*p,i[10]=we*S-U*p,i[11]=Oe*S-q*p,i},P.rotateZ=function(i,s,l){var p=Math.sin(l),S=Math.cos(l),A=s[0],I=s[1],U=s[2],q=s[3],re=s[4],de=s[5],we=s[6],Oe=s[7];return s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=A*S+re*p,i[1]=I*S+de*p,i[2]=U*S+we*p,i[3]=q*S+Oe*p,i[4]=re*S-A*p,i[5]=de*S-I*p,i[6]=we*S-U*p,i[7]=Oe*S-q*p,i},P.scale=function(i,s,l){var p=l[0],S=l[1],A=l[2];return i[0]=s[0]*p,i[1]=s[1]*p,i[2]=s[2]*p,i[3]=s[3]*p,i[4]=s[4]*S,i[5]=s[5]*S,i[6]=s[6]*S,i[7]=s[7]*S,i[8]=s[8]*A,i[9]=s[9]*A,i[10]=s[10]*A,i[11]=s[11]*A,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},P.scale$1=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i[3]=s[3]*l,i},P.scale$2=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i},P.setCacheLimits=function(i,s){Hr=i,dr=s},P.setRTLTextPlugin=function(i,s,l){if(l===void 0&&(l=!1),Jl==="deferred"||Jl==="loading"||Jl==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");wc=Ka.resolveURL(i),Jl="deferred",Tf=s,Yh(),l||Lc()},P.sphericalToCartesian=function(i){var s=i[0],l=i[1],p=i[2];return l+=90,l*=Math.PI/180,p*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(p),y:s*Math.sin(l)*Math.sin(p),z:s*Math.cos(p)}},P.sqrLen=function(i){var s=i[0],l=i[1];return s*s+l*l},P.styleSpec=Fe,P.sub=function(i,s,l){return i[0]=s[0]-l[0],i[1]=s[1]-l[1],i[2]=s[2]-l[2],i},P.symbolSize=$l,P.transformMat3=function(i,s,l){var p=s[0],S=s[1],A=s[2];return i[0]=p*l[0]+S*l[3]+A*l[6],i[1]=p*l[1]+S*l[4]+A*l[7],i[2]=p*l[2]+S*l[5]+A*l[8],i},P.transformMat4=ep,P.translate=function(i,s,l){var p,S,A,I,U,q,re,de,we,Oe,Ge,it,tt=l[0],ct=l[1],ut=l[2];return s===i?(i[12]=s[0]*tt+s[4]*ct+s[8]*ut+s[12],i[13]=s[1]*tt+s[5]*ct+s[9]*ut+s[13],i[14]=s[2]*tt+s[6]*ct+s[10]*ut+s[14],i[15]=s[3]*tt+s[7]*ct+s[11]*ut+s[15]):(S=s[1],A=s[2],I=s[3],U=s[4],q=s[5],re=s[6],de=s[7],we=s[8],Oe=s[9],Ge=s[10],it=s[11],i[0]=p=s[0],i[1]=S,i[2]=A,i[3]=I,i[4]=U,i[5]=q,i[6]=re,i[7]=de,i[8]=we,i[9]=Oe,i[10]=Ge,i[11]=it,i[12]=p*tt+U*ct+we*ut+s[12],i[13]=S*tt+q*ct+Oe*ut+s[13],i[14]=A*tt+re*ct+Ge*ut+s[14],i[15]=I*tt+de*ct+it*ut+s[15]),i},P.triggerPluginCompletionEvent=Ql,P.uniqueId=Rt,P.validateCustomStyleLayer=function(i){var s=[],l=i.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),i.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},P.validateLight=Ih,P.validateStyle=Pe,P.values=function(i){var s=[];for(var l in i)s.push(i[l]);return s},P.vectorTile=Jd,P.version="1.13.3",P.warnOnce=or,P.webpSupported=ca,P.window=le,P.wrap=Ct}),j(["./shared"],function(P){"use strict";function M(se){var ve=typeof se;if(ve==="number"||ve==="boolean"||ve==="string"||se==null)return JSON.stringify(se);if(Array.isArray(se)){for(var Ae="[",Re=0,Xe=se;Re<Xe.length;Re+=1)Ae+=M(Xe[Re])+",";return Ae+"]"}for(var Qe=Object.keys(se).sort(),Ye="{",Fe=0;Fe<Qe.length;Fe++)Ye+=JSON.stringify(Qe[Fe])+":"+M(se[Qe[Fe]])+",";return Ye+"}"}function ee(se){for(var ve="",Ae=0,Re=P.refProperties;Ae<Re.length;Ae+=1)ve+="/"+M(se[Re[Ae]]);return ve}var te=function(se){this.keyCache={},se&&this.replace(se)};te.prototype.replace=function(se){this._layerConfigs={},this._layers={},this.update(se,[])},te.prototype.update=function(se,ve){for(var Ae=this,Re=0,Xe=se;Re<Xe.length;Re+=1){var Qe=Xe[Re];this._layerConfigs[Qe.id]=Qe;var Ye=this._layers[Qe.id]=P.createStyleLayer(Qe);Ye._featureFilter=P.featureFilter(Ye.filter),this.keyCache[Qe.id]&&delete this.keyCache[Qe.id]}for(var Fe=0,Me=ve;Fe<Me.length;Fe+=1){var Be=Me[Fe];delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be]}this.familiesBySource={};for(var yt=0,zt=function(zn,jn){for(var Ca={},ni=0;ni<zn.length;ni++){var za=jn&&jn[zn[ni].id]||ee(zn[ni]);jn&&(jn[zn[ni].id]=za);var Ao=Ca[za];Ao||(Ao=Ca[za]=[]),Ao.push(zn[ni])}var io=[];for(var ys in Ca)io.push(Ca[ys]);return io}(P.values(this._layerConfigs),this.keyCache);yt<zt.length;yt+=1){var Ze=zt[yt].map(function(zn){return Ae._layers[zn.id]}),Yr=Ze[0];if(Yr.visibility!=="none"){var Fn=Yr.source||"",Nn=this.familiesBySource[Fn];Nn||(Nn=this.familiesBySource[Fn]={});var qr=Yr.sourceLayer||"_geojsonTileLayer",li=Nn[qr];li||(li=Nn[qr]=[]),li.push(Ze)}}};var pe=function(se){var ve={},Ae=[];for(var Re in se){var Xe=se[Re],Qe=ve[Re]={};for(var Ye in Xe){var Fe=Xe[+Ye];if(Fe&&Fe.bitmap.width!==0&&Fe.bitmap.height!==0){var Me={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};Ae.push(Me),Qe[Ye]={rect:Me,metrics:Fe.metrics}}}}var Be=P.potpack(Ae),yt=new P.AlphaImage({width:Be.w||1,height:Be.h||1});for(var zt in se){var Ze=se[zt];for(var Yr in Ze){var Fn=Ze[+Yr];if(Fn&&Fn.bitmap.width!==0&&Fn.bitmap.height!==0){var Nn=ve[zt][Yr].rect;P.AlphaImage.copy(Fn.bitmap,yt,{x:0,y:0},{x:Nn.x+1,y:Nn.y+1},Fn.bitmap)}}}this.image=yt,this.positions=ve};P.register("GlyphAtlas",pe);var Ce=function(se){this.tileID=new P.OverscaledTileID(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.uid=se.uid,this.zoom=se.zoom,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.collectResourceTiming,this.returnDependencies=!!se.returnDependencies,this.promoteId=se.promoteId};function le(se,ve,Ae){for(var Re=new P.EvaluationParameters(ve),Xe=0,Qe=se;Xe<Qe.length;Xe+=1)Qe[Xe].recalculate(Re,Ae)}function Ie(se,ve){var Ae=P.getArrayBuffer(se.request,function(Re,Xe,Qe,Ye){Re?ve(Re):Xe&&ve(null,{vectorTile:new P.vectorTile.VectorTile(new P.pbf(Xe)),rawData:Xe,cacheControl:Qe,expires:Ye})});return function(){Ae.cancel(),ve()}}Ce.prototype.parse=function(se,ve,Ae,Re,Xe){var Qe=this;this.status="parsing",this.data=se,this.collisionBoxArray=new P.CollisionBoxArray;var Ye=new P.DictionaryCoder(Object.keys(se.layers).sort()),Fe=new P.FeatureIndex(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];var Me,Be,yt,zt,Ze={},Yr={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Ae},Fn=ve.familiesBySource[this.source];for(var Nn in Fn){var qr=se.layers[Nn];if(qr){qr.version===1&&P.warnOnce('Vector tile source "'+this.source+'" layer "'+Nn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var li=Ye.encode(Nn),zn=[],jn=0;jn<qr.length;jn++){var Ca=qr.feature(jn),ni=Fe.getId(Ca,Nn);zn.push({feature:Ca,id:ni,index:jn,sourceLayerIndex:li})}for(var za=0,Ao=Fn[Nn];za<Ao.length;za+=1){var io=Ao[za],ys=io[0];ys.minzoom&&this.zoom<Math.floor(ys.minzoom)||ys.maxzoom&&this.zoom>=ys.maxzoom||ys.visibility!=="none"&&(le(io,this.zoom,Ae),(Ze[ys.id]=ys.createBucket({index:Fe.bucketLayerIDs.length,layers:io,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source})).populate(zn,Yr,this.tileID.canonical),Fe.bucketLayerIDs.push(io.map(function(as){return as.id})))}}}var oo=P.mapObject(Yr.glyphDependencies,function(as){return Object.keys(as).map(Number)});Object.keys(oo).length?Re.send("getGlyphs",{uid:this.uid,stacks:oo},function(as,To){Me||(Me=as,Be=To,vo.call(Qe))}):Be={};var el=Object.keys(Yr.iconDependencies);el.length?Re.send("getImages",{icons:el,source:this.source,tileID:this.tileID,type:"icons"},function(as,To){Me||(Me=as,yt=To,vo.call(Qe))}):yt={};var Qs=Object.keys(Yr.patternDependencies);function vo(){if(Me)return Xe(Me);if(Be&&yt&&zt){var as=new pe(Be),To=new P.ImageAtlas(yt,zt);for(var to in Ze){var js=Ze[to];js instanceof P.SymbolBucket?(le(js.layers,this.zoom,Ae),P.performSymbolLayout(js,Be,as.positions,yt,To.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):js.hasPattern&&(js instanceof P.LineBucket||js instanceof P.FillBucket||js instanceof P.FillExtrusionBucket)&&(le(js.layers,this.zoom,Ae),js.addFeatures(Yr,this.tileID.canonical,To.patternPositions))}this.status="done",Xe(null,{buckets:P.values(Ze).filter(function(Vc){return!Vc.isEmpty()}),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:as.image,imageAtlas:To,glyphMap:this.returnDependencies?Be:null,iconMap:this.returnDependencies?yt:null,glyphPositions:this.returnDependencies?as.positions:null})}}Qs.length?Re.send("getImages",{icons:Qs,source:this.source,tileID:this.tileID,type:"patterns"},function(as,To){Me||(Me=as,zt=To,vo.call(Qe))}):zt={},vo.call(this)};var rt=function(se,ve,Ae,Re){this.actor=se,this.layerIndex=ve,this.availableImages=Ae,this.loadVectorData=Re||Ie,this.loading={},this.loaded={}};rt.prototype.loadTile=function(se,ve){var Ae=this,Re=se.uid;this.loading||(this.loading={});var Xe=!!(se&&se.request&&se.request.collectResourceTiming)&&new P.RequestPerformance(se.request),Qe=this.loading[Re]=new Ce(se);Qe.abort=this.loadVectorData(se,function(Ye,Fe){if(delete Ae.loading[Re],Ye||!Fe)return Qe.status="done",Ae.loaded[Re]=Qe,ve(Ye);var Me=Fe.rawData,Be={};Fe.expires&&(Be.expires=Fe.expires),Fe.cacheControl&&(Be.cacheControl=Fe.cacheControl);var yt={};if(Xe){var zt=Xe.finish();zt&&(yt.resourceTiming=JSON.parse(JSON.stringify(zt)))}Qe.vectorTile=Fe.vectorTile,Qe.parse(Fe.vectorTile,Ae.layerIndex,Ae.availableImages,Ae.actor,function(Ze,Yr){if(Ze||!Yr)return ve(Ze);ve(null,P.extend({rawTileData:Me.slice(0)},Yr,Be,yt))}),Ae.loaded=Ae.loaded||{},Ae.loaded[Re]=Qe})},rt.prototype.reloadTile=function(se,ve){var Ae=this,Re=this.loaded,Xe=se.uid,Qe=this;if(Re&&Re[Xe]){var Ye=Re[Xe];Ye.showCollisionBoxes=se.showCollisionBoxes;var Fe=function(Me,Be){var yt=Ye.reloadCallback;yt&&(delete Ye.reloadCallback,Ye.parse(Ye.vectorTile,Qe.layerIndex,Ae.availableImages,Qe.actor,yt)),ve(Me,Be)};Ye.status==="parsing"?Ye.reloadCallback=Fe:Ye.status==="done"&&(Ye.vectorTile?Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Fe):Fe())}},rt.prototype.abortTile=function(se,ve){var Ae=this.loading,Re=se.uid;Ae&&Ae[Re]&&Ae[Re].abort&&(Ae[Re].abort(),delete Ae[Re]),ve()},rt.prototype.removeTile=function(se,ve){var Ae=this.loaded,Re=se.uid;Ae&&Ae[Re]&&delete Ae[Re],ve()};var xt=P.window.ImageBitmap,nt=function(){this.loaded={}};function Ct(se,ve){if(se.length!==0){jt(se[0],ve);for(var Ae=1;Ae<se.length;Ae++)jt(se[Ae],!ve)}}function jt(se,ve){for(var Ae=0,Re=0,Xe=0,Qe=se.length,Ye=Qe-1;Xe<Qe;Ye=Xe++){var Fe=(se[Xe][0]-se[Ye][0])*(se[Ye][1]+se[Xe][1]),Me=Ae+Fe;Re+=Math.abs(Ae)>=Math.abs(Fe)?Ae-Me+Fe:Fe-Me+Ae,Ae=Me}Ae+Re>=0!=!!ve&&se.reverse()}nt.prototype.loadTile=function(se,ve){var Ae=se.uid,Re=se.encoding,Xe=se.rawImageData,Qe=xt&&Xe instanceof xt?this.getImageData(Xe):Xe,Ye=new P.DEMData(Ae,Qe,Re);this.loaded=this.loaded||{},this.loaded[Ae]=Ye,ve(null,Ye)},nt.prototype.getImageData=function(se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);var ve=this.offscreenCanvasContext.getImageData(-1,-1,se.width+2,se.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new P.RGBAImage({width:ve.width,height:ve.height},ve.data)},nt.prototype.removeTile=function(se){var ve=this.loaded,Ae=se.uid;ve&&ve[Ae]&&delete ve[Ae]};var Vt=P.vectorTile.VectorTileFeature.prototype.toGeoJSON,Rt=function(se){this._feature=se,this.extent=P.EXTENT,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))};Rt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var se=[],ve=0,Ae=this._feature.geometry;ve<Ae.length;ve+=1){var Re=Ae[ve];se.push([new P.Point$1(Re[0],Re[1])])}return se}for(var Xe=[],Qe=0,Ye=this._feature.geometry;Qe<Ye.length;Qe+=1){for(var Fe=[],Me=0,Be=Ye[Qe];Me<Be.length;Me+=1){var yt=Be[Me];Fe.push(new P.Point$1(yt[0],yt[1]))}Xe.push(Fe)}return Xe},Rt.prototype.toGeoJSON=function(se,ve,Ae){return Vt.call(this,se,ve,Ae)};var hr=function(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=P.EXTENT,this.length=se.length,this._features=se};hr.prototype.feature=function(se){return new Rt(this._features[se])};var er=P.vectorTile.VectorTileFeature,gn=Rr;function Rr(se,ve){this.options=ve||{},this.features=se,this.length=se.length}function vn(se,ve){this.id=typeof se.id=="number"?se.id:void 0,this.type=se.type,this.rawGeometry=se.type===1?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=ve||4096}Rr.prototype.feature=function(se){return new vn(this.features[se],this.options.extent)},vn.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var ve=0;ve<se.length;ve++){for(var Ae=se[ve],Re=[],Xe=0;Xe<Ae.length;Xe++)Re.push(new P.Point$1(Ae[Xe][0],Ae[Xe][1]));this.geometry.push(Re)}return this.geometry},vn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,ve=1/0,Ae=-1/0,Re=1/0,Xe=-1/0,Qe=0;Qe<se.length;Qe++)for(var Ye=se[Qe],Fe=0;Fe<Ye.length;Fe++){var Me=Ye[Fe];ve=Math.min(ve,Me.x),Ae=Math.max(Ae,Me.x),Re=Math.min(Re,Me.y),Xe=Math.max(Xe,Me.y)}return[ve,Re,Ae,Xe]},vn.prototype.toGeoJSON=er.prototype.toGeoJSON;var rr=br,Jt=gn;function br(se){var ve=new P.pbf;return function(Ae,Re){for(var Xe in Ae.layers)Re.writeMessage(3,or,Ae.layers[Xe])}(se,ve),ve.finish()}function or(se,ve){var Ae;ve.writeVarintField(15,se.version||1),ve.writeStringField(1,se.name||""),ve.writeVarintField(5,se.extent||4096);var Re={keys:[],values:[],keycache:{},valuecache:{}};for(Ae=0;Ae<se.length;Ae++)Re.feature=se.feature(Ae),ve.writeMessage(2,Br,Re);var Xe=Re.keys;for(Ae=0;Ae<Xe.length;Ae++)ve.writeStringField(3,Xe[Ae]);var Qe=Re.values;for(Ae=0;Ae<Qe.length;Ae++)ve.writeMessage(4,Bt,Qe[Ae])}function Br(se,ve){var Ae=se.feature;Ae.id!==void 0&&ve.writeVarintField(1,Ae.id),ve.writeMessage(2,an,se),ve.writeVarintField(3,Ae.type),ve.writeMessage(4,Ee,Ae)}function an(se,ve){var Ae=se.feature,Re=se.keys,Xe=se.values,Qe=se.keycache,Ye=se.valuecache;for(var Fe in Ae.properties){var Me=Qe[Fe];Me===void 0&&(Re.push(Fe),Qe[Fe]=Me=Re.length-1),ve.writeVarint(Me);var Be=Ae.properties[Fe],yt=typeof Be;yt!=="string"&&yt!=="boolean"&&yt!=="number"&&(Be=JSON.stringify(Be));var zt=yt+":"+Be,Ze=Ye[zt];Ze===void 0&&(Xe.push(Be),Ye[zt]=Ze=Xe.length-1),ve.writeVarint(Ze)}}function ot(se,ve){return(ve<<3)+(7&se)}function Dt(se){return se<<1^se>>31}function Ee(se,ve){for(var Ae=se.loadGeometry(),Re=se.type,Xe=0,Qe=0,Ye=Ae.length,Fe=0;Fe<Ye;Fe++){var Me=Ae[Fe],Be=1;Re===1&&(Be=Me.length),ve.writeVarint(ot(1,Be));for(var yt=Re===3?Me.length-1:Me.length,zt=0;zt<yt;zt++){zt===1&&Re!==1&&ve.writeVarint(ot(2,yt-1));var Ze=Me[zt].x-Xe,Yr=Me[zt].y-Qe;ve.writeVarint(Dt(Ze)),ve.writeVarint(Dt(Yr)),Xe+=Ze,Qe+=Yr}Re===3&&ve.writeVarint(ot(7,1))}}function Bt(se,ve){var Ae=typeof se;Ae==="string"?ve.writeStringField(1,se):Ae==="boolean"?ve.writeBooleanField(7,se):Ae==="number"&&(se%1!=0?ve.writeDoubleField(3,se):se<0?ve.writeSVarintField(6,se):ve.writeVarintField(5,se))}function Ot(se,ve,Ae,Re){Pr(se,Ae,Re),Pr(ve,2*Ae,2*Re),Pr(ve,2*Ae+1,2*Re+1)}function Pr(se,ve,Ae){var Re=se[ve];se[ve]=se[Ae],se[Ae]=Re}function Fr(se,ve,Ae,Re){var Xe=se-Ae,Qe=ve-Re;return Xe*Xe+Qe*Qe}rr.fromVectorTileJs=br,rr.fromGeojsonVt=function(se,ve){ve=ve||{};var Ae={};for(var Re in se)Ae[Re]=new gn(se[Re].features,ve),Ae[Re].name=Re,Ae[Re].version=ve.version,Ae[Re].extent=ve.extent;return br({layers:Ae})},rr.GeoJSONWrapper=Jt;var Nr=function(se){return se[0]},hn=function(se){return se[1]},xn=function(se,ve,Ae,Re,Xe){ve===void 0&&(ve=Nr),Ae===void 0&&(Ae=hn),Re===void 0&&(Re=64),Xe===void 0&&(Xe=Float64Array),this.nodeSize=Re,this.points=se;for(var Qe=se.length<65536?Uint16Array:Uint32Array,Ye=this.ids=new Qe(se.length),Fe=this.coords=new Xe(2*se.length),Me=0;Me<se.length;Me++)Ye[Me]=Me,Fe[2*Me]=ve(se[Me]),Fe[2*Me+1]=Ae(se[Me]);(function Be(yt,zt,Ze,Yr,Fn,Nn){if(!(Fn-Yr<=Ze)){var qr=Yr+Fn>>1;(function li(zn,jn,Ca,ni,za,Ao){for(;za>ni;){if(za-ni>600){var io=za-ni+1,ys=Ca-ni+1,oo=Math.log(io),el=.5*Math.exp(2*oo/3),Qs=.5*Math.sqrt(oo*el*(io-el)/io)*(ys-io/2<0?-1:1);li(zn,jn,Ca,Math.max(ni,Math.floor(Ca-ys*el/io+Qs)),Math.min(za,Math.floor(Ca+(io-ys)*el/io+Qs)),Ao)}var vo=jn[2*Ca+Ao],as=ni,To=za;for(Ot(zn,jn,ni,Ca),jn[2*za+Ao]>vo&&Ot(zn,jn,ni,za);as<To;){for(Ot(zn,jn,as,To),as++,To--;jn[2*as+Ao]<vo;)as++;for(;jn[2*To+Ao]>vo;)To--}jn[2*ni+Ao]===vo?Ot(zn,jn,ni,To):Ot(zn,jn,++To,za),To<=Ca&&(ni=To+1),Ca<=To&&(za=To-1)}})(yt,zt,qr,Yr,Fn,Nn%2),Be(yt,zt,Ze,Yr,qr-1,Nn+1),Be(yt,zt,Ze,qr+1,Fn,Nn+1)}})(Ye,Fe,Re,0,Ye.length-1,0)};xn.prototype.range=function(se,ve,Ae,Re){return function(Xe,Qe,Ye,Fe,Me,Be,yt){for(var zt,Ze,Yr=[0,Xe.length-1,0],Fn=[];Yr.length;){var Nn=Yr.pop(),qr=Yr.pop(),li=Yr.pop();if(qr-li<=yt)for(var zn=li;zn<=qr;zn++)Ze=Qe[2*zn+1],(zt=Qe[2*zn])>=Ye&&zt<=Me&&Ze>=Fe&&Ze<=Be&&Fn.push(Xe[zn]);else{var jn=Math.floor((li+qr)/2);Ze=Qe[2*jn+1],(zt=Qe[2*jn])>=Ye&&zt<=Me&&Ze>=Fe&&Ze<=Be&&Fn.push(Xe[jn]);var Ca=(Nn+1)%2;(Nn===0?Ye<=zt:Fe<=Ze)&&(Yr.push(li),Yr.push(jn-1),Yr.push(Ca)),(Nn===0?Me>=zt:Be>=Ze)&&(Yr.push(jn+1),Yr.push(qr),Yr.push(Ca))}}return Fn}(this.ids,this.coords,se,ve,Ae,Re,this.nodeSize)},xn.prototype.within=function(se,ve,Ae){return function(Re,Xe,Qe,Ye,Fe,Me){for(var Be=[0,Re.length-1,0],yt=[],zt=Fe*Fe;Be.length;){var Ze=Be.pop(),Yr=Be.pop(),Fn=Be.pop();if(Yr-Fn<=Me)for(var Nn=Fn;Nn<=Yr;Nn++)Fr(Xe[2*Nn],Xe[2*Nn+1],Qe,Ye)<=zt&&yt.push(Re[Nn]);else{var qr=Math.floor((Fn+Yr)/2),li=Xe[2*qr],zn=Xe[2*qr+1];Fr(li,zn,Qe,Ye)<=zt&&yt.push(Re[qr]);var jn=(Ze+1)%2;(Ze===0?Qe-Fe<=li:Ye-Fe<=zn)&&(Be.push(Fn),Be.push(qr-1),Be.push(jn)),(Ze===0?Qe+Fe>=li:Ye+Fe>=zn)&&(Be.push(qr+1),Be.push(Yr),Be.push(jn))}}return yt}(this.ids,this.coords,se,ve,Ae,this.nodeSize)};var Ji={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(se){return se}},pi=function(se){this.options=qo(Object.create(Ji),se),this.trees=new Array(this.options.maxZoom+1)};function Ka(se,ve,Ae,Re,Xe){return{x:se,y:ve,zoom:1/0,id:Ae,parentId:-1,numPoints:Re,properties:Xe}}function na(se,ve){var Ae=se.geometry.coordinates,Re=Ae[1];return{x:La(Ae[0]),y:$i(Re),zoom:1/0,index:ve,parentId:-1}}function ca(se){return{type:"Feature",id:se.id,properties:po(se),geometry:{type:"Point",coordinates:[(Re=se.x,360*(Re-.5)),(ve=se.y,Ae=(180-360*ve)*Math.PI/180,360*Math.atan(Math.exp(Ae))/Math.PI-90)]}};var ve,Ae,Re}function po(se){var ve=se.numPoints,Ae=ve>=1e4?Math.round(ve/1e3)+"k":ve>=1e3?Math.round(ve/100)/10+"k":ve;return qo(qo({},se.properties),{cluster:!0,cluster_id:se.id,point_count:ve,point_count_abbreviated:Ae})}function La(se){return se/360+.5}function $i(se){var ve=Math.sin(se*Math.PI/180),Ae=.5-.25*Math.log((1+ve)/(1-ve))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function qo(se,ve){for(var Ae in ve)se[Ae]=ve[Ae];return se}function is(se){return se.x}function Ko(se){return se.y}function Za(se,ve,Ae,Re,Xe,Qe){var Ye=Xe-Ae,Fe=Qe-Re;if(Ye!==0||Fe!==0){var Me=((se-Ae)*Ye+(ve-Re)*Fe)/(Ye*Ye+Fe*Fe);Me>1?(Ae=Xe,Re=Qe):Me>0&&(Ae+=Ye*Me,Re+=Fe*Me)}return(Ye=se-Ae)*Ye+(Fe=ve-Re)*Fe}function ha(se,ve,Ae,Re){var Xe={id:se===void 0?null:se,type:ve,geometry:Ae,tags:Re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Qe){var Ye=Qe.geometry,Fe=Qe.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")Fo(Qe,Ye);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var Me=0;Me<Ye.length;Me++)Fo(Qe,Ye[Me]);else if(Fe==="MultiPolygon")for(Me=0;Me<Ye.length;Me++)for(var Be=0;Be<Ye[Me].length;Be++)Fo(Qe,Ye[Me][Be])}(Xe),Xe}function Fo(se,ve){for(var Ae=0;Ae<ve.length;Ae+=3)se.minX=Math.min(se.minX,ve[Ae]),se.minY=Math.min(se.minY,ve[Ae+1]),se.maxX=Math.max(se.maxX,ve[Ae]),se.maxY=Math.max(se.maxY,ve[Ae+1])}function un(se,ve,Ae,Re){if(ve.geometry){var Xe=ve.geometry.coordinates,Qe=ve.geometry.type,Ye=Math.pow(Ae.tolerance/((1<<Ae.maxZoom)*Ae.extent),2),Fe=[],Me=ve.id;if(Ae.promoteId?Me=ve.properties[Ae.promoteId]:Ae.generateId&&(Me=Re||0),Qe==="Point")Ua(Xe,Fe);else if(Qe==="MultiPoint")for(var Be=0;Be<Xe.length;Be++)Ua(Xe[Be],Fe);else if(Qe==="LineString")zr(Xe,Fe,Ye,!1);else if(Qe==="MultiLineString"){if(Ae.lineMetrics){for(Be=0;Be<Xe.length;Be++)zr(Xe[Be],Fe=[],Ye,!1),se.push(ha(Me,"LineString",Fe,ve.properties));return}be(Xe,Fe,Ye,!1)}else if(Qe==="Polygon")be(Xe,Fe,Ye,!0);else{if(Qe!=="MultiPolygon"){if(Qe==="GeometryCollection"){for(Be=0;Be<ve.geometry.geometries.length;Be++)un(se,{id:Me,geometry:ve.geometry.geometries[Be],properties:ve.properties},Ae,Re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<Xe.length;Be++){var yt=[];be(Xe[Be],yt,Ye,!0),Fe.push(yt)}}se.push(ha(Me,Qe,Fe,ve.properties))}}function Ua(se,ve){ve.push(lt(se[0])),ve.push(mt(se[1])),ve.push(0)}function zr(se,ve,Ae,Re){for(var Xe,Qe,Ye=0,Fe=0;Fe<se.length;Fe++){var Me=lt(se[Fe][0]),Be=mt(se[Fe][1]);ve.push(Me),ve.push(Be),ve.push(0),Fe>0&&(Ye+=Re?(Xe*Be-Me*Qe)/2:Math.sqrt(Math.pow(Me-Xe,2)+Math.pow(Be-Qe,2))),Xe=Me,Qe=Be}var yt=ve.length-3;ve[2]=1,function zt(Ze,Yr,Fn,Nn){for(var qr,li=Nn,zn=Fn-Yr>>1,jn=Fn-Yr,Ca=Ze[Yr],ni=Ze[Yr+1],za=Ze[Fn],Ao=Ze[Fn+1],io=Yr+3;io<Fn;io+=3){var ys=Za(Ze[io],Ze[io+1],Ca,ni,za,Ao);if(ys>li)qr=io,li=ys;else if(ys===li){var oo=Math.abs(io-zn);oo<jn&&(qr=io,jn=oo)}}li>Nn&&(qr-Yr>3&&zt(Ze,Yr,qr,Nn),Ze[qr+2]=li,Fn-qr>3&&zt(Ze,qr,Fn,Nn))}(ve,0,yt,Ae),ve[yt+2]=1,ve.size=Math.abs(Ye),ve.start=0,ve.end=ve.size}function be(se,ve,Ae,Re){for(var Xe=0;Xe<se.length;Xe++){var Qe=[];zr(se[Xe],Qe,Ae,Re),ve.push(Qe)}}function lt(se){return se/360+.5}function mt(se){var ve=Math.sin(se*Math.PI/180),Ae=.5-.25*Math.log((1+ve)/(1-ve))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function Qt(se,ve,Ae,Re,Xe,Qe,Ye,Fe){if(Re/=ve,Qe>=(Ae/=ve)&&Ye<Re)return se;if(Ye<Ae||Qe>=Re)return null;for(var Me=[],Be=0;Be<se.length;Be++){var yt=se[Be],zt=yt.geometry,Ze=yt.type,Yr=Xe===0?yt.minX:yt.minY,Fn=Xe===0?yt.maxX:yt.maxY;if(Yr>=Ae&&Fn<Re)Me.push(yt);else if(!(Fn<Ae||Yr>=Re)){var Nn=[];if(Ze==="Point"||Ze==="MultiPoint")xr(zt,Nn,Ae,Re,Xe);else if(Ze==="LineString")mn(zt,Nn,Ae,Re,Xe,!1,Fe.lineMetrics);else if(Ze==="MultiLineString")tr(zt,Nn,Ae,Re,Xe,!1);else if(Ze==="Polygon")tr(zt,Nn,Ae,Re,Xe,!0);else if(Ze==="MultiPolygon")for(var qr=0;qr<zt.length;qr++){var li=[];tr(zt[qr],li,Ae,Re,Xe,!0),li.length&&Nn.push(li)}if(Nn.length){if(Fe.lineMetrics&&Ze==="LineString"){for(qr=0;qr<Nn.length;qr++)Me.push(ha(yt.id,Ze,Nn[qr],yt.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Nn.length===1?(Ze="LineString",Nn=Nn[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Nn.length===3?"Point":"MultiPoint"),Me.push(ha(yt.id,Ze,Nn,yt.tags))}}}return Me.length?Me:null}function xr(se,ve,Ae,Re,Xe){for(var Qe=0;Qe<se.length;Qe+=3){var Ye=se[Qe+Xe];Ye>=Ae&&Ye<=Re&&(ve.push(se[Qe]),ve.push(se[Qe+1]),ve.push(se[Qe+2]))}}function mn(se,ve,Ae,Re,Xe,Qe,Ye){for(var Fe,Me,Be=Wn(se),yt=Xe===0?dr:Un,zt=se.start,Ze=0;Ze<se.length-3;Ze+=3){var Yr=se[Ze],Fn=se[Ze+1],Nn=se[Ze+2],qr=se[Ze+3],li=se[Ze+4],zn=Xe===0?Yr:Fn,jn=Xe===0?qr:li,Ca=!1;Ye&&(Fe=Math.sqrt(Math.pow(Yr-qr,2)+Math.pow(Fn-li,2))),zn<Ae?jn>Ae&&(Me=yt(Be,Yr,Fn,qr,li,Ae),Ye&&(Be.start=zt+Fe*Me)):zn>Re?jn<Re&&(Me=yt(Be,Yr,Fn,qr,li,Re),Ye&&(Be.start=zt+Fe*Me)):Hr(Be,Yr,Fn,Nn),jn<Ae&&zn>=Ae&&(Me=yt(Be,Yr,Fn,qr,li,Ae),Ca=!0),jn>Re&&zn<=Re&&(Me=yt(Be,Yr,Fn,qr,li,Re),Ca=!0),!Qe&&Ca&&(Ye&&(Be.end=zt+Fe*Me),ve.push(Be),Be=Wn(se)),Ye&&(zt+=Fe)}var ni=se.length-3;Yr=se[ni],Fn=se[ni+1],Nn=se[ni+2],(zn=Xe===0?Yr:Fn)>=Ae&&zn<=Re&&Hr(Be,Yr,Fn,Nn),ni=Be.length-3,Qe&&ni>=3&&(Be[ni]!==Be[0]||Be[ni+1]!==Be[1])&&Hr(Be,Be[0],Be[1],Be[2]),Be.length&&ve.push(Be)}function Wn(se){var ve=[];return ve.size=se.size,ve.start=se.start,ve.end=se.end,ve}function tr(se,ve,Ae,Re,Xe,Qe){for(var Ye=0;Ye<se.length;Ye++)mn(se[Ye],ve,Ae,Re,Xe,Qe,!1)}function Hr(se,ve,Ae,Re){se.push(ve),se.push(Ae),se.push(Re)}function dr(se,ve,Ae,Re,Xe,Qe){var Ye=(Qe-ve)/(Re-ve);return se.push(Qe),se.push(Ae+(Xe-Ae)*Ye),se.push(1),Ye}function Un(se,ve,Ae,Re,Xe,Qe){var Ye=(Qe-Ae)/(Xe-Ae);return se.push(ve+(Re-ve)*Ye),se.push(Qe),se.push(1),Ye}function ti(se,ve){for(var Ae=[],Re=0;Re<se.length;Re++){var Xe,Qe=se[Re],Ye=Qe.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")Xe=Yi(Qe.geometry,ve);else if(Ye==="MultiLineString"||Ye==="Polygon"){Xe=[];for(var Fe=0;Fe<Qe.geometry.length;Fe++)Xe.push(Yi(Qe.geometry[Fe],ve))}else if(Ye==="MultiPolygon")for(Xe=[],Fe=0;Fe<Qe.geometry.length;Fe++){for(var Me=[],Be=0;Be<Qe.geometry[Fe].length;Be++)Me.push(Yi(Qe.geometry[Fe][Be],ve));Xe.push(Me)}Ae.push(ha(Qe.id,Ye,Xe,Qe.tags))}return Ae}function Yi(se,ve){var Ae=[];Ae.size=se.size,se.start!==void 0&&(Ae.start=se.start,Ae.end=se.end);for(var Re=0;Re<se.length;Re+=3)Ae.push(se[Re]+ve,se[Re+1],se[Re+2]);return Ae}function ea(se,ve){if(se.transformed)return se;var Ae,Re,Xe,Qe=1<<se.z,Ye=se.x,Fe=se.y;for(Ae=0;Ae<se.features.length;Ae++){var Me=se.features[Ae],Be=Me.geometry,yt=Me.type;if(Me.geometry=[],yt===1)for(Re=0;Re<Be.length;Re+=2)Me.geometry.push(on(Be[Re],Be[Re+1],ve,Qe,Ye,Fe));else for(Re=0;Re<Be.length;Re++){var zt=[];for(Xe=0;Xe<Be[Re].length;Xe+=2)zt.push(on(Be[Re][Xe],Be[Re][Xe+1],ve,Qe,Ye,Fe));Me.geometry.push(zt)}}return se.transformed=!0,se}function on(se,ve,Ae,Re,Xe,Qe){return[Math.round(Ae*(se*Re-Xe)),Math.round(Ae*(ve*Re-Qe))]}function Xn(se,ve,Ae,Re,Xe){for(var Qe=ve===Xe.maxZoom?0:Xe.tolerance/((1<<ve)*Xe.extent),Ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ae,y:Re,z:ve,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<se.length;Fe++){Ye.numFeatures++,Pi(Ye,se[Fe],Qe,Xe);var Me=se[Fe].minX,Be=se[Fe].minY,yt=se[Fe].maxX,zt=se[Fe].maxY;Me<Ye.minX&&(Ye.minX=Me),Be<Ye.minY&&(Ye.minY=Be),yt>Ye.maxX&&(Ye.maxX=yt),zt>Ye.maxY&&(Ye.maxY=zt)}return Ye}function Pi(se,ve,Ae,Re){var Xe=ve.geometry,Qe=ve.type,Ye=[];if(Qe==="Point"||Qe==="MultiPoint")for(var Fe=0;Fe<Xe.length;Fe+=3)Ye.push(Xe[Fe]),Ye.push(Xe[Fe+1]),se.numPoints++,se.numSimplified++;else if(Qe==="LineString")Pa(Ye,Xe,se,Ae,!1,!1);else if(Qe==="MultiLineString"||Qe==="Polygon")for(Fe=0;Fe<Xe.length;Fe++)Pa(Ye,Xe[Fe],se,Ae,Qe==="Polygon",Fe===0);else if(Qe==="MultiPolygon")for(var Me=0;Me<Xe.length;Me++){var Be=Xe[Me];for(Fe=0;Fe<Be.length;Fe++)Pa(Ye,Be[Fe],se,Ae,!0,Fe===0)}if(Ye.length){var yt=ve.tags||null;if(Qe==="LineString"&&Re.lineMetrics){for(var zt in yt={},ve.tags)yt[zt]=ve.tags[zt];yt.mapbox_clip_start=Xe.start/Xe.size,yt.mapbox_clip_end=Xe.end/Xe.size}var Ze={geometry:Ye,type:Qe==="Polygon"||Qe==="MultiPolygon"?3:Qe==="LineString"||Qe==="MultiLineString"?2:1,tags:yt};ve.id!==null&&(Ze.id=ve.id),se.features.push(Ze)}}function Pa(se,ve,Ae,Re,Xe,Qe){var Ye=Re*Re;if(Re>0&&ve.size<(Xe?Ye:Re))Ae.numPoints+=ve.length/3;else{for(var Fe=[],Me=0;Me<ve.length;Me+=3)(Re===0||ve[Me+2]>Ye)&&(Ae.numSimplified++,Fe.push(ve[Me]),Fe.push(ve[Me+1])),Ae.numPoints++;Xe&&function(Be,yt){for(var zt=0,Ze=0,Yr=Be.length,Fn=Yr-2;Ze<Yr;Fn=Ze,Ze+=2)zt+=(Be[Ze]-Be[Fn])*(Be[Ze+1]+Be[Fn+1]);if(zt>0===yt)for(Ze=0,Yr=Be.length;Ze<Yr/2;Ze+=2){var Nn=Be[Ze],qr=Be[Ze+1];Be[Ze]=Be[Yr-2-Ze],Be[Ze+1]=Be[Yr-1-Ze],Be[Yr-2-Ze]=Nn,Be[Yr-1-Ze]=qr}}(Fe,Qe),se.push(Fe)}}function zo(se,ve){var Ae=(ve=this.options=function(Xe,Qe){for(var Ye in Qe)Xe[Ye]=Qe[Ye];return Xe}(Object.create(this.options),ve)).debug;if(Ae&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");var Re=function(Xe,Qe){var Ye=[];if(Xe.type==="FeatureCollection")for(var Fe=0;Fe<Xe.features.length;Fe++)un(Ye,Xe.features[Fe],Qe,Fe);else un(Ye,Xe.type==="Feature"?Xe:{geometry:Xe},Qe);return Ye}(se,ve);this.tiles={},this.tileCoords=[],Ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Re=function(Xe,Qe){var Ye=Qe.buffer/Qe.extent,Fe=Xe,Me=Qt(Xe,1,-1-Ye,Ye,0,-1,2,Qe),Be=Qt(Xe,1,1-Ye,2+Ye,0,-1,2,Qe);return(Me||Be)&&(Fe=Qt(Xe,1,-Ye,1+Ye,0,-1,2,Qe)||[],Me&&(Fe=ti(Me,1).concat(Fe)),Be&&(Fe=Fe.concat(ti(Be,-1)))),Fe}(Re,ve)).length&&this.splitTile(Re,0,0,0),Ae&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ya(se,ve,Ae){return 32*((1<<se)*Ae+ve)+se}function Xu(se,ve){var Ae=se.tileID.canonical;if(!this._geoJSONIndex)return ve(null,null);var Re=this._geoJSONIndex.getTile(Ae.z,Ae.x,Ae.y);if(!Re)return ve(null,null);var Xe=new hr(Re.features),Qe=rr(Xe);Qe.byteOffset===0&&Qe.byteLength===Qe.buffer.byteLength||(Qe=new Uint8Array(Qe)),ve(null,{vectorTile:Xe,rawData:Qe.buffer})}pi.prototype.load=function(se){var ve=this.options,Ae=ve.log,Re=ve.minZoom,Xe=ve.maxZoom,Qe=ve.nodeSize;Ae&&console.time("total time");var Ye="prepare "+se.length+" points";Ae&&console.time(Ye),this.points=se;for(var Fe=[],Me=0;Me<se.length;Me++)se[Me].geometry&&Fe.push(na(se[Me],Me));this.trees[Xe+1]=new xn(Fe,is,Ko,Qe,Float32Array),Ae&&console.timeEnd(Ye);for(var Be=Xe;Be>=Re;Be--){var yt=+Date.now();Fe=this._cluster(Fe,Be),this.trees[Be]=new xn(Fe,is,Ko,Qe,Float32Array),Ae&&console.log("z%d: %d clusters in %dms",Be,Fe.length,+Date.now()-yt)}return Ae&&console.timeEnd("total time"),this},pi.prototype.getClusters=function(se,ve){var Ae=((se[0]+180)%360+360)%360-180,Re=Math.max(-90,Math.min(90,se[1])),Xe=se[2]===180?180:((se[2]+180)%360+360)%360-180,Qe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)Ae=-180,Xe=180;else if(Ae>Xe){var Ye=this.getClusters([Ae,Re,180,Qe],ve),Fe=this.getClusters([-180,Re,Xe,Qe],ve);return Ye.concat(Fe)}for(var Me=this.trees[this._limitZoom(ve)],Be=[],yt=0,zt=Me.range(La(Ae),$i(Qe),La(Xe),$i(Re));yt<zt.length;yt+=1){var Ze=Me.points[zt[yt]];Be.push(Ze.numPoints?ca(Ze):this.points[Ze.index])}return Be},pi.prototype.getChildren=function(se){var ve=this._getOriginId(se),Ae=this._getOriginZoom(se),Re="No cluster with the specified id.",Xe=this.trees[Ae];if(!Xe)throw new Error(Re);var Qe=Xe.points[ve];if(!Qe)throw new Error(Re);for(var Ye=this.options.radius/(this.options.extent*Math.pow(2,Ae-1)),Fe=[],Me=0,Be=Xe.within(Qe.x,Qe.y,Ye);Me<Be.length;Me+=1){var yt=Xe.points[Be[Me]];yt.parentId===se&&Fe.push(yt.numPoints?ca(yt):this.points[yt.index])}if(Fe.length===0)throw new Error(Re);return Fe},pi.prototype.getLeaves=function(se,ve,Ae){var Re=[];return this._appendLeaves(Re,se,ve=ve||10,Ae=Ae||0,0),Re},pi.prototype.getTile=function(se,ve,Ae){var Re=this.trees[this._limitZoom(se)],Xe=Math.pow(2,se),Qe=this.options,Ye=Qe.radius/Qe.extent,Fe=(Ae-Ye)/Xe,Me=(Ae+1+Ye)/Xe,Be={features:[]};return this._addTileFeatures(Re.range((ve-Ye)/Xe,Fe,(ve+1+Ye)/Xe,Me),Re.points,ve,Ae,Xe,Be),ve===0&&this._addTileFeatures(Re.range(1-Ye/Xe,Fe,1,Me),Re.points,Xe,Ae,Xe,Be),ve===Xe-1&&this._addTileFeatures(Re.range(0,Fe,Ye/Xe,Me),Re.points,-1,Ae,Xe,Be),Be.features.length?Be:null},pi.prototype.getClusterExpansionZoom=function(se){for(var ve=this._getOriginZoom(se)-1;ve<=this.options.maxZoom;){var Ae=this.getChildren(se);if(ve++,Ae.length!==1)break;se=Ae[0].properties.cluster_id}return ve},pi.prototype._appendLeaves=function(se,ve,Ae,Re,Xe){for(var Qe=0,Ye=this.getChildren(ve);Qe<Ye.length;Qe+=1){var Fe=Ye[Qe],Me=Fe.properties;if(Me&&Me.cluster?Xe+Me.point_count<=Re?Xe+=Me.point_count:Xe=this._appendLeaves(se,Me.cluster_id,Ae,Re,Xe):Xe<Re?Xe++:se.push(Fe),se.length===Ae)break}return Xe},pi.prototype._addTileFeatures=function(se,ve,Ae,Re,Xe,Qe){for(var Ye=0,Fe=se;Ye<Fe.length;Ye+=1){var Me=ve[Fe[Ye]],Be=Me.numPoints,yt={type:1,geometry:[[Math.round(this.options.extent*(Me.x*Xe-Ae)),Math.round(this.options.extent*(Me.y*Xe-Re))]],tags:Be?po(Me):this.points[Me.index].properties},zt=void 0;Be?zt=Me.id:this.options.generateId?zt=Me.index:this.points[Me.index].id&&(zt=this.points[Me.index].id),zt!==void 0&&(yt.id=zt),Qe.features.push(yt)}},pi.prototype._limitZoom=function(se){return Math.max(this.options.minZoom,Math.min(+se,this.options.maxZoom+1))},pi.prototype._cluster=function(se,ve){for(var Ae=[],Re=this.options,Xe=Re.reduce,Qe=Re.minPoints,Ye=Re.radius/(Re.extent*Math.pow(2,ve)),Fe=0;Fe<se.length;Fe++){var Me=se[Fe];if(!(Me.zoom<=ve)){Me.zoom=ve;for(var Be=this.trees[ve+1],yt=Be.within(Me.x,Me.y,Ye),zt=Me.numPoints||1,Ze=zt,Yr=0,Fn=yt;Yr<Fn.length;Yr+=1){var Nn=Be.points[Fn[Yr]];Nn.zoom>ve&&(Ze+=Nn.numPoints||1)}if(Ze>=Qe){for(var qr=Me.x*zt,li=Me.y*zt,zn=Xe&&zt>1?this._map(Me,!0):null,jn=(Fe<<5)+(ve+1)+this.points.length,Ca=0,ni=yt;Ca<ni.length;Ca+=1){var za=Be.points[ni[Ca]];if(!(za.zoom<=ve)){za.zoom=ve;var Ao=za.numPoints||1;qr+=za.x*Ao,li+=za.y*Ao,za.parentId=jn,Xe&&(zn||(zn=this._map(Me,!0)),Xe(zn,this._map(za)))}}Me.parentId=jn,Ae.push(Ka(qr/Ze,li/Ze,jn,Ze,zn))}else if(Ae.push(Me),Ze>1)for(var io=0,ys=yt;io<ys.length;io+=1){var oo=Be.points[ys[io]];oo.zoom<=ve||(oo.zoom=ve,Ae.push(oo))}}}return Ae},pi.prototype._getOriginId=function(se){return se-this.points.length>>5},pi.prototype._getOriginZoom=function(se){return(se-this.points.length)%32},pi.prototype._map=function(se,ve){if(se.numPoints)return ve?qo({},se.properties):se.properties;var Ae=this.points[se.index].properties,Re=this.options.map(Ae);return ve&&Re===Ae?qo({},Re):Re},zo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zo.prototype.splitTile=function(se,ve,Ae,Re,Xe,Qe,Ye){for(var Fe=[se,ve,Ae,Re],Me=this.options,Be=Me.debug;Fe.length;){Re=Fe.pop(),Ae=Fe.pop(),ve=Fe.pop(),se=Fe.pop();var yt=1<<ve,zt=ya(ve,Ae,Re),Ze=this.tiles[zt];if(!Ze&&(Be>1&&console.time("creation"),Ze=this.tiles[zt]=Xn(se,ve,Ae,Re,Me),this.tileCoords.push({z:ve,x:Ae,y:Re}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,Ae,Re,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var Yr="z"+ve;this.stats[Yr]=(this.stats[Yr]||0)+1,this.total++}if(Ze.source=se,Xe){if(ve===Me.maxZoom||ve===Xe)continue;var Fn=1<<Xe-ve;if(Ae!==Math.floor(Qe/Fn)||Re!==Math.floor(Ye/Fn))continue}else if(ve===Me.indexMaxZoom||Ze.numPoints<=Me.indexMaxPoints)continue;if(Ze.source=null,se.length!==0){Be>1&&console.time("clipping");var Nn,qr,li,zn,jn,Ca,ni=.5*Me.buffer/Me.extent,za=.5-ni,Ao=.5+ni,io=1+ni;Nn=qr=li=zn=null,jn=Qt(se,yt,Ae-ni,Ae+Ao,0,Ze.minX,Ze.maxX,Me),Ca=Qt(se,yt,Ae+za,Ae+io,0,Ze.minX,Ze.maxX,Me),se=null,jn&&(Nn=Qt(jn,yt,Re-ni,Re+Ao,1,Ze.minY,Ze.maxY,Me),qr=Qt(jn,yt,Re+za,Re+io,1,Ze.minY,Ze.maxY,Me),jn=null),Ca&&(li=Qt(Ca,yt,Re-ni,Re+Ao,1,Ze.minY,Ze.maxY,Me),zn=Qt(Ca,yt,Re+za,Re+io,1,Ze.minY,Ze.maxY,Me),Ca=null),Be>1&&console.timeEnd("clipping"),Fe.push(Nn||[],ve+1,2*Ae,2*Re),Fe.push(qr||[],ve+1,2*Ae,2*Re+1),Fe.push(li||[],ve+1,2*Ae+1,2*Re),Fe.push(zn||[],ve+1,2*Ae+1,2*Re+1)}}},zo.prototype.getTile=function(se,ve,Ae){var Re=this.options,Xe=Re.extent,Qe=Re.debug;if(se<0||se>24)return null;var Ye=1<<se,Fe=ya(se,ve=(ve%Ye+Ye)%Ye,Ae);if(this.tiles[Fe])return ea(this.tiles[Fe],Xe);Qe>1&&console.log("drilling down to z%d-%d-%d",se,ve,Ae);for(var Me,Be=se,yt=ve,zt=Ae;!Me&&Be>0;)Be--,yt=Math.floor(yt/2),zt=Math.floor(zt/2),Me=this.tiles[ya(Be,yt,zt)];return Me&&Me.source?(Qe>1&&console.log("found parent tile z%d-%d-%d",Be,yt,zt),Qe>1&&console.time("drilling down"),this.splitTile(Me.source,Be,yt,zt,se,ve,Ae),Qe>1&&console.timeEnd("drilling down"),this.tiles[Fe]?ea(this.tiles[Fe],Xe):null):null};var Wt=function(se){function ve(Ae,Re,Xe,Qe){se.call(this,Ae,Re,Xe,Xu),Qe&&(this.loadGeoJSON=Qe)}return se&&(ve.__proto__=se),(ve.prototype=Object.create(se&&se.prototype)).constructor=ve,ve.prototype.loadData=function(Ae,Re){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Re,this._pendingLoadDataParams=Ae,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ve.prototype._loadData=function(){var Ae=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Re=this._pendingCallback,Xe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Qe=!!(Xe&&Xe.request&&Xe.request.collectResourceTiming)&&new P.RequestPerformance(Xe.request);this.loadGeoJSON(Xe,function(Ye,Fe){if(Ye||!Fe)return Re(Ye);if(typeof Fe!="object")return Re(new Error("Input data given to '"+Xe.source+"' is not a valid GeoJSON object."));(function Ze(Yr,Fn){var Nn,qr=Yr&&Yr.type;if(qr==="FeatureCollection")for(Nn=0;Nn<Yr.features.length;Nn++)Ze(Yr.features[Nn],Fn);else if(qr==="GeometryCollection")for(Nn=0;Nn<Yr.geometries.length;Nn++)Ze(Yr.geometries[Nn],Fn);else if(qr==="Feature")Ze(Yr.geometry,Fn);else if(qr==="Polygon")Ct(Yr.coordinates,Fn);else if(qr==="MultiPolygon")for(Nn=0;Nn<Yr.coordinates.length;Nn++)Ct(Yr.coordinates[Nn],Fn);return Yr})(Fe,!0);try{if(Xe.filter){var Me=P.createExpression(Xe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Me.result==="error")throw new Error(Me.value.map(function(Ze){return Ze.key+": "+Ze.message}).join(", "));var Be=Fe.features.filter(function(Ze){return Me.value.evaluate({zoom:0},Ze)});Fe={type:"FeatureCollection",features:Be}}Ae._geoJSONIndex=Xe.cluster?new pi(function(Ze){var Yr=Ze.superclusterOptions,Fn=Ze.clusterProperties;if(!Fn||!Yr)return Yr;for(var Nn={},qr={},li={accumulated:null,zoom:0},zn={properties:null},jn=Object.keys(Fn),Ca=0,ni=jn;Ca<ni.length;Ca+=1){var za=ni[Ca],Ao=Fn[za],io=Ao[0],ys=P.createExpression(Ao[1]),oo=P.createExpression(typeof io=="string"?[io,["accumulated"],["get",za]]:io);Nn[za]=ys.value,qr[za]=oo.value}return Yr.map=function(el){zn.properties=el;for(var Qs={},vo=0,as=jn;vo<as.length;vo+=1){var To=as[vo];Qs[To]=Nn[To].evaluate(li,zn)}return Qs},Yr.reduce=function(el,Qs){zn.properties=Qs;for(var vo=0,as=jn;vo<as.length;vo+=1){var To=as[vo];li.accumulated=el[To],el[To]=qr[To].evaluate(li,zn)}},Yr}(Xe)).load(Fe.features):function(Ze,Yr){return new zo(Ze,Yr)}(Fe,Xe.geojsonVtOptions)}catch(Ze){return Re(Ze)}Ae.loaded={};var yt={};if(Qe){var zt=Qe.finish();zt&&(yt.resourceTiming={},yt.resourceTiming[Xe.source]=JSON.parse(JSON.stringify(zt)))}Re(null,yt)})}},ve.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ve.prototype.reloadTile=function(Ae,Re){var Xe=this.loaded;return Xe&&Xe[Ae.uid]?se.prototype.reloadTile.call(this,Ae,Re):this.loadTile(Ae,Re)},ve.prototype.loadGeoJSON=function(Ae,Re){if(Ae.request)P.getJSON(Ae.request,Re);else{if(typeof Ae.data!="string")return Re(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));try{return Re(null,JSON.parse(Ae.data))}catch(Xe){return Re(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."))}}},ve.prototype.removeSource=function(Ae,Re){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Re()},ve.prototype.getClusterExpansionZoom=function(Ae,Re){try{Re(null,this._geoJSONIndex.getClusterExpansionZoom(Ae.clusterId))}catch(Xe){Re(Xe)}},ve.prototype.getClusterChildren=function(Ae,Re){try{Re(null,this._geoJSONIndex.getChildren(Ae.clusterId))}catch(Xe){Re(Xe)}},ve.prototype.getClusterLeaves=function(Ae,Re){try{Re(null,this._geoJSONIndex.getLeaves(Ae.clusterId,Ae.limit,Ae.offset))}catch(Xe){Re(Xe)}},ve}(rt),qe=function(se){var ve=this;this.self=se,this.actor=new P.Actor(se,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rt,geojson:Wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Ae,Re){if(ve.workerSourceTypes[Ae])throw new Error('Worker source with name "'+Ae+'" already registered.');ve.workerSourceTypes[Ae]=Re},this.self.registerRTLTextPlugin=function(Ae){if(P.plugin.isParsed())throw new Error("RTL text plugin already registered.");P.plugin.applyArabicShaping=Ae.applyArabicShaping,P.plugin.processBidirectionalText=Ae.processBidirectionalText,P.plugin.processStyledBidirectionalText=Ae.processStyledBidirectionalText}};return qe.prototype.setReferrer=function(se,ve){this.referrer=ve},qe.prototype.setImages=function(se,ve,Ae){for(var Re in this.availableImages[se]=ve,this.workerSources[se]){var Xe=this.workerSources[se][Re];for(var Qe in Xe)Xe[Qe].availableImages=ve}Ae()},qe.prototype.setLayers=function(se,ve,Ae){this.getLayerIndex(se).replace(ve),Ae()},qe.prototype.updateLayers=function(se,ve,Ae){this.getLayerIndex(se).update(ve.layers,ve.removedIds),Ae()},qe.prototype.loadTile=function(se,ve,Ae){this.getWorkerSource(se,ve.type,ve.source).loadTile(ve,Ae)},qe.prototype.loadDEMTile=function(se,ve,Ae){this.getDEMWorkerSource(se,ve.source).loadTile(ve,Ae)},qe.prototype.reloadTile=function(se,ve,Ae){this.getWorkerSource(se,ve.type,ve.source).reloadTile(ve,Ae)},qe.prototype.abortTile=function(se,ve,Ae){this.getWorkerSource(se,ve.type,ve.source).abortTile(ve,Ae)},qe.prototype.removeTile=function(se,ve,Ae){this.getWorkerSource(se,ve.type,ve.source).removeTile(ve,Ae)},qe.prototype.removeDEMTile=function(se,ve){this.getDEMWorkerSource(se,ve.source).removeTile(ve)},qe.prototype.removeSource=function(se,ve,Ae){if(this.workerSources[se]&&this.workerSources[se][ve.type]&&this.workerSources[se][ve.type][ve.source]){var Re=this.workerSources[se][ve.type][ve.source];delete this.workerSources[se][ve.type][ve.source],Re.removeSource!==void 0?Re.removeSource(ve,Ae):Ae()}},qe.prototype.loadWorkerSource=function(se,ve,Ae){try{this.self.importScripts(ve.url),Ae()}catch(Re){Ae(Re.toString())}},qe.prototype.syncRTLPluginState=function(se,ve,Ae){try{P.plugin.setState(ve);var Re=P.plugin.getPluginURL();if(P.plugin.isLoaded()&&!P.plugin.isParsed()&&Re!=null){this.self.importScripts(Re);var Xe=P.plugin.isParsed();Ae(Xe?void 0:new Error("RTL Text Plugin failed to import scripts from "+Re),Xe)}}catch(Qe){Ae(Qe.toString())}},qe.prototype.getAvailableImages=function(se){var ve=this.availableImages[se];return ve||(ve=[]),ve},qe.prototype.getLayerIndex=function(se){var ve=this.layerIndexes[se];return ve||(ve=this.layerIndexes[se]=new te),ve},qe.prototype.getWorkerSource=function(se,ve,Ae){var Re=this;return this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][ve]||(this.workerSources[se][ve]={}),this.workerSources[se][ve][Ae]||(this.workerSources[se][ve][Ae]=new this.workerSourceTypes[ve]({send:function(Xe,Qe,Ye){Re.actor.send(Xe,Qe,Ye,se)}},this.getLayerIndex(se),this.getAvailableImages(se))),this.workerSources[se][ve][Ae]},qe.prototype.getDEMWorkerSource=function(se,ve){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][ve]||(this.demWorkerSources[se][ve]=new nt),this.demWorkerSources[se][ve]},qe.prototype.enforceCacheSizeLimit=function(se,ve){P.enforceCacheSizeLimit(ve)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new qe(self)),qe}),j(["./shared"],function(P){"use strict";var M=P.createCommonjsModule(function(m){function w(N){return!_(N)}function _(N){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var X,oe,xe=new Blob([""],{type:"text/javascript"}),ye=URL.createObjectURL(xe);try{oe=new Worker(ye),X=!0}catch(De){X=!1}return oe&&oe.terminate(),URL.revokeObjectURL(ye),X}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var X=document.createElement("canvas");X.width=X.height=1;var oe=X.getContext("2d");if(!oe)return!1;var xe=oe.getImageData(0,0,1,1);return xe&&xe.width===X.width}()?(T[$=N&&N.failIfMajorPerformanceCaveat]===void 0&&(T[$]=function(X){var oe=function(ye){var De=document.createElement("canvas"),He=Object.create(w.webGLContextAttributes);return He.failIfMajorPerformanceCaveat=ye,De.probablySupportsContext?De.probablySupportsContext("webgl",He)||De.probablySupportsContext("experimental-webgl",He):De.supportsContext?De.supportsContext("webgl",He)||De.supportsContext("experimental-webgl",He):De.getContext("webgl",He)||De.getContext("experimental-webgl",He)}(X);if(!oe)return!1;var xe=oe.createShader(oe.VERTEX_SHADER);return!(!xe||oe.isContextLost())&&(oe.shaderSource(xe,"void main() {}"),oe.compileShader(xe),oe.getShaderParameter(xe,oe.COMPILE_STATUS)===!0)}($)),T[$]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var $}m.exports?m.exports=w:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=w,window.mapboxgl.notSupportedReason=_);var T={};w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),ee={create:function(m,w,_){var T=P.window.document.createElement(m);return w!==void 0&&(T.className=w),_&&_.appendChild(T),T},createNS:function(m,w){return P.window.document.createElementNS(m,w)}},te=P.window.document&&P.window.document.documentElement.style;function pe(m){if(!te)return m[0];for(var w=0;w<m.length;w++)if(m[w]in te)return m[w];return m[0]}var Ce,le=pe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);ee.disableDrag=function(){te&&le&&(Ce=te[le],te[le]="none")},ee.enableDrag=function(){te&&le&&(te[le]=Ce)};var Ie=pe(["transform","WebkitTransform"]);ee.setTransform=function(m,w){m.style[Ie]=w};var rt=!1;try{var xt=Object.defineProperty({},"passive",{get:function(){rt=!0}});P.window.addEventListener("test",xt,xt),P.window.removeEventListener("test",xt,xt)}catch(m){rt=!1}ee.addEventListener=function(m,w,_,T){T===void 0&&(T={}),m.addEventListener(w,_,"passive"in T&&rt?T:T.capture)},ee.removeEventListener=function(m,w,_,T){T===void 0&&(T={}),m.removeEventListener(w,_,"passive"in T&&rt?T:T.capture)};var nt=function(m){m.preventDefault(),m.stopPropagation(),P.window.removeEventListener("click",nt,!0)};function Ct(m){var w=m.userImage;return!!(w&&w.render&&w.render())&&(m.data.replace(new Uint8Array(w.data.buffer)),!0)}ee.suppressClick=function(){P.window.addEventListener("click",nt,!0),P.window.setTimeout(function(){P.window.removeEventListener("click",nt,!0)},0)},ee.mousePos=function(m,w){var _=m.getBoundingClientRect();return new P.Point(w.clientX-_.left-m.clientLeft,w.clientY-_.top-m.clientTop)},ee.touchPos=function(m,w){for(var _=m.getBoundingClientRect(),T=[],N=0;N<w.length;N++)T.push(new P.Point(w[N].clientX-_.left-m.clientLeft,w[N].clientY-_.top-m.clientTop));return T},ee.mouseButton=function(m){return P.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&P.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button},ee.remove=function(m){m.parentNode&&m.parentNode.removeChild(m)};var jt=function(m){function w(){m.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new P.RGBAImage({width:1,height:1}),this.dirty=!0}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.isLoaded=function(){return this.loaded},w.prototype.setLoaded=function(_){if(this.loaded!==_&&(this.loaded=_,_)){for(var T=0,N=this.requestors;T<N.length;T+=1){var $=N[T];this._notify($.ids,$.callback)}this.requestors=[]}},w.prototype.getImage=function(_){return this.images[_]},w.prototype.addImage=function(_,T){this._validate(_,T)&&(this.images[_]=T)},w.prototype._validate=function(_,T){var N=!0;return this._validateStretch(T.stretchX,T.data&&T.data.width)||(this.fire(new P.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchX" value'))),N=!1),this._validateStretch(T.stretchY,T.data&&T.data.height)||(this.fire(new P.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchY" value'))),N=!1),this._validateContent(T.content,T)||(this.fire(new P.ErrorEvent(new Error('Image "'+_+'" has invalid "content" value'))),N=!1),N},w.prototype._validateStretch=function(_,T){if(!_)return!0;for(var N=0,$=0,X=_;$<X.length;$+=1){var oe=X[$];if(oe[0]<N||oe[1]<oe[0]||T<oe[1])return!1;N=oe[1]}return!0},w.prototype._validateContent=function(_,T){return!(_&&(_.length!==4||_[0]<0||T.data.width<_[0]||_[1]<0||T.data.height<_[1]||_[2]<0||T.data.width<_[2]||_[3]<0||T.data.height<_[3]||_[2]<_[0]||_[3]<_[1]))},w.prototype.updateImage=function(_,T){T.version=this.images[_].version+1,this.images[_]=T,this.updatedImages[_]=!0},w.prototype.removeImage=function(_){var T=this.images[_];delete this.images[_],delete this.patterns[_],T.userImage&&T.userImage.onRemove&&T.userImage.onRemove()},w.prototype.listImages=function(){return Object.keys(this.images)},w.prototype.getImages=function(_,T){var N=!0;if(!this.isLoaded())for(var $=0,X=_;$<X.length;$+=1)this.images[X[$]]||(N=!1);this.isLoaded()||N?this._notify(_,T):this.requestors.push({ids:_,callback:T})},w.prototype._notify=function(_,T){for(var N={},$=0,X=_;$<X.length;$+=1){var oe=X[$];this.images[oe]||this.fire(new P.Event("styleimagemissing",{id:oe}));var xe=this.images[oe];xe?N[oe]={data:xe.data.clone(),pixelRatio:xe.pixelRatio,sdf:xe.sdf,version:xe.version,stretchX:xe.stretchX,stretchY:xe.stretchY,content:xe.content,hasRenderCallback:!!(xe.userImage&&xe.userImage.render)}:P.warnOnce('Image "'+oe+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}T(null,N)},w.prototype.getPixelSize=function(){var _=this.atlasImage;return{width:_.width,height:_.height}},w.prototype.getPattern=function(_){var T=this.patterns[_],N=this.getImage(_);if(!N)return null;if(T&&T.position.version===N.version)return T.position;if(T)T.position.version=N.version;else{var $={w:N.data.width+2,h:N.data.height+2,x:0,y:0},X=new P.ImagePosition($,N);this.patterns[_]={bin:$,position:X}}return this._updatePatternAtlas(),this.patterns[_].position},w.prototype.bind=function(_){var T=_.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new P.Texture(_,this.atlasImage,T.RGBA),this.atlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE)},w.prototype._updatePatternAtlas=function(){var _=[];for(var T in this.patterns)_.push(this.patterns[T].bin);var N=P.potpack(_),$=N.w,X=N.h,oe=this.atlasImage;for(var xe in oe.resize({width:$||1,height:X||1}),this.patterns){var ye=this.patterns[xe].bin,De=ye.x+1,He=ye.y+1,$e=this.images[xe].data,ft=$e.width,pt=$e.height;P.RGBAImage.copy($e,oe,{x:0,y:0},{x:De,y:He},{width:ft,height:pt}),P.RGBAImage.copy($e,oe,{x:0,y:pt-1},{x:De,y:He-1},{width:ft,height:1}),P.RGBAImage.copy($e,oe,{x:0,y:0},{x:De,y:He+pt},{width:ft,height:1}),P.RGBAImage.copy($e,oe,{x:ft-1,y:0},{x:De-1,y:He},{width:1,height:pt}),P.RGBAImage.copy($e,oe,{x:0,y:0},{x:De+ft,y:He},{width:1,height:pt})}this.dirty=!0},w.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},w.prototype.dispatchRenderCallbacks=function(_){for(var T=0,N=_;T<N.length;T+=1){var $=N[T];if(!this.callbackDispatchedThisFrame[$]){this.callbackDispatchedThisFrame[$]=!0;var X=this.images[$];Ct(X)&&this.updateImage($,X)}}},w}(P.Evented),Vt=er,Rt=er,hr=1e20;function er(m,w,_,T,N,$){this.fontSize=m||24,this.buffer=w===void 0?3:w,this.cutoff=T||.25,this.fontFamily=N||"sans-serif",this.fontWeight=$||"normal",this.radius=_||8;var X=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=X,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(X*X),this.gridInner=new Float64Array(X*X),this.f=new Float64Array(X),this.d=new Float64Array(X),this.z=new Float64Array(X+1),this.v=new Int16Array(X),this.middle=Math.round(X/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function gn(m,w,_,T,N,$,X){for(var oe=0;oe<w;oe++){for(var xe=0;xe<_;xe++)T[xe]=m[xe*w+oe];for(Rr(T,N,$,X,_),xe=0;xe<_;xe++)m[xe*w+oe]=N[xe]}for(xe=0;xe<_;xe++){for(oe=0;oe<w;oe++)T[oe]=m[xe*w+oe];for(Rr(T,N,$,X,w),oe=0;oe<w;oe++)m[xe*w+oe]=Math.sqrt(N[oe])}}function Rr(m,w,_,T,N){_[0]=0,T[0]=-hr,T[1]=+hr;for(var $=1,X=0;$<N;$++){for(var oe=(m[$]+$*$-(m[_[X]]+_[X]*_[X]))/(2*$-2*_[X]);oe<=T[X];)X--,oe=(m[$]+$*$-(m[_[X]]+_[X]*_[X]))/(2*$-2*_[X]);_[++X]=$,T[X]=oe,T[X+1]=+hr}for($=0,X=0;$<N;$++){for(;T[X+1]<$;)X++;w[$]=($-_[X])*($-_[X])+m[_[X]]}}er.prototype.draw=function(m){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(m,this.buffer,this.middle);for(var w=this.ctx.getImageData(0,0,this.size,this.size),_=new Uint8ClampedArray(this.size*this.size),T=0;T<this.size*this.size;T++){var N=w.data[4*T+3]/255;this.gridOuter[T]=N===1?0:N===0?hr:Math.pow(Math.max(0,.5-N),2),this.gridInner[T]=N===1?hr:N===0?0:Math.pow(Math.max(0,N-.5),2)}for(gn(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),gn(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),T=0;T<this.size*this.size;T++)_[T]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[T]-this.gridInner[T])/this.radius+this.cutoff))));return _},Vt.default=Rt;var vn=function(m,w){this.requestManager=m,this.localIdeographFontFamily=w,this.entries={}};vn.prototype.setURL=function(m){this.url=m},vn.prototype.getGlyphs=function(m,w){var _=this,T=[];for(var N in m)for(var $=0,X=m[N];$<X.length;$+=1)T.push({stack:N,id:X[$]});P.asyncAll(T,function(oe,xe){var ye=oe.stack,De=oe.id,He=_.entries[ye];He||(He=_.entries[ye]={glyphs:{},requests:{},ranges:{}});var $e=He.glyphs[De];if($e===void 0){if($e=_._tinySDF(He,ye,De))return He.glyphs[De]=$e,void xe(null,{stack:ye,id:De,glyph:$e});var ft=Math.floor(De/256);if(256*ft>65535)xe(new Error("glyphs > 65535 not supported"));else if(He.ranges[ft])xe(null,{stack:ye,id:De,glyph:$e});else{var pt=He.requests[ft];pt||(pt=He.requests[ft]=[],vn.loadGlyphRange(ye,ft,_.url,_.requestManager,function(wt,dt){if(dt){for(var Ft in dt)_._doesCharSupportLocalGlyph(+Ft)||(He.glyphs[+Ft]=dt[+Ft]);He.ranges[ft]=!0}for(var ar=0,nr=pt;ar<nr.length;ar+=1)(0,nr[ar])(wt,dt);delete He.requests[ft]})),pt.push(function(wt,dt){wt?xe(wt):dt&&xe(null,{stack:ye,id:De,glyph:dt[De]||null})})}}else xe(null,{stack:ye,id:De,glyph:$e})},function(oe,xe){if(oe)w(oe);else if(xe){for(var ye={},De=0,He=xe;De<He.length;De+=1){var $e=He[De],ft=$e.stack,pt=$e.id,wt=$e.glyph;(ye[ft]||(ye[ft]={}))[pt]=wt&&{id:wt.id,bitmap:wt.bitmap.clone(),metrics:wt.metrics}}w(null,ye)}})},vn.prototype._doesCharSupportLocalGlyph=function(m){return!!this.localIdeographFontFamily&&(P.isChar["CJK Unified Ideographs"](m)||P.isChar["Hangul Syllables"](m)||P.isChar.Hiragana(m)||P.isChar.Katakana(m))},vn.prototype._tinySDF=function(m,w,_){var T=this.localIdeographFontFamily;if(T&&this._doesCharSupportLocalGlyph(_)){var N=m.tinySDF;if(!N){var $="400";/bold/i.test(w)?$="900":/medium/i.test(w)?$="500":/light/i.test(w)&&($="200"),N=m.tinySDF=new vn.TinySDF(24,3,8,.25,T,$)}return{id:_,bitmap:new P.AlphaImage({width:30,height:30},N.draw(String.fromCharCode(_))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},vn.loadGlyphRange=function(m,w,_,T,N){var $=256*w,X=$+255,oe=T.transformRequest(T.normalizeGlyphsURL(_).replace("{fontstack}",m).replace("{range}",$+"-"+X),P.ResourceType.Glyphs);P.getArrayBuffer(oe,function(xe,ye){if(xe)N(xe);else if(ye){for(var De={},He=0,$e=P.parseGlyphPBF(ye);He<$e.length;He+=1){var ft=$e[He];De[ft.id]=ft}N(null,De)}})},vn.TinySDF=Vt;var rr=function(){this.specification=P.styleSpec.light.position};rr.prototype.possiblyEvaluate=function(m,w){return P.sphericalToCartesian(m.expression.evaluate(w))},rr.prototype.interpolate=function(m,w,_){return{x:P.number(m.x,w.x,_),y:P.number(m.y,w.y,_),z:P.number(m.z,w.z,_)}};var Jt=new P.Properties({anchor:new P.DataConstantProperty(P.styleSpec.light.anchor),position:new rr,color:new P.DataConstantProperty(P.styleSpec.light.color),intensity:new P.DataConstantProperty(P.styleSpec.light.intensity)}),br=function(m){function w(_){m.call(this),this._transitionable=new P.Transitionable(Jt),this.setLight(_),this._transitioning=this._transitionable.untransitioned()}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getLight=function(){return this._transitionable.serialize()},w.prototype.setLight=function(_,T){if(T===void 0&&(T={}),!this._validate(P.validateLight,_,T))for(var N in _){var $=_[N];P.endsWith(N,"-transition")?this._transitionable.setTransition(N.slice(0,-11),$):this._transitionable.setValue(N,$)}},w.prototype.updateTransitions=function(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)},w.prototype.hasTransition=function(){return this._transitioning.hasTransition()},w.prototype.recalculate=function(_){this.properties=this._transitioning.possiblyEvaluate(_)},w.prototype._validate=function(_,T,N){return(!N||N.validate!==!1)&&P.emitValidationErrors(this,_.call(P.validateStyle,P.extend({value:T,style:{glyphs:!0,sprite:!0},styleSpec:P.styleSpec})))},w}(P.Evented),or=function(m,w){this.width=m,this.height=w,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};or.prototype.getDash=function(m,w){var _=m.join(",")+String(w);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(m,w)),this.dashEntry[_]},or.prototype.getDashRanges=function(m,w,_){var T=[],N=m.length%2==1?-m[m.length-1]*_:0,$=m[0]*_,X=!0;T.push({left:N,right:$,isDash:X,zeroLength:m[0]===0});for(var oe=m[0],xe=1;xe<m.length;xe++){var ye=m[xe];T.push({left:N=oe*_,right:$=(oe+=ye)*_,isDash:X=!X,zeroLength:ye===0})}return T},or.prototype.addRoundDash=function(m,w,_){for(var T=w/2,N=-_;N<=_;N++)for(var $=this.width*(this.nextRow+_+N),X=0,oe=m[X],xe=0;xe<this.width;xe++){xe/oe.right>1&&(oe=m[++X]);var ye=Math.abs(xe-oe.left),De=Math.abs(xe-oe.right),He=Math.min(ye,De),$e=void 0,ft=N/_*(T+1);if(oe.isDash){var pt=T-Math.abs(ft);$e=Math.sqrt(He*He+pt*pt)}else $e=T-Math.sqrt(He*He+ft*ft);this.data[$+xe]=Math.max(0,Math.min(255,$e+128))}},or.prototype.addRegularDash=function(m){for(var w=m.length-1;w>=0;--w){var _=m[w],T=m[w+1];_.zeroLength?m.splice(w,1):T&&T.isDash===_.isDash&&(T.left=_.left,m.splice(w,1))}var N=m[0],$=m[m.length-1];N.isDash===$.isDash&&(N.left=$.left-this.width,$.right=N.right+this.width);for(var X=this.width*this.nextRow,oe=0,xe=m[oe],ye=0;ye<this.width;ye++){ye/xe.right>1&&(xe=m[++oe]);var De=Math.abs(ye-xe.left),He=Math.abs(ye-xe.right),$e=Math.min(De,He);this.data[X+ye]=Math.max(0,Math.min(255,(xe.isDash?$e:-$e)+128))}},or.prototype.addDash=function(m,w){var _=w?7:0,T=2*_+1;if(this.nextRow+T>this.height)return P.warnOnce("LineAtlas out of space"),null;for(var N=0,$=0;$<m.length;$++)N+=m[$];if(N!==0){var X=this.width/N,oe=this.getDashRanges(m,this.width,X);w?this.addRoundDash(oe,X,_):this.addRegularDash(oe)}var xe={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:N};return this.nextRow+=T,this.dirty=!0,xe},or.prototype.bind=function(m){var w=m.gl;this.texture?(w.bindTexture(w.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,w.texSubImage2D(w.TEXTURE_2D,0,0,0,this.width,this.height,w.ALPHA,w.UNSIGNED_BYTE,this.data))):(this.texture=w.createTexture(),w.bindTexture(w.TEXTURE_2D,this.texture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_2D,0,w.ALPHA,this.width,this.height,0,w.ALPHA,w.UNSIGNED_BYTE,this.data))};var Br=function m(w,_){this.workerPool=w,this.actors=[],this.currentActor=0,this.id=P.uniqueId();for(var T=this.workerPool.acquire(this.id),N=0;N<T.length;N++){var $=new m.Actor(T[N],_,this.id);$.name="Worker "+N,this.actors.push($)}};function an(m,w,_){var T=function(N,$){if(N)return _(N);if($){var X=P.pick(P.extend($,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);$.vector_layers&&(X.vectorLayers=$.vector_layers,X.vectorLayerIds=X.vectorLayers.map(function(oe){return oe.id})),X.tiles=w.canonicalizeTileset(X,m.url),_(null,X)}};return m.url?P.getJSON(w.transformRequest(w.normalizeSourceURL(m.url),P.ResourceType.Source),T):P.browser.frame(function(){return T(null,m)})}Br.prototype.broadcast=function(m,w,_){P.asyncAll(this.actors,function(T,N){T.send(m,w,N)},_=_||function(){})},Br.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Br.prototype.remove=function(){this.actors.forEach(function(m){m.remove()}),this.actors=[],this.workerPool.release(this.id)},Br.Actor=P.Actor;var ot=function(m,w,_){this.bounds=P.LngLatBounds.convert(this.validateBounds(m)),this.minzoom=w||0,this.maxzoom=_||24};ot.prototype.validateBounds=function(m){return Array.isArray(m)&&m.length===4?[Math.max(-180,m[0]),Math.max(-90,m[1]),Math.min(180,m[2]),Math.min(90,m[3])]:[-180,-90,180,90]},ot.prototype.contains=function(m){var w=Math.pow(2,m.z),_=Math.floor(P.mercatorXfromLng(this.bounds.getWest())*w),T=Math.floor(P.mercatorYfromLat(this.bounds.getNorth())*w),N=Math.ceil(P.mercatorXfromLng(this.bounds.getEast())*w),$=Math.ceil(P.mercatorYfromLat(this.bounds.getSouth())*w);return m.x>=_&&m.x<N&&m.y>=T&&m.y<$};var Dt=function(m){function w(_,T,N,$){if(m.call(this),this.id=_,this.dispatcher=N,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,P.extend(this,P.pick(T,["url","scheme","tileSize","promoteId"])),this._options=P.extend({type:"vector"},T),this._collectResourceTiming=T.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent($)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new P.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(T,N){_._tileJSONRequest=null,_._loaded=!0,T?_.fire(new P.ErrorEvent(T)):N&&(P.extend(_,N),N.bounds&&(_.tileBounds=new ot(N.bounds,_.minzoom,_.maxzoom)),P.postTurnstileEvent(N.tiles,_.map._requestManager._customAccessToken),P.postMapLoadEvent(N.tiles,_.map._getMapId(),_.map._requestManager._skuToken,_.map._requestManager._customAccessToken),_.fire(new P.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new P.Event("data",{dataType:"source",sourceDataType:"content"})))})},w.prototype.loaded=function(){return this._loaded},w.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setSourceProperty=function(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},w.prototype.setTiles=function(_){var T=this;return this.setSourceProperty(function(){T._options.tiles=_}),this},w.prototype.setUrl=function(_){var T=this;return this.setSourceProperty(function(){T.url=_,T._options.url=_}),this},w.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},w.prototype.serialize=function(){return P.extend({},this._options)},w.prototype.loadTile=function(_,T){var N=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),$={request:this.map._requestManager.transformRequest(N,P.ResourceType.Tile),uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:P.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function X(oe,xe){return delete _.request,_.aborted?T(null):oe&&oe.status!==404?T(oe):(xe&&xe.resourceTiming&&(_.resourceTiming=xe.resourceTiming),this.map._refreshExpiredTiles&&xe&&_.setExpiryData(xe),_.loadVectorData(xe,this.map.painter),P.cacheEntryPossiblyAdded(this.dispatcher),T(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}$.request.collectResourceTiming=this._collectResourceTiming,_.actor&&_.state!=="expired"?_.state==="loading"?_.reloadCallback=T:_.request=_.actor.send("reloadTile",$,X.bind(this)):(_.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",$,X.bind(this)))},w.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id},void 0)},w.prototype.unloadTile=function(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id},void 0)},w.prototype.hasTransition=function(){return!1},w}(P.Evented),Ee=function(m){function w(_,T,N,$){m.call(this),this.id=_,this.dispatcher=N,this.setEventedParent($),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=P.extend({type:"raster"},T),P.extend(this,P.pick(T,["url","scheme","tileSize"]))}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new P.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(T,N){_._tileJSONRequest=null,_._loaded=!0,T?_.fire(new P.ErrorEvent(T)):N&&(P.extend(_,N),N.bounds&&(_.tileBounds=new ot(N.bounds,_.minzoom,_.maxzoom)),P.postTurnstileEvent(N.tiles),P.postMapLoadEvent(N.tiles,_.map._getMapId(),_.map._requestManager._skuToken),_.fire(new P.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new P.Event("data",{dataType:"source",sourceDataType:"content"})))})},w.prototype.loaded=function(){return this._loaded},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},w.prototype.serialize=function(){return P.extend({},this._options)},w.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},w.prototype.loadTile=function(_,T){var N=this,$=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);_.request=P.getImage(this.map._requestManager.transformRequest($,P.ResourceType.Tile),function(X,oe){if(delete _.request,_.aborted)_.state="unloaded",T(null);else if(X)_.state="errored",T(X);else if(oe){N.map._refreshExpiredTiles&&_.setExpiryData(oe),delete oe.cacheControl,delete oe.expires;var xe=N.map.painter.context,ye=xe.gl;_.texture=N.map.painter.getTileTexture(oe.width),_.texture?_.texture.update(oe,{useMipmap:!0}):(_.texture=new P.Texture(xe,oe,ye.RGBA,{useMipmap:!0}),_.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE,ye.LINEAR_MIPMAP_NEAREST),xe.extTextureFilterAnisotropic&&ye.texParameterf(ye.TEXTURE_2D,xe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,xe.extTextureFilterAnisotropicMax)),_.state="loaded",P.cacheEntryPossiblyAdded(N.dispatcher),T(null)}})},w.prototype.abortTile=function(_,T){_.request&&(_.request.cancel(),delete _.request),T()},w.prototype.unloadTile=function(_,T){_.texture&&this.map.painter.saveTileTexture(_.texture),T()},w.prototype.hasTransition=function(){return!1},w}(P.Evented),Bt=function(m){function w(_,T,N,$){m.call(this,_,T,N,$),this.type="raster-dem",this.maxzoom=22,this._options=P.extend({type:"raster-dem"},T),this.encoding=T.encoding||"mapbox"}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},w.prototype.loadTile=function(_,T){var N=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function $(X,oe){X&&(_.state="errored",T(X)),oe&&(_.dem=oe,_.needsHillshadePrepare=!0,_.state="loaded",T(null))}_.request=P.getImage(this.map._requestManager.transformRequest(N,P.ResourceType.Tile),function(X,oe){if(delete _.request,_.aborted)_.state="unloaded",T(null);else if(X)_.state="errored",T(X);else if(oe){this.map._refreshExpiredTiles&&_.setExpiryData(oe),delete oe.cacheControl,delete oe.expires;var xe=P.window.ImageBitmap&&oe instanceof P.window.ImageBitmap&&P.offscreenCanvasSupported()?oe:P.browser.getImageData(oe,1),ye={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:xe,encoding:this.encoding};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",ye,$.bind(this)))}}.bind(this)),_.neighboringTiles=this._getNeighboringTiles(_.tileID)},w.prototype._getNeighboringTiles=function(_){var T=_.canonical,N=Math.pow(2,T.z),$=(T.x-1+N)%N,X=T.x===0?_.wrap-1:_.wrap,oe=(T.x+1+N)%N,xe=T.x+1===N?_.wrap+1:_.wrap,ye={};return ye[new P.OverscaledTileID(_.overscaledZ,X,T.z,$,T.y).key]={backfilled:!1},ye[new P.OverscaledTileID(_.overscaledZ,xe,T.z,oe,T.y).key]={backfilled:!1},T.y>0&&(ye[new P.OverscaledTileID(_.overscaledZ,X,T.z,$,T.y-1).key]={backfilled:!1},ye[new P.OverscaledTileID(_.overscaledZ,_.wrap,T.z,T.x,T.y-1).key]={backfilled:!1},ye[new P.OverscaledTileID(_.overscaledZ,xe,T.z,oe,T.y-1).key]={backfilled:!1}),T.y+1<N&&(ye[new P.OverscaledTileID(_.overscaledZ,X,T.z,$,T.y+1).key]={backfilled:!1},ye[new P.OverscaledTileID(_.overscaledZ,_.wrap,T.z,T.x,T.y+1).key]={backfilled:!1},ye[new P.OverscaledTileID(_.overscaledZ,xe,T.z,oe,T.y+1).key]={backfilled:!1}),ye},w.prototype.unloadTile=function(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded",_.actor&&_.actor.send("removeDEMTile",{uid:_.uid,source:this.id})},w}(Ee),Ot=function(m){function w(_,T,N,$){m.call(this),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=N.getActor(),this.setEventedParent($),this._data=T.data,this._options=P.extend({},T),this._collectResourceTiming=T.collectResourceTiming,this._resourceTiming=[],T.maxzoom!==void 0&&(this.maxzoom=T.maxzoom),T.type&&(this.type=T.type),T.attribution&&(this.attribution=T.attribution),this.promoteId=T.promoteId;var X=P.EXTENT/this.tileSize;this.workerOptions=P.extend({source:this.id,cluster:T.cluster||!1,geojsonVtOptions:{buffer:(T.buffer!==void 0?T.buffer:128)*X,tolerance:(T.tolerance!==void 0?T.tolerance:.375)*X,extent:P.EXTENT,maxZoom:this.maxzoom,lineMetrics:T.lineMetrics||!1,generateId:T.generateId||!1},superclusterOptions:{maxZoom:T.clusterMaxZoom!==void 0?Math.min(T.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,T.clusterMinPoints||2),extent:P.EXTENT,radius:(T.clusterRadius||50)*X,log:!1,generateId:T.generateId||!1},clusterProperties:T.clusterProperties,filter:T.filter},T.workerOptions)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(){var _=this;this.fire(new P.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(T){if(T)_.fire(new P.ErrorEvent(T));else{var N={dataType:"source",sourceDataType:"metadata"};_._collectResourceTiming&&_._resourceTiming&&_._resourceTiming.length>0&&(N.resourceTiming=_._resourceTiming,_._resourceTiming=[]),_.fire(new P.Event("data",N))}})},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setData=function(_){var T=this;return this._data=_,this.fire(new P.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(N){if(N)T.fire(new P.ErrorEvent(N));else{var $={dataType:"source",sourceDataType:"content"};T._collectResourceTiming&&T._resourceTiming&&T._resourceTiming.length>0&&($.resourceTiming=T._resourceTiming,T._resourceTiming=[]),T.fire(new P.Event("data",$))}}),this},w.prototype.getClusterExpansionZoom=function(_,T){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},T),this},w.prototype.getClusterChildren=function(_,T){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},T),this},w.prototype.getClusterLeaves=function(_,T,N,$){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:T,offset:N},$),this},w.prototype._updateWorkerData=function(_){var T=this;this._loaded=!1;var N=P.extend({},this.workerOptions),$=this._data;typeof $=="string"?(N.request=this.map._requestManager.transformRequest(P.browser.resolveURL($),P.ResourceType.Source),N.request.collectResourceTiming=this._collectResourceTiming):N.data=JSON.stringify($),this.actor.send(this.type+".loadData",N,function(X,oe){T._removed||oe&&oe.abandoned||(T._loaded=!0,oe&&oe.resourceTiming&&oe.resourceTiming[T.id]&&(T._resourceTiming=oe.resourceTiming[T.id].slice(0)),T.actor.send(T.type+".coalesce",{source:N.source},null),_(X))})},w.prototype.loaded=function(){return this._loaded},w.prototype.loadTile=function(_,T){var N=this,$=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send($,{type:this.type,uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:P.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(X,oe){return delete _.request,_.unloadVectorData(),_.aborted?T(null):X?T(X):(_.loadVectorData(oe,N.map.painter,$==="reloadTile"),T(null))})},w.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0},w.prototype.unloadTile=function(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})},w.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},w.prototype.serialize=function(){return P.extend({},this._options,{type:this.type,data:this._data})},w.prototype.hasTransition=function(){return!1},w}(P.Evented),Pr=P.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Fr=function(m){function w(_,T,N,$){m.call(this),this.id=_,this.dispatcher=N,this.coordinates=T.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent($),this.options=T}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(_,T){var N=this;this._loaded=!1,this.fire(new P.Event("dataloading",{dataType:"source"})),this.url=this.options.url,P.getImage(this.map._requestManager.transformRequest(this.url,P.ResourceType.Image),function($,X){N._loaded=!0,$?N.fire(new P.ErrorEvent($)):X&&(N.image=X,_&&(N.coordinates=_),T&&T(),N._finishLoading())})},w.prototype.loaded=function(){return this._loaded},w.prototype.updateImage=function(_){var T=this;return this.image&&_.url?(this.options.url=_.url,this.load(_.coordinates,function(){T.texture=null}),this):this},w.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new P.Event("data",{dataType:"source",sourceDataType:"metadata"})))},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setCoordinates=function(_){var T=this;this.coordinates=_;var N=_.map(P.MercatorCoordinate.fromLngLat);this.tileID=function(X){for(var oe=1/0,xe=1/0,ye=-1/0,De=-1/0,He=0,$e=X;He<$e.length;He+=1){var ft=$e[He];oe=Math.min(oe,ft.x),xe=Math.min(xe,ft.y),ye=Math.max(ye,ft.x),De=Math.max(De,ft.y)}var pt=Math.max(ye-oe,De-xe),wt=Math.max(0,Math.floor(-Math.log(pt)/Math.LN2)),dt=Math.pow(2,wt);return new P.CanonicalTileID(wt,Math.floor((oe+ye)/2*dt),Math.floor((xe+De)/2*dt))}(N),this.minzoom=this.maxzoom=this.tileID.z;var $=N.map(function(X){return T.tileID.getTilePoint(X)._round()});return this._boundsArray=new P.StructArrayLayout4i8,this._boundsArray.emplaceBack($[0].x,$[0].y,0,0),this._boundsArray.emplaceBack($[1].x,$[1].y,P.EXTENT,0),this._boundsArray.emplaceBack($[3].x,$[3].y,0,P.EXTENT),this._boundsArray.emplaceBack($[2].x,$[2].y,P.EXTENT,P.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new P.Event("data",{dataType:"source",sourceDataType:"content"})),this},w.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var _=this.map.painter.context,T=_.gl;for(var N in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=P.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new P.Texture(_,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE)),this.tiles){var $=this.tiles[N];$.state!=="loaded"&&($.state="loaded",$.texture=this.texture)}}},w.prototype.loadTile=function(_,T){this.tileID&&this.tileID.equals(_.tileID.canonical)?(this.tiles[String(_.tileID.wrap)]=_,_.buckets={},T(null)):(_.state="errored",T(null))},w.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},w.prototype.hasTransition=function(){return!1},w}(P.Evented),Nr=function(m){function w(_,T,N,$){m.call(this,_,T,N,$),this.roundZoom=!0,this.type="video",this.options=T}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1;var T=this.options;this.urls=[];for(var N=0,$=T.urls;N<$.length;N+=1)this.urls.push(this.map._requestManager.transformRequest($[N],P.ResourceType.Source).url);P.getVideo(this.urls,function(X,oe){_._loaded=!0,X?_.fire(new P.ErrorEvent(X)):oe&&(_.video=oe,_.video.loop=!0,_.video.setAttribute("playsinline",""),_.video.addEventListener("playing",function(){_.map.triggerRepaint()}),_.map&&_.video.play(),_._finishLoading())})},w.prototype.pause=function(){this.video&&this.video.pause()},w.prototype.play=function(){this.video&&this.video.play()},w.prototype.seek=function(_){if(this.video){var T=this.video.seekable;_<T.start(0)||_>T.end(0)?this.fire(new P.ErrorEvent(new P.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+T.start(0)+" and "+T.end(0)+"-second mark."))):this.video.currentTime=_}},w.prototype.getVideo=function(){return this.video},w.prototype.onAdd=function(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},w.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var _=this.map.painter.context,T=_.gl;for(var N in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=P.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new P.Texture(_,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE)),this.tiles){var $=this.tiles[N];$.state!=="loaded"&&($.state="loaded",$.texture=this.texture)}}},w.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},w.prototype.hasTransition=function(){return this.video&&!this.video.paused},w}(Fr),hn=function(m){function w(_,T,N,$){m.call(this,_,T,N,$),T.coordinates?Array.isArray(T.coordinates)&&T.coordinates.length===4&&!T.coordinates.some(function(X){return!Array.isArray(X)||X.length!==2||X.some(function(oe){return typeof oe!="number"})})||this.fire(new P.ErrorEvent(new P.ValidationError("sources."+_,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new P.ErrorEvent(new P.ValidationError("sources."+_,null,'missing required property "coordinates"'))),T.animate&&typeof T.animate!="boolean"&&this.fire(new P.ErrorEvent(new P.ValidationError("sources."+_,null,'optional "animate" property must be a boolean value'))),T.canvas?typeof T.canvas=="string"||T.canvas instanceof P.window.HTMLCanvasElement||this.fire(new P.ErrorEvent(new P.ValidationError("sources."+_,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new P.ErrorEvent(new P.ValidationError("sources."+_,null,'missing required property "canvas"'))),this.options=T,this.animate=T.animate===void 0||T.animate}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof P.window.HTMLCanvasElement?this.options.canvas:P.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new P.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},w.prototype.getCanvas=function(){return this.canvas},w.prototype.onAdd=function(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()},w.prototype.onRemove=function(){this.pause()},w.prototype.prepare=function(){var _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var T=this.map.painter.context,N=T.gl;for(var $ in this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=P.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new P.Texture(T,this.canvas,N.RGBA,{premultiply:!0}),this.tiles){var X=this.tiles[$];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}}},w.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},w.prototype.hasTransition=function(){return this._playing},w.prototype._hasInvalidDimensions=function(){for(var _=0,T=[this.canvas.width,this.canvas.height];_<T.length;_+=1){var N=T[_];if(isNaN(N)||N<=0)return!0}return!1},w}(Fr),xn={vector:Dt,raster:Ee,"raster-dem":Bt,geojson:Ot,video:Nr,image:Fr,canvas:hn};function Ji(m,w){var _=P.identity([]);return P.translate(_,_,[1,1,0]),P.scale(_,_,[.5*m.width,.5*m.height,1]),P.multiply(_,_,m.calculatePosMatrix(w.toUnwrapped()))}function pi(m,w,_,T,N,$){var X=function(wt,dt,Ft){if(wt)for(var ar=0,nr=wt;ar<nr.length;ar+=1){var Ir=dt[nr[ar]];if(Ir&&Ir.source===Ft&&Ir.type==="fill-extrusion")return!0}else for(var _r in dt){var Qr=dt[_r];if(Qr.source===Ft&&Qr.type==="fill-extrusion")return!0}return!1}(N&&N.layers,w,m.id),oe=$.maxPitchScaleFactor(),xe=m.tilesIn(T,oe,X);xe.sort(Ka);for(var ye=[],De=0,He=xe;De<He.length;De+=1){var $e=He[De];ye.push({wrappedTileID:$e.tileID.wrapped().key,queryResults:$e.tile.queryRenderedFeatures(w,_,m._state,$e.queryGeometry,$e.cameraQueryGeometry,$e.scale,N,$,oe,Ji(m.transform,$e.tileID))})}var ft=function(wt){for(var dt={},Ft={},ar=0,nr=wt;ar<nr.length;ar+=1){var Ir=nr[ar],_r=Ir.queryResults,Qr=Ir.wrappedTileID,nn=Ft[Qr]=Ft[Qr]||{};for(var Ln in _r)for(var Mn=_r[Ln],yi=nn[Ln]=nn[Ln]||{},Ri=dt[Ln]=dt[Ln]||[],Qi=0,Vi=Mn;Qi<Vi.length;Qi+=1){var ao=Vi[Qi];yi[ao.featureIndex]||(yi[ao.featureIndex]=!0,Ri.push(ao))}}return dt}(ye);for(var pt in ft)ft[pt].forEach(function(wt){var dt=wt.feature,Ft=m.getFeatureState(dt.layer["source-layer"],dt.id);dt.source=dt.layer.source,dt.layer["source-layer"]&&(dt.sourceLayer=dt.layer["source-layer"]),dt.state=Ft});return ft}function Ka(m,w){var _=m.tileID,T=w.tileID;return _.overscaledZ-T.overscaledZ||_.canonical.y-T.canonical.y||_.wrap-T.wrap||_.canonical.x-T.canonical.x}var na=function(m,w){this.max=m,this.onRemove=w,this.reset()};na.prototype.reset=function(){for(var m in this.data)for(var w=0,_=this.data[m];w<_.length;w+=1){var T=_[w];T.timeout&&clearTimeout(T.timeout),this.onRemove(T.value)}return this.data={},this.order=[],this},na.prototype.add=function(m,w,_){var T=this,N=m.wrapped().key;this.data[N]===void 0&&(this.data[N]=[]);var $={value:w,timeout:void 0};if(_!==void 0&&($.timeout=setTimeout(function(){T.remove(m,$)},_)),this.data[N].push($),this.order.push(N),this.order.length>this.max){var X=this._getAndRemoveByKey(this.order[0]);X&&this.onRemove(X)}return this},na.prototype.has=function(m){return m.wrapped().key in this.data},na.prototype.getAndRemove=function(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null},na.prototype._getAndRemoveByKey=function(m){var w=this.data[m].shift();return w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),w.value},na.prototype.getByKey=function(m){var w=this.data[m];return w?w[0].value:null},na.prototype.get=function(m){return this.has(m)?this.data[m.wrapped().key][0].value:null},na.prototype.remove=function(m,w){if(!this.has(m))return this;var _=m.wrapped().key,T=w===void 0?0:this.data[_].indexOf(w),N=this.data[_][T];return this.data[_].splice(T,1),N.timeout&&clearTimeout(N.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(N.value),this.order.splice(this.order.indexOf(_),1),this},na.prototype.setMaxSize=function(m){for(this.max=m;this.order.length>this.max;){var w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this},na.prototype.filter=function(m){var w=[];for(var _ in this.data)for(var T=0,N=this.data[_];T<N.length;T+=1){var $=N[T];m($.value)||w.push($)}for(var X=0,oe=w;X<oe.length;X+=1){var xe=oe[X];this.remove(xe.value.tileID,xe)}};var ca=function(m,w,_){this.context=m;var T=m.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),m.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,w.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete w.arrayBuffer};ca.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ca.prototype.updateData=function(m){var w=this.context.gl;this.context.unbindVAO(),this.bind(),w.bufferSubData(w.ELEMENT_ARRAY_BUFFER,0,m.arrayBuffer)},ca.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var po={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},La=function(m,w,_,T){this.length=w.length,this.attributes=_,this.itemSize=w.bytesPerElement,this.dynamicDraw=T,this.context=m;var N=m.gl;this.buffer=N.createBuffer(),m.bindVertexBuffer.set(this.buffer),N.bufferData(N.ARRAY_BUFFER,w.arrayBuffer,this.dynamicDraw?N.DYNAMIC_DRAW:N.STATIC_DRAW),this.dynamicDraw||delete w.arrayBuffer};La.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},La.prototype.updateData=function(m){var w=this.context.gl;this.bind(),w.bufferSubData(w.ARRAY_BUFFER,0,m.arrayBuffer)},La.prototype.enableAttributes=function(m,w){for(var _=0;_<this.attributes.length;_++){var T=w.attributes[this.attributes[_].name];T!==void 0&&m.enableVertexAttribArray(T)}},La.prototype.setVertexAttribPointers=function(m,w,_){for(var T=0;T<this.attributes.length;T++){var N=this.attributes[T],$=w.attributes[N.name];$!==void 0&&m.vertexAttribPointer($,N.components,m[po[N.type]],!1,this.itemSize,N.offset+this.itemSize*(_||0))}},La.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var $i=function(m){this.gl=m.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};$i.prototype.get=function(){return this.current},$i.prototype.set=function(m){},$i.prototype.getDefault=function(){return this.default},$i.prototype.setDefault=function(){this.set(this.default)};var qo=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return P.Color.transparent},w.prototype.set=function(_){var T=this.current;(_.r!==T.r||_.g!==T.g||_.b!==T.b||_.a!==T.a||this.dirty)&&(this.gl.clearColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},w}($i),is=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return 1},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearDepth(_),this.current=_,this.dirty=!1)},w}($i),Ko=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return 0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearStencil(_),this.current=_,this.dirty=!1)},w}($i),Za=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return[!0,!0,!0,!0]},w.prototype.set=function(_){var T=this.current;(_[0]!==T[0]||_[1]!==T[1]||_[2]!==T[2]||_[3]!==T[3]||this.dirty)&&(this.gl.colorMask(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},w}($i),ha=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthMask(_),this.current=_,this.dirty=!1)},w}($i),Fo=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return 255},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.stencilMask(_),this.current=_,this.dirty=!1)},w}($i),un=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},w.prototype.set=function(_){var T=this.current;(_.func!==T.func||_.ref!==T.ref||_.mask!==T.mask||this.dirty)&&(this.gl.stencilFunc(_.func,_.ref,_.mask),this.current=_,this.dirty=!1)},w}($i),Ua=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[_.KEEP,_.KEEP,_.KEEP]},w.prototype.set=function(_){var T=this.current;(_[0]!==T[0]||_[1]!==T[1]||_[2]!==T[2]||this.dirty)&&(this.gl.stencilOp(_[0],_[1],_[2]),this.current=_,this.dirty=!1)},w}($i),zr=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;_?T.enable(T.STENCIL_TEST):T.disable(T.STENCIL_TEST),this.current=_,this.dirty=!1}},w}($i),be=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return[0,1]},w.prototype.set=function(_){var T=this.current;(_[0]!==T[0]||_[1]!==T[1]||this.dirty)&&(this.gl.depthRange(_[0],_[1]),this.current=_,this.dirty=!1)},w}($i),lt=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;_?T.enable(T.DEPTH_TEST):T.disable(T.DEPTH_TEST),this.current=_,this.dirty=!1}},w}($i),mt=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.LESS},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthFunc(_),this.current=_,this.dirty=!1)},w}($i),Qt=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;_?T.enable(T.BLEND):T.disable(T.BLEND),this.current=_,this.dirty=!1}},w}($i),xr=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[_.ONE,_.ZERO]},w.prototype.set=function(_){var T=this.current;(_[0]!==T[0]||_[1]!==T[1]||this.dirty)&&(this.gl.blendFunc(_[0],_[1]),this.current=_,this.dirty=!1)},w}($i),mn=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return P.Color.transparent},w.prototype.set=function(_){var T=this.current;(_.r!==T.r||_.g!==T.g||_.b!==T.b||_.a!==T.a||this.dirty)&&(this.gl.blendColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},w}($i),Wn=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.FUNC_ADD},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.blendEquation(_),this.current=_,this.dirty=!1)},w}($i),tr=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;_?T.enable(T.CULL_FACE):T.disable(T.CULL_FACE),this.current=_,this.dirty=!1}},w}($i),Hr=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.BACK},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.cullFace(_),this.current=_,this.dirty=!1)},w}($i),dr=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.CCW},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.frontFace(_),this.current=_,this.dirty=!1)},w}($i),Un=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)},w}($i),ti=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.TEXTURE0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.activeTexture(_),this.current=_,this.dirty=!1)},w}($i),Yi=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[0,0,_.drawingBufferWidth,_.drawingBufferHeight]},w.prototype.set=function(_){var T=this.current;(_[0]!==T[0]||_[1]!==T[1]||_[2]!==T[2]||_[3]!==T[3]||this.dirty)&&(this.gl.viewport(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},w}($i),ea=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.bindFramebuffer(T.FRAMEBUFFER,_),this.current=_,this.dirty=!1}},w}($i),on=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.bindRenderbuffer(T.RENDERBUFFER,_),this.current=_,this.dirty=!1}},w}($i),Xn=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.bindTexture(T.TEXTURE_2D,_),this.current=_,this.dirty=!1}},w}($i),Pi=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.bindBuffer(T.ARRAY_BUFFER,_),this.current=_,this.dirty=!1}},w}($i),Pa=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){var T=this.gl;T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,_),this.current=_,this.dirty=!1},w}($i),zo=function(m){function w(_){m.call(this,_),this.vao=_.extVertexArrayObject}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){this.vao&&(_!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(_),this.current=_,this.dirty=!1)},w}($i),ya=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return 4},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.pixelStorei(T.UNPACK_ALIGNMENT,_),this.current=_,this.dirty=!1}},w}($i),Xu=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),this.current=_,this.dirty=!1}},w}($i),Wt=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var T=this.gl;T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,_),this.current=_,this.dirty=!1}},w}($i),qe=function(m){function w(_,T){m.call(this,_),this.context=_,this.parent=T}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w}($i),se=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.setDirty=function(){this.dirty=!0},w.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var T=this.gl;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,_,0),this.current=_,this.dirty=!1}},w}(qe),ve=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var T=this.gl;T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.RENDERBUFFER,_),this.current=_,this.dirty=!1}},w}(qe),Ae=function(m,w,_,T){this.context=m,this.width=w,this.height=_;var N=this.framebuffer=m.gl.createFramebuffer();this.colorAttachment=new se(m,N),T&&(this.depthAttachment=new ve(m,N))};Ae.prototype.destroy=function(){var m=this.context.gl,w=this.colorAttachment.get();if(w&&m.deleteTexture(w),this.depthAttachment){var _=this.depthAttachment.get();_&&m.deleteRenderbuffer(_)}m.deleteFramebuffer(this.framebuffer)};var Re=function(m,w,_){this.func=m,this.mask=w,this.range=_};Re.ReadOnly=!1,Re.ReadWrite=!0,Re.disabled=new Re(519,Re.ReadOnly,[0,1]);var Xe=function(m,w,_,T,N,$){this.test=m,this.ref=w,this.mask=_,this.fail=T,this.depthFail=N,this.pass=$};Xe.disabled=new Xe({func:519,mask:0},0,0,7680,7680,7680);var Qe=function(m,w,_){this.blendFunction=m,this.blendColor=w,this.mask=_};Qe.disabled=new Qe(Qe.Replace=[1,0],P.Color.transparent,[!1,!1,!1,!1]),Qe.unblended=new Qe(Qe.Replace,P.Color.transparent,[!0,!0,!0,!0]),Qe.alphaBlended=new Qe([1,771],P.Color.transparent,[!0,!0,!0,!0]);var Ye=function(m,w,_){this.enable=m,this.mode=w,this.frontFace=_};Ye.disabled=new Ye(!1,1029,2305),Ye.backCCW=new Ye(!0,1029,2305);var Fe=function(m){this.gl=m,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qo(this),this.clearDepth=new is(this),this.clearStencil=new Ko(this),this.colorMask=new Za(this),this.depthMask=new ha(this),this.stencilMask=new Fo(this),this.stencilFunc=new un(this),this.stencilOp=new Ua(this),this.stencilTest=new zr(this),this.depthRange=new be(this),this.depthTest=new lt(this),this.depthFunc=new mt(this),this.blend=new Qt(this),this.blendFunc=new xr(this),this.blendColor=new mn(this),this.blendEquation=new Wn(this),this.cullFace=new tr(this),this.cullFaceSide=new Hr(this),this.frontFace=new dr(this),this.program=new Un(this),this.activeTexture=new ti(this),this.viewport=new Yi(this),this.bindFramebuffer=new ea(this),this.bindRenderbuffer=new on(this),this.bindTexture=new Xn(this),this.bindVertexBuffer=new Pi(this),this.bindElementBuffer=new Pa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new zo(this),this.pixelStoreUnpack=new ya(this),this.pixelStoreUnpackPremultiplyAlpha=new Xu(this),this.pixelStoreUnpackFlipY=new Wt(this),this.extTextureFilterAnisotropic=m.getExtension("EXT_texture_filter_anisotropic")||m.getExtension("MOZ_EXT_texture_filter_anisotropic")||m.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=m.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=m.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(m.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=m.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=m.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=m.getParameter(m.MAX_TEXTURE_SIZE)};Fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Fe.prototype.createIndexBuffer=function(m,w){return new ca(this,m,w)},Fe.prototype.createVertexBuffer=function(m,w,_){return new La(this,m,w,_)},Fe.prototype.createRenderbuffer=function(m,w,_){var T=this.gl,N=T.createRenderbuffer();return this.bindRenderbuffer.set(N),T.renderbufferStorage(T.RENDERBUFFER,m,w,_),this.bindRenderbuffer.set(null),N},Fe.prototype.createFramebuffer=function(m,w,_){return new Ae(this,m,w,_)},Fe.prototype.clear=function(m){var w=m.color,_=m.depth,T=this.gl,N=0;w&&(N|=T.COLOR_BUFFER_BIT,this.clearColor.set(w),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(N|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),T.clear(N)},Fe.prototype.setCullFace=function(m){m.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(m.mode),this.frontFace.set(m.frontFace))},Fe.prototype.setDepthMode=function(m){m.func!==this.gl.ALWAYS||m.mask?(this.depthTest.set(!0),this.depthFunc.set(m.func),this.depthMask.set(m.mask),this.depthRange.set(m.range)):this.depthTest.set(!1)},Fe.prototype.setStencilMode=function(m){m.test.func!==this.gl.ALWAYS||m.mask?(this.stencilTest.set(!0),this.stencilMask.set(m.mask),this.stencilOp.set([m.fail,m.depthFail,m.pass]),this.stencilFunc.set({func:m.test.func,ref:m.ref,mask:m.test.mask})):this.stencilTest.set(!1)},Fe.prototype.setColorMode=function(m){P.deepEqual(m.blendFunction,Qe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(m.blendFunction),this.blendColor.set(m.blendColor)),this.colorMask.set(m.mask)},Fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Me=function(m){function w(_,T,N){var $=this;m.call(this),this.id=_,this.dispatcher=N,this.on("data",function(X){X.dataType==="source"&&X.sourceDataType==="metadata"&&($._sourceLoaded=!0),$._sourceLoaded&&!$._paused&&X.dataType==="source"&&X.sourceDataType==="content"&&($.reload(),$.transform&&$.update($.transform))}),this.on("error",function(){$._sourceErrored=!0}),this._source=function(X,oe,xe,ye){var De=new xn[oe.type](X,oe,xe,ye);if(De.id!==X)throw new Error("Expected Source id to be "+X+" instead of "+De.id);return P.bindAll(["load","abort","unload","serialize","prepare"],De),De}(_,T,N,this),this._tiles={},this._cache=new na(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new P.SourceFeatureState}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.onAdd=function(_){this.map=_,this._maxTileCacheSize=_?_._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(_)},w.prototype.onRemove=function(_){this._source&&this._source.onRemove&&this._source.onRemove(_)},w.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var _ in this._tiles){var T=this._tiles[_];if(T.state!=="loaded"&&T.state!=="errored")return!1}return!0},w.prototype.getSource=function(){return this._source},w.prototype.pause=function(){this._paused=!0},w.prototype.resume=function(){if(this._paused){var _=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,_&&this.reload(),this.transform&&this.update(this.transform)}},w.prototype._loadTile=function(_,T){return this._source.loadTile(_,T)},w.prototype._unloadTile=function(_){if(this._source.unloadTile)return this._source.unloadTile(_,function(){})},w.prototype._abortTile=function(_){if(this._source.abortTile)return this._source.abortTile(_,function(){})},w.prototype.serialize=function(){return this._source.serialize()},w.prototype.prepare=function(_){for(var T in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var N=this._tiles[T];N.upload(_),N.prepare(this.map.style.imageManager)}},w.prototype.getIds=function(){return P.values(this._tiles).map(function(_){return _.tileID}).sort(Be).map(function(_){return _.key})},w.prototype.getRenderableIds=function(_){var T=this,N=[];for(var $ in this._tiles)this._isIdRenderable($,_)&&N.push(this._tiles[$]);return _?N.sort(function(X,oe){var xe=X.tileID,ye=oe.tileID,De=new P.Point(xe.canonical.x,xe.canonical.y)._rotate(T.transform.angle),He=new P.Point(ye.canonical.x,ye.canonical.y)._rotate(T.transform.angle);return xe.overscaledZ-ye.overscaledZ||He.y-De.y||He.x-De.x}).map(function(X){return X.tileID.key}):N.map(function(X){return X.tileID}).sort(Be).map(function(X){return X.key})},w.prototype.hasRenderableParent=function(_){var T=this.findLoadedParent(_,0);return!!T&&this._isIdRenderable(T.tileID.key)},w.prototype._isIdRenderable=function(_,T){return this._tiles[_]&&this._tiles[_].hasData()&&!this._coveredTiles[_]&&(T||!this._tiles[_].holdingForFade())},w.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var _ in this._cache.reset(),this._tiles)this._tiles[_].state!=="errored"&&this._reloadTile(_,"reloading")},w.prototype._reloadTile=function(_,T){var N=this._tiles[_];N&&(N.state!=="loading"&&(N.state=T),this._loadTile(N,this._tileLoaded.bind(this,N,_,T)))},w.prototype._tileLoaded=function(_,T,N,$){if($)return _.state="errored",void($.status!==404?this._source.fire(new P.ErrorEvent($,{tile:_})):this.update(this.transform));_.timeAdded=P.browser.now(),N==="expired"&&(_.refreshedUponExpiration=!0),this._setTileReloadTimer(T,_),this.getSource().type==="raster-dem"&&_.dem&&this._backfillDEM(_),this._state.initializeTileState(_,this.map?this.map.painter:null),this._source.fire(new P.Event("data",{dataType:"source",tile:_,coord:_.tileID}))},w.prototype._backfillDEM=function(_){for(var T=this.getRenderableIds(),N=0;N<T.length;N++){var $=T[N];if(_.neighboringTiles&&_.neighboringTiles[$]){var X=this.getTileByID($);oe(_,X),oe(X,_)}}function oe(xe,ye){xe.needsHillshadePrepare=!0;var De=ye.tileID.canonical.x-xe.tileID.canonical.x,He=ye.tileID.canonical.y-xe.tileID.canonical.y,$e=Math.pow(2,xe.tileID.canonical.z),ft=ye.tileID.key;De===0&&He===0||Math.abs(He)>1||(Math.abs(De)>1&&(Math.abs(De+$e)===1?De+=$e:Math.abs(De-$e)===1&&(De-=$e)),ye.dem&&xe.dem&&(xe.dem.backfillBorder(ye.dem,De,He),xe.neighboringTiles&&xe.neighboringTiles[ft]&&(xe.neighboringTiles[ft].backfilled=!0)))}},w.prototype.getTile=function(_){return this.getTileByID(_.key)},w.prototype.getTileByID=function(_){return this._tiles[_]},w.prototype._retainLoadedChildren=function(_,T,N,$){for(var X in this._tiles){var oe=this._tiles[X];if(!($[X]||!oe.hasData()||oe.tileID.overscaledZ<=T||oe.tileID.overscaledZ>N)){for(var xe=oe.tileID;oe&&oe.tileID.overscaledZ>T+1;){var ye=oe.tileID.scaledTo(oe.tileID.overscaledZ-1);(oe=this._tiles[ye.key])&&oe.hasData()&&(xe=ye)}for(var De=xe;De.overscaledZ>T;)if(_[(De=De.scaledTo(De.overscaledZ-1)).key]){$[xe.key]=xe;break}}}},w.prototype.findLoadedParent=function(_,T){if(_.key in this._loadedParentTiles){var N=this._loadedParentTiles[_.key];return N&&N.tileID.overscaledZ>=T?N:null}for(var $=_.overscaledZ-1;$>=T;$--){var X=_.scaledTo($),oe=this._getLoadedTile(X);if(oe)return oe}},w.prototype._getLoadedTile=function(_){var T=this._tiles[_.key];return T&&T.hasData()?T:this._cache.getByKey(_.wrapped().key)},w.prototype.updateCacheSize=function(_){var T=Math.ceil(_.width/this._source.tileSize)+1,N=Math.ceil(_.height/this._source.tileSize)+1,$=Math.floor(T*N*5),X=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,$):$;this._cache.setMaxSize(X)},w.prototype.handleWrapJump=function(_){var T=Math.round((_-(this._prevLng===void 0?_:this._prevLng))/360);if(this._prevLng=_,T){var N={};for(var $ in this._tiles){var X=this._tiles[$];X.tileID=X.tileID.unwrapTo(X.tileID.wrap+T),N[X.tileID.key]=X}for(var oe in this._tiles=N,this._timers)clearTimeout(this._timers[oe]),delete this._timers[oe];for(var xe in this._tiles)this._setTileReloadTimer(xe,this._tiles[xe])}},w.prototype.update=function(_){var T=this;if(this.transform=_,this._sourceLoaded&&!this._paused){var N;this.updateCacheSize(_),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?N=_.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(nn){return new P.OverscaledTileID(nn.canonical.z,nn.wrap,nn.canonical.z,nn.canonical.x,nn.canonical.y)}):(N=_.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(N=N.filter(function(nn){return T._source.hasTile(nn)}))):N=[];var $=_.coveringZoomLevel(this._source),X=Math.max($-w.maxOverzooming,this._source.minzoom),oe=Math.max($+w.maxUnderzooming,this._source.minzoom),xe=this._updateRetainedTiles(N,$);if(yt(this._source.type)){for(var ye={},De={},He=0,$e=Object.keys(xe);He<$e.length;He+=1){var ft=$e[He],pt=xe[ft],wt=this._tiles[ft];if(wt&&!(wt.fadeEndTime&&wt.fadeEndTime<=P.browser.now())){var dt=this.findLoadedParent(pt,X);dt&&(this._addTile(dt.tileID),ye[dt.tileID.key]=dt.tileID),De[ft]=pt}}for(var Ft in this._retainLoadedChildren(De,$,oe,xe),ye)xe[Ft]||(this._coveredTiles[Ft]=!0,xe[Ft]=ye[Ft])}for(var ar in xe)this._tiles[ar].clearFadeHold();for(var nr=0,Ir=P.keysDifference(this._tiles,xe);nr<Ir.length;nr+=1){var _r=Ir[nr],Qr=this._tiles[_r];Qr.hasSymbolBuckets&&!Qr.holdingForFade()?Qr.setHoldDuration(this.map._fadeDuration):Qr.hasSymbolBuckets&&!Qr.symbolFadeFinished()||this._removeTile(_r)}this._updateLoadedParentTileCache()}},w.prototype.releaseSymbolFadeTiles=function(){for(var _ in this._tiles)this._tiles[_].holdingForFade()&&this._removeTile(_)},w.prototype._updateRetainedTiles=function(_,T){for(var N={},$={},X=Math.max(T-w.maxOverzooming,this._source.minzoom),oe=Math.max(T+w.maxUnderzooming,this._source.minzoom),xe={},ye=0,De=_;ye<De.length;ye+=1){var He=De[ye],$e=this._addTile(He);N[He.key]=He,$e.hasData()||T<this._source.maxzoom&&(xe[He.key]=He)}this._retainLoadedChildren(xe,T,oe,N);for(var ft=0,pt=_;ft<pt.length;ft+=1){var wt=pt[ft],dt=this._tiles[wt.key];if(!dt.hasData()){if(T+1>this._source.maxzoom){var Ft=wt.children(this._source.maxzoom)[0],ar=this.getTile(Ft);if(ar&&ar.hasData()){N[Ft.key]=Ft;continue}}else{var nr=wt.children(this._source.maxzoom);if(N[nr[0].key]&&N[nr[1].key]&&N[nr[2].key]&&N[nr[3].key])continue}for(var Ir=dt.wasRequested(),_r=wt.overscaledZ-1;_r>=X;--_r){var Qr=wt.scaledTo(_r);if($[Qr.key]||($[Qr.key]=!0,!(dt=this.getTile(Qr))&&Ir&&(dt=this._addTile(Qr)),dt&&(N[Qr.key]=Qr,Ir=dt.wasRequested(),dt.hasData())))break}}}return N},w.prototype._updateLoadedParentTileCache=function(){for(var _ in this._loadedParentTiles={},this._tiles){for(var T=[],N=void 0,$=this._tiles[_].tileID;$.overscaledZ>0;){if($.key in this._loadedParentTiles){N=this._loadedParentTiles[$.key];break}T.push($.key);var X=$.scaledTo($.overscaledZ-1);if(N=this._getLoadedTile(X))break;$=X}for(var oe=0,xe=T;oe<xe.length;oe+=1)this._loadedParentTiles[xe[oe]]=N}},w.prototype._addTile=function(_){var T=this._tiles[_.key];if(T)return T;(T=this._cache.getAndRemove(_))&&(this._setTileReloadTimer(_.key,T),T.tileID=_,this._state.initializeTileState(T,this.map?this.map.painter:null),this._cacheTimers[_.key]&&(clearTimeout(this._cacheTimers[_.key]),delete this._cacheTimers[_.key],this._setTileReloadTimer(_.key,T)));var N=!!T;return N||(T=new P.Tile(_,this._source.tileSize*_.overscaleFactor()),this._loadTile(T,this._tileLoaded.bind(this,T,_.key,T.state))),T?(T.uses++,this._tiles[_.key]=T,N||this._source.fire(new P.Event("dataloading",{tile:T,coord:T.tileID,dataType:"source"})),T):null},w.prototype._setTileReloadTimer=function(_,T){var N=this;_ in this._timers&&(clearTimeout(this._timers[_]),delete this._timers[_]);var $=T.getExpiryTimeout();$&&(this._timers[_]=setTimeout(function(){N._reloadTile(_,"expired"),delete N._timers[_]},$))},w.prototype._removeTile=function(_){var T=this._tiles[_];T&&(T.uses--,delete this._tiles[_],this._timers[_]&&(clearTimeout(this._timers[_]),delete this._timers[_]),T.uses>0||(T.hasData()&&T.state!=="reloading"?this._cache.add(T.tileID,T,T.getExpiryTimeout()):(T.aborted=!0,this._abortTile(T),this._unloadTile(T))))},w.prototype.clearTiles=function(){for(var _ in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(_);this._cache.reset()},w.prototype.tilesIn=function(_,T,N){var $=this,X=[],oe=this.transform;if(!oe)return X;for(var xe=N?oe.getCameraQueryGeometry(_):_,ye=_.map(function(_r){return oe.pointCoordinate(_r)}),De=xe.map(function(_r){return oe.pointCoordinate(_r)}),He=this.getIds(),$e=1/0,ft=1/0,pt=-1/0,wt=-1/0,dt=0,Ft=De;dt<Ft.length;dt+=1){var ar=Ft[dt];$e=Math.min($e,ar.x),ft=Math.min(ft,ar.y),pt=Math.max(pt,ar.x),wt=Math.max(wt,ar.y)}for(var nr=function(_r){var Qr=$._tiles[He[_r]];if(!Qr.holdingForFade()){var nn=Qr.tileID,Ln=Math.pow(2,oe.zoom-Qr.tileID.overscaledZ),Mn=T*Qr.queryPadding*P.EXTENT/Qr.tileSize/Ln,yi=[nn.getTilePoint(new P.MercatorCoordinate($e,ft)),nn.getTilePoint(new P.MercatorCoordinate(pt,wt))];if(yi[0].x-Mn<P.EXTENT&&yi[0].y-Mn<P.EXTENT&&yi[1].x+Mn>=0&&yi[1].y+Mn>=0){var Ri=ye.map(function(Vi){return nn.getTilePoint(Vi)}),Qi=De.map(function(Vi){return nn.getTilePoint(Vi)});X.push({tile:Qr,tileID:nn,queryGeometry:Ri,cameraQueryGeometry:Qi,scale:Ln})}}},Ir=0;Ir<He.length;Ir++)nr(Ir);return X},w.prototype.getVisibleCoordinates=function(_){for(var T=this,N=this.getRenderableIds(_).map(function(xe){return T._tiles[xe].tileID}),$=0,X=N;$<X.length;$+=1){var oe=X[$];oe.posMatrix=this.transform.calculatePosMatrix(oe.toUnwrapped())}return N},w.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(yt(this._source.type))for(var _ in this._tiles){var T=this._tiles[_];if(T.fadeEndTime!==void 0&&T.fadeEndTime>=P.browser.now())return!0}return!1},w.prototype.setFeatureState=function(_,T,N){this._state.updateState(_=_||"_geojsonTileLayer",T,N)},w.prototype.removeFeatureState=function(_,T,N){this._state.removeFeatureState(_=_||"_geojsonTileLayer",T,N)},w.prototype.getFeatureState=function(_,T){return this._state.getState(_=_||"_geojsonTileLayer",T)},w.prototype.setDependencies=function(_,T,N){var $=this._tiles[_];$&&$.setDependencies(T,N)},w.prototype.reloadTilesForDependencies=function(_,T){for(var N in this._tiles)this._tiles[N].hasDependency(_,T)&&this._reloadTile(N,"reloading");this._cache.filter(function($){return!$.hasDependency(_,T)})},w}(P.Evented);function Be(m,w){var _=Math.abs(2*m.wrap)-+(m.wrap<0),T=Math.abs(2*w.wrap)-+(w.wrap<0);return m.overscaledZ-w.overscaledZ||T-_||w.canonical.y-m.canonical.y||w.canonical.x-m.canonical.x}function yt(m){return m==="raster"||m==="image"||m==="video"}function zt(){return new P.window.Worker(Le.workerUrl)}Me.maxOverzooming=10,Me.maxUnderzooming=3;var Ze="mapboxgl_preloaded_worker_pool",Yr=function(){this.active={}};Yr.prototype.acquire=function(m){if(!this.workers)for(this.workers=[];this.workers.length<Yr.workerCount;)this.workers.push(new zt);return this.active[m]=!0,this.workers.slice()},Yr.prototype.release=function(m){delete this.active[m],this.numActive()===0&&(this.workers.forEach(function(w){w.terminate()}),this.workers=null)},Yr.prototype.isPreloaded=function(){return!!this.active[Ze]},Yr.prototype.numActive=function(){return Object.keys(this.active).length};var Fn,Nn=Math.floor(P.browser.hardwareConcurrency/2);function qr(){return Fn||(Fn=new Yr),Fn}function li(m,w){var _={};for(var T in m)T!=="ref"&&(_[T]=m[T]);return P.refProperties.forEach(function(N){N in w&&(_[N]=w[N])}),_}function zn(m){m=m.slice();for(var w=Object.create(null),_=0;_<m.length;_++)w[m[_].id]=m[_];for(var T=0;T<m.length;T++)"ref"in m[T]&&(m[T]=li(m[T],w[m[T].ref]));return m}Yr.workerCount=Math.max(Math.min(Nn,6),1);var jn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ca(m,w,_){_.push({command:jn.addSource,args:[m,w[m]]})}function ni(m,w,_){w.push({command:jn.removeSource,args:[m]}),_[m]=!0}function za(m,w,_,T){ni(m,_,T),Ca(m,w,_)}function Ao(m,w,_){var T;for(T in m[_])if(m[_].hasOwnProperty(T)&&T!=="data"&&!P.deepEqual(m[_][T],w[_][T]))return!1;for(T in w[_])if(w[_].hasOwnProperty(T)&&T!=="data"&&!P.deepEqual(m[_][T],w[_][T]))return!1;return!0}function io(m,w,_,T,N,$){var X;for(X in w=w||{},m=m||{})m.hasOwnProperty(X)&&(P.deepEqual(m[X],w[X])||_.push({command:$,args:[T,X,w[X],N]}));for(X in w)w.hasOwnProperty(X)&&!m.hasOwnProperty(X)&&(P.deepEqual(m[X],w[X])||_.push({command:$,args:[T,X,w[X],N]}))}function ys(m){return m.id}function oo(m,w){return m[w.id]=w,m}var el=function(m,w){this.reset(m,w)};el.prototype.reset=function(m,w){this.points=m||[],this._distances=[0];for(var _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(w||0,.5*this.length),this.paddedLength=this.length-2*this.padding},el.prototype.lerp=function(m){if(this.points.length===1)return this.points[0];m=P.clamp(m,0,1);for(var w=1,_=this._distances[w],T=m*this.paddedLength+this.padding;_<T&&w<this._distances.length;)_=this._distances[++w];var N=w-1,$=this._distances[N],X=_-$,oe=X>0?(T-$)/X:0;return this.points[N].mult(1-oe).add(this.points[w].mult(oe))};var Qs=function(m,w,_){var T=this.boxCells=[],N=this.circleCells=[];this.xCellCount=Math.ceil(m/_),this.yCellCount=Math.ceil(w/_);for(var $=0;$<this.xCellCount*this.yCellCount;$++)T.push([]),N.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=m,this.height=w,this.xScale=this.xCellCount/m,this.yScale=this.yCellCount/w,this.boxUid=0,this.circleUid=0};function vo(m,w,_,T,N){var $=P.create();return w?(P.scale($,$,[1/N,1/N,1]),_||P.rotateZ($,$,T.angle)):P.multiply($,T.labelPlaneMatrix,m),$}function as(m,w,_,T,N){if(w){var $=P.clone(m);return P.scale($,$,[N,N,1]),_||P.rotateZ($,$,-T.angle),$}return T.glCoordMatrix}function To(m,w){var _=[m.x,m.y,0,1];Zo(_,_,w);var T=_[3];return{point:new P.Point(_[0]/T,_[1]/T),signedDistanceFromCamera:T}}function to(m,w){return .5+m/w*.5}function js(m,w){var _=m[0]/m[3],T=m[1]/m[3];return _>=-w[0]&&_<=w[0]&&T>=-w[1]&&T<=w[1]}function Vc(m,w,_,T,N,$,X,oe){var xe=T?m.textSizeData:m.iconSizeData,ye=P.evaluateSizeForZoom(xe,_.transform.zoom),De=[256/_.width*2+1,256/_.height*2+1],He=T?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;He.clear();for(var $e=m.lineVertexArray,ft=T?m.text.placedSymbolArray:m.icon.placedSymbolArray,pt=_.transform.width/_.transform.height,wt=!1,dt=0;dt<ft.length;dt++){var Ft=ft.get(dt);if(Ft.hidden||Ft.writingMode===P.WritingMode.vertical&&!wt)du(Ft.numGlyphs,He);else{wt=!1;var ar=[Ft.anchorX,Ft.anchorY,0,1];if(P.transformMat4(ar,ar,w),js(ar,De)){var nr=to(_.transform.cameraToCenterDistance,ar[3]),Ir=P.evaluateSizeForFeature(xe,ye,Ft),_r=X?Ir/nr:Ir*nr,Qr=new P.Point(Ft.anchorX,Ft.anchorY),nn=To(Qr,N).point,Ln={},Mn=eh(Ft,_r,!1,oe,w,N,$,m.glyphOffsetArray,$e,He,nn,Qr,Ln,pt);wt=Mn.useVertical,(Mn.notEnoughRoom||wt||Mn.needsFlipping&&eh(Ft,_r,!0,oe,w,N,$,m.glyphOffsetArray,$e,He,nn,Qr,Ln,pt).notEnoughRoom)&&du(Ft.numGlyphs,He)}else du(Ft.numGlyphs,He)}}T?m.text.dynamicLayoutVertexBuffer.updateData(He):m.icon.dynamicLayoutVertexBuffer.updateData(He)}function ws(m,w,_,T,N,$,X,oe,xe,ye,De){var He=oe.glyphStartIndex+oe.numGlyphs,$e=oe.lineStartIndex,ft=oe.lineStartIndex+oe.lineLength,pt=w.getoffsetX(oe.glyphStartIndex),wt=w.getoffsetX(He-1),dt=Io(m*pt,_,T,N,$,X,oe.segment,$e,ft,xe,ye,De);if(!dt)return null;var Ft=Io(m*wt,_,T,N,$,X,oe.segment,$e,ft,xe,ye,De);return Ft?{first:dt,last:Ft}:null}function Ss(m,w,_,T){return m===P.WritingMode.horizontal&&Math.abs(_.y-w.y)>Math.abs(_.x-w.x)*T?{useVertical:!0}:(m===P.WritingMode.vertical?w.y<_.y:w.x>_.x)?{needsFlipping:!0}:null}function eh(m,w,_,T,N,$,X,oe,xe,ye,De,He,$e,ft){var pt,wt=w/24,dt=m.lineOffsetX*wt,Ft=m.lineOffsetY*wt;if(m.numGlyphs>1){var ar=m.glyphStartIndex+m.numGlyphs,nr=m.lineStartIndex,Ir=m.lineStartIndex+m.lineLength,_r=ws(wt,oe,dt,Ft,_,De,He,m,xe,$,$e);if(!_r)return{notEnoughRoom:!0};var Qr=To(_r.first.point,X).point,nn=To(_r.last.point,X).point;if(T&&!_){var Ln=Ss(m.writingMode,Qr,nn,ft);if(Ln)return Ln}pt=[_r.first];for(var Mn=m.glyphStartIndex+1;Mn<ar-1;Mn++)pt.push(Io(wt*oe.getoffsetX(Mn),dt,Ft,_,De,He,m.segment,nr,Ir,xe,$,$e));pt.push(_r.last)}else{if(T&&!_){var yi=To(He,N).point,Ri=m.lineStartIndex+m.segment+1,Qi=new P.Point(xe.getx(Ri),xe.gety(Ri)),Vi=To(Qi,N),ao=Vi.signedDistanceFromCamera>0?Vi.point:kc(He,Qi,yi,1,N),Bi=Ss(m.writingMode,yi,ao,ft);if(Bi)return Bi}var oa=Io(wt*oe.getoffsetX(m.glyphStartIndex),dt,Ft,_,De,He,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,xe,$,$e);if(!oa)return{notEnoughRoom:!0};pt=[oa]}for(var Ha=0,ja=pt;Ha<ja.length;Ha+=1){var Sa=ja[Ha];P.addDynamicAttributes(ye,Sa.point,Sa.angle)}return{}}function kc(m,w,_,T,N){var $=To(m.add(m.sub(w)._unit()),N).point,X=_.sub($);return _.add(X._mult(T/X.mag()))}function Io(m,w,_,T,N,$,X,oe,xe,ye,De,He){var $e=T?m-w:m+w,ft=$e>0?1:-1,pt=0;T&&(ft*=-1,pt=Math.PI),ft<0&&(pt+=Math.PI);for(var wt=ft>0?oe+X:oe+X+1,dt=N,Ft=N,ar=0,nr=0,Ir=Math.abs($e),_r=[];ar+nr<=Ir;){if((wt+=ft)<oe||wt>=xe)return null;if(Ft=dt,_r.push(dt),(dt=He[wt])===void 0){var Qr=new P.Point(ye.getx(wt),ye.gety(wt)),nn=To(Qr,De);if(nn.signedDistanceFromCamera>0)dt=He[wt]=nn.point;else{var Ln=wt-ft;dt=kc(ar===0?$:new P.Point(ye.getx(Ln),ye.gety(Ln)),Qr,Ft,Ir-ar+1,De)}}ar+=nr,nr=Ft.dist(dt)}var Mn=(Ir-ar)/nr,yi=dt.sub(Ft),Ri=yi.mult(Mn)._add(Ft);Ri._add(yi._unit()._perp()._mult(_*ft));var Qi=pt+Math.atan2(dt.y-Ft.y,dt.x-Ft.x);return _r.push(Ri),{point:Ri,angle:Qi,path:_r}}Qs.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qs.prototype.insert=function(m,w,_,T,N){this._forEachCell(w,_,T,N,this._insertBoxCell,this.boxUid++),this.boxKeys.push(m),this.bboxes.push(w),this.bboxes.push(_),this.bboxes.push(T),this.bboxes.push(N)},Qs.prototype.insertCircle=function(m,w,_,T){this._forEachCell(w-T,_-T,w+T,_+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(m),this.circles.push(w),this.circles.push(_),this.circles.push(T)},Qs.prototype._insertBoxCell=function(m,w,_,T,N,$){this.boxCells[N].push($)},Qs.prototype._insertCircleCell=function(m,w,_,T,N,$){this.circleCells[N].push($)},Qs.prototype._query=function(m,w,_,T,N,$){if(_<0||m>this.width||T<0||w>this.height)return!N&&[];var X=[];if(m<=0&&w<=0&&this.width<=_&&this.height<=T){if(N)return!0;for(var oe=0;oe<this.boxKeys.length;oe++)X.push({key:this.boxKeys[oe],x1:this.bboxes[4*oe],y1:this.bboxes[4*oe+1],x2:this.bboxes[4*oe+2],y2:this.bboxes[4*oe+3]});for(var xe=0;xe<this.circleKeys.length;xe++){var ye=this.circles[3*xe],De=this.circles[3*xe+1],He=this.circles[3*xe+2];X.push({key:this.circleKeys[xe],x1:ye-He,y1:De-He,x2:ye+He,y2:De+He})}return $?X.filter($):X}return this._forEachCell(m,w,_,T,this._queryCell,X,{hitTest:N,seenUids:{box:{},circle:{}}},$),N?X.length>0:X},Qs.prototype._queryCircle=function(m,w,_,T,N){var $=m-_,X=m+_,oe=w-_,xe=w+_;if(X<0||$>this.width||xe<0||oe>this.height)return!T&&[];var ye=[];return this._forEachCell($,oe,X,xe,this._queryCellCircle,ye,{hitTest:T,circle:{x:m,y:w,radius:_},seenUids:{box:{},circle:{}}},N),T?ye.length>0:ye},Qs.prototype.query=function(m,w,_,T,N){return this._query(m,w,_,T,!1,N)},Qs.prototype.hitTest=function(m,w,_,T,N){return this._query(m,w,_,T,!0,N)},Qs.prototype.hitTestCircle=function(m,w,_,T){return this._queryCircle(m,w,_,!0,T)},Qs.prototype._queryCell=function(m,w,_,T,N,$,X,oe){var xe=X.seenUids,ye=this.boxCells[N];if(ye!==null)for(var De=this.bboxes,He=0,$e=ye;He<$e.length;He+=1){var ft=$e[He];if(!xe.box[ft]){xe.box[ft]=!0;var pt=4*ft;if(m<=De[pt+2]&&w<=De[pt+3]&&_>=De[pt+0]&&T>=De[pt+1]&&(!oe||oe(this.boxKeys[ft]))){if(X.hitTest)return $.push(!0),!0;$.push({key:this.boxKeys[ft],x1:De[pt],y1:De[pt+1],x2:De[pt+2],y2:De[pt+3]})}}}var wt=this.circleCells[N];if(wt!==null)for(var dt=this.circles,Ft=0,ar=wt;Ft<ar.length;Ft+=1){var nr=ar[Ft];if(!xe.circle[nr]){xe.circle[nr]=!0;var Ir=3*nr;if(this._circleAndRectCollide(dt[Ir],dt[Ir+1],dt[Ir+2],m,w,_,T)&&(!oe||oe(this.circleKeys[nr]))){if(X.hitTest)return $.push(!0),!0;var _r=dt[Ir],Qr=dt[Ir+1],nn=dt[Ir+2];$.push({key:this.circleKeys[nr],x1:_r-nn,y1:Qr-nn,x2:_r+nn,y2:Qr+nn})}}}},Qs.prototype._queryCellCircle=function(m,w,_,T,N,$,X,oe){var xe=X.circle,ye=X.seenUids,De=this.boxCells[N];if(De!==null)for(var He=this.bboxes,$e=0,ft=De;$e<ft.length;$e+=1){var pt=ft[$e];if(!ye.box[pt]){ye.box[pt]=!0;var wt=4*pt;if(this._circleAndRectCollide(xe.x,xe.y,xe.radius,He[wt+0],He[wt+1],He[wt+2],He[wt+3])&&(!oe||oe(this.boxKeys[pt])))return $.push(!0),!0}}var dt=this.circleCells[N];if(dt!==null)for(var Ft=this.circles,ar=0,nr=dt;ar<nr.length;ar+=1){var Ir=nr[ar];if(!ye.circle[Ir]){ye.circle[Ir]=!0;var _r=3*Ir;if(this._circlesCollide(Ft[_r],Ft[_r+1],Ft[_r+2],xe.x,xe.y,xe.radius)&&(!oe||oe(this.circleKeys[Ir])))return $.push(!0),!0}}},Qs.prototype._forEachCell=function(m,w,_,T,N,$,X,oe){for(var xe=this._convertToXCellCoord(m),ye=this._convertToYCellCoord(w),De=this._convertToXCellCoord(_),He=this._convertToYCellCoord(T),$e=xe;$e<=De;$e++)for(var ft=ye;ft<=He;ft++)if(N.call(this,m,w,_,T,this.xCellCount*ft+$e,$,X,oe))return},Qs.prototype._convertToXCellCoord=function(m){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(m*this.xScale)))},Qs.prototype._convertToYCellCoord=function(m){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(m*this.yScale)))},Qs.prototype._circlesCollide=function(m,w,_,T,N,$){var X=T-m,oe=N-w,xe=_+$;return xe*xe>X*X+oe*oe},Qs.prototype._circleAndRectCollide=function(m,w,_,T,N,$,X){var oe=($-T)/2,xe=Math.abs(m-(T+oe));if(xe>oe+_)return!1;var ye=(X-N)/2,De=Math.abs(w-(N+ye));if(De>ye+_)return!1;if(xe<=oe||De<=ye)return!0;var He=xe-oe,$e=De-ye;return He*He+$e*$e<=_*_};var bo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function du(m,w){for(var _=0;_<m;_++){var T=w.length;w.resize(T+4),w.float32.set(bo,3*T)}}function Zo(m,w,_){var T=w[0],N=w[1];return m[0]=_[0]*T+_[4]*N+_[12],m[1]=_[1]*T+_[5]*N+_[13],m[3]=_[3]*T+_[7]*N+_[15],m}var Il=function(m,w,_){w===void 0&&(w=new Qs(m.width+200,m.height+200,25)),_===void 0&&(_=new Qs(m.width+200,m.height+200,25)),this.transform=m,this.grid=w,this.ignoredGrid=_,this.pitchfactor=Math.cos(m._pitch)*m.cameraToCenterDistance,this.screenRightBoundary=m.width+100,this.screenBottomBoundary=m.height+100,this.gridRightBoundary=m.width+200,this.gridBottomBoundary=m.height+200};function Uo(m,w,_){return w*(P.EXTENT/(m.tileSize*Math.pow(2,_-m.tileID.overscaledZ)))}Il.prototype.placeCollisionBox=function(m,w,_,T,N){var $=this.projectAndGetPerspectiveRatio(T,m.anchorPointX,m.anchorPointY),X=_*$.perspectiveRatio,oe=m.x1*X+$.point.x,xe=m.y1*X+$.point.y,ye=m.x2*X+$.point.x,De=m.y2*X+$.point.y;return!this.isInsideGrid(oe,xe,ye,De)||!w&&this.grid.hitTest(oe,xe,ye,De,N)?{box:[],offscreen:!1}:{box:[oe,xe,ye,De],offscreen:this.isOffscreen(oe,xe,ye,De)}},Il.prototype.placeCollisionCircles=function(m,w,_,T,N,$,X,oe,xe,ye,De,He,$e){var ft=[],pt=new P.Point(w.anchorX,w.anchorY),wt=To(pt,$),dt=to(this.transform.cameraToCenterDistance,wt.signedDistanceFromCamera),Ft=(ye?N/dt:N*dt)/P.ONE_EM,ar=To(pt,X).point,nr=ws(Ft,T,w.lineOffsetX*Ft,w.lineOffsetY*Ft,!1,ar,pt,w,_,X,{}),Ir=!1,_r=!1,Qr=!0;if(nr){for(var nn=.5*He*dt+$e,Ln=new P.Point(-100,-100),Mn=new P.Point(this.screenRightBoundary,this.screenBottomBoundary),yi=new el,Ri=nr.first,Qi=nr.last,Vi=[],ao=Ri.path.length-1;ao>=1;ao--)Vi.push(Ri.path[ao]);for(var Bi=1;Bi<Qi.path.length;Bi++)Vi.push(Qi.path[Bi]);var oa=2.5*nn;if(oe){var Ha=Vi.map(function(Yc){return To(Yc,oe)});Vi=Ha.some(function(Yc){return Yc.signedDistanceFromCamera<=0})?[]:Ha.map(function(Yc){return Yc.point})}var ja=[];if(Vi.length>0){for(var Sa=Vi[0].clone(),Qa=Vi[0].clone(),eo=1;eo<Vi.length;eo++)Sa.x=Math.min(Sa.x,Vi[eo].x),Sa.y=Math.min(Sa.y,Vi[eo].y),Qa.x=Math.max(Qa.x,Vi[eo].x),Qa.y=Math.max(Qa.y,Vi[eo].y);ja=Sa.x>=Ln.x&&Qa.x<=Mn.x&&Sa.y>=Ln.y&&Qa.y<=Mn.y?[Vi]:Qa.x<Ln.x||Sa.x>Mn.x||Qa.y<Ln.y||Sa.y>Mn.y?[]:P.clipLine([Vi],Ln.x,Ln.y,Mn.x,Mn.y)}for(var va=0,tu=ja;va<tu.length;va+=1){var Gs;yi.reset(tu[va],.25*nn),Gs=yi.length<=.5*nn?1:Math.ceil(yi.paddedLength/oa)+1;for(var Tl=0;Tl<Gs;Tl++){var Ps=Tl/Math.max(Gs-1,1),Qo=yi.lerp(Ps),Zs=Qo.x+100,Hs=Qo.y+100;ft.push(Zs,Hs,nn,0);var Uu=Zs-nn,uh=Hs-nn,pc=Zs+nn,Xc=Hs+nn;if(Qr=Qr&&this.isOffscreen(Uu,uh,pc,Xc),_r=_r||this.isInsideGrid(Uu,uh,pc,Xc),!m&&this.grid.hitTestCircle(Zs,Hs,nn,De)&&(Ir=!0,!xe))return{circles:[],offscreen:!1,collisionDetected:Ir}}}}return{circles:!xe&&Ir||!_r?[]:ft,offscreen:Qr,collisionDetected:Ir}},Il.prototype.queryRenderedSymbols=function(m){if(m.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var w=[],_=1/0,T=1/0,N=-1/0,$=-1/0,X=0,oe=m;X<oe.length;X+=1){var xe=oe[X],ye=new P.Point(xe.x+100,xe.y+100);_=Math.min(_,ye.x),T=Math.min(T,ye.y),N=Math.max(N,ye.x),$=Math.max($,ye.y),w.push(ye)}for(var De={},He={},$e=0,ft=this.grid.query(_,T,N,$).concat(this.ignoredGrid.query(_,T,N,$));$e<ft.length;$e+=1){var pt=ft[$e],wt=pt.key;if(De[wt.bucketInstanceId]===void 0&&(De[wt.bucketInstanceId]={}),!De[wt.bucketInstanceId][wt.featureIndex]){var dt=[new P.Point(pt.x1,pt.y1),new P.Point(pt.x2,pt.y1),new P.Point(pt.x2,pt.y2),new P.Point(pt.x1,pt.y2)];P.polygonIntersectsPolygon(w,dt)&&(De[wt.bucketInstanceId][wt.featureIndex]=!0,He[wt.bucketInstanceId]===void 0&&(He[wt.bucketInstanceId]=[]),He[wt.bucketInstanceId].push(wt.featureIndex))}}return He},Il.prototype.insertCollisionBox=function(m,w,_,T,N){(w?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:T,collisionGroupID:N},m[0],m[1],m[2],m[3])},Il.prototype.insertCollisionCircles=function(m,w,_,T,N){for(var $=w?this.ignoredGrid:this.grid,X={bucketInstanceId:_,featureIndex:T,collisionGroupID:N},oe=0;oe<m.length;oe+=4)$.insertCircle(X,m[oe],m[oe+1],m[oe+2])},Il.prototype.projectAndGetPerspectiveRatio=function(m,w,_){var T=[w,_,0,1];return Zo(T,T,m),{point:new P.Point((T[0]/T[3]+1)/2*this.transform.width+100,(-T[1]/T[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T[3]*.5}},Il.prototype.isOffscreen=function(m,w,_,T){return _<100||m>=this.screenRightBoundary||T<100||w>this.screenBottomBoundary},Il.prototype.isInsideGrid=function(m,w,_,T){return _>=0&&m<this.gridRightBoundary&&T>=0&&w<this.gridBottomBoundary},Il.prototype.getViewportMatrix=function(){var m=P.identity([]);return P.translate(m,m,[-100,-100,0]),m};var Ws=function(m,w,_,T){this.opacity=m?Math.max(0,Math.min(1,m.opacity+(m.placed?w:-w))):T&&_?1:0,this.placed=_};Ws.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var eu=function(m,w,_,T,N){this.text=new Ws(m?m.text:null,w,_,N),this.icon=new Ws(m?m.icon:null,w,T,N)};eu.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var sl=function(m,w,_){this.text=m,this.icon=w,this.skipFade=_},ul=function(){this.invProjMatrix=P.create(),this.viewportMatrix=P.create(),this.circles=[]},ll=function(m,w,_,T,N){this.bucketInstanceId=m,this.featureIndex=w,this.sourceLayerIndex=_,this.bucketIndex=T,this.tileID=N},_c=function(m){this.crossSourceCollisions=m,this.maxGroupID=0,this.collisionGroups={}};function zu(m,w,_,T,N){var $=P.getAnchorAlignment(m),X=-($.horizontalAlign-.5)*w,oe=-($.verticalAlign-.5)*_,xe=P.evaluateVariableOffset(m,T);return new P.Point(X+xe[0]*N,oe+xe[1]*N)}function cl(m,w,_,T,N,$){var X=m.x1,oe=m.x2,xe=m.y1,ye=m.y2,De=m.anchorPointX,He=m.anchorPointY,$e=new P.Point(w,_);return T&&$e._rotate(N?$:-$),{x1:X+$e.x,y1:xe+$e.y,x2:oe+$e.x,y2:ye+$e.y,anchorPointX:De,anchorPointY:He}}_c.prototype.get=function(m){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[m]){var w=++this.maxGroupID;this.collisionGroups[m]={ID:w,predicate:function(_){return _.collisionGroupID===w}}}return this.collisionGroups[m]};var iu=function(m,w,_,T){this.transform=m.clone(),this.collisionIndex=new Il(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=w,this.retainedQueryData={},this.collisionGroups=new _c(_),this.collisionCircleArrays={},this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}};function _t(m,w,_,T,N){m.emplaceBack(w?1:0,_?1:0,T||0,N||0),m.emplaceBack(w?1:0,_?1:0,T||0,N||0),m.emplaceBack(w?1:0,_?1:0,T||0,N||0),m.emplaceBack(w?1:0,_?1:0,T||0,N||0)}iu.prototype.getBucketParts=function(m,w,_,T){var N=_.getBucket(w),$=_.latestFeatureIndex;if(N&&$&&w.id===N.layerIds[0]){var X=_.collisionBoxArray,oe=N.layers[0].layout,xe=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ye=_.tileSize/P.EXTENT,De=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),He=oe.get("text-pitch-alignment")==="map",$e=oe.get("text-rotation-alignment")==="map",ft=Uo(_,1,this.transform.zoom),pt=vo(De,He,$e,this.transform,ft),wt=null;if(He){var dt=as(De,He,$e,this.transform,ft);wt=P.multiply([],this.transform.labelPlaneMatrix,dt)}this.retainedQueryData[N.bucketInstanceId]=new ll(N.bucketInstanceId,$,N.sourceLayerIndex,N.index,_.tileID);var Ft={bucket:N,layout:oe,posMatrix:De,textLabelPlaneMatrix:pt,labelToScreenMatrix:wt,scale:xe,textPixelRatio:ye,holdingForFade:_.holdingForFade(),collisionBoxArray:X,partiallyEvaluatedTextSize:P.evaluateSizeForZoom(N.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(N.sourceID)};if(T)for(var ar=0,nr=N.sortKeyRanges;ar<nr.length;ar+=1){var Ir=nr[ar];m.push({sortKey:Ir.sortKey,symbolInstanceStart:Ir.symbolInstanceStart,symbolInstanceEnd:Ir.symbolInstanceEnd,parameters:Ft})}else m.push({symbolInstanceStart:0,symbolInstanceEnd:N.symbolInstances.length,parameters:Ft})}},iu.prototype.attemptAnchorPlacement=function(m,w,_,T,N,$,X,oe,xe,ye,De,He,$e,ft,pt){var wt,dt=[He.textOffset0,He.textOffset1],Ft=zu(m,_,T,dt,N),ar=this.collisionIndex.placeCollisionBox(cl(w,Ft.x,Ft.y,$,X,this.transform.angle),De,oe,xe,ye.predicate);if(!pt||this.collisionIndex.placeCollisionBox(cl(pt,Ft.x,Ft.y,$,X,this.transform.angle),De,oe,xe,ye.predicate).box.length!==0)return ar.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[He.crossTileID]&&this.prevPlacement.placements[He.crossTileID]&&this.prevPlacement.placements[He.crossTileID].text&&(wt=this.prevPlacement.variableOffsets[He.crossTileID].anchor),this.variableOffsets[He.crossTileID]={textOffset:dt,width:_,height:T,anchor:m,textBoxScale:N,prevAnchor:wt},this.markUsedJustification($e,m,He,ft),$e.allowVerticalPlacement&&(this.markUsedOrientation($e,ft,He),this.placedOrientations[He.crossTileID]=ft),{shift:Ft,placedGlyphBoxes:ar}):void 0},iu.prototype.placeLayerBucketPart=function(m,w,_){var T=this,N=m.parameters,$=N.bucket,X=N.layout,oe=N.posMatrix,xe=N.textLabelPlaneMatrix,ye=N.labelToScreenMatrix,De=N.textPixelRatio,He=N.holdingForFade,$e=N.collisionBoxArray,ft=N.partiallyEvaluatedTextSize,pt=N.collisionGroup,wt=X.get("text-optional"),dt=X.get("icon-optional"),Ft=X.get("text-allow-overlap"),ar=X.get("icon-allow-overlap"),nr=X.get("text-rotation-alignment")==="map",Ir=X.get("text-pitch-alignment")==="map",_r=X.get("icon-text-fit")!=="none",Qr=X.get("symbol-z-order")==="viewport-y",nn=Ft&&(ar||!$.hasIconData()||dt),Ln=ar&&(Ft||!$.hasTextData()||wt);!$.collisionArrays&&$e&&$.deserializeCollisionBoxes($e);var Mn=function(Bi,oa){if(!w[Bi.crossTileID])if(He)T.placements[Bi.crossTileID]=new sl(!1,!1,!1);else{var Ha,ja=!1,Sa=!1,Qa=!0,eo=null,va={box:null,offscreen:null},tu={box:null,offscreen:null},Gs=null,Tl=null,Ps=0,Qo=0,Zs=0;oa.textFeatureIndex?Ps=oa.textFeatureIndex:Bi.useRuntimeCollisionCircles&&(Ps=Bi.featureIndex),oa.verticalTextFeatureIndex&&(Qo=oa.verticalTextFeatureIndex);var Hs=oa.textBox;if(Hs){var Uu=function(Es){var Ol=P.WritingMode.horizontal;if($.allowVerticalPlacement&&!Es&&T.prevPlacement){var ml=T.prevPlacement.placedOrientations[Bi.crossTileID];ml&&(T.placedOrientations[Bi.crossTileID]=ml,T.markUsedOrientation($,Ol=ml,Bi))}return Ol},uh=function(Es,Ol){if($.allowVerticalPlacement&&Bi.numVerticalGlyphVertices>0&&oa.verticalTextBox)for(var ml=0,mf=$.writingModes;ml<mf.length&&(mf[ml]===P.WritingMode.vertical?(va=Ol(),tu=va):va=Es(),!(va&&va.box&&va.box.length));ml+=1);else va=Es()};if(X.get("text-variable-anchor")){var pc=X.get("text-variable-anchor");if(T.prevPlacement&&T.prevPlacement.variableOffsets[Bi.crossTileID]){var Xc=T.prevPlacement.variableOffsets[Bi.crossTileID];pc.indexOf(Xc.anchor)>0&&(pc=pc.filter(function(Es){return Es!==Xc.anchor})).unshift(Xc.anchor)}var Yc=function(Es,Ol,ml){for(var mf=Es.x2-Es.x1,ku=Es.y2-Es.y1,ep=Bi.textBoxScale,cd=_r&&!ar?Ol:null,qh={box:[],offscreen:!1},Rd=Ft?2*pc.length:pc.length,Rf=0;Rf<Rd;++Rf){var hd=T.attemptAnchorPlacement(pc[Rf%pc.length],Es,mf,ku,ep,nr,Ir,De,oe,pt,Rf>=pc.length,Bi,$,ml,cd);if(hd&&(qh=hd.placedGlyphBoxes)&&qh.box&&qh.box.length){ja=!0,eo=hd.shift;break}}return qh};uh(function(){return Yc(Hs,oa.iconBox,P.WritingMode.horizontal)},function(){var Es=oa.verticalTextBox;return $.allowVerticalPlacement&&!(va&&va.box&&va.box.length)&&Bi.numVerticalGlyphVertices>0&&Es?Yc(Es,oa.verticalIconBox,P.WritingMode.vertical):{box:null,offscreen:null}}),va&&(ja=va.box,Qa=va.offscreen);var Qf=Uu(va&&va.box);if(!ja&&T.prevPlacement){var dc=T.prevPlacement.variableOffsets[Bi.crossTileID];dc&&(T.variableOffsets[Bi.crossTileID]=dc,T.markUsedJustification($,dc.anchor,Bi,Qf))}}else{var vc=function(Es,Ol){var ml=T.collisionIndex.placeCollisionBox(Es,Ft,De,oe,pt.predicate);return ml&&ml.box&&ml.box.length&&(T.markUsedOrientation($,Ol,Bi),T.placedOrientations[Bi.crossTileID]=Ol),ml};uh(function(){return vc(Hs,P.WritingMode.horizontal)},function(){var Es=oa.verticalTextBox;return $.allowVerticalPlacement&&Bi.numVerticalGlyphVertices>0&&Es?vc(Es,P.WritingMode.vertical):{box:null,offscreen:null}}),Uu(va&&va.box&&va.box.length)}}if(ja=(Ha=va)&&Ha.box&&Ha.box.length>0,Qa=Ha&&Ha.offscreen,Bi.useRuntimeCollisionCircles){var Dc=$.text.placedSymbolArray.get(Bi.centerJustifiedTextSymbolIndex),Vl=P.evaluateSizeForFeature($.textSizeData,ft,Dc),Gl=X.get("text-padding");Gs=T.collisionIndex.placeCollisionCircles(Ft,Dc,$.lineVertexArray,$.glyphOffsetArray,Vl,oe,xe,ye,_,Ir,pt.predicate,Bi.collisionCircleDiameter,Gl),ja=Ft||Gs.circles.length>0&&!Gs.collisionDetected,Qa=Qa&&Gs.offscreen}if(oa.iconFeatureIndex&&(Zs=oa.iconFeatureIndex),oa.iconBox){var vf=function(Es){var Ol=_r&&eo?cl(Es,eo.x,eo.y,nr,Ir,T.transform.angle):Es;return T.collisionIndex.placeCollisionBox(Ol,ar,De,oe,pt.predicate)};Sa=tu&&tu.box&&tu.box.length&&oa.verticalIconBox?(Tl=vf(oa.verticalIconBox)).box.length>0:(Tl=vf(oa.iconBox)).box.length>0,Qa=Qa&&Tl.offscreen}var mc=wt||Bi.numHorizontalGlyphVertices===0&&Bi.numVerticalGlyphVertices===0,Hl=dt||Bi.numIconVertices===0;if(mc||Hl?Hl?mc||(Sa=Sa&&ja):ja=Sa&&ja:Sa=ja=Sa&&ja,ja&&Ha&&Ha.box&&T.collisionIndex.insertCollisionBox(Ha.box,X.get("text-ignore-placement"),$.bucketInstanceId,tu&&tu.box&&Qo?Qo:Ps,pt.ID),Sa&&Tl&&T.collisionIndex.insertCollisionBox(Tl.box,X.get("icon-ignore-placement"),$.bucketInstanceId,Zs,pt.ID),Gs&&(ja&&T.collisionIndex.insertCollisionCircles(Gs.circles,X.get("text-ignore-placement"),$.bucketInstanceId,Ps,pt.ID),_)){var lh=$.bucketInstanceId,Os=T.collisionCircleArrays[lh];Os===void 0&&(Os=T.collisionCircleArrays[lh]=new ul);for(var ch=0;ch<Gs.circles.length;ch+=4)Os.circles.push(Gs.circles[ch+0]),Os.circles.push(Gs.circles[ch+1]),Os.circles.push(Gs.circles[ch+2]),Os.circles.push(Gs.collisionDetected?1:0)}T.placements[Bi.crossTileID]=new sl(ja||nn,Sa||Ln,Qa||$.justReloaded),w[Bi.crossTileID]=!0}};if(Qr)for(var yi=$.getSortedSymbolIndexes(this.transform.angle),Ri=yi.length-1;Ri>=0;--Ri){var Qi=yi[Ri];Mn($.symbolInstances.get(Qi),$.collisionArrays[Qi])}else for(var Vi=m.symbolInstanceStart;Vi<m.symbolInstanceEnd;Vi++)Mn($.symbolInstances.get(Vi),$.collisionArrays[Vi]);if(_&&$.bucketInstanceId in this.collisionCircleArrays){var ao=this.collisionCircleArrays[$.bucketInstanceId];P.invert(ao.invProjMatrix,oe),ao.viewportMatrix=this.collisionIndex.getViewportMatrix()}$.justReloaded=!1},iu.prototype.markUsedJustification=function(m,w,_,T){var N;N=T===P.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[P.getAnchorJustification(w)];for(var $=0,X=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];$<X.length;$+=1){var oe=X[$];oe>=0&&(m.text.placedSymbolArray.get(oe).crossTileID=N>=0&&oe!==N?0:_.crossTileID)}},iu.prototype.markUsedOrientation=function(m,w,_){for(var T=w===P.WritingMode.horizontal||w===P.WritingMode.horizontalOnly?w:0,N=w===P.WritingMode.vertical?w:0,$=0,X=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];$<X.length;$+=1)m.text.placedSymbolArray.get(X[$]).placedOrientation=T;_.verticalPlacedTextSymbolIndex&&(m.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=N)},iu.prototype.commit=function(m){this.commitTime=m,this.zoomAtLastRecencyCheck=this.transform.zoom;var w=this.prevPlacement,_=!1;this.prevZoomAdjustment=w?w.zoomAdjustment(this.transform.zoom):0;var T=w?w.symbolFadeChange(m):1,N=w?w.opacities:{},$=w?w.variableOffsets:{},X=w?w.placedOrientations:{};for(var oe in this.placements){var xe=this.placements[oe],ye=N[oe];ye?(this.opacities[oe]=new eu(ye,T,xe.text,xe.icon),_=_||xe.text!==ye.text.placed||xe.icon!==ye.icon.placed):(this.opacities[oe]=new eu(null,T,xe.text,xe.icon,xe.skipFade),_=_||xe.text||xe.icon)}for(var De in N){var He=N[De];if(!this.opacities[De]){var $e=new eu(He,T,!1,!1);$e.isHidden()||(this.opacities[De]=$e,_=_||He.text.placed||He.icon.placed)}}for(var ft in $)this.variableOffsets[ft]||!this.opacities[ft]||this.opacities[ft].isHidden()||(this.variableOffsets[ft]=$[ft]);for(var pt in X)this.placedOrientations[pt]||!this.opacities[pt]||this.opacities[pt].isHidden()||(this.placedOrientations[pt]=X[pt]);_?this.lastPlacementChangeTime=m:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=w?w.lastPlacementChangeTime:m)},iu.prototype.updateLayerOpacities=function(m,w){for(var _={},T=0,N=w;T<N.length;T+=1){var $=N[T],X=$.getBucket(m);X&&$.latestFeatureIndex&&m.id===X.layerIds[0]&&this.updateBucketOpacities(X,_,$.collisionBoxArray)}},iu.prototype.updateBucketOpacities=function(m,w,_){var T=this;m.hasTextData()&&m.text.opacityVertexArray.clear(),m.hasIconData()&&m.icon.opacityVertexArray.clear(),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexArray.clear(),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexArray.clear();var N=m.layers[0].layout,$=new eu(null,0,!1,!1,!0),X=N.get("text-allow-overlap"),oe=N.get("icon-allow-overlap"),xe=N.get("text-variable-anchor"),ye=N.get("text-rotation-alignment")==="map",De=N.get("text-pitch-alignment")==="map",He=N.get("icon-text-fit")!=="none",$e=new eu(null,0,X&&(oe||!m.hasIconData()||N.get("icon-optional")),oe&&(X||!m.hasTextData()||N.get("text-optional")),!0);!m.collisionArrays&&_&&(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData())&&m.deserializeCollisionBoxes(_);for(var ft=function(Ft,ar,nr){for(var Ir=0;Ir<ar/4;Ir++)Ft.opacityVertexArray.emplaceBack(nr)},pt=function(Ft){var ar=m.symbolInstances.get(Ft),nr=ar.numHorizontalGlyphVertices,Ir=ar.numVerticalGlyphVertices,_r=ar.crossTileID,Qr=T.opacities[_r];w[_r]?Qr=$:Qr||(T.opacities[_r]=Qr=$e),w[_r]=!0;var nn=ar.numIconVertices>0,Ln=T.placedOrientations[ar.crossTileID],Mn=Ln===P.WritingMode.vertical,yi=Ln===P.WritingMode.horizontal||Ln===P.WritingMode.horizontalOnly;if(nr>0||Ir>0){var Ri=Jo(Qr.text);ft(m.text,nr,Mn?au:Ri),ft(m.text,Ir,yi?au:Ri);var Qi=Qr.text.isHidden();[ar.rightJustifiedTextSymbolIndex,ar.centerJustifiedTextSymbolIndex,ar.leftJustifiedTextSymbolIndex].forEach(function(va){va>=0&&(m.text.placedSymbolArray.get(va).hidden=Qi||Mn?1:0)}),ar.verticalPlacedTextSymbolIndex>=0&&(m.text.placedSymbolArray.get(ar.verticalPlacedTextSymbolIndex).hidden=Qi||yi?1:0);var Vi=T.variableOffsets[ar.crossTileID];Vi&&T.markUsedJustification(m,Vi.anchor,ar,Ln);var ao=T.placedOrientations[ar.crossTileID];ao&&(T.markUsedJustification(m,"left",ar,ao),T.markUsedOrientation(m,ao,ar))}if(nn){var Bi=Jo(Qr.icon),oa=!(He&&ar.verticalPlacedIconSymbolIndex&&Mn);ar.placedIconSymbolIndex>=0&&(ft(m.icon,ar.numIconVertices,oa?Bi:au),m.icon.placedSymbolArray.get(ar.placedIconSymbolIndex).hidden=Qr.icon.isHidden()),ar.verticalPlacedIconSymbolIndex>=0&&(ft(m.icon,ar.numVerticalIconVertices,oa?au:Bi),m.icon.placedSymbolArray.get(ar.verticalPlacedIconSymbolIndex).hidden=Qr.icon.isHidden())}if(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData()){var Ha=m.collisionArrays[Ft];if(Ha){var ja=new P.Point(0,0);if(Ha.textBox||Ha.verticalTextBox){var Sa=!0;if(xe){var Qa=T.variableOffsets[_r];Qa?(ja=zu(Qa.anchor,Qa.width,Qa.height,Qa.textOffset,Qa.textBoxScale),ye&&ja._rotate(De?T.transform.angle:-T.transform.angle)):Sa=!1}Ha.textBox&&_t(m.textCollisionBox.collisionVertexArray,Qr.text.placed,!Sa||Mn,ja.x,ja.y),Ha.verticalTextBox&&_t(m.textCollisionBox.collisionVertexArray,Qr.text.placed,!Sa||yi,ja.x,ja.y)}var eo=!!(!yi&&Ha.verticalIconBox);Ha.iconBox&&_t(m.iconCollisionBox.collisionVertexArray,Qr.icon.placed,eo,He?ja.x:0,He?ja.y:0),Ha.verticalIconBox&&_t(m.iconCollisionBox.collisionVertexArray,Qr.icon.placed,!eo,He?ja.x:0,He?ja.y:0)}}},wt=0;wt<m.symbolInstances.length;wt++)pt(wt);if(m.sortFeatures(this.transform.angle),this.retainedQueryData[m.bucketInstanceId]&&(this.retainedQueryData[m.bucketInstanceId].featureSortOrder=m.featureSortOrder),m.hasTextData()&&m.text.opacityVertexBuffer&&m.text.opacityVertexBuffer.updateData(m.text.opacityVertexArray),m.hasIconData()&&m.icon.opacityVertexBuffer&&m.icon.opacityVertexBuffer.updateData(m.icon.opacityVertexArray),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexBuffer&&m.iconCollisionBox.collisionVertexBuffer.updateData(m.iconCollisionBox.collisionVertexArray),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexBuffer&&m.textCollisionBox.collisionVertexBuffer.updateData(m.textCollisionBox.collisionVertexArray),m.bucketInstanceId in this.collisionCircleArrays){var dt=this.collisionCircleArrays[m.bucketInstanceId];m.placementInvProjMatrix=dt.invProjMatrix,m.placementViewportMatrix=dt.viewportMatrix,m.collisionCircleArray=dt.circles,delete this.collisionCircleArrays[m.bucketInstanceId]}},iu.prototype.symbolFadeChange=function(m){return this.fadeDuration===0?1:(m-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},iu.prototype.zoomAdjustment=function(m){return Math.max(0,(this.transform.zoom-m)/1.5)},iu.prototype.hasTransitions=function(m){return this.stale||m-this.lastPlacementChangeTime<this.fadeDuration},iu.prototype.stillRecent=function(m,w){var _=this.zoomAtLastRecencyCheck===w?1-this.zoomAdjustment(w):1;return this.zoomAtLastRecencyCheck=w,this.commitTime+this.fadeDuration*_>m},iu.prototype.setStale=function(){this.stale=!0};var Ut=Math.pow(2,25),Er=Math.pow(2,24),Sn=Math.pow(2,17),kr=Math.pow(2,16),wa=Math.pow(2,9),Xa=Math.pow(2,8),yl=Math.pow(2,1);function Jo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;var w=m.placed?1:0,_=Math.floor(127*m.opacity);return _*Ut+w*Er+_*Sn+w*kr+_*wa+w*Xa+_*yl+w}var au=0,ou=function(m){this._sortAcrossTiles=m.layout.get("symbol-z-order")!=="viewport-y"&&m.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ou.prototype.continuePlacement=function(m,w,_,T,N){for(var $=this._bucketParts;this._currentTileIndex<m.length;)if(w.getBucketParts($,T,m[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,N())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,$.sort(function(X,oe){return X.sortKey-oe.sortKey}));this._currentPartIndex<$.length;)if(w.placeLayerBucketPart($[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,N())return!0;return!1};var Ra=function(m,w,_,T,N,$,X){this.placement=new iu(m,N,$,X),this._currentPlacementIndex=w.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=T,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(m,w,_){for(var T=this,N=P.browser.now(),$=function(){var xe=P.browser.now()-N;return!T._forceFullPlacement&&xe>2};this._currentPlacementIndex>=0;){var X=w[m[this._currentPlacementIndex]],oe=this.placement.collisionIndex.transform.zoom;if(X.type==="symbol"&&(!X.minzoom||X.minzoom<=oe)&&(!X.maxzoom||X.maxzoom>oe)){if(this._inProgressLayer||(this._inProgressLayer=new ou(X)),this._inProgressLayer.continuePlacement(_[X.source],this.placement,this._showCollisionBoxes,X,$))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(m){return this.placement.commit(m),this.placement};var Mp=512/P.EXTENT/2,th=function(m,w,_){this.tileID=m,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(var T=0;T<w.length;T++){var N=w.get(T),$=N.key;this.indexedSymbolInstances[$]||(this.indexedSymbolInstances[$]=[]),this.indexedSymbolInstances[$].push({crossTileID:N.crossTileID,coord:this.getScaledCoordinates(N,m)})}};th.prototype.getScaledCoordinates=function(m,w){var _=Mp/Math.pow(2,w.canonical.z-this.tileID.canonical.z);return{x:Math.floor((w.canonical.x*P.EXTENT+m.anchorX)*_),y:Math.floor((w.canonical.y*P.EXTENT+m.anchorY)*_)}},th.prototype.findMatches=function(m,w,_){for(var T=this.tileID.canonical.z<w.canonical.z?1:Math.pow(2,this.tileID.canonical.z-w.canonical.z),N=0;N<m.length;N++){var $=m.get(N);if(!$.crossTileID){var X=this.indexedSymbolInstances[$.key];if(X)for(var oe=this.getScaledCoordinates($,w),xe=0,ye=X;xe<ye.length;xe+=1){var De=ye[xe];if(Math.abs(De.coord.x-oe.x)<=T&&Math.abs(De.coord.y-oe.y)<=T&&!_[De.crossTileID]){_[De.crossTileID]=!0,$.crossTileID=De.crossTileID;break}}}}};var su=function(){this.maxCrossTileID=0};su.prototype.generate=function(){return++this.maxCrossTileID};var _a=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};_a.prototype.handleWrapJump=function(m){var w=Math.round((m-this.lng)/360);if(w!==0)for(var _ in this.indexes){var T=this.indexes[_],N={};for(var $ in T){var X=T[$];X.tileID=X.tileID.unwrapTo(X.tileID.wrap+w),N[X.tileID.key]=X}this.indexes[_]=N}this.lng=m},_a.prototype.addBucket=function(m,w,_){if(this.indexes[m.overscaledZ]&&this.indexes[m.overscaledZ][m.key]){if(this.indexes[m.overscaledZ][m.key].bucketInstanceId===w.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(m.overscaledZ,this.indexes[m.overscaledZ][m.key])}for(var T=0;T<w.symbolInstances.length;T++)w.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[m.overscaledZ]||(this.usedCrossTileIDs[m.overscaledZ]={});var N=this.usedCrossTileIDs[m.overscaledZ];for(var $ in this.indexes){var X=this.indexes[$];if(Number($)>m.overscaledZ)for(var oe in X){var xe=X[oe];xe.tileID.isChildOf(m)&&xe.findMatches(w.symbolInstances,m,N)}else{var ye=X[m.scaledTo(Number($)).key];ye&&ye.findMatches(w.symbolInstances,m,N)}}for(var De=0;De<w.symbolInstances.length;De++){var He=w.symbolInstances.get(De);He.crossTileID||(He.crossTileID=_.generate(),N[He.crossTileID]=!0)}return this.indexes[m.overscaledZ]===void 0&&(this.indexes[m.overscaledZ]={}),this.indexes[m.overscaledZ][m.key]=new th(m,w.symbolInstances,w.bucketInstanceId),!0},_a.prototype.removeBucketCrossTileIDs=function(m,w){for(var _ in w.indexedSymbolInstances)for(var T=0,N=w.indexedSymbolInstances[_];T<N.length;T+=1)delete this.usedCrossTileIDs[m][N[T].crossTileID]},_a.prototype.removeStaleBuckets=function(m){var w=!1;for(var _ in this.indexes){var T=this.indexes[_];for(var N in T)m[T[N].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,T[N]),delete T[N],w=!0)}return w};var os=function(){this.layerIndexes={},this.crossTileIDs=new su,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};os.prototype.addLayer=function(m,w,_){var T=this.layerIndexes[m.id];T===void 0&&(T=this.layerIndexes[m.id]=new _a);var N=!1,$={};T.handleWrapJump(_);for(var X=0,oe=w;X<oe.length;X+=1){var xe=oe[X],ye=xe.getBucket(m);ye&&m.id===ye.layerIds[0]&&(ye.bucketInstanceId||(ye.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(xe.tileID,ye,this.crossTileIDs)&&(N=!0),$[ye.bucketInstanceId]=!0)}return T.removeStaleBuckets($)&&(N=!0),N},os.prototype.pruneUnusedLayers=function(m){var w={};for(var _ in m.forEach(function(T){w[T]=!0}),this.layerIndexes)w[_]||delete this.layerIndexes[_]};var Su=function(m,w){return P.emitValidationErrors(m,w&&w.filter(function(_){return _.identifier!=="source.canvas"}))},Eh=P.pick(jn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Mo=P.pick(jn,["setCenter","setZoom","setBearing","setPitch"]),cc=function(){var m={},w=P.styleSpec.$version;for(var _ in P.styleSpec.$root){var T,N=P.styleSpec.$root[_];N.required&&(T=_==="version"?w:N.type==="array"?[]:{})!=null&&(m[_]=T)}return m}(),uu=function(m){function w(_,T){var N=this;T===void 0&&(T={}),m.call(this),this.map=_,this.dispatcher=new Br(qr(),this),this.imageManager=new jt,this.imageManager.setEventedParent(this),this.glyphManager=new vn(_._requestManager,T.localIdeographFontFamily),this.lineAtlas=new or(256,512),this.crossTileSymbolIndex=new os,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new P.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",P.getReferrer());var $=this;this._rtlTextPluginCallback=w.registerForPluginStateChange(function(X){$.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:X.pluginStatus,pluginURL:X.pluginURL},function(oe,xe){if(P.triggerPluginCompletionEvent(oe),xe&&xe.every(function(De){return De}))for(var ye in $.sourceCaches)$.sourceCaches[ye].reload()})}),this.on("data",function(X){if(X.dataType==="source"&&X.sourceDataType==="metadata"){var oe=N.sourceCaches[X.sourceId];if(oe){var xe=oe.getSource();if(xe&&xe.vectorLayerIds)for(var ye in N._layers){var De=N._layers[ye];De.source===xe.id&&N._validateLayer(De)}}}})}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.loadURL=function(_,T){var N=this;T===void 0&&(T={}),this.fire(new P.Event("dataloading",{dataType:"style"}));var $=typeof T.validate=="boolean"?T.validate:!P.isMapboxURL(_);_=this.map._requestManager.normalizeStyleURL(_,T.accessToken);var X=this.map._requestManager.transformRequest(_,P.ResourceType.Style);this._request=P.getJSON(X,function(oe,xe){N._request=null,oe?N.fire(new P.ErrorEvent(oe)):xe&&N._load(xe,$)})},w.prototype.loadJSON=function(_,T){var N=this;T===void 0&&(T={}),this.fire(new P.Event("dataloading",{dataType:"style"})),this._request=P.browser.frame(function(){N._request=null,N._load(_,T.validate!==!1)})},w.prototype.loadEmpty=function(){this.fire(new P.Event("dataloading",{dataType:"style"})),this._load(cc,!1)},w.prototype._load=function(_,T){if(!T||!Su(this,P.validateStyle(_))){for(var N in this._loaded=!0,this.stylesheet=_,_.sources)this.addSource(N,_.sources[N],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs);var $=zn(this.stylesheet.layers);this._order=$.map(function(ye){return ye.id}),this._layers={},this._serializedLayers={};for(var X=0,oe=$;X<oe.length;X+=1){var xe=oe[X];(xe=P.createStyleLayer(xe)).setEventedParent(this,{layer:{id:xe.id}}),this._layers[xe.id]=xe,this._serializedLayers[xe.id]=xe.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new br(this.stylesheet.light),this.fire(new P.Event("data",{dataType:"style"})),this.fire(new P.Event("style.load"))}},w.prototype._loadSprite=function(_){var T=this;this._spriteRequest=function(N,$,X){var oe,xe,ye,De=P.browser.devicePixelRatio>1?"@2x":"",He=P.getJSON($.transformRequest($.normalizeSpriteURL(N,De,".json"),P.ResourceType.SpriteJSON),function(pt,wt){He=null,ye||(ye=pt,oe=wt,ft())}),$e=P.getImage($.transformRequest($.normalizeSpriteURL(N,De,".png"),P.ResourceType.SpriteImage),function(pt,wt){$e=null,ye||(ye=pt,xe=wt,ft())});function ft(){if(ye)X(ye);else if(oe&&xe){var pt=P.browser.getImageData(xe),wt={};for(var dt in oe){var Ft=oe[dt],ar=Ft.width,nr=Ft.height,Ir=Ft.x,_r=Ft.y,Qr=Ft.sdf,nn=Ft.pixelRatio,Ln=Ft.stretchX,Mn=Ft.stretchY,yi=Ft.content,Ri=new P.RGBAImage({width:ar,height:nr});P.RGBAImage.copy(pt,Ri,{x:Ir,y:_r},{x:0,y:0},{width:ar,height:nr}),wt[dt]={data:Ri,pixelRatio:nn,sdf:Qr,stretchX:Ln,stretchY:Mn,content:yi}}X(null,wt)}}return{cancel:function(){He&&(He.cancel(),He=null),$e&&($e.cancel(),$e=null)}}}(_,this.map._requestManager,function(N,$){if(T._spriteRequest=null,N)T.fire(new P.ErrorEvent(N));else if($)for(var X in $)T.imageManager.addImage(X,$[X]);T.imageManager.setLoaded(!0),T._availableImages=T.imageManager.listImages(),T.dispatcher.broadcast("setImages",T._availableImages),T.fire(new P.Event("data",{dataType:"style"}))})},w.prototype._validateLayer=function(_){var T=this.sourceCaches[_.source];if(T){var N=_.sourceLayer;if(N){var $=T.getSource();($.type==="geojson"||$.vectorLayerIds&&$.vectorLayerIds.indexOf(N)===-1)&&this.fire(new P.ErrorEvent(new Error('Source layer "'+N+'" does not exist on source "'+$.id+'" as specified by style layer "'+_.id+'"')))}}},w.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var _ in this.sourceCaches)if(!this.sourceCaches[_].loaded())return!1;return!!this.imageManager.isLoaded()},w.prototype._serializeLayers=function(_){for(var T=[],N=0,$=_;N<$.length;N+=1){var X=this._layers[$[N]];X.type!=="custom"&&T.push(X.serialize())}return T},w.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(var T in this._layers)if(this._layers[T].hasTransition())return!0;return!1},w.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},w.prototype.update=function(_){if(this._loaded){var T=this._changed;if(this._changed){var N=Object.keys(this._updatedLayers),$=Object.keys(this._removedLayers);for(var X in(N.length||$.length)&&this._updateWorkerLayers(N,$),this._updatedSources){var oe=this._updatedSources[X];oe==="reload"?this._reloadSource(X):oe==="clear"&&this._clearSource(X)}for(var xe in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[xe].updateTransitions(_);this.light.updateTransitions(_),this._resetUpdates()}var ye={};for(var De in this.sourceCaches){var He=this.sourceCaches[De];ye[De]=He.used,He.used=!1}for(var $e=0,ft=this._order;$e<ft.length;$e+=1){var pt=this._layers[ft[$e]];pt.recalculate(_,this._availableImages),!pt.isHidden(_.zoom)&&pt.source&&(this.sourceCaches[pt.source].used=!0)}for(var wt in ye){var dt=this.sourceCaches[wt];ye[wt]!==dt.used&&dt.fire(new P.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:wt}))}this.light.recalculate(_),this.z=_.zoom,T&&this.fire(new P.Event("data",{dataType:"style"}))}},w.prototype._updateTilesForChangedImages=function(){var _=Object.keys(this._changedImages);if(_.length){for(var T in this.sourceCaches)this.sourceCaches[T].reloadTilesForDependencies(["icons","patterns"],_);this._changedImages={}}},w.prototype._updateWorkerLayers=function(_,T){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(_),removedIds:T})},w.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},w.prototype.setState=function(_){var T=this;if(this._checkLoaded(),Su(this,P.validateStyle(_)))return!1;(_=P.clone$1(_)).layers=zn(_.layers);var N=function(X,oe){if(!X)return[{command:jn.setStyle,args:[oe]}];var xe=[];try{if(!P.deepEqual(X.version,oe.version))return[{command:jn.setStyle,args:[oe]}];P.deepEqual(X.center,oe.center)||xe.push({command:jn.setCenter,args:[oe.center]}),P.deepEqual(X.zoom,oe.zoom)||xe.push({command:jn.setZoom,args:[oe.zoom]}),P.deepEqual(X.bearing,oe.bearing)||xe.push({command:jn.setBearing,args:[oe.bearing]}),P.deepEqual(X.pitch,oe.pitch)||xe.push({command:jn.setPitch,args:[oe.pitch]}),P.deepEqual(X.sprite,oe.sprite)||xe.push({command:jn.setSprite,args:[oe.sprite]}),P.deepEqual(X.glyphs,oe.glyphs)||xe.push({command:jn.setGlyphs,args:[oe.glyphs]}),P.deepEqual(X.transition,oe.transition)||xe.push({command:jn.setTransition,args:[oe.transition]}),P.deepEqual(X.light,oe.light)||xe.push({command:jn.setLight,args:[oe.light]});var ye={},De=[];(function($e,ft,pt,wt){var dt;for(dt in ft=ft||{},$e=$e||{})$e.hasOwnProperty(dt)&&(ft.hasOwnProperty(dt)||ni(dt,pt,wt));for(dt in ft)ft.hasOwnProperty(dt)&&($e.hasOwnProperty(dt)?P.deepEqual($e[dt],ft[dt])||($e[dt].type==="geojson"&&ft[dt].type==="geojson"&&Ao($e,ft,dt)?pt.push({command:jn.setGeoJSONSourceData,args:[dt,ft[dt].data]}):za(dt,ft,pt,wt)):Ca(dt,ft,pt))})(X.sources,oe.sources,De,ye);var He=[];X.layers&&X.layers.forEach(function($e){ye[$e.source]?xe.push({command:jn.removeLayer,args:[$e.id]}):He.push($e)}),xe=xe.concat(De),function($e,ft,pt){ft=ft||[];var wt,dt,Ft,ar,nr,Ir,_r,Qr=($e=$e||[]).map(ys),nn=ft.map(ys),Ln=$e.reduce(oo,{}),Mn=ft.reduce(oo,{}),yi=Qr.slice(),Ri=Object.create(null);for(wt=0,dt=0;wt<Qr.length;wt++)Mn.hasOwnProperty(Ft=Qr[wt])?dt++:(pt.push({command:jn.removeLayer,args:[Ft]}),yi.splice(yi.indexOf(Ft,dt),1));for(wt=0,dt=0;wt<nn.length;wt++)yi[yi.length-1-wt]!==(Ft=nn[nn.length-1-wt])&&(Ln.hasOwnProperty(Ft)?(pt.push({command:jn.removeLayer,args:[Ft]}),yi.splice(yi.lastIndexOf(Ft,yi.length-dt),1)):dt++,pt.push({command:jn.addLayer,args:[Mn[Ft],Ir=yi[yi.length-wt]]}),yi.splice(yi.length-wt,0,Ft),Ri[Ft]=!0);for(wt=0;wt<nn.length;wt++)if(ar=Ln[Ft=nn[wt]],nr=Mn[Ft],!Ri[Ft]&&!P.deepEqual(ar,nr))if(P.deepEqual(ar.source,nr.source)&&P.deepEqual(ar["source-layer"],nr["source-layer"])&&P.deepEqual(ar.type,nr.type)){for(_r in io(ar.layout,nr.layout,pt,Ft,null,jn.setLayoutProperty),io(ar.paint,nr.paint,pt,Ft,null,jn.setPaintProperty),P.deepEqual(ar.filter,nr.filter)||pt.push({command:jn.setFilter,args:[Ft,nr.filter]}),P.deepEqual(ar.minzoom,nr.minzoom)&&P.deepEqual(ar.maxzoom,nr.maxzoom)||pt.push({command:jn.setLayerZoomRange,args:[Ft,nr.minzoom,nr.maxzoom]}),ar)ar.hasOwnProperty(_r)&&_r!=="layout"&&_r!=="paint"&&_r!=="filter"&&_r!=="metadata"&&_r!=="minzoom"&&_r!=="maxzoom"&&(_r.indexOf("paint.")===0?io(ar[_r],nr[_r],pt,Ft,_r.slice(6),jn.setPaintProperty):P.deepEqual(ar[_r],nr[_r])||pt.push({command:jn.setLayerProperty,args:[Ft,_r,nr[_r]]}));for(_r in nr)nr.hasOwnProperty(_r)&&!ar.hasOwnProperty(_r)&&_r!=="layout"&&_r!=="paint"&&_r!=="filter"&&_r!=="metadata"&&_r!=="minzoom"&&_r!=="maxzoom"&&(_r.indexOf("paint.")===0?io(ar[_r],nr[_r],pt,Ft,_r.slice(6),jn.setPaintProperty):P.deepEqual(ar[_r],nr[_r])||pt.push({command:jn.setLayerProperty,args:[Ft,_r,nr[_r]]}))}else pt.push({command:jn.removeLayer,args:[Ft]}),Ir=yi[yi.lastIndexOf(Ft)+1],pt.push({command:jn.addLayer,args:[nr,Ir]})}(He,oe.layers,xe)}catch($e){console.warn("Unable to compute style diff:",$e),xe=[{command:jn.setStyle,args:[oe]}]}return xe}(this.serialize(),_).filter(function(X){return!(X.command in Mo)});if(N.length===0)return!1;var $=N.filter(function(X){return!(X.command in Eh)});if($.length>0)throw new Error("Unimplemented: "+$.map(function(X){return X.command}).join(", ")+".");return N.forEach(function(X){X.command!=="setTransition"&&T[X.command].apply(T,X.args)}),this.stylesheet=_,!0},w.prototype.addImage=function(_,T){if(this.getImage(_))return this.fire(new P.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(_,T),this._afterImageUpdated(_)},w.prototype.updateImage=function(_,T){this.imageManager.updateImage(_,T)},w.prototype.getImage=function(_){return this.imageManager.getImage(_)},w.prototype.removeImage=function(_){if(!this.getImage(_))return this.fire(new P.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(_),this._afterImageUpdated(_)},w.prototype._afterImageUpdated=function(_){this._availableImages=this.imageManager.listImages(),this._changedImages[_]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new P.Event("data",{dataType:"style"}))},w.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},w.prototype.addSource=function(_,T,N){var $=this;if(N===void 0&&(N={}),this._checkLoaded(),this.sourceCaches[_]!==void 0)throw new Error("There is already a source with this ID");if(!T.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(T).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(T.type)>=0&&this._validate(P.validateStyle.source,"sources."+_,T,null,N))){this.map&&this.map._collectResourceTiming&&(T.collectResourceTiming=!0);var X=this.sourceCaches[_]=new Me(_,T,this.dispatcher);X.style=this,X.setEventedParent(this,function(){return{isSourceLoaded:$.loaded(),source:X.serialize(),sourceId:_}}),X.onAdd(this.map),this._changed=!0}},w.prototype.removeSource=function(_){if(this._checkLoaded(),this.sourceCaches[_]===void 0)throw new Error("There is no source with this ID");for(var T in this._layers)if(this._layers[T].source===_)return this.fire(new P.ErrorEvent(new Error('Source "'+_+'" cannot be removed while layer "'+T+'" is using it.')));var N=this.sourceCaches[_];delete this.sourceCaches[_],delete this._updatedSources[_],N.fire(new P.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_})),N.setEventedParent(null),N.clearTiles(),N.onRemove&&N.onRemove(this.map),this._changed=!0},w.prototype.setGeoJSONSourceData=function(_,T){this._checkLoaded(),this.sourceCaches[_].getSource().setData(T),this._changed=!0},w.prototype.getSource=function(_){return this.sourceCaches[_]&&this.sourceCaches[_].getSource()},w.prototype.addLayer=function(_,T,N){N===void 0&&(N={}),this._checkLoaded();var $=_.id;if(this.getLayer($))this.fire(new P.ErrorEvent(new Error('Layer with id "'+$+'" already exists on this map')));else{var X;if(_.type==="custom"){if(Su(this,P.validateCustomStyleLayer(_)))return;X=P.createStyleLayer(_)}else{if(typeof _.source=="object"&&(this.addSource($,_.source),_=P.clone$1(_),_=P.extend(_,{source:$})),this._validate(P.validateStyle.layer,"layers."+$,_,{arrayIndex:-1},N))return;X=P.createStyleLayer(_),this._validateLayer(X),X.setEventedParent(this,{layer:{id:$}}),this._serializedLayers[X.id]=X.serialize()}var oe=T?this._order.indexOf(T):this._order.length;if(T&&oe===-1)this.fire(new P.ErrorEvent(new Error('Layer with id "'+T+'" does not exist on this map.')));else{if(this._order.splice(oe,0,$),this._layerOrderChanged=!0,this._layers[$]=X,this._removedLayers[$]&&X.source&&X.type!=="custom"){var xe=this._removedLayers[$];delete this._removedLayers[$],xe.type!==X.type?this._updatedSources[X.source]="clear":(this._updatedSources[X.source]="reload",this.sourceCaches[X.source].pause())}this._updateLayer(X),X.onAdd&&X.onAdd(this.map)}}},w.prototype.moveLayer=function(_,T){if(this._checkLoaded(),this._changed=!0,this._layers[_]){if(_!==T){var N=this._order.indexOf(_);this._order.splice(N,1);var $=T?this._order.indexOf(T):this._order.length;T&&$===-1?this.fire(new P.ErrorEvent(new Error('Layer with id "'+T+'" does not exist on this map.'))):(this._order.splice($,0,_),this._layerOrderChanged=!0)}}else this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be moved.")))},w.prototype.removeLayer=function(_){this._checkLoaded();var T=this._layers[_];if(T){T.setEventedParent(null);var N=this._order.indexOf(_);this._order.splice(N,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[_]=T,delete this._layers[_],delete this._serializedLayers[_],delete this._updatedLayers[_],delete this._updatedPaintProps[_],T.onRemove&&T.onRemove(this.map)}else this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be removed.")))},w.prototype.getLayer=function(_){return this._layers[_]},w.prototype.hasLayer=function(_){return _ in this._layers},w.prototype.setLayerZoomRange=function(_,T,N){this._checkLoaded();var $=this.getLayer(_);$?$.minzoom===T&&$.maxzoom===N||(T!=null&&($.minzoom=T),N!=null&&($.maxzoom=N),this._updateLayer($)):this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot have zoom extent.")))},w.prototype.setFilter=function(_,T,N){N===void 0&&(N={}),this._checkLoaded();var $=this.getLayer(_);if($){if(!P.deepEqual($.filter,T))return T==null?($.filter=void 0,void this._updateLayer($)):void(this._validate(P.validateStyle.filter,"layers."+$.id+".filter",T,null,N)||($.filter=P.clone$1(T),this._updateLayer($)))}else this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be filtered.")))},w.prototype.getFilter=function(_){return P.clone$1(this.getLayer(_).filter)},w.prototype.setLayoutProperty=function(_,T,N,$){$===void 0&&($={}),this._checkLoaded();var X=this.getLayer(_);X?P.deepEqual(X.getLayoutProperty(T),N)||(X.setLayoutProperty(T,N,$),this._updateLayer(X)):this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},w.prototype.getLayoutProperty=function(_,T){var N=this.getLayer(_);if(N)return N.getLayoutProperty(T);this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style.")))},w.prototype.setPaintProperty=function(_,T,N,$){$===void 0&&($={}),this._checkLoaded();var X=this.getLayer(_);X?P.deepEqual(X.getPaintProperty(T),N)||(X.setPaintProperty(T,N,$)&&this._updateLayer(X),this._changed=!0,this._updatedPaintProps[_]=!0):this.fire(new P.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},w.prototype.getPaintProperty=function(_,T){return this.getLayer(_).getPaintProperty(T)},w.prototype.setFeatureState=function(_,T){this._checkLoaded();var N=_.source,$=_.sourceLayer,X=this.sourceCaches[N];if(X!==void 0){var oe=X.getSource().type;oe==="geojson"&&$?this.fire(new P.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):oe!=="vector"||$?(_.id===void 0&&this.fire(new P.ErrorEvent(new Error("The feature id parameter must be provided."))),X.setFeatureState($,_.id,T)):this.fire(new P.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new P.ErrorEvent(new Error("The source '"+N+"' does not exist in the map's style.")))},w.prototype.removeFeatureState=function(_,T){this._checkLoaded();var N=_.source,$=this.sourceCaches[N];if($!==void 0){var X=$.getSource().type,oe=X==="vector"?_.sourceLayer:void 0;X!=="vector"||oe?T&&typeof _.id!="string"&&typeof _.id!="number"?this.fire(new P.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):$.removeFeatureState(oe,_.id,T):this.fire(new P.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new P.ErrorEvent(new Error("The source '"+N+"' does not exist in the map's style.")))},w.prototype.getFeatureState=function(_){this._checkLoaded();var T=_.source,N=_.sourceLayer,$=this.sourceCaches[T];if($!==void 0){if($.getSource().type!=="vector"||N)return _.id===void 0&&this.fire(new P.ErrorEvent(new Error("The feature id parameter must be provided."))),$.getFeatureState(N,_.id);this.fire(new P.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new P.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},w.prototype.getTransition=function(){return P.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},w.prototype.serialize=function(){return P.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:P.mapObject(this.sourceCaches,function(_){return _.serialize()}),layers:this._serializeLayers(this._order)},function(_){return _!==void 0})},w.prototype._updateLayer=function(_){this._updatedLayers[_.id]=!0,_.source&&!this._updatedSources[_.source]&&this.sourceCaches[_.source].getSource().type!=="raster"&&(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause()),this._changed=!0},w.prototype._flattenAndSortRenderedFeatures=function(_){for(var T=this,N=function(Ln){return T._layers[Ln].type==="fill-extrusion"},$={},X=[],oe=this._order.length-1;oe>=0;oe--){var xe=this._order[oe];if(N(xe)){$[xe]=oe;for(var ye=0,De=_;ye<De.length;ye+=1){var He=De[ye][xe];if(He)for(var $e=0,ft=He;$e<ft.length;$e+=1)X.push(ft[$e])}}}X.sort(function(Ln,Mn){return Mn.intersectionZ-Ln.intersectionZ});for(var pt=[],wt=this._order.length-1;wt>=0;wt--){var dt=this._order[wt];if(N(dt))for(var Ft=X.length-1;Ft>=0;Ft--){var ar=X[Ft].feature;if($[ar.layer.id]<wt)break;pt.push(ar),X.pop()}else for(var nr=0,Ir=_;nr<Ir.length;nr+=1){var _r=Ir[nr][dt];if(_r)for(var Qr=0,nn=_r;Qr<nn.length;Qr+=1)pt.push(nn[Qr].feature)}}return pt},w.prototype.queryRenderedFeatures=function(_,T,N){T&&T.filter&&this._validate(P.validateStyle.filter,"queryRenderedFeatures.filter",T.filter,null,T);var $={};if(T&&T.layers){if(!Array.isArray(T.layers))return this.fire(new P.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var X=0,oe=T.layers;X<oe.length;X+=1){var xe=oe[X],ye=this._layers[xe];if(!ye)return this.fire(new P.ErrorEvent(new Error("The layer '"+xe+"' does not exist in the map's style and cannot be queried for features."))),[];$[ye.source]=!0}}var De=[];for(var He in T.availableImages=this._availableImages,this.sourceCaches)T.layers&&!$[He]||De.push(pi(this.sourceCaches[He],this._layers,this._serializedLayers,_,T,N));return this.placement&&De.push(function($e,ft,pt,wt,dt,Ft,ar){for(var nr={},Ir=Ft.queryRenderedSymbols(wt),_r=[],Qr=0,nn=Object.keys(Ir).map(Number);Qr<nn.length;Qr+=1)_r.push(ar[nn[Qr]]);_r.sort(Ka);for(var Ln=function(){var Vi=yi[Mn],ao=Vi.featureIndex.lookupSymbolFeatures(Ir[Vi.bucketInstanceId],ft,Vi.bucketIndex,Vi.sourceLayerIndex,dt.filter,dt.layers,dt.availableImages,$e);for(var Bi in ao){var oa=nr[Bi]=nr[Bi]||[],Ha=ao[Bi];Ha.sort(function(Qa,eo){var va=Vi.featureSortOrder;if(va){var tu=va.indexOf(Qa.featureIndex);return va.indexOf(eo.featureIndex)-tu}return eo.featureIndex-Qa.featureIndex});for(var ja=0,Sa=Ha;ja<Sa.length;ja+=1)oa.push(Sa[ja])}},Mn=0,yi=_r;Mn<yi.length;Mn+=1)Ln();var Ri=function(Vi){nr[Vi].forEach(function(ao){var Bi=ao.feature,oa=pt[$e[Vi].source].getFeatureState(Bi.layer["source-layer"],Bi.id);Bi.source=Bi.layer.source,Bi.layer["source-layer"]&&(Bi.sourceLayer=Bi.layer["source-layer"]),Bi.state=oa})};for(var Qi in nr)Ri(Qi);return nr}(this._layers,this._serializedLayers,this.sourceCaches,_,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(De)},w.prototype.querySourceFeatures=function(_,T){T&&T.filter&&this._validate(P.validateStyle.filter,"querySourceFeatures.filter",T.filter,null,T);var N=this.sourceCaches[_];return N?function($,X){for(var oe=$.getRenderableIds().map(function(ft){return $.getTileByID(ft)}),xe=[],ye={},De=0;De<oe.length;De++){var He=oe[De],$e=He.tileID.canonical.key;ye[$e]||(ye[$e]=!0,He.querySourceFeatures(xe,X))}return xe}(N,T):[]},w.prototype.addSourceType=function(_,T,N){return w.getSourceType(_)?N(new Error('A source type called "'+_+'" already exists.')):(w.setSourceType(_,T),T.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:_,url:T.workerSourceURL},N):N(null,null))},w.prototype.getLight=function(){return this.light.getLight()},w.prototype.setLight=function(_,T){T===void 0&&(T={}),this._checkLoaded();var N=this.light.getLight(),$=!1;for(var X in _)if(!P.deepEqual(_[X],N[X])){$=!0;break}if($){var oe={now:P.browser.now(),transition:P.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(_,T),this.light.updateTransitions(oe)}},w.prototype._validate=function(_,T,N,$,X){return X===void 0&&(X={}),(!X||X.validate!==!1)&&Su(this,_.call(P.validateStyle,P.extend({key:T,style:this.serialize(),value:N,styleSpec:P.styleSpec},$)))},w.prototype._remove=function(){for(var _ in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),P.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[_].setEventedParent(null);for(var T in this.sourceCaches)this.sourceCaches[T].clearTiles(),this.sourceCaches[T].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},w.prototype._clearSource=function(_){this.sourceCaches[_].clearTiles()},w.prototype._reloadSource=function(_){this.sourceCaches[_].resume(),this.sourceCaches[_].reload()},w.prototype._updateSources=function(_){for(var T in this.sourceCaches)this.sourceCaches[T].update(_)},w.prototype._generateCollisionBoxes=function(){for(var _ in this.sourceCaches)this._reloadSource(_)},w.prototype._updatePlacement=function(_,T,N,$,X){X===void 0&&(X=!1);for(var oe=!1,xe=!1,ye={},De=0,He=this._order;De<He.length;De+=1){var $e=this._layers[He[De]];if($e.type==="symbol"){if(!ye[$e.source]){var ft=this.sourceCaches[$e.source];ye[$e.source]=ft.getRenderableIds(!0).map(function(ar){return ft.getTileByID(ar)}).sort(function(ar,nr){return nr.tileID.overscaledZ-ar.tileID.overscaledZ||(ar.tileID.isLessThan(nr.tileID)?-1:1)})}var pt=this.crossTileSymbolIndex.addLayer($e,ye[$e.source],_.center.lng);oe=oe||pt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((X=X||this._layerOrderChanged||N===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.browser.now(),_.zoom))&&(this.pauseablePlacement=new Ra(_,this._order,X,T,N,$,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ye),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.browser.now()),xe=!0),oe&&this.pauseablePlacement.placement.setStale()),xe||oe)for(var wt=0,dt=this._order;wt<dt.length;wt+=1){var Ft=this._layers[dt[wt]];Ft.type==="symbol"&&this.placement.updateLayerOpacities(Ft,ye[Ft.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.browser.now())},w.prototype._releaseSymbolFadeTiles=function(){for(var _ in this.sourceCaches)this.sourceCaches[_].releaseSymbolFadeTiles()},w.prototype.getImages=function(_,T,N){this.imageManager.getImages(T.icons,N),this._updateTilesForChangedImages();var $=this.sourceCaches[T.source];$&&$.setDependencies(T.tileID.key,T.type,T.icons)},w.prototype.getGlyphs=function(_,T,N){this.glyphManager.getGlyphs(T.stacks,N)},w.prototype.getResource=function(_,T,N){return P.makeRequest(T,N)},w}(P.Evented);uu.getSourceType=function(m){return xn[m]},uu.setSourceType=function(m,w){xn[m]=w},uu.registerForPluginStateChange=P.registerForPluginStateChange;var Ja=P.createLayout([{name:"a_pos",type:"Int16",components:2}]),rf=Mu(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Yu=Mu(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Vs=Mu(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),yh=Mu(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),tl=Mu("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),vu=Mu(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ch=Mu(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Hf=Mu("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Vn=Mu("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),gi=Mu("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Hp=Mu(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),nf=Mu(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Gc=Mu(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),sd=Mu(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Bu=Mu(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),$d=Mu(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),rh=Mu(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ah=Mu(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),lp=Mu(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),hl=Mu(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),$f=Mu(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Th=Mu(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),_h=Mu(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),nh=Mu(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),$p=Mu(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),cp=Mu(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Mu(m,w){var _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,T=w.match(/attribute ([\w]+) ([\w]+)/g),N=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),$=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),X=$?$.concat(N):N,oe={};return{fragmentSource:m=m.replace(_,function(xe,ye,De,He,$e){return oe[$e]=!0,ye==="define"?`
#ifndef HAS_UNIFORM_u_`+$e+`
varying `+De+" "+He+" "+$e+`;
#else
uniform `+De+" "+He+" u_"+$e+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+$e+`
    `+De+" "+He+" "+$e+" = u_"+$e+`;
#endif
`}),vertexSource:w=w.replace(_,function(xe,ye,De,He,$e){var ft=He==="float"?"vec2":"vec4",pt=$e.match(/color/)?"color":ft;return oe[$e]?ye==="define"?`
#ifndef HAS_UNIFORM_u_`+$e+`
uniform lowp float u_`+$e+`_t;
attribute `+De+" "+ft+" a_"+$e+`;
varying `+De+" "+He+" "+$e+`;
#else
uniform `+De+" "+He+" u_"+$e+`;
#endif
`:pt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+$e+`
    `+$e+" = a_"+$e+`;
#else
    `+De+" "+He+" "+$e+" = u_"+$e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+$e+`
    `+$e+" = unpack_mix_"+pt+"(a_"+$e+", u_"+$e+`_t);
#else
    `+De+" "+He+" "+$e+" = u_"+$e+`;
#endif
`:ye==="define"?`
#ifndef HAS_UNIFORM_u_`+$e+`
uniform lowp float u_`+$e+`_t;
attribute `+De+" "+ft+" a_"+$e+`;
#else
uniform `+De+" "+He+" u_"+$e+`;
#endif
`:pt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+$e+`
    `+De+" "+He+" "+$e+" = a_"+$e+`;
#else
    `+De+" "+He+" "+$e+" = u_"+$e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+$e+`
    `+De+" "+He+" "+$e+" = unpack_mix_"+pt+"(a_"+$e+", u_"+$e+`_t);
#else
    `+De+" "+He+" "+$e+" = u_"+$e+`;
#endif
`}),staticAttributes:T,staticUniforms:X}}var af=Object.freeze({__proto__:null,prelude:rf,background:Yu,backgroundPattern:Vs,circle:yh,clippingMask:tl,heatmap:vu,heatmapTexture:Ch,collisionBox:Hf,collisionCircle:Vn,debug:gi,fill:Hp,fillOutline:nf,fillOutlinePattern:Gc,fillPattern:sd,fillExtrusion:Bu,fillExtrusionPattern:$d,hillshadePrepare:rh,hillshade:Ah,line:lp,lineGradient:hl,linePattern:$f,lineSDF:Th,raster:_h,symbolIcon:nh,symbolSDF:$p,symbolTextAndIcon:cp}),hp=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ih(m){for(var w=[],_=0;_<m.length;_++)if(m[_]!==null){var T=m[_].split(" ");w.push(T.pop())}return w}hp.prototype.bind=function(m,w,_,T,N,$,X,oe){this.context=m;for(var xe=this.boundPaintVertexBuffers.length!==T.length,ye=0;!xe&&ye<T.length;ye++)this.boundPaintVertexBuffers[ye]!==T[ye]&&(xe=!0);m.extVertexArrayObject&&this.vao&&this.boundProgram===w&&this.boundLayoutVertexBuffer===_&&!xe&&this.boundIndexBuffer===N&&this.boundVertexOffset===$&&this.boundDynamicVertexBuffer===X&&this.boundDynamicVertexBuffer2===oe?(m.bindVertexArrayOES.set(this.vao),X&&X.bind(),N&&N.dynamicDraw&&N.bind(),oe&&oe.bind()):this.freshBind(w,_,T,N,$,X,oe)},hp.prototype.freshBind=function(m,w,_,T,N,$,X){var oe,xe=m.numAttributes,ye=this.context,De=ye.gl;if(ye.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ye.extVertexArrayObject.createVertexArrayOES(),ye.bindVertexArrayOES.set(this.vao),oe=0,this.boundProgram=m,this.boundLayoutVertexBuffer=w,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=T,this.boundVertexOffset=N,this.boundDynamicVertexBuffer=$,this.boundDynamicVertexBuffer2=X;else{oe=ye.currentNumAttributes||0;for(var He=xe;He<oe;He++)De.disableVertexAttribArray(He)}w.enableAttributes(De,m);for(var $e=0,ft=_;$e<ft.length;$e+=1)ft[$e].enableAttributes(De,m);$&&$.enableAttributes(De,m),X&&X.enableAttributes(De,m),w.bind(),w.setVertexAttribPointers(De,m,N);for(var pt=0,wt=_;pt<wt.length;pt+=1){var dt=wt[pt];dt.bind(),dt.setVertexAttribPointers(De,m,N)}$&&($.bind(),$.setVertexAttribPointers(De,m,N)),T&&T.bind(),X&&(X.bind(),X.setVertexAttribPointers(De,m,N)),ye.currentNumAttributes=xe},hp.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var fp=function(m,w,_,T,N,$){var X=m.gl;this.program=X.createProgram();for(var oe=ih(_.staticAttributes),xe=T?T.getBinderAttributes():[],ye=oe.concat(xe),De=_.staticUniforms?ih(_.staticUniforms):[],He=T?T.getBinderUniforms():[],$e=[],ft=0,pt=De.concat(He);ft<pt.length;ft+=1){var wt=pt[ft];$e.indexOf(wt)<0&&$e.push(wt)}var dt=T?T.defines():[];$&&dt.push("#define OVERDRAW_INSPECTOR;");var Ft=dt.concat(rf.fragmentSource,_.fragmentSource).join(`
`),ar=dt.concat(rf.vertexSource,_.vertexSource).join(`
`),nr=X.createShader(X.FRAGMENT_SHADER);if(X.isContextLost())this.failedToCreate=!0;else{X.shaderSource(nr,Ft),X.compileShader(nr),X.attachShader(this.program,nr);var Ir=X.createShader(X.VERTEX_SHADER);if(X.isContextLost())this.failedToCreate=!0;else{X.shaderSource(Ir,ar),X.compileShader(Ir),X.attachShader(this.program,Ir),this.attributes={};var _r={};this.numAttributes=ye.length;for(var Qr=0;Qr<this.numAttributes;Qr++)ye[Qr]&&(X.bindAttribLocation(this.program,Qr,ye[Qr]),this.attributes[ye[Qr]]=Qr);X.linkProgram(this.program),X.deleteShader(Ir),X.deleteShader(nr);for(var nn=0;nn<$e.length;nn++){var Ln=$e[nn];if(Ln&&!_r[Ln]){var Mn=X.getUniformLocation(this.program,Ln);Mn&&(_r[Ln]=Mn)}}this.fixedUniforms=N(m,_r),this.binderUniforms=T?T.getUniforms(m,_r):[]}}};function Vh(m,w,_){var T=1/Uo(_,1,w.transform.tileZoom),N=Math.pow(2,_.tileID.overscaledZ),$=_.tileSize*Math.pow(2,w.transform.tileZoom)/N,X=$*(_.tileID.canonical.x+_.tileID.wrap*N),oe=$*_.tileID.canonical.y;return{u_image:0,u_texsize:_.imageAtlasTexture.size,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[X>>16,oe>>16],u_pixel_coord_lower:[65535&X,65535&oe]}}fp.prototype.draw=function(m,w,_,T,N,$,X,oe,xe,ye,De,He,$e,ft,pt,wt){var dt,Ft=m.gl;if(!this.failedToCreate){for(var ar in m.program.set(this.program),m.setDepthMode(_),m.setStencilMode(T),m.setColorMode(N),m.setCullFace($),this.fixedUniforms)this.fixedUniforms[ar].set(X[ar]);ft&&ft.setUniforms(m,this.binderUniforms,He,{zoom:$e});for(var nr=(dt={},dt[Ft.LINES]=2,dt[Ft.TRIANGLES]=3,dt[Ft.LINE_STRIP]=1,dt)[w],Ir=0,_r=De.get();Ir<_r.length;Ir+=1){var Qr=_r[Ir],nn=Qr.vaos||(Qr.vaos={});(nn[oe]||(nn[oe]=new hp)).bind(m,this,xe,ft?ft.getPaintVertexBuffers():[],ye,Qr.vertexOffset,pt,wt),Ft.drawElements(w,Qr.primitiveLength*nr,Ft.UNSIGNED_SHORT,Qr.primitiveOffset*nr*2)}}};var Nu=function(m,w,_,T){var N=w.style.light,$=N.properties.get("position"),X=[$.x,$.y,$.z],oe=P.create$1();N.properties.get("anchor")==="viewport"&&P.fromRotation(oe,-w.transform.angle),P.transformMat3(X,X,oe);var xe=N.properties.get("color");return{u_matrix:m,u_lightpos:X,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_vertical_gradient:+_,u_opacity:T}},Wf=function(m,w,_,T,N,$,X){return P.extend(Nu(m,w,_,T),Vh($,w,X),{u_height_factor:-Math.pow(2,N.overscaledZ)/X.tileSize/8})},Sf=function(m){return{u_matrix:m}},ko=function(m,w,_,T){return P.extend(Sf(m),Vh(_,w,T))},rl=function(m,w){return{u_matrix:m,u_world:w}},pp=function(m,w,_,T,N){return P.extend(ko(m,w,_,T),{u_world:N})},jo=function(m,w,_,T){var N,$,X=m.transform;if(T.paint.get("circle-pitch-alignment")==="map"){var oe=Uo(_,1,X.zoom);N=!0,$=[oe,oe]}else N=!1,$=X.pixelsToGLUnits;return{u_camera_to_center_distance:X.cameraToCenterDistance,u_scale_with_map:+(T.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(w.posMatrix,_,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_pitch_with_map:+N,u_device_pixel_ratio:P.browser.devicePixelRatio,u_extrude_scale:$}},hc=function(m,w,_){var T=Uo(_,1,w.zoom),N=Math.pow(2,w.zoom-_.tileID.overscaledZ),$=_.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:w.cameraToCenterDistance,u_pixels_to_tile_units:T,u_extrude_scale:[w.pixelsToGLUnits[0]/(T*N),w.pixelsToGLUnits[1]/(T*N)],u_overscale_factor:$}},_u=function(m,w,_){return{u_matrix:m,u_inv_matrix:w,u_camera_to_center_distance:_.cameraToCenterDistance,u_viewport_size:[_.width,_.height]}},mu=function(m,w,_){return _===void 0&&(_=1),{u_matrix:m,u_color:w,u_overlay:0,u_overlay_scale:_}},Mh=function(m){return{u_matrix:m}},ud=function(m,w,_,T){return{u_matrix:m,u_extrude_scale:Uo(w,1,_),u_intensity:T}},of=function(m,w,_){var T=m.transform;return{u_matrix:wd(m,w,_),u_ratio:1/Uo(w,1,T.zoom),u_device_pixel_ratio:P.browser.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Eu=function(m,w,_,T){return P.extend(of(m,w,_),{u_image:0,u_image_height:T})},dp=function(m,w,_,T){var N=m.transform,$=Ph(w,N);return{u_matrix:wd(m,w,_),u_texsize:w.imageAtlasTexture.size,u_ratio:1/Uo(w,1,N.zoom),u_device_pixel_ratio:P.browser.devicePixelRatio,u_image:0,u_scale:[$,T.fromScale,T.toScale],u_fade:T.t,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]]}},Wp=function(m,w,_,T,N){var $=m.lineAtlas,X=Ph(w,m.transform),oe=_.layout.get("line-cap")==="round",xe=$.getDash(T.from,oe),ye=$.getDash(T.to,oe),De=xe.width*N.fromScale,He=ye.width*N.toScale;return P.extend(of(m,w,_),{u_patternscale_a:[X/De,-xe.height/2],u_patternscale_b:[X/He,-ye.height/2],u_sdfgamma:$.width/(256*Math.min(De,He)*P.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:xe.y,u_tex_y_b:ye.y,u_mix:N.t})};function Ph(m,w){return 1/Uo(m,1,w.tileZoom)}function wd(m,w,_){return m.translatePosMatrix(w.tileID.posMatrix,w,_.paint.get("line-translate"),_.paint.get("line-translate-anchor"))}var Xp=function(m,w,_,T,N){return{u_matrix:m,u_tl_parent:w,u_scale_parent:_,u_buffer_scale:1,u_fade_t:T.mix,u_opacity:T.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:(X=N.paint.get("raster-saturation"),X>0?1-1/(1.001-X):-X),u_contrast_factor:($=N.paint.get("raster-contrast"),$>0?1/(1-$):1+$),u_spin_weights:vp(N.paint.get("raster-hue-rotate"))};var $,X};function vp(m){m*=Math.PI/180;var w=Math.sin(m),_=Math.cos(m);return[(2*_+1)/3,(-Math.sqrt(3)*w-_+1)/3,(Math.sqrt(3)*w-_+1)/3]}var Ga,mp=function(m,w,_,T,N,$,X,oe,xe,ye){var De=N.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:w?w.uSizeT:0,u_size:w?w.uSize:0,u_camera_to_center_distance:De.cameraToCenterDistance,u_pitch:De.pitch/360*2*Math.PI,u_rotate_symbol:+_,u_aspect_ratio:De.width/De.height,u_fade_change:N.options.fadeDuration?N.symbolFadeChange:1,u_matrix:$,u_label_plane_matrix:X,u_coord_matrix:oe,u_is_text:+xe,u_pitch_with_map:+T,u_texsize:ye,u_texture:0}},Hc=function(m,w,_,T,N,$,X,oe,xe,ye,De){var He=N.transform;return P.extend(mp(m,w,_,T,N,$,X,oe,xe,ye),{u_gamma_scale:T?Math.cos(He._pitch)*He.cameraToCenterDistance:1,u_device_pixel_ratio:P.browser.devicePixelRatio,u_is_halo:+De})},gp=function(m,w,_,T,N,$,X,oe,xe,ye){return P.extend(Hc(m,w,_,T,N,$,X,oe,!0,xe,!0),{u_texsize_icon:ye,u_texture_icon:1})},sf=function(m,w,_){return{u_matrix:m,u_opacity:w,u_color:_}},ah=function(m,w,_,T,N,$){return P.extend(function(X,oe,xe,ye){var De=xe.imageManager.getPattern(X.from.toString()),He=xe.imageManager.getPattern(X.to.toString()),$e=xe.imageManager.getPixelSize(),ft=$e.width,pt=$e.height,wt=Math.pow(2,ye.tileID.overscaledZ),dt=ye.tileSize*Math.pow(2,xe.transform.tileZoom)/wt,Ft=dt*(ye.tileID.canonical.x+ye.tileID.wrap*wt),ar=dt*ye.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:De.tl,u_pattern_br_a:De.br,u_pattern_tl_b:He.tl,u_pattern_br_b:He.br,u_texsize:[ft,pt],u_mix:oe.t,u_pattern_size_a:De.displaySize,u_pattern_size_b:He.displaySize,u_scale_a:oe.fromScale,u_scale_b:oe.toScale,u_tile_units_to_pixels:1/Uo(ye,1,xe.transform.tileZoom),u_pixel_coord_upper:[Ft>>16,ar>>16],u_pixel_coord_lower:[65535&Ft,65535&ar]}}(T,$,_,N),{u_matrix:m,u_opacity:w})},wo={fillExtrusion:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_lightpos:new P.Uniform3f(m,w.u_lightpos),u_lightintensity:new P.Uniform1f(m,w.u_lightintensity),u_lightcolor:new P.Uniform3f(m,w.u_lightcolor),u_vertical_gradient:new P.Uniform1f(m,w.u_vertical_gradient),u_opacity:new P.Uniform1f(m,w.u_opacity)}},fillExtrusionPattern:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_lightpos:new P.Uniform3f(m,w.u_lightpos),u_lightintensity:new P.Uniform1f(m,w.u_lightintensity),u_lightcolor:new P.Uniform3f(m,w.u_lightcolor),u_vertical_gradient:new P.Uniform1f(m,w.u_vertical_gradient),u_height_factor:new P.Uniform1f(m,w.u_height_factor),u_image:new P.Uniform1i(m,w.u_image),u_texsize:new P.Uniform2f(m,w.u_texsize),u_pixel_coord_upper:new P.Uniform2f(m,w.u_pixel_coord_upper),u_pixel_coord_lower:new P.Uniform2f(m,w.u_pixel_coord_lower),u_scale:new P.Uniform3f(m,w.u_scale),u_fade:new P.Uniform1f(m,w.u_fade),u_opacity:new P.Uniform1f(m,w.u_opacity)}},fill:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix)}},fillPattern:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_image:new P.Uniform1i(m,w.u_image),u_texsize:new P.Uniform2f(m,w.u_texsize),u_pixel_coord_upper:new P.Uniform2f(m,w.u_pixel_coord_upper),u_pixel_coord_lower:new P.Uniform2f(m,w.u_pixel_coord_lower),u_scale:new P.Uniform3f(m,w.u_scale),u_fade:new P.Uniform1f(m,w.u_fade)}},fillOutline:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_world:new P.Uniform2f(m,w.u_world)}},fillOutlinePattern:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_world:new P.Uniform2f(m,w.u_world),u_image:new P.Uniform1i(m,w.u_image),u_texsize:new P.Uniform2f(m,w.u_texsize),u_pixel_coord_upper:new P.Uniform2f(m,w.u_pixel_coord_upper),u_pixel_coord_lower:new P.Uniform2f(m,w.u_pixel_coord_lower),u_scale:new P.Uniform3f(m,w.u_scale),u_fade:new P.Uniform1f(m,w.u_fade)}},circle:function(m,w){return{u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_scale_with_map:new P.Uniform1i(m,w.u_scale_with_map),u_pitch_with_map:new P.Uniform1i(m,w.u_pitch_with_map),u_extrude_scale:new P.Uniform2f(m,w.u_extrude_scale),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_matrix:new P.UniformMatrix4f(m,w.u_matrix)}},collisionBox:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_pixels_to_tile_units:new P.Uniform1f(m,w.u_pixels_to_tile_units),u_extrude_scale:new P.Uniform2f(m,w.u_extrude_scale),u_overscale_factor:new P.Uniform1f(m,w.u_overscale_factor)}},collisionCircle:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_inv_matrix:new P.UniformMatrix4f(m,w.u_inv_matrix),u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_viewport_size:new P.Uniform2f(m,w.u_viewport_size)}},debug:function(m,w){return{u_color:new P.UniformColor(m,w.u_color),u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_overlay:new P.Uniform1i(m,w.u_overlay),u_overlay_scale:new P.Uniform1f(m,w.u_overlay_scale)}},clippingMask:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix)}},heatmap:function(m,w){return{u_extrude_scale:new P.Uniform1f(m,w.u_extrude_scale),u_intensity:new P.Uniform1f(m,w.u_intensity),u_matrix:new P.UniformMatrix4f(m,w.u_matrix)}},heatmapTexture:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_world:new P.Uniform2f(m,w.u_world),u_image:new P.Uniform1i(m,w.u_image),u_color_ramp:new P.Uniform1i(m,w.u_color_ramp),u_opacity:new P.Uniform1f(m,w.u_opacity)}},hillshade:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_image:new P.Uniform1i(m,w.u_image),u_latrange:new P.Uniform2f(m,w.u_latrange),u_light:new P.Uniform2f(m,w.u_light),u_shadow:new P.UniformColor(m,w.u_shadow),u_highlight:new P.UniformColor(m,w.u_highlight),u_accent:new P.UniformColor(m,w.u_accent)}},hillshadePrepare:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_image:new P.Uniform1i(m,w.u_image),u_dimension:new P.Uniform2f(m,w.u_dimension),u_zoom:new P.Uniform1f(m,w.u_zoom),u_unpack:new P.Uniform4f(m,w.u_unpack)}},line:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_ratio:new P.Uniform1f(m,w.u_ratio),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_units_to_pixels:new P.Uniform2f(m,w.u_units_to_pixels)}},lineGradient:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_ratio:new P.Uniform1f(m,w.u_ratio),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_units_to_pixels:new P.Uniform2f(m,w.u_units_to_pixels),u_image:new P.Uniform1i(m,w.u_image),u_image_height:new P.Uniform1f(m,w.u_image_height)}},linePattern:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_texsize:new P.Uniform2f(m,w.u_texsize),u_ratio:new P.Uniform1f(m,w.u_ratio),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_image:new P.Uniform1i(m,w.u_image),u_units_to_pixels:new P.Uniform2f(m,w.u_units_to_pixels),u_scale:new P.Uniform3f(m,w.u_scale),u_fade:new P.Uniform1f(m,w.u_fade)}},lineSDF:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_ratio:new P.Uniform1f(m,w.u_ratio),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_units_to_pixels:new P.Uniform2f(m,w.u_units_to_pixels),u_patternscale_a:new P.Uniform2f(m,w.u_patternscale_a),u_patternscale_b:new P.Uniform2f(m,w.u_patternscale_b),u_sdfgamma:new P.Uniform1f(m,w.u_sdfgamma),u_image:new P.Uniform1i(m,w.u_image),u_tex_y_a:new P.Uniform1f(m,w.u_tex_y_a),u_tex_y_b:new P.Uniform1f(m,w.u_tex_y_b),u_mix:new P.Uniform1f(m,w.u_mix)}},raster:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_tl_parent:new P.Uniform2f(m,w.u_tl_parent),u_scale_parent:new P.Uniform1f(m,w.u_scale_parent),u_buffer_scale:new P.Uniform1f(m,w.u_buffer_scale),u_fade_t:new P.Uniform1f(m,w.u_fade_t),u_opacity:new P.Uniform1f(m,w.u_opacity),u_image0:new P.Uniform1i(m,w.u_image0),u_image1:new P.Uniform1i(m,w.u_image1),u_brightness_low:new P.Uniform1f(m,w.u_brightness_low),u_brightness_high:new P.Uniform1f(m,w.u_brightness_high),u_saturation_factor:new P.Uniform1f(m,w.u_saturation_factor),u_contrast_factor:new P.Uniform1f(m,w.u_contrast_factor),u_spin_weights:new P.Uniform3f(m,w.u_spin_weights)}},symbolIcon:function(m,w){return{u_is_size_zoom_constant:new P.Uniform1i(m,w.u_is_size_zoom_constant),u_is_size_feature_constant:new P.Uniform1i(m,w.u_is_size_feature_constant),u_size_t:new P.Uniform1f(m,w.u_size_t),u_size:new P.Uniform1f(m,w.u_size),u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_pitch:new P.Uniform1f(m,w.u_pitch),u_rotate_symbol:new P.Uniform1i(m,w.u_rotate_symbol),u_aspect_ratio:new P.Uniform1f(m,w.u_aspect_ratio),u_fade_change:new P.Uniform1f(m,w.u_fade_change),u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_label_plane_matrix:new P.UniformMatrix4f(m,w.u_label_plane_matrix),u_coord_matrix:new P.UniformMatrix4f(m,w.u_coord_matrix),u_is_text:new P.Uniform1i(m,w.u_is_text),u_pitch_with_map:new P.Uniform1i(m,w.u_pitch_with_map),u_texsize:new P.Uniform2f(m,w.u_texsize),u_texture:new P.Uniform1i(m,w.u_texture)}},symbolSDF:function(m,w){return{u_is_size_zoom_constant:new P.Uniform1i(m,w.u_is_size_zoom_constant),u_is_size_feature_constant:new P.Uniform1i(m,w.u_is_size_feature_constant),u_size_t:new P.Uniform1f(m,w.u_size_t),u_size:new P.Uniform1f(m,w.u_size),u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_pitch:new P.Uniform1f(m,w.u_pitch),u_rotate_symbol:new P.Uniform1i(m,w.u_rotate_symbol),u_aspect_ratio:new P.Uniform1f(m,w.u_aspect_ratio),u_fade_change:new P.Uniform1f(m,w.u_fade_change),u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_label_plane_matrix:new P.UniformMatrix4f(m,w.u_label_plane_matrix),u_coord_matrix:new P.UniformMatrix4f(m,w.u_coord_matrix),u_is_text:new P.Uniform1i(m,w.u_is_text),u_pitch_with_map:new P.Uniform1i(m,w.u_pitch_with_map),u_texsize:new P.Uniform2f(m,w.u_texsize),u_texture:new P.Uniform1i(m,w.u_texture),u_gamma_scale:new P.Uniform1f(m,w.u_gamma_scale),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_is_halo:new P.Uniform1i(m,w.u_is_halo)}},symbolTextAndIcon:function(m,w){return{u_is_size_zoom_constant:new P.Uniform1i(m,w.u_is_size_zoom_constant),u_is_size_feature_constant:new P.Uniform1i(m,w.u_is_size_feature_constant),u_size_t:new P.Uniform1f(m,w.u_size_t),u_size:new P.Uniform1f(m,w.u_size),u_camera_to_center_distance:new P.Uniform1f(m,w.u_camera_to_center_distance),u_pitch:new P.Uniform1f(m,w.u_pitch),u_rotate_symbol:new P.Uniform1i(m,w.u_rotate_symbol),u_aspect_ratio:new P.Uniform1f(m,w.u_aspect_ratio),u_fade_change:new P.Uniform1f(m,w.u_fade_change),u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_label_plane_matrix:new P.UniformMatrix4f(m,w.u_label_plane_matrix),u_coord_matrix:new P.UniformMatrix4f(m,w.u_coord_matrix),u_is_text:new P.Uniform1i(m,w.u_is_text),u_pitch_with_map:new P.Uniform1i(m,w.u_pitch_with_map),u_texsize:new P.Uniform2f(m,w.u_texsize),u_texsize_icon:new P.Uniform2f(m,w.u_texsize_icon),u_texture:new P.Uniform1i(m,w.u_texture),u_texture_icon:new P.Uniform1i(m,w.u_texture_icon),u_gamma_scale:new P.Uniform1f(m,w.u_gamma_scale),u_device_pixel_ratio:new P.Uniform1f(m,w.u_device_pixel_ratio),u_is_halo:new P.Uniform1i(m,w.u_is_halo)}},background:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_opacity:new P.Uniform1f(m,w.u_opacity),u_color:new P.UniformColor(m,w.u_color)}},backgroundPattern:function(m,w){return{u_matrix:new P.UniformMatrix4f(m,w.u_matrix),u_opacity:new P.Uniform1f(m,w.u_opacity),u_image:new P.Uniform1i(m,w.u_image),u_pattern_tl_a:new P.Uniform2f(m,w.u_pattern_tl_a),u_pattern_br_a:new P.Uniform2f(m,w.u_pattern_br_a),u_pattern_tl_b:new P.Uniform2f(m,w.u_pattern_tl_b),u_pattern_br_b:new P.Uniform2f(m,w.u_pattern_br_b),u_texsize:new P.Uniform2f(m,w.u_texsize),u_mix:new P.Uniform1f(m,w.u_mix),u_pattern_size_a:new P.Uniform2f(m,w.u_pattern_size_a),u_pattern_size_b:new P.Uniform2f(m,w.u_pattern_size_b),u_scale_a:new P.Uniform1f(m,w.u_scale_a),u_scale_b:new P.Uniform1f(m,w.u_scale_b),u_pixel_coord_upper:new P.Uniform2f(m,w.u_pixel_coord_upper),u_pixel_coord_lower:new P.Uniform2f(m,w.u_pixel_coord_lower),u_tile_units_to_pixels:new P.Uniform1f(m,w.u_tile_units_to_pixels)}}};function fl(m,w,_,T,N,$,X){for(var oe=m.context,xe=oe.gl,ye=m.useProgram("collisionBox"),De=[],He=0,$e=0,ft=0;ft<T.length;ft++){var pt=T[ft],wt=w.getTile(pt),dt=wt.getBucket(_);if(dt){var Ft=pt.posMatrix;N[0]===0&&N[1]===0||(Ft=m.translatePosMatrix(pt.posMatrix,wt,N,$));var ar=X?dt.textCollisionBox:dt.iconCollisionBox,nr=dt.collisionCircleArray;if(nr.length>0){var Ir=P.create(),_r=Ft;P.mul(Ir,dt.placementInvProjMatrix,m.transform.glCoordMatrix),P.mul(Ir,Ir,dt.placementViewportMatrix),De.push({circleArray:nr,circleOffset:$e,transform:_r,invTransform:Ir}),$e=He+=nr.length/4}ar&&ye.draw(oe,xe.LINES,Re.disabled,Xe.disabled,m.colorModeForRenderPass(),Ye.disabled,hc(Ft,m.transform,wt),_.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,null,m.transform.zoom,null,null,ar.collisionVertexBuffer)}}if(X&&De.length){var Qr=m.useProgram("collisionCircle"),nn=new P.StructArrayLayout2f1f2i16;nn.resize(4*He),nn._trim();for(var Ln=0,Mn=0,yi=De;Mn<yi.length;Mn+=1)for(var Ri=yi[Mn],Qi=0;Qi<Ri.circleArray.length/4;Qi++){var Vi=4*Qi,ao=Ri.circleArray[Vi+0],Bi=Ri.circleArray[Vi+1],oa=Ri.circleArray[Vi+2],Ha=Ri.circleArray[Vi+3];nn.emplace(Ln++,ao,Bi,oa,Ha,0),nn.emplace(Ln++,ao,Bi,oa,Ha,1),nn.emplace(Ln++,ao,Bi,oa,Ha,2),nn.emplace(Ln++,ao,Bi,oa,Ha,3)}(!Ga||Ga.length<2*He)&&(Ga=function(Gs){var Tl=2*Gs,Ps=new P.StructArrayLayout3ui6;Ps.resize(Tl),Ps._trim();for(var Qo=0;Qo<Tl;Qo++){var Zs=6*Qo;Ps.uint16[Zs+0]=4*Qo+0,Ps.uint16[Zs+1]=4*Qo+1,Ps.uint16[Zs+2]=4*Qo+2,Ps.uint16[Zs+3]=4*Qo+2,Ps.uint16[Zs+4]=4*Qo+3,Ps.uint16[Zs+5]=4*Qo+0}return Ps}(He));for(var ja=oe.createIndexBuffer(Ga,!0),Sa=oe.createVertexBuffer(nn,P.collisionCircleLayout.members,!0),Qa=0,eo=De;Qa<eo.length;Qa+=1){var va=eo[Qa],tu=_u(va.transform,va.invTransform,m.transform);Qr.draw(oe,xe.TRIANGLES,Re.disabled,Xe.disabled,m.colorModeForRenderPass(),Ye.disabled,tu,_.id,Sa,ja,P.SegmentVector.simpleSegment(0,2*va.circleOffset,va.circleArray.length,va.circleArray.length/2),null,m.transform.zoom,null,null,null)}Sa.destroy(),ja.destroy()}}var pl=P.identity(new Float32Array(16));function bh(m,w,_,T,N,$){var X=P.getAnchorAlignment(m),oe=-(X.horizontalAlign-.5)*w,xe=-(X.verticalAlign-.5)*_,ye=P.evaluateVariableOffset(m,T);return new P.Point((oe/N+ye[0])*$,(xe/N+ye[1])*$)}function Xf(m,w,_,T,N,$,X,oe,xe,ye,De){var He=m.text.placedSymbolArray,$e=m.text.dynamicLayoutVertexArray,ft=m.icon.dynamicLayoutVertexArray,pt={};$e.clear();for(var wt=0;wt<He.length;wt++){var dt=He.get(wt),Ft=dt.hidden||!dt.crossTileID||m.allowVerticalPlacement&&!dt.placedOrientation?null:T[dt.crossTileID];if(Ft){var ar=new P.Point(dt.anchorX,dt.anchorY),nr=To(ar,_?oe:X),Ir=to($.cameraToCenterDistance,nr.signedDistanceFromCamera),_r=N.evaluateSizeForFeature(m.textSizeData,ye,dt)*Ir/P.ONE_EM;_&&(_r*=m.tilePixelRatio/xe);for(var Qr=bh(Ft.anchor,Ft.width,Ft.height,Ft.textOffset,Ft.textBoxScale,_r),nn=_?To(ar.add(Qr),X).point:nr.point.add(w?Qr.rotate(-$.angle):Qr),Ln=m.allowVerticalPlacement&&dt.placedOrientation===P.WritingMode.vertical?Math.PI/2:0,Mn=0;Mn<dt.numGlyphs;Mn++)P.addDynamicAttributes($e,nn,Ln);De&&dt.associatedIconIndex>=0&&(pt[dt.associatedIconIndex]={shiftedAnchor:nn,angle:Ln})}else du(dt.numGlyphs,$e)}if(De){ft.clear();for(var yi=m.icon.placedSymbolArray,Ri=0;Ri<yi.length;Ri++){var Qi=yi.get(Ri);if(Qi.hidden)du(Qi.numGlyphs,ft);else{var Vi=pt[Ri];if(Vi)for(var ao=0;ao<Qi.numGlyphs;ao++)P.addDynamicAttributes(ft,Vi.shiftedAnchor,Vi.angle);else du(Qi.numGlyphs,ft)}}m.icon.dynamicLayoutVertexBuffer.updateData(ft)}m.text.dynamicLayoutVertexBuffer.updateData($e)}function yp(m,w,_){return _.iconsInText&&w?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Gh(m,w,_,T,N,$,X,oe,xe,ye,De,He){for(var $e=m.context,ft=$e.gl,pt=m.transform,wt=oe==="map",dt=xe==="map",Ft=wt&&_.layout.get("symbol-placement")!=="point",ar=wt&&!dt&&!Ft,nr=_.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ir=!1,_r=m.depthModeForSublayer(0,Re.ReadOnly),Qr=_.layout.get("text-variable-anchor"),nn=[],Ln=0,Mn=T;Ln<Mn.length;Ln+=1){var yi=Mn[Ln],Ri=w.getTile(yi),Qi=Ri.getBucket(_);if(Qi){var Vi=N?Qi.text:Qi.icon;if(Vi&&Vi.segments.get().length){var ao=Vi.programConfigurations.get(_.id),Bi=N||Qi.sdfIcons,oa=N?Qi.textSizeData:Qi.iconSizeData,Ha=dt||pt.pitch!==0,ja=m.useProgram(yp(Bi,N,Qi),ao),Sa=P.evaluateSizeForZoom(oa,pt.zoom),Qa=void 0,eo=[0,0],va=void 0,tu=void 0,Gs=null,Tl=void 0;if(N)va=Ri.glyphAtlasTexture,tu=ft.LINEAR,Qa=Ri.glyphAtlasTexture.size,Qi.iconsInText&&(eo=Ri.imageAtlasTexture.size,Gs=Ri.imageAtlasTexture,Tl=Ha||m.options.rotating||m.options.zooming||oa.kind==="composite"||oa.kind==="camera"?ft.LINEAR:ft.NEAREST);else{var Ps=_.layout.get("icon-size").constantOr(0)!==1||Qi.iconsNeedLinear;va=Ri.imageAtlasTexture,tu=Bi||m.options.rotating||m.options.zooming||Ps||Ha?ft.LINEAR:ft.NEAREST,Qa=Ri.imageAtlasTexture.size}var Qo=Uo(Ri,1,m.transform.zoom),Zs=vo(yi.posMatrix,dt,wt,m.transform,Qo),Hs=as(yi.posMatrix,dt,wt,m.transform,Qo),Uu=Qr&&Qi.hasTextData(),uh=_.layout.get("icon-text-fit")!=="none"&&Uu&&Qi.hasIconData();Ft&&Vc(Qi,yi.posMatrix,m,N,Zs,Hs,dt,ye);var pc=m.translatePosMatrix(yi.posMatrix,Ri,$,X),Xc=Ft||N&&Qr||uh?pl:Zs,Yc=m.translatePosMatrix(Hs,Ri,$,X,!0),Qf=Bi&&_.paint.get(N?"text-halo-width":"icon-halo-width").constantOr(1)!==0,dc={program:ja,buffers:Vi,uniformValues:Bi?Qi.iconsInText?gp(oa.kind,Sa,ar,dt,m,pc,Xc,Yc,Qa,eo):Hc(oa.kind,Sa,ar,dt,m,pc,Xc,Yc,N,Qa,!0):mp(oa.kind,Sa,ar,dt,m,pc,Xc,Yc,N,Qa),atlasTexture:va,atlasTextureIcon:Gs,atlasInterpolation:tu,atlasInterpolationIcon:Tl,isSDF:Bi,hasHalo:Qf};if(nr&&Qi.canOverlap){Ir=!0;for(var vc=0,Dc=Vi.segments.get();vc<Dc.length;vc+=1){var Vl=Dc[vc];nn.push({segments:new P.SegmentVector([Vl]),sortKey:Vl.sortKey,state:dc})}}else nn.push({segments:Vi.segments,sortKey:0,state:dc})}}}Ir&&nn.sort(function(Os,ch){return Os.sortKey-ch.sortKey});for(var Gl=0,vf=nn;Gl<vf.length;Gl+=1){var mc=vf[Gl],Hl=mc.state;if($e.activeTexture.set(ft.TEXTURE0),Hl.atlasTexture.bind(Hl.atlasInterpolation,ft.CLAMP_TO_EDGE),Hl.atlasTextureIcon&&($e.activeTexture.set(ft.TEXTURE1),Hl.atlasTextureIcon&&Hl.atlasTextureIcon.bind(Hl.atlasInterpolationIcon,ft.CLAMP_TO_EDGE)),Hl.isSDF){var lh=Hl.uniformValues;Hl.hasHalo&&(lh.u_is_halo=1,Vu(Hl.buffers,mc.segments,_,m,Hl.program,_r,De,He,lh)),lh.u_is_halo=0}Vu(Hl.buffers,mc.segments,_,m,Hl.program,_r,De,He,Hl.uniformValues)}}function Vu(m,w,_,T,N,$,X,oe,xe){var ye=T.context;N.draw(ye,ye.gl.TRIANGLES,$,X,oe,Ye.disabled,xe,_.id,m.layoutVertexBuffer,m.indexBuffer,w,_.paint,T.transform.zoom,m.programConfigurations.get(_.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Yf(m,w,_,T,N,$,X){var oe,xe,ye,De,He,$e=m.context.gl,ft=_.paint.get("fill-pattern"),pt=ft&&ft.constantOr(1),wt=_.getCrossfadeParameters();X?(xe=pt&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oe=$e.LINES):(xe=pt?"fillPattern":"fill",oe=$e.TRIANGLES);for(var dt=0,Ft=T;dt<Ft.length;dt+=1){var ar=Ft[dt],nr=w.getTile(ar);if(!pt||nr.patternsLoaded()){var Ir=nr.getBucket(_);if(Ir){var _r=Ir.programConfigurations.get(_.id),Qr=m.useProgram(xe,_r);pt&&(m.context.activeTexture.set($e.TEXTURE0),nr.imageAtlasTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),_r.updatePaintBuffers(wt));var nn=ft.constantOr(null);if(nn&&nr.imageAtlas){var Ln=nr.imageAtlas,Mn=Ln.patternPositions[nn.to.toString()],yi=Ln.patternPositions[nn.from.toString()];Mn&&yi&&_r.setConstantPatternPositions(Mn,yi)}var Ri=m.translatePosMatrix(ar.posMatrix,nr,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));if(X){De=Ir.indexBuffer2,He=Ir.segments2;var Qi=[$e.drawingBufferWidth,$e.drawingBufferHeight];ye=xe==="fillOutlinePattern"&&pt?pp(Ri,m,wt,nr,Qi):rl(Ri,Qi)}else De=Ir.indexBuffer,He=Ir.segments,ye=pt?ko(Ri,m,wt,nr):Sf(Ri);Qr.draw(m.context,oe,N,m.stencilModeForClipping(ar),$,Ye.disabled,ye,_.id,Ir.layoutVertexBuffer,De,He,_.paint,m.transform.zoom,_r)}}}}function Ll(m,w,_,T,N,$,X){for(var oe=m.context,xe=oe.gl,ye=_.paint.get("fill-extrusion-pattern"),De=ye.constantOr(1),He=_.getCrossfadeParameters(),$e=_.paint.get("fill-extrusion-opacity"),ft=0,pt=T;ft<pt.length;ft+=1){var wt=pt[ft],dt=w.getTile(wt),Ft=dt.getBucket(_);if(Ft){var ar=Ft.programConfigurations.get(_.id),nr=m.useProgram(De?"fillExtrusionPattern":"fillExtrusion",ar);De&&(m.context.activeTexture.set(xe.TEXTURE0),dt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),ar.updatePaintBuffers(He));var Ir=ye.constantOr(null);if(Ir&&dt.imageAtlas){var _r=dt.imageAtlas,Qr=_r.patternPositions[Ir.to.toString()],nn=_r.patternPositions[Ir.from.toString()];Qr&&nn&&ar.setConstantPatternPositions(Qr,nn)}var Ln=m.translatePosMatrix(wt.posMatrix,dt,_.paint.get("fill-extrusion-translate"),_.paint.get("fill-extrusion-translate-anchor")),Mn=_.paint.get("fill-extrusion-vertical-gradient"),yi=De?Wf(Ln,m,Mn,$e,wt,He,dt):Nu(Ln,m,Mn,$e);nr.draw(oe,oe.gl.TRIANGLES,N,$,X,Ye.backCCW,yi,_.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,_.paint,m.transform.zoom,ar)}}}function uf(m,w,_,T,N,$){var X=m.context,oe=X.gl,xe=w.fbo;if(xe){var ye=m.useProgram("hillshade");X.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,xe.colorAttachment.get());var De=function(He,$e,ft){var pt=ft.paint.get("hillshade-shadow-color"),wt=ft.paint.get("hillshade-highlight-color"),dt=ft.paint.get("hillshade-accent-color"),Ft=ft.paint.get("hillshade-illumination-direction")*(Math.PI/180);ft.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ft-=He.transform.angle);var ar,nr,Ir,_r=!He.options.moving;return{u_matrix:He.transform.calculatePosMatrix($e.tileID.toUnwrapped(),_r),u_image:0,u_latrange:(ar=$e.tileID,nr=Math.pow(2,ar.canonical.z),Ir=ar.canonical.y,[new P.MercatorCoordinate(0,Ir/nr).toLngLat().lat,new P.MercatorCoordinate(0,(Ir+1)/nr).toLngLat().lat]),u_light:[ft.paint.get("hillshade-exaggeration"),Ft],u_shadow:pt,u_highlight:wt,u_accent:dt}}(m,w,_);ye.draw(X,oe.TRIANGLES,T,N,$,Ye.disabled,De,_.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}}function Pp(m,w,_,T,N,$){var X=m.context,oe=X.gl,xe=w.dem;if(xe&&xe.data){var ye=xe.dim,De=xe.stride,He=xe.getPixels();if(X.activeTexture.set(oe.TEXTURE1),X.pixelStoreUnpackPremultiplyAlpha.set(!1),w.demTexture=w.demTexture||m.getTileTexture(De),w.demTexture){var $e=w.demTexture;$e.update(He,{premultiply:!1}),$e.bind(oe.NEAREST,oe.CLAMP_TO_EDGE)}else w.demTexture=new P.Texture(X,He,oe.RGBA,{premultiply:!1}),w.demTexture.bind(oe.NEAREST,oe.CLAMP_TO_EDGE);X.activeTexture.set(oe.TEXTURE0);var ft=w.fbo;if(!ft){var pt=new P.Texture(X,{width:ye,height:ye,data:null},oe.RGBA);pt.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),(ft=w.fbo=X.createFramebuffer(ye,ye,!0)).colorAttachment.set(pt.texture)}X.bindFramebuffer.set(ft.framebuffer),X.viewport.set([0,0,ye,ye]),m.useProgram("hillshadePrepare").draw(X,oe.TRIANGLES,T,N,$,Ye.disabled,function(wt,dt){var Ft=dt.stride,ar=P.create();return P.ortho(ar,0,P.EXTENT,-P.EXTENT,0,0,1),P.translate(ar,ar,[0,-P.EXTENT,0]),{u_matrix:ar,u_image:1,u_dimension:[Ft,Ft],u_zoom:wt.overscaledZ,u_unpack:dt.getUnpackVector()}}(w.tileID,xe),_.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),w.needsHillshadePrepare=!1}}function kh(m,w,_,T,N){var $=T.paint.get("raster-fade-duration");if($>0){var X=P.browser.now(),oe=(X-m.timeAdded)/$,xe=w?(X-w.timeAdded)/$:-1,ye=_.getSource(),De=N.coveringZoomLevel({tileSize:ye.tileSize,roundZoom:ye.roundZoom}),He=!w||Math.abs(w.tileID.overscaledZ-De)>Math.abs(m.tileID.overscaledZ-De),$e=He&&m.refreshedUponExpiration?1:P.clamp(He?oe:1-xe,0,1);return m.refreshedUponExpiration&&oe>=1&&(m.refreshedUponExpiration=!1),w?{opacity:1,mix:1-$e}:{opacity:$e,mix:0}}return{opacity:1,mix:0}}var Xs=new P.Color(1,0,0,1),qf=new P.Color(0,1,0,1),_p=new P.Color(0,0,1,1),bp=new P.Color(1,0,1,1),Yp=new P.Color(0,1,1,1);function kp(m,w,_,T){Kl(m,0,w+_/2,m.transform.width,_,T)}function xp(m,w,_,T){Kl(m,w-_/2,0,_,m.transform.height,T)}function Kl(m,w,_,T,N,$){var X=m.context,oe=X.gl;oe.enable(oe.SCISSOR_TEST),oe.scissor(w*P.browser.devicePixelRatio,_*P.browser.devicePixelRatio,T*P.browser.devicePixelRatio,N*P.browser.devicePixelRatio),X.clear({color:$}),oe.disable(oe.SCISSOR_TEST)}function $c(m,w,_){var T=m.context,N=T.gl,$=_.posMatrix,X=m.useProgram("debug"),oe=Re.disabled,xe=Xe.disabled,ye=m.colorModeForRenderPass();T.activeTexture.set(N.TEXTURE0),m.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),X.draw(T,N.LINE_STRIP,oe,xe,ye,Ye.disabled,mu($,P.Color.red),"$debug",m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);var De=w.getTileByID(_.key).latestRawTileData,He=Math.floor((De&&De.byteLength||0)/1024),$e=w.getTile(_).tileSize,ft=512/Math.min($e,512)*(_.overscaledZ/m.transform.zoom)*.5,pt=_.canonical.toString();_.overscaledZ!==_.canonical.z&&(pt+=" => "+_.overscaledZ),function(wt,dt){wt.initDebugOverlayCanvas();var Ft=wt.debugOverlayCanvas,ar=wt.context.gl,nr=wt.debugOverlayCanvas.getContext("2d");nr.clearRect(0,0,Ft.width,Ft.height),nr.shadowColor="white",nr.shadowBlur=2,nr.lineWidth=1.5,nr.strokeStyle="white",nr.textBaseline="top",nr.font="bold 36px Open Sans, sans-serif",nr.fillText(dt,5,5),nr.strokeText(dt,5,5),wt.debugOverlayTexture.update(Ft),wt.debugOverlayTexture.bind(ar.LINEAR,ar.CLAMP_TO_EDGE)}(m,pt+" "+He+"kb"),X.draw(T,N.TRIANGLES,oe,xe,Qe.alphaBlended,Ye.disabled,mu($,P.Color.transparent,ft),"$debug",m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}var Rl={symbol:function(m,w,_,T,N){if(m.renderPass==="translucent"){var $=Xe.disabled,X=m.colorModeForRenderPass();_.layout.get("text-variable-anchor")&&function(oe,xe,ye,De,He,$e,ft){for(var pt=xe.transform,wt=He==="map",dt=$e==="map",Ft=0,ar=oe;Ft<ar.length;Ft+=1){var nr=ar[Ft],Ir=De.getTile(nr),_r=Ir.getBucket(ye);if(_r&&_r.text&&_r.text.segments.get().length){var Qr=P.evaluateSizeForZoom(_r.textSizeData,pt.zoom),nn=Uo(Ir,1,xe.transform.zoom),Ln=vo(nr.posMatrix,dt,wt,xe.transform,nn),Mn=ye.layout.get("icon-text-fit")!=="none"&&_r.hasIconData();if(Qr){var yi=Math.pow(2,pt.zoom-Ir.tileID.overscaledZ);Xf(_r,wt,dt,ft,P.symbolSize,pt,Ln,nr.posMatrix,yi,Qr,Mn)}}}}(T,m,_,w,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),N),_.paint.get("icon-opacity").constantOr(1)!==0&&Gh(m,w,_,T,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),$,X),_.paint.get("text-opacity").constantOr(1)!==0&&Gh(m,w,_,T,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),$,X),w.map.showCollisionBoxes&&(fl(m,w,_,T,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),fl(m,w,_,T,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))}},circle:function(m,w,_,T){if(m.renderPass==="translucent"){var N=_.paint.get("circle-opacity"),$=_.paint.get("circle-stroke-width"),X=_.paint.get("circle-stroke-opacity"),oe=_.layout.get("circle-sort-key").constantOr(1)!==void 0;if(N.constantOr(1)!==0||$.constantOr(1)!==0&&X.constantOr(1)!==0){for(var xe=m.context,ye=xe.gl,De=m.depthModeForSublayer(0,Re.ReadOnly),He=Xe.disabled,$e=m.colorModeForRenderPass(),ft=[],pt=0;pt<T.length;pt++){var wt=T[pt],dt=w.getTile(wt),Ft=dt.getBucket(_);if(Ft){var ar=Ft.programConfigurations.get(_.id),nr={programConfiguration:ar,program:m.useProgram("circle",ar),layoutVertexBuffer:Ft.layoutVertexBuffer,indexBuffer:Ft.indexBuffer,uniformValues:jo(m,wt,dt,_)};if(oe)for(var Ir=0,_r=Ft.segments.get();Ir<_r.length;Ir+=1){var Qr=_r[Ir];ft.push({segments:new P.SegmentVector([Qr]),sortKey:Qr.sortKey,state:nr})}else ft.push({segments:Ft.segments,sortKey:0,state:nr})}}oe&&ft.sort(function(Ri,Qi){return Ri.sortKey-Qi.sortKey});for(var nn=0,Ln=ft;nn<Ln.length;nn+=1){var Mn=Ln[nn],yi=Mn.state;yi.program.draw(xe,ye.TRIANGLES,De,He,$e,Ye.disabled,yi.uniformValues,_.id,yi.layoutVertexBuffer,yi.indexBuffer,Mn.segments,_.paint,m.transform.zoom,yi.programConfiguration)}}}},heatmap:function(m,w,_,T){if(_.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){var N=m.context,$=N.gl,X=Xe.disabled,oe=new Qe([$.ONE,$.ONE],P.Color.transparent,[!0,!0,!0,!0]);(function(ft,pt,wt){var dt=ft.gl;ft.activeTexture.set(dt.TEXTURE1),ft.viewport.set([0,0,pt.width/4,pt.height/4]);var Ft=wt.heatmapFbo;if(Ft)dt.bindTexture(dt.TEXTURE_2D,Ft.colorAttachment.get()),ft.bindFramebuffer.set(Ft.framebuffer);else{var ar=dt.createTexture();dt.bindTexture(dt.TEXTURE_2D,ar),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_WRAP_S,dt.CLAMP_TO_EDGE),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_WRAP_T,dt.CLAMP_TO_EDGE),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_MIN_FILTER,dt.LINEAR),dt.texParameteri(dt.TEXTURE_2D,dt.TEXTURE_MAG_FILTER,dt.LINEAR),Ft=wt.heatmapFbo=ft.createFramebuffer(pt.width/4,pt.height/4,!1),function(nr,Ir,_r,Qr){var nn=nr.gl;nn.texImage2D(nn.TEXTURE_2D,0,nn.RGBA,Ir.width/4,Ir.height/4,0,nn.RGBA,nr.extRenderToTextureHalfFloat?nr.extTextureHalfFloat.HALF_FLOAT_OES:nn.UNSIGNED_BYTE,null),Qr.colorAttachment.set(_r)}(ft,pt,ar,Ft)}})(N,m,_),N.clear({color:P.Color.transparent});for(var xe=0;xe<T.length;xe++){var ye=T[xe];if(!w.hasRenderableParent(ye)){var De=w.getTile(ye),He=De.getBucket(_);if(He){var $e=He.programConfigurations.get(_.id);m.useProgram("heatmap",$e).draw(N,$.TRIANGLES,Re.disabled,X,oe,Ye.disabled,ud(ye.posMatrix,De,m.transform.zoom,_.paint.get("heatmap-intensity")),_.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,_.paint,m.transform.zoom,$e)}}}N.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(ft,pt){var wt=ft.context,dt=wt.gl,Ft=pt.heatmapFbo;if(Ft){wt.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_2D,Ft.colorAttachment.get()),wt.activeTexture.set(dt.TEXTURE1);var ar=pt.colorRampTexture;ar||(ar=pt.colorRampTexture=new P.Texture(wt,pt.colorRamp,dt.RGBA)),ar.bind(dt.LINEAR,dt.CLAMP_TO_EDGE),ft.useProgram("heatmapTexture").draw(wt,dt.TRIANGLES,Re.disabled,Xe.disabled,ft.colorModeForRenderPass(),Ye.disabled,function(nr,Ir,_r,Qr){var nn=P.create();P.ortho(nn,0,nr.width,nr.height,0,0,1);var Ln=nr.context.gl;return{u_matrix:nn,u_world:[Ln.drawingBufferWidth,Ln.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ir.paint.get("heatmap-opacity")}}(ft,pt),pt.id,ft.viewportBuffer,ft.quadTriangleIndexBuffer,ft.viewportSegments,pt.paint,ft.transform.zoom)}}(m,_))},line:function(m,w,_,T){if(m.renderPass==="translucent"){var N=_.paint.get("line-opacity"),$=_.paint.get("line-width");if(N.constantOr(1)!==0&&$.constantOr(1)!==0)for(var X=m.depthModeForSublayer(0,Re.ReadOnly),oe=m.colorModeForRenderPass(),xe=_.paint.get("line-dasharray"),ye=_.paint.get("line-pattern"),De=ye.constantOr(1),He=_.paint.get("line-gradient"),$e=_.getCrossfadeParameters(),ft=De?"linePattern":xe?"lineSDF":He?"lineGradient":"line",pt=m.context,wt=pt.gl,dt=!0,Ft=0,ar=T;Ft<ar.length;Ft+=1){var nr=ar[Ft],Ir=w.getTile(nr);if(!De||Ir.patternsLoaded()){var _r=Ir.getBucket(_);if(_r){var Qr=_r.programConfigurations.get(_.id),nn=m.context.program.get(),Ln=m.useProgram(ft,Qr),Mn=dt||Ln.program!==nn,yi=ye.constantOr(null);if(yi&&Ir.imageAtlas){var Ri=Ir.imageAtlas,Qi=Ri.patternPositions[yi.to.toString()],Vi=Ri.patternPositions[yi.from.toString()];Qi&&Vi&&Qr.setConstantPatternPositions(Qi,Vi)}var ao=De?dp(m,Ir,_,$e):xe?Wp(m,Ir,_,xe,$e):He?Eu(m,Ir,_,_r.lineClipsArray.length):of(m,Ir,_);if(De)pt.activeTexture.set(wt.TEXTURE0),Ir.imageAtlasTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE),Qr.updatePaintBuffers($e);else if(xe&&(Mn||m.lineAtlas.dirty))pt.activeTexture.set(wt.TEXTURE0),m.lineAtlas.bind(pt);else if(He){var Bi=_r.gradients[_.id],oa=Bi.texture;if(_.gradientVersion!==Bi.version){var Ha=256;if(_.stepInterpolant){var ja=w.getSource().maxzoom,Sa=nr.canonical.z===ja?Math.ceil(1<<m.transform.maxZoom-nr.canonical.z):1;Ha=P.clamp(P.nextPowerOfTwo(_r.maxLineLength/P.EXTENT*1024*Sa),256,pt.maxTextureSize)}Bi.gradient=P.renderColorRamp({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:Ha,image:Bi.gradient||void 0,clips:_r.lineClipsArray}),Bi.texture?Bi.texture.update(Bi.gradient):Bi.texture=new P.Texture(pt,Bi.gradient,wt.RGBA),Bi.version=_.gradientVersion,oa=Bi.texture}pt.activeTexture.set(wt.TEXTURE0),oa.bind(_.stepInterpolant?wt.NEAREST:wt.LINEAR,wt.CLAMP_TO_EDGE)}Ln.draw(pt,wt.TRIANGLES,X,m.stencilModeForClipping(nr),oe,Ye.disabled,ao,_.id,_r.layoutVertexBuffer,_r.indexBuffer,_r.segments,_.paint,m.transform.zoom,Qr,_r.layoutVertexBuffer2),dt=!1}}}}},fill:function(m,w,_,T){var N=_.paint.get("fill-color"),$=_.paint.get("fill-opacity");if($.constantOr(1)!==0){var X=m.colorModeForRenderPass(),oe=_.paint.get("fill-pattern"),xe=m.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&N.constantOr(P.Color.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===xe){var ye=m.depthModeForSublayer(1,m.renderPass==="opaque"?Re.ReadWrite:Re.ReadOnly);Yf(m,w,_,T,ye,X,!1)}if(m.renderPass==="translucent"&&_.paint.get("fill-antialias")){var De=m.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Re.ReadOnly);Yf(m,w,_,T,De,X,!0)}}},"fill-extrusion":function(m,w,_,T){var N=_.paint.get("fill-extrusion-opacity");if(N!==0&&m.renderPass==="translucent"){var $=new Re(m.context.gl.LEQUAL,Re.ReadWrite,m.depthRangeFor3D);if(N!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))Ll(m,w,_,T,$,Xe.disabled,Qe.disabled),Ll(m,w,_,T,$,m.stencilModeFor3D(),m.colorModeForRenderPass());else{var X=m.colorModeForRenderPass();Ll(m,w,_,T,$,Xe.disabled,X)}}},hillshade:function(m,w,_,T){if(m.renderPass==="offscreen"||m.renderPass==="translucent"){for(var N=m.context,$=m.depthModeForSublayer(0,Re.ReadOnly),X=m.colorModeForRenderPass(),oe=m.renderPass==="translucent"?m.stencilConfigForOverlap(T):[{},T],xe=oe[0],ye=0,De=oe[1];ye<De.length;ye+=1){var He=De[ye],$e=w.getTile(He);$e.needsHillshadePrepare&&m.renderPass==="offscreen"?Pp(m,$e,_,$,Xe.disabled,X):m.renderPass==="translucent"&&uf(m,$e,_,$,xe[He.overscaledZ],X)}N.viewport.set([0,0,m.width,m.height])}},raster:function(m,w,_,T){if(m.renderPass==="translucent"&&_.paint.get("raster-opacity")!==0&&T.length)for(var N=m.context,$=N.gl,X=w.getSource(),oe=m.useProgram("raster"),xe=m.colorModeForRenderPass(),ye=X instanceof Fr?[{},T]:m.stencilConfigForOverlap(T),De=ye[0],He=ye[1],$e=He[He.length-1].overscaledZ,ft=!m.options.moving,pt=0,wt=He;pt<wt.length;pt+=1){var dt=wt[pt],Ft=m.depthModeForSublayer(dt.overscaledZ-$e,_.paint.get("raster-opacity")===1?Re.ReadWrite:Re.ReadOnly,$.LESS),ar=w.getTile(dt),nr=m.transform.calculatePosMatrix(dt.toUnwrapped(),ft);ar.registerFadeDuration(_.paint.get("raster-fade-duration"));var Ir=w.findLoadedParent(dt,0),_r=kh(ar,Ir,w,_,m.transform),Qr=void 0,nn=void 0,Ln=_.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;N.activeTexture.set($.TEXTURE0),ar.texture.bind(Ln,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),N.activeTexture.set($.TEXTURE1),Ir?(Ir.texture.bind(Ln,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Qr=Math.pow(2,Ir.tileID.overscaledZ-ar.tileID.overscaledZ),nn=[ar.tileID.canonical.x*Qr%1,ar.tileID.canonical.y*Qr%1]):ar.texture.bind(Ln,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);var Mn=Xp(nr,nn||[0,0],Qr||1,_r,_);X instanceof Fr?oe.draw(N,$.TRIANGLES,Ft,Xe.disabled,xe,Ye.disabled,Mn,_.id,X.boundsBuffer,m.quadTriangleIndexBuffer,X.boundsSegments):oe.draw(N,$.TRIANGLES,Ft,De[dt.overscaledZ],xe,Ye.disabled,Mn,_.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,w,_){var T=_.paint.get("background-color"),N=_.paint.get("background-opacity");if(N!==0){var $=m.context,X=$.gl,oe=m.transform,xe=oe.tileSize,ye=_.paint.get("background-pattern");if(!m.isPatternMissing(ye)){var De=!ye&&T.a===1&&N===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass===De){var He=Xe.disabled,$e=m.depthModeForSublayer(0,De==="opaque"?Re.ReadWrite:Re.ReadOnly),ft=m.colorModeForRenderPass(),pt=m.useProgram(ye?"backgroundPattern":"background"),wt=oe.coveringTiles({tileSize:xe});ye&&($.activeTexture.set(X.TEXTURE0),m.imageManager.bind(m.context));for(var dt=_.getCrossfadeParameters(),Ft=0,ar=wt;Ft<ar.length;Ft+=1){var nr=ar[Ft],Ir=m.transform.calculatePosMatrix(nr.toUnwrapped()),_r=ye?ah(Ir,N,m,ye,{tileID:nr,tileSize:xe},dt):sf(Ir,N,T);pt.draw($,X.TRIANGLES,$e,He,ft,Ye.disabled,_r,_.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}}}},debug:function(m,w,_){for(var T=0;T<_.length;T++)$c(m,w,_[T])},custom:function(m,w,_){var T=m.context,N=_.implementation;if(m.renderPass==="offscreen"){var $=N.prerender;$&&(m.setCustomLayerDefaults(),T.setColorMode(m.colorModeForRenderPass()),$.call(N,T.gl,m.transform.customLayerMatrix()),T.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),T.setColorMode(m.colorModeForRenderPass()),T.setStencilMode(Xe.disabled);var X=N.renderingMode==="3d"?new Re(m.context.gl.LEQUAL,Re.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Re.ReadOnly);T.setDepthMode(X),N.render(T.gl,m.transform.customLayerMatrix()),T.setDirty(),m.setBaseState(),T.bindFramebuffer.set(null)}}},Ms=function(m,w){this.context=new Fe(m),this.transform=w,this._tileTextures={},this.setup(),this.numSublayers=Me.maxUnderzooming+Me.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new os,this.gpuTimers={}};Ms.prototype.resize=function(m,w){if(this.width=m*P.browser.devicePixelRatio,this.height=w*P.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var _=0,T=this.style._order;_<T.length;_+=1)this.style._layers[T[_]].resize()},Ms.prototype.setup=function(){var m=this.context,w=new P.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(P.EXTENT,0),w.emplaceBack(0,P.EXTENT),w.emplaceBack(P.EXTENT,P.EXTENT),this.tileExtentBuffer=m.createVertexBuffer(w,Ja.members),this.tileExtentSegments=P.SegmentVector.simpleSegment(0,0,4,2);var _=new P.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(P.EXTENT,0),_.emplaceBack(0,P.EXTENT),_.emplaceBack(P.EXTENT,P.EXTENT),this.debugBuffer=m.createVertexBuffer(_,Ja.members),this.debugSegments=P.SegmentVector.simpleSegment(0,0,4,5);var T=new P.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(P.EXTENT,0,P.EXTENT,0),T.emplaceBack(0,P.EXTENT,0,P.EXTENT),T.emplaceBack(P.EXTENT,P.EXTENT,P.EXTENT,P.EXTENT),this.rasterBoundsBuffer=m.createVertexBuffer(T,Pr.members),this.rasterBoundsSegments=P.SegmentVector.simpleSegment(0,0,4,2);var N=new P.StructArrayLayout2i4;N.emplaceBack(0,0),N.emplaceBack(1,0),N.emplaceBack(0,1),N.emplaceBack(1,1),this.viewportBuffer=m.createVertexBuffer(N,Ja.members),this.viewportSegments=P.SegmentVector.simpleSegment(0,0,4,2);var $=new P.StructArrayLayout1ui2;$.emplaceBack(0),$.emplaceBack(1),$.emplaceBack(3),$.emplaceBack(2),$.emplaceBack(0),this.tileBorderIndexBuffer=m.createIndexBuffer($);var X=new P.StructArrayLayout3ui6;X.emplaceBack(0,1,2),X.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=m.createIndexBuffer(X),this.emptyTexture=new P.Texture(m,{width:1,height:1,data:new Uint8Array([0,0,0,0])},m.gl.RGBA);var oe=this.context.gl;this.stencilClearMode=new Xe({func:oe.ALWAYS,mask:0},0,255,oe.ZERO,oe.ZERO,oe.ZERO)},Ms.prototype.clearStencil=function(){var m=this.context,w=m.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var _=P.create();P.ortho(_,0,this.width,this.height,0,0,1),P.scale(_,_,[w.drawingBufferWidth,w.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(m,w.TRIANGLES,Re.disabled,this.stencilClearMode,Qe.disabled,Ye.disabled,Mh(_),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ms.prototype._renderTileClippingMasks=function(m,w){if(this.currentStencilSource!==m.source&&m.isTileClipped()&&w&&w.length){this.currentStencilSource=m.source;var _=this.context,T=_.gl;this.nextStencilID+w.length>256&&this.clearStencil(),_.setColorMode(Qe.disabled),_.setDepthMode(Re.disabled);var N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var $=0,X=w;$<X.length;$+=1){var oe=X[$],xe=this._tileClippingMaskIDs[oe.key]=this.nextStencilID++;N.draw(_,T.TRIANGLES,Re.disabled,new Xe({func:T.ALWAYS,mask:0},xe,255,T.KEEP,T.KEEP,T.REPLACE),Qe.disabled,Ye.disabled,Mh(oe.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ms.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var m=this.nextStencilID++,w=this.context.gl;return new Xe({func:w.NOTEQUAL,mask:255},m,255,w.KEEP,w.KEEP,w.REPLACE)},Ms.prototype.stencilModeForClipping=function(m){var w=this.context.gl;return new Xe({func:w.EQUAL,mask:255},this._tileClippingMaskIDs[m.key],0,w.KEEP,w.KEEP,w.REPLACE)},Ms.prototype.stencilConfigForOverlap=function(m){var w,_=this.context.gl,T=m.sort(function(xe,ye){return ye.overscaledZ-xe.overscaledZ}),N=T[T.length-1].overscaledZ,$=T[0].overscaledZ-N+1;if($>1){this.currentStencilSource=void 0,this.nextStencilID+$>256&&this.clearStencil();for(var X={},oe=0;oe<$;oe++)X[oe+N]=new Xe({func:_.GEQUAL,mask:255},oe+this.nextStencilID,255,_.KEEP,_.KEEP,_.REPLACE);return this.nextStencilID+=$,[X,T]}return[(w={},w[N]=Xe.disabled,w),T]},Ms.prototype.colorModeForRenderPass=function(){var m=this.context.gl;return this._showOverdrawInspector?new Qe([m.CONSTANT_COLOR,m.ONE],new P.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qe.unblended:Qe.alphaBlended},Ms.prototype.depthModeForSublayer=function(m,w,_){if(!this.opaquePassEnabledForLayer())return Re.disabled;var T=1-((1+this.currentLayer)*this.numSublayers+m)*this.depthEpsilon;return new Re(_||this.context.gl.LEQUAL,w,[T,T])},Ms.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ms.prototype.render=function(m,w){var _=this;this.style=m,this.options=w,this.lineAtlas=m.lineAtlas,this.imageManager=m.imageManager,this.glyphManager=m.glyphManager,this.symbolFadeChange=m.placement.symbolFadeChange(P.browser.now()),this.imageManager.beginFrame();var T=this.style._order,N=this.style.sourceCaches;for(var $ in N){var X=N[$];X.used&&X.prepare(this.context)}var oe,xe,ye={},De={},He={};for(var $e in N){var ft=N[$e];ye[$e]=ft.getVisibleCoordinates(),De[$e]=ye[$e].slice().reverse(),He[$e]=ft.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var pt=0;pt<T.length;pt++)if(this.style._layers[T[pt]].is3D()){this.opaquePassCutoff=pt;break}this.renderPass="offscreen";for(var wt=0,dt=T;wt<dt.length;wt+=1){var Ft=this.style._layers[dt[wt]];if(Ft.hasOffscreenPass()&&!Ft.isHidden(this.transform.zoom)){var ar=De[Ft.source];(Ft.type==="custom"||ar.length)&&this.renderLayer(this,N[Ft.source],Ft,ar)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:w.showOverdrawInspector?P.Color.black:P.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=w.showOverdrawInspector,this.depthRangeFor3D=[0,1-(m._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){var nr=this.style._layers[T[this.currentLayer]],Ir=N[nr.source],_r=ye[nr.source];this._renderTileClippingMasks(nr,_r),this.renderLayer(this,Ir,nr,_r)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){var Qr=this.style._layers[T[this.currentLayer]],nn=N[Qr.source],Ln=(Qr.type==="symbol"?He:De)[Qr.source];this._renderTileClippingMasks(Qr,ye[Qr.source]),this.renderLayer(this,nn,Qr,Ln)}this.options.showTileBoundaries&&(P.values(this.style._layers).forEach(function(Mn){Mn.source&&!Mn.isHidden(_.transform.zoom)&&(Mn.source!==(xe&&xe.id)&&(xe=_.style.sourceCaches[Mn.source]),(!oe||oe.getSource().maxzoom<xe.getSource().maxzoom)&&(oe=xe))}),oe&&Rl.debug(this,oe,oe.getVisibleCoordinates())),this.options.showPadding&&function(Mn){var yi=Mn.transform.padding;kp(Mn,Mn.transform.height-(yi.top||0),3,Xs),kp(Mn,yi.bottom||0,3,qf),xp(Mn,yi.left||0,3,_p),xp(Mn,Mn.transform.width-(yi.right||0),3,bp);var Ri=Mn.transform.centerPoint;(function(Qi,Vi,ao,Bi){Kl(Qi,Vi-1,ao-10,2,20,Bi),Kl(Qi,Vi-10,ao-1,20,2,Bi)})(Mn,Ri.x,Mn.transform.height-Ri.y,Yp)}(this),this.context.setDefault()},Ms.prototype.renderLayer=function(m,w,_,T){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||T.length)&&(this.id=_.id,this.gpuTimingStart(_),Rl[_.type](m,w,_,T,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ms.prototype.gpuTimingStart=function(m){if(this.options.gpuTiming){var w=this.context.extTimerQuery,_=this.gpuTimers[m.id];_||(_=this.gpuTimers[m.id]={calls:0,cpuTime:0,query:w.createQueryEXT()}),_.calls++,w.beginQueryEXT(w.TIME_ELAPSED_EXT,_.query)}},Ms.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var m=this.context.extTimerQuery;m.endQueryEXT(m.TIME_ELAPSED_EXT)}},Ms.prototype.collectGpuTimers=function(){var m=this.gpuTimers;return this.gpuTimers={},m},Ms.prototype.queryGpuTimers=function(m){var w={};for(var _ in m){var T=m[_],N=this.context.extTimerQuery,$=N.getQueryObjectEXT(T.query,N.QUERY_RESULT_EXT)/1e6;N.deleteQueryEXT(T.query),w[_]=$}return w},Ms.prototype.translatePosMatrix=function(m,w,_,T,N){if(!_[0]&&!_[1])return m;var $=N?T==="map"?this.transform.angle:0:T==="viewport"?-this.transform.angle:0;if($){var X=Math.sin($),oe=Math.cos($);_=[_[0]*oe-_[1]*X,_[0]*X+_[1]*oe]}var xe=[N?_[0]:Uo(w,_[0],this.transform.zoom),N?_[1]:Uo(w,_[1],this.transform.zoom),0],ye=new Float32Array(16);return P.translate(ye,m,xe),ye},Ms.prototype.saveTileTexture=function(m){var w=this._tileTextures[m.size[0]];w?w.push(m):this._tileTextures[m.size[0]]=[m]},Ms.prototype.getTileTexture=function(m){var w=this._tileTextures[m];return w&&w.length>0?w.pop():null},Ms.prototype.isPatternMissing=function(m){if(!m)return!1;if(!m.from||!m.to)return!0;var w=this.imageManager.getPattern(m.from.toString()),_=this.imageManager.getPattern(m.to.toString());return!w||!_},Ms.prototype.useProgram=function(m,w){this.cache=this.cache||{};var _=""+m+(w?w.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[_]||(this.cache[_]=new fp(this.context,m,af[m],w,wo[m],this._showOverdrawInspector)),this.cache[_]},Ms.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ms.prototype.setBaseState=function(){var m=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(m.FUNC_ADD)},Ms.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=P.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new P.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ms.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Hh=function(m,w){this.points=m,this.planes=w};Hh.fromInvProjectionMatrix=function(m,w,_){var T=Math.pow(2,_),N=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(X){return P.transformMat4([],X,m)}).map(function(X){return P.scale$1([],X,1/X[3]/w*T)}),$=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(X){var oe=P.sub([],N[X[0]],N[X[1]]),xe=P.sub([],N[X[2]],N[X[1]]),ye=P.normalize([],P.cross([],oe,xe)),De=-P.dot(ye,N[X[1]]);return ye.concat(De)});return new Hh(N,$)};var lf=function(m,w){this.min=m,this.max=w,this.center=P.scale$2([],P.add([],this.min,this.max),.5)};lf.prototype.quadrant=function(m){for(var w=[m%2==0,m<2],_=P.clone$2(this.min),T=P.clone$2(this.max),N=0;N<w.length;N++)_[N]=w[N]?this.min[N]:this.center[N],T[N]=w[N]?this.center[N]:this.max[N];return T[2]=this.max[2],new lf(_,T)},lf.prototype.distanceX=function(m){return Math.max(Math.min(this.max[0],m[0]),this.min[0])-m[0]},lf.prototype.distanceY=function(m){return Math.max(Math.min(this.max[1],m[1]),this.min[1])-m[1]},lf.prototype.intersects=function(m){for(var w=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],_=!0,T=0;T<m.planes.length;T++){for(var N=m.planes[T],$=0,X=0;X<w.length;X++)$+=P.dot$1(N,w[X])>=0;if($===0)return 0;$!==w.length&&(_=!1)}if(_)return 2;for(var oe=0;oe<3;oe++){for(var xe=Number.MAX_VALUE,ye=-Number.MAX_VALUE,De=0;De<m.points.length;De++){var He=m.points[De][oe]-this.min[oe];xe=Math.min(xe,He),ye=Math.max(ye,He)}if(ye<0||xe>this.max[oe]-this.min[oe])return 0}return 1};var Ef=function(m,w,_,T){if(m===void 0&&(m=0),w===void 0&&(w=0),_===void 0&&(_=0),T===void 0&&(T=0),isNaN(m)||m<0||isNaN(w)||w<0||isNaN(_)||_<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=m,this.bottom=w,this.left=_,this.right=T};Ef.prototype.interpolate=function(m,w,_){return w.top!=null&&m.top!=null&&(this.top=P.number(m.top,w.top,_)),w.bottom!=null&&m.bottom!=null&&(this.bottom=P.number(m.bottom,w.bottom,_)),w.left!=null&&m.left!=null&&(this.left=P.number(m.left,w.left,_)),w.right!=null&&m.right!=null&&(this.right=P.number(m.right,w.right,_)),this},Ef.prototype.getCenter=function(m,w){var _=P.clamp((this.left+m-this.right)/2,0,m),T=P.clamp((this.top+w-this.bottom)/2,0,w);return new P.Point(_,T)},Ef.prototype.equals=function(m){return this.top===m.top&&this.bottom===m.bottom&&this.left===m.left&&this.right===m.right},Ef.prototype.clone=function(){return new Ef(this.top,this.bottom,this.left,this.right)},Ef.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var vs=function(m,w,_,T,N){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=N===void 0||N,this._minZoom=m||0,this._maxZoom=w||22,this._minPitch=_==null?0:_,this._maxPitch=T==null?60:T,this.setMaxBounds(),this.width=0,this.height=0,this._center=new P.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ef,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ns={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};vs.prototype.clone=function(){var m=new vs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return m.tileSize=this.tileSize,m.latRange=this.latRange,m.width=this.width,m.height=this.height,m._center=this._center,m.zoom=this.zoom,m.angle=this.angle,m._fov=this._fov,m._pitch=this._pitch,m._unmodified=this._unmodified,m._edgeInsets=this._edgeInsets.clone(),m._calcMatrices(),m},Ns.minZoom.get=function(){return this._minZoom},Ns.minZoom.set=function(m){this._minZoom!==m&&(this._minZoom=m,this.zoom=Math.max(this.zoom,m))},Ns.maxZoom.get=function(){return this._maxZoom},Ns.maxZoom.set=function(m){this._maxZoom!==m&&(this._maxZoom=m,this.zoom=Math.min(this.zoom,m))},Ns.minPitch.get=function(){return this._minPitch},Ns.minPitch.set=function(m){this._minPitch!==m&&(this._minPitch=m,this.pitch=Math.max(this.pitch,m))},Ns.maxPitch.get=function(){return this._maxPitch},Ns.maxPitch.set=function(m){this._maxPitch!==m&&(this._maxPitch=m,this.pitch=Math.min(this.pitch,m))},Ns.renderWorldCopies.get=function(){return this._renderWorldCopies},Ns.renderWorldCopies.set=function(m){m===void 0?m=!0:m===null&&(m=!1),this._renderWorldCopies=m},Ns.worldSize.get=function(){return this.tileSize*this.scale},Ns.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ns.size.get=function(){return new P.Point(this.width,this.height)},Ns.bearing.get=function(){return-this.angle/Math.PI*180},Ns.bearing.set=function(m){var w=-P.wrap(m,-180,180)*Math.PI/180;this.angle!==w&&(this._unmodified=!1,this.angle=w,this._calcMatrices(),this.rotationMatrix=P.create$2(),P.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ns.pitch.get=function(){return this._pitch/Math.PI*180},Ns.pitch.set=function(m){var w=P.clamp(m,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==w&&(this._unmodified=!1,this._pitch=w,this._calcMatrices())},Ns.fov.get=function(){return this._fov/Math.PI*180},Ns.fov.set=function(m){m=Math.max(.01,Math.min(60,m)),this._fov!==m&&(this._unmodified=!1,this._fov=m/180*Math.PI,this._calcMatrices())},Ns.zoom.get=function(){return this._zoom},Ns.zoom.set=function(m){var w=Math.min(Math.max(m,this.minZoom),this.maxZoom);this._zoom!==w&&(this._unmodified=!1,this._zoom=w,this.scale=this.zoomScale(w),this.tileZoom=Math.floor(w),this.zoomFraction=w-this.tileZoom,this._constrain(),this._calcMatrices())},Ns.center.get=function(){return this._center},Ns.center.set=function(m){m.lat===this._center.lat&&m.lng===this._center.lng||(this._unmodified=!1,this._center=m,this._constrain(),this._calcMatrices())},Ns.padding.get=function(){return this._edgeInsets.toJSON()},Ns.padding.set=function(m){this._edgeInsets.equals(m)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,m,1),this._calcMatrices())},Ns.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},vs.prototype.isPaddingEqual=function(m){return this._edgeInsets.equals(m)},vs.prototype.interpolatePadding=function(m,w,_){this._unmodified=!1,this._edgeInsets.interpolate(m,w,_),this._constrain(),this._calcMatrices()},vs.prototype.coveringZoomLevel=function(m){var w=(m.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/m.tileSize));return Math.max(0,w)},vs.prototype.getVisibleUnwrappedCoordinates=function(m){var w=[new P.UnwrappedTileID(0,m)];if(this._renderWorldCopies)for(var _=this.pointCoordinate(new P.Point(0,0)),T=this.pointCoordinate(new P.Point(this.width,0)),N=this.pointCoordinate(new P.Point(this.width,this.height)),$=this.pointCoordinate(new P.Point(0,this.height)),X=Math.floor(Math.min(_.x,T.x,N.x,$.x)),oe=Math.floor(Math.max(_.x,T.x,N.x,$.x)),xe=X-1;xe<=oe+1;xe++)xe!==0&&w.push(new P.UnwrappedTileID(xe,m));return w},vs.prototype.coveringTiles=function(m){var w=this.coveringZoomLevel(m),_=w;if(m.minzoom!==void 0&&w<m.minzoom)return[];m.maxzoom!==void 0&&w>m.maxzoom&&(w=m.maxzoom);var T=P.MercatorCoordinate.fromLngLat(this.center),N=Math.pow(2,w),$=[N*T.x,N*T.y,0],X=Hh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,w),oe=m.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(oe=w);var xe=function(Mn){return{aabb:new lf([Mn*N,0,0],[(Mn+1)*N,N,0]),zoom:0,x:0,y:0,wrap:Mn,fullyVisible:!1}},ye=[],De=[],He=w,$e=m.reparseOverscaled?_:w;if(this._renderWorldCopies)for(var ft=1;ft<=3;ft++)ye.push(xe(-ft)),ye.push(xe(ft));for(ye.push(xe(0));ye.length>0;){var pt=ye.pop(),wt=pt.x,dt=pt.y,Ft=pt.fullyVisible;if(!Ft){var ar=pt.aabb.intersects(X);if(ar===0)continue;Ft=ar===2}var nr=pt.aabb.distanceX($),Ir=pt.aabb.distanceY($),_r=Math.max(Math.abs(nr),Math.abs(Ir));if(pt.zoom===He||_r>3+(1<<He-pt.zoom)-2&&pt.zoom>=oe)De.push({tileID:new P.OverscaledTileID(pt.zoom===He?$e:pt.zoom,pt.wrap,pt.zoom,wt,dt),distanceSq:P.sqrLen([$[0]-.5-wt,$[1]-.5-dt])});else for(var Qr=0;Qr<4;Qr++){var nn=(wt<<1)+Qr%2,Ln=(dt<<1)+(Qr>>1);ye.push({aabb:pt.aabb.quadrant(Qr),zoom:pt.zoom+1,x:nn,y:Ln,wrap:pt.wrap,fullyVisible:Ft})}}return De.sort(function(Mn,yi){return Mn.distanceSq-yi.distanceSq}).map(function(Mn){return Mn.tileID})},vs.prototype.resize=function(m,w){this.width=m,this.height=w,this.pixelsToGLUnits=[2/m,-2/w],this._constrain(),this._calcMatrices()},Ns.unmodified.get=function(){return this._unmodified},vs.prototype.zoomScale=function(m){return Math.pow(2,m)},vs.prototype.scaleZoom=function(m){return Math.log(m)/Math.LN2},vs.prototype.project=function(m){var w=P.clamp(m.lat,-this.maxValidLatitude,this.maxValidLatitude);return new P.Point(P.mercatorXfromLng(m.lng)*this.worldSize,P.mercatorYfromLat(w)*this.worldSize)},vs.prototype.unproject=function(m){return new P.MercatorCoordinate(m.x/this.worldSize,m.y/this.worldSize).toLngLat()},Ns.point.get=function(){return this.project(this.center)},vs.prototype.setLocationAtPoint=function(m,w){var _=this.pointCoordinate(w),T=this.pointCoordinate(this.centerPoint),N=this.locationCoordinate(m),$=new P.MercatorCoordinate(N.x-(_.x-T.x),N.y-(_.y-T.y));this.center=this.coordinateLocation($),this._renderWorldCopies&&(this.center=this.center.wrap())},vs.prototype.locationPoint=function(m){return this.coordinatePoint(this.locationCoordinate(m))},vs.prototype.pointLocation=function(m){return this.coordinateLocation(this.pointCoordinate(m))},vs.prototype.locationCoordinate=function(m){return P.MercatorCoordinate.fromLngLat(m)},vs.prototype.coordinateLocation=function(m){return m.toLngLat()},vs.prototype.pointCoordinate=function(m){var w=[m.x,m.y,0,1],_=[m.x,m.y,1,1];P.transformMat4(w,w,this.pixelMatrixInverse),P.transformMat4(_,_,this.pixelMatrixInverse);var T=w[3],N=_[3],$=w[1]/T,X=_[1]/N,oe=w[2]/T,xe=_[2]/N,ye=oe===xe?0:(0-oe)/(xe-oe);return new P.MercatorCoordinate(P.number(w[0]/T,_[0]/N,ye)/this.worldSize,P.number($,X,ye)/this.worldSize)},vs.prototype.coordinatePoint=function(m){var w=[m.x*this.worldSize,m.y*this.worldSize,0,1];return P.transformMat4(w,w,this.pixelMatrix),new P.Point(w[0]/w[3],w[1]/w[3])},vs.prototype.getBounds=function(){return new P.LngLatBounds().extend(this.pointLocation(new P.Point(0,0))).extend(this.pointLocation(new P.Point(this.width,0))).extend(this.pointLocation(new P.Point(this.width,this.height))).extend(this.pointLocation(new P.Point(0,this.height)))},vs.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new P.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},vs.prototype.setMaxBounds=function(m){m?(this.lngRange=[m.getWest(),m.getEast()],this.latRange=[m.getSouth(),m.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},vs.prototype.calculatePosMatrix=function(m,w){w===void 0&&(w=!1);var _=m.key,T=w?this._alignedPosMatrixCache:this._posMatrixCache;if(T[_])return T[_];var N=m.canonical,$=this.worldSize/this.zoomScale(N.z),X=N.x+Math.pow(2,N.z)*m.wrap,oe=P.identity(new Float64Array(16));return P.translate(oe,oe,[X*$,N.y*$,0]),P.scale(oe,oe,[$/P.EXTENT,$/P.EXTENT,1]),P.multiply(oe,w?this.alignedProjMatrix:this.projMatrix,oe),T[_]=new Float32Array(oe),T[_]},vs.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},vs.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var m,w,_,T,N=-90,$=90,X=-180,oe=180,xe=this.size,ye=this._unmodified;if(this.latRange){var De=this.latRange;N=P.mercatorYfromLat(De[1])*this.worldSize,m=($=P.mercatorYfromLat(De[0])*this.worldSize)-N<xe.y?xe.y/($-N):0}if(this.lngRange){var He=this.lngRange;X=P.mercatorXfromLng(He[0])*this.worldSize,w=(oe=P.mercatorXfromLng(He[1])*this.worldSize)-X<xe.x?xe.x/(oe-X):0}var $e=this.point,ft=Math.max(w||0,m||0);if(ft)return this.center=this.unproject(new P.Point(w?(oe+X)/2:$e.x,m?($+N)/2:$e.y)),this.zoom+=this.scaleZoom(ft),this._unmodified=ye,void(this._constraining=!1);if(this.latRange){var pt=$e.y,wt=xe.y/2;pt-wt<N&&(T=N+wt),pt+wt>$&&(T=$-wt)}if(this.lngRange){var dt=$e.x,Ft=xe.x/2;dt-Ft<X&&(_=X+Ft),dt+Ft>oe&&(_=oe-Ft)}_===void 0&&T===void 0||(this.center=this.unproject(new P.Point(_!==void 0?_:$e.x,T!==void 0?T:$e.y))),this._unmodified=ye,this._constraining=!1}},vs.prototype._calcMatrices=function(){if(this.height){var m=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var w=Math.PI/2+this._pitch,_=this._fov*(.5+m.y/this.height),T=Math.sin(_)*this.cameraToCenterDistance/Math.sin(P.clamp(Math.PI-w-_,.01,Math.PI-.01)),N=this.point,$=N.x,X=N.y,oe=1.01*(Math.cos(Math.PI/2-this._pitch)*T+this.cameraToCenterDistance),xe=this.height/50,ye=new Float64Array(16);P.perspective(ye,this._fov,this.width/this.height,xe,oe),ye[8]=2*-m.x/this.width,ye[9]=2*m.y/this.height,P.scale(ye,ye,[1,-1,1]),P.translate(ye,ye,[0,0,-this.cameraToCenterDistance]),P.rotateX(ye,ye,this._pitch),P.rotateZ(ye,ye,this.angle),P.translate(ye,ye,[-$,-X,0]),this.mercatorMatrix=P.scale([],ye,[this.worldSize,this.worldSize,this.worldSize]),P.scale(ye,ye,[1,1,P.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ye,this.invProjMatrix=P.invert([],this.projMatrix);var De=this.width%2/2,He=this.height%2/2,$e=Math.cos(this.angle),ft=Math.sin(this.angle),pt=$-Math.round($)+$e*De+ft*He,wt=X-Math.round(X)+$e*He+ft*De,dt=new Float64Array(ye);if(P.translate(dt,dt,[pt>.5?pt-1:pt,wt>.5?wt-1:wt,0]),this.alignedProjMatrix=dt,ye=P.create(),P.scale(ye,ye,[this.width/2,-this.height/2,1]),P.translate(ye,ye,[1,-1,0]),this.labelPlaneMatrix=ye,ye=P.create(),P.scale(ye,ye,[1,-1,1]),P.translate(ye,ye,[-1,-1,0]),P.scale(ye,ye,[2/this.width,2/this.height,1]),this.glCoordMatrix=ye,this.pixelMatrix=P.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ye=P.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ye,this._posMatrixCache={},this._alignedPosMatrixCache={}}},vs.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var m=this.pointCoordinate(new P.Point(0,0)),w=[m.x*this.worldSize,m.y*this.worldSize,0,1];return P.transformMat4(w,w,this.pixelMatrix)[3]/this.cameraToCenterDistance},vs.prototype.getCameraPoint=function(){var m=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new P.Point(0,m))},vs.prototype.getCameraQueryGeometry=function(m){var w=this.getCameraPoint();if(m.length===1)return[m[0],w];for(var _=w.x,T=w.y,N=w.x,$=w.y,X=0,oe=m;X<oe.length;X+=1){var xe=oe[X];_=Math.min(_,xe.x),T=Math.min(T,xe.y),N=Math.max(N,xe.x),$=Math.max($,xe.y)}return[new P.Point(_,T),new P.Point(N,T),new P.Point(N,$),new P.Point(_,$),new P.Point(_,T)]},Object.defineProperties(vs.prototype,Ns);var bc=function(m){var w,_,T,N;this._hashName=m&&encodeURIComponent(m),P.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(w=this._updateHashUnthrottled.bind(this),_=!1,T=null,N=function(){T=null,_&&(w(),T=setTimeout(N,300),_=!1)},function(){return _=!0,T||N(),T})};bc.prototype.addTo=function(m){return this._map=m,P.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},bc.prototype.remove=function(){return P.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},bc.prototype.getHashString=function(m){var w=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,T=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),N=Math.pow(10,T),$=Math.round(w.lng*N)/N,X=Math.round(w.lat*N)/N,oe=this._map.getBearing(),xe=this._map.getPitch(),ye="";if(ye+=m?"/"+$+"/"+X+"/"+_:_+"/"+X+"/"+$,(oe||xe)&&(ye+="/"+Math.round(10*oe)/10),xe&&(ye+="/"+Math.round(xe)),this._hashName){var De=this._hashName,He=!1,$e=P.window.location.hash.slice(1).split("&").map(function(ft){var pt=ft.split("=")[0];return pt===De?(He=!0,pt+"="+ye):ft}).filter(function(ft){return ft});return He||$e.push(De+"="+ye),"#"+$e.join("&")}return"#"+ye},bc.prototype._getCurrentHash=function(){var m,w=this,_=P.window.location.hash.replace("#","");return this._hashName?(_.split("&").map(function(T){return T.split("=")}).forEach(function(T){T[0]===w._hashName&&(m=T)}),(m&&m[1]||"").split("/")):_.split("/")},bc.prototype._onHashChange=function(){var m=this._getCurrentHash();if(m.length>=3&&!m.some(function(_){return isNaN(_)})){var w=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:w,pitch:+(m[4]||0)}),!0}return!1},bc.prototype._updateHashUnthrottled=function(){var m=P.window.location.href.replace(/(#.+)?$/,this.getHashString());try{P.window.history.replaceState(P.window.history.state,null,m)}catch(w){}};var fc={linearity:.3,easing:P.bezier(0,0,.3,1)},xc=P.extend({deceleration:2500,maxSpeed:1400},fc),Pe=P.extend({deceleration:20,maxSpeed:1400},fc),Ih=P.extend({deceleration:1e3,maxSpeed:360},fc),cf=P.extend({deceleration:1e3,maxSpeed:90},fc),Cf=function(m){this._map=m,this.clear()};function Af(m,w){(!m.duration||m.duration<w.duration)&&(m.duration=w.duration,m.easing=w.easing)}function Lh(m,w,_){var T=_.maxSpeed,N=_.linearity,$=_.deceleration,X=P.clamp(m*N/(w/1e3),-T,T),oe=Math.abs(X)/($*N);return{easing:_.easing,duration:1e3*oe,amount:X*(oe/2)}}Cf.prototype.clear=function(){this._inertiaBuffer=[]},Cf.prototype.record=function(m){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.browser.now(),settings:m})},Cf.prototype._drainInertiaBuffer=function(){for(var m=this._inertiaBuffer,w=P.browser.now();m.length>0&&w-m[0].time>160;)m.shift()},Cf.prototype._onMoveEnd=function(m){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var w={zoom:0,bearing:0,pitch:0,pan:new P.Point(0,0),pinchAround:void 0,around:void 0},_=0,T=this._inertiaBuffer;_<T.length;_+=1){var N=T[_].settings;w.zoom+=N.zoomDelta||0,w.bearing+=N.bearingDelta||0,w.pitch+=N.pitchDelta||0,N.panDelta&&w.pan._add(N.panDelta),N.around&&(w.around=N.around),N.pinchAround&&(w.pinchAround=N.pinchAround)}var $=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,X={};if(w.pan.mag()){var oe=Lh(w.pan.mag(),$,P.extend({},xc,m||{}));X.offset=w.pan.mult(oe.amount/w.pan.mag()),X.center=this._map.transform.center,Af(X,oe)}if(w.zoom){var xe=Lh(w.zoom,$,Pe);X.zoom=this._map.transform.zoom+xe.amount,Af(X,xe)}if(w.bearing){var ye=Lh(w.bearing,$,Ih);X.bearing=this._map.transform.bearing+P.clamp(ye.amount,-179,179),Af(X,ye)}if(w.pitch){var De=Lh(w.pitch,$,cf);X.pitch=this._map.transform.pitch+De.amount,Af(X,De)}if(X.zoom||X.bearing){var He=w.pinchAround===void 0?w.around:w.pinchAround;X.around=He?this._map.unproject(He):this._map.getCenter()}return this.clear(),P.extend(X,{noMoveStart:!0})}};var Cu=function(m){function w(T,N,$,X){X===void 0&&(X={});var oe=ee.mousePos(N.getCanvasContainer(),$),xe=N.unproject(oe);m.call(this,T,P.extend({point:oe,lngLat:xe,originalEvent:$},X)),this._defaultPrevented=!1,this.target=N}m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(P.Event),nl=function(m){function w(T,N,$){var X=T==="touchend"?$.changedTouches:$.touches,oe=ee.touchPos(N.getCanvasContainer(),X),xe=oe.map(function(He){return N.unproject(He)}),ye=oe.reduce(function(He,$e,ft,pt){return He.add($e.div(pt.length))},new P.Point(0,0)),De=N.unproject(ye);m.call(this,T,{points:oe,point:ye,lngLats:xe,lngLat:De,originalEvent:$}),this._defaultPrevented=!1}m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(P.Event),Wc=function(m){function w(T,N,$){m.call(this,T,{originalEvent:$}),this._defaultPrevented=!1}m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(P.Event),zi=function(m,w){this._map=m,this._clickTolerance=w.clickTolerance};zi.prototype.reset=function(){delete this._mousedownPos},zi.prototype.wheel=function(m){return this._firePreventable(new Wc(m.type,this._map,m))},zi.prototype.mousedown=function(m,w){return this._mousedownPos=w,this._firePreventable(new Cu(m.type,this._map,m))},zi.prototype.mouseup=function(m){this._map.fire(new Cu(m.type,this._map,m))},zi.prototype.click=function(m,w){this._mousedownPos&&this._mousedownPos.dist(w)>=this._clickTolerance||this._map.fire(new Cu(m.type,this._map,m))},zi.prototype.dblclick=function(m){return this._firePreventable(new Cu(m.type,this._map,m))},zi.prototype.mouseover=function(m){this._map.fire(new Cu(m.type,this._map,m))},zi.prototype.mouseout=function(m){this._map.fire(new Cu(m.type,this._map,m))},zi.prototype.touchstart=function(m){return this._firePreventable(new nl(m.type,this._map,m))},zi.prototype.touchmove=function(m){this._map.fire(new nl(m.type,this._map,m))},zi.prototype.touchend=function(m){this._map.fire(new nl(m.type,this._map,m))},zi.prototype.touchcancel=function(m){this._map.fire(new nl(m.type,this._map,m))},zi.prototype._firePreventable=function(m){if(this._map.fire(m),m.defaultPrevented)return{}},zi.prototype.isEnabled=function(){return!0},zi.prototype.isActive=function(){return!1},zi.prototype.enable=function(){},zi.prototype.disable=function(){};var Ui=function(m){this._map=m};Ui.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ui.prototype.mousemove=function(m){this._map.fire(new Cu(m.type,this._map,m))},Ui.prototype.mousedown=function(){this._delayContextMenu=!0},Ui.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cu("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ui.prototype.contextmenu=function(m){this._delayContextMenu?this._contextMenuEvent=m:this._map.fire(new Cu(m.type,this._map,m)),this._map.listens("contextmenu")&&m.preventDefault()},Ui.prototype.isEnabled=function(){return!0},Ui.prototype.isActive=function(){return!1},Ui.prototype.enable=function(){},Ui.prototype.disable=function(){};var Gu=function(m,w){this._map=m,this._el=m.getCanvasContainer(),this._container=m.getContainer(),this._clickTolerance=w.clickTolerance||1};function $h(m,w){for(var _={},T=0;T<m.length;T++)_[m[T].identifier]=w[T];return _}Gu.prototype.isEnabled=function(){return!!this._enabled},Gu.prototype.isActive=function(){return!!this._active},Gu.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Gu.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Gu.prototype.mousedown=function(m,w){this.isEnabled()&&m.shiftKey&&m.button===0&&(ee.disableDrag(),this._startPos=this._lastPos=w,this._active=!0)},Gu.prototype.mousemoveWindow=function(m,w){if(this._active){var _=w;if(!(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)){var T=this._startPos;this._lastPos=_,this._box||(this._box=ee.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",m));var N=Math.min(T.x,_.x),$=Math.max(T.x,_.x),X=Math.min(T.y,_.y),oe=Math.max(T.y,_.y);ee.setTransform(this._box,"translate("+N+"px,"+X+"px)"),this._box.style.width=$-N+"px",this._box.style.height=oe-X+"px"}}},Gu.prototype.mouseupWindow=function(m,w){var _=this;if(this._active&&m.button===0){var T=this._startPos,N=w;if(this.reset(),ee.suppressClick(),T.x!==N.x||T.y!==N.y)return this._map.fire(new P.Event("boxzoomend",{originalEvent:m})),{cameraAnimation:function($){return $.fitScreenCoordinates(T,N,_._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",m)}},Gu.prototype.keydown=function(m){this._active&&m.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",m))},Gu.prototype.blur=function(){this.reset()},Gu.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ee.remove(this._box),this._box=null),ee.enableDrag(),delete this._startPos,delete this._lastPos},Gu.prototype._fireEvent=function(m,w){return this._map.fire(new P.Event(m,{originalEvent:w}))};var Wh=function(m){this.reset(),this.numTouches=m.numTouches};Wh.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Wh.prototype.touchstart=function(m,w,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=m.timeStamp),_.length===this.numTouches&&(this.centroid=function(T){for(var N=new P.Point(0,0),$=0,X=T;$<X.length;$+=1)N._add(X[$]);return N.div(T.length)}(w),this.touches=$h(_,w)))},Wh.prototype.touchmove=function(m,w,_){if(!this.aborted&&this.centroid){var T=$h(_,w);for(var N in this.touches){var $=T[N];(!$||$.dist(this.touches[N])>30)&&(this.aborted=!0)}}},Wh.prototype.touchend=function(m,w,_){if((!this.centroid||m.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){var T=!this.aborted&&this.centroid;if(this.reset(),T)return T}};var ji=function(m){this.singleTap=new Wh(m),this.numTaps=m.numTaps,this.reset()};ji.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ji.prototype.touchstart=function(m,w,_){this.singleTap.touchstart(m,w,_)},ji.prototype.touchmove=function(m,w,_){this.singleTap.touchmove(m,w,_)},ji.prototype.touchend=function(m,w,_){var T=this.singleTap.touchend(m,w,_);if(T){var N=m.timeStamp-this.lastTime<500,$=!this.lastTap||this.lastTap.dist(T)<30;if(N&&$||this.reset(),this.count++,this.lastTime=m.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}};var Ic=function(){this._zoomIn=new ji({numTouches:1,numTaps:2}),this._zoomOut=new ji({numTouches:2,numTaps:1}),this.reset()};Ic.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ic.prototype.touchstart=function(m,w,_){this._zoomIn.touchstart(m,w,_),this._zoomOut.touchstart(m,w,_)},Ic.prototype.touchmove=function(m,w,_){this._zoomIn.touchmove(m,w,_),this._zoomOut.touchmove(m,w,_)},Ic.prototype.touchend=function(m,w,_){var T=this,N=this._zoomIn.touchend(m,w,_),$=this._zoomOut.touchend(m,w,_);return N?(this._active=!0,m.preventDefault(),setTimeout(function(){return T.reset()},0),{cameraAnimation:function(X){return X.easeTo({duration:300,zoom:X.getZoom()+1,around:X.unproject(N)},{originalEvent:m})}}):$?(this._active=!0,m.preventDefault(),setTimeout(function(){return T.reset()},0),{cameraAnimation:function(X){return X.easeTo({duration:300,zoom:X.getZoom()-1,around:X.unproject($)},{originalEvent:m})}}):void 0},Ic.prototype.touchcancel=function(){this.reset()},Ic.prototype.enable=function(){this._enabled=!0},Ic.prototype.disable=function(){this._enabled=!1,this.reset()},Ic.prototype.isEnabled=function(){return this._enabled},Ic.prototype.isActive=function(){return this._active};var hf={0:1,2:2},Gn=function(m){this.reset(),this._clickTolerance=m.clickTolerance||1};Gn.prototype.blur=function(){this.reset()},Gn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Gn.prototype._correctButton=function(m,w){return!1},Gn.prototype._move=function(m,w){return{}},Gn.prototype.mousedown=function(m,w){if(!this._lastPoint){var _=ee.mouseButton(m);this._correctButton(m,_)&&(this._lastPoint=w,this._eventButton=_)}},Gn.prototype.mousemoveWindow=function(m,w){var _=this._lastPoint;if(_){if(m.preventDefault(),function(T,N){var $=hf[N];return T.buttons===void 0||(T.buttons&$)!==$}(m,this._eventButton))this.reset();else if(this._moved||!(w.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=w,this._move(_,w)}},Gn.prototype.mouseupWindow=function(m){this._lastPoint&&ee.mouseButton(m)===this._eventButton&&(this._moved&&ee.suppressClick(),this.reset())},Gn.prototype.enable=function(){this._enabled=!0},Gn.prototype.disable=function(){this._enabled=!1,this.reset()},Gn.prototype.isEnabled=function(){return this._enabled},Gn.prototype.isActive=function(){return this._active};var ld=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.mousedown=function(_,T){m.prototype.mousedown.call(this,_,T),this._lastPoint&&(this._active=!0)},w.prototype._correctButton=function(_,T){return T===0&&!_.ctrlKey},w.prototype._move=function(_,T){return{around:T,panDelta:T.sub(_)}},w}(Gn),xh=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype._correctButton=function(_,T){return T===0&&_.ctrlKey||T===2},w.prototype._move=function(_,T){var N=.8*(T.x-_.x);if(N)return this._active=!0,{bearingDelta:N}},w.prototype.contextmenu=function(_){_.preventDefault()},w}(Gn),Xh=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype._correctButton=function(_,T){return T===0&&_.ctrlKey||T===2},w.prototype._move=function(_,T){var N=-.5*(T.y-_.y);if(N)return this._active=!0,{pitchDelta:N}},w.prototype.contextmenu=function(_){_.preventDefault()},w}(Gn),wh=function(m){this._minTouches=1,this._clickTolerance=m.clickTolerance||1,this.reset()};wh.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new P.Point(0,0)},wh.prototype.touchstart=function(m,w,_){return this._calculateTransform(m,w,_)},wh.prototype.touchmove=function(m,w,_){if(this._active&&!(_.length<this._minTouches))return m.preventDefault(),this._calculateTransform(m,w,_)},wh.prototype.touchend=function(m,w,_){this._calculateTransform(m,w,_),this._active&&_.length<this._minTouches&&this.reset()},wh.prototype.touchcancel=function(){this.reset()},wh.prototype._calculateTransform=function(m,w,_){_.length>0&&(this._active=!0);var T=$h(_,w),N=new P.Point(0,0),$=new P.Point(0,0),X=0;for(var oe in T){var xe=T[oe],ye=this._touches[oe];ye&&(N._add(xe),$._add(xe.sub(ye)),X++,T[oe]=xe)}if(this._touches=T,!(X<this._minTouches)&&$.mag()){var De=$.div(X);if(this._sum._add(De),!(this._sum.mag()<this._clickTolerance))return{around:N.div(X),panDelta:De}}},wh.prototype.enable=function(){this._enabled=!0},wh.prototype.disable=function(){this._enabled=!1,this.reset()},wh.prototype.isEnabled=function(){return this._enabled},wh.prototype.isActive=function(){return this._active};var oh=function(){this.reset()};function ff(m,w,_){for(var T=0;T<m.length;T++)if(m[T].identifier===_)return w[T]}function Tf(m,w){return Math.log(m/w)/Math.LN2}oh.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},oh.prototype._start=function(m){},oh.prototype._move=function(m,w,_){return{}},oh.prototype.touchstart=function(m,w,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([w[0],w[1]]))},oh.prototype.touchmove=function(m,w,_){if(this._firstTwoTouches){m.preventDefault();var T=this._firstTwoTouches,N=T[1],$=ff(_,w,T[0]),X=ff(_,w,N);if($&&X){var oe=this._aroundCenter?null:$.add(X).div(2);return this._move([$,X],oe,m)}}},oh.prototype.touchend=function(m,w,_){if(this._firstTwoTouches){var T=this._firstTwoTouches,N=T[1],$=ff(_,w,T[0]),X=ff(_,w,N);$&&X||(this._active&&ee.suppressClick(),this.reset())}},oh.prototype.touchcancel=function(){this.reset()},oh.prototype.enable=function(m){this._enabled=!0,this._aroundCenter=!!m&&m.around==="center"},oh.prototype.disable=function(){this._enabled=!1,this.reset()},oh.prototype.isEnabled=function(){return this._enabled},oh.prototype.isActive=function(){return this._active};var Jl=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.reset=function(){m.prototype.reset.call(this),delete this._distance,delete this._startDistance},w.prototype._start=function(_){this._startDistance=this._distance=_[0].dist(_[1])},w.prototype._move=function(_,T){var N=this._distance;if(this._distance=_[0].dist(_[1]),this._active||!(Math.abs(Tf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tf(this._distance,N),pinchAround:T}},w}(oh);function wc(m,w){return 180*m.angleWith(w)/Math.PI}var Ql=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.reset=function(){m.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},w.prototype._start=function(_){this._startVector=this._vector=_[0].sub(_[1]),this._minDiameter=_[0].dist(_[1])},w.prototype._move=function(_,T){var N=this._vector;if(this._vector=_[0].sub(_[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wc(this._vector,N),pinchAround:T}},w.prototype._isBelowThreshold=function(_){this._minDiameter=Math.min(this._minDiameter,_.mag());var T=25/(Math.PI*this._minDiameter)*360,N=wc(_,this._startVector);return Math.abs(N)<T},w}(oh);function Yh(m){return Math.abs(m.y)>Math.abs(m.x)}var Mf=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.reset=function(){m.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},w.prototype._start=function(_){this._lastPoints=_,Yh(_[0].sub(_[1]))&&(this._valid=!1)},w.prototype._move=function(_,T,N){var $=_[0].sub(this._lastPoints[0]),X=_[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically($,X,N.timeStamp),this._valid)return this._lastPoints=_,this._active=!0,{pitchDelta:($.y+X.y)/2*-.5}},w.prototype.gestureBeginsVertically=function(_,T,N){if(this._valid!==void 0)return this._valid;var $=_.mag()>=2,X=T.mag()>=2;if($||X){if(!$||!X)return this._firstMove===void 0&&(this._firstMove=N),N-this._firstMove<100&&void 0;var oe=_.y>0==T.y>0;return Yh(_)&&Yh(T)&&oe}},w}(oh),pf={panStep:100,bearingStep:15,pitchStep:10},Lc=function(){var m=pf;this._panStep=m.panStep,this._bearingStep=m.bearingStep,this._pitchStep=m.pitchStep,this._rotationDisabled=!1};function _l(m){return m*(2-m)}Lc.prototype.blur=function(){this.reset()},Lc.prototype.reset=function(){this._active=!1},Lc.prototype.keydown=function(m){var w=this;if(!(m.altKey||m.ctrlKey||m.metaKey)){var _=0,T=0,N=0,$=0,X=0;switch(m.keyCode){case 61:case 107:case 171:case 187:_=1;break;case 189:case 109:case 173:_=-1;break;case 37:m.shiftKey?T=-1:(m.preventDefault(),$=-1);break;case 39:m.shiftKey?T=1:(m.preventDefault(),$=1);break;case 38:m.shiftKey?N=1:(m.preventDefault(),X=-1);break;case 40:m.shiftKey?N=-1:(m.preventDefault(),X=1);break;default:return}return this._rotationDisabled&&(T=0,N=0),{cameraAnimation:function(oe){var xe=oe.getZoom();oe.easeTo({duration:300,easeId:"keyboardHandler",easing:_l,zoom:_?Math.round(xe)+_*(m.shiftKey?2:1):xe,bearing:oe.getBearing()+T*w._bearingStep,pitch:oe.getPitch()+N*w._pitchStep,offset:[-$*w._panStep,-X*w._panStep],center:oe.getCenter()},{originalEvent:m})}}}},Lc.prototype.enable=function(){this._enabled=!0},Lc.prototype.disable=function(){this._enabled=!1,this.reset()},Lc.prototype.isEnabled=function(){return this._enabled},Lc.prototype.isActive=function(){return this._active},Lc.prototype.disableRotation=function(){this._rotationDisabled=!0},Lc.prototype.enableRotation=function(){this._rotationDisabled=!1};var xo=function(m,w){this._map=m,this._el=m.getCanvasContainer(),this._handler=w,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,P.bindAll(["_onTimeout"],this)};xo.prototype.setZoomRate=function(m){this._defaultZoomRate=m},xo.prototype.setWheelZoomRate=function(m){this._wheelZoomRate=m},xo.prototype.isEnabled=function(){return!!this._enabled},xo.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},xo.prototype.isZooming=function(){return!!this._zooming},xo.prototype.enable=function(m){this.isEnabled()||(this._enabled=!0,this._aroundCenter=m&&m.around==="center")},xo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},xo.prototype.wheel=function(m){if(this.isEnabled()){var w=m.deltaMode===P.window.WheelEvent.DOM_DELTA_LINE?40*m.deltaY:m.deltaY,_=P.browser.now(),T=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,w!==0&&w%4.000244140625==0?this._type="wheel":w!==0&&Math.abs(w)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=w,this._timeout=setTimeout(this._onTimeout,40,m)):this._type||(this._type=Math.abs(T*w)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,w+=this._lastValue)),m.shiftKey&&w&&(w/=4),this._type&&(this._lastWheelEvent=m,this._delta-=w,this._active||this._start(m)),m.preventDefault()}},xo.prototype._onTimeout=function(m){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},xo.prototype._start=function(m){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var w=ee.mousePos(this._el,m);this._around=P.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(w)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},xo.prototype.renderFrame=function(){var m=this;if(this._frameId&&(this._frameId=null,this.isActive())){var w=this._map.transform;if(this._delta!==0){var _=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,T=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&T!==0&&(T=1/T);var N=typeof this._targetZoom=="number"?w.zoomScale(this._targetZoom):w.scale;this._targetZoom=Math.min(w.maxZoom,Math.max(w.minZoom,w.scaleZoom(N*T))),this._type==="wheel"&&(this._startZoom=w.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var $,X=typeof this._targetZoom=="number"?this._targetZoom:w.zoom,oe=this._startZoom,xe=this._easing,ye=!1;if(this._type==="wheel"&&oe&&xe){var De=Math.min((P.browser.now()-this._lastWheelEventTime)/200,1),He=xe(De);$=P.number(oe,X,He),De<1?this._frameId||(this._frameId=!0):ye=!0}else $=X,ye=!0;return this._active=!0,ye&&(this._active=!1,this._finishTimeout=setTimeout(function(){m._zooming=!1,m._handler._triggerRenderFrame(),delete m._targetZoom,delete m._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ye,zoomDelta:$-w.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},xo.prototype._smoothOutEasing=function(m){var w=P.ease;if(this._prevEase){var _=this._prevEase,T=(P.browser.now()-_.start)/_.duration,N=_.easing(T+.01)-_.easing(T),$=.27/Math.sqrt(N*N+1e-4)*.01,X=Math.sqrt(.0729-$*$);w=P.bezier($,X,.25,1)}return this._prevEase={start:P.browser.now(),duration:m,easing:w},w},xo.prototype.blur=function(){this.reset()},xo.prototype.reset=function(){this._active=!1};var Dl=function(m,w){this._clickZoom=m,this._tapZoom=w};Dl.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Dl.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Dl.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Dl.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Po=function(){this.reset()};Po.prototype.reset=function(){this._active=!1},Po.prototype.blur=function(){this.reset()},Po.prototype.dblclick=function(m,w){return m.preventDefault(),{cameraAnimation:function(_){_.easeTo({duration:300,zoom:_.getZoom()+(m.shiftKey?-1:1),around:_.unproject(w)},{originalEvent:m})}}},Po.prototype.enable=function(){this._enabled=!0},Po.prototype.disable=function(){this._enabled=!1,this.reset()},Po.prototype.isEnabled=function(){return this._enabled},Po.prototype.isActive=function(){return this._active};var dl=function(){this._tap=new ji({numTouches:1,numTaps:1}),this.reset()};dl.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},dl.prototype.touchstart=function(m,w,_){this._swipePoint||(this._tapTime&&m.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=w[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(m,w,_))},dl.prototype.touchmove=function(m,w,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;var T=w[0],N=T.y-this._swipePoint.y;return this._swipePoint=T,m.preventDefault(),this._active=!0,{zoomDelta:N/128}}}else this._tap.touchmove(m,w,_)},dl.prototype.touchend=function(m,w,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(m,w,_)&&(this._tapTime=m.timeStamp)},dl.prototype.touchcancel=function(){this.reset()},dl.prototype.enable=function(){this._enabled=!0},dl.prototype.disable=function(){this._enabled=!1,this.reset()},dl.prototype.isEnabled=function(){return this._enabled},dl.prototype.isActive=function(){return this._active};var Kf=function(m,w,_){this._el=m,this._mousePan=w,this._touchPan=_};Kf.prototype.enable=function(m){this._inertiaOptions=m||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Kf.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Kf.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Kf.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Pf=function(m,w,_){this._pitchWithRotate=m.pitchWithRotate,this._mouseRotate=w,this._mousePitch=_};Pf.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Pf.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Pf.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Pf.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Sc=function(m,w,_,T){this._el=m,this._touchZoom=w,this._touchRotate=_,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0};Sc.prototype.enable=function(m){this._touchZoom.enable(m),this._rotationDisabled||this._touchRotate.enable(m),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Sc.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Sc.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Sc.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Sc.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Sc.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ec=function(m){return m.zoom||m.drag||m.pitch||m.rotate},Al=function(m){function w(){m.apply(this,arguments)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w}(P.Event);function aa(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}var ta=function(m,w){this._map=m,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cf(m),this._bearingSnap=w.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(w),P.bindAll(["handleEvent","handleWindowEvent"],this);var _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[P.window.document,"mousemove",{capture:!0}],[P.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[P.window,"blur",void 0]];for(var T=0,N=this._listeners;T<N.length;T+=1){var $=N[T],X=$[0];ee.addEventListener(X,$[1],X===P.window.document?this.handleWindowEvent:this.handleEvent,$[2])}};ta.prototype.destroy=function(){for(var m=0,w=this._listeners;m<w.length;m+=1){var _=w[m],T=_[0];ee.removeEventListener(T,_[1],T===P.window.document?this.handleWindowEvent:this.handleEvent,_[2])}},ta.prototype._addDefaultHandlers=function(m){var w=this._map,_=w.getCanvasContainer();this._add("mapEvent",new zi(w,m));var T=w.boxZoom=new Gu(w,m);this._add("boxZoom",T);var N=new Ic,$=new Po;w.doubleClickZoom=new Dl($,N),this._add("tapZoom",N),this._add("clickZoom",$);var X=new dl;this._add("tapDragZoom",X);var oe=w.touchPitch=new Mf;this._add("touchPitch",oe);var xe=new xh(m),ye=new Xh(m);w.dragRotate=new Pf(m,xe,ye),this._add("mouseRotate",xe,["mousePitch"]),this._add("mousePitch",ye,["mouseRotate"]);var De=new ld(m),He=new wh(m);w.dragPan=new Kf(_,De,He),this._add("mousePan",De),this._add("touchPan",He,["touchZoom","touchRotate"]);var $e=new Ql,ft=new Jl;w.touchZoomRotate=new Sc(_,ft,$e,X),this._add("touchRotate",$e,["touchPan","touchZoom"]),this._add("touchZoom",ft,["touchPan","touchRotate"]);var pt=w.scrollZoom=new xo(w,this);this._add("scrollZoom",pt,["mousePan"]);var wt=w.keyboard=new Lc;this._add("keyboard",wt),this._add("blockableMapEvent",new Ui(w));for(var dt=0,Ft=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];dt<Ft.length;dt+=1){var ar=Ft[dt];m.interactive&&m[ar]&&w[ar].enable(m[ar])}},ta.prototype._add=function(m,w,_){this._handlers.push({handlerName:m,handler:w,allowed:_}),this._handlersById[m]=w},ta.prototype.stop=function(m){if(!this._updatingCamera){for(var w=0,_=this._handlers;w<_.length;w+=1)_[w].handler.reset();this._inertia.clear(),this._fireEvents({},{},m),this._changes=[]}},ta.prototype.isActive=function(){for(var m=0,w=this._handlers;m<w.length;m+=1)if(w[m].handler.isActive())return!0;return!1},ta.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ta.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ta.prototype.isMoving=function(){return!!Ec(this._eventsInProgress)||this.isZooming()},ta.prototype._blockedByActive=function(m,w,_){for(var T in m)if(T!==_&&(!w||w.indexOf(T)<0))return!0;return!1},ta.prototype.handleWindowEvent=function(m){this.handleEvent(m,m.type+"Window")},ta.prototype._getMapTouches=function(m){for(var w=[],_=0,T=m;_<T.length;_+=1){var N=T[_];this._el.contains(N.target)&&w.push(N)}return w},ta.prototype.handleEvent=function(m,w){this._updatingCamera=!0;for(var _=m.type==="renderFrame"?void 0:m,T={needsRenderFrame:!1},N={},$={},X=m.touches?this._getMapTouches(m.touches):void 0,oe=X?ee.touchPos(this._el,X):ee.mousePos(this._el,m),xe=0,ye=this._handlers;xe<ye.length;xe+=1){var De=ye[xe],He=De.handlerName,$e=De.handler,ft=De.allowed;if($e.isEnabled()){var pt=void 0;this._blockedByActive($,ft,He)?$e.reset():$e[w||m.type]&&(pt=$e[w||m.type](m,oe,X),this.mergeHandlerResult(T,N,pt,He,_),pt&&pt.needsRenderFrame&&this._triggerRenderFrame()),(pt||$e.isActive())&&($[He]=$e)}}var wt={};for(var dt in this._previousActiveHandlers)$[dt]||(wt[dt]=_);this._previousActiveHandlers=$,(Object.keys(wt).length||aa(T))&&(this._changes.push([T,N,wt]),this._triggerRenderFrame()),(Object.keys($).length||aa(T))&&this._map._stop(!0),this._updatingCamera=!1;var Ft=T.cameraAnimation;Ft&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ft(this._map))},ta.prototype.mergeHandlerResult=function(m,w,_,T,N){if(_){P.extend(m,_);var $={handlerName:T,originalEvent:_.originalEvent||N};_.zoomDelta!==void 0&&(w.zoom=$),_.panDelta!==void 0&&(w.drag=$),_.pitchDelta!==void 0&&(w.pitch=$),_.bearingDelta!==void 0&&(w.rotate=$)}},ta.prototype._applyChanges=function(){for(var m={},w={},_={},T=0,N=this._changes;T<N.length;T+=1){var $=N[T],X=$[0],oe=$[1],xe=$[2];X.panDelta&&(m.panDelta=(m.panDelta||new P.Point(0,0))._add(X.panDelta)),X.zoomDelta&&(m.zoomDelta=(m.zoomDelta||0)+X.zoomDelta),X.bearingDelta&&(m.bearingDelta=(m.bearingDelta||0)+X.bearingDelta),X.pitchDelta&&(m.pitchDelta=(m.pitchDelta||0)+X.pitchDelta),X.around!==void 0&&(m.around=X.around),X.pinchAround!==void 0&&(m.pinchAround=X.pinchAround),X.noInertia&&(m.noInertia=X.noInertia),P.extend(w,oe),P.extend(_,xe)}this._updateMapTransform(m,w,_),this._changes=[]},ta.prototype._updateMapTransform=function(m,w,_){var T=this._map,N=T.transform;if(!aa(m))return this._fireEvents(w,_,!0);var $=m.panDelta,X=m.zoomDelta,oe=m.bearingDelta,xe=m.pitchDelta,ye=m.around,De=m.pinchAround;De!==void 0&&(ye=De),T._stop(!0),ye=ye||T.transform.centerPoint;var He=N.pointLocation($?ye.sub($):ye);oe&&(N.bearing+=oe),xe&&(N.pitch+=xe),X&&(N.zoom+=X),N.setLocationAtPoint(He,ye),this._map._update(),m.noInertia||this._inertia.record(m),this._fireEvents(w,_,!0)},ta.prototype._fireEvents=function(m,w,_){var T=this,N=Ec(this._eventsInProgress),$=Ec(m),X={};for(var oe in m)this._eventsInProgress[oe]||(X[oe+"start"]=m[oe].originalEvent),this._eventsInProgress[oe]=m[oe];for(var xe in!N&&$&&this._fireEvent("movestart",$.originalEvent),X)this._fireEvent(xe,X[xe]);for(var ye in $&&this._fireEvent("move",$.originalEvent),m)this._fireEvent(ye,m[ye].originalEvent);var De,He={};for(var $e in this._eventsInProgress){var ft=this._eventsInProgress[$e],pt=ft.handlerName,wt=ft.originalEvent;this._handlersById[pt].isActive()||(delete this._eventsInProgress[$e],He[$e+"end"]=De=w[pt]||wt)}for(var dt in He)this._fireEvent(dt,He[dt]);var Ft=Ec(this._eventsInProgress);if(_&&(N||$)&&!Ft){this._updatingCamera=!0;var ar=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),nr=function(Ir){return Ir!==0&&-T._bearingSnap<Ir&&Ir<T._bearingSnap};ar?(nr(ar.bearing||this._map.getBearing())&&(ar.bearing=0),this._map.easeTo(ar,{originalEvent:De})):(this._map.fire(new P.Event("moveend",{originalEvent:De})),nr(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ta.prototype._fireEvent=function(m,w){this._map.fire(new P.Event(m,w?{originalEvent:w}:{}))},ta.prototype._requestFrame=function(){var m=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(w){delete m._frameId,m.handleEvent(new Al("renderFrame",{timeStamp:w})),m._applyChanges()})},ta.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Da=function(m){function w(_,T){m.call(this),this._moving=!1,this._zooming=!1,this.transform=_,this._bearingSnap=T.bearingSnap,P.bindAll(["_renderFrameCallback"],this)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.getCenter=function(){return new P.LngLat(this.transform.center.lng,this.transform.center.lat)},w.prototype.setCenter=function(_,T){return this.jumpTo({center:_},T)},w.prototype.panBy=function(_,T,N){return _=P.Point.convert(_).mult(-1),this.panTo(this.transform.center,P.extend({offset:_},T),N)},w.prototype.panTo=function(_,T,N){return this.easeTo(P.extend({center:_},T),N)},w.prototype.getZoom=function(){return this.transform.zoom},w.prototype.setZoom=function(_,T){return this.jumpTo({zoom:_},T),this},w.prototype.zoomTo=function(_,T,N){return this.easeTo(P.extend({zoom:_},T),N)},w.prototype.zoomIn=function(_,T){return this.zoomTo(this.getZoom()+1,_,T),this},w.prototype.zoomOut=function(_,T){return this.zoomTo(this.getZoom()-1,_,T),this},w.prototype.getBearing=function(){return this.transform.bearing},w.prototype.setBearing=function(_,T){return this.jumpTo({bearing:_},T),this},w.prototype.getPadding=function(){return this.transform.padding},w.prototype.setPadding=function(_,T){return this.jumpTo({padding:_},T),this},w.prototype.rotateTo=function(_,T,N){return this.easeTo(P.extend({bearing:_},T),N)},w.prototype.resetNorth=function(_,T){return this.rotateTo(0,P.extend({duration:1e3},_),T),this},w.prototype.resetNorthPitch=function(_,T){return this.easeTo(P.extend({bearing:0,pitch:0,duration:1e3},_),T),this},w.prototype.snapToNorth=function(_,T){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(_,T):this},w.prototype.getPitch=function(){return this.transform.pitch},w.prototype.setPitch=function(_,T){return this.jumpTo({pitch:_},T),this},w.prototype.cameraForBounds=function(_,T){_=P.LngLatBounds.convert(_);var N=T&&T.bearing||0;return this._cameraForBoxAndBearing(_.getNorthWest(),_.getSouthEast(),N,T)},w.prototype._cameraForBoxAndBearing=function(_,T,N,$){var X={top:0,bottom:0,right:0,left:0};if(typeof($=P.extend({padding:X,offset:[0,0],maxZoom:this.transform.maxZoom},$)).padding=="number"){var oe=$.padding;$.padding={top:oe,bottom:oe,right:oe,left:oe}}$.padding=P.extend(X,$.padding);var xe=this.transform,ye=xe.padding,De=xe.project(P.LngLat.convert(_)),He=xe.project(P.LngLat.convert(T)),$e=De.rotate(-N*Math.PI/180),ft=He.rotate(-N*Math.PI/180),pt=new P.Point(Math.max($e.x,ft.x),Math.max($e.y,ft.y)),wt=new P.Point(Math.min($e.x,ft.x),Math.min($e.y,ft.y)),dt=pt.sub(wt),Ft=(xe.width-(ye.left+ye.right+$.padding.left+$.padding.right))/dt.x,ar=(xe.height-(ye.top+ye.bottom+$.padding.top+$.padding.bottom))/dt.y;if(!(ar<0||Ft<0)){var nr=Math.min(xe.scaleZoom(xe.scale*Math.min(Ft,ar)),$.maxZoom),Ir=typeof $.offset.x=="number"?new P.Point($.offset.x,$.offset.y):P.Point.convert($.offset),_r=new P.Point(($.padding.left-$.padding.right)/2,($.padding.top-$.padding.bottom)/2).rotate(N*Math.PI/180),Qr=Ir.add(_r).mult(xe.scale/xe.zoomScale(nr));return{center:xe.unproject(De.add(He).div(2).sub(Qr)),zoom:nr,bearing:N}}P.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},w.prototype.fitBounds=function(_,T,N){return this._fitInternal(this.cameraForBounds(_,T),T,N)},w.prototype.fitScreenCoordinates=function(_,T,N,$,X){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(P.Point.convert(_)),this.transform.pointLocation(P.Point.convert(T)),N,$),$,X)},w.prototype._fitInternal=function(_,T,N){return _?(delete(T=P.extend(_,T)).padding,T.linear?this.easeTo(T,N):this.flyTo(T,N)):this},w.prototype.jumpTo=function(_,T){this.stop();var N=this.transform,$=!1,X=!1,oe=!1;return"zoom"in _&&N.zoom!==+_.zoom&&($=!0,N.zoom=+_.zoom),_.center!==void 0&&(N.center=P.LngLat.convert(_.center)),"bearing"in _&&N.bearing!==+_.bearing&&(X=!0,N.bearing=+_.bearing),"pitch"in _&&N.pitch!==+_.pitch&&(oe=!0,N.pitch=+_.pitch),_.padding==null||N.isPaddingEqual(_.padding)||(N.padding=_.padding),this.fire(new P.Event("movestart",T)).fire(new P.Event("move",T)),$&&this.fire(new P.Event("zoomstart",T)).fire(new P.Event("zoom",T)).fire(new P.Event("zoomend",T)),X&&this.fire(new P.Event("rotatestart",T)).fire(new P.Event("rotate",T)).fire(new P.Event("rotateend",T)),oe&&this.fire(new P.Event("pitchstart",T)).fire(new P.Event("pitch",T)).fire(new P.Event("pitchend",T)),this.fire(new P.Event("moveend",T))},w.prototype.easeTo=function(_,T){var N=this;this._stop(!1,_.easeId),((_=P.extend({offset:[0,0],duration:500,easing:P.ease},_)).animate===!1||!_.essential&&P.browser.prefersReducedMotion)&&(_.duration=0);var $=this.transform,X=this.getZoom(),oe=this.getBearing(),xe=this.getPitch(),ye=this.getPadding(),De="zoom"in _?+_.zoom:X,He="bearing"in _?this._normalizeBearing(_.bearing,oe):oe,$e="pitch"in _?+_.pitch:xe,ft="padding"in _?_.padding:$.padding,pt=P.Point.convert(_.offset),wt=$.centerPoint.add(pt),dt=$.pointLocation(wt),Ft=P.LngLat.convert(_.center||dt);this._normalizeCenter(Ft);var ar,nr,Ir=$.project(dt),_r=$.project(Ft).sub(Ir),Qr=$.zoomScale(De-X);_.around&&(ar=P.LngLat.convert(_.around),nr=$.locationPoint(ar));var nn={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||De!==X,this._rotating=this._rotating||oe!==He,this._pitching=this._pitching||$e!==xe,this._padding=!$.isPaddingEqual(ft),this._easeId=_.easeId,this._prepareEase(T,_.noMoveStart,nn),this._ease(function(Ln){if(N._zooming&&($.zoom=P.number(X,De,Ln)),N._rotating&&($.bearing=P.number(oe,He,Ln)),N._pitching&&($.pitch=P.number(xe,$e,Ln)),N._padding&&($.interpolatePadding(ye,ft,Ln),wt=$.centerPoint.add(pt)),ar)$.setLocationAtPoint(ar,nr);else{var Mn=$.zoomScale($.zoom-X),yi=De>X?Math.min(2,Qr):Math.max(.5,Qr),Ri=Math.pow(yi,1-Ln),Qi=$.unproject(Ir.add(_r.mult(Ln*Ri)).mult(Mn));$.setLocationAtPoint($.renderWorldCopies?Qi.wrap():Qi,wt)}N._fireMoveEvents(T)},function(Ln){N._afterEase(T,Ln)},_),this},w.prototype._prepareEase=function(_,T,N){N===void 0&&(N={}),this._moving=!0,T||N.moving||this.fire(new P.Event("movestart",_)),this._zooming&&!N.zooming&&this.fire(new P.Event("zoomstart",_)),this._rotating&&!N.rotating&&this.fire(new P.Event("rotatestart",_)),this._pitching&&!N.pitching&&this.fire(new P.Event("pitchstart",_))},w.prototype._fireMoveEvents=function(_){this.fire(new P.Event("move",_)),this._zooming&&this.fire(new P.Event("zoom",_)),this._rotating&&this.fire(new P.Event("rotate",_)),this._pitching&&this.fire(new P.Event("pitch",_))},w.prototype._afterEase=function(_,T){if(!this._easeId||!T||this._easeId!==T){delete this._easeId;var N=this._zooming,$=this._rotating,X=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,N&&this.fire(new P.Event("zoomend",_)),$&&this.fire(new P.Event("rotateend",_)),X&&this.fire(new P.Event("pitchend",_)),this.fire(new P.Event("moveend",_))}},w.prototype.flyTo=function(_,T){var N=this;if(!_.essential&&P.browser.prefersReducedMotion){var $=P.pick(_,["center","zoom","bearing","pitch","around"]);return this.jumpTo($,T)}this.stop(),_=P.extend({offset:[0,0],speed:1.2,curve:1.42,easing:P.ease},_);var X=this.transform,oe=this.getZoom(),xe=this.getBearing(),ye=this.getPitch(),De=this.getPadding(),He="zoom"in _?P.clamp(+_.zoom,X.minZoom,X.maxZoom):oe,$e="bearing"in _?this._normalizeBearing(_.bearing,xe):xe,ft="pitch"in _?+_.pitch:ye,pt="padding"in _?_.padding:X.padding,wt=X.zoomScale(He-oe),dt=P.Point.convert(_.offset),Ft=X.centerPoint.add(dt),ar=X.pointLocation(Ft),nr=P.LngLat.convert(_.center||ar);this._normalizeCenter(nr);var Ir=X.project(ar),_r=X.project(nr).sub(Ir),Qr=_.curve,nn=Math.max(X.width,X.height),Ln=nn/wt,Mn=_r.mag();if("minZoom"in _){var yi=P.clamp(Math.min(_.minZoom,oe,He),X.minZoom,X.maxZoom),Ri=nn/X.zoomScale(yi-oe);Qr=Math.sqrt(Ri/Mn*2)}var Qi=Qr*Qr;function Vi(eo){var va=(Ln*Ln-nn*nn+(eo?-1:1)*Qi*Qi*Mn*Mn)/(2*(eo?Ln:nn)*Qi*Mn);return Math.log(Math.sqrt(va*va+1)-va)}function ao(eo){return(Math.exp(eo)-Math.exp(-eo))/2}function Bi(eo){return(Math.exp(eo)+Math.exp(-eo))/2}var oa=Vi(0),Ha=function(eo){return Bi(oa)/Bi(oa+Qr*eo)},ja=function(eo){return nn*((Bi(oa)*(ao(va=oa+Qr*eo)/Bi(va))-ao(oa))/Qi)/Mn;var va},Sa=(Vi(1)-oa)/Qr;if(Math.abs(Mn)<1e-6||!isFinite(Sa)){if(Math.abs(nn-Ln)<1e-6)return this.easeTo(_,T);var Qa=Ln<nn?-1:1;Sa=Math.abs(Math.log(Ln/nn))/Qr,ja=function(){return 0},Ha=function(eo){return Math.exp(Qa*Qr*eo)}}return _.duration="duration"in _?+_.duration:1e3*Sa/("screenSpeed"in _?+_.screenSpeed/Qr:+_.speed),_.maxDuration&&_.duration>_.maxDuration&&(_.duration=0),this._zooming=!0,this._rotating=xe!==$e,this._pitching=ft!==ye,this._padding=!X.isPaddingEqual(pt),this._prepareEase(T,!1),this._ease(function(eo){var va=eo*Sa,tu=1/Ha(va);X.zoom=eo===1?He:oe+X.scaleZoom(tu),N._rotating&&(X.bearing=P.number(xe,$e,eo)),N._pitching&&(X.pitch=P.number(ye,ft,eo)),N._padding&&(X.interpolatePadding(De,pt,eo),Ft=X.centerPoint.add(dt));var Gs=eo===1?nr:X.unproject(Ir.add(_r.mult(ja(va))).mult(tu));X.setLocationAtPoint(X.renderWorldCopies?Gs.wrap():Gs,Ft),N._fireMoveEvents(T)},function(){return N._afterEase(T)},_),this},w.prototype.isEasing=function(){return!!this._easeFrameId},w.prototype.stop=function(){return this._stop()},w.prototype._stop=function(_,T){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var N=this._onEaseEnd;delete this._onEaseEnd,N.call(this,T)}if(!_){var $=this.handlers;$&&$.stop(!1)}return this},w.prototype._ease=function(_,T,N){N.animate===!1||N.duration===0?(_(1),T()):(this._easeStart=P.browser.now(),this._easeOptions=N,this._onEaseFrame=_,this._onEaseEnd=T,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},w.prototype._renderFrameCallback=function(){var _=Math.min((P.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},w.prototype._normalizeBearing=function(_,T){_=P.wrap(_,-180,180);var N=Math.abs(_-T);return Math.abs(_-360-T)<N&&(_-=360),Math.abs(_+360-T)<N&&(_+=360),_},w.prototype._normalizeCenter=function(_){var T=this.transform;if(T.renderWorldCopies&&!T.lngRange){var N=_.lng-T.center.lng;_.lng+=N>180?-360:N<-180?360:0}},w}(P.Evented),ba=function(m){m===void 0&&(m={}),this.options=m,P.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ba.prototype.getDefaultPosition=function(){return"bottom-right"},ba.prototype.onAdd=function(m){var w=this.options&&this.options.compact;return this._map=m,this._container=ee.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ee.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ee.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),w&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),w===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ba.prototype.onRemove=function(){ee.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ba.prototype._setElementTitle=function(m,w){var _=this._map._getUIString("AttributionControl."+w);m.title=_,m.setAttribute("aria-label",_)},ba.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ba.prototype._updateEditLink=function(){var m=this._editLink;m||(m=this._editLink=this._container.querySelector(".mapbox-improve-map"));var w=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||P.config.ACCESS_TOKEN}];if(m){var _=w.reduce(function(T,N,$){return N.value&&(T+=N.key+"="+N.value+($<w.length-1?"&":"")),T},"?");m.href=P.config.FEEDBACK_URL+"/"+_+(this._map._hash?this._map._hash.getHashString(!0):""),m.rel="noopener nofollow",this._setElementTitle(m,"MapFeedback")}},ba.prototype._updateData=function(m){!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ba.prototype._updateAttributions=function(){if(this._map.style){var m=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?m=m.concat(this.options.customAttribution.map(function(oe){return typeof oe!="string"?"":oe})):typeof this.options.customAttribution=="string"&&m.push(this.options.customAttribution)),this._map.style.stylesheet){var w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}var _=this._map.style.sourceCaches;for(var T in _){var N=_[T];if(N.used){var $=N.getSource();$.attribution&&m.indexOf($.attribution)<0&&m.push($.attribution)}}m.sort(function(oe,xe){return oe.length-xe.length});var X=(m=m.filter(function(oe,xe){for(var ye=xe+1;ye<m.length;ye++)if(m[ye].indexOf(oe)>=0)return!1;return!0})).join(" | ");X!==this._attribHTML&&(this._attribHTML=X,m.length?(this._innerContainer.innerHTML=X,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ba.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bl=function(){P.bindAll(["_updateLogo"],this),P.bindAll(["_updateCompact"],this)};bl.prototype.onAdd=function(m){this._map=m,this._container=ee.create("div","mapboxgl-ctrl");var w=ee.create("a","mapboxgl-ctrl-logo");return w.target="_blank",w.rel="noopener nofollow",w.href="https://www.mapbox.com/",w.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),w.setAttribute("rel","noopener nofollow"),this._container.appendChild(w),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bl.prototype.onRemove=function(){ee.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bl.prototype.getDefaultPosition=function(){return"bottom-left"},bl.prototype._updateLogo=function(m){m&&m.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},bl.prototype._logoRequired=function(){if(this._map.style){var m=this._map.style.sourceCaches;for(var w in m)if(m[w].getSource().mapbox_logo)return!0;return!1}},bl.prototype._updateCompact=function(){var m=this._container.children;if(m.length){var w=m[0];this._map.getCanvasContainer().offsetWidth<250?w.classList.add("mapboxgl-compact"):w.classList.remove("mapboxgl-compact")}};var jl=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};jl.prototype.add=function(m){var w=++this._id;return this._queue.push({callback:m,id:w,cancelled:!1}),w},jl.prototype.remove=function(m){for(var w=this._currentlyRunning,_=0,T=w?this._queue.concat(w):this._queue;_<T.length;_+=1){var N=T[_];if(N.id===m)return void(N.cancelled=!0)}},jl.prototype.run=function(m){m===void 0&&(m=0);var w=this._currentlyRunning=this._queue;this._queue=[];for(var _=0,T=w;_<T.length;_+=1){var N=T[_];if(!N.cancelled&&(N.callback(m),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},jl.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var df={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Pu=P.window.HTMLImageElement,Rh=P.window.HTMLElement,ho=P.window.ImageBitmap,vl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},kf=function(m){function w(T){var N=this;if((T=P.extend({},vl,T)).minZoom!=null&&T.maxZoom!=null&&T.minZoom>T.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(T.minPitch!=null&&T.maxPitch!=null&&T.minPitch>T.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(T.minPitch!=null&&T.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(T.maxPitch!=null&&T.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var $=new vs(T.minZoom,T.maxZoom,T.minPitch,T.maxPitch,T.renderWorldCopies);if(m.call(this,$,T),this._interactive=T.interactive,this._maxTileCacheSize=T.maxTileCacheSize,this._failIfMajorPerformanceCaveat=T.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=T.preserveDrawingBuffer,this._antialias=T.antialias,this._trackResize=T.trackResize,this._bearingSnap=T.bearingSnap,this._refreshExpiredTiles=T.refreshExpiredTiles,this._fadeDuration=T.fadeDuration,this._crossSourceCollisions=T.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=T.collectResourceTiming,this._renderTaskQueue=new jl,this._controls=[],this._mapId=P.uniqueId(),this._locale=P.extend({},df,T.locale),this._clickTolerance=T.clickTolerance,this._requestManager=new P.RequestManager(T.transformRequest,T.accessToken),typeof T.container=="string"){if(this._container=P.window.document.getElementById(T.container),!this._container)throw new Error("Container '"+T.container+"' not found.")}else{if(!(T.container instanceof Rh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=T.container}if(T.maxBounds&&this.setMaxBounds(T.maxBounds),P.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return N._update(!1)}),this.on("moveend",function(){return N._update(!1)}),this.on("zoom",function(){return N._update(!0)}),P.window!==void 0&&(P.window.addEventListener("online",this._onWindowOnline,!1),P.window.addEventListener("resize",this._onWindowResize,!1),P.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ta(this,T),this._hash=T.hash&&new bc(typeof T.hash=="string"&&T.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}),T.bounds&&(this.resize(),this.fitBounds(T.bounds,P.extend({},T.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=T.localIdeographFontFamily,T.style&&this.setStyle(T.style,{localIdeographFontFamily:T.localIdeographFontFamily}),T.attributionControl&&this.addControl(new ba({customAttribution:T.customAttribution})),this.addControl(new bl,T.logoPosition),this.on("style.load",function(){N.transform.unmodified&&N.jumpTo(N.style.stylesheet)}),this.on("data",function(X){N._update(X.dataType==="style"),N.fire(new P.Event(X.dataType+"data",X))}),this.on("dataloading",function(X){N.fire(new P.Event(X.dataType+"dataloading",X))})}m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w;var _={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return w.prototype._getMapId=function(){return this._mapId},w.prototype.addControl=function(T,N){if(N===void 0&&(N=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new P.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var $=T.onAdd(this);this._controls.push(T);var X=this._controlPositions[N];return N.indexOf("bottom")!==-1?X.insertBefore($,X.firstChild):X.appendChild($),this},w.prototype.removeControl=function(T){if(!T||!T.onRemove)return this.fire(new P.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var N=this._controls.indexOf(T);return N>-1&&this._controls.splice(N,1),T.onRemove(this),this},w.prototype.hasControl=function(T){return this._controls.indexOf(T)>-1},w.prototype.resize=function(T){var N=this._containerDimensions(),$=N[0],X=N[1];if($===this.transform.width&&X===this.transform.height)return this;this._resizeCanvas($,X),this.transform.resize($,X),this.painter.resize($,X);var oe=!this._moving;return oe&&this.fire(new P.Event("movestart",T)).fire(new P.Event("move",T)),this.fire(new P.Event("resize",T)),oe&&this.fire(new P.Event("moveend",T)),this},w.prototype.getBounds=function(){return this.transform.getBounds()},w.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},w.prototype.setMaxBounds=function(T){return this.transform.setMaxBounds(P.LngLatBounds.convert(T)),this._update()},w.prototype.setMinZoom=function(T){if((T=T==null?-2:T)>=-2&&T<=this.transform.maxZoom)return this.transform.minZoom=T,this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},w.prototype.getMinZoom=function(){return this.transform.minZoom},w.prototype.setMaxZoom=function(T){if((T=T==null?22:T)>=this.transform.minZoom)return this.transform.maxZoom=T,this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")},w.prototype.getMaxZoom=function(){return this.transform.maxZoom},w.prototype.setMinPitch=function(T){if((T=T==null?0:T)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.minPitch=T,this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},w.prototype.getMinPitch=function(){return this.transform.minPitch},w.prototype.setMaxPitch=function(T){if((T=T==null?60:T)>60)throw new Error("maxPitch must be less than or equal to 60");if(T>=this.transform.minPitch)return this.transform.maxPitch=T,this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")},w.prototype.getMaxPitch=function(){return this.transform.maxPitch},w.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},w.prototype.setRenderWorldCopies=function(T){return this.transform.renderWorldCopies=T,this._update()},w.prototype.project=function(T){return this.transform.locationPoint(P.LngLat.convert(T))},w.prototype.unproject=function(T){return this.transform.pointLocation(P.Point.convert(T))},w.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},w.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},w.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},w.prototype._createDelegatedListener=function(T,N,$){var X,oe=this;if(T==="mouseenter"||T==="mouseover"){var xe=!1;return{layer:N,listener:$,delegates:{mousemove:function(De){var He=oe.getLayer(N)?oe.queryRenderedFeatures(De.point,{layers:[N]}):[];He.length?xe||(xe=!0,$.call(oe,new Cu(T,oe,De.originalEvent,{features:He}))):xe=!1},mouseout:function(){xe=!1}}}}if(T==="mouseleave"||T==="mouseout"){var ye=!1;return{layer:N,listener:$,delegates:{mousemove:function(De){(oe.getLayer(N)?oe.queryRenderedFeatures(De.point,{layers:[N]}):[]).length?ye=!0:ye&&(ye=!1,$.call(oe,new Cu(T,oe,De.originalEvent)))},mouseout:function(De){ye&&(ye=!1,$.call(oe,new Cu(T,oe,De.originalEvent)))}}}}return{layer:N,listener:$,delegates:(X={},X[T]=function(De){var He=oe.getLayer(N)?oe.queryRenderedFeatures(De.point,{layers:[N]}):[];He.length&&(De.features=He,$.call(oe,De),delete De.features)},X)}},w.prototype.on=function(T,N,$){if($===void 0)return m.prototype.on.call(this,T,N);var X=this._createDelegatedListener(T,N,$);for(var oe in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(X),X.delegates)this.on(oe,X.delegates[oe]);return this},w.prototype.once=function(T,N,$){if($===void 0)return m.prototype.once.call(this,T,N);var X=this._createDelegatedListener(T,N,$);for(var oe in X.delegates)this.once(oe,X.delegates[oe]);return this},w.prototype.off=function(T,N,$){var X=this;return $===void 0?m.prototype.off.call(this,T,N):(this._delegatedListeners&&this._delegatedListeners[T]&&function(oe){for(var xe=oe[T],ye=0;ye<xe.length;ye++){var De=xe[ye];if(De.layer===N&&De.listener===$){for(var He in De.delegates)X.off(He,De.delegates[He]);return xe.splice(ye,1),X}}}(this._delegatedListeners),this)},w.prototype.queryRenderedFeatures=function(T,N){if(!this.style)return[];var $;if(N!==void 0||T===void 0||T instanceof P.Point||Array.isArray(T)||(N=T,T=void 0),N=N||{},(T=T||[[0,0],[this.transform.width,this.transform.height]])instanceof P.Point||typeof T[0]=="number")$=[P.Point.convert(T)];else{var X=P.Point.convert(T[0]),oe=P.Point.convert(T[1]);$=[X,new P.Point(oe.x,X.y),oe,new P.Point(X.x,oe.y),X]}return this.style.queryRenderedFeatures($,N,this.transform)},w.prototype.querySourceFeatures=function(T,N){return this.style.querySourceFeatures(T,N)},w.prototype.setStyle=function(T,N){return(N=P.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},N)).diff!==!1&&N.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,N),this):(this._localIdeographFontFamily=N.localIdeographFontFamily,this._updateStyle(T,N))},w.prototype._getUIString=function(T){var N=this._locale[T];if(N==null)throw new Error("Missing UI string '"+T+"'");return N},w.prototype._updateStyle=function(T,N){return this.style&&(this.style.setEventedParent(null),this.style._remove()),T?(this.style=new uu(this,N||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T):this.style.loadJSON(T),this):(delete this.style,this)},w.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new uu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},w.prototype._diffStyle=function(T,N){var $=this;if(typeof T=="string"){var X=this._requestManager.normalizeStyleURL(T),oe=this._requestManager.transformRequest(X,P.ResourceType.Style);P.getJSON(oe,function(xe,ye){xe?$.fire(new P.ErrorEvent(xe)):ye&&$._updateDiff(ye,N)})}else typeof T=="object"&&this._updateDiff(T,N)},w.prototype._updateDiff=function(T,N){try{this.style.setState(T)&&this._update(!0)}catch($){P.warnOnce("Unable to perform style diff: "+($.message||$.error||$)+".  Rebuilding the style from scratch."),this._updateStyle(T,N)}},w.prototype.getStyle=function(){if(this.style)return this.style.serialize()},w.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():P.warnOnce("There is no style added to the map.")},w.prototype.addSource=function(T,N){return this._lazyInitEmptyStyle(),this.style.addSource(T,N),this._update(!0)},w.prototype.isSourceLoaded=function(T){var N=this.style&&this.style.sourceCaches[T];if(N!==void 0)return N.loaded();this.fire(new P.ErrorEvent(new Error("There is no source with ID '"+T+"'")))},w.prototype.areTilesLoaded=function(){var T=this.style&&this.style.sourceCaches;for(var N in T){var $=T[N]._tiles;for(var X in $){var oe=$[X];if(oe.state!=="loaded"&&oe.state!=="errored")return!1}}return!0},w.prototype.addSourceType=function(T,N,$){return this._lazyInitEmptyStyle(),this.style.addSourceType(T,N,$)},w.prototype.removeSource=function(T){return this.style.removeSource(T),this._update(!0)},w.prototype.getSource=function(T){return this.style.getSource(T)},w.prototype.addImage=function(T,N,$){$===void 0&&($={});var X=$.pixelRatio;X===void 0&&(X=1);var oe=$.sdf;oe===void 0&&(oe=!1);var xe=$.stretchX,ye=$.stretchY,De=$.content;if(this._lazyInitEmptyStyle(),N instanceof Pu||ho&&N instanceof ho){var He=P.browser.getImageData(N);this.style.addImage(T,{data:new P.RGBAImage({width:He.width,height:He.height},He.data),pixelRatio:X,stretchX:xe,stretchY:ye,content:De,sdf:oe,version:0})}else{if(N.width===void 0||N.height===void 0)return this.fire(new P.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var $e=N;this.style.addImage(T,{data:new P.RGBAImage({width:N.width,height:N.height},new Uint8Array(N.data)),pixelRatio:X,stretchX:xe,stretchY:ye,content:De,sdf:oe,version:0,userImage:$e}),$e.onAdd&&$e.onAdd(this,T)}},w.prototype.updateImage=function(T,N){var $=this.style.getImage(T);if(!$)return this.fire(new P.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var X=N instanceof Pu||ho&&N instanceof ho?P.browser.getImageData(N):N,oe=X.width,xe=X.height,ye=X.data;return oe===void 0||xe===void 0?this.fire(new P.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):oe!==$.data.width||xe!==$.data.height?this.fire(new P.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):($.data.replace(ye,!(N instanceof Pu||ho&&N instanceof ho)),void this.style.updateImage(T,$))},w.prototype.hasImage=function(T){return T?!!this.style.getImage(T):(this.fire(new P.ErrorEvent(new Error("Missing required image id"))),!1)},w.prototype.removeImage=function(T){this.style.removeImage(T)},w.prototype.loadImage=function(T,N){P.getImage(this._requestManager.transformRequest(T,P.ResourceType.Image),N)},w.prototype.listImages=function(){return this.style.listImages()},w.prototype.addLayer=function(T,N){return this._lazyInitEmptyStyle(),this.style.addLayer(T,N),this._update(!0)},w.prototype.moveLayer=function(T,N){return this.style.moveLayer(T,N),this._update(!0)},w.prototype.removeLayer=function(T){return this.style.removeLayer(T),this._update(!0)},w.prototype.getLayer=function(T){return this.style.getLayer(T)},w.prototype.setLayerZoomRange=function(T,N,$){return this.style.setLayerZoomRange(T,N,$),this._update(!0)},w.prototype.setFilter=function(T,N,$){return $===void 0&&($={}),this.style.setFilter(T,N,$),this._update(!0)},w.prototype.getFilter=function(T){return this.style.getFilter(T)},w.prototype.setPaintProperty=function(T,N,$,X){return X===void 0&&(X={}),this.style.setPaintProperty(T,N,$,X),this._update(!0)},w.prototype.getPaintProperty=function(T,N){return this.style.getPaintProperty(T,N)},w.prototype.setLayoutProperty=function(T,N,$,X){return X===void 0&&(X={}),this.style.setLayoutProperty(T,N,$,X),this._update(!0)},w.prototype.getLayoutProperty=function(T,N){return this.style.getLayoutProperty(T,N)},w.prototype.setLight=function(T,N){return N===void 0&&(N={}),this._lazyInitEmptyStyle(),this.style.setLight(T,N),this._update(!0)},w.prototype.getLight=function(){return this.style.getLight()},w.prototype.setFeatureState=function(T,N){return this.style.setFeatureState(T,N),this._update()},w.prototype.removeFeatureState=function(T,N){return this.style.removeFeatureState(T,N),this._update()},w.prototype.getFeatureState=function(T){return this.style.getFeatureState(T)},w.prototype.getContainer=function(){return this._container},w.prototype.getCanvasContainer=function(){return this._canvasContainer},w.prototype.getCanvas=function(){return this._canvas},w.prototype._containerDimensions=function(){var T=0,N=0;return this._container&&(T=this._container.clientWidth||400,N=this._container.clientHeight||300),[T,N]},w.prototype._detectMissingCSS=function(){P.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&P.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},w.prototype._setupContainer=function(){var T=this._container;T.classList.add("mapboxgl-map"),(this._missingCSSCanary=ee.create("div","mapboxgl-canary",T)).style.visibility="hidden",this._detectMissingCSS();var N=this._canvasContainer=ee.create("div","mapboxgl-canvas-container",T);this._interactive&&N.classList.add("mapboxgl-interactive"),this._canvas=ee.create("canvas","mapboxgl-canvas",N),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var $=this._containerDimensions();this._resizeCanvas($[0],$[1]);var X=this._controlContainer=ee.create("div","mapboxgl-control-container",T),oe=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(xe){oe[xe]=ee.create("div","mapboxgl-ctrl-"+xe,X)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},w.prototype._resizeCanvas=function(T,N){var $=P.browser.devicePixelRatio||1;this._canvas.width=$*T,this._canvas.height=$*N,this._canvas.style.width=T+"px",this._canvas.style.height=N+"px"},w.prototype._setupPainter=function(){var T=P.extend({},M.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),N=this._canvas.getContext("webgl",T)||this._canvas.getContext("experimental-webgl",T);N?(this.painter=new Ms(N,this.transform),P.webpSupported.testSupport(N)):this.fire(new P.ErrorEvent(new Error("Failed to initialize WebGL")))},w.prototype._contextLost=function(T){T.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new P.Event("webglcontextlost",{originalEvent:T}))},w.prototype._contextRestored=function(T){this._setupPainter(),this.resize(),this._update(),this.fire(new P.Event("webglcontextrestored",{originalEvent:T}))},w.prototype._onMapScroll=function(T){if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},w.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},w.prototype._update=function(T){return this.style?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this},w.prototype._requestRenderFrame=function(T){return this._update(),this._renderTaskQueue.add(T)},w.prototype._cancelRenderFrame=function(T){this._renderTaskQueue.remove(T)},w.prototype._render=function(T){var N,$=this,X=0,oe=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(N=oe.createQueryEXT(),oe.beginQueryEXT(oe.TIME_ELAPSED_EXT,N),X=P.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),!this._removed){var xe=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ye=this.transform.zoom,De=P.browser.now();this.style.zoomHistory.update(ye,De);var He=new P.EvaluationParameters(ye,{now:De,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$e=He.crossFadingFactor();$e===1&&$e===this._crossFadingFactor||(xe=!0,this._crossFadingFactor=$e),this.style.update(He)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new P.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new P.Event("load"))),this.style&&(this.style.hasTransitions()||xe)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ft=P.browser.now()-X;oe.endQueryEXT(oe.TIME_ELAPSED_EXT,N),setTimeout(function(){var dt=oe.getQueryObjectEXT(N,oe.QUERY_RESULT_EXT)/1e6;oe.deleteQueryEXT(N),$.fire(new P.Event("gpu-timing-frame",{cpuTime:ft,gpuTime:dt}))},50)}if(this.listens("gpu-timing-layer")){var pt=this.painter.collectGpuTimers();setTimeout(function(){var dt=$.painter.queryGpuTimers(pt);$.fire(new P.Event("gpu-timing-layer",{layerTimes:dt}))},50)}var wt=this._sourcesDirty||this._styleDirty||this._placementDirty;return wt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new P.Event("idle")),!this._loaded||this._fullyLoaded||wt||(this._fullyLoaded=!0),this}},w.prototype.remove=function(){this._hash&&this._hash.remove();for(var T=0,N=this._controls;T<N.length;T+=1)N[T].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),P.window!==void 0&&(P.window.removeEventListener("resize",this._onWindowResize,!1),P.window.removeEventListener("orientationchange",this._onWindowResize,!1),P.window.removeEventListener("online",this._onWindowOnline,!1));var $=this.painter.context.gl.getExtension("WEBGL_lose_context");$&&$.loseContext(),Zu(this._canvasContainer),Zu(this._controlContainer),Zu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new P.Event("remove"))},w.prototype.triggerRepaint=function(){var T=this;this.style&&!this._frame&&(this._frame=P.browser.frame(function(N){T._frame=null,T._render(N)}))},w.prototype._onWindowOnline=function(){this._update()},w.prototype._onWindowResize=function(T){this._trackResize&&this.resize({originalEvent:T})._update()},_.showTileBoundaries.get=function(){return!!this._showTileBoundaries},_.showTileBoundaries.set=function(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())},_.showPadding.get=function(){return!!this._showPadding},_.showPadding.set=function(T){this._showPadding!==T&&(this._showPadding=T,this._update())},_.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},_.showCollisionBoxes.set=function(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())},_.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},_.showOverdrawInspector.set=function(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())},_.repaint.get=function(){return!!this._repaint},_.repaint.set=function(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())},_.vertices.get=function(){return!!this._vertices},_.vertices.set=function(T){this._vertices=T,this._update()},w.prototype._setCacheLimits=function(T,N){P.setCacheLimits(T,N)},_.version.get=function(){return P.version},Object.defineProperties(w.prototype,_),w}(Da);function Zu(m){m.parentNode&&m.parentNode.removeChild(m)}var il={showCompass:!0,showZoom:!0,visualizePitch:!1},sh=function(m){var w=this;this.options=P.extend({},il,m),this._container=ee.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(_){return _.preventDefault()}),this.options.showZoom&&(P.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(_){return w._map.zoomIn({},{originalEvent:_})}),ee.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(_){return w._map.zoomOut({},{originalEvent:_})}),ee.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(P.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(_){w.options.visualizePitch?w._map.resetNorthPitch({},{originalEvent:_}):w._map.resetNorth({},{originalEvent:_})}),this._compassIcon=ee.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};sh.prototype._updateZoomButtons=function(){var m=this._map.getZoom(),w=m===this._map.getMaxZoom(),_=m===this._map.getMinZoom();this._zoomInButton.disabled=w,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",w.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},sh.prototype._rotateCompassArrow=function(){var m=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=m},sh.prototype.onAdd=function(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ec(this._map,this._compass,this.options.visualizePitch)),this._container},sh.prototype.onRemove=function(){ee.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},sh.prototype._createButton=function(m,w){var _=ee.create("button",m,this._container);return _.type="button",_.addEventListener("click",w),_},sh.prototype._setButtonTitle=function(m,w){var _=this._map._getUIString("NavigationControl."+w);m.title=_,m.setAttribute("aria-label",_)};var ec=function(m,w,_){_===void 0&&(_=!1),this._clickTolerance=10,this.element=w,this.mouseRotate=new xh({clickTolerance:m.dragRotate._mouseRotate._clickTolerance}),this.map=m,_&&(this.mousePitch=new Xh({clickTolerance:m.dragRotate._mousePitch._clickTolerance})),P.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ee.addEventListener(w,"mousedown",this.mousedown),ee.addEventListener(w,"touchstart",this.touchstart,{passive:!1}),ee.addEventListener(w,"touchmove",this.touchmove),ee.addEventListener(w,"touchend",this.touchend),ee.addEventListener(w,"touchcancel",this.reset)};function If(m,w,_){if(m=new P.LngLat(m.lng,m.lat),w){var T=new P.LngLat(m.lng-360,m.lat),N=new P.LngLat(m.lng+360,m.lat),$=_.locationPoint(m).distSqr(w);_.locationPoint(T).distSqr(w)<$?m=T:_.locationPoint(N).distSqr(w)<$&&(m=N)}for(;Math.abs(m.lng-_.center.lng)>180;){var X=_.locationPoint(m);if(X.x>=0&&X.y>=0&&X.x<=_.width&&X.y<=_.height)break;m.lng>_.center.lng?m.lng-=360:m.lng+=360}return m}ec.prototype.down=function(m,w){this.mouseRotate.mousedown(m,w),this.mousePitch&&this.mousePitch.mousedown(m,w),ee.disableDrag()},ec.prototype.move=function(m,w){var _=this.map,T=this.mouseRotate.mousemoveWindow(m,w);if(T&&T.bearingDelta&&_.setBearing(_.getBearing()+T.bearingDelta),this.mousePitch){var N=this.mousePitch.mousemoveWindow(m,w);N&&N.pitchDelta&&_.setPitch(_.getPitch()+N.pitchDelta)}},ec.prototype.off=function(){var m=this.element;ee.removeEventListener(m,"mousedown",this.mousedown),ee.removeEventListener(m,"touchstart",this.touchstart,{passive:!1}),ee.removeEventListener(m,"touchmove",this.touchmove),ee.removeEventListener(m,"touchend",this.touchend),ee.removeEventListener(m,"touchcancel",this.reset),this.offTemp()},ec.prototype.offTemp=function(){ee.enableDrag(),ee.removeEventListener(P.window,"mousemove",this.mousemove),ee.removeEventListener(P.window,"mouseup",this.mouseup)},ec.prototype.mousedown=function(m){this.down(P.extend({},m,{ctrlKey:!0,preventDefault:function(){return m.preventDefault()}}),ee.mousePos(this.element,m)),ee.addEventListener(P.window,"mousemove",this.mousemove),ee.addEventListener(P.window,"mouseup",this.mouseup)},ec.prototype.mousemove=function(m){this.move(m,ee.mousePos(this.element,m))},ec.prototype.mouseup=function(m){this.mouseRotate.mouseupWindow(m),this.mousePitch&&this.mousePitch.mouseupWindow(m),this.offTemp()},ec.prototype.touchstart=function(m){m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ee.touchPos(this.element,m.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return m.preventDefault()}},this._startPos))},ec.prototype.touchmove=function(m){m.targetTouches.length!==1?this.reset():(this._lastPos=ee.touchPos(this.element,m.targetTouches)[0],this.move({preventDefault:function(){return m.preventDefault()}},this._lastPos))},ec.prototype.touchend=function(m){m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ec.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Rc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cc(m,w,_){var T=m.classList;for(var N in Rc)T.remove("mapboxgl-"+_+"-anchor-"+N);T.add("mapboxgl-"+_+"-anchor-"+w)}var Lf,Dh=function(m){function w(_,T){if(m.call(this),(_ instanceof P.window.HTMLElement||T)&&(_=P.extend({element:_},T)),P.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=_&&_.anchor||"center",this._color=_&&_.color||"#3FB1CE",this._scale=_&&_.scale||1,this._draggable=_&&_.draggable||!1,this._clickTolerance=_&&_.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=_&&_.rotation||0,this._rotationAlignment=_&&_.rotationAlignment||"auto",this._pitchAlignment=_&&_.pitchAlignment&&_.pitchAlignment!=="auto"?_.pitchAlignment:this._rotationAlignment,_&&_.element)this._element=_.element,this._offset=P.Point.convert(_&&_.offset||[0,0]);else{this._defaultMarker=!0,this._element=ee.create("div"),this._element.setAttribute("aria-label","Map marker");var N=ee.createNS("http://www.w3.org/2000/svg","svg");N.setAttributeNS(null,"display","block"),N.setAttributeNS(null,"height","41px"),N.setAttributeNS(null,"width","27px"),N.setAttributeNS(null,"viewBox","0 0 27 41");var $=ee.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"stroke","none"),$.setAttributeNS(null,"stroke-width","1"),$.setAttributeNS(null,"fill","none"),$.setAttributeNS(null,"fill-rule","evenodd");var X=ee.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"fill-rule","nonzero");var oe=ee.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(3.0, 29.0)"),oe.setAttributeNS(null,"fill","#000000");for(var xe=0,ye=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];xe<ye.length;xe+=1){var De=ye[xe],He=ee.createNS("http://www.w3.org/2000/svg","ellipse");He.setAttributeNS(null,"opacity","0.04"),He.setAttributeNS(null,"cx","10.5"),He.setAttributeNS(null,"cy","5.80029008"),He.setAttributeNS(null,"rx",De.rx),He.setAttributeNS(null,"ry",De.ry),oe.appendChild(He)}var $e=ee.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"fill",this._color);var ft=ee.createNS("http://www.w3.org/2000/svg","path");ft.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),$e.appendChild(ft);var pt=ee.createNS("http://www.w3.org/2000/svg","g");pt.setAttributeNS(null,"opacity","0.25"),pt.setAttributeNS(null,"fill","#000000");var wt=ee.createNS("http://www.w3.org/2000/svg","path");wt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),pt.appendChild(wt);var dt=ee.createNS("http://www.w3.org/2000/svg","g");dt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),dt.setAttributeNS(null,"fill","#FFFFFF");var Ft=ee.createNS("http://www.w3.org/2000/svg","g");Ft.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ar=ee.createNS("http://www.w3.org/2000/svg","circle");ar.setAttributeNS(null,"fill","#000000"),ar.setAttributeNS(null,"opacity","0.25"),ar.setAttributeNS(null,"cx","5.5"),ar.setAttributeNS(null,"cy","5.5"),ar.setAttributeNS(null,"r","5.4999962");var nr=ee.createNS("http://www.w3.org/2000/svg","circle");nr.setAttributeNS(null,"fill","#FFFFFF"),nr.setAttributeNS(null,"cx","5.5"),nr.setAttributeNS(null,"cy","5.5"),nr.setAttributeNS(null,"r","5.4999962"),Ft.appendChild(ar),Ft.appendChild(nr),X.appendChild(oe),X.appendChild($e),X.appendChild(pt),X.appendChild(dt),X.appendChild(Ft),N.appendChild(X),N.setAttributeNS(null,"height",41*this._scale+"px"),N.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(N),this._offset=P.Point.convert(_&&_.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ir){Ir.preventDefault()}),this._element.addEventListener("mousedown",function(Ir){Ir.preventDefault()}),Cc(this._element,this._anchor,"marker"),this._popup=null}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.addTo=function(_){return this.remove(),this._map=_,_.getCanvasContainer().appendChild(this._element),_.on("move",this._update),_.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},w.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ee.remove(this._element),this._popup&&this._popup.remove(),this},w.prototype.getLngLat=function(){return this._lngLat},w.prototype.setLngLat=function(_){return this._lngLat=P.LngLat.convert(_),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},w.prototype.getElement=function(){return this._element},w.prototype.setPopup=function(_){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),_){if(!("offset"in _.options)){var T=Math.sqrt(Math.pow(13.5,2)/2);_.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(24.6+T)],"bottom-right":[-T,-1*(24.6+T)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=_,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},w.prototype._onKeyPress=function(_){var T=_.code,N=_.charCode||_.keyCode;T!=="Space"&&T!=="Enter"&&N!==32&&N!==13||this.togglePopup()},w.prototype._onMapClick=function(_){var T=_.originalEvent.target,N=this._element;this._popup&&(T===N||N.contains(T))&&this.togglePopup()},w.prototype.getPopup=function(){return this._popup},w.prototype.togglePopup=function(){var _=this._popup;return _?(_.isOpen()?_.remove():_.addTo(this._map),this):this},w.prototype._update=function(_){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=If(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var T="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?T="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(T="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var N="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?N="rotateX(0deg)":this._pitchAlignment==="map"&&(N="rotateX("+this._map.getPitch()+"deg)"),_&&_.type!=="moveend"||(this._pos=this._pos.round()),ee.setTransform(this._element,Rc[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+N+" "+T)}},w.prototype.getOffset=function(){return this._offset},w.prototype.setOffset=function(_){return this._offset=P.Point.convert(_),this._update(),this},w.prototype._onMove=function(_){if(!this._isDragging){var T=this._clickTolerance||this._map._clickTolerance;this._isDragging=_.point.dist(this._pointerdownPos)>=T}this._isDragging&&(this._pos=_.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new P.Event("dragstart"))),this.fire(new P.Event("drag")))},w.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new P.Event("dragend")),this._state="inactive"},w.prototype._addDragHandler=function(_){this._element.contains(_.originalEvent.target)&&(_.preventDefault(),this._positionDelta=_.point.sub(this._pos).add(this._offset),this._pointerdownPos=_.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},w.prototype.setDraggable=function(_){return this._draggable=!!_,this._map&&(_?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},w.prototype.isDraggable=function(){return this._draggable},w.prototype.setRotation=function(_){return this._rotation=_||0,this._update(),this},w.prototype.getRotation=function(){return this._rotation},w.prototype.setRotationAlignment=function(_){return this._rotationAlignment=_||"auto",this._update(),this},w.prototype.getRotationAlignment=function(){return this._rotationAlignment},w.prototype.setPitchAlignment=function(_){return this._pitchAlignment=_&&_!=="auto"?_:this._rotationAlignment,this._update(),this},w.prototype.getPitchAlignment=function(){return this._pitchAlignment},w}(P.Evented),wp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Jf=0,mr=!1,D=function(m){function w(_){m.call(this),this.options=P.extend({},wp,_),P.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.onAdd=function(_){var T;return this._map=_,this._container=ee.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),T=this._setupUI,Lf!==void 0?T(Lf):P.window.navigator.permissions!==void 0?P.window.navigator.permissions.query({name:"geolocation"}).then(function(N){T(Lf=N.state!=="denied")}):T(Lf=!!P.window.navigator.geolocation),this._container},w.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(P.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ee.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Jf=0,mr=!1},w.prototype._isOutOfMapMaxBounds=function(_){var T=this._map.getMaxBounds(),N=_.coords;return T&&(N.longitude<T.getWest()||N.longitude>T.getEast()||N.latitude<T.getSouth()||N.latitude>T.getNorth())},w.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},w.prototype._onSuccess=function(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new P.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new P.Event("geolocate",_)),this._finish()}},w.prototype._updateCamera=function(_){var T=new P.LngLat(_.coords.longitude,_.coords.latitude),N=_.coords.accuracy,$=this._map.getBearing(),X=P.extend({bearing:$},this.options.fitBoundsOptions);this._map.fitBounds(T.toBounds(N),X,{geolocateSource:!0})},w.prototype._updateMarker=function(_){if(_){var T=new P.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(T).addTo(this._map),this._userLocationDotMarker.setLngLat(T).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},w.prototype._updateCircleRadius=function(){var _=this._map._container.clientHeight/2,T=this._map.unproject([0,_]),N=this._map.unproject([1,_]),$=T.distanceTo(N),X=Math.ceil(2*this._accuracy/$);this._circleElement.style.width=X+"px",this._circleElement.style.height=X+"px"},w.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},w.prototype._onError=function(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var T=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&mr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new P.Event("error",_)),this._finish()}},w.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},w.prototype._setupUI=function(_){var T=this;if(this._container.addEventListener("contextmenu",function(X){return X.preventDefault()}),this._geolocateButton=ee.create("button","mapboxgl-ctrl-geolocate",this._container),ee.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",_===!1){P.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var N=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=N,this._geolocateButton.setAttribute("aria-label",N)}else{var $=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=$,this._geolocateButton.setAttribute("aria-label",$)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ee.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Dh(this._dotElement),this._circleElement=ee.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(X){X.geolocateSource||T._watchState!=="ACTIVE_LOCK"||X.originalEvent&&X.originalEvent.type==="resize"||(T._watchState="BACKGROUND",T._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),T._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),T.fire(new P.Event("trackuserlocationend")))})},w.prototype.trigger=function(){if(!this._setup)return P.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new P.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Jf--,mr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new P.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new P.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Jf>1?(_={maximumAge:6e5,timeout:0},mr=!0):(_=this.options.positionOptions,mr=!1),this._geolocationWatchID=P.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else P.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},w.prototype._clearWatch=function(){P.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},w}(P.Evented),h={maxWidth:100,unit:"metric"},x=function(m){this.options=P.extend({},h,m),P.bindAll(["_onMove","setUnit"],this)};function O(m,w,_){var T=_&&_.maxWidth||100,N=m._container.clientHeight/2,$=m.unproject([0,N]),X=m.unproject([T,N]),oe=$.distanceTo(X);if(_&&_.unit==="imperial"){var xe=3.2808*oe;xe>5280?Z(w,T,xe/5280,m._getUIString("ScaleControl.Miles")):Z(w,T,xe,m._getUIString("ScaleControl.Feet"))}else _&&_.unit==="nautical"?Z(w,T,oe/1852,m._getUIString("ScaleControl.NauticalMiles")):oe>=1e3?Z(w,T,oe/1e3,m._getUIString("ScaleControl.Kilometers")):Z(w,T,oe,m._getUIString("ScaleControl.Meters"))}function Z(m,w,_,T){var N,$,X,oe=(N=_,($=Math.pow(10,(""+Math.floor(N)).length-1))*(X=(X=N/$)>=10?10:X>=5?5:X>=3?3:X>=2?2:X>=1?1:function(xe){var ye=Math.pow(10,Math.ceil(-Math.log(xe)/Math.LN10));return Math.round(xe*ye)/ye}(X)));m.style.width=w*(oe/_)+"px",m.innerHTML=oe+"&nbsp;"+T}x.prototype.getDefaultPosition=function(){return"bottom-left"},x.prototype._onMove=function(){O(this._map,this._container,this.options)},x.prototype.onAdd=function(m){return this._map=m,this._container=ee.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},x.prototype.onRemove=function(){ee.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},x.prototype.setUnit=function(m){this.options.unit=m,O(this._map,this._container,this.options)};var H=function(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof P.window.HTMLElement?this._container=m.container:P.warnOnce("Full screen control 'container' must be a DOM element.")),P.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in P.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in P.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in P.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in P.window.document&&(this._fullscreenchange="MSFullscreenChange")};H.prototype.onAdd=function(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ee.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",P.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},H.prototype.onRemove=function(){ee.remove(this._controlContainer),this._map=null,P.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},H.prototype._checkFullscreenSupport=function(){return!!(P.window.document.fullscreenEnabled||P.window.document.mozFullScreenEnabled||P.window.document.msFullscreenEnabled||P.window.document.webkitFullscreenEnabled)},H.prototype._setupUI=function(){var m=this._fullscreenButton=ee.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ee.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),P.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},H.prototype._updateTitle=function(){var m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m},H.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},H.prototype._isFullscreen=function(){return this._fullscreen},H.prototype._changeIcon=function(){(P.window.document.fullscreenElement||P.window.document.mozFullScreenElement||P.window.document.webkitFullscreenElement||P.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},H.prototype._onClickFullscreen=function(){this._isFullscreen()?P.window.document.exitFullscreen?P.window.document.exitFullscreen():P.window.document.mozCancelFullScreen?P.window.document.mozCancelFullScreen():P.window.document.msExitFullscreen?P.window.document.msExitFullscreen():P.window.document.webkitCancelFullScreen&&P.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ae={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ue=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ge=function(m){function w(_){m.call(this),this.options=P.extend(Object.create(ae),_),P.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return m&&(w.__proto__=m),(w.prototype=Object.create(m&&m.prototype)).constructor=w,w.prototype.addTo=function(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new P.Event("open")),this},w.prototype.isOpen=function(){return!!this._map},w.prototype.remove=function(){return this._content&&ee.remove(this._content),this._container&&(ee.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new P.Event("close")),this},w.prototype.getLngLat=function(){return this._lngLat},w.prototype.setLngLat=function(_){return this._lngLat=P.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},w.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},w.prototype.getElement=function(){return this._container},w.prototype.setText=function(_){return this.setDOMContent(P.window.document.createTextNode(_))},w.prototype.setHTML=function(_){var T,N=P.window.document.createDocumentFragment(),$=P.window.document.createElement("body");for($.innerHTML=_;T=$.firstChild;)N.appendChild(T);return this.setDOMContent(N)},w.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},w.prototype.setMaxWidth=function(_){return this.options.maxWidth=_,this._update(),this},w.prototype.setDOMContent=function(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ee.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this},w.prototype.addClassName=function(_){this._container&&this._container.classList.add(_)},w.prototype.removeClassName=function(_){this._container&&this._container.classList.remove(_)},w.prototype.setOffset=function(_){return this.options.offset=_,this._update(),this},w.prototype.toggleClassName=function(_){if(this._container)return this._container.classList.toggle(_)},w.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=ee.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},w.prototype._onMouseUp=function(_){this._update(_.point)},w.prototype._onMouseMove=function(_){this._update(_.point)},w.prototype._onDrag=function(_){this._update(_.point)},w.prototype._update=function(_){var T=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=ee.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ee.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(He){return T._container.classList.add(He)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=If(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_)){var N=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),$=this.options.anchor,X=function He($e){if($e){if(typeof $e=="number"){var ft=Math.round(Math.sqrt(.5*Math.pow($e,2)));return{center:new P.Point(0,0),top:new P.Point(0,$e),"top-left":new P.Point(ft,ft),"top-right":new P.Point(-ft,ft),bottom:new P.Point(0,-$e),"bottom-left":new P.Point(ft,-ft),"bottom-right":new P.Point(-ft,-ft),left:new P.Point($e,0),right:new P.Point(-$e,0)}}if($e instanceof P.Point||Array.isArray($e)){var pt=P.Point.convert($e);return{center:pt,top:pt,"top-left":pt,"top-right":pt,bottom:pt,"bottom-left":pt,"bottom-right":pt,left:pt,right:pt}}return{center:P.Point.convert($e.center||[0,0]),top:P.Point.convert($e.top||[0,0]),"top-left":P.Point.convert($e["top-left"]||[0,0]),"top-right":P.Point.convert($e["top-right"]||[0,0]),bottom:P.Point.convert($e.bottom||[0,0]),"bottom-left":P.Point.convert($e["bottom-left"]||[0,0]),"bottom-right":P.Point.convert($e["bottom-right"]||[0,0]),left:P.Point.convert($e.left||[0,0]),right:P.Point.convert($e.right||[0,0])}}return He(new P.Point(0,0))}(this.options.offset);if(!$){var oe,xe=this._container.offsetWidth,ye=this._container.offsetHeight;oe=N.y+X.bottom.y<ye?["top"]:N.y>this._map.transform.height-ye?["bottom"]:[],N.x<xe/2?oe.push("left"):N.x>this._map.transform.width-xe/2&&oe.push("right"),$=oe.length===0?"bottom":oe.join("-")}var De=N.add(X[$]).round();ee.setTransform(this._container,Rc[$]+" translate("+De.x+"px,"+De.y+"px)"),Cc(this._container,$,"popup")}},w.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var _=this._container.querySelector(ue);_&&_.focus()}},w.prototype._onClose=function(){this.remove()},w}(P.Evented),Le={version:P.version,supported:M,setRTLTextPlugin:P.setRTLTextPlugin,getRTLTextPluginStatus:P.getRTLTextPluginStatus,Map:kf,NavigationControl:sh,GeolocateControl:D,AttributionControl:ba,ScaleControl:x,FullscreenControl:H,Popup:ge,Marker:Dh,Style:uu,LngLat:P.LngLat,LngLatBounds:P.LngLatBounds,Point:P.Point,MercatorCoordinate:P.MercatorCoordinate,Evented:P.Evented,config:P.config,prewarm:function(){qr().acquire(Ze)},clearPrewarmedResources:function(){var m=Fn;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ze),Fn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return P.config.ACCESS_TOKEN},set accessToken(m){P.config.ACCESS_TOKEN=m},get baseApiUrl(){return P.config.API_URL},set baseApiUrl(m){P.config.API_URL=m},get workerCount(){return Yr.workerCount},set workerCount(m){Yr.workerCount=m},get maxParallelImageRequests(){return P.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){P.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage:function(m){P.clearTileCache(m)},workerUrl:""};return Le}),K})},3614:function(Ue,_e,G){"use strict";Ue.exports=j;var K=G(80645);function j(ot){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ot)?ot:new Uint8Array(ot||0),this.pos=0,this.type=0,this.length=this.buf.length}j.Varint=0,j.Fixed64=1,j.Bytes=2,j.Fixed32=5;var P=65536*65536,M=1/P,ee=12,te=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");j.prototype={destroy:function(){this.buf=null},readFields:function(ot,Dt,Ee){for(Ee=Ee||this.length;this.pos<Ee;){var Bt=this.readVarint(),Ot=Bt>>3,Pr=this.pos;this.type=Bt&7,ot(Ot,Dt,this),this.pos===Pr&&this.skip(Bt)}return Dt},readMessage:function(ot,Dt){return this.readFields(ot,Dt,this.readVarint()+this.pos)},readFixed32:function(){var ot=rr(this.buf,this.pos);return this.pos+=4,ot},readSFixed32:function(){var ot=br(this.buf,this.pos);return this.pos+=4,ot},readFixed64:function(){var ot=rr(this.buf,this.pos)+rr(this.buf,this.pos+4)*P;return this.pos+=8,ot},readSFixed64:function(){var ot=rr(this.buf,this.pos)+br(this.buf,this.pos+4)*P;return this.pos+=8,ot},readFloat:function(){var ot=K.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ot},readDouble:function(){var ot=K.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ot},readVarint:function(ot){var Dt=this.buf,Ee,Bt;return Bt=Dt[this.pos++],Ee=Bt&127,Bt<128||(Bt=Dt[this.pos++],Ee|=(Bt&127)<<7,Bt<128)||(Bt=Dt[this.pos++],Ee|=(Bt&127)<<14,Bt<128)||(Bt=Dt[this.pos++],Ee|=(Bt&127)<<21,Bt<128)?Ee:(Bt=Dt[this.pos],Ee|=(Bt&15)<<28,pe(Ee,ot,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ot=this.readVarint();return ot%2===1?(ot+1)/-2:ot/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ot=this.readVarint()+this.pos,Dt=this.pos;return this.pos=ot,ot-Dt>=ee&&te?Br(this.buf,Dt,ot):or(this.buf,Dt,ot)},readBytes:function(){var ot=this.readVarint()+this.pos,Dt=this.buf.subarray(this.pos,ot);return this.pos=ot,Dt},readPackedVarint:function(ot,Dt){if(this.type!==j.Bytes)return ot.push(this.readVarint(Dt));var Ee=Ce(this);for(ot=ot||[];this.pos<Ee;)ot.push(this.readVarint(Dt));return ot},readPackedSVarint:function(ot){if(this.type!==j.Bytes)return ot.push(this.readSVarint());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readSVarint());return ot},readPackedBoolean:function(ot){if(this.type!==j.Bytes)return ot.push(this.readBoolean());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readBoolean());return ot},readPackedFloat:function(ot){if(this.type!==j.Bytes)return ot.push(this.readFloat());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readFloat());return ot},readPackedDouble:function(ot){if(this.type!==j.Bytes)return ot.push(this.readDouble());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readDouble());return ot},readPackedFixed32:function(ot){if(this.type!==j.Bytes)return ot.push(this.readFixed32());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readFixed32());return ot},readPackedSFixed32:function(ot){if(this.type!==j.Bytes)return ot.push(this.readSFixed32());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readSFixed32());return ot},readPackedFixed64:function(ot){if(this.type!==j.Bytes)return ot.push(this.readFixed64());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readFixed64());return ot},readPackedSFixed64:function(ot){if(this.type!==j.Bytes)return ot.push(this.readSFixed64());var Dt=Ce(this);for(ot=ot||[];this.pos<Dt;)ot.push(this.readSFixed64());return ot},skip:function(ot){var Dt=ot&7;if(Dt===j.Varint)for(;this.buf[this.pos++]>127;);else if(Dt===j.Bytes)this.pos=this.readVarint()+this.pos;else if(Dt===j.Fixed32)this.pos+=4;else if(Dt===j.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Dt)},writeTag:function(ot,Dt){this.writeVarint(ot<<3|Dt)},realloc:function(ot){for(var Dt=this.length||16;Dt<this.pos+ot;)Dt*=2;if(Dt!==this.length){var Ee=new Uint8Array(Dt);Ee.set(this.buf),this.buf=Ee,this.length=Dt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ot){this.realloc(4),Jt(this.buf,ot,this.pos),this.pos+=4},writeSFixed32:function(ot){this.realloc(4),Jt(this.buf,ot,this.pos),this.pos+=4},writeFixed64:function(ot){this.realloc(8),Jt(this.buf,ot&-1,this.pos),Jt(this.buf,Math.floor(ot*M),this.pos+4),this.pos+=8},writeSFixed64:function(ot){this.realloc(8),Jt(this.buf,ot&-1,this.pos),Jt(this.buf,Math.floor(ot*M),this.pos+4),this.pos+=8},writeVarint:function(ot){if(ot=+ot||0,ot>268435455||ot<0){Ie(ot,this);return}this.realloc(4),this.buf[this.pos++]=ot&127|(ot>127?128:0),!(ot<=127)&&(this.buf[this.pos++]=(ot>>>=7)&127|(ot>127?128:0),!(ot<=127)&&(this.buf[this.pos++]=(ot>>>=7)&127|(ot>127?128:0),!(ot<=127)&&(this.buf[this.pos++]=ot>>>7&127)))},writeSVarint:function(ot){this.writeVarint(ot<0?-ot*2-1:ot*2)},writeBoolean:function(ot){this.writeVarint(!!ot)},writeString:function(ot){ot=String(ot),this.realloc(ot.length*4),this.pos++;var Dt=this.pos;this.pos=an(this.buf,ot,this.pos);var Ee=this.pos-Dt;Ee>=128&&nt(Dt,Ee,this),this.pos=Dt-1,this.writeVarint(Ee),this.pos+=Ee},writeFloat:function(ot){this.realloc(4),K.write(this.buf,ot,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ot){this.realloc(8),K.write(this.buf,ot,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ot){var Dt=ot.length;this.writeVarint(Dt),this.realloc(Dt);for(var Ee=0;Ee<Dt;Ee++)this.buf[this.pos++]=ot[Ee]},writeRawMessage:function(ot,Dt){this.pos++;var Ee=this.pos;ot(Dt,this);var Bt=this.pos-Ee;Bt>=128&&nt(Ee,Bt,this),this.pos=Ee-1,this.writeVarint(Bt),this.pos+=Bt},writeMessage:function(ot,Dt,Ee){this.writeTag(ot,j.Bytes),this.writeRawMessage(Dt,Ee)},writePackedVarint:function(ot,Dt){Dt.length&&this.writeMessage(ot,Ct,Dt)},writePackedSVarint:function(ot,Dt){Dt.length&&this.writeMessage(ot,jt,Dt)},writePackedBoolean:function(ot,Dt){Dt.length&&this.writeMessage(ot,hr,Dt)},writePackedFloat:function(ot,Dt){Dt.length&&this.writeMessage(ot,Vt,Dt)},writePackedDouble:function(ot,Dt){Dt.length&&this.writeMessage(ot,Rt,Dt)},writePackedFixed32:function(ot,Dt){Dt.length&&this.writeMessage(ot,er,Dt)},writePackedSFixed32:function(ot,Dt){Dt.length&&this.writeMessage(ot,gn,Dt)},writePackedFixed64:function(ot,Dt){Dt.length&&this.writeMessage(ot,Rr,Dt)},writePackedSFixed64:function(ot,Dt){Dt.length&&this.writeMessage(ot,vn,Dt)},writeBytesField:function(ot,Dt){this.writeTag(ot,j.Bytes),this.writeBytes(Dt)},writeFixed32Field:function(ot,Dt){this.writeTag(ot,j.Fixed32),this.writeFixed32(Dt)},writeSFixed32Field:function(ot,Dt){this.writeTag(ot,j.Fixed32),this.writeSFixed32(Dt)},writeFixed64Field:function(ot,Dt){this.writeTag(ot,j.Fixed64),this.writeFixed64(Dt)},writeSFixed64Field:function(ot,Dt){this.writeTag(ot,j.Fixed64),this.writeSFixed64(Dt)},writeVarintField:function(ot,Dt){this.writeTag(ot,j.Varint),this.writeVarint(Dt)},writeSVarintField:function(ot,Dt){this.writeTag(ot,j.Varint),this.writeSVarint(Dt)},writeStringField:function(ot,Dt){this.writeTag(ot,j.Bytes),this.writeString(Dt)},writeFloatField:function(ot,Dt){this.writeTag(ot,j.Fixed32),this.writeFloat(Dt)},writeDoubleField:function(ot,Dt){this.writeTag(ot,j.Fixed64),this.writeDouble(Dt)},writeBooleanField:function(ot,Dt){this.writeVarintField(ot,!!Dt)}};function pe(ot,Dt,Ee){var Bt=Ee.buf,Ot,Pr;if(Pr=Bt[Ee.pos++],Ot=(Pr&112)>>4,Pr<128||(Pr=Bt[Ee.pos++],Ot|=(Pr&127)<<3,Pr<128)||(Pr=Bt[Ee.pos++],Ot|=(Pr&127)<<10,Pr<128)||(Pr=Bt[Ee.pos++],Ot|=(Pr&127)<<17,Pr<128)||(Pr=Bt[Ee.pos++],Ot|=(Pr&127)<<24,Pr<128)||(Pr=Bt[Ee.pos++],Ot|=(Pr&1)<<31,Pr<128))return le(ot,Ot,Dt);throw new Error("Expected varint not more than 10 bytes")}function Ce(ot){return ot.type===j.Bytes?ot.readVarint()+ot.pos:ot.pos+1}function le(ot,Dt,Ee){return Ee?Dt*4294967296+(ot>>>0):(Dt>>>0)*4294967296+(ot>>>0)}function Ie(ot,Dt){var Ee,Bt;if(ot>=0?(Ee=ot%4294967296|0,Bt=ot/4294967296|0):(Ee=~(-ot%4294967296),Bt=~(-ot/4294967296),Ee^4294967295?Ee=Ee+1|0:(Ee=0,Bt=Bt+1|0)),ot>=18446744073709552e3||ot<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Dt.realloc(10),rt(Ee,Bt,Dt),xt(Bt,Dt)}function rt(ot,Dt,Ee){Ee.buf[Ee.pos++]=ot&127|128,ot>>>=7,Ee.buf[Ee.pos++]=ot&127|128,ot>>>=7,Ee.buf[Ee.pos++]=ot&127|128,ot>>>=7,Ee.buf[Ee.pos++]=ot&127|128,ot>>>=7,Ee.buf[Ee.pos]=ot&127}function xt(ot,Dt){var Ee=(ot&7)<<4;Dt.buf[Dt.pos++]|=Ee|((ot>>>=3)?128:0),ot&&(Dt.buf[Dt.pos++]=ot&127|((ot>>>=7)?128:0),ot&&(Dt.buf[Dt.pos++]=ot&127|((ot>>>=7)?128:0),ot&&(Dt.buf[Dt.pos++]=ot&127|((ot>>>=7)?128:0),ot&&(Dt.buf[Dt.pos++]=ot&127|((ot>>>=7)?128:0),ot&&(Dt.buf[Dt.pos++]=ot&127)))))}function nt(ot,Dt,Ee){var Bt=Dt<=16383?1:Dt<=2097151?2:Dt<=268435455?3:Math.floor(Math.log(Dt)/(Math.LN2*7));Ee.realloc(Bt);for(var Ot=Ee.pos-1;Ot>=ot;Ot--)Ee.buf[Ot+Bt]=Ee.buf[Ot]}function Ct(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeVarint(ot[Ee])}function jt(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeSVarint(ot[Ee])}function Vt(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeFloat(ot[Ee])}function Rt(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeDouble(ot[Ee])}function hr(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeBoolean(ot[Ee])}function er(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeFixed32(ot[Ee])}function gn(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeSFixed32(ot[Ee])}function Rr(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeFixed64(ot[Ee])}function vn(ot,Dt){for(var Ee=0;Ee<ot.length;Ee++)Dt.writeSFixed64(ot[Ee])}function rr(ot,Dt){return(ot[Dt]|ot[Dt+1]<<8|ot[Dt+2]<<16)+ot[Dt+3]*16777216}function Jt(ot,Dt,Ee){ot[Ee]=Dt,ot[Ee+1]=Dt>>>8,ot[Ee+2]=Dt>>>16,ot[Ee+3]=Dt>>>24}function br(ot,Dt){return(ot[Dt]|ot[Dt+1]<<8|ot[Dt+2]<<16)+(ot[Dt+3]<<24)}function or(ot,Dt,Ee){for(var Bt="",Ot=Dt;Ot<Ee;){var Pr=ot[Ot],Fr=null,Nr=Pr>239?4:Pr>223?3:Pr>191?2:1;if(Ot+Nr>Ee)break;var hn,xn,Ji;Nr===1?Pr<128&&(Fr=Pr):Nr===2?(hn=ot[Ot+1],(hn&192)===128&&(Fr=(Pr&31)<<6|hn&63,Fr<=127&&(Fr=null))):Nr===3?(hn=ot[Ot+1],xn=ot[Ot+2],(hn&192)===128&&(xn&192)===128&&(Fr=(Pr&15)<<12|(hn&63)<<6|xn&63,(Fr<=2047||Fr>=55296&&Fr<=57343)&&(Fr=null))):Nr===4&&(hn=ot[Ot+1],xn=ot[Ot+2],Ji=ot[Ot+3],(hn&192)===128&&(xn&192)===128&&(Ji&192)===128&&(Fr=(Pr&15)<<18|(hn&63)<<12|(xn&63)<<6|Ji&63,(Fr<=65535||Fr>=1114112)&&(Fr=null))),Fr===null?(Fr=65533,Nr=1):Fr>65535&&(Fr-=65536,Bt+=String.fromCharCode(Fr>>>10&1023|55296),Fr=56320|Fr&1023),Bt+=String.fromCharCode(Fr),Ot+=Nr}return Bt}function Br(ot,Dt,Ee){return te.decode(ot.subarray(Dt,Ee))}function an(ot,Dt,Ee){for(var Bt=0,Ot,Pr;Bt<Dt.length;Bt++){if(Ot=Dt.charCodeAt(Bt),Ot>55295&&Ot<57344)if(Pr)if(Ot<56320){ot[Ee++]=239,ot[Ee++]=191,ot[Ee++]=189,Pr=Ot;continue}else Ot=Pr-55296<<10|Ot-56320|65536,Pr=null;else{Ot>56319||Bt+1===Dt.length?(ot[Ee++]=239,ot[Ee++]=191,ot[Ee++]=189):Pr=Ot;continue}else Pr&&(ot[Ee++]=239,ot[Ee++]=191,ot[Ee++]=189,Pr=null);Ot<128?ot[Ee++]=Ot:(Ot<2048?ot[Ee++]=Ot>>6|192:(Ot<65536?ot[Ee++]=Ot>>12|224:(ot[Ee++]=Ot>>18|240,ot[Ee++]=Ot>>12&63|128),ot[Ee++]=Ot>>6&63|128),ot[Ee++]=Ot&63|128)}return Ee}},32676:function(Ue,_e,G){var K=G(34155);(function(j,P){Ue.exports=P()})(this,function(){"use strict";function j(zr,be){if(!(zr instanceof be))throw new TypeError("Cannot call a class as a function")}function P(zr,be){for(var lt=0;lt<be.length;lt++){var mt=be[lt];mt.enumerable=mt.enumerable||!1,mt.configurable=!0,"value"in mt&&(mt.writable=!0),Object.defineProperty(zr,mt.key,mt)}}function M(zr,be,lt){return be&&P(zr.prototype,be),lt&&P(zr,lt),zr}var ee=function(){function zr(be,lt){this.next=null,this.key=be,this.data=lt,this.left=null,this.right=null}return zr}();function te(zr,be){return zr>be?1:zr<be?-1:0}function pe(zr,be,lt){for(var mt=new ee(null,null),Qt=mt,xr=mt;;){var mn=lt(zr,be.key);if(mn<0){if(be.left===null)break;if(lt(zr,be.left.key)<0){var Wn=be.left;if(be.left=Wn.right,Wn.right=be,be=Wn,be.left===null)break}xr.left=be,xr=be,be=be.left}else if(mn>0){if(be.right===null)break;if(lt(zr,be.right.key)>0){var Wn=be.right;if(be.right=Wn.left,Wn.left=be,be=Wn,be.right===null)break}Qt.right=be,Qt=be,be=be.right}else break}return Qt.right=be.left,xr.left=be.right,be.left=mt.right,be.right=mt.left,be}function Ce(zr,be,lt,mt){var Qt=new ee(zr,be);if(lt===null)return Qt.left=Qt.right=null,Qt;lt=pe(zr,lt,mt);var xr=mt(zr,lt.key);return xr<0?(Qt.left=lt.left,Qt.right=lt,lt.left=null):xr>=0&&(Qt.right=lt.right,Qt.left=lt,lt.right=null),Qt}function le(zr,be,lt){var mt=null,Qt=null;if(be){be=pe(zr,be,lt);var xr=lt(be.key,zr);xr===0?(mt=be.left,Qt=be.right):xr<0?(Qt=be.right,be.right=null,mt=be):(mt=be.left,be.left=null,Qt=be)}return{left:mt,right:Qt}}function Ie(zr,be,lt){return be===null?zr:(zr===null||(be=pe(zr.key,be,lt),be.left=zr),be)}function rt(zr,be,lt,mt,Qt){if(zr){mt(""+be+(lt?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Qt(zr)+`
`);var xr=be+(lt?"    ":"\u2502   ");zr.left&&rt(zr.left,xr,!1,mt,Qt),zr.right&&rt(zr.right,xr,!0,mt,Qt)}}var xt=function(){function zr(be){be===void 0&&(be=te),this._root=null,this._size=0,this._comparator=be}return zr.prototype.insert=function(be,lt){return this._size++,this._root=Ce(be,lt,this._root,this._comparator)},zr.prototype.add=function(be,lt){var mt=new ee(be,lt);this._root===null&&(mt.left=mt.right=null,this._size++,this._root=mt);var Qt=this._comparator,xr=pe(be,this._root,Qt),mn=Qt(be,xr.key);return mn===0?this._root=xr:(mn<0?(mt.left=xr.left,mt.right=xr,xr.left=null):mn>0&&(mt.right=xr.right,mt.left=xr,xr.right=null),this._size++,this._root=mt),this._root},zr.prototype.remove=function(be){this._root=this._remove(be,this._root,this._comparator)},zr.prototype._remove=function(be,lt,mt){var Qt;if(lt===null)return null;lt=pe(be,lt,mt);var xr=mt(be,lt.key);return xr===0?(lt.left===null?Qt=lt.right:(Qt=pe(be,lt.left,mt),Qt.right=lt.right),this._size--,Qt):lt},zr.prototype.pop=function(){var be=this._root;if(be){for(;be.left;)be=be.left;return this._root=pe(be.key,this._root,this._comparator),this._root=this._remove(be.key,this._root,this._comparator),{key:be.key,data:be.data}}return null},zr.prototype.findStatic=function(be){for(var lt=this._root,mt=this._comparator;lt;){var Qt=mt(be,lt.key);if(Qt===0)return lt;Qt<0?lt=lt.left:lt=lt.right}return null},zr.prototype.find=function(be){return this._root&&(this._root=pe(be,this._root,this._comparator),this._comparator(be,this._root.key)!==0)?null:this._root},zr.prototype.contains=function(be){for(var lt=this._root,mt=this._comparator;lt;){var Qt=mt(be,lt.key);if(Qt===0)return!0;Qt<0?lt=lt.left:lt=lt.right}return!1},zr.prototype.forEach=function(be,lt){for(var mt=this._root,Qt=[],xr=!1;!xr;)mt!==null?(Qt.push(mt),mt=mt.left):Qt.length!==0?(mt=Qt.pop(),be.call(lt,mt),mt=mt.right):xr=!0;return this},zr.prototype.range=function(be,lt,mt,Qt){for(var xr=[],mn=this._comparator,Wn=this._root,tr;xr.length!==0||Wn;)if(Wn)xr.push(Wn),Wn=Wn.left;else{if(Wn=xr.pop(),tr=mn(Wn.key,lt),tr>0)break;if(mn(Wn.key,be)>=0&&mt.call(Qt,Wn))return this;Wn=Wn.right}return this},zr.prototype.keys=function(){var be=[];return this.forEach(function(lt){var mt=lt.key;return be.push(mt)}),be},zr.prototype.values=function(){var be=[];return this.forEach(function(lt){var mt=lt.data;return be.push(mt)}),be},zr.prototype.min=function(){return this._root?this.minNode(this._root).key:null},zr.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},zr.prototype.minNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.left;)be=be.left;return be},zr.prototype.maxNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.right;)be=be.right;return be},zr.prototype.at=function(be){for(var lt=this._root,mt=!1,Qt=0,xr=[];!mt;)if(lt)xr.push(lt),lt=lt.left;else if(xr.length>0){if(lt=xr.pop(),Qt===be)return lt;Qt++,lt=lt.right}else mt=!0;return null},zr.prototype.next=function(be){var lt=this._root,mt=null;if(be.right){for(mt=be.right;mt.left;)mt=mt.left;return mt}for(var Qt=this._comparator;lt;){var xr=Qt(be.key,lt.key);if(xr===0)break;xr<0?(mt=lt,lt=lt.left):lt=lt.right}return mt},zr.prototype.prev=function(be){var lt=this._root,mt=null;if(be.left!==null){for(mt=be.left;mt.right;)mt=mt.right;return mt}for(var Qt=this._comparator;lt;){var xr=Qt(be.key,lt.key);if(xr===0)break;xr<0?lt=lt.left:(mt=lt,lt=lt.right)}return mt},zr.prototype.clear=function(){return this._root=null,this._size=0,this},zr.prototype.toList=function(){return jt(this._root)},zr.prototype.load=function(be,lt,mt){lt===void 0&&(lt=[]),mt===void 0&&(mt=!1);var Qt=be.length,xr=this._comparator;if(mt&&hr(be,lt,0,Qt-1,xr),this._root===null)this._root=nt(be,lt,0,Qt),this._size=Qt;else{var mn=Rt(this.toList(),Ct(be,lt),xr);Qt=this._size+Qt,this._root=Vt({head:mn},0,Qt)}return this},zr.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(zr.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(zr.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),zr.prototype.toString=function(be){be===void 0&&(be=function(Qt){return String(Qt.key)});var lt=[];return rt(this._root,"",!0,function(mt){return lt.push(mt)},be),lt.join("")},zr.prototype.update=function(be,lt,mt){var Qt=this._comparator,xr=le(be,this._root,Qt),mn=xr.left,Wn=xr.right;Qt(be,lt)<0?Wn=Ce(lt,mt,Wn,Qt):mn=Ce(lt,mt,mn,Qt),this._root=Ie(mn,Wn,Qt)},zr.prototype.split=function(be){return le(be,this._root,this._comparator)},zr}();function nt(zr,be,lt,mt){var Qt=mt-lt;if(Qt>0){var xr=lt+Math.floor(Qt/2),mn=zr[xr],Wn=be[xr],tr=new ee(mn,Wn);return tr.left=nt(zr,be,lt,xr),tr.right=nt(zr,be,xr+1,mt),tr}return null}function Ct(zr,be){for(var lt=new ee(null,null),mt=lt,Qt=0;Qt<zr.length;Qt++)mt=mt.next=new ee(zr[Qt],be[Qt]);return mt.next=null,lt.next}function jt(zr){for(var be=zr,lt=[],mt=!1,Qt=new ee(null,null),xr=Qt;!mt;)be?(lt.push(be),be=be.left):lt.length>0?(be=xr=xr.next=lt.pop(),be=be.right):mt=!0;return xr.next=null,Qt.next}function Vt(zr,be,lt){var mt=lt-be;if(mt>0){var Qt=be+Math.floor(mt/2),xr=Vt(zr,be,Qt),mn=zr.head;return mn.left=xr,zr.head=zr.head.next,mn.right=Vt(zr,Qt+1,lt),mn}return null}function Rt(zr,be,lt){for(var mt=new ee(null,null),Qt=mt,xr=zr,mn=be;xr!==null&&mn!==null;)lt(xr.key,mn.key)<0?(Qt.next=xr,xr=xr.next):(Qt.next=mn,mn=mn.next),Qt=Qt.next;return xr!==null?Qt.next=xr:mn!==null&&(Qt.next=mn),mt.next}function hr(zr,be,lt,mt,Qt){if(!(lt>=mt)){for(var xr=zr[lt+mt>>1],mn=lt-1,Wn=mt+1;;){do mn++;while(Qt(zr[mn],xr)<0);do Wn--;while(Qt(zr[Wn],xr)>0);if(mn>=Wn)break;var tr=zr[mn];zr[mn]=zr[Wn],zr[Wn]=tr,tr=be[mn],be[mn]=be[Wn],be[Wn]=tr}hr(zr,be,lt,Wn,Qt),hr(zr,be,Wn+1,mt,Qt)}}var er=function(be,lt){return be.ll.x<=lt.x&&lt.x<=be.ur.x&&be.ll.y<=lt.y&&lt.y<=be.ur.y},gn=function(be,lt){if(lt.ur.x<be.ll.x||be.ur.x<lt.ll.x||lt.ur.y<be.ll.y||be.ur.y<lt.ll.y)return null;var mt=be.ll.x<lt.ll.x?lt.ll.x:be.ll.x,Qt=be.ur.x<lt.ur.x?be.ur.x:lt.ur.x,xr=be.ll.y<lt.ll.y?lt.ll.y:be.ll.y,mn=be.ur.y<lt.ur.y?be.ur.y:lt.ur.y;return{ll:{x:mt,y:xr},ur:{x:Qt,y:mn}}},Rr=Number.EPSILON;Rr===void 0&&(Rr=Math.pow(2,-52));var vn=Rr*Rr,rr=function(be,lt){if(-Rr<be&&be<Rr&&-Rr<lt&&lt<Rr)return 0;var mt=be-lt;return mt*mt<vn*be*lt?0:be<lt?-1:1},Jt=function(){function zr(){j(this,zr),this.reset()}return M(zr,[{key:"reset",value:function(){this.xRounder=new br,this.yRounder=new br}},{key:"round",value:function(lt,mt){return{x:this.xRounder.round(lt),y:this.yRounder.round(mt)}}}]),zr}(),br=function(){function zr(){j(this,zr),this.tree=new xt,this.round(0)}return M(zr,[{key:"round",value:function(lt){var mt=this.tree.add(lt),Qt=this.tree.prev(mt);if(Qt!==null&&rr(mt.key,Qt.key)===0)return this.tree.remove(lt),Qt.key;var xr=this.tree.next(mt);return xr!==null&&rr(mt.key,xr.key)===0?(this.tree.remove(lt),xr.key):lt}}]),zr}(),or=new Jt,Br=function(be,lt){return be.x*lt.y-be.y*lt.x},an=function(be,lt){return be.x*lt.x+be.y*lt.y},ot=function(be,lt,mt){var Qt={x:lt.x-be.x,y:lt.y-be.y},xr={x:mt.x-be.x,y:mt.y-be.y},mn=Br(Qt,xr);return rr(mn,0)},Dt=function(be){return Math.sqrt(an(be,be))},Ee=function(be,lt,mt){var Qt={x:lt.x-be.x,y:lt.y-be.y},xr={x:mt.x-be.x,y:mt.y-be.y};return Br(xr,Qt)/Dt(xr)/Dt(Qt)},Bt=function(be,lt,mt){var Qt={x:lt.x-be.x,y:lt.y-be.y},xr={x:mt.x-be.x,y:mt.y-be.y};return an(xr,Qt)/Dt(xr)/Dt(Qt)},Ot=function(be,lt,mt){return lt.y===0?null:{x:be.x+lt.x/lt.y*(mt-be.y),y:mt}},Pr=function(be,lt,mt){return lt.x===0?null:{x:mt,y:be.y+lt.y/lt.x*(mt-be.x)}},Fr=function(be,lt,mt,Qt){if(lt.x===0)return Pr(mt,Qt,be.x);if(Qt.x===0)return Pr(be,lt,mt.x);if(lt.y===0)return Ot(mt,Qt,be.y);if(Qt.y===0)return Ot(be,lt,mt.y);var xr=Br(lt,Qt);if(xr==0)return null;var mn={x:mt.x-be.x,y:mt.y-be.y},Wn=Br(mn,lt)/xr,tr=Br(mn,Qt)/xr,Hr=be.x+tr*lt.x,dr=mt.x+Wn*Qt.x,Un=be.y+tr*lt.y,ti=mt.y+Wn*Qt.y,Yi=(Hr+dr)/2,ea=(Un+ti)/2;return{x:Yi,y:ea}},Nr=function(){M(zr,null,[{key:"compare",value:function(lt,mt){var Qt=zr.comparePoints(lt.point,mt.point);return Qt!==0?Qt:(lt.point!==mt.point&&lt.link(mt),lt.isLeft!==mt.isLeft?lt.isLeft?1:-1:xn.compare(lt.segment,mt.segment))}},{key:"comparePoints",value:function(lt,mt){return lt.x<mt.x?-1:lt.x>mt.x?1:lt.y<mt.y?-1:lt.y>mt.y?1:0}}]);function zr(be,lt){j(this,zr),be.events===void 0?be.events=[this]:be.events.push(this),this.point=be,this.isLeft=lt}return M(zr,[{key:"link",value:function(lt){if(lt.point===this.point)throw new Error("Tried to link already linked events");for(var mt=lt.point.events,Qt=0,xr=mt.length;Qt<xr;Qt++){var mn=mt[Qt];this.point.events.push(mn),mn.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var lt=this.point.events.length,mt=0;mt<lt;mt++){var Qt=this.point.events[mt];if(Qt.segment.consumedBy===void 0)for(var xr=mt+1;xr<lt;xr++){var mn=this.point.events[xr];mn.consumedBy===void 0&&Qt.otherSE.point.events===mn.otherSE.point.events&&Qt.segment.consume(mn.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var lt=[],mt=0,Qt=this.point.events.length;mt<Qt;mt++){var xr=this.point.events[mt];xr!==this&&!xr.segment.ringOut&&xr.segment.isInResult()&&lt.push(xr)}return lt}},{key:"getLeftmostComparator",value:function(lt){var mt=this,Qt=new Map,xr=function(Wn){var tr=Wn.otherSE;Qt.set(Wn,{sine:Ee(mt.point,lt.point,tr.point),cosine:Bt(mt.point,lt.point,tr.point)})};return function(mn,Wn){Qt.has(mn)||xr(mn),Qt.has(Wn)||xr(Wn);var tr=Qt.get(mn),Hr=tr.sine,dr=tr.cosine,Un=Qt.get(Wn),ti=Un.sine,Yi=Un.cosine;return Hr>=0&&ti>=0?dr<Yi?1:dr>Yi?-1:0:Hr<0&&ti<0?dr<Yi?-1:dr>Yi?1:0:ti<Hr?-1:ti>Hr?1:0}}}]),zr}(),hn=0,xn=function(){M(zr,null,[{key:"compare",value:function(lt,mt){var Qt=lt.leftSE.point.x,xr=mt.leftSE.point.x,mn=lt.rightSE.point.x,Wn=mt.rightSE.point.x;if(Wn<Qt)return 1;if(mn<xr)return-1;var tr=lt.leftSE.point.y,Hr=mt.leftSE.point.y,dr=lt.rightSE.point.y,Un=mt.rightSE.point.y;if(Qt<xr){if(Hr<tr&&Hr<dr)return 1;if(Hr>tr&&Hr>dr)return-1;var ti=lt.comparePoint(mt.leftSE.point);if(ti<0)return 1;if(ti>0)return-1;var Yi=mt.comparePoint(lt.rightSE.point);return Yi!==0?Yi:-1}if(Qt>xr){if(tr<Hr&&tr<Un)return-1;if(tr>Hr&&tr>Un)return 1;var ea=mt.comparePoint(lt.leftSE.point);if(ea!==0)return ea;var on=lt.comparePoint(mt.rightSE.point);return on<0?1:on>0?-1:1}if(tr<Hr)return-1;if(tr>Hr)return 1;if(mn<Wn){var Xn=mt.comparePoint(lt.rightSE.point);if(Xn!==0)return Xn}if(mn>Wn){var Pi=lt.comparePoint(mt.rightSE.point);if(Pi<0)return 1;if(Pi>0)return-1}if(mn!==Wn){var Pa=dr-tr,zo=mn-Qt,ya=Un-Hr,Xu=Wn-xr;if(Pa>zo&&ya<Xu)return 1;if(Pa<zo&&ya>Xu)return-1}return mn>Wn?1:mn<Wn||dr<Un?-1:dr>Un?1:lt.id<mt.id?-1:lt.id>mt.id?1:0}}]);function zr(be,lt,mt,Qt){j(this,zr),this.id=++hn,this.leftSE=be,be.segment=this,be.otherSE=lt,this.rightSE=lt,lt.segment=this,lt.otherSE=be,this.rings=mt,this.windings=Qt}return M(zr,[{key:"replaceRightSE",value:function(lt){this.rightSE=lt,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var lt=this.leftSE.point.y,mt=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:lt<mt?lt:mt},ur:{x:this.rightSE.point.x,y:lt>mt?lt:mt}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(lt){return lt.x===this.leftSE.point.x&&lt.y===this.leftSE.point.y||lt.x===this.rightSE.point.x&&lt.y===this.rightSE.point.y}},{key:"comparePoint",value:function(lt){if(this.isAnEndpoint(lt))return 0;var mt=this.leftSE.point,Qt=this.rightSE.point,xr=this.vector();if(mt.x===Qt.x)return lt.x===mt.x?0:lt.x<mt.x?1:-1;var mn=(lt.y-mt.y)/xr.y,Wn=mt.x+mn*xr.x;if(lt.x===Wn)return 0;var tr=(lt.x-mt.x)/xr.x,Hr=mt.y+tr*xr.y;return lt.y===Hr?0:lt.y<Hr?-1:1}},{key:"getIntersection",value:function(lt){var mt=this.bbox(),Qt=lt.bbox(),xr=gn(mt,Qt);if(xr===null)return null;var mn=this.leftSE.point,Wn=this.rightSE.point,tr=lt.leftSE.point,Hr=lt.rightSE.point,dr=er(mt,tr)&&this.comparePoint(tr)===0,Un=er(Qt,mn)&&lt.comparePoint(mn)===0,ti=er(mt,Hr)&&this.comparePoint(Hr)===0,Yi=er(Qt,Wn)&&lt.comparePoint(Wn)===0;if(Un&&dr)return Yi&&!ti?Wn:!Yi&&ti?Hr:null;if(Un)return ti&&mn.x===Hr.x&&mn.y===Hr.y?null:mn;if(dr)return Yi&&Wn.x===tr.x&&Wn.y===tr.y?null:tr;if(Yi&&ti)return null;if(Yi)return Wn;if(ti)return Hr;var ea=Fr(mn,this.vector(),tr,lt.vector());return ea===null||!er(xr,ea)?null:or.round(ea.x,ea.y)}},{key:"split",value:function(lt){var mt=[],Qt=lt.events!==void 0,xr=new Nr(lt,!0),mn=new Nr(lt,!1),Wn=this.rightSE;this.replaceRightSE(mn),mt.push(mn),mt.push(xr);var tr=new zr(xr,Wn,this.rings.slice(),this.windings.slice());return Nr.comparePoints(tr.leftSE.point,tr.rightSE.point)>0&&tr.swapEvents(),Nr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Qt&&(xr.checkForConsuming(),mn.checkForConsuming()),mt}},{key:"swapEvents",value:function(){var lt=this.rightSE;this.rightSE=this.leftSE,this.leftSE=lt,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var mt=0,Qt=this.windings.length;mt<Qt;mt++)this.windings[mt]*=-1}},{key:"consume",value:function(lt){for(var mt=this,Qt=lt;mt.consumedBy;)mt=mt.consumedBy;for(;Qt.consumedBy;)Qt=Qt.consumedBy;var xr=zr.compare(mt,Qt);if(xr!==0){if(xr>0){var mn=mt;mt=Qt,Qt=mn}if(mt.prev===Qt){var Wn=mt;mt=Qt,Qt=Wn}for(var tr=0,Hr=Qt.rings.length;tr<Hr;tr++){var dr=Qt.rings[tr],Un=Qt.windings[tr],ti=mt.rings.indexOf(dr);ti===-1?(mt.rings.push(dr),mt.windings.push(Un)):mt.windings[ti]+=Un}Qt.rings=null,Qt.windings=null,Qt.consumedBy=mt,Qt.leftSE.consumedBy=mt.leftSE,Qt.rightSE.consumedBy=mt.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var lt=this.prev.consumedBy||this.prev;this._beforeState=lt.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var lt=this.beforeState();this._afterState={rings:lt.rings.slice(0),windings:lt.windings.slice(0),multiPolys:[]};for(var mt=this._afterState.rings,Qt=this._afterState.windings,xr=this._afterState.multiPolys,mn=0,Wn=this.rings.length;mn<Wn;mn++){var tr=this.rings[mn],Hr=this.windings[mn],dr=mt.indexOf(tr);dr===-1?(mt.push(tr),Qt.push(Hr)):Qt[dr]+=Hr}for(var Un=[],ti=[],Yi=0,ea=mt.length;Yi<ea;Yi++)if(Qt[Yi]!==0){var on=mt[Yi],Xn=on.poly;if(ti.indexOf(Xn)===-1)if(on.isExterior)Un.push(Xn);else{ti.indexOf(Xn)===-1&&ti.push(Xn);var Pi=Un.indexOf(on.poly);Pi!==-1&&Un.splice(Pi,1)}}for(var Pa=0,zo=Un.length;Pa<zo;Pa++){var ya=Un[Pa].multiPoly;xr.indexOf(ya)===-1&&xr.push(ya)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var lt=this.beforeState().multiPolys,mt=this.afterState().multiPolys;switch(Ko.type){case"union":{var Qt=lt.length===0,xr=mt.length===0;this._isInResult=Qt!==xr;break}case"intersection":{var mn,Wn;lt.length<mt.length?(mn=lt.length,Wn=mt.length):(mn=mt.length,Wn=lt.length),this._isInResult=Wn===Ko.numMultiPolys&&mn<Wn;break}case"xor":{var tr=Math.abs(lt.length-mt.length);this._isInResult=tr%2===1;break}case"difference":{var Hr=function(Un){return Un.length===1&&Un[0].isSubject};this._isInResult=Hr(lt)!==Hr(mt);break}default:throw new Error("Unrecognized operation type found ".concat(Ko.type))}return this._isInResult}}],[{key:"fromRing",value:function(lt,mt,Qt){var xr,mn,Wn,tr=Nr.comparePoints(lt,mt);if(tr<0)xr=lt,mn=mt,Wn=1;else if(tr>0)xr=mt,mn=lt,Wn=-1;else throw new Error("Tried to create degenerate segment at [".concat(lt.x,", ").concat(lt.y,"]"));var Hr=new Nr(xr,!0),dr=new Nr(mn,!1);return new zr(Hr,dr,[Qt],[Wn])}}]),zr}(),Ji=function(){function zr(be,lt,mt){if(j(this,zr),!Array.isArray(be)||be.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=lt,this.isExterior=mt,this.segments=[],typeof be[0][0]!="number"||typeof be[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Qt=or.round(be[0][0],be[0][1]);this.bbox={ll:{x:Qt.x,y:Qt.y},ur:{x:Qt.x,y:Qt.y}};for(var xr=Qt,mn=1,Wn=be.length;mn<Wn;mn++){if(typeof be[mn][0]!="number"||typeof be[mn][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var tr=or.round(be[mn][0],be[mn][1]);tr.x===xr.x&&tr.y===xr.y||(this.segments.push(xn.fromRing(xr,tr,this)),tr.x<this.bbox.ll.x&&(this.bbox.ll.x=tr.x),tr.y<this.bbox.ll.y&&(this.bbox.ll.y=tr.y),tr.x>this.bbox.ur.x&&(this.bbox.ur.x=tr.x),tr.y>this.bbox.ur.y&&(this.bbox.ur.y=tr.y),xr=tr)}(Qt.x!==xr.x||Qt.y!==xr.y)&&this.segments.push(xn.fromRing(xr,Qt,this))}return M(zr,[{key:"getSweepEvents",value:function(){for(var lt=[],mt=0,Qt=this.segments.length;mt<Qt;mt++){var xr=this.segments[mt];lt.push(xr.leftSE),lt.push(xr.rightSE)}return lt}}]),zr}(),pi=function(){function zr(be,lt){if(j(this,zr),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ji(be[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var mt=1,Qt=be.length;mt<Qt;mt++){var xr=new Ji(be[mt],this,!1);xr.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=xr.bbox.ll.x),xr.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=xr.bbox.ll.y),xr.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=xr.bbox.ur.x),xr.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=xr.bbox.ur.y),this.interiorRings.push(xr)}this.multiPoly=lt}return M(zr,[{key:"getSweepEvents",value:function(){for(var lt=this.exteriorRing.getSweepEvents(),mt=0,Qt=this.interiorRings.length;mt<Qt;mt++)for(var xr=this.interiorRings[mt].getSweepEvents(),mn=0,Wn=xr.length;mn<Wn;mn++)lt.push(xr[mn]);return lt}}]),zr}(),Ka=function(){function zr(be,lt){if(j(this,zr),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof be[0][0][0]=="number"&&(be=[be])}catch(mn){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var mt=0,Qt=be.length;mt<Qt;mt++){var xr=new pi(be[mt],this);xr.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=xr.bbox.ll.x),xr.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=xr.bbox.ll.y),xr.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=xr.bbox.ur.x),xr.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=xr.bbox.ur.y),this.polys.push(xr)}this.isSubject=lt}return M(zr,[{key:"getSweepEvents",value:function(){for(var lt=[],mt=0,Qt=this.polys.length;mt<Qt;mt++)for(var xr=this.polys[mt].getSweepEvents(),mn=0,Wn=xr.length;mn<Wn;mn++)lt.push(xr[mn]);return lt}}]),zr}(),na=function(){M(zr,null,[{key:"factory",value:function(lt){for(var mt=[],Qt=0,xr=lt.length;Qt<xr;Qt++){var mn=lt[Qt];if(!(!mn.isInResult()||mn.ringOut)){for(var Wn=null,tr=mn.leftSE,Hr=mn.rightSE,dr=[tr],Un=tr.point,ti=[];Wn=tr,tr=Hr,dr.push(tr),tr.point!==Un;)for(;;){var Yi=tr.getAvailableLinkedEvents();if(Yi.length===0){var ea=dr[0].point,on=dr[dr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ea.x,",")+" ".concat(ea.y,"]. Last matching segment found ends at")+" [".concat(on.x,", ").concat(on.y,"]."))}if(Yi.length===1){Hr=Yi[0].otherSE;break}for(var Xn=null,Pi=0,Pa=ti.length;Pi<Pa;Pi++)if(ti[Pi].point===tr.point){Xn=Pi;break}if(Xn!==null){var zo=ti.splice(Xn)[0],ya=dr.splice(zo.index);ya.unshift(ya[0].otherSE),mt.push(new zr(ya.reverse()));continue}ti.push({index:dr.length,point:tr.point});var Xu=tr.getLeftmostComparator(Wn);Hr=Yi.sort(Xu)[0].otherSE;break}mt.push(new zr(dr))}}return mt}}]);function zr(be){j(this,zr),this.events=be;for(var lt=0,mt=be.length;lt<mt;lt++)be[lt].segment.ringOut=this;this.poly=null}return M(zr,[{key:"getGeom",value:function(){for(var lt=this.events[0].point,mt=[lt],Qt=1,xr=this.events.length-1;Qt<xr;Qt++){var mn=this.events[Qt].point,Wn=this.events[Qt+1].point;ot(mn,lt,Wn)!==0&&(mt.push(mn),lt=mn)}if(mt.length===1)return null;var tr=mt[0],Hr=mt[1];ot(tr,lt,Hr)===0&&mt.shift(),mt.push(mt[0]);for(var dr=this.isExteriorRing()?1:-1,Un=this.isExteriorRing()?0:mt.length-1,ti=this.isExteriorRing()?mt.length:-1,Yi=[],ea=Un;ea!=ti;ea+=dr)Yi.push([mt[ea].x,mt[ea].y]);return Yi}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var lt=this.enclosingRing();this._isExteriorRing=lt?!lt.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var lt=this.events[0],mt=1,Qt=this.events.length;mt<Qt;mt++){var xr=this.events[mt];Nr.compare(lt,xr)>0&&(lt=xr)}for(var mn=lt.segment.prevInResult(),Wn=mn?mn.prevInResult():null;;){if(!mn)return null;if(!Wn)return mn.ringOut;if(Wn.ringOut!==mn.ringOut)return Wn.ringOut.enclosingRing()!==mn.ringOut?mn.ringOut:mn.ringOut.enclosingRing();mn=Wn.prevInResult(),Wn=mn?mn.prevInResult():null}}}]),zr}(),ca=function(){function zr(be){j(this,zr),this.exteriorRing=be,be.poly=this,this.interiorRings=[]}return M(zr,[{key:"addInterior",value:function(lt){this.interiorRings.push(lt),lt.poly=this}},{key:"getGeom",value:function(){var lt=[this.exteriorRing.getGeom()];if(lt[0]===null)return null;for(var mt=0,Qt=this.interiorRings.length;mt<Qt;mt++){var xr=this.interiorRings[mt].getGeom();xr!==null&&lt.push(xr)}return lt}}]),zr}(),po=function(){function zr(be){j(this,zr),this.rings=be,this.polys=this._composePolys(be)}return M(zr,[{key:"getGeom",value:function(){for(var lt=[],mt=0,Qt=this.polys.length;mt<Qt;mt++){var xr=this.polys[mt].getGeom();xr!==null&&lt.push(xr)}return lt}},{key:"_composePolys",value:function(lt){for(var mt=[],Qt=0,xr=lt.length;Qt<xr;Qt++){var mn=lt[Qt];if(!mn.poly)if(mn.isExteriorRing())mt.push(new ca(mn));else{var Wn=mn.enclosingRing();Wn.poly||mt.push(new ca(Wn)),Wn.poly.addInterior(mn)}}return mt}}]),zr}(),La=function(){function zr(be){var lt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xn.compare;j(this,zr),this.queue=be,this.tree=new xt(lt),this.segments=[]}return M(zr,[{key:"process",value:function(lt){var mt=lt.segment,Qt=[];if(lt.consumedBy)return lt.isLeft?this.queue.remove(lt.otherSE):this.tree.remove(mt),Qt;var xr=lt.isLeft?this.tree.insert(mt):this.tree.find(mt);if(!xr)throw new Error("Unable to find segment #".concat(mt.id," ")+"[".concat(mt.leftSE.point.x,", ").concat(mt.leftSE.point.y,"] -> ")+"[".concat(mt.rightSE.point.x,", ").concat(mt.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var mn=xr,Wn=xr,tr=void 0,Hr=void 0;tr===void 0;)mn=this.tree.prev(mn),mn===null?tr=null:mn.key.consumedBy===void 0&&(tr=mn.key);for(;Hr===void 0;)Wn=this.tree.next(Wn),Wn===null?Hr=null:Wn.key.consumedBy===void 0&&(Hr=Wn.key);if(lt.isLeft){var dr=null;if(tr){var Un=tr.getIntersection(mt);if(Un!==null&&(mt.isAnEndpoint(Un)||(dr=Un),!tr.isAnEndpoint(Un)))for(var ti=this._splitSafely(tr,Un),Yi=0,ea=ti.length;Yi<ea;Yi++)Qt.push(ti[Yi])}var on=null;if(Hr){var Xn=Hr.getIntersection(mt);if(Xn!==null&&(mt.isAnEndpoint(Xn)||(on=Xn),!Hr.isAnEndpoint(Xn)))for(var Pi=this._splitSafely(Hr,Xn),Pa=0,zo=Pi.length;Pa<zo;Pa++)Qt.push(Pi[Pa])}if(dr!==null||on!==null){var ya=null;if(dr===null)ya=on;else if(on===null)ya=dr;else{var Xu=Nr.comparePoints(dr,on);ya=Xu<=0?dr:on}this.queue.remove(mt.rightSE),Qt.push(mt.rightSE);for(var Wt=mt.split(ya),qe=0,se=Wt.length;qe<se;qe++)Qt.push(Wt[qe])}Qt.length>0?(this.tree.remove(mt),Qt.push(lt)):(this.segments.push(mt),mt.prev=tr)}else{if(tr&&Hr){var ve=tr.getIntersection(Hr);if(ve!==null){if(!tr.isAnEndpoint(ve))for(var Ae=this._splitSafely(tr,ve),Re=0,Xe=Ae.length;Re<Xe;Re++)Qt.push(Ae[Re]);if(!Hr.isAnEndpoint(ve))for(var Qe=this._splitSafely(Hr,ve),Ye=0,Fe=Qe.length;Ye<Fe;Ye++)Qt.push(Qe[Ye])}}this.tree.remove(mt)}return Qt}},{key:"_splitSafely",value:function(lt,mt){this.tree.remove(lt);var Qt=lt.rightSE;this.queue.remove(Qt);var xr=lt.split(mt);return xr.push(Qt),lt.consumedBy===void 0&&this.tree.insert(lt),xr}}]),zr}(),$i=typeof K!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/cruise-vehicle/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,qo=typeof K!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/cruise-vehicle/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,is=function(){function zr(){j(this,zr)}return M(zr,[{key:"run",value:function(lt,mt,Qt){Ko.type=lt,or.reset();for(var xr=[new Ka(mt,!0)],mn=0,Wn=Qt.length;mn<Wn;mn++)xr.push(new Ka(Qt[mn],!1));if(Ko.numMultiPolys=xr.length,Ko.type==="difference")for(var tr=xr[0],Hr=1;Hr<xr.length;)gn(xr[Hr].bbox,tr.bbox)!==null?Hr++:xr.splice(Hr,1);if(Ko.type==="intersection"){for(var dr=0,Un=xr.length;dr<Un;dr++)for(var ti=xr[dr],Yi=dr+1,ea=xr.length;Yi<ea;Yi++)if(gn(ti.bbox,xr[Yi].bbox)===null)return[]}for(var on=new xt(Nr.compare),Xn=0,Pi=xr.length;Xn<Pi;Xn++)for(var Pa=xr[Xn].getSweepEvents(),zo=0,ya=Pa.length;zo<ya;zo++)if(on.insert(Pa[zo]),on.size>$i)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Xu=new La(on),Wt=on.size,qe=on.pop();qe;){var se=qe.key;if(on.size===Wt){var ve=se.segment;throw new Error("Unable to pop() ".concat(se.isLeft?"left":"right"," SweepEvent ")+"[".concat(se.point.x,", ").concat(se.point.y,"] from segment #").concat(ve.id," ")+"[".concat(ve.leftSE.point.x,", ").concat(ve.leftSE.point.y,"] -> ")+"[".concat(ve.rightSE.point.x,", ").concat(ve.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(on.size>$i)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Xu.segments.length>qo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ae=Xu.process(se),Re=0,Xe=Ae.length;Re<Xe;Re++){var Qe=Ae[Re];Qe.consumedBy===void 0&&on.insert(Qe)}Wt=on.size,qe=on.pop()}or.reset();var Ye=na.factory(Xu.segments),Fe=new po(Ye);return Fe.getGeom()}}]),zr}(),Ko=new is,Za=function(be){for(var lt=arguments.length,mt=new Array(lt>1?lt-1:0),Qt=1;Qt<lt;Qt++)mt[Qt-1]=arguments[Qt];return Ko.run("union",be,mt)},ha=function(be){for(var lt=arguments.length,mt=new Array(lt>1?lt-1:0),Qt=1;Qt<lt;Qt++)mt[Qt-1]=arguments[Qt];return Ko.run("intersection",be,mt)},Fo=function(be){for(var lt=arguments.length,mt=new Array(lt>1?lt-1:0),Qt=1;Qt<lt;Qt++)mt[Qt-1]=arguments[Qt];return Ko.run("xor",be,mt)},un=function(be){for(var lt=arguments.length,mt=new Array(lt>1?lt-1:0),Qt=1;Qt<lt;Qt++)mt[Qt-1]=arguments[Qt];return Ko.run("difference",be,mt)},Ua={union:Za,intersection:ha,xor:Fo,difference:un};return Ua})},51162:function(Ue,_e){"use strict";var G;var K=Symbol.for("react.element"),j=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),te=Symbol.for("react.provider"),pe=Symbol.for("react.context"),Ce=Symbol.for("react.server_context"),le=Symbol.for("react.forward_ref"),Ie=Symbol.for("react.suspense"),rt=Symbol.for("react.suspense_list"),xt=Symbol.for("react.memo"),nt=Symbol.for("react.lazy"),Ct=Symbol.for("react.offscreen"),jt;jt=Symbol.for("react.module.reference");function Vt(Rt){if(typeof Rt=="object"&&Rt!==null){var hr=Rt.$$typeof;switch(hr){case K:switch(Rt=Rt.type,Rt){case P:case ee:case M:case Ie:case rt:return Rt;default:switch(Rt=Rt&&Rt.$$typeof,Rt){case Ce:case pe:case le:case nt:case xt:case te:return Rt;default:return hr}}case j:return hr}}}G=pe,G=te,G=K,G=le,G=P,G=nt,G=xt,G=j,G=ee,G=M,G=Ie,G=rt,G=function(){return!1},G=function(){return!1},G=function(Rt){return Vt(Rt)===pe},G=function(Rt){return Vt(Rt)===te},G=function(Rt){return typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===K},G=function(Rt){return Vt(Rt)===le},_e.isFragment=function(Rt){return Vt(Rt)===P},G=function(Rt){return Vt(Rt)===nt},_e.isMemo=function(Rt){return Vt(Rt)===xt},G=function(Rt){return Vt(Rt)===j},G=function(Rt){return Vt(Rt)===ee},G=function(Rt){return Vt(Rt)===M},G=function(Rt){return Vt(Rt)===Ie},G=function(Rt){return Vt(Rt)===rt},G=function(Rt){return typeof Rt=="string"||typeof Rt=="function"||Rt===P||Rt===ee||Rt===M||Rt===Ie||Rt===rt||Rt===Ct||typeof Rt=="object"&&Rt!==null&&(Rt.$$typeof===nt||Rt.$$typeof===xt||Rt.$$typeof===te||Rt.$$typeof===pe||Rt.$$typeof===le||Rt.$$typeof===jt||Rt.getModuleId!==void 0)},G=Vt},11805:function(Ue,_e,G){"use strict";Ue.exports=G(51162)},75251:function(Ue,_e,G){"use strict";var K;var j=G(67294),P=Symbol.for("react.element"),M=Symbol.for("react.fragment"),ee=Object.prototype.hasOwnProperty,te=j.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pe={key:!0,ref:!0,__self:!0,__source:!0};function Ce(le,Ie,rt){var xt,nt={},Ct=null,jt=null;rt!==void 0&&(Ct=""+rt),Ie.key!==void 0&&(Ct=""+Ie.key),Ie.ref!==void 0&&(jt=Ie.ref);for(xt in Ie)ee.call(Ie,xt)&&!pe.hasOwnProperty(xt)&&(nt[xt]=Ie[xt]);if(le&&le.defaultProps)for(xt in Ie=le.defaultProps,Ie)nt[xt]===void 0&&(nt[xt]=Ie[xt]);return{$$typeof:P,type:le,key:Ct,ref:jt,props:nt,_owner:te.current}}K=M,_e.jsx=Ce,_e.jsxs=Ce},85893:function(Ue,_e,G){"use strict";Ue.exports=G(75251)},28660:function(Ue,_e,G){var K=G(34155);var j;(function(P){(function(M){var ee=typeof G.g=="object"?G.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),te=pe(P);typeof ee.Reflect=="undefined"?ee.Reflect=P:te=pe(ee.Reflect,te),M(te);function pe(Ce,le){return function(Ie,rt){typeof Ce[Ie]!="function"&&Object.defineProperty(Ce,Ie,{configurable:!0,writable:!0,value:rt}),le&&le(Ie,rt)}}})(function(M){var ee=Object.prototype.hasOwnProperty,te=typeof Symbol=="function",pe=te&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ce=te&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",le=typeof Object.create=="function",Ie={__proto__:[]}instanceof Array,rt=!le&&!Ie,xt={create:le?function(){return Wn(Object.create(null))}:Ie?function(){return Wn({__proto__:null})}:function(){return Wn({})},has:rt?function(tr,Hr){return ee.call(tr,Hr)}:function(tr,Hr){return Hr in tr},get:rt?function(tr,Hr){return ee.call(tr,Hr)?tr[Hr]:void 0}:function(tr,Hr){return tr[Hr]}},nt=Object.getPrototypeOf(Function),Ct=typeof K=="object"&&{NODE_ENV:"production",PUBLIC_PATH:"/cruise-vehicle/"}&&{NODE_ENV:"production",PUBLIC_PATH:"/cruise-vehicle/"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",jt=!Ct&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Qt(),Vt=!Ct&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:xr(),Rt=!Ct&&typeof WeakMap=="function"?WeakMap:mn(),hr=new Rt;function er(tr,Hr,dr,Un){if(pi(dr)){if(!Ko(tr))throw new TypeError;if(!ha(Hr))throw new TypeError;return ot(tr,Hr)}else{if(!Ko(tr))throw new TypeError;if(!ca(Hr))throw new TypeError;if(!ca(Un)&&!pi(Un)&&!Ka(Un))throw new TypeError;return Ka(Un)&&(Un=void 0),dr=is(dr),Dt(tr,Hr,dr,Un)}}M("decorate",er);function gn(tr,Hr){function dr(Un,ti){if(!ca(Un))throw new TypeError;if(!pi(ti)&&!Fo(ti))throw new TypeError;Nr(tr,Hr,Un,ti)}return dr}M("metadata",gn);function Rr(tr,Hr,dr,Un){if(!ca(dr))throw new TypeError;return pi(Un)||(Un=is(Un)),Nr(tr,Hr,dr,Un)}M("defineMetadata",Rr);function vn(tr,Hr,dr){if(!ca(Hr))throw new TypeError;return pi(dr)||(dr=is(dr)),Bt(tr,Hr,dr)}M("hasMetadata",vn);function rr(tr,Hr,dr){if(!ca(Hr))throw new TypeError;return pi(dr)||(dr=is(dr)),Ot(tr,Hr,dr)}M("hasOwnMetadata",rr);function Jt(tr,Hr,dr){if(!ca(Hr))throw new TypeError;return pi(dr)||(dr=is(dr)),Pr(tr,Hr,dr)}M("getMetadata",Jt);function br(tr,Hr,dr){if(!ca(Hr))throw new TypeError;return pi(dr)||(dr=is(dr)),Fr(tr,Hr,dr)}M("getOwnMetadata",br);function or(tr,Hr){if(!ca(tr))throw new TypeError;return pi(Hr)||(Hr=is(Hr)),hn(tr,Hr)}M("getMetadataKeys",or);function Br(tr,Hr){if(!ca(tr))throw new TypeError;return pi(Hr)||(Hr=is(Hr)),xn(tr,Hr)}M("getOwnMetadataKeys",Br);function an(tr,Hr,dr){if(!ca(Hr))throw new TypeError;pi(dr)||(dr=is(dr));var Un=Ee(Hr,dr,!1);if(pi(Un)||!Un.delete(tr))return!1;if(Un.size>0)return!0;var ti=hr.get(Hr);return ti.delete(dr),ti.size>0||hr.delete(Hr),!0}M("deleteMetadata",an);function ot(tr,Hr){for(var dr=tr.length-1;dr>=0;--dr){var Un=tr[dr],ti=Un(Hr);if(!pi(ti)&&!Ka(ti)){if(!ha(ti))throw new TypeError;Hr=ti}}return Hr}function Dt(tr,Hr,dr,Un){for(var ti=tr.length-1;ti>=0;--ti){var Yi=tr[ti],ea=Yi(Hr,dr,Un);if(!pi(ea)&&!Ka(ea)){if(!ca(ea))throw new TypeError;Un=ea}}return Un}function Ee(tr,Hr,dr){var Un=hr.get(tr);if(pi(Un)){if(!dr)return;Un=new jt,hr.set(tr,Un)}var ti=Un.get(Hr);if(pi(ti)){if(!dr)return;ti=new jt,Un.set(Hr,ti)}return ti}function Bt(tr,Hr,dr){var Un=Ot(tr,Hr,dr);if(Un)return!0;var ti=mt(Hr);return Ka(ti)?!1:Bt(tr,ti,dr)}function Ot(tr,Hr,dr){var Un=Ee(Hr,dr,!1);return pi(Un)?!1:$i(Un.has(tr))}function Pr(tr,Hr,dr){var Un=Ot(tr,Hr,dr);if(Un)return Fr(tr,Hr,dr);var ti=mt(Hr);if(!Ka(ti))return Pr(tr,ti,dr)}function Fr(tr,Hr,dr){var Un=Ee(Hr,dr,!1);if(!pi(Un))return Un.get(tr)}function Nr(tr,Hr,dr,Un){var ti=Ee(dr,Un,!0);ti.set(tr,Hr)}function hn(tr,Hr){var dr=xn(tr,Hr),Un=mt(tr);if(Un===null)return dr;var ti=hn(Un,Hr);if(ti.length<=0)return dr;if(dr.length<=0)return ti;for(var Yi=new Vt,ea=[],on=0,Xn=dr;on<Xn.length;on++){var Pi=Xn[on],Pa=Yi.has(Pi);Pa||(Yi.add(Pi),ea.push(Pi))}for(var zo=0,ya=ti;zo<ya.length;zo++){var Pi=ya[zo],Pa=Yi.has(Pi);Pa||(Yi.add(Pi),ea.push(Pi))}return ea}function xn(tr,Hr){var dr=[],Un=Ee(tr,Hr,!1);if(pi(Un))return dr;for(var ti=Un.keys(),Yi=Ua(ti),ea=0;;){var on=be(Yi);if(!on)return dr.length=ea,dr;var Xn=zr(on);try{dr[ea]=Xn}catch(Pi){try{lt(Yi)}finally{throw Pi}}ea++}}function Ji(tr){if(tr===null)return 1;switch(typeof tr){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return tr===null?1:6;default:return 6}}function pi(tr){return tr===void 0}function Ka(tr){return tr===null}function na(tr){return typeof tr=="symbol"}function ca(tr){return typeof tr=="object"?tr!==null:typeof tr=="function"}function po(tr,Hr){switch(Ji(tr)){case 0:return tr;case 1:return tr;case 2:return tr;case 3:return tr;case 4:return tr;case 5:return tr}var dr=Hr===3?"string":Hr===5?"number":"default",Un=un(tr,pe);if(Un!==void 0){var ti=Un.call(tr,dr);if(ca(ti))throw new TypeError;return ti}return La(tr,dr==="default"?"number":dr)}function La(tr,Hr){if(Hr==="string"){var dr=tr.toString;if(Za(dr)){var Un=dr.call(tr);if(!ca(Un))return Un}var ti=tr.valueOf;if(Za(ti)){var Un=ti.call(tr);if(!ca(Un))return Un}}else{var ti=tr.valueOf;if(Za(ti)){var Un=ti.call(tr);if(!ca(Un))return Un}var Yi=tr.toString;if(Za(Yi)){var Un=Yi.call(tr);if(!ca(Un))return Un}}throw new TypeError}function $i(tr){return!!tr}function qo(tr){return""+tr}function is(tr){var Hr=po(tr,3);return na(Hr)?Hr:qo(Hr)}function Ko(tr){return Array.isArray?Array.isArray(tr):tr instanceof Object?tr instanceof Array:Object.prototype.toString.call(tr)==="[object Array]"}function Za(tr){return typeof tr=="function"}function ha(tr){return typeof tr=="function"}function Fo(tr){switch(Ji(tr)){case 3:return!0;case 4:return!0;default:return!1}}function un(tr,Hr){var dr=tr[Hr];if(dr!=null){if(!Za(dr))throw new TypeError;return dr}}function Ua(tr){var Hr=un(tr,Ce);if(!Za(Hr))throw new TypeError;var dr=Hr.call(tr);if(!ca(dr))throw new TypeError;return dr}function zr(tr){return tr.value}function be(tr){var Hr=tr.next();return Hr.done?!1:Hr}function lt(tr){var Hr=tr.return;Hr&&Hr.call(tr)}function mt(tr){var Hr=Object.getPrototypeOf(tr);if(typeof tr!="function"||tr===nt||Hr!==nt)return Hr;var dr=tr.prototype,Un=dr&&Object.getPrototypeOf(dr);if(Un==null||Un===Object.prototype)return Hr;var ti=Un.constructor;return typeof ti!="function"||ti===tr?Hr:ti}function Qt(){var tr={},Hr=[],dr=function(){function ea(on,Xn,Pi){this._index=0,this._keys=on,this._values=Xn,this._selector=Pi}return ea.prototype["@@iterator"]=function(){return this},ea.prototype[Ce]=function(){return this},ea.prototype.next=function(){var on=this._index;if(on>=0&&on<this._keys.length){var Xn=this._selector(this._keys[on],this._values[on]);return on+1>=this._keys.length?(this._index=-1,this._keys=Hr,this._values=Hr):this._index++,{value:Xn,done:!1}}return{value:void 0,done:!0}},ea.prototype.throw=function(on){throw this._index>=0&&(this._index=-1,this._keys=Hr,this._values=Hr),on},ea.prototype.return=function(on){return this._index>=0&&(this._index=-1,this._keys=Hr,this._values=Hr),{value:on,done:!0}},ea}();return function(){function ea(){this._keys=[],this._values=[],this._cacheKey=tr,this._cacheIndex=-2}return Object.defineProperty(ea.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ea.prototype.has=function(on){return this._find(on,!1)>=0},ea.prototype.get=function(on){var Xn=this._find(on,!1);return Xn>=0?this._values[Xn]:void 0},ea.prototype.set=function(on,Xn){var Pi=this._find(on,!0);return this._values[Pi]=Xn,this},ea.prototype.delete=function(on){var Xn=this._find(on,!1);if(Xn>=0){for(var Pi=this._keys.length,Pa=Xn+1;Pa<Pi;Pa++)this._keys[Pa-1]=this._keys[Pa],this._values[Pa-1]=this._values[Pa];return this._keys.length--,this._values.length--,on===this._cacheKey&&(this._cacheKey=tr,this._cacheIndex=-2),!0}return!1},ea.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=tr,this._cacheIndex=-2},ea.prototype.keys=function(){return new dr(this._keys,this._values,Un)},ea.prototype.values=function(){return new dr(this._keys,this._values,ti)},ea.prototype.entries=function(){return new dr(this._keys,this._values,Yi)},ea.prototype["@@iterator"]=function(){return this.entries()},ea.prototype[Ce]=function(){return this.entries()},ea.prototype._find=function(on,Xn){return this._cacheKey!==on&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=on)),this._cacheIndex<0&&Xn&&(this._cacheIndex=this._keys.length,this._keys.push(on),this._values.push(void 0)),this._cacheIndex},ea}();function Un(ea,on){return ea}function ti(ea,on){return on}function Yi(ea,on){return[ea,on]}}function xr(){return function(){function tr(){this._map=new jt}return Object.defineProperty(tr.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),tr.prototype.has=function(Hr){return this._map.has(Hr)},tr.prototype.add=function(Hr){return this._map.set(Hr,Hr),this},tr.prototype.delete=function(Hr){return this._map.delete(Hr)},tr.prototype.clear=function(){this._map.clear()},tr.prototype.keys=function(){return this._map.keys()},tr.prototype.values=function(){return this._map.values()},tr.prototype.entries=function(){return this._map.entries()},tr.prototype["@@iterator"]=function(){return this.keys()},tr.prototype[Ce]=function(){return this.keys()},tr}()}function mn(){var tr=16,Hr=xt.create(),dr=Un();return function(){function Xn(){this._key=Un()}return Xn.prototype.has=function(Pi){var Pa=ti(Pi,!1);return Pa!==void 0?xt.has(Pa,this._key):!1},Xn.prototype.get=function(Pi){var Pa=ti(Pi,!1);return Pa!==void 0?xt.get(Pa,this._key):void 0},Xn.prototype.set=function(Pi,Pa){var zo=ti(Pi,!0);return zo[this._key]=Pa,this},Xn.prototype.delete=function(Pi){var Pa=ti(Pi,!1);return Pa!==void 0?delete Pa[this._key]:!1},Xn.prototype.clear=function(){this._key=Un()},Xn}();function Un(){var Xn;do Xn="@@WeakMap@@"+on();while(xt.has(Hr,Xn));return Hr[Xn]=!0,Xn}function ti(Xn,Pi){if(!ee.call(Xn,dr)){if(!Pi)return;Object.defineProperty(Xn,dr,{value:xt.create()})}return Xn[dr]}function Yi(Xn,Pi){for(var Pa=0;Pa<Pi;++Pa)Xn[Pa]=Math.random()*255|0;return Xn}function ea(Xn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Xn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Xn)):Yi(new Uint8Array(Xn),Xn):Yi(new Array(Xn),Xn)}function on(){var Xn=ea(tr);Xn[6]=Xn[6]&79|64,Xn[8]=Xn[8]&191|128;for(var Pi="",Pa=0;Pa<tr;++Pa){var zo=Xn[Pa];(Pa===4||Pa===6||Pa===8)&&(Pi+="-"),zo<16&&(Pi+="0"),Pi+=zo.toString(16).toLowerCase()}return Pi}}function Wn(tr){return tr.__=void 0,delete tr.__,tr}})})(j||(j={}))},81550:function(Ue){(function(_e,G){Ue.exports=G()})(this,function(){"use strict";var _e=function(ze){return ze instanceof Uint8Array||ze instanceof Uint16Array||ze instanceof Uint32Array||ze instanceof Int8Array||ze instanceof Int16Array||ze instanceof Int32Array||ze instanceof Float32Array||ze instanceof Float64Array||ze instanceof Uint8ClampedArray},G=function(ze,At){for(var Gt=Object.keys(At),fn=0;fn<Gt.length;++fn)ze[Gt[fn]]=At[Gt[fn]];return ze},K=`
`;function j(ze){return typeof atob!="undefined"?atob(ze):"base64:"+ze}function P(ze){var At=new Error("(regl) "+ze);throw console.error(At),At}function M(ze,At){ze||P(At)}function ee(ze){return ze?": "+ze:""}function te(ze,At,Gt){ze in At||P("unknown parameter ("+ze+")"+ee(Gt)+". possible values: "+Object.keys(At).join())}function pe(ze,At){_e(ze)||P("invalid parameter type"+ee(At)+". must be a typed array")}function Ce(ze,At){switch(At){case"number":return typeof ze=="number";case"object":return typeof ze=="object";case"string":return typeof ze=="string";case"boolean":return typeof ze=="boolean";case"function":return typeof ze=="function";case"undefined":return typeof ze=="undefined";case"symbol":return typeof ze=="symbol"}}function le(ze,At,Gt){Ce(ze,At)||P("invalid parameter type"+ee(Gt)+". expected "+At+", got "+typeof ze)}function Ie(ze,At){ze>=0&&(ze|0)===ze||P("invalid parameter type, ("+ze+")"+ee(At)+". must be a nonnegative integer")}function rt(ze,At,Gt){At.indexOf(ze)<0&&P("invalid value"+ee(Gt)+". must be one of: "+At)}var xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function nt(ze){Object.keys(ze).forEach(function(At){xt.indexOf(At)<0&&P('invalid regl constructor argument "'+At+'". must be one of '+xt)})}function Ct(ze,At){for(ze=ze+"";ze.length<At;)ze=" "+ze;return ze}function jt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Vt(ze,At){this.number=ze,this.line=At,this.errors=[]}function Rt(ze,At,Gt){this.file=ze,this.line=At,this.message=Gt}function hr(){var ze=new Error,At=(ze.stack||ze).toString(),Gt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(At);if(Gt)return Gt[1];var fn=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(At);return fn?fn[1]:"unknown"}function er(){var ze=new Error,At=(ze.stack||ze).toString(),Gt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(At);if(Gt)return Gt[1];var fn=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(At);return fn?fn[1]:"unknown"}function gn(ze,At){var Gt=ze.split(`
`),fn=1,Dn=0,ln={unknown:new jt,0:new jt};ln.unknown.name=ln[0].name=At||hr(),ln.unknown.lines.push(new Vt(0,""));for(var _n=0;_n<Gt.length;++_n){var Zn=Gt[_n],ri=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zn);if(ri)switch(ri[1]){case"line":var Ci=/(\d+)(\s+\d+)?/.exec(ri[2]);Ci&&(fn=Ci[1]|0,Ci[2]&&(Dn=Ci[2]|0,Dn in ln||(ln[Dn]=new jt)));break;case"define":var _i=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ri[2]);_i&&(ln[Dn].name=_i[1]?j(_i[2]):_i[2]);break}ln[Dn].lines.push(new Vt(fn++,Zn))}return Object.keys(ln).forEach(function(Li){var Fi=ln[Li];Fi.lines.forEach(function(hi){Fi.index[hi.number]=hi})}),ln}function Rr(ze){var At=[];return ze.split(`
`).forEach(function(Gt){if(!(Gt.length<5)){var fn=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Gt);fn?At.push(new Rt(fn[1]|0,fn[2]|0,fn[3].trim())):Gt.length>0&&At.push(new Rt("unknown",0,Gt))}}),At}function vn(ze,At){At.forEach(function(Gt){var fn=ze[Gt.file];if(fn){var Dn=fn.index[Gt.line];if(Dn){Dn.errors.push(Gt),fn.hasErrors=!0;return}}ze.unknown.hasErrors=!0,ze.unknown.lines[0].errors.push(Gt)})}function rr(ze,At,Gt,fn,Dn){if(!ze.getShaderParameter(At,ze.COMPILE_STATUS)){var ln=ze.getShaderInfoLog(At),_n=fn===ze.FRAGMENT_SHADER?"fragment":"vertex";Dt(Gt,"string",_n+" shader source must be a string",Dn);var Zn=gn(Gt,Dn),ri=Rr(ln);vn(Zn,ri),Object.keys(Zn).forEach(function(Ci){var _i=Zn[Ci];if(!_i.hasErrors)return;var Li=[""],Fi=[""];function hi(ki,Wr){Li.push(ki),Fi.push(Wr||"")}hi("file number "+Ci+": "+_i.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),_i.lines.forEach(function(ki){if(ki.errors.length>0){hi(Ct(ki.number,4)+"|  ","background-color:yellow; font-weight:bold"),hi(ki.line+K,"color:red; background-color:yellow; font-weight:bold");var Wr=0;ki.errors.forEach(function(bn){var di=bn.message,Gi=/^\s*'(.*)'\s*:\s*(.*)$/.exec(di);if(Gi){var Yn=Gi[1];switch(di=Gi[2],Yn){case"assign":Yn="=";break}Wr=Math.max(ki.line.indexOf(Yn,Wr),0)}else Wr=0;hi(Ct("| ",6)),hi(Ct("^^^",Wr+3)+K,"font-weight:bold"),hi(Ct("| ",6)),hi(di+K,"font-weight:bold")}),hi(Ct("| ",6)+K)}else hi(Ct(ki.number,4)+"|  "),hi(ki.line+K,"color:red")}),typeof document!="undefined"&&!window.chrome?(Fi[0]=Li.join("%c"),console.log.apply(console,Fi)):console.log(Li.join(""))}),M.raise("Error compiling "+_n+" shader, "+Zn[0].name)}}function Jt(ze,At,Gt,fn,Dn){if(!ze.getProgramParameter(At,ze.LINK_STATUS)){var ln=ze.getProgramInfoLog(At),_n=gn(Gt,Dn),Zn=gn(fn,Dn),ri='Error linking program with vertex shader, "'+Zn[0].name+'", and fragment shader "'+_n[0].name+'"';typeof document!="undefined"?console.log("%c"+ri+K+"%c"+ln,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(ri+K+ln),M.raise(ri)}}function br(ze){ze._commandRef=hr()}function or(ze,At,Gt,fn){br(ze);function Dn(ri){return ri?fn.id(ri):0}ze._fragId=Dn(ze.static.frag),ze._vertId=Dn(ze.static.vert);function ln(ri,Ci){Object.keys(Ci).forEach(function(_i){ri[fn.id(_i)]=!0})}var _n=ze._uniformSet={};ln(_n,At.static),ln(_n,At.dynamic);var Zn=ze._attributeSet={};ln(Zn,Gt.static),ln(Zn,Gt.dynamic),ze._hasCount="count"in ze.static||"count"in ze.dynamic||"elements"in ze.static||"elements"in ze.dynamic}function Br(ze,At){var Gt=er();P(ze+" in command "+(At||hr())+(Gt==="unknown"?"":" called from "+Gt))}function an(ze,At,Gt){ze||Br(At,Gt||hr())}function ot(ze,At,Gt,fn){ze in At||Br("unknown parameter ("+ze+")"+ee(Gt)+". possible values: "+Object.keys(At).join(),fn||hr())}function Dt(ze,At,Gt,fn){Ce(ze,At)||Br("invalid parameter type"+ee(Gt)+". expected "+At+", got "+typeof ze,fn||hr())}function Ee(ze){ze()}function Bt(ze,At,Gt){ze.texture?rt(ze.texture._texture.internalformat,At,"unsupported texture format for attachment"):rt(ze.renderbuffer._renderbuffer.format,Gt,"unsupported renderbuffer format for attachment")}var Ot=33071,Pr=9728,Fr=9984,Nr=9985,hn=9986,xn=9987,Ji=5120,pi=5121,Ka=5122,na=5123,ca=5124,po=5125,La=5126,$i=32819,qo=32820,is=33635,Ko=34042,Za=36193,ha={};ha[Ji]=ha[pi]=1,ha[Ka]=ha[na]=ha[Za]=ha[is]=ha[$i]=ha[qo]=2,ha[ca]=ha[po]=ha[La]=ha[Ko]=4;function Fo(ze,At){return ze===qo||ze===$i||ze===is?2:ze===Ko?4:ha[ze]*At}function un(ze){return!(ze&ze-1)&&!!ze}function Ua(ze,At,Gt){var fn,Dn=At.width,ln=At.height,_n=At.channels;M(Dn>0&&Dn<=Gt.maxTextureSize&&ln>0&&ln<=Gt.maxTextureSize,"invalid texture shape"),(ze.wrapS!==Ot||ze.wrapT!==Ot)&&M(un(Dn)&&un(ln),"incompatible wrap mode for texture, both width and height must be power of 2"),At.mipmask===1?Dn!==1&&ln!==1&&M(ze.minFilter!==Fr&&ze.minFilter!==hn&&ze.minFilter!==Nr&&ze.minFilter!==xn,"min filter requires mipmap"):(M(un(Dn)&&un(ln),"texture must be a square power of 2 to support mipmapping"),M(At.mipmask===(Dn<<1)-1,"missing or incomplete mipmap data")),At.type===La&&(Gt.extensions.indexOf("oes_texture_float_linear")<0&&M(ze.minFilter===Pr&&ze.magFilter===Pr,"filter not supported, must enable oes_texture_float_linear"),M(!ze.genMipmaps,"mipmap generation not supported with float textures"));var Zn=At.images;for(fn=0;fn<16;++fn)if(Zn[fn]){var ri=Dn>>fn,Ci=ln>>fn;M(At.mipmask&1<<fn,"missing mipmap data");var _i=Zn[fn];if(M(_i.width===ri&&_i.height===Ci,"invalid shape for mip images"),M(_i.format===At.format&&_i.internalformat===At.internalformat&&_i.type===At.type,"incompatible type for mip image"),!_i.compressed)if(_i.data){var Li=Math.ceil(Fo(_i.type,_n)*ri/_i.unpackAlignment)*_i.unpackAlignment;M(_i.data.byteLength===Li*Ci,"invalid data for image, buffer size is inconsistent with image format")}else _i.element||_i.copy}else ze.genMipmaps||M((At.mipmask&1<<fn)===0,"extra mipmap data");At.compressed&&M(!ze.genMipmaps,"mipmap generation for compressed images not supported")}function zr(ze,At,Gt,fn){var Dn=ze.width,ln=ze.height,_n=ze.channels;M(Dn>0&&Dn<=fn.maxTextureSize&&ln>0&&ln<=fn.maxTextureSize,"invalid texture shape"),M(Dn===ln,"cube map must be square"),M(At.wrapS===Ot&&At.wrapT===Ot,"wrap mode not supported by cube map");for(var Zn=0;Zn<Gt.length;++Zn){var ri=Gt[Zn];M(ri.width===Dn&&ri.height===ln,"inconsistent cube map face shape"),At.genMipmaps&&(M(!ri.compressed,"can not generate mipmap for compressed textures"),M(ri.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Ci=ri.images,_i=0;_i<16;++_i){var Li=Ci[_i];if(Li){var Fi=Dn>>_i,hi=ln>>_i;M(ri.mipmask&1<<_i,"missing mipmap data"),M(Li.width===Fi&&Li.height===hi,"invalid shape for mip images"),M(Li.format===ze.format&&Li.internalformat===ze.internalformat&&Li.type===ze.type,"incompatible type for mip image"),Li.compressed||(Li.data?M(Li.data.byteLength===Fi*hi*Math.max(Fo(Li.type,_n),Li.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Li.element||Li.copy)}}}}var be=G(M,{optional:Ee,raise:P,commandRaise:Br,command:an,parameter:te,commandParameter:ot,constructor:nt,type:le,commandType:Dt,isTypedArray:pe,nni:Ie,oneOf:rt,shaderError:rr,linkError:Jt,callSite:er,saveCommandRef:br,saveDrawInfo:or,framebufferFormat:Bt,guessCommand:hr,texture2D:Ua,textureCube:zr}),lt=0,mt=0,Qt=5,xr=6;function mn(ze,At){this.id=lt++,this.type=ze,this.data=At}function Wn(ze){return ze.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function tr(ze){if(ze.length===0)return[];var At=ze.charAt(0),Gt=ze.charAt(ze.length-1);if(ze.length>1&&At===Gt&&(At==='"'||At==="'"))return['"'+Wn(ze.substr(1,ze.length-2))+'"'];var fn=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ze);if(fn)return tr(ze.substr(0,fn.index)).concat(tr(fn[1])).concat(tr(ze.substr(fn.index+fn[0].length)));var Dn=ze.split(".");if(Dn.length===1)return['"'+Wn(ze)+'"'];for(var ln=[],_n=0;_n<Dn.length;++_n)ln=ln.concat(tr(Dn[_n]));return ln}function Hr(ze){return"["+tr(ze).join("][")+"]"}function dr(ze,At){return new mn(ze,Hr(At+""))}function Un(ze){return typeof ze=="function"&&!ze._reglType||ze instanceof mn}function ti(ze,At){if(typeof ze=="function")return new mn(mt,ze);if(typeof ze=="number"||typeof ze=="boolean")return new mn(Qt,ze);if(Array.isArray(ze))return new mn(xr,ze.map((Gt,fn)=>ti(Gt,At+"["+fn+"]")));if(ze instanceof mn)return ze;be(!1,"invalid option type in uniform "+At)}var Yi={DynamicVariable:mn,define:dr,isDynamic:Un,unbox:ti,accessor:Hr},ea={next:typeof requestAnimationFrame=="function"?function(ze){return requestAnimationFrame(ze)}:function(ze){return setTimeout(ze,16)},cancel:typeof cancelAnimationFrame=="function"?function(ze){return cancelAnimationFrame(ze)}:clearTimeout},on=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Xn(){var ze={"":0},At=[""];return{id:function(Gt){var fn=ze[Gt];return fn||(fn=ze[Gt]=At.length,At.push(Gt),fn)},str:function(Gt){return At[Gt]}}}function Pi(ze,At,Gt){var fn=document.createElement("canvas");G(fn.style,{border:0,margin:0,padding:0,top:0,left:0}),ze.appendChild(fn),ze===document.body&&(fn.style.position="absolute",G(ze.style,{margin:0,padding:0}));function Dn(){var Zn=window.innerWidth,ri=window.innerHeight;if(ze!==document.body){var Ci=ze.getBoundingClientRect();Zn=Ci.right-Ci.left,ri=Ci.bottom-Ci.top}fn.width=Gt*Zn,fn.height=Gt*ri,G(fn.style,{width:Zn+"px",height:ri+"px"})}var ln;ze!==document.body&&typeof ResizeObserver=="function"?(ln=new ResizeObserver(function(){setTimeout(Dn)}),ln.observe(ze)):window.addEventListener("resize",Dn,!1);function _n(){ln?ln.disconnect():window.removeEventListener("resize",Dn),ze.removeChild(fn)}return Dn(),{canvas:fn,onDestroy:_n}}function Pa(ze,At){function Gt(fn){try{return ze.getContext(fn,At)}catch(Dn){return null}}return Gt("webgl")||Gt("experimental-webgl")||Gt("webgl-experimental")}function zo(ze){return typeof ze.nodeName=="string"&&typeof ze.appendChild=="function"&&typeof ze.getBoundingClientRect=="function"}function ya(ze){return typeof ze.drawArrays=="function"||typeof ze.drawElements=="function"}function Xu(ze){return typeof ze=="string"?ze.split():(be(Array.isArray(ze),"invalid extension array"),ze)}function Wt(ze){return typeof ze=="string"?(be(typeof document!="undefined","not supported outside of DOM"),document.querySelector(ze)):ze}function qe(ze){var At=ze||{},Gt,fn,Dn,ln,_n={},Zn=[],ri=[],Ci=typeof window=="undefined"?1:window.devicePixelRatio,_i=!1,Li=function(ki){ki&&be.raise(ki)},Fi=function(){};if(typeof At=="string"?(be(typeof document!="undefined","selector queries only supported in DOM enviroments"),Gt=document.querySelector(At),be(Gt,"invalid query string for element")):typeof At=="object"?zo(At)?Gt=At:ya(At)?(ln=At,Dn=ln.canvas):(be.constructor(At),"gl"in At?ln=At.gl:"canvas"in At?Dn=Wt(At.canvas):"container"in At&&(fn=Wt(At.container)),"attributes"in At&&(_n=At.attributes,be.type(_n,"object","invalid context attributes")),"extensions"in At&&(Zn=Xu(At.extensions)),"optionalExtensions"in At&&(ri=Xu(At.optionalExtensions)),"onDone"in At&&(be.type(At.onDone,"function","invalid or missing onDone callback"),Li=At.onDone),"profile"in At&&(_i=!!At.profile),"pixelRatio"in At&&(Ci=+At.pixelRatio,be(Ci>0,"invalid pixel ratio"))):be.raise("invalid arguments to regl"),Gt&&(Gt.nodeName.toLowerCase()==="canvas"?Dn=Gt:fn=Gt),!ln){if(!Dn){be(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var hi=Pi(fn||document.body,Li,Ci);if(!hi)return null;Dn=hi.canvas,Fi=hi.onDestroy}_n.premultipliedAlpha===void 0&&(_n.premultipliedAlpha=!0),ln=Pa(Dn,_n)}return ln?{gl:ln,canvas:Dn,container:fn,extensions:Zn,optionalExtensions:ri,pixelRatio:Ci,profile:_i,onDone:Li,onDestroy:Fi}:(Fi(),Li("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function se(ze,At){var Gt={};function fn(_n){be.type(_n,"string","extension name must be string");var Zn=_n.toLowerCase(),ri;try{ri=Gt[Zn]=ze.getExtension(Zn)}catch(Ci){}return!!ri}for(var Dn=0;Dn<At.extensions.length;++Dn){var ln=At.extensions[Dn];if(!fn(ln))return At.onDestroy(),At.onDone('"'+ln+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return At.optionalExtensions.forEach(fn),{extensions:Gt,restore:function(){Object.keys(Gt).forEach(function(_n){if(Gt[_n]&&!fn(_n))throw new Error("(regl): error restoring extension "+_n)})}}}function ve(ze,At){for(var Gt=Array(ze),fn=0;fn<ze;++fn)Gt[fn]=At(fn);return Gt}var Ae=5120,Re=5121,Xe=5122,Qe=5123,Ye=5124,Fe=5125,Me=5126;function Be(ze){for(var At=16;At<=1<<28;At*=16)if(ze<=At)return At;return 0}function yt(ze){var At,Gt;return At=(ze>65535)<<4,ze>>>=At,Gt=(ze>255)<<3,ze>>>=Gt,At|=Gt,Gt=(ze>15)<<2,ze>>>=Gt,At|=Gt,Gt=(ze>3)<<1,ze>>>=Gt,At|=Gt,At|ze>>1}function zt(){var ze=ve(8,function(){return[]});function At(ln){var _n=Be(ln),Zn=ze[yt(_n)>>2];return Zn.length>0?Zn.pop():new ArrayBuffer(_n)}function Gt(ln){ze[yt(ln.byteLength)>>2].push(ln)}function fn(ln,_n){var Zn=null;switch(ln){case Ae:Zn=new Int8Array(At(_n),0,_n);break;case Re:Zn=new Uint8Array(At(_n),0,_n);break;case Xe:Zn=new Int16Array(At(2*_n),0,_n);break;case Qe:Zn=new Uint16Array(At(2*_n),0,_n);break;case Ye:Zn=new Int32Array(At(4*_n),0,_n);break;case Fe:Zn=new Uint32Array(At(4*_n),0,_n);break;case Me:Zn=new Float32Array(At(4*_n),0,_n);break;default:return null}return Zn.length!==_n?Zn.subarray(0,_n):Zn}function Dn(ln){Gt(ln.buffer)}return{alloc:At,free:Gt,allocType:fn,freeType:Dn}}var Ze=zt();Ze.zero=zt();var Yr=3408,Fn=3410,Nn=3411,qr=3412,li=3413,zn=3414,jn=3415,Ca=33901,ni=33902,za=3379,Ao=3386,io=34921,ys=36347,oo=36348,el=35661,Qs=35660,vo=34930,as=36349,To=34076,to=34024,js=7936,Vc=7937,ws=7938,Ss=35724,eh=34047,kc=36063,Io=34852,bo=3553,du=34067,Zo=34069,Il=33984,Uo=6408,Ws=5126,eu=5121,sl=36160,ul=36053,ll=36064,_c=16384,zu=function(ze,At){var Gt=1;At.ext_texture_filter_anisotropic&&(Gt=ze.getParameter(eh));var fn=1,Dn=1;At.webgl_draw_buffers&&(fn=ze.getParameter(Io),Dn=ze.getParameter(kc));var ln=!!At.oes_texture_float;if(ln){var _n=ze.createTexture();ze.bindTexture(bo,_n),ze.texImage2D(bo,0,Uo,1,1,0,Uo,Ws,null);var Zn=ze.createFramebuffer();if(ze.bindFramebuffer(sl,Zn),ze.framebufferTexture2D(sl,ll,bo,_n,0),ze.bindTexture(bo,null),ze.checkFramebufferStatus(sl)!==ul)ln=!1;else{ze.viewport(0,0,1,1),ze.clearColor(1,0,0,1),ze.clear(_c);var ri=Ze.allocType(Ws,4);ze.readPixels(0,0,1,1,Uo,Ws,ri),ze.getError()?ln=!1:(ze.deleteFramebuffer(Zn),ze.deleteTexture(_n),ln=ri[0]===1),Ze.freeType(ri)}}var Ci=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),_i=!0;if(!Ci){var Li=ze.createTexture(),Fi=Ze.allocType(eu,36);ze.activeTexture(Il),ze.bindTexture(du,Li),ze.texImage2D(Zo,0,Uo,3,3,0,Uo,eu,Fi),Ze.freeType(Fi),ze.bindTexture(du,null),ze.deleteTexture(Li),_i=!ze.getError()}return{colorBits:[ze.getParameter(Fn),ze.getParameter(Nn),ze.getParameter(qr),ze.getParameter(li)],depthBits:ze.getParameter(zn),stencilBits:ze.getParameter(jn),subpixelBits:ze.getParameter(Yr),extensions:Object.keys(At).filter(function(hi){return!!At[hi]}),maxAnisotropic:Gt,maxDrawbuffers:fn,maxColorAttachments:Dn,pointSizeDims:ze.getParameter(Ca),lineWidthDims:ze.getParameter(ni),maxViewportDims:ze.getParameter(Ao),maxCombinedTextureUnits:ze.getParameter(el),maxCubeMapSize:ze.getParameter(To),maxRenderbufferSize:ze.getParameter(to),maxTextureUnits:ze.getParameter(vo),maxTextureSize:ze.getParameter(za),maxAttributes:ze.getParameter(io),maxVertexUniforms:ze.getParameter(ys),maxVertexTextureUnits:ze.getParameter(Qs),maxVaryingVectors:ze.getParameter(oo),maxFragmentUniforms:ze.getParameter(as),glsl:ze.getParameter(Ss),renderer:ze.getParameter(Vc),vendor:ze.getParameter(js),version:ze.getParameter(ws),readFloat:ln,npotTextureCube:_i}};function cl(ze){return!!ze&&typeof ze=="object"&&Array.isArray(ze.shape)&&Array.isArray(ze.stride)&&typeof ze.offset=="number"&&ze.shape.length===ze.stride.length&&(Array.isArray(ze.data)||_e(ze.data))}var iu=function(ze){return Object.keys(ze).map(function(At){return ze[At]})},_t={shape:Xa,flatten:wa};function Ut(ze,At,Gt){for(var fn=0;fn<At;++fn)Gt[fn]=ze[fn]}function Er(ze,At,Gt,fn){for(var Dn=0,ln=0;ln<At;++ln)for(var _n=ze[ln],Zn=0;Zn<Gt;++Zn)fn[Dn++]=_n[Zn]}function Sn(ze,At,Gt,fn,Dn,ln){for(var _n=ln,Zn=0;Zn<At;++Zn)for(var ri=ze[Zn],Ci=0;Ci<Gt;++Ci)for(var _i=ri[Ci],Li=0;Li<fn;++Li)Dn[_n++]=_i[Li]}function kr(ze,At,Gt,fn,Dn){for(var ln=1,_n=Gt+1;_n<At.length;++_n)ln*=At[_n];var Zn=At[Gt];if(At.length-Gt===4){var ri=At[Gt+1],Ci=At[Gt+2],_i=At[Gt+3];for(_n=0;_n<Zn;++_n)Sn(ze[_n],ri,Ci,_i,fn,Dn),Dn+=ln}else for(_n=0;_n<Zn;++_n)kr(ze[_n],At,Gt+1,fn,Dn),Dn+=ln}function wa(ze,At,Gt,fn){var Dn=1;if(At.length)for(var ln=0;ln<At.length;++ln)Dn*=At[ln];else Dn=0;var _n=fn||Ze.allocType(Gt,Dn);switch(At.length){case 0:break;case 1:Ut(ze,At[0],_n);break;case 2:Er(ze,At[0],At[1],_n);break;case 3:Sn(ze,At[0],At[1],At[2],_n,0);break;default:kr(ze,At,0,_n,0)}return _n}function Xa(ze){for(var At=[],Gt=ze;Gt.length;Gt=Gt[0])At.push(Gt.length);return At}var yl={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Jo=5120,au=5122,ou=5124,Ra=5121,Mp=5123,th=5125,su=5126,_a=5126,os={int8:Jo,int16:au,int32:ou,uint8:Ra,uint16:Mp,uint32:th,float:su,float32:_a},Su=35048,Eh=35040,Mo={dynamic:Su,stream:Eh,static:35044},cc=_t.flatten,uu=_t.shape,Ja=35044,rf=35040,Yu=5121,Vs=5126,yh=[];yh[5120]=1,yh[5122]=2,yh[5124]=4,yh[5121]=1,yh[5123]=2,yh[5125]=4,yh[5126]=4;function tl(ze){return yl[Object.prototype.toString.call(ze)]|0}function vu(ze,At){for(var Gt=0;Gt<At.length;++Gt)ze[Gt]=At[Gt]}function Ch(ze,At,Gt,fn,Dn,ln,_n){for(var Zn=0,ri=0;ri<Gt;++ri)for(var Ci=0;Ci<fn;++Ci)ze[Zn++]=At[Dn*ri+ln*Ci+_n]}function Hf(ze,At,Gt,fn){var Dn=0,ln={};function _n(Wr){this.id=Dn++,this.buffer=ze.createBuffer(),this.type=Wr,this.usage=Ja,this.byteLength=0,this.dimension=1,this.dtype=Yu,this.persistentData=null,Gt.profile&&(this.stats={size:0})}_n.prototype.bind=function(){ze.bindBuffer(this.type,this.buffer)},_n.prototype.destroy=function(){Fi(this)};var Zn=[];function ri(Wr,bn){var di=Zn.pop();return di||(di=new _n(Wr)),di.bind(),Li(di,bn,rf,0,1,!1),di}function Ci(Wr){Zn.push(Wr)}function _i(Wr,bn,di){Wr.byteLength=bn.byteLength,ze.bufferData(Wr.type,bn,di)}function Li(Wr,bn,di,Gi,Yn,ia){var oi;if(Wr.usage=di,Array.isArray(bn)){if(Wr.dtype=Gi||Vs,bn.length>0){var Di;if(Array.isArray(bn[0])){oi=uu(bn);for(var qn=1,Ai=1;Ai<oi.length;++Ai)qn*=oi[Ai];Wr.dimension=qn,Di=cc(bn,oi,Wr.dtype),_i(Wr,Di,di),ia?Wr.persistentData=Di:Ze.freeType(Di)}else if(typeof bn[0]=="number"){Wr.dimension=Yn;var Oa=Ze.allocType(Wr.dtype,bn.length);vu(Oa,bn),_i(Wr,Oa,di),ia?Wr.persistentData=Oa:Ze.freeType(Oa)}else _e(bn[0])?(Wr.dimension=bn[0].length,Wr.dtype=Gi||tl(bn[0])||Vs,Di=cc(bn,[bn.length,bn[0].length],Wr.dtype),_i(Wr,Di,di),ia?Wr.persistentData=Di:Ze.freeType(Di)):be.raise("invalid buffer data")}}else if(_e(bn))Wr.dtype=Gi||tl(bn),Wr.dimension=Yn,_i(Wr,bn,di),ia&&(Wr.persistentData=new Uint8Array(new Uint8Array(bn.buffer)));else if(cl(bn)){oi=bn.shape;var Ya=bn.stride,Oi=bn.offset,Qn=0,Hn=0,mo=0,so=0;oi.length===1?(Qn=oi[0],Hn=1,mo=Ya[0],so=0):oi.length===2?(Qn=oi[0],Hn=oi[1],mo=Ya[0],so=Ya[1]):be.raise("invalid shape"),Wr.dtype=Gi||tl(bn.data)||Vs,Wr.dimension=Hn;var sa=Ze.allocType(Wr.dtype,Qn*Hn);Ch(sa,bn.data,Qn,Hn,mo,so,Oi),_i(Wr,sa,di),ia?Wr.persistentData=sa:Ze.freeType(sa)}else bn instanceof ArrayBuffer?(Wr.dtype=Yu,Wr.dimension=Yn,_i(Wr,bn,di),ia&&(Wr.persistentData=new Uint8Array(new Uint8Array(bn)))):be.raise("invalid buffer data")}function Fi(Wr){At.bufferCount--,fn(Wr);var bn=Wr.buffer;be(bn,"buffer must not be deleted already"),ze.deleteBuffer(bn),Wr.buffer=null,delete ln[Wr.id]}function hi(Wr,bn,di,Gi){At.bufferCount++;var Yn=new _n(bn);ln[Yn.id]=Yn;function ia(qn){var Ai=Ja,Oa=null,Ya=0,Oi=0,Qn=1;return Array.isArray(qn)||_e(qn)||cl(qn)||qn instanceof ArrayBuffer?Oa=qn:typeof qn=="number"?Ya=qn|0:qn&&(be.type(qn,"object","buffer arguments must be an object, a number or an array"),"data"in qn&&(be(Oa===null||Array.isArray(Oa)||_e(Oa)||cl(Oa),"invalid data for buffer"),Oa=qn.data),"usage"in qn&&(be.parameter(qn.usage,Mo,"invalid buffer usage"),Ai=Mo[qn.usage]),"type"in qn&&(be.parameter(qn.type,os,"invalid buffer type"),Oi=os[qn.type]),"dimension"in qn&&(be.type(qn.dimension,"number","invalid dimension"),Qn=qn.dimension|0),"length"in qn&&(be.nni(Ya,"buffer length must be a nonnegative integer"),Ya=qn.length|0)),Yn.bind(),Oa?Li(Yn,Oa,Ai,Oi,Qn,Gi):(Ya&&ze.bufferData(Yn.type,Ya,Ai),Yn.dtype=Oi||Yu,Yn.usage=Ai,Yn.dimension=Qn,Yn.byteLength=Ya),Gt.profile&&(Yn.stats.size=Yn.byteLength*yh[Yn.dtype]),ia}function oi(qn,Ai){be(Ai+qn.byteLength<=Yn.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+qn.byteLength+" starting from offset "+Ai+" to a buffer of size "+Yn.byteLength),ze.bufferSubData(Yn.type,Ai,qn)}function Di(qn,Ai){var Oa=(Ai||0)|0,Ya;if(Yn.bind(),_e(qn)||qn instanceof ArrayBuffer)oi(qn,Oa);else if(Array.isArray(qn)){if(qn.length>0)if(typeof qn[0]=="number"){var Oi=Ze.allocType(Yn.dtype,qn.length);vu(Oi,qn),oi(Oi,Oa),Ze.freeType(Oi)}else if(Array.isArray(qn[0])||_e(qn[0])){Ya=uu(qn);var Qn=cc(qn,Ya,Yn.dtype);oi(Qn,Oa),Ze.freeType(Qn)}else be.raise("invalid buffer data")}else if(cl(qn)){Ya=qn.shape;var Hn=qn.stride,mo=0,so=0,sa=0,Cs=0;Ya.length===1?(mo=Ya[0],so=1,sa=Hn[0],Cs=0):Ya.length===2?(mo=Ya[0],so=Ya[1],sa=Hn[0],Cs=Hn[1]):be.raise("invalid shape");var Vo=Array.isArray(qn.data)?Yn.dtype:tl(qn.data),Go=Ze.allocType(Vo,mo*so);Ch(Go,qn.data,mo,so,sa,Cs,qn.offset),oi(Go,Oa),Ze.freeType(Go)}else be.raise("invalid data for buffer subdata");return ia}return di||ia(Wr),ia._reglType="buffer",ia._buffer=Yn,ia.subdata=Di,Gt.profile&&(ia.stats=Yn.stats),ia.destroy=function(){Fi(Yn)},ia}function ki(){iu(ln).forEach(function(Wr){Wr.buffer=ze.createBuffer(),ze.bindBuffer(Wr.type,Wr.buffer),ze.bufferData(Wr.type,Wr.persistentData||Wr.byteLength,Wr.usage)})}return Gt.profile&&(At.getTotalBufferSize=function(){var Wr=0;return Object.keys(ln).forEach(function(bn){Wr+=ln[bn].stats.size}),Wr}),{create:hi,createStream:ri,destroyStream:Ci,clear:function(){iu(ln).forEach(Fi),Zn.forEach(Fi)},getBuffer:function(Wr){return Wr&&Wr._buffer instanceof _n?Wr._buffer:null},restore:ki,_initBuffer:Li}}var Vn=0,gi=0,Hp=1,nf=1,Gc=4,sd=4,Bu={points:Vn,point:gi,lines:Hp,line:nf,triangles:Gc,triangle:sd,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},$d=0,rh=1,Ah=4,lp=5120,hl=5121,$f=5122,Th=5123,_h=5124,nh=5125,$p=34963,cp=35040,Mu=35044;function af(ze,At,Gt,fn){var Dn={},ln=0,_n={uint8:hl,uint16:Th};At.oes_element_index_uint&&(_n.uint32=nh);function Zn(ki){this.id=ln++,Dn[this.id]=this,this.buffer=ki,this.primType=Ah,this.vertCount=0,this.type=0}Zn.prototype.bind=function(){this.buffer.bind()};var ri=[];function Ci(ki){var Wr=ri.pop();return Wr||(Wr=new Zn(Gt.create(null,$p,!0,!1)._buffer)),Li(Wr,ki,cp,-1,-1,0,0),Wr}function _i(ki){ri.push(ki)}function Li(ki,Wr,bn,di,Gi,Yn,ia){ki.buffer.bind();var oi;if(Wr){var Di=ia;!ia&&(!_e(Wr)||cl(Wr)&&!_e(Wr.data))&&(Di=At.oes_element_index_uint?nh:Th),Gt._initBuffer(ki.buffer,Wr,bn,Di,3)}else ze.bufferData($p,Yn,bn),ki.buffer.dtype=oi||hl,ki.buffer.usage=bn,ki.buffer.dimension=3,ki.buffer.byteLength=Yn;if(oi=ia,!ia){switch(ki.buffer.dtype){case hl:case lp:oi=hl;break;case Th:case $f:oi=Th;break;case nh:case _h:oi=nh;break;default:be.raise("unsupported type for element array")}ki.buffer.dtype=oi}ki.type=oi,be(oi!==nh||!!At.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var qn=Gi;qn<0&&(qn=ki.buffer.byteLength,oi===Th?qn>>=1:oi===nh&&(qn>>=2)),ki.vertCount=qn;var Ai=di;if(di<0){Ai=Ah;var Oa=ki.buffer.dimension;Oa===1&&(Ai=$d),Oa===2&&(Ai=rh),Oa===3&&(Ai=Ah)}ki.primType=Ai}function Fi(ki){fn.elementsCount--,be(ki.buffer!==null,"must not double destroy elements"),delete Dn[ki.id],ki.buffer.destroy(),ki.buffer=null}function hi(ki,Wr){var bn=Gt.create(null,$p,!0),di=new Zn(bn._buffer);fn.elementsCount++;function Gi(Yn){if(!Yn)bn(),di.primType=Ah,di.vertCount=0,di.type=hl;else if(typeof Yn=="number")bn(Yn),di.primType=Ah,di.vertCount=Yn|0,di.type=hl;else{var ia=null,oi=Mu,Di=-1,qn=-1,Ai=0,Oa=0;Array.isArray(Yn)||_e(Yn)||cl(Yn)?ia=Yn:(be.type(Yn,"object","invalid arguments for elements"),"data"in Yn&&(ia=Yn.data,be(Array.isArray(ia)||_e(ia)||cl(ia),"invalid data for element buffer")),"usage"in Yn&&(be.parameter(Yn.usage,Mo,"invalid element buffer usage"),oi=Mo[Yn.usage]),"primitive"in Yn&&(be.parameter(Yn.primitive,Bu,"invalid element buffer primitive"),Di=Bu[Yn.primitive]),"count"in Yn&&(be(typeof Yn.count=="number"&&Yn.count>=0,"invalid vertex count for elements"),qn=Yn.count|0),"type"in Yn&&(be.parameter(Yn.type,_n,"invalid buffer type"),Oa=_n[Yn.type]),"length"in Yn?Ai=Yn.length|0:(Ai=qn,Oa===Th||Oa===$f?Ai*=2:(Oa===nh||Oa===_h)&&(Ai*=4))),Li(di,ia,oi,Di,qn,Ai,Oa)}return Gi}return Gi(ki),Gi._reglType="elements",Gi._elements=di,Gi.subdata=function(Yn,ia){return bn.subdata(Yn,ia),Gi},Gi.destroy=function(){Fi(di)},Gi}return{create:hi,createStream:Ci,destroyStream:_i,getElements:function(ki){return typeof ki=="function"&&ki._elements instanceof Zn?ki._elements:null},clear:function(){iu(Dn).forEach(Fi)}}}var hp=new Float32Array(1),ih=new Uint32Array(hp.buffer),fp=5123;function Vh(ze){for(var At=Ze.allocType(fp,ze.length),Gt=0;Gt<ze.length;++Gt)if(isNaN(ze[Gt]))At[Gt]=65535;else if(ze[Gt]===1/0)At[Gt]=31744;else if(ze[Gt]===-1/0)At[Gt]=64512;else{hp[0]=ze[Gt];var fn=ih[0],Dn=fn>>>31<<15,ln=(fn<<1>>>24)-127,_n=fn>>13&1024-1;if(ln<-24)At[Gt]=Dn;else if(ln<-14){var Zn=-14-ln;At[Gt]=Dn+(_n+1024>>Zn)}else ln>15?At[Gt]=Dn+31744:At[Gt]=Dn+(ln+15<<10)+_n}return At}function Nu(ze){return Array.isArray(ze)||_e(ze)}var Wf=function(ze){return!(ze&ze-1)&&!!ze},Sf=34467,ko=3553,rl=34067,pp=34069,jo=6408,hc=6406,_u=6407,mu=6409,Mh=6410,ud=32854,of=32855,Eu=36194,dp=32819,Wp=32820,Ph=33635,wd=34042,Xp=6402,vp=34041,Ga=35904,mp=35906,Hc=36193,gp=33776,sf=33777,ah=33778,wo=33779,fl=35986,pl=35987,bh=34798,Xf=35840,yp=35841,Gh=35842,Vu=35843,Yf=36196,Ll=5121,uf=5123,Pp=5125,kh=5126,Xs=10242,qf=10243,_p=10497,bp=33071,Yp=33648,kp=10240,xp=10241,Kl=9728,$c=9729,Rl=9984,Ms=9985,Hh=9986,lf=9987,Ef=33170,vs=4352,Ns=4353,bc=4354,fc=34046,xc=3317,Pe=37440,Ih=37441,cf=37443,Cf=37444,Af=33984,Lh=[Rl,Hh,Ms,lf],Cu=[0,mu,Mh,_u,jo],nl={};nl[mu]=nl[hc]=nl[Xp]=1,nl[vp]=nl[Mh]=2,nl[_u]=nl[Ga]=3,nl[jo]=nl[mp]=4;function Wc(ze){return"[object "+ze+"]"}var zi=Wc("HTMLCanvasElement"),Ui=Wc("OffscreenCanvas"),Gu=Wc("CanvasRenderingContext2D"),$h=Wc("ImageBitmap"),Wh=Wc("HTMLImageElement"),ji=Wc("HTMLVideoElement"),Ic=Object.keys(yl).concat([zi,Ui,Gu,$h,Wh,ji]),hf=[];hf[Ll]=1,hf[kh]=4,hf[Hc]=2,hf[uf]=2,hf[Pp]=4;var Gn=[];Gn[ud]=2,Gn[of]=2,Gn[Eu]=2,Gn[vp]=4,Gn[gp]=.5,Gn[sf]=.5,Gn[ah]=1,Gn[wo]=1,Gn[fl]=.5,Gn[pl]=1,Gn[bh]=1,Gn[Xf]=.5,Gn[yp]=.25,Gn[Gh]=.5,Gn[Vu]=.25,Gn[Yf]=.5;function ld(ze){return Array.isArray(ze)&&(ze.length===0||typeof ze[0]=="number")}function xh(ze){if(!Array.isArray(ze))return!1;var At=ze.length;return!(At===0||!Nu(ze[0]))}function Xh(ze){return Object.prototype.toString.call(ze)}function wh(ze){return Xh(ze)===zi}function oh(ze){return Xh(ze)===Ui}function ff(ze){return Xh(ze)===Gu}function Tf(ze){return Xh(ze)===$h}function Jl(ze){return Xh(ze)===Wh}function wc(ze){return Xh(ze)===ji}function Ql(ze){if(!ze)return!1;var At=Xh(ze);return Ic.indexOf(At)>=0?!0:ld(ze)||xh(ze)||cl(ze)}function Yh(ze){return yl[Object.prototype.toString.call(ze)]|0}function Mf(ze,At){var Gt=At.length;switch(ze.type){case Ll:case uf:case Pp:case kh:var fn=Ze.allocType(ze.type,Gt);fn.set(At),ze.data=fn;break;case Hc:ze.data=Vh(At);break;default:be.raise("unsupported texture type, must specify a typed array")}}function pf(ze,At){return Ze.allocType(ze.type===Hc?kh:ze.type,At)}function Lc(ze,At){ze.type===Hc?(ze.data=Vh(At),Ze.freeType(At)):ze.data=At}function _l(ze,At,Gt,fn,Dn,ln){for(var _n=ze.width,Zn=ze.height,ri=ze.channels,Ci=_n*Zn*ri,_i=pf(ze,Ci),Li=0,Fi=0;Fi<Zn;++Fi)for(var hi=0;hi<_n;++hi)for(var ki=0;ki<ri;++ki)_i[Li++]=At[Gt*hi+fn*Fi+Dn*ki+ln];Lc(ze,_i)}function xo(ze,At,Gt,fn,Dn,ln){var _n;if(typeof Gn[ze]!="undefined"?_n=Gn[ze]:_n=nl[ze]*hf[At],ln&&(_n*=6),Dn){for(var Zn=0,ri=Gt;ri>=1;)Zn+=_n*ri*ri,ri/=2;return Zn}else return _n*Gt*fn}function Dl(ze,At,Gt,fn,Dn,ln,_n){var Zn={"don't care":vs,"dont care":vs,nice:bc,fast:Ns},ri={repeat:_p,clamp:bp,mirror:Yp},Ci={nearest:Kl,linear:$c},_i=G({mipmap:lf,"nearest mipmap nearest":Rl,"linear mipmap nearest":Ms,"nearest mipmap linear":Hh,"linear mipmap linear":lf},Ci),Li={none:0,browser:Cf},Fi={uint8:Ll,rgba4:dp,rgb565:Ph,"rgb5 a1":Wp},hi={alpha:hc,luminance:mu,"luminance alpha":Mh,rgb:_u,rgba:jo,rgba4:ud,"rgb5 a1":of,rgb565:Eu},ki={};At.ext_srgb&&(hi.srgb=Ga,hi.srgba=mp),At.oes_texture_float&&(Fi.float32=Fi.float=kh),At.oes_texture_half_float&&(Fi.float16=Fi["half float"]=Hc),At.webgl_depth_texture&&(G(hi,{depth:Xp,"depth stencil":vp}),G(Fi,{uint16:uf,uint32:Pp,"depth stencil":wd})),At.webgl_compressed_texture_s3tc&&G(ki,{"rgb s3tc dxt1":gp,"rgba s3tc dxt1":sf,"rgba s3tc dxt3":ah,"rgba s3tc dxt5":wo}),At.webgl_compressed_texture_atc&&G(ki,{"rgb atc":fl,"rgba atc explicit alpha":pl,"rgba atc interpolated alpha":bh}),At.webgl_compressed_texture_pvrtc&&G(ki,{"rgb pvrtc 4bppv1":Xf,"rgb pvrtc 2bppv1":yp,"rgba pvrtc 4bppv1":Gh,"rgba pvrtc 2bppv1":Vu}),At.webgl_compressed_texture_etc1&&(ki["rgb etc1"]=Yf);var Wr=Array.prototype.slice.call(ze.getParameter(Sf));Object.keys(ki).forEach(function(qt){var pn=ki[qt];Wr.indexOf(pn)>=0&&(hi[qt]=pn)});var bn=Object.keys(hi);Gt.textureFormats=bn;var di=[];Object.keys(hi).forEach(function(qt){var pn=hi[qt];di[pn]=qt});var Gi=[];Object.keys(Fi).forEach(function(qt){var pn=Fi[qt];Gi[pn]=qt});var Yn=[];Object.keys(Ci).forEach(function(qt){var pn=Ci[qt];Yn[pn]=qt});var ia=[];Object.keys(_i).forEach(function(qt){var pn=_i[qt];ia[pn]=qt});var oi=[];Object.keys(ri).forEach(function(qt){var pn=ri[qt];oi[pn]=qt});var Di=bn.reduce(function(qt,pn){var en=hi[pn];return en===mu||en===hc||en===mu||en===Mh||en===Xp||en===vp||At.ext_srgb&&(en===Ga||en===mp)?qt[en]=en:en===of||pn.indexOf("rgba")>=0?qt[en]=jo:qt[en]=_u,qt},{});function qn(){this.internalformat=jo,this.format=jo,this.type=Ll,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Cf,this.width=0,this.height=0,this.channels=0}function Ai(qt,pn){qt.internalformat=pn.internalformat,qt.format=pn.format,qt.type=pn.type,qt.compressed=pn.compressed,qt.premultiplyAlpha=pn.premultiplyAlpha,qt.flipY=pn.flipY,qt.unpackAlignment=pn.unpackAlignment,qt.colorSpace=pn.colorSpace,qt.width=pn.width,qt.height=pn.height,qt.channels=pn.channels}function Oa(qt,pn){if(!(typeof pn!="object"||!pn)){if("premultiplyAlpha"in pn&&(be.type(pn.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),qt.premultiplyAlpha=pn.premultiplyAlpha),"flipY"in pn&&(be.type(pn.flipY,"boolean","invalid texture flip"),qt.flipY=pn.flipY),"alignment"in pn&&(be.oneOf(pn.alignment,[1,2,4,8],"invalid texture unpack alignment"),qt.unpackAlignment=pn.alignment),"colorSpace"in pn&&(be.parameter(pn.colorSpace,Li,"invalid colorSpace"),qt.colorSpace=Li[pn.colorSpace]),"type"in pn){var en=pn.type;be(At.oes_texture_float||!(en==="float"||en==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),be(At.oes_texture_half_float||!(en==="half float"||en==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),be(At.webgl_depth_texture||!(en==="uint16"||en==="uint32"||en==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),be.parameter(en,Fi,"invalid texture type"),qt.type=Fi[en]}var ua=qt.width,ls=qt.height,Nt=qt.channels,Et=!1;"shape"in pn?(be(Array.isArray(pn.shape)&&pn.shape.length>=2,"shape must be an array"),ua=pn.shape[0],ls=pn.shape[1],pn.shape.length===3&&(Nt=pn.shape[2],be(Nt>0&&Nt<=4,"invalid number of channels"),Et=!0),be(ua>=0&&ua<=Gt.maxTextureSize,"invalid width"),be(ls>=0&&ls<=Gt.maxTextureSize,"invalid height")):("radius"in pn&&(ua=ls=pn.radius,be(ua>=0&&ua<=Gt.maxTextureSize,"invalid radius")),"width"in pn&&(ua=pn.width,be(ua>=0&&ua<=Gt.maxTextureSize,"invalid width")),"height"in pn&&(ls=pn.height,be(ls>=0&&ls<=Gt.maxTextureSize,"invalid height")),"channels"in pn&&(Nt=pn.channels,be(Nt>0&&Nt<=4,"invalid number of channels"),Et=!0)),qt.width=ua|0,qt.height=ls|0,qt.channels=Nt|0;var gr=!1;if("format"in pn){var Vr=pn.format;be(At.webgl_depth_texture||!(Vr==="depth"||Vr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),be.parameter(Vr,hi,"invalid texture format");var $r=qt.internalformat=hi[Vr];qt.format=Di[$r],Vr in Fi&&("type"in pn||(qt.type=Fi[Vr])),Vr in ki&&(qt.compressed=!0),gr=!0}!Et&&gr?qt.channels=nl[qt.format]:Et&&!gr?qt.channels!==Cu[qt.format]&&(qt.format=qt.internalformat=Cu[qt.channels]):gr&&Et&&be(qt.channels===nl[qt.format],"number of channels inconsistent with specified format")}}function Ya(qt){ze.pixelStorei(Pe,qt.flipY),ze.pixelStorei(Ih,qt.premultiplyAlpha),ze.pixelStorei(cf,qt.colorSpace),ze.pixelStorei(xc,qt.unpackAlignment)}function Oi(){qn.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Qn(qt,pn){var en=null;if(Ql(pn)?en=pn:pn&&(be.type(pn,"object","invalid pixel data type"),Oa(qt,pn),"x"in pn&&(qt.xOffset=pn.x|0),"y"in pn&&(qt.yOffset=pn.y|0),Ql(pn.data)&&(en=pn.data)),be(!qt.compressed||en instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),pn.copy){be(!en,"can not specify copy and data field for the same texture");var ua=Dn.viewportWidth,ls=Dn.viewportHeight;qt.width=qt.width||ua-qt.xOffset,qt.height=qt.height||ls-qt.yOffset,qt.needsCopy=!0,be(qt.xOffset>=0&&qt.xOffset<ua&&qt.yOffset>=0&&qt.yOffset<ls&&qt.width>0&&qt.width<=ua&&qt.height>0&&qt.height<=ls,"copy texture read out of bounds")}else if(!en)qt.width=qt.width||1,qt.height=qt.height||1,qt.channels=qt.channels||4;else if(_e(en))qt.channels=qt.channels||4,qt.data=en,!("type"in pn)&&qt.type===Ll&&(qt.type=Yh(en));else if(ld(en))qt.channels=qt.channels||4,Mf(qt,en),qt.alignment=1,qt.needsFree=!0;else if(cl(en)){var Nt=en.data;!Array.isArray(Nt)&&qt.type===Ll&&(qt.type=Yh(Nt));var Et=en.shape,gr=en.stride,Vr,$r,wr,ur,Lr,Zt;Et.length===3?(wr=Et[2],Zt=gr[2]):(be(Et.length===2,"invalid ndarray pixel data, must be 2 or 3D"),wr=1,Zt=1),Vr=Et[0],$r=Et[1],ur=gr[0],Lr=gr[1],qt.alignment=1,qt.width=Vr,qt.height=$r,qt.channels=wr,qt.format=qt.internalformat=Cu[wr],qt.needsFree=!0,_l(qt,Nt,ur,Lr,Zt,en.offset)}else if(wh(en)||oh(en)||ff(en))wh(en)||oh(en)?qt.element=en:qt.element=en.canvas,qt.width=qt.element.width,qt.height=qt.element.height,qt.channels=4;else if(Tf(en))qt.element=en,qt.width=en.width,qt.height=en.height,qt.channels=4;else if(Jl(en))qt.element=en,qt.width=en.naturalWidth,qt.height=en.naturalHeight,qt.channels=4;else if(wc(en))qt.element=en,qt.width=en.videoWidth,qt.height=en.videoHeight,qt.channels=4;else if(xh(en)){var lr=qt.width||en[0].length,It=qt.height||en.length,Zr=qt.channels;Nu(en[0][0])?Zr=Zr||en[0][0].length:Zr=Zr||1;for(var Xr=_t.shape(en),Rn=1,dn=0;dn<Xr.length;++dn)Rn*=Xr[dn];var Pn=pf(qt,Rn);_t.flatten(en,Xr,"",Pn),Lc(qt,Pn),qt.alignment=1,qt.width=lr,qt.height=It,qt.channels=Zr,qt.format=qt.internalformat=Cu[Zr],qt.needsFree=!0}qt.type===kh?be(Gt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):qt.type===Hc&&be(Gt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Hn(qt,pn,en){var ua=qt.element,ls=qt.data,Nt=qt.internalformat,Et=qt.format,gr=qt.type,Vr=qt.width,$r=qt.height;Ya(qt),ua?ze.texImage2D(pn,en,Et,Et,gr,ua):qt.compressed?ze.compressedTexImage2D(pn,en,Nt,Vr,$r,0,ls):qt.needsCopy?(fn(),ze.copyTexImage2D(pn,en,Et,qt.xOffset,qt.yOffset,Vr,$r,0)):ze.texImage2D(pn,en,Et,Vr,$r,0,Et,gr,ls||null)}function mo(qt,pn,en,ua,ls){var Nt=qt.element,Et=qt.data,gr=qt.internalformat,Vr=qt.format,$r=qt.type,wr=qt.width,ur=qt.height;Ya(qt),Nt?ze.texSubImage2D(pn,ls,en,ua,Vr,$r,Nt):qt.compressed?ze.compressedTexSubImage2D(pn,ls,en,ua,gr,wr,ur,Et):qt.needsCopy?(fn(),ze.copyTexSubImage2D(pn,ls,en,ua,qt.xOffset,qt.yOffset,wr,ur)):ze.texSubImage2D(pn,ls,en,ua,wr,ur,Vr,$r,Et)}var so=[];function sa(){return so.pop()||new Oi}function Cs(qt){qt.needsFree&&Ze.freeType(qt.data),Oi.call(qt),so.push(qt)}function Vo(){qn.call(this),this.genMipmaps=!1,this.mipmapHint=vs,this.mipmask=0,this.images=Array(16)}function Go(qt,pn,en){var ua=qt.images[0]=sa();qt.mipmask=1,ua.width=qt.width=pn,ua.height=qt.height=en,ua.channels=qt.channels=4}function Fs(qt,pn){var en=null;if(Ql(pn))en=qt.images[0]=sa(),Ai(en,qt),Qn(en,pn),qt.mipmask=1;else if(Oa(qt,pn),Array.isArray(pn.mipmap))for(var ua=pn.mipmap,ls=0;ls<ua.length;++ls)en=qt.images[ls]=sa(),Ai(en,qt),en.width>>=ls,en.height>>=ls,Qn(en,ua[ls]),qt.mipmask|=1<<ls;else en=qt.images[0]=sa(),Ai(en,qt),Qn(en,pn),qt.mipmask=1;Ai(qt,qt.images[0]),qt.compressed&&(qt.internalformat===gp||qt.internalformat===sf||qt.internalformat===ah||qt.internalformat===wo)&&be(qt.width%4===0&&qt.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function xl(qt,pn){for(var en=qt.images,ua=0;ua<en.length;++ua){if(!en[ua])return;Hn(en[ua],pn,ua)}}var ks=[];function Ho(){var qt=ks.pop()||new Vo;qn.call(qt),qt.mipmask=0;for(var pn=0;pn<16;++pn)qt.images[pn]=null;return qt}function ss(qt){for(var pn=qt.images,en=0;en<pn.length;++en)pn[en]&&Cs(pn[en]),pn[en]=null;ks.push(qt)}function As(){this.minFilter=Kl,this.magFilter=Kl,this.wrapS=bp,this.wrapT=bp,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=vs}function Lo(qt,pn){if("min"in pn){var en=pn.min;be.parameter(en,_i),qt.minFilter=_i[en],Lh.indexOf(qt.minFilter)>=0&&!("faces"in pn)&&(qt.genMipmaps=!0)}if("mag"in pn){var ua=pn.mag;be.parameter(ua,Ci),qt.magFilter=Ci[ua]}var ls=qt.wrapS,Nt=qt.wrapT;if("wrap"in pn){var Et=pn.wrap;typeof Et=="string"?(be.parameter(Et,ri),ls=Nt=ri[Et]):Array.isArray(Et)&&(be.parameter(Et[0],ri),be.parameter(Et[1],ri),ls=ri[Et[0]],Nt=ri[Et[1]])}else{if("wrapS"in pn){var gr=pn.wrapS;be.parameter(gr,ri),ls=ri[gr]}if("wrapT"in pn){var Vr=pn.wrapT;be.parameter(Vr,ri),Nt=ri[Vr]}}if(qt.wrapS=ls,qt.wrapT=Nt,"anisotropic"in pn){var $r=pn.anisotropic;be(typeof $r=="number"&&$r>=1&&$r<=Gt.maxAnisotropic,"aniso samples must be between 1 and "),qt.anisotropic=pn.anisotropic}if("mipmap"in pn){var wr=!1;switch(typeof pn.mipmap){case"string":be.parameter(pn.mipmap,Zn,"invalid mipmap hint"),qt.mipmapHint=Zn[pn.mipmap],qt.genMipmaps=!0,wr=!0;break;case"boolean":wr=qt.genMipmaps=pn.mipmap;break;case"object":be(Array.isArray(pn.mipmap),"invalid mipmap type"),qt.genMipmaps=!1,wr=!0;break;default:be.raise("invalid mipmap type")}wr&&!("min"in pn)&&(qt.minFilter=Rl)}}function Pl(qt,pn){ze.texParameteri(pn,xp,qt.minFilter),ze.texParameteri(pn,kp,qt.magFilter),ze.texParameteri(pn,Xs,qt.wrapS),ze.texParameteri(pn,qf,qt.wrapT),At.ext_texture_filter_anisotropic&&ze.texParameteri(pn,fc,qt.anisotropic),qt.genMipmaps&&(ze.hint(Ef,qt.mipmapHint),ze.generateMipmap(pn))}var $l=0,bu={},Hu=Gt.maxTextureUnits,Du=Array(Hu).map(function(){return null});function Ro(qt){qn.call(this),this.mipmask=0,this.internalformat=jo,this.id=$l++,this.refCount=1,this.target=qt,this.texture=ze.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new As,_n.profile&&(this.stats={size:0})}function Kc(qt){ze.activeTexture(Af),ze.bindTexture(qt.target,qt.texture)}function lu(){var qt=Du[0];qt?ze.bindTexture(qt.target,qt.texture):ze.bindTexture(ko,null)}function Fa(qt){var pn=qt.texture;be(pn,"must not double destroy texture");var en=qt.unit,ua=qt.target;en>=0&&(ze.activeTexture(Af+en),ze.bindTexture(ua,null),Du[en]=null),ze.deleteTexture(pn),qt.texture=null,qt.params=null,qt.pixels=null,qt.refCount=0,delete bu[qt.id],ln.textureCount--}G(Ro.prototype,{bind:function(){var qt=this;qt.bindCount+=1;var pn=qt.unit;if(pn<0){for(var en=0;en<Hu;++en){var ua=Du[en];if(ua){if(ua.bindCount>0)continue;ua.unit=-1}Du[en]=qt,pn=en;break}pn>=Hu&&be.raise("insufficient number of texture units"),_n.profile&&ln.maxTextureUnits<pn+1&&(ln.maxTextureUnits=pn+1),qt.unit=pn,ze.activeTexture(Af+pn),ze.bindTexture(qt.target,qt.texture)}return pn},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Fa(this)}});function Ts(qt,pn){var en=new Ro(ko);bu[en.id]=en,ln.textureCount++;function ua(Et,gr){var Vr=en.texInfo;As.call(Vr);var $r=Ho();return typeof Et=="number"?typeof gr=="number"?Go($r,Et|0,gr|0):Go($r,Et|0,Et|0):Et?(be.type(Et,"object","invalid arguments to regl.texture"),Lo(Vr,Et),Fs($r,Et)):Go($r,1,1),Vr.genMipmaps&&($r.mipmask=($r.width<<1)-1),en.mipmask=$r.mipmask,Ai(en,$r),be.texture2D(Vr,$r,Gt),en.internalformat=$r.internalformat,ua.width=$r.width,ua.height=$r.height,Kc(en),xl($r,ko),Pl(Vr,ko),lu(),ss($r),_n.profile&&(en.stats.size=xo(en.internalformat,en.type,$r.width,$r.height,Vr.genMipmaps,!1)),ua.format=di[en.internalformat],ua.type=Gi[en.type],ua.mag=Yn[Vr.magFilter],ua.min=ia[Vr.minFilter],ua.wrapS=oi[Vr.wrapS],ua.wrapT=oi[Vr.wrapT],ua}function ls(Et,gr,Vr,$r){be(!!Et,"must specify image data");var wr=gr|0,ur=Vr|0,Lr=$r|0,Zt=sa();return Ai(Zt,en),Zt.width=0,Zt.height=0,Qn(Zt,Et),Zt.width=Zt.width||(en.width>>Lr)-wr,Zt.height=Zt.height||(en.height>>Lr)-ur,be(en.type===Zt.type&&en.format===Zt.format&&en.internalformat===Zt.internalformat,"incompatible format for texture.subimage"),be(wr>=0&&ur>=0&&wr+Zt.width<=en.width&&ur+Zt.height<=en.height,"texture.subimage write out of bounds"),be(en.mipmask&1<<Lr,"missing mipmap data"),be(Zt.data||Zt.element||Zt.needsCopy,"missing image data"),Kc(en),mo(Zt,ko,wr,ur,Lr),lu(),Cs(Zt),ua}function Nt(Et,gr){var Vr=Et|0,$r=gr|0||Vr;if(Vr===en.width&&$r===en.height)return ua;ua.width=en.width=Vr,ua.height=en.height=$r,Kc(en);for(var wr=0;en.mipmask>>wr;++wr){var ur=Vr>>wr,Lr=$r>>wr;if(!ur||!Lr)break;ze.texImage2D(ko,wr,en.format,ur,Lr,0,en.format,en.type,null)}return lu(),_n.profile&&(en.stats.size=xo(en.internalformat,en.type,Vr,$r,!1,!1)),ua}return ua(qt,pn),ua.subimage=ls,ua.resize=Nt,ua._reglType="texture2d",ua._texture=en,_n.profile&&(ua.stats=en.stats),ua.destroy=function(){en.decRef()},ua}function us(qt,pn,en,ua,ls,Nt){var Et=new Ro(rl);bu[Et.id]=Et,ln.cubeCount++;var gr=new Array(6);function Vr(ur,Lr,Zt,lr,It,Zr){var Xr,Rn=Et.texInfo;for(As.call(Rn),Xr=0;Xr<6;++Xr)gr[Xr]=Ho();if(typeof ur=="number"||!ur){var dn=ur|0||1;for(Xr=0;Xr<6;++Xr)Go(gr[Xr],dn,dn)}else if(typeof ur=="object")if(Lr)Fs(gr[0],ur),Fs(gr[1],Lr),Fs(gr[2],Zt),Fs(gr[3],lr),Fs(gr[4],It),Fs(gr[5],Zr);else if(Lo(Rn,ur),Oa(Et,ur),"faces"in ur){var Pn=ur.faces;for(be(Array.isArray(Pn)&&Pn.length===6,"cube faces must be a length 6 array"),Xr=0;Xr<6;++Xr)be(typeof Pn[Xr]=="object"&&!!Pn[Xr],"invalid input for cube map face"),Ai(gr[Xr],Et),Fs(gr[Xr],Pn[Xr])}else for(Xr=0;Xr<6;++Xr)Fs(gr[Xr],ur);else be.raise("invalid arguments to cube map");for(Ai(Et,gr[0]),Gt.npotTextureCube||be(Wf(Et.width)&&Wf(Et.height),"your browser does not support non power or two texture dimensions"),Rn.genMipmaps?Et.mipmask=(gr[0].width<<1)-1:Et.mipmask=gr[0].mipmask,be.textureCube(Et,Rn,gr,Gt),Et.internalformat=gr[0].internalformat,Vr.width=gr[0].width,Vr.height=gr[0].height,Kc(Et),Xr=0;Xr<6;++Xr)xl(gr[Xr],pp+Xr);for(Pl(Rn,rl),lu(),_n.profile&&(Et.stats.size=xo(Et.internalformat,Et.type,Vr.width,Vr.height,Rn.genMipmaps,!0)),Vr.format=di[Et.internalformat],Vr.type=Gi[Et.type],Vr.mag=Yn[Rn.magFilter],Vr.min=ia[Rn.minFilter],Vr.wrapS=oi[Rn.wrapS],Vr.wrapT=oi[Rn.wrapT],Xr=0;Xr<6;++Xr)ss(gr[Xr]);return Vr}function $r(ur,Lr,Zt,lr,It){be(!!Lr,"must specify image data"),be(typeof ur=="number"&&ur===(ur|0)&&ur>=0&&ur<6,"invalid face");var Zr=Zt|0,Xr=lr|0,Rn=It|0,dn=sa();return Ai(dn,Et),dn.width=0,dn.height=0,Qn(dn,Lr),dn.width=dn.width||(Et.width>>Rn)-Zr,dn.height=dn.height||(Et.height>>Rn)-Xr,be(Et.type===dn.type&&Et.format===dn.format&&Et.internalformat===dn.internalformat,"incompatible format for texture.subimage"),be(Zr>=0&&Xr>=0&&Zr+dn.width<=Et.width&&Xr+dn.height<=Et.height,"texture.subimage write out of bounds"),be(Et.mipmask&1<<Rn,"missing mipmap data"),be(dn.data||dn.element||dn.needsCopy,"missing image data"),Kc(Et),mo(dn,pp+ur,Zr,Xr,Rn),lu(),Cs(dn),Vr}function wr(ur){var Lr=ur|0;if(Lr!==Et.width){Vr.width=Et.width=Lr,Vr.height=Et.height=Lr,Kc(Et);for(var Zt=0;Zt<6;++Zt)for(var lr=0;Et.mipmask>>lr;++lr)ze.texImage2D(pp+Zt,lr,Et.format,Lr>>lr,Lr>>lr,0,Et.format,Et.type,null);return lu(),_n.profile&&(Et.stats.size=xo(Et.internalformat,Et.type,Vr.width,Vr.height,!1,!0)),Vr}}return Vr(qt,pn,en,ua,ls,Nt),Vr.subimage=$r,Vr.resize=wr,Vr._reglType="textureCube",Vr._texture=Et,_n.profile&&(Vr.stats=Et.stats),Vr.destroy=function(){Et.decRef()},Vr}function Iu(){for(var qt=0;qt<Hu;++qt)ze.activeTexture(Af+qt),ze.bindTexture(ko,null),Du[qt]=null;iu(bu).forEach(Fa),ln.cubeCount=0,ln.textureCount=0}_n.profile&&(ln.getTotalTextureSize=function(){var qt=0;return Object.keys(bu).forEach(function(pn){qt+=bu[pn].stats.size}),qt});function zh(){for(var qt=0;qt<Hu;++qt){var pn=Du[qt];pn&&(pn.bindCount=0,pn.unit=-1,Du[qt]=null)}iu(bu).forEach(function(en){en.texture=ze.createTexture(),ze.bindTexture(en.target,en.texture);for(var ua=0;ua<32;++ua)if(en.mipmask&1<<ua)if(en.target===ko)ze.texImage2D(ko,ua,en.internalformat,en.width>>ua,en.height>>ua,0,en.internalformat,en.type,null);else for(var ls=0;ls<6;++ls)ze.texImage2D(pp+ls,ua,en.internalformat,en.width>>ua,en.height>>ua,0,en.internalformat,en.type,null);Pl(en.texInfo,en.target)})}function rp(){for(var qt=0;qt<Hu;++qt){var pn=Du[qt];pn&&(pn.bindCount=0,pn.unit=-1,Du[qt]=null),ze.activeTexture(Af+qt),ze.bindTexture(ko,null),ze.bindTexture(rl,null)}}return{create2D:Ts,createCube:us,clear:Iu,getTexture:function(qt){return null},restore:zh,refresh:rp}}var Po=36161,dl=32854,Kf=32855,Pf=36194,Sc=33189,Ec=36168,Al=34041,aa=35907,ta=34836,Da=34842,ba=34843,bl=[];bl[dl]=2,bl[Kf]=2,bl[Pf]=2,bl[Sc]=2,bl[Ec]=1,bl[Al]=4,bl[aa]=4,bl[ta]=16,bl[Da]=8,bl[ba]=6;function jl(ze,At,Gt){return bl[ze]*At*Gt}var df=function(ze,At,Gt,fn,Dn){var ln={rgba4:dl,rgb565:Pf,"rgb5 a1":Kf,depth:Sc,stencil:Ec,"depth stencil":Al};At.ext_srgb&&(ln.srgba=aa),At.ext_color_buffer_half_float&&(ln.rgba16f=Da,ln.rgb16f=ba),At.webgl_color_buffer_float&&(ln.rgba32f=ta);var _n=[];Object.keys(ln).forEach(function(hi){var ki=ln[hi];_n[ki]=hi});var Zn=0,ri={};function Ci(hi){this.id=Zn++,this.refCount=1,this.renderbuffer=hi,this.format=dl,this.width=0,this.height=0,Dn.profile&&(this.stats={size:0})}Ci.prototype.decRef=function(){--this.refCount<=0&&_i(this)};function _i(hi){var ki=hi.renderbuffer;be(ki,"must not double destroy renderbuffer"),ze.bindRenderbuffer(Po,null),ze.deleteRenderbuffer(ki),hi.renderbuffer=null,hi.refCount=0,delete ri[hi.id],fn.renderbufferCount--}function Li(hi,ki){var Wr=new Ci(ze.createRenderbuffer());ri[Wr.id]=Wr,fn.renderbufferCount++;function bn(Gi,Yn){var ia=0,oi=0,Di=dl;if(typeof Gi=="object"&&Gi){var qn=Gi;if("shape"in qn){var Ai=qn.shape;be(Array.isArray(Ai)&&Ai.length>=2,"invalid renderbuffer shape"),ia=Ai[0]|0,oi=Ai[1]|0}else"radius"in qn&&(ia=oi=qn.radius|0),"width"in qn&&(ia=qn.width|0),"height"in qn&&(oi=qn.height|0);"format"in qn&&(be.parameter(qn.format,ln,"invalid renderbuffer format"),Di=ln[qn.format])}else typeof Gi=="number"?(ia=Gi|0,typeof Yn=="number"?oi=Yn|0:oi=ia):Gi?be.raise("invalid arguments to renderbuffer constructor"):ia=oi=1;if(be(ia>0&&oi>0&&ia<=Gt.maxRenderbufferSize&&oi<=Gt.maxRenderbufferSize,"invalid renderbuffer size"),!(ia===Wr.width&&oi===Wr.height&&Di===Wr.format))return bn.width=Wr.width=ia,bn.height=Wr.height=oi,Wr.format=Di,ze.bindRenderbuffer(Po,Wr.renderbuffer),ze.renderbufferStorage(Po,Di,ia,oi),be(ze.getError()===0,"invalid render buffer format"),Dn.profile&&(Wr.stats.size=jl(Wr.format,Wr.width,Wr.height)),bn.format=_n[Wr.format],bn}function di(Gi,Yn){var ia=Gi|0,oi=Yn|0||ia;return ia===Wr.width&&oi===Wr.height||(be(ia>0&&oi>0&&ia<=Gt.maxRenderbufferSize&&oi<=Gt.maxRenderbufferSize,"invalid renderbuffer size"),bn.width=Wr.width=ia,bn.height=Wr.height=oi,ze.bindRenderbuffer(Po,Wr.renderbuffer),ze.renderbufferStorage(Po,Wr.format,ia,oi),be(ze.getError()===0,"invalid render buffer format"),Dn.profile&&(Wr.stats.size=jl(Wr.format,Wr.width,Wr.height))),bn}return bn(hi,ki),bn.resize=di,bn._reglType="renderbuffer",bn._renderbuffer=Wr,Dn.profile&&(bn.stats=Wr.stats),bn.destroy=function(){Wr.decRef()},bn}Dn.profile&&(fn.getTotalRenderbufferSize=function(){var hi=0;return Object.keys(ri).forEach(function(ki){hi+=ri[ki].stats.size}),hi});function Fi(){iu(ri).forEach(function(hi){hi.renderbuffer=ze.createRenderbuffer(),ze.bindRenderbuffer(Po,hi.renderbuffer),ze.renderbufferStorage(Po,hi.format,hi.width,hi.height)}),ze.bindRenderbuffer(Po,null)}return{create:Li,clear:function(){iu(ri).forEach(_i)},restore:Fi}},Pu=36160,Rh=36161,ho=3553,vl=34069,kf=36064,Zu=36096,il=36128,sh=33306,ec=36053,If=36054,Rc=36055,Cc=36057,Lf=36061,Dh=36193,wp=5121,Jf=5126,mr=6407,D=6408,h=6402,x=[mr,D],O=[];O[D]=4,O[mr]=3;var Z=[];Z[wp]=1,Z[Jf]=4,Z[Dh]=2;var H=32854,ae=32855,ue=36194,ge=33189,Le=36168,m=34041,w=35907,_=34836,T=34842,N=34843,$=[H,ae,ue,w,T,N,_],X={};X[ec]="complete",X[If]="incomplete attachment",X[Cc]="incomplete dimensions",X[Rc]="incomplete, missing attachment",X[Lf]="unsupported";function oe(ze,At,Gt,fn,Dn,ln){var _n={cur:null,next:null,dirty:!1,setFBO:null},Zn=["rgba"],ri=["rgba4","rgb565","rgb5 a1"];At.ext_srgb&&ri.push("srgba"),At.ext_color_buffer_half_float&&ri.push("rgba16f","rgb16f"),At.webgl_color_buffer_float&&ri.push("rgba32f");var Ci=["uint8"];At.oes_texture_half_float&&Ci.push("half float","float16"),At.oes_texture_float&&Ci.push("float","float32");function _i(Oi,Qn,Hn){this.target=Oi,this.texture=Qn,this.renderbuffer=Hn;var mo=0,so=0;Qn?(mo=Qn.width,so=Qn.height):Hn&&(mo=Hn.width,so=Hn.height),this.width=mo,this.height=so}function Li(Oi){Oi&&(Oi.texture&&Oi.texture._texture.decRef(),Oi.renderbuffer&&Oi.renderbuffer._renderbuffer.decRef())}function Fi(Oi,Qn,Hn){if(Oi)if(Oi.texture){var mo=Oi.texture._texture,so=Math.max(1,mo.width),sa=Math.max(1,mo.height);be(so===Qn&&sa===Hn,"inconsistent width/height for supplied texture"),mo.refCount+=1}else{var Cs=Oi.renderbuffer._renderbuffer;be(Cs.width===Qn&&Cs.height===Hn,"inconsistent width/height for renderbuffer"),Cs.refCount+=1}}function hi(Oi,Qn){Qn&&(Qn.texture?ze.framebufferTexture2D(Pu,Oi,Qn.target,Qn.texture._texture.texture,0):ze.framebufferRenderbuffer(Pu,Oi,Rh,Qn.renderbuffer._renderbuffer.renderbuffer))}function ki(Oi){var Qn=ho,Hn=null,mo=null,so=Oi;typeof Oi=="object"&&(so=Oi.data,"target"in Oi&&(Qn=Oi.target|0)),be.type(so,"function","invalid attachment data");var sa=so._reglType;return sa==="texture2d"?(Hn=so,be(Qn===ho)):sa==="textureCube"?(Hn=so,be(Qn>=vl&&Qn<vl+6,"invalid cube map target")):sa==="renderbuffer"?(mo=so,Qn=Rh):be.raise("invalid regl object for attachment"),new _i(Qn,Hn,mo)}function Wr(Oi,Qn,Hn,mo,so){if(Hn){var sa=fn.create2D({width:Oi,height:Qn,format:mo,type:so});return sa._texture.refCount=0,new _i(ho,sa,null)}else{var Cs=Dn.create({width:Oi,height:Qn,format:mo});return Cs._renderbuffer.refCount=0,new _i(Rh,null,Cs)}}function bn(Oi){return Oi&&(Oi.texture||Oi.renderbuffer)}function di(Oi,Qn,Hn){Oi&&(Oi.texture?Oi.texture.resize(Qn,Hn):Oi.renderbuffer&&Oi.renderbuffer.resize(Qn,Hn),Oi.width=Qn,Oi.height=Hn)}var Gi=0,Yn={};function ia(){this.id=Gi++,Yn[this.id]=this,this.framebuffer=ze.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function oi(Oi){Oi.colorAttachments.forEach(Li),Li(Oi.depthAttachment),Li(Oi.stencilAttachment),Li(Oi.depthStencilAttachment)}function Di(Oi){var Qn=Oi.framebuffer;be(Qn,"must not double destroy framebuffer"),ze.deleteFramebuffer(Qn),Oi.framebuffer=null,ln.framebufferCount--,delete Yn[Oi.id]}function qn(Oi){var Qn;ze.bindFramebuffer(Pu,Oi.framebuffer);var Hn=Oi.colorAttachments;for(Qn=0;Qn<Hn.length;++Qn)hi(kf+Qn,Hn[Qn]);for(Qn=Hn.length;Qn<Gt.maxColorAttachments;++Qn)ze.framebufferTexture2D(Pu,kf+Qn,ho,null,0);ze.framebufferTexture2D(Pu,sh,ho,null,0),ze.framebufferTexture2D(Pu,Zu,ho,null,0),ze.framebufferTexture2D(Pu,il,ho,null,0),hi(Zu,Oi.depthAttachment),hi(il,Oi.stencilAttachment),hi(sh,Oi.depthStencilAttachment);var mo=ze.checkFramebufferStatus(Pu);!ze.isContextLost()&&mo!==ec&&be.raise("framebuffer configuration not supported, status = "+X[mo]),ze.bindFramebuffer(Pu,_n.next?_n.next.framebuffer:null),_n.cur=_n.next,ze.getError()}function Ai(Oi,Qn){var Hn=new ia;ln.framebufferCount++;function mo(sa,Cs){var Vo;be(_n.next!==Hn,"can not update framebuffer which is currently in use");var Go=0,Fs=0,xl=!0,ks=!0,Ho=null,ss=!0,As="rgba",Lo="uint8",Pl=1,$l=null,bu=null,Hu=null,Du=!1;if(typeof sa=="number")Go=sa|0,Fs=Cs|0||Go;else if(!sa)Go=Fs=1;else{be.type(sa,"object","invalid arguments for framebuffer");var Ro=sa;if("shape"in Ro){var Kc=Ro.shape;be(Array.isArray(Kc)&&Kc.length>=2,"invalid shape for framebuffer"),Go=Kc[0],Fs=Kc[1]}else"radius"in Ro&&(Go=Fs=Ro.radius),"width"in Ro&&(Go=Ro.width),"height"in Ro&&(Fs=Ro.height);("color"in Ro||"colors"in Ro)&&(Ho=Ro.color||Ro.colors,Array.isArray(Ho)&&be(Ho.length===1||At.webgl_draw_buffers,"multiple render targets not supported")),Ho||("colorCount"in Ro&&(Pl=Ro.colorCount|0,be(Pl>0,"invalid color buffer count")),"colorTexture"in Ro&&(ss=!!Ro.colorTexture,As="rgba4"),"colorType"in Ro&&(Lo=Ro.colorType,ss?(be(At.oes_texture_float||!(Lo==="float"||Lo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),be(At.oes_texture_half_float||!(Lo==="half float"||Lo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Lo==="half float"||Lo==="float16"?(be(At.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),As="rgba16f"):(Lo==="float"||Lo==="float32")&&(be(At.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),As="rgba32f"),be.oneOf(Lo,Ci,"invalid color type")),"colorFormat"in Ro&&(As=Ro.colorFormat,Zn.indexOf(As)>=0?ss=!0:ri.indexOf(As)>=0?ss=!1:ss?be.oneOf(Ro.colorFormat,Zn,"invalid color format for texture"):be.oneOf(Ro.colorFormat,ri,"invalid color format for renderbuffer"))),("depthTexture"in Ro||"depthStencilTexture"in Ro)&&(Du=!!(Ro.depthTexture||Ro.depthStencilTexture),be(!Du||At.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ro&&(typeof Ro.depth=="boolean"?xl=Ro.depth:($l=Ro.depth,ks=!1)),"stencil"in Ro&&(typeof Ro.stencil=="boolean"?ks=Ro.stencil:(bu=Ro.stencil,xl=!1)),"depthStencil"in Ro&&(typeof Ro.depthStencil=="boolean"?xl=ks=Ro.depthStencil:(Hu=Ro.depthStencil,xl=!1,ks=!1))}var lu=null,Fa=null,Ts=null,us=null;if(Array.isArray(Ho))lu=Ho.map(ki);else if(Ho)lu=[ki(Ho)];else for(lu=new Array(Pl),Vo=0;Vo<Pl;++Vo)lu[Vo]=Wr(Go,Fs,ss,As,Lo);be(At.webgl_draw_buffers||lu.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),be(lu.length<=Gt.maxColorAttachments,"too many color attachments, not supported"),Go=Go||lu[0].width,Fs=Fs||lu[0].height,$l?Fa=ki($l):xl&&!ks&&(Fa=Wr(Go,Fs,Du,"depth","uint32")),bu?Ts=ki(bu):ks&&!xl&&(Ts=Wr(Go,Fs,!1,"stencil","uint8")),Hu?us=ki(Hu):!$l&&!bu&&ks&&xl&&(us=Wr(Go,Fs,Du,"depth stencil","depth stencil")),be(!!$l+!!bu+!!Hu<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Iu=null;for(Vo=0;Vo<lu.length;++Vo)if(Fi(lu[Vo],Go,Fs),be(!lu[Vo]||lu[Vo].texture&&x.indexOf(lu[Vo].texture._texture.format)>=0||lu[Vo].renderbuffer&&$.indexOf(lu[Vo].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Vo+" is invalid"),lu[Vo]&&lu[Vo].texture){var zh=O[lu[Vo].texture._texture.format]*Z[lu[Vo].texture._texture.type];Iu===null?Iu=zh:be(Iu===zh,"all color attachments much have the same number of bits per pixel.")}return Fi(Fa,Go,Fs),be(!Fa||Fa.texture&&Fa.texture._texture.format===h||Fa.renderbuffer&&Fa.renderbuffer._renderbuffer.format===ge,"invalid depth attachment for framebuffer object"),Fi(Ts,Go,Fs),be(!Ts||Ts.renderbuffer&&Ts.renderbuffer._renderbuffer.format===Le,"invalid stencil attachment for framebuffer object"),Fi(us,Go,Fs),be(!us||us.texture&&us.texture._texture.format===m||us.renderbuffer&&us.renderbuffer._renderbuffer.format===m,"invalid depth-stencil attachment for framebuffer object"),oi(Hn),Hn.width=Go,Hn.height=Fs,Hn.colorAttachments=lu,Hn.depthAttachment=Fa,Hn.stencilAttachment=Ts,Hn.depthStencilAttachment=us,mo.color=lu.map(bn),mo.depth=bn(Fa),mo.stencil=bn(Ts),mo.depthStencil=bn(us),mo.width=Hn.width,mo.height=Hn.height,qn(Hn),mo}function so(sa,Cs){be(_n.next!==Hn,"can not resize a framebuffer which is currently in use");var Vo=Math.max(sa|0,1),Go=Math.max(Cs|0||Vo,1);if(Vo===Hn.width&&Go===Hn.height)return mo;for(var Fs=Hn.colorAttachments,xl=0;xl<Fs.length;++xl)di(Fs[xl],Vo,Go);return di(Hn.depthAttachment,Vo,Go),di(Hn.stencilAttachment,Vo,Go),di(Hn.depthStencilAttachment,Vo,Go),Hn.width=mo.width=Vo,Hn.height=mo.height=Go,qn(Hn),mo}return mo(Oi,Qn),G(mo,{resize:so,_reglType:"framebuffer",_framebuffer:Hn,destroy:function(){Di(Hn),oi(Hn)},use:function(sa){_n.setFBO({framebuffer:mo},sa)}})}function Oa(Oi){var Qn=Array(6);function Hn(so){var sa;be(Qn.indexOf(_n.next)<0,"can not update framebuffer which is currently in use");var Cs={color:null},Vo=0,Go=null,Fs="rgba",xl="uint8",ks=1;if(typeof so=="number")Vo=so|0;else if(!so)Vo=1;else{be.type(so,"object","invalid arguments for framebuffer");var Ho=so;if("shape"in Ho){var ss=Ho.shape;be(Array.isArray(ss)&&ss.length>=2,"invalid shape for framebuffer"),be(ss[0]===ss[1],"cube framebuffer must be square"),Vo=ss[0]}else"radius"in Ho&&(Vo=Ho.radius|0),"width"in Ho?(Vo=Ho.width|0,"height"in Ho&&be(Ho.height===Vo,"must be square")):"height"in Ho&&(Vo=Ho.height|0);("color"in Ho||"colors"in Ho)&&(Go=Ho.color||Ho.colors,Array.isArray(Go)&&be(Go.length===1||At.webgl_draw_buffers,"multiple render targets not supported")),Go||("colorCount"in Ho&&(ks=Ho.colorCount|0,be(ks>0,"invalid color buffer count")),"colorType"in Ho&&(be.oneOf(Ho.colorType,Ci,"invalid color type"),xl=Ho.colorType),"colorFormat"in Ho&&(Fs=Ho.colorFormat,be.oneOf(Ho.colorFormat,Zn,"invalid color format for texture"))),"depth"in Ho&&(Cs.depth=Ho.depth),"stencil"in Ho&&(Cs.stencil=Ho.stencil),"depthStencil"in Ho&&(Cs.depthStencil=Ho.depthStencil)}var As;if(Go)if(Array.isArray(Go))for(As=[],sa=0;sa<Go.length;++sa)As[sa]=Go[sa];else As=[Go];else{As=Array(ks);var Lo={radius:Vo,format:Fs,type:xl};for(sa=0;sa<ks;++sa)As[sa]=fn.createCube(Lo)}for(Cs.color=Array(As.length),sa=0;sa<As.length;++sa){var Pl=As[sa];be(typeof Pl=="function"&&Pl._reglType==="textureCube","invalid cube map"),Vo=Vo||Pl.width,be(Pl.width===Vo&&Pl.height===Vo,"invalid cube map shape"),Cs.color[sa]={target:vl,data:As[sa]}}for(sa=0;sa<6;++sa){for(var $l=0;$l<As.length;++$l)Cs.color[$l].target=vl+sa;sa>0&&(Cs.depth=Qn[0].depth,Cs.stencil=Qn[0].stencil,Cs.depthStencil=Qn[0].depthStencil),Qn[sa]?Qn[sa](Cs):Qn[sa]=Ai(Cs)}return G(Hn,{width:Vo,height:Vo,color:As})}function mo(so){var sa,Cs=so|0;if(be(Cs>0&&Cs<=Gt.maxCubeMapSize,"invalid radius for cube fbo"),Cs===Hn.width)return Hn;var Vo=Hn.color;for(sa=0;sa<Vo.length;++sa)Vo[sa].resize(Cs);for(sa=0;sa<6;++sa)Qn[sa].resize(Cs);return Hn.width=Hn.height=Cs,Hn}return Hn(Oi),G(Hn,{faces:Qn,resize:mo,_reglType:"framebufferCube",destroy:function(){Qn.forEach(function(so){so.destroy()})}})}function Ya(){_n.cur=null,_n.next=null,_n.dirty=!0,iu(Yn).forEach(function(Oi){Oi.framebuffer=ze.createFramebuffer(),qn(Oi)})}return G(_n,{getFramebuffer:function(Oi){if(typeof Oi=="function"&&Oi._reglType==="framebuffer"){var Qn=Oi._framebuffer;if(Qn instanceof ia)return Qn}return null},create:Ai,createCube:Oa,clear:function(){iu(Yn).forEach(Di)},restore:Ya})}var xe=5126,ye=34962;function De(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=xe,this.offset=0,this.stride=0,this.divisor=0}function He(ze,At,Gt,fn,Dn){for(var ln=Gt.maxAttributes,_n=new Array(ln),Zn=0;Zn<ln;++Zn)_n[Zn]=new De;var ri=0,Ci={},_i={Record:De,scope:{},state:_n,currentVAO:null,targetVAO:null,restore:Fi()?Yn:function(){},createVAO:ia,getVAO:ki,destroyBuffer:Li,setVAO:Fi()?Wr:bn,clear:Fi()?di:function(){}};function Li(oi){for(var Di=0;Di<_n.length;++Di){var qn=_n[Di];qn.buffer===oi&&(ze.disableVertexAttribArray(Di),qn.buffer=null)}}function Fi(){return At.oes_vertex_array_object}function hi(){return At.angle_instanced_arrays}function ki(oi){return typeof oi=="function"&&oi._vao?oi._vao:null}function Wr(oi){if(oi!==_i.currentVAO){var Di=Fi();oi?Di.bindVertexArrayOES(oi.vao):Di.bindVertexArrayOES(null),_i.currentVAO=oi}}function bn(oi){if(oi!==_i.currentVAO){if(oi)oi.bindAttrs();else for(var Di=hi(),qn=0;qn<_n.length;++qn){var Ai=_n[qn];Ai.buffer?(ze.enableVertexAttribArray(qn),ze.vertexAttribPointer(qn,Ai.size,Ai.type,Ai.normalized,Ai.stride,Ai.offfset),Di&&Ai.divisor&&Di.vertexAttribDivisorANGLE(qn,Ai.divisor)):(ze.disableVertexAttribArray(qn),ze.vertexAttrib4f(qn,Ai.x,Ai.y,Ai.z,Ai.w))}_i.currentVAO=oi}}function di(){iu(Ci).forEach(function(oi){oi.destroy()})}function Gi(){this.id=++ri,this.attributes=[];var oi=Fi();oi?this.vao=oi.createVertexArrayOES():this.vao=null,Ci[this.id]=this,this.buffers=[]}Gi.prototype.bindAttrs=function(){for(var oi=hi(),Di=this.attributes,qn=0;qn<Di.length;++qn){var Ai=Di[qn];Ai.buffer?(ze.enableVertexAttribArray(qn),ze.bindBuffer(ye,Ai.buffer.buffer),ze.vertexAttribPointer(qn,Ai.size,Ai.type,Ai.normalized,Ai.stride,Ai.offset),oi&&Ai.divisor&&oi.vertexAttribDivisorANGLE(qn,Ai.divisor)):(ze.disableVertexAttribArray(qn),ze.vertexAttrib4f(qn,Ai.x,Ai.y,Ai.z,Ai.w))}for(var Oa=Di.length;Oa<ln;++Oa)ze.disableVertexAttribArray(Oa)},Gi.prototype.refresh=function(){var oi=Fi();oi&&(oi.bindVertexArrayOES(this.vao),this.bindAttrs(),_i.currentVAO=this)},Gi.prototype.destroy=function(){if(this.vao){var oi=Fi();this===_i.currentVAO&&(_i.currentVAO=null,oi.bindVertexArrayOES(null)),oi.deleteVertexArrayOES(this.vao),this.vao=null}Ci[this.id]&&(delete Ci[this.id],fn.vaoCount-=1)};function Yn(){var oi=Fi();oi&&iu(Ci).forEach(function(Di){Di.refresh()})}function ia(oi){var Di=new Gi;fn.vaoCount+=1;function qn(Ai){be(Array.isArray(Ai),"arguments to vertex array constructor must be an array"),be(Ai.length<ln,"too many attributes"),be(Ai.length>0,"must specify at least one attribute");var Oa={},Ya=Di.attributes;Ya.length=Ai.length;for(var Oi=0;Oi<Ai.length;++Oi){var Qn=Ai[Oi],Hn=Ya[Oi]=new De,mo=Qn.data||Qn;if(Array.isArray(mo)||_e(mo)||cl(mo)){var so;Di.buffers[Oi]&&(so=Di.buffers[Oi],_e(mo)&&so._buffer.byteLength>=mo.byteLength?so.subdata(mo):(so.destroy(),Di.buffers[Oi]=null)),Di.buffers[Oi]||(so=Di.buffers[Oi]=Dn.create(Qn,ye,!1,!0)),Hn.buffer=Dn.getBuffer(so),Hn.size=Hn.buffer.dimension|0,Hn.normalized=!1,Hn.type=Hn.buffer.dtype,Hn.offset=0,Hn.stride=0,Hn.divisor=0,Hn.state=1,Oa[Oi]=1}else Dn.getBuffer(Qn)?(Hn.buffer=Dn.getBuffer(Qn),Hn.size=Hn.buffer.dimension|0,Hn.normalized=!1,Hn.type=Hn.buffer.dtype,Hn.offset=0,Hn.stride=0,Hn.divisor=0,Hn.state=1):Dn.getBuffer(Qn.buffer)?(Hn.buffer=Dn.getBuffer(Qn.buffer),Hn.size=(+Qn.size||Hn.buffer.dimension)|0,Hn.normalized=!!Qn.normalized||!1,"type"in Qn?(be.parameter(Qn.type,os,"invalid buffer type"),Hn.type=os[Qn.type]):Hn.type=Hn.buffer.dtype,Hn.offset=(Qn.offset||0)|0,Hn.stride=(Qn.stride||0)|0,Hn.divisor=(Qn.divisor||0)|0,Hn.state=1,be(Hn.size>=1&&Hn.size<=4,"size must be between 1 and 4"),be(Hn.offset>=0,"invalid offset"),be(Hn.stride>=0&&Hn.stride<=255,"stride must be between 0 and 255"),be(Hn.divisor>=0,"divisor must be positive"),be(!Hn.divisor||!!At.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Qn?(be(Oi>0,"first attribute must not be a constant"),Hn.x=+Qn.x||0,Hn.y=+Qn.y||0,Hn.z=+Qn.z||0,Hn.w=+Qn.w||0,Hn.state=2):be(!1,"invalid attribute spec for location "+Oi)}for(var sa=0;sa<Di.buffers.length;++sa)!Oa[sa]&&Di.buffers[sa]&&(Di.buffers[sa].destroy(),Di.buffers[sa]=null);return Di.refresh(),qn}return qn.destroy=function(){for(var Ai=0;Ai<Di.buffers.length;++Ai)Di.buffers[Ai]&&Di.buffers[Ai].destroy();Di.buffers.length=0,Di.destroy()},qn._vao=Di,qn._reglType="vao",qn(oi)}return _i}var $e=35632,ft=35633,pt=35718,wt=35721;function dt(ze,At,Gt,fn){var Dn={},ln={};function _n(Wr,bn,di,Gi){this.name=Wr,this.id=bn,this.location=di,this.info=Gi}function Zn(Wr,bn){for(var di=0;di<Wr.length;++di)if(Wr[di].id===bn.id){Wr[di].location=bn.location;return}Wr.push(bn)}function ri(Wr,bn,di){var Gi=Wr===$e?Dn:ln,Yn=Gi[bn];if(!Yn){var ia=At.str(bn);Yn=ze.createShader(Wr),ze.shaderSource(Yn,ia),ze.compileShader(Yn),be.shaderError(ze,Yn,ia,Wr,di),Gi[bn]=Yn}return Yn}var Ci={},_i=[],Li=0;function Fi(Wr,bn){this.id=Li++,this.fragId=Wr,this.vertId=bn,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,fn.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function hi(Wr,bn,di){var Gi,Yn,ia=ri($e,Wr.fragId),oi=ri(ft,Wr.vertId),Di=Wr.program=ze.createProgram();if(ze.attachShader(Di,ia),ze.attachShader(Di,oi),di)for(Gi=0;Gi<di.length;++Gi){var qn=di[Gi];ze.bindAttribLocation(Di,qn[0],qn[1])}ze.linkProgram(Di),be.linkError(ze,Di,At.str(Wr.fragId),At.str(Wr.vertId),bn);var Ai=ze.getProgramParameter(Di,pt);fn.profile&&(Wr.stats.uniformsCount=Ai);var Oa=Wr.uniforms;for(Gi=0;Gi<Ai;++Gi)if(Yn=ze.getActiveUniform(Di,Gi),Yn)if(Yn.size>1)for(var Ya=0;Ya<Yn.size;++Ya){var Oi=Yn.name.replace("[0]","["+Ya+"]");Zn(Oa,new _n(Oi,At.id(Oi),ze.getUniformLocation(Di,Oi),Yn))}else Zn(Oa,new _n(Yn.name,At.id(Yn.name),ze.getUniformLocation(Di,Yn.name),Yn));var Qn=ze.getProgramParameter(Di,wt);fn.profile&&(Wr.stats.attributesCount=Qn);var Hn=Wr.attributes;for(Gi=0;Gi<Qn;++Gi)Yn=ze.getActiveAttrib(Di,Gi),Yn&&Zn(Hn,new _n(Yn.name,At.id(Yn.name),ze.getAttribLocation(Di,Yn.name),Yn))}fn.profile&&(Gt.getMaxUniformsCount=function(){var Wr=0;return _i.forEach(function(bn){bn.stats.uniformsCount>Wr&&(Wr=bn.stats.uniformsCount)}),Wr},Gt.getMaxAttributesCount=function(){var Wr=0;return _i.forEach(function(bn){bn.stats.attributesCount>Wr&&(Wr=bn.stats.attributesCount)}),Wr});function ki(){Dn={},ln={};for(var Wr=0;Wr<_i.length;++Wr)hi(_i[Wr],null,_i[Wr].attributes.map(function(bn){return[bn.location,bn.name]}))}return{clear:function(){var Wr=ze.deleteShader.bind(ze);iu(Dn).forEach(Wr),Dn={},iu(ln).forEach(Wr),ln={},_i.forEach(function(bn){ze.deleteProgram(bn.program)}),_i.length=0,Ci={},Gt.shaderCount=0},program:function(Wr,bn,di,Gi){be.command(Wr>=0,"missing vertex shader",di),be.command(bn>=0,"missing fragment shader",di);var Yn=Ci[bn];Yn||(Yn=Ci[bn]={});var ia=Yn[Wr];if(ia&&(ia.refCount++,!Gi))return ia;var oi=new Fi(bn,Wr);return Gt.shaderCount++,hi(oi,di,Gi),ia||(Yn[Wr]=oi),_i.push(oi),G(oi,{destroy:function(){if(oi.refCount--,oi.refCount<=0){ze.deleteProgram(oi.program);var Di=_i.indexOf(oi);_i.splice(Di,1),Gt.shaderCount--}Yn[oi.vertId].refCount<=0&&(ze.deleteShader(ln[oi.vertId]),delete ln[oi.vertId],delete Ci[oi.fragId][oi.vertId]),Object.keys(Ci[oi.fragId]).length||(ze.deleteShader(Dn[oi.fragId]),delete Dn[oi.fragId],delete Ci[oi.fragId])}})},restore:ki,shader:ri,frag:-1,vert:-1}}var Ft=6408,ar=5121,nr=3333,Ir=5126;function _r(ze,At,Gt,fn,Dn,ln,_n){function Zn(_i){var Li;At.next===null?(be(Dn.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Li=ar):(be(At.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Li=At.next.colorAttachments[0].texture._texture.type,ln.oes_texture_float?(be(Li===ar||Li===Ir,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Li===Ir&&be(_n.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):be(Li===ar,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Fi=0,hi=0,ki=fn.framebufferWidth,Wr=fn.framebufferHeight,bn=null;_e(_i)?bn=_i:_i&&(be.type(_i,"object","invalid arguments to regl.read()"),Fi=_i.x|0,hi=_i.y|0,be(Fi>=0&&Fi<fn.framebufferWidth,"invalid x offset for regl.read"),be(hi>=0&&hi<fn.framebufferHeight,"invalid y offset for regl.read"),ki=(_i.width||fn.framebufferWidth-Fi)|0,Wr=(_i.height||fn.framebufferHeight-hi)|0,bn=_i.data||null),bn&&(Li===ar?be(bn instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Li===Ir&&be(bn instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),be(ki>0&&ki+Fi<=fn.framebufferWidth,"invalid width for read pixels"),be(Wr>0&&Wr+hi<=fn.framebufferHeight,"invalid height for read pixels"),Gt();var di=ki*Wr*4;return bn||(Li===ar?bn=new Uint8Array(di):Li===Ir&&(bn=bn||new Float32Array(di))),be.isTypedArray(bn,"data buffer for regl.read() must be a typedarray"),be(bn.byteLength>=di,"data buffer for regl.read() too small"),ze.pixelStorei(nr,4),ze.readPixels(Fi,hi,ki,Wr,Ft,Li,bn),bn}function ri(_i){var Li;return At.setFBO({framebuffer:_i.framebuffer},function(){Li=Zn(_i)}),Li}function Ci(_i){return!_i||!("framebuffer"in _i)?Zn(_i):ri(_i)}return Ci}function Qr(ze){return Array.prototype.slice.call(ze)}function nn(ze){return Qr(ze).join("")}function Ln(){var ze=0,At=[],Gt=[];function fn(Li){for(var Fi=0;Fi<Gt.length;++Fi)if(Gt[Fi]===Li)return At[Fi];var hi="g"+ze++;return At.push(hi),Gt.push(Li),hi}function Dn(){var Li=[];function Fi(){Li.push.apply(Li,Qr(arguments))}var hi=[];function ki(){var Wr="v"+ze++;return hi.push(Wr),arguments.length>0&&(Li.push(Wr,"="),Li.push.apply(Li,Qr(arguments)),Li.push(";")),Wr}return G(Fi,{def:ki,toString:function(){return nn([hi.length>0?"var "+hi.join(",")+";":"",nn(Li)])}})}function ln(){var Li=Dn(),Fi=Dn(),hi=Li.toString,ki=Fi.toString;function Wr(bn,di){Fi(bn,di,"=",Li.def(bn,di),";")}return G(function(){Li.apply(Li,Qr(arguments))},{def:Li.def,entry:Li,exit:Fi,save:Wr,set:function(bn,di,Gi){Wr(bn,di),Li(bn,di,"=",Gi,";")},toString:function(){return hi()+ki()}})}function _n(){var Li=nn(arguments),Fi=ln(),hi=ln(),ki=Fi.toString,Wr=hi.toString;return G(Fi,{then:function(){return Fi.apply(Fi,Qr(arguments)),this},else:function(){return hi.apply(hi,Qr(arguments)),this},toString:function(){var bn=Wr();return bn&&(bn="else{"+bn+"}"),nn(["if(",Li,"){",ki(),"}",bn])}})}var Zn=Dn(),ri={};function Ci(Li,Fi){var hi=[];function ki(){var Yn="a"+hi.length;return hi.push(Yn),Yn}Fi=Fi||0;for(var Wr=0;Wr<Fi;++Wr)ki();var bn=ln(),di=bn.toString,Gi=ri[Li]=G(bn,{arg:ki,toString:function(){return nn(["function(",hi.join(),"){",di(),"}"])}});return Gi}function _i(){var Li=['"use strict";',Zn,"return {"];Object.keys(ri).forEach(function(ki){Li.push('"',ki,'":',ri[ki].toString(),",")}),Li.push("}");var Fi=nn(Li).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),hi=Function.apply(null,At.concat(Fi));return hi.apply(null,Gt)}return{global:Zn,link:fn,block:Dn,proc:Ci,scope:ln,cond:_n,compile:_i}}var Mn="xyzw".split(""),yi=5121,Ri=1,Qi=2,Vi=0,ao=1,Bi=2,oa=3,Ha=4,ja=5,Sa=6,Qa="dither",eo="blend.enable",va="blend.color",tu="blend.equation",Gs="blend.func",Tl="depth.enable",Ps="depth.func",Qo="depth.range",Zs="depth.mask",Hs="colorMask",Uu="cull.enable",uh="cull.face",pc="frontFace",Xc="lineWidth",Yc="polygonOffset.enable",Qf="polygonOffset.offset",dc="sample.alpha",vc="sample.enable",Dc="sample.coverage",Vl="stencil.enable",Gl="stencil.mask",vf="stencil.func",mc="stencil.opFront",Hl="stencil.opBack",lh="scissor.enable",Os="scissor.box",ch="viewport",Es="profile",Ol="framebuffer",ml="vert",mf="frag",ku="elements",ep="primitive",cd="count",qh="offset",Rd="instances",Rf="vao",hd="Width",Sd="Height",Ip=Ol+hd,Fl=Ol+Sd,Wd=ch+hd,Qm=ch+Sd,Tv="drawingBuffer",Mv=Tv+hd,Dd=Tv+Sd,Pv=[Gs,tu,vf,mc,Hl,Dc,ch,Os,Qf],fd=34962,jv=34963,hh=35632,dv=35633,Df=3553,Xd=34067,Yd=2884,Vv=3042,lm=3024,Om=2960,Fm=2929,cm=3089,hm=32823,zm=32926,qd=32928,Sp=5126,Ed=35664,qu=35665,fh=35666,Oh=5124,Ku=35667,Ml=35668,qp=35669,kv=35670,Kd=35671,Ju=35672,Od=35673,_s=35674,vv=35675,Ac=35676,Sh=35678,Lp=35680,Tc=4,Of=1028,Fd=1029,Oc=2304,zd=2305,yg=32775,Gv=32776,fm=519,Ff=7680,mv=0,gc=1,Hv=32774,pm=513,Cd=36160,dm=36064,gf={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Jd=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Kh={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},qc={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Bd={frag:hh,vert:dv},zf={cw:Oc,ccw:zd};function gv(ze){return Array.isArray(ze)||_e(ze)||cl(ze)}function eg(ze){return ze.sort(function(At,Gt){return At===ch?-1:Gt===ch?1:At<Gt?-1:1})}function Fh(ze,At,Gt,fn){this.thisDep=ze,this.contextDep=At,this.propDep=Gt,this.append=fn}function yf(ze){return ze&&!(ze.thisDep||ze.contextDep||ze.propDep)}function tc(ze){return new Fh(!1,!1,!1,ze)}function _f(ze,At){var Gt=ze.type;if(Gt===Vi){var fn=ze.data.length;return new Fh(!0,fn>=1,fn>=2,At)}else if(Gt===Ha){var Dn=ze.data;return new Fh(Dn.thisDep,Dn.contextDep,Dn.propDep,At)}else{if(Gt===ja)return new Fh(!1,!1,!1,At);if(Gt===Sa){for(var ln=!1,_n=!1,Zn=!1,ri=0;ri<ze.data.length;++ri){var Ci=ze.data[ri];if(Ci.type===ao)Zn=!0;else if(Ci.type===Bi)_n=!0;else if(Ci.type===oa)ln=!0;else if(Ci.type===Vi){ln=!0;var _i=Ci.data;_i>=1&&(_n=!0),_i>=2&&(Zn=!0)}else Ci.type===Ha&&(ln=ln||Ci.data.thisDep,_n=_n||Ci.data.contextDep,Zn=Zn||Ci.data.propDep)}return new Fh(ln,_n,Zn,At)}else return new Fh(Gt===oa,Gt===Bi,Gt===ao,At)}}var $v=new Fh(!1,!1,!1,function(){});function vm(ze,At,Gt,fn,Dn,ln,_n,Zn,ri,Ci,_i,Li,Fi,hi,ki){var Wr=Ci.Record,bn={add:32774,subtract:32778,"reverse subtract":32779};Gt.ext_blend_minmax&&(bn.min=yg,bn.max=Gv);var di=Gt.angle_instanced_arrays,Gi=Gt.webgl_draw_buffers,Yn={dirty:!0,profile:ki.profile},ia={},oi=[],Di={},qn={};function Ai(Nt){return Nt.replace(".","_")}function Oa(Nt,Et,gr){var Vr=Ai(Nt);oi.push(Nt),ia[Vr]=Yn[Vr]=!!gr,Di[Vr]=Et}function Ya(Nt,Et,gr){var Vr=Ai(Nt);oi.push(Nt),Array.isArray(gr)?(Yn[Vr]=gr.slice(),ia[Vr]=gr.slice()):Yn[Vr]=ia[Vr]=gr,qn[Vr]=Et}Oa(Qa,lm),Oa(eo,Vv),Ya(va,"blendColor",[0,0,0,0]),Ya(tu,"blendEquationSeparate",[Hv,Hv]),Ya(Gs,"blendFuncSeparate",[gc,mv,gc,mv]),Oa(Tl,Fm,!0),Ya(Ps,"depthFunc",pm),Ya(Qo,"depthRange",[0,1]),Ya(Zs,"depthMask",!0),Ya(Hs,Hs,[!0,!0,!0,!0]),Oa(Uu,Yd),Ya(uh,"cullFace",Fd),Ya(pc,pc,zd),Ya(Xc,Xc,1),Oa(Yc,hm),Ya(Qf,"polygonOffset",[0,0]),Oa(dc,zm),Oa(vc,qd),Ya(Dc,"sampleCoverage",[1,!1]),Oa(Vl,Om),Ya(Gl,"stencilMask",-1),Ya(vf,"stencilFunc",[fm,0,-1]),Ya(mc,"stencilOpSeparate",[Of,Ff,Ff,Ff]),Ya(Hl,"stencilOpSeparate",[Fd,Ff,Ff,Ff]),Oa(lh,cm),Ya(Os,"scissor",[0,0,ze.drawingBufferWidth,ze.drawingBufferHeight]),Ya(ch,ch,[0,0,ze.drawingBufferWidth,ze.drawingBufferHeight]);var Oi={gl:ze,context:Fi,strings:At,next:ia,current:Yn,draw:Li,elements:ln,buffer:Dn,shader:_i,attributes:Ci.state,vao:Ci,uniforms:ri,framebuffer:Zn,extensions:Gt,timer:hi,isBufferArgs:gv},Qn={primTypes:Bu,compareFuncs:Kh,blendFuncs:gf,blendEquations:bn,stencilOps:qc,glTypes:os,orientationType:zf};be.optional(function(){Oi.isArrayLike=Nu}),Gi&&(Qn.backBuffer=[Fd],Qn.drawBuffer=ve(fn.maxDrawbuffers,function(Nt){return Nt===0?[0]:ve(Nt,function(Et){return dm+Et})}));var Hn=0;function mo(){var Nt=Ln(),Et=Nt.link,gr=Nt.global;Nt.id=Hn++,Nt.batchId="0";var Vr=Et(Oi),$r=Nt.shared={props:"a0"};Object.keys(Oi).forEach(function(lr){$r[lr]=gr.def(Vr,".",lr)}),be.optional(function(){Nt.CHECK=Et(be),Nt.commandStr=be.guessCommand(),Nt.command=Et(Nt.commandStr),Nt.assert=function(lr,It,Zr){lr("if(!(",It,"))",this.CHECK,".commandRaise(",Et(Zr),",",this.command,");")},Qn.invalidBlendCombinations=Jd});var wr=Nt.next={},ur=Nt.current={};Object.keys(qn).forEach(function(lr){Array.isArray(Yn[lr])&&(wr[lr]=gr.def($r.next,".",lr),ur[lr]=gr.def($r.current,".",lr))});var Lr=Nt.constants={};Object.keys(Qn).forEach(function(lr){Lr[lr]=gr.def(JSON.stringify(Qn[lr]))}),Nt.invoke=function(lr,It){switch(It.type){case Vi:var Zr=["this",$r.context,$r.props,Nt.batchId];return lr.def(Et(It.data),".call(",Zr.slice(0,Math.max(It.data.length+1,4)),")");case ao:return lr.def($r.props,It.data);case Bi:return lr.def($r.context,It.data);case oa:return lr.def("this",It.data);case Ha:return It.data.append(Nt,lr),It.data.ref;case ja:return It.data.toString();case Sa:return It.data.map(function(Xr){return Nt.invoke(lr,Xr)})}},Nt.attribCache={};var Zt={};return Nt.scopeAttrib=function(lr){var It=At.id(lr);if(It in Zt)return Zt[It];var Zr=Ci.scope[It];Zr||(Zr=Ci.scope[It]=new Wr);var Xr=Zt[It]=Et(Zr);return Xr},Nt}function so(Nt){var Et=Nt.static,gr=Nt.dynamic,Vr;if(Es in Et){var $r=!!Et[Es];Vr=tc(function(ur,Lr){return $r}),Vr.enable=$r}else if(Es in gr){var wr=gr[Es];Vr=_f(wr,function(ur,Lr){return ur.invoke(Lr,wr)})}return Vr}function sa(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic;if(Ol in gr){var $r=gr[Ol];return $r?($r=Zn.getFramebuffer($r),be.command($r,"invalid framebuffer object"),tc(function(ur,Lr){var Zt=ur.link($r),lr=ur.shared;Lr.set(lr.framebuffer,".next",Zt);var It=lr.context;return Lr.set(It,"."+Ip,Zt+".width"),Lr.set(It,"."+Fl,Zt+".height"),Zt})):tc(function(ur,Lr){var Zt=ur.shared;Lr.set(Zt.framebuffer,".next","null");var lr=Zt.context;return Lr.set(lr,"."+Ip,lr+"."+Mv),Lr.set(lr,"."+Fl,lr+"."+Dd),"null"})}else if(Ol in Vr){var wr=Vr[Ol];return _f(wr,function(ur,Lr){var Zt=ur.invoke(Lr,wr),lr=ur.shared,It=lr.framebuffer,Zr=Lr.def(It,".getFramebuffer(",Zt,")");be.optional(function(){ur.assert(Lr,"!"+Zt+"||"+Zr,"invalid framebuffer object")}),Lr.set(It,".next",Zr);var Xr=lr.context;return Lr.set(Xr,"."+Ip,Zr+"?"+Zr+".width:"+Xr+"."+Mv),Lr.set(Xr,"."+Fl,Zr+"?"+Zr+".height:"+Xr+"."+Dd),Zr})}else return null}function Cs(Nt,Et,gr){var Vr=Nt.static,$r=Nt.dynamic;function wr(Zt){if(Zt in Vr){var lr=Vr[Zt];be.commandType(lr,"object","invalid "+Zt,gr.commandStr);var It=!0,Zr=lr.x|0,Xr=lr.y|0,Rn,dn;return"width"in lr?(Rn=lr.width|0,be.command(Rn>=0,"invalid "+Zt,gr.commandStr)):It=!1,"height"in lr?(dn=lr.height|0,be.command(dn>=0,"invalid "+Zt,gr.commandStr)):It=!1,new Fh(!It&&Et&&Et.thisDep,!It&&Et&&Et.contextDep,!It&&Et&&Et.propDep,function(Ea,ts){var ma=Ea.shared.context,uo=Rn;"width"in lr||(uo=ts.def(ma,".",Ip,"-",Zr));var Do=dn;return"height"in lr||(Do=ts.def(ma,".",Fl,"-",Xr)),[Zr,Xr,uo,Do]})}else if(Zt in $r){var Pn=$r[Zt],vi=_f(Pn,function(Ea,ts){var ma=Ea.invoke(ts,Pn);be.optional(function(){Ea.assert(ts,ma+"&&typeof "+ma+'==="object"',"invalid "+Zt)});var uo=Ea.shared.context,Do=ts.def(ma,".x|0"),Ys=ts.def(ma,".y|0"),Wl=ts.def('"width" in ',ma,"?",ma,".width|0:","(",uo,".",Ip,"-",Do,")"),bf=ts.def('"height" in ',ma,"?",ma,".height|0:","(",uo,".",Fl,"-",Ys,")");return be.optional(function(){Ea.assert(ts,Wl+">=0&&"+bf+">=0","invalid "+Zt)}),[Do,Ys,Wl,bf]});return Et&&(vi.thisDep=vi.thisDep||Et.thisDep,vi.contextDep=vi.contextDep||Et.contextDep,vi.propDep=vi.propDep||Et.propDep),vi}else return Et?new Fh(Et.thisDep,Et.contextDep,Et.propDep,function(Ea,ts){var ma=Ea.shared.context;return[0,0,ts.def(ma,".",Ip),ts.def(ma,".",Fl)]}):null}var ur=wr(ch);if(ur){var Lr=ur;ur=new Fh(ur.thisDep,ur.contextDep,ur.propDep,function(Zt,lr){var It=Lr.append(Zt,lr),Zr=Zt.shared.context;return lr.set(Zr,"."+Wd,It[2]),lr.set(Zr,"."+Qm,It[3]),It})}return{viewport:ur,scissor_box:wr(Os)}}function Vo(Nt,Et){var gr=Nt.static,Vr=typeof gr[mf]=="string"&&typeof gr[ml]=="string";if(Vr){if(Object.keys(Et.dynamic).length>0)return null;var $r=Et.static,wr=Object.keys($r);if(wr.length>0&&typeof $r[wr[0]]=="number"){for(var ur=[],Lr=0;Lr<wr.length;++Lr)be(typeof $r[wr[Lr]]=="number","must specify all vertex attribute locations when using vaos"),ur.push([$r[wr[Lr]]|0,wr[Lr]]);return ur}}return null}function Go(Nt,Et,gr){var Vr=Nt.static,$r=Nt.dynamic;function wr(It){if(It in Vr){var Zr=At.id(Vr[It]);be.optional(function(){_i.shader(Bd[It],Zr,be.guessCommand())});var Xr=tc(function(){return Zr});return Xr.id=Zr,Xr}else if(It in $r){var Rn=$r[It];return _f(Rn,function(dn,Pn){var vi=dn.invoke(Pn,Rn),Ea=Pn.def(dn.shared.strings,".id(",vi,")");return be.optional(function(){Pn(dn.shared.shader,".shader(",Bd[It],",",Ea,",",dn.command,");")}),Ea})}return null}var ur=wr(mf),Lr=wr(ml),Zt=null,lr;return yf(ur)&&yf(Lr)?(Zt=_i.program(Lr.id,ur.id,null,gr),lr=tc(function(It,Zr){return It.link(Zt)})):lr=new Fh(ur&&ur.thisDep||Lr&&Lr.thisDep,ur&&ur.contextDep||Lr&&Lr.contextDep,ur&&ur.propDep||Lr&&Lr.propDep,function(It,Zr){var Xr=It.shared.shader,Rn;ur?Rn=ur.append(It,Zr):Rn=Zr.def(Xr,".",mf);var dn;Lr?dn=Lr.append(It,Zr):dn=Zr.def(Xr,".",ml);var Pn=Xr+".program("+dn+","+Rn;return be.optional(function(){Pn+=","+It.command}),Zr.def(Pn+")")}),{frag:ur,vert:Lr,progVar:lr,program:Zt}}function Fs(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic;function $r(){if(ku in gr){var It=gr[ku];gv(It)?It=ln.getElements(ln.create(It,!0)):It&&(It=ln.getElements(It),be.command(It,"invalid elements",Et.commandStr));var Zr=tc(function(Rn,dn){if(It){var Pn=Rn.link(It);return Rn.ELEMENTS=Pn,Pn}return Rn.ELEMENTS=null,null});return Zr.value=It,Zr}else if(ku in Vr){var Xr=Vr[ku];return _f(Xr,function(Rn,dn){var Pn=Rn.shared,vi=Pn.isBufferArgs,Ea=Pn.elements,ts=Rn.invoke(dn,Xr),ma=dn.def("null"),uo=dn.def(vi,"(",ts,")"),Do=Rn.cond(uo).then(ma,"=",Ea,".createStream(",ts,");").else(ma,"=",Ea,".getElements(",ts,");");return be.optional(function(){Rn.assert(Do.else,"!"+ts+"||"+ma,"invalid elements")}),dn.entry(Do),dn.exit(Rn.cond(uo).then(Ea,".destroyStream(",ma,");")),Rn.ELEMENTS=ma,ma})}return null}var wr=$r();function ur(){if(ep in gr){var It=gr[ep];return be.commandParameter(It,Bu,"invalid primitve",Et.commandStr),tc(function(Xr,Rn){return Bu[It]})}else if(ep in Vr){var Zr=Vr[ep];return _f(Zr,function(Xr,Rn){var dn=Xr.constants.primTypes,Pn=Xr.invoke(Rn,Zr);return be.optional(function(){Xr.assert(Rn,Pn+" in "+dn,"invalid primitive, must be one of "+Object.keys(Bu))}),Rn.def(dn,"[",Pn,"]")})}else if(wr)return yf(wr)?wr.value?tc(function(Xr,Rn){return Rn.def(Xr.ELEMENTS,".primType")}):tc(function(){return Tc}):new Fh(wr.thisDep,wr.contextDep,wr.propDep,function(Xr,Rn){var dn=Xr.ELEMENTS;return Rn.def(dn,"?",dn,".primType:",Tc)});return null}function Lr(It,Zr){if(It in gr){var Xr=gr[It]|0;return be.command(!Zr||Xr>=0,"invalid "+It,Et.commandStr),tc(function(dn,Pn){return Zr&&(dn.OFFSET=Xr),Xr})}else if(It in Vr){var Rn=Vr[It];return _f(Rn,function(dn,Pn){var vi=dn.invoke(Pn,Rn);return Zr&&(dn.OFFSET=vi,be.optional(function(){dn.assert(Pn,vi+">=0","invalid "+It)})),vi})}else if(Zr&&wr)return tc(function(dn,Pn){return dn.OFFSET="0",0});return null}var Zt=Lr(qh,!0);function lr(){if(cd in gr){var It=gr[cd]|0;return be.command(typeof It=="number"&&It>=0,"invalid vertex count",Et.commandStr),tc(function(){return It})}else if(cd in Vr){var Zr=Vr[cd];return _f(Zr,function(dn,Pn){var vi=dn.invoke(Pn,Zr);return be.optional(function(){dn.assert(Pn,"typeof "+vi+'==="number"&&'+vi+">=0&&"+vi+"===("+vi+"|0)","invalid vertex count")}),vi})}else if(wr)if(yf(wr)){if(wr)return Zt?new Fh(Zt.thisDep,Zt.contextDep,Zt.propDep,function(dn,Pn){var vi=Pn.def(dn.ELEMENTS,".vertCount-",dn.OFFSET);return be.optional(function(){dn.assert(Pn,vi+">=0","invalid vertex offset/element buffer too small")}),vi}):tc(function(dn,Pn){return Pn.def(dn.ELEMENTS,".vertCount")});var Xr=tc(function(){return-1});return be.optional(function(){Xr.MISSING=!0}),Xr}else{var Rn=new Fh(wr.thisDep||Zt.thisDep,wr.contextDep||Zt.contextDep,wr.propDep||Zt.propDep,function(dn,Pn){var vi=dn.ELEMENTS;return dn.OFFSET?Pn.def(vi,"?",vi,".vertCount-",dn.OFFSET,":-1"):Pn.def(vi,"?",vi,".vertCount:-1")});return be.optional(function(){Rn.DYNAMIC=!0}),Rn}return null}return{elements:wr,primitive:ur(),count:lr(),instances:Lr(Rd,!1),offset:Zt}}function xl(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic,$r={};return oi.forEach(function(wr){var ur=Ai(wr);function Lr(Zt,lr){if(wr in gr){var It=Zt(gr[wr]);$r[ur]=tc(function(){return It})}else if(wr in Vr){var Zr=Vr[wr];$r[ur]=_f(Zr,function(Xr,Rn){return lr(Xr,Rn,Xr.invoke(Rn,Zr))})}}switch(wr){case Uu:case eo:case Qa:case Vl:case Tl:case lh:case Yc:case dc:case vc:case Zs:return Lr(function(Zt){return be.commandType(Zt,"boolean",wr,Et.commandStr),Zt},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,"typeof "+It+'==="boolean"',"invalid flag "+wr,Zt.commandStr)}),It});case Ps:return Lr(function(Zt){return be.commandParameter(Zt,Kh,"invalid "+wr,Et.commandStr),Kh[Zt]},function(Zt,lr,It){var Zr=Zt.constants.compareFuncs;return be.optional(function(){Zt.assert(lr,It+" in "+Zr,"invalid "+wr+", must be one of "+Object.keys(Kh))}),lr.def(Zr,"[",It,"]")});case Qo:return Lr(function(Zt){return be.command(Nu(Zt)&&Zt.length===2&&typeof Zt[0]=="number"&&typeof Zt[1]=="number"&&Zt[0]<=Zt[1],"depth range is 2d array",Et.commandStr),Zt},function(Zt,lr,It){be.optional(function(){Zt.assert(lr,Zt.shared.isArrayLike+"("+It+")&&"+It+".length===2&&typeof "+It+'[0]==="number"&&typeof '+It+'[1]==="number"&&'+It+"[0]<="+It+"[1]","depth range must be a 2d array")});var Zr=lr.def("+",It,"[0]"),Xr=lr.def("+",It,"[1]");return[Zr,Xr]});case Gs:return Lr(function(Zt){be.commandType(Zt,"object","blend.func",Et.commandStr);var lr="srcRGB"in Zt?Zt.srcRGB:Zt.src,It="srcAlpha"in Zt?Zt.srcAlpha:Zt.src,Zr="dstRGB"in Zt?Zt.dstRGB:Zt.dst,Xr="dstAlpha"in Zt?Zt.dstAlpha:Zt.dst;return be.commandParameter(lr,gf,ur+".srcRGB",Et.commandStr),be.commandParameter(It,gf,ur+".srcAlpha",Et.commandStr),be.commandParameter(Zr,gf,ur+".dstRGB",Et.commandStr),be.commandParameter(Xr,gf,ur+".dstAlpha",Et.commandStr),be.command(Jd.indexOf(lr+", "+Zr)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+lr+", "+Zr+")",Et.commandStr),[gf[lr],gf[Zr],gf[It],gf[Xr]]},function(Zt,lr,It){var Zr=Zt.constants.blendFuncs;be.optional(function(){Zt.assert(lr,It+"&&typeof "+It+'==="object"',"invalid blend func, must be an object")});function Xr(ma,uo){var Do=lr.def('"',ma,uo,'" in ',It,"?",It,".",ma,uo,":",It,".",ma);return be.optional(function(){Zt.assert(lr,Do+" in "+Zr,"invalid "+wr+"."+ma+uo+", must be one of "+Object.keys(gf))}),Do}var Rn=Xr("src","RGB"),dn=Xr("dst","RGB");be.optional(function(){var ma=Zt.constants.invalidBlendCombinations;Zt.assert(lr,ma+".indexOf("+Rn+'+", "+'+dn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Pn=lr.def(Zr,"[",Rn,"]"),vi=lr.def(Zr,"[",Xr("src","Alpha"),"]"),Ea=lr.def(Zr,"[",dn,"]"),ts=lr.def(Zr,"[",Xr("dst","Alpha"),"]");return[Pn,Ea,vi,ts]});case tu:return Lr(function(Zt){if(typeof Zt=="string")return be.commandParameter(Zt,bn,"invalid "+wr,Et.commandStr),[bn[Zt],bn[Zt]];if(typeof Zt=="object")return be.commandParameter(Zt.rgb,bn,wr+".rgb",Et.commandStr),be.commandParameter(Zt.alpha,bn,wr+".alpha",Et.commandStr),[bn[Zt.rgb],bn[Zt.alpha]];be.commandRaise("invalid blend.equation",Et.commandStr)},function(Zt,lr,It){var Zr=Zt.constants.blendEquations,Xr=lr.def(),Rn=lr.def(),dn=Zt.cond("typeof ",It,'==="string"');return be.optional(function(){function Pn(vi,Ea,ts){Zt.assert(vi,ts+" in "+Zr,"invalid "+Ea+", must be one of "+Object.keys(bn))}Pn(dn.then,wr,It),Zt.assert(dn.else,It+"&&typeof "+It+'==="object"',"invalid "+wr),Pn(dn.else,wr+".rgb",It+".rgb"),Pn(dn.else,wr+".alpha",It+".alpha")}),dn.then(Xr,"=",Rn,"=",Zr,"[",It,"];"),dn.else(Xr,"=",Zr,"[",It,".rgb];",Rn,"=",Zr,"[",It,".alpha];"),lr(dn),[Xr,Rn]});case va:return Lr(function(Zt){return be.command(Nu(Zt)&&Zt.length===4,"blend.color must be a 4d array",Et.commandStr),ve(4,function(lr){return+Zt[lr]})},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,Zt.shared.isArrayLike+"("+It+")&&"+It+".length===4","blend.color must be a 4d array")}),ve(4,function(Zr){return lr.def("+",It,"[",Zr,"]")})});case Gl:return Lr(function(Zt){return be.commandType(Zt,"number",ur,Et.commandStr),Zt|0},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,"typeof "+It+'==="number"',"invalid stencil.mask")}),lr.def(It,"|0")});case vf:return Lr(function(Zt){be.commandType(Zt,"object",ur,Et.commandStr);var lr=Zt.cmp||"keep",It=Zt.ref||0,Zr="mask"in Zt?Zt.mask:-1;return be.commandParameter(lr,Kh,wr+".cmp",Et.commandStr),be.commandType(It,"number",wr+".ref",Et.commandStr),be.commandType(Zr,"number",wr+".mask",Et.commandStr),[Kh[lr],It,Zr]},function(Zt,lr,It){var Zr=Zt.constants.compareFuncs;be.optional(function(){function Pn(){Zt.assert(lr,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Pn(It+"&&typeof ",It,'==="object"'),Pn('!("cmp" in ',It,")||(",It,".cmp in ",Zr,")")});var Xr=lr.def('"cmp" in ',It,"?",Zr,"[",It,".cmp]",":",Ff),Rn=lr.def(It,".ref|0"),dn=lr.def('"mask" in ',It,"?",It,".mask|0:-1");return[Xr,Rn,dn]});case mc:case Hl:return Lr(function(Zt){be.commandType(Zt,"object",ur,Et.commandStr);var lr=Zt.fail||"keep",It=Zt.zfail||"keep",Zr=Zt.zpass||"keep";return be.commandParameter(lr,qc,wr+".fail",Et.commandStr),be.commandParameter(It,qc,wr+".zfail",Et.commandStr),be.commandParameter(Zr,qc,wr+".zpass",Et.commandStr),[wr===Hl?Fd:Of,qc[lr],qc[It],qc[Zr]]},function(Zt,lr,It){var Zr=Zt.constants.stencilOps;be.optional(function(){Zt.assert(lr,It+"&&typeof "+It+'==="object"',"invalid "+wr)});function Xr(Rn){return be.optional(function(){Zt.assert(lr,'!("'+Rn+'" in '+It+")||("+It+"."+Rn+" in "+Zr+")","invalid "+wr+"."+Rn+", must be one of "+Object.keys(qc))}),lr.def('"',Rn,'" in ',It,"?",Zr,"[",It,".",Rn,"]:",Ff)}return[wr===Hl?Fd:Of,Xr("fail"),Xr("zfail"),Xr("zpass")]});case Qf:return Lr(function(Zt){be.commandType(Zt,"object",ur,Et.commandStr);var lr=Zt.factor|0,It=Zt.units|0;return be.commandType(lr,"number",ur+".factor",Et.commandStr),be.commandType(It,"number",ur+".units",Et.commandStr),[lr,It]},function(Zt,lr,It){be.optional(function(){Zt.assert(lr,It+"&&typeof "+It+'==="object"',"invalid "+wr)});var Zr=lr.def(It,".factor|0"),Xr=lr.def(It,".units|0");return[Zr,Xr]});case uh:return Lr(function(Zt){var lr=0;return Zt==="front"?lr=Of:Zt==="back"&&(lr=Fd),be.command(!!lr,ur,Et.commandStr),lr},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,It+'==="front"||'+It+'==="back"',"invalid cull.face")}),lr.def(It,'==="front"?',Of,":",Fd)});case Xc:return Lr(function(Zt){return be.command(typeof Zt=="number"&&Zt>=fn.lineWidthDims[0]&&Zt<=fn.lineWidthDims[1],"invalid line width, must be a positive number between "+fn.lineWidthDims[0]+" and "+fn.lineWidthDims[1],Et.commandStr),Zt},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,"typeof "+It+'==="number"&&'+It+">="+fn.lineWidthDims[0]+"&&"+It+"<="+fn.lineWidthDims[1],"invalid line width")}),It});case pc:return Lr(function(Zt){return be.commandParameter(Zt,zf,ur,Et.commandStr),zf[Zt]},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,It+'==="cw"||'+It+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),lr.def(It+'==="cw"?'+Oc+":"+zd)});case Hs:return Lr(function(Zt){return be.command(Nu(Zt)&&Zt.length===4,"color.mask must be length 4 array",Et.commandStr),Zt.map(function(lr){return!!lr})},function(Zt,lr,It){return be.optional(function(){Zt.assert(lr,Zt.shared.isArrayLike+"("+It+")&&"+It+".length===4","invalid color.mask")}),ve(4,function(Zr){return"!!"+It+"["+Zr+"]"})});case Dc:return Lr(function(Zt){be.command(typeof Zt=="object"&&Zt,ur,Et.commandStr);var lr="value"in Zt?Zt.value:1,It=!!Zt.invert;return be.command(typeof lr=="number"&&lr>=0&&lr<=1,"sample.coverage.value must be a number between 0 and 1",Et.commandStr),[lr,It]},function(Zt,lr,It){be.optional(function(){Zt.assert(lr,It+"&&typeof "+It+'==="object"',"invalid sample.coverage")});var Zr=lr.def('"value" in ',It,"?+",It,".value:1"),Xr=lr.def("!!",It,".invert");return[Zr,Xr]})}}),$r}function ks(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic,$r={};return Object.keys(gr).forEach(function(wr){var ur=gr[wr],Lr;if(typeof ur=="number"||typeof ur=="boolean")Lr=tc(function(){return ur});else if(typeof ur=="function"){var Zt=ur._reglType;Zt==="texture2d"||Zt==="textureCube"?Lr=tc(function(lr){return lr.link(ur)}):Zt==="framebuffer"||Zt==="framebufferCube"?(be.command(ur.color.length>0,'missing color attachment for framebuffer sent to uniform "'+wr+'"',Et.commandStr),Lr=tc(function(lr){return lr.link(ur.color[0])})):be.commandRaise('invalid data for uniform "'+wr+'"',Et.commandStr)}else Nu(ur)?Lr=tc(function(lr){var It=lr.global.def("[",ve(ur.length,function(Zr){return be.command(typeof ur[Zr]=="number"||typeof ur[Zr]=="boolean","invalid uniform "+wr,lr.commandStr),ur[Zr]}),"]");return It}):be.commandRaise('invalid or missing data for uniform "'+wr+'"',Et.commandStr);Lr.value=ur,$r[wr]=Lr}),Object.keys(Vr).forEach(function(wr){var ur=Vr[wr];$r[wr]=_f(ur,function(Lr,Zt){return Lr.invoke(Zt,ur)})}),$r}function Ho(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic,$r={};return Object.keys(gr).forEach(function(wr){var ur=gr[wr],Lr=At.id(wr),Zt=new Wr;if(gv(ur))Zt.state=Ri,Zt.buffer=Dn.getBuffer(Dn.create(ur,fd,!1,!0)),Zt.type=0;else{var lr=Dn.getBuffer(ur);if(lr)Zt.state=Ri,Zt.buffer=lr,Zt.type=0;else if(be.command(typeof ur=="object"&&ur,"invalid data for attribute "+wr,Et.commandStr),"constant"in ur){var It=ur.constant;Zt.buffer="null",Zt.state=Qi,typeof It=="number"?Zt.x=It:(be.command(Nu(It)&&It.length>0&&It.length<=4,"invalid constant for attribute "+wr,Et.commandStr),Mn.forEach(function(Ea,ts){ts<It.length&&(Zt[Ea]=It[ts])}))}else{gv(ur.buffer)?lr=Dn.getBuffer(Dn.create(ur.buffer,fd,!1,!0)):lr=Dn.getBuffer(ur.buffer),be.command(!!lr,'missing buffer for attribute "'+wr+'"',Et.commandStr);var Zr=ur.offset|0;be.command(Zr>=0,'invalid offset for attribute "'+wr+'"',Et.commandStr);var Xr=ur.stride|0;be.command(Xr>=0&&Xr<256,'invalid stride for attribute "'+wr+'", must be integer betweeen [0, 255]',Et.commandStr);var Rn=ur.size|0;be.command(!("size"in ur)||Rn>0&&Rn<=4,'invalid size for attribute "'+wr+'", must be 1,2,3,4',Et.commandStr);var dn=!!ur.normalized,Pn=0;"type"in ur&&(be.commandParameter(ur.type,os,"invalid type for attribute "+wr,Et.commandStr),Pn=os[ur.type]);var vi=ur.divisor|0;"divisor"in ur&&(be.command(vi===0||di,'cannot specify divisor for attribute "'+wr+'", instancing not supported',Et.commandStr),be.command(vi>=0,'invalid divisor for attribute "'+wr+'"',Et.commandStr)),be.optional(function(){var Ea=Et.commandStr,ts=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ur).forEach(function(ma){be.command(ts.indexOf(ma)>=0,'unknown parameter "'+ma+'" for attribute pointer "'+wr+'" (valid parameters are '+ts+")",Ea)})}),Zt.buffer=lr,Zt.state=Ri,Zt.size=Rn,Zt.normalized=dn,Zt.type=Pn||lr.dtype,Zt.offset=Zr,Zt.stride=Xr,Zt.divisor=vi}}$r[wr]=tc(function(Ea,ts){var ma=Ea.attribCache;if(Lr in ma)return ma[Lr];var uo={isStream:!1};return Object.keys(Zt).forEach(function(Do){uo[Do]=Zt[Do]}),Zt.buffer&&(uo.buffer=Ea.link(Zt.buffer),uo.type=uo.type||uo.buffer+".dtype"),ma[Lr]=uo,uo})}),Object.keys(Vr).forEach(function(wr){var ur=Vr[wr];function Lr(Zt,lr){var It=Zt.invoke(lr,ur),Zr=Zt.shared,Xr=Zt.constants,Rn=Zr.isBufferArgs,dn=Zr.buffer;be.optional(function(){Zt.assert(lr,It+"&&(typeof "+It+'==="object"||typeof '+It+'==="function")&&('+Rn+"("+It+")||"+dn+".getBuffer("+It+")||"+dn+".getBuffer("+It+".buffer)||"+Rn+"("+It+'.buffer)||("constant" in '+It+"&&(typeof "+It+'.constant==="number"||'+Zr.isArrayLike+"("+It+".constant))))",'invalid dynamic attribute "'+wr+'"')});var Pn={isStream:lr.def(!1)},vi=new Wr;vi.state=Ri,Object.keys(vi).forEach(function(uo){Pn[uo]=lr.def(""+vi[uo])});var Ea=Pn.buffer,ts=Pn.type;lr("if(",Rn,"(",It,")){",Pn.isStream,"=true;",Ea,"=",dn,".createStream(",fd,",",It,");",ts,"=",Ea,".dtype;","}else{",Ea,"=",dn,".getBuffer(",It,");","if(",Ea,"){",ts,"=",Ea,".dtype;",'}else if("constant" in ',It,"){",Pn.state,"=",Qi,";","if(typeof "+It+'.constant === "number"){',Pn[Mn[0]],"=",It,".constant;",Mn.slice(1).map(function(uo){return Pn[uo]}).join("="),"=0;","}else{",Mn.map(function(uo,Do){return Pn[uo]+"="+It+".constant.length>"+Do+"?"+It+".constant["+Do+"]:0;"}).join(""),"}}else{","if(",Rn,"(",It,".buffer)){",Ea,"=",dn,".createStream(",fd,",",It,".buffer);","}else{",Ea,"=",dn,".getBuffer(",It,".buffer);","}",ts,'="type" in ',It,"?",Xr.glTypes,"[",It,".type]:",Ea,".dtype;",Pn.normalized,"=!!",It,".normalized;");function ma(uo){lr(Pn[uo],"=",It,".",uo,"|0;")}return ma("size"),ma("offset"),ma("stride"),ma("divisor"),lr("}}"),lr.exit("if(",Pn.isStream,"){",dn,".destroyStream(",Ea,");","}"),Pn}$r[wr]=_f(ur,Lr)}),$r}function ss(Nt,Et){var gr=Nt.static,Vr=Nt.dynamic;if(Rf in gr){var $r=gr[Rf];return $r!==null&&Ci.getVAO($r)===null&&($r=Ci.createVAO($r)),tc(function(ur){return ur.link(Ci.getVAO($r))})}else if(Rf in Vr){var wr=Vr[Rf];return _f(wr,function(ur,Lr){var Zt=ur.invoke(Lr,wr);return Lr.def(ur.shared.vao+".getVAO("+Zt+")")})}return null}function As(Nt){var Et=Nt.static,gr=Nt.dynamic,Vr={};return Object.keys(Et).forEach(function($r){var wr=Et[$r];Vr[$r]=tc(function(ur,Lr){return typeof wr=="number"||typeof wr=="boolean"?""+wr:ur.link(wr)})}),Object.keys(gr).forEach(function($r){var wr=gr[$r];Vr[$r]=_f(wr,function(ur,Lr){return ur.invoke(Lr,wr)})}),Vr}function Lo(Nt,Et,gr,Vr,$r){var wr=Nt.static,ur=Nt.dynamic;be.optional(function(){var ma=[Ol,ml,mf,ku,ep,qh,cd,Rd,Es,Rf].concat(oi);function uo(Do){Object.keys(Do).forEach(function(Ys){be.command(ma.indexOf(Ys)>=0,'unknown parameter "'+Ys+'"',$r.commandStr)})}uo(wr),uo(ur)});var Lr=Vo(Nt,Et),Zt=sa(Nt,$r),lr=Cs(Nt,Zt,$r),It=Fs(Nt,$r),Zr=xl(Nt,$r),Xr=Go(Nt,$r,Lr);function Rn(ma){var uo=lr[ma];uo&&(Zr[ma]=uo)}Rn(ch),Rn(Ai(Os));var dn=Object.keys(Zr).length>0,Pn={framebuffer:Zt,draw:It,shader:Xr,state:Zr,dirty:dn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Pn.profile=so(Nt,$r),Pn.uniforms=ks(gr,$r),Pn.drawVAO=Pn.scopeVAO=ss(Nt,$r),!Pn.drawVAO&&Xr.program&&!Lr&&Gt.angle_instanced_arrays){var vi=!0,Ea=Xr.program.attributes.map(function(ma){var uo=Et.static[ma];return vi=vi&&!!uo,uo});if(vi&&Ea.length>0){var ts=Ci.getVAO(Ci.createVAO(Ea));Pn.drawVAO=new Fh(null,null,null,function(ma,uo){return ma.link(ts)}),Pn.useVAO=!0}}return Lr?Pn.useVAO=!0:Pn.attributes=Ho(Et,$r),Pn.context=As(Vr,$r),Pn}function Pl(Nt,Et,gr){var Vr=Nt.shared,$r=Vr.context,wr=Nt.scope();Object.keys(gr).forEach(function(ur){Et.save($r,"."+ur);var Lr=gr[ur],Zt=Lr.append(Nt,Et);Array.isArray(Zt)?wr($r,".",ur,"=[",Zt.join(),"];"):wr($r,".",ur,"=",Zt,";")}),Et(wr)}function $l(Nt,Et,gr,Vr){var $r=Nt.shared,wr=$r.gl,ur=$r.framebuffer,Lr;Gi&&(Lr=Et.def($r.extensions,".webgl_draw_buffers"));var Zt=Nt.constants,lr=Zt.drawBuffer,It=Zt.backBuffer,Zr;gr?Zr=gr.append(Nt,Et):Zr=Et.def(ur,".next"),Vr||Et("if(",Zr,"!==",ur,".cur){"),Et("if(",Zr,"){",wr,".bindFramebuffer(",Cd,",",Zr,".framebuffer);"),Gi&&Et(Lr,".drawBuffersWEBGL(",lr,"[",Zr,".colorAttachments.length]);"),Et("}else{",wr,".bindFramebuffer(",Cd,",null);"),Gi&&Et(Lr,".drawBuffersWEBGL(",It,");"),Et("}",ur,".cur=",Zr,";"),Vr||Et("}")}function bu(Nt,Et,gr){var Vr=Nt.shared,$r=Vr.gl,wr=Nt.current,ur=Nt.next,Lr=Vr.current,Zt=Vr.next,lr=Nt.cond(Lr,".dirty");oi.forEach(function(It){var Zr=Ai(It);if(!(Zr in gr.state)){var Xr,Rn;if(Zr in ur){Xr=ur[Zr],Rn=wr[Zr];var dn=ve(Yn[Zr].length,function(vi){return lr.def(Xr,"[",vi,"]")});lr(Nt.cond(dn.map(function(vi,Ea){return vi+"!=="+Rn+"["+Ea+"]"}).join("||")).then($r,".",qn[Zr],"(",dn,");",dn.map(function(vi,Ea){return Rn+"["+Ea+"]="+vi}).join(";"),";"))}else{Xr=lr.def(Zt,".",Zr);var Pn=Nt.cond(Xr,"!==",Lr,".",Zr);lr(Pn),Zr in Di?Pn(Nt.cond(Xr).then($r,".enable(",Di[Zr],");").else($r,".disable(",Di[Zr],");"),Lr,".",Zr,"=",Xr,";"):Pn($r,".",qn[Zr],"(",Xr,");",Lr,".",Zr,"=",Xr,";")}}}),Object.keys(gr.state).length===0&&lr(Lr,".dirty=false;"),Et(lr)}function Hu(Nt,Et,gr,Vr){var $r=Nt.shared,wr=Nt.current,ur=$r.current,Lr=$r.gl;eg(Object.keys(gr)).forEach(function(Zt){var lr=gr[Zt];if(!(Vr&&!Vr(lr))){var It=lr.append(Nt,Et);if(Di[Zt]){var Zr=Di[Zt];yf(lr)?It?Et(Lr,".enable(",Zr,");"):Et(Lr,".disable(",Zr,");"):Et(Nt.cond(It).then(Lr,".enable(",Zr,");").else(Lr,".disable(",Zr,");")),Et(ur,".",Zt,"=",It,";")}else if(Nu(It)){var Xr=wr[Zt];Et(Lr,".",qn[Zt],"(",It,");",It.map(function(Rn,dn){return Xr+"["+dn+"]="+Rn}).join(";"),";")}else Et(Lr,".",qn[Zt],"(",It,");",ur,".",Zt,"=",It,";")}})}function Du(Nt,Et){di&&(Nt.instancing=Et.def(Nt.shared.extensions,".angle_instanced_arrays"))}function Ro(Nt,Et,gr,Vr,$r){var wr=Nt.shared,ur=Nt.stats,Lr=wr.current,Zt=wr.timer,lr=gr.profile;function It(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Zr,Xr;function Rn(ma){Zr=Et.def(),ma(Zr,"=",It(),";"),typeof $r=="string"?ma(ur,".count+=",$r,";"):ma(ur,".count++;"),hi&&(Vr?(Xr=Et.def(),ma(Xr,"=",Zt,".getNumPendingQueries();")):ma(Zt,".beginQuery(",ur,");"))}function dn(ma){ma(ur,".cpuTime+=",It(),"-",Zr,";"),hi&&(Vr?ma(Zt,".pushScopeStats(",Xr,",",Zt,".getNumPendingQueries(),",ur,");"):ma(Zt,".endQuery();"))}function Pn(ma){var uo=Et.def(Lr,".profile");Et(Lr,".profile=",ma,";"),Et.exit(Lr,".profile=",uo,";")}var vi;if(lr){if(yf(lr)){lr.enable?(Rn(Et),dn(Et.exit),Pn("true")):Pn("false");return}vi=lr.append(Nt,Et),Pn(vi)}else vi=Et.def(Lr,".profile");var Ea=Nt.block();Rn(Ea),Et("if(",vi,"){",Ea,"}");var ts=Nt.block();dn(ts),Et.exit("if(",vi,"){",ts,"}")}function Kc(Nt,Et,gr,Vr,$r){var wr=Nt.shared;function ur(Zt){switch(Zt){case Ed:case Ku:case Kd:return 2;case qu:case Ml:case Ju:return 3;case fh:case qp:case Od:return 4;default:return 1}}function Lr(Zt,lr,It){var Zr=wr.gl,Xr=Et.def(Zt,".location"),Rn=Et.def(wr.attributes,"[",Xr,"]"),dn=It.state,Pn=It.buffer,vi=[It.x,It.y,It.z,It.w],Ea=["buffer","normalized","offset","stride"];function ts(){Et("if(!",Rn,".buffer){",Zr,".enableVertexAttribArray(",Xr,");}");var uo=It.type,Do;if(It.size?Do=Et.def(It.size,"||",lr):Do=lr,Et("if(",Rn,".type!==",uo,"||",Rn,".size!==",Do,"||",Ea.map(function(Wl){return Rn+"."+Wl+"!=="+It[Wl]}).join("||"),"){",Zr,".bindBuffer(",fd,",",Pn,".buffer);",Zr,".vertexAttribPointer(",[Xr,Do,uo,It.normalized,It.stride,It.offset],");",Rn,".type=",uo,";",Rn,".size=",Do,";",Ea.map(function(Wl){return Rn+"."+Wl+"="+It[Wl]+";"}).join(""),"}"),di){var Ys=It.divisor;Et("if(",Rn,".divisor!==",Ys,"){",Nt.instancing,".vertexAttribDivisorANGLE(",[Xr,Ys],");",Rn,".divisor=",Ys,";}")}}function ma(){Et("if(",Rn,".buffer){",Zr,".disableVertexAttribArray(",Xr,");",Rn,".buffer=null;","}if(",Mn.map(function(uo,Do){return Rn+"."+uo+"!=="+vi[Do]}).join("||"),"){",Zr,".vertexAttrib4f(",Xr,",",vi,");",Mn.map(function(uo,Do){return Rn+"."+uo+"="+vi[Do]+";"}).join(""),"}")}dn===Ri?ts():dn===Qi?ma():(Et("if(",dn,"===",Ri,"){"),ts(),Et("}else{"),ma(),Et("}"))}Vr.forEach(function(Zt){var lr=Zt.name,It=gr.attributes[lr],Zr;if(It){if(!$r(It))return;Zr=It.append(Nt,Et)}else{if(!$r($v))return;var Xr=Nt.scopeAttrib(lr);be.optional(function(){Nt.assert(Et,Xr+".state","missing attribute "+lr)}),Zr={},Object.keys(new Wr).forEach(function(Rn){Zr[Rn]=Et.def(Xr,".",Rn)})}Lr(Nt.link(Zt),ur(Zt.info.type),Zr)})}function lu(Nt,Et,gr,Vr,$r){for(var wr=Nt.shared,ur=wr.gl,Lr,Zt=0;Zt<Vr.length;++Zt){var lr=Vr[Zt],It=lr.name,Zr=lr.info.type,Xr=gr.uniforms[It],Rn=Nt.link(lr),dn=Rn+".location",Pn;if(Xr){if(!$r(Xr))continue;if(yf(Xr)){var vi=Xr.value;if(be.command(vi!==null&&typeof vi!="undefined",'missing uniform "'+It+'"',Nt.commandStr),Zr===Sh||Zr===Lp){be.command(typeof vi=="function"&&(Zr===Sh&&(vi._reglType==="texture2d"||vi._reglType==="framebuffer")||Zr===Lp&&(vi._reglType==="textureCube"||vi._reglType==="framebufferCube")),"invalid texture for uniform "+It,Nt.commandStr);var Ea=Nt.link(vi._texture||vi.color[0]._texture);Et(ur,".uniform1i(",dn,",",Ea+".bind());"),Et.exit(Ea,".unbind();")}else if(Zr===_s||Zr===vv||Zr===Ac){be.optional(function(){be.command(Nu(vi),"invalid matrix for uniform "+It,Nt.commandStr),be.command(Zr===_s&&vi.length===4||Zr===vv&&vi.length===9||Zr===Ac&&vi.length===16,"invalid length for matrix uniform "+It,Nt.commandStr)});var ts=Nt.global.def("new Float32Array(["+Array.prototype.slice.call(vi)+"])"),ma=2;Zr===vv?ma=3:Zr===Ac&&(ma=4),Et(ur,".uniformMatrix",ma,"fv(",dn,",false,",ts,");")}else{switch(Zr){case Sp:be.commandType(vi,"number","uniform "+It,Nt.commandStr),Lr="1f";break;case Ed:be.command(Nu(vi)&&vi.length===2,"uniform "+It,Nt.commandStr),Lr="2f";break;case qu:be.command(Nu(vi)&&vi.length===3,"uniform "+It,Nt.commandStr),Lr="3f";break;case fh:be.command(Nu(vi)&&vi.length===4,"uniform "+It,Nt.commandStr),Lr="4f";break;case kv:be.commandType(vi,"boolean","uniform "+It,Nt.commandStr),Lr="1i";break;case Oh:be.commandType(vi,"number","uniform "+It,Nt.commandStr),Lr="1i";break;case Kd:be.command(Nu(vi)&&vi.length===2,"uniform "+It,Nt.commandStr),Lr="2i";break;case Ku:be.command(Nu(vi)&&vi.length===2,"uniform "+It,Nt.commandStr),Lr="2i";break;case Ju:be.command(Nu(vi)&&vi.length===3,"uniform "+It,Nt.commandStr),Lr="3i";break;case Ml:be.command(Nu(vi)&&vi.length===3,"uniform "+It,Nt.commandStr),Lr="3i";break;case Od:be.command(Nu(vi)&&vi.length===4,"uniform "+It,Nt.commandStr),Lr="4i";break;case qp:be.command(Nu(vi)&&vi.length===4,"uniform "+It,Nt.commandStr),Lr="4i";break}Et(ur,".uniform",Lr,"(",dn,",",Nu(vi)?Array.prototype.slice.call(vi):vi,");")}continue}else Pn=Xr.append(Nt,Et)}else{if(!$r($v))continue;Pn=Et.def(wr.uniforms,"[",At.id(It),"]")}Zr===Sh?(be(!Array.isArray(Pn),"must specify a scalar prop for textures"),Et("if(",Pn,"&&",Pn,'._reglType==="framebuffer"){',Pn,"=",Pn,".color[0];","}")):Zr===Lp&&(be(!Array.isArray(Pn),"must specify a scalar prop for cube maps"),Et("if(",Pn,"&&",Pn,'._reglType==="framebufferCube"){',Pn,"=",Pn,".color[0];","}")),be.optional(function(){function bf(ph,tv){Nt.assert(Et,ph,'bad data or missing for uniform "'+It+'".  '+tv)}function Iv(ph){be(!Array.isArray(Pn),"must not specify an array type for uniform"),bf("typeof "+Pn+'==="'+ph+'"',"invalid type, expected "+ph)}function Bh(ph,tv){Array.isArray(Pn)?be(Pn.length===ph,"must have length "+ph):bf(wr.isArrayLike+"("+Pn+")&&"+Pn+".length==="+ph,"invalid vector, should have length "+ph,Nt.commandStr)}function Rp(ph){be(!Array.isArray(Pn),"must not specify a value type"),bf("typeof "+Pn+'==="function"&&'+Pn+'._reglType==="texture'+(ph===Df?"2d":"Cube")+'"',"invalid texture type",Nt.commandStr)}switch(Zr){case Oh:Iv("number");break;case Ku:Bh(2,"number");break;case Ml:Bh(3,"number");break;case qp:Bh(4,"number");break;case Sp:Iv("number");break;case Ed:Bh(2,"number");break;case qu:Bh(3,"number");break;case fh:Bh(4,"number");break;case kv:Iv("boolean");break;case Kd:Bh(2,"boolean");break;case Ju:Bh(3,"boolean");break;case Od:Bh(4,"boolean");break;case _s:Bh(4,"number");break;case vv:Bh(9,"number");break;case Ac:Bh(16,"number");break;case Sh:Rp(Df);break;case Lp:Rp(Xd);break}});var uo=1;switch(Zr){case Sh:case Lp:var Do=Et.def(Pn,"._texture");Et(ur,".uniform1i(",dn,",",Do,".bind());"),Et.exit(Do,".unbind();");continue;case Oh:case kv:Lr="1i";break;case Ku:case Kd:Lr="2i",uo=2;break;case Ml:case Ju:Lr="3i",uo=3;break;case qp:case Od:Lr="4i",uo=4;break;case Sp:Lr="1f";break;case Ed:Lr="2f",uo=2;break;case qu:Lr="3f",uo=3;break;case fh:Lr="4f",uo=4;break;case _s:Lr="Matrix2fv";break;case vv:Lr="Matrix3fv";break;case Ac:Lr="Matrix4fv";break}if(Et(ur,".uniform",Lr,"(",dn,","),Lr.charAt(0)==="M"){var Ys=Math.pow(Zr-_s+2,2),Wl=Nt.global.def("new Float32Array(",Ys,")");Array.isArray(Pn)?Et("false,(",ve(Ys,function(bf){return Wl+"["+bf+"]="+Pn[bf]}),",",Wl,")"):Et("false,(Array.isArray(",Pn,")||",Pn," instanceof Float32Array)?",Pn,":(",ve(Ys,function(bf){return Wl+"["+bf+"]="+Pn+"["+bf+"]"}),",",Wl,")")}else uo>1?Et(ve(uo,function(bf){return Array.isArray(Pn)?Pn[bf]:Pn+"["+bf+"]"})):(be(!Array.isArray(Pn),"uniform value must not be an array"),Et(Pn));Et(");")}}function Fa(Nt,Et,gr,Vr){var $r=Nt.shared,wr=$r.gl,ur=$r.draw,Lr=Vr.draw;function Zt(){var Do=Lr.elements,Ys,Wl=Et;return Do?((Do.contextDep&&Vr.contextDynamic||Do.propDep)&&(Wl=gr),Ys=Do.append(Nt,Wl)):Ys=Wl.def(ur,".",ku),Ys&&Wl("if("+Ys+")"+wr+".bindBuffer("+jv+","+Ys+".buffer.buffer);"),Ys}function lr(){var Do=Lr.count,Ys,Wl=Et;return Do?((Do.contextDep&&Vr.contextDynamic||Do.propDep)&&(Wl=gr),Ys=Do.append(Nt,Wl),be.optional(function(){Do.MISSING&&Nt.assert(Et,"false","missing vertex count"),Do.DYNAMIC&&Nt.assert(Wl,Ys+">=0","missing vertex count")})):(Ys=Wl.def(ur,".",cd),be.optional(function(){Nt.assert(Wl,Ys+">=0","missing vertex count")})),Ys}var It=Zt();function Zr(Do){var Ys=Lr[Do];return Ys?Ys.contextDep&&Vr.contextDynamic||Ys.propDep?Ys.append(Nt,gr):Ys.append(Nt,Et):Et.def(ur,".",Do)}var Xr=Zr(ep),Rn=Zr(qh),dn=lr();if(typeof dn=="number"){if(dn===0)return}else gr("if(",dn,"){"),gr.exit("}");var Pn,vi;di&&(Pn=Zr(Rd),vi=Nt.instancing);var Ea=It+".type",ts=Lr.elements&&yf(Lr.elements);function ma(){function Do(){gr(vi,".drawElementsInstancedANGLE(",[Xr,dn,Ea,Rn+"<<(("+Ea+"-"+yi+")>>1)",Pn],");")}function Ys(){gr(vi,".drawArraysInstancedANGLE(",[Xr,Rn,dn,Pn],");")}It?ts?Do():(gr("if(",It,"){"),Do(),gr("}else{"),Ys(),gr("}")):Ys()}function uo(){function Do(){gr(wr+".drawElements("+[Xr,dn,Ea,Rn+"<<(("+Ea+"-"+yi+")>>1)"]+");")}function Ys(){gr(wr+".drawArrays("+[Xr,Rn,dn]+");")}It?ts?Do():(gr("if(",It,"){"),Do(),gr("}else{"),Ys(),gr("}")):Ys()}di&&(typeof Pn!="number"||Pn>=0)?typeof Pn=="string"?(gr("if(",Pn,">0){"),ma(),gr("}else if(",Pn,"<0){"),uo(),gr("}")):ma():uo()}function Ts(Nt,Et,gr,Vr,$r){var wr=mo(),ur=wr.proc("body",$r);return be.optional(function(){wr.commandStr=Et.commandStr,wr.command=wr.link(Et.commandStr)}),di&&(wr.instancing=ur.def(wr.shared.extensions,".angle_instanced_arrays")),Nt(wr,ur,gr,Vr),wr.compile().body}function us(Nt,Et,gr,Vr){Du(Nt,Et),gr.useVAO?gr.drawVAO?Et(Nt.shared.vao,".setVAO(",gr.drawVAO.append(Nt,Et),");"):Et(Nt.shared.vao,".setVAO(",Nt.shared.vao,".targetVAO);"):(Et(Nt.shared.vao,".setVAO(null);"),Kc(Nt,Et,gr,Vr.attributes,function(){return!0})),lu(Nt,Et,gr,Vr.uniforms,function(){return!0}),Fa(Nt,Et,Et,gr)}function Iu(Nt,Et){var gr=Nt.proc("draw",1);Du(Nt,gr),Pl(Nt,gr,Et.context),$l(Nt,gr,Et.framebuffer),bu(Nt,gr,Et),Hu(Nt,gr,Et.state),Ro(Nt,gr,Et,!1,!0);var Vr=Et.shader.progVar.append(Nt,gr);if(gr(Nt.shared.gl,".useProgram(",Vr,".program);"),Et.shader.program)us(Nt,gr,Et,Et.shader.program);else{gr(Nt.shared.vao,".setVAO(null);");var $r=Nt.global.def("{}"),wr=gr.def(Vr,".id"),ur=gr.def($r,"[",wr,"]");gr(Nt.cond(ur).then(ur,".call(this,a0);").else(ur,"=",$r,"[",wr,"]=",Nt.link(function(Lr){return Ts(us,Nt,Et,Lr,1)}),"(",Vr,");",ur,".call(this,a0);"))}Object.keys(Et.state).length>0&&gr(Nt.shared.current,".dirty=true;")}function zh(Nt,Et,gr,Vr){Nt.batchId="a1",Du(Nt,Et);function $r(){return!0}Kc(Nt,Et,gr,Vr.attributes,$r),lu(Nt,Et,gr,Vr.uniforms,$r),Fa(Nt,Et,Et,gr)}function rp(Nt,Et,gr,Vr){Du(Nt,Et);var $r=gr.contextDep,wr=Et.def(),ur="a0",Lr="a1",Zt=Et.def();Nt.shared.props=Zt,Nt.batchId=wr;var lr=Nt.scope(),It=Nt.scope();Et(lr.entry,"for(",wr,"=0;",wr,"<",Lr,";++",wr,"){",Zt,"=",ur,"[",wr,"];",It,"}",lr.exit);function Zr(Ea){return Ea.contextDep&&$r||Ea.propDep}function Xr(Ea){return!Zr(Ea)}if(gr.needsContext&&Pl(Nt,It,gr.context),gr.needsFramebuffer&&$l(Nt,It,gr.framebuffer),Hu(Nt,It,gr.state,Zr),gr.profile&&Zr(gr.profile)&&Ro(Nt,It,gr,!1,!0),Vr)gr.useVAO?gr.drawVAO?Zr(gr.drawVAO)?It(Nt.shared.vao,".setVAO(",gr.drawVAO.append(Nt,It),");"):lr(Nt.shared.vao,".setVAO(",gr.drawVAO.append(Nt,lr),");"):lr(Nt.shared.vao,".setVAO(",Nt.shared.vao,".targetVAO);"):(lr(Nt.shared.vao,".setVAO(null);"),Kc(Nt,lr,gr,Vr.attributes,Xr),Kc(Nt,It,gr,Vr.attributes,Zr)),lu(Nt,lr,gr,Vr.uniforms,Xr),lu(Nt,It,gr,Vr.uniforms,Zr),Fa(Nt,lr,It,gr);else{var Rn=Nt.global.def("{}"),dn=gr.shader.progVar.append(Nt,It),Pn=It.def(dn,".id"),vi=It.def(Rn,"[",Pn,"]");It(Nt.shared.gl,".useProgram(",dn,".program);","if(!",vi,"){",vi,"=",Rn,"[",Pn,"]=",Nt.link(function(Ea){return Ts(zh,Nt,gr,Ea,2)}),"(",dn,");}",vi,".call(this,a0[",wr,"],",wr,");")}}function qt(Nt,Et){var gr=Nt.proc("batch",2);Nt.batchId="0",Du(Nt,gr);var Vr=!1,$r=!0;Object.keys(Et.context).forEach(function(Rn){Vr=Vr||Et.context[Rn].propDep}),Vr||(Pl(Nt,gr,Et.context),$r=!1);var wr=Et.framebuffer,ur=!1;wr?(wr.propDep?Vr=ur=!0:wr.contextDep&&Vr&&(ur=!0),ur||$l(Nt,gr,wr)):$l(Nt,gr,null),Et.state.viewport&&Et.state.viewport.propDep&&(Vr=!0);function Lr(Rn){return Rn.contextDep&&Vr||Rn.propDep}bu(Nt,gr,Et),Hu(Nt,gr,Et.state,function(Rn){return!Lr(Rn)}),(!Et.profile||!Lr(Et.profile))&&Ro(Nt,gr,Et,!1,"a1"),Et.contextDep=Vr,Et.needsContext=$r,Et.needsFramebuffer=ur;var Zt=Et.shader.progVar;if(Zt.contextDep&&Vr||Zt.propDep)rp(Nt,gr,Et,null);else{var lr=Zt.append(Nt,gr);if(gr(Nt.shared.gl,".useProgram(",lr,".program);"),Et.shader.program)rp(Nt,gr,Et,Et.shader.program);else{gr(Nt.shared.vao,".setVAO(null);");var It=Nt.global.def("{}"),Zr=gr.def(lr,".id"),Xr=gr.def(It,"[",Zr,"]");gr(Nt.cond(Xr).then(Xr,".call(this,a0,a1);").else(Xr,"=",It,"[",Zr,"]=",Nt.link(function(Rn){return Ts(rp,Nt,Et,Rn,2)}),"(",lr,");",Xr,".call(this,a0,a1);"))}}Object.keys(Et.state).length>0&&gr(Nt.shared.current,".dirty=true;")}function pn(Nt,Et){var gr=Nt.proc("scope",3);Nt.batchId="a2";var Vr=Nt.shared,$r=Vr.current;Pl(Nt,gr,Et.context),Et.framebuffer&&Et.framebuffer.append(Nt,gr),eg(Object.keys(Et.state)).forEach(function(ur){var Lr=Et.state[ur],Zt=Lr.append(Nt,gr);Nu(Zt)?Zt.forEach(function(lr,It){gr.set(Nt.next[ur],"["+It+"]",lr)}):gr.set(Vr.next,"."+ur,Zt)}),Ro(Nt,gr,Et,!0,!0),[ku,qh,cd,Rd,ep].forEach(function(ur){var Lr=Et.draw[ur];Lr&&gr.set(Vr.draw,"."+ur,""+Lr.append(Nt,gr))}),Object.keys(Et.uniforms).forEach(function(ur){var Lr=Et.uniforms[ur].append(Nt,gr);Array.isArray(Lr)&&(Lr="["+Lr.join()+"]"),gr.set(Vr.uniforms,"["+At.id(ur)+"]",Lr)}),Object.keys(Et.attributes).forEach(function(ur){var Lr=Et.attributes[ur].append(Nt,gr),Zt=Nt.scopeAttrib(ur);Object.keys(new Wr).forEach(function(lr){gr.set(Zt,"."+lr,Lr[lr])})}),Et.scopeVAO&&gr.set(Vr.vao,".targetVAO",Et.scopeVAO.append(Nt,gr));function wr(ur){var Lr=Et.shader[ur];Lr&&gr.set(Vr.shader,"."+ur,Lr.append(Nt,gr))}wr(ml),wr(mf),Object.keys(Et.state).length>0&&(gr($r,".dirty=true;"),gr.exit($r,".dirty=true;")),gr("a1(",Nt.shared.context,",a0,",Nt.batchId,");")}function en(Nt){if(!(typeof Nt!="object"||Nu(Nt))){for(var Et=Object.keys(Nt),gr=0;gr<Et.length;++gr)if(Yi.isDynamic(Nt[Et[gr]]))return!0;return!1}}function ua(Nt,Et,gr){var Vr=Et.static[gr];if(!Vr||!en(Vr))return;var $r=Nt.global,wr=Object.keys(Vr),ur=!1,Lr=!1,Zt=!1,lr=Nt.global.def("{}");wr.forEach(function(Zr){var Xr=Vr[Zr];if(Yi.isDynamic(Xr)){typeof Xr=="function"&&(Xr=Vr[Zr]=Yi.unbox(Xr));var Rn=_f(Xr,null);ur=ur||Rn.thisDep,Zt=Zt||Rn.propDep,Lr=Lr||Rn.contextDep}else{switch($r(lr,".",Zr,"="),typeof Xr){case"number":$r(Xr);break;case"string":$r('"',Xr,'"');break;case"object":Array.isArray(Xr)&&$r("[",Xr.join(),"]");break;default:$r(Nt.link(Xr));break}$r(";")}});function It(Zr,Xr){wr.forEach(function(Rn){var dn=Vr[Rn];if(Yi.isDynamic(dn)){var Pn=Zr.invoke(Xr,dn);Xr(lr,".",Rn,"=",Pn,";")}})}Et.dynamic[gr]=new Yi.DynamicVariable(Ha,{thisDep:ur,contextDep:Lr,propDep:Zt,ref:lr,append:It}),delete Et.static[gr]}function ls(Nt,Et,gr,Vr,$r){var wr=mo();wr.stats=wr.link($r),Object.keys(Et.static).forEach(function(Lr){ua(wr,Et,Lr)}),Pv.forEach(function(Lr){ua(wr,Nt,Lr)});var ur=Lo(Nt,Et,gr,Vr,wr);return Iu(wr,ur),pn(wr,ur),qt(wr,ur),G(wr.compile(),{destroy:function(){ur.shader.program.destroy()}})}return{next:ia,current:Yn,procs:function(){var Nt=mo(),Et=Nt.proc("poll"),gr=Nt.proc("refresh"),Vr=Nt.block();Et(Vr),gr(Vr);var $r=Nt.shared,wr=$r.gl,ur=$r.next,Lr=$r.current;Vr(Lr,".dirty=false;"),$l(Nt,Et),$l(Nt,gr,null,!0);var Zt;di&&(Zt=Nt.link(di)),Gt.oes_vertex_array_object&&gr(Nt.link(Gt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var lr=0;lr<fn.maxAttributes;++lr){var It=gr.def($r.attributes,"[",lr,"]"),Zr=Nt.cond(It,".buffer");Zr.then(wr,".enableVertexAttribArray(",lr,");",wr,".bindBuffer(",fd,",",It,".buffer.buffer);",wr,".vertexAttribPointer(",lr,",",It,".size,",It,".type,",It,".normalized,",It,".stride,",It,".offset);").else(wr,".disableVertexAttribArray(",lr,");",wr,".vertexAttrib4f(",lr,",",It,".x,",It,".y,",It,".z,",It,".w);",It,".buffer=null;"),gr(Zr),di&&gr(Zt,".vertexAttribDivisorANGLE(",lr,",",It,".divisor);")}return gr(Nt.shared.vao,".currentVAO=null;",Nt.shared.vao,".setVAO(",Nt.shared.vao,".targetVAO);"),Object.keys(Di).forEach(function(Xr){var Rn=Di[Xr],dn=Vr.def(ur,".",Xr),Pn=Nt.block();Pn("if(",dn,"){",wr,".enable(",Rn,")}else{",wr,".disable(",Rn,")}",Lr,".",Xr,"=",dn,";"),gr(Pn),Et("if(",dn,"!==",Lr,".",Xr,"){",Pn,"}")}),Object.keys(qn).forEach(function(Xr){var Rn=qn[Xr],dn=Yn[Xr],Pn,vi,Ea=Nt.block();if(Ea(wr,".",Rn,"("),Nu(dn)){var ts=dn.length;Pn=Nt.global.def(ur,".",Xr),vi=Nt.global.def(Lr,".",Xr),Ea(ve(ts,function(ma){return Pn+"["+ma+"]"}),");",ve(ts,function(ma){return vi+"["+ma+"]="+Pn+"["+ma+"];"}).join("")),Et("if(",ve(ts,function(ma){return Pn+"["+ma+"]!=="+vi+"["+ma+"]"}).join("||"),"){",Ea,"}")}else Pn=Vr.def(ur,".",Xr),vi=Vr.def(Lr,".",Xr),Ea(Pn,");",Lr,".",Xr,"=",Pn,";"),Et("if(",Pn,"!==",vi,"){",Ea,"}");gr(Ea)}),Nt.compile()}(),compile:ls}}function zl(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Wv=34918,al=34919,Xv=35007,Qd=function(ze,At){if(!At.ext_disjoint_timer_query)return null;var Gt=[];function fn(){return Gt.pop()||At.ext_disjoint_timer_query.createQueryEXT()}function Dn(di){Gt.push(di)}var ln=[];function _n(di){var Gi=fn();At.ext_disjoint_timer_query.beginQueryEXT(Xv,Gi),ln.push(Gi),hi(ln.length-1,ln.length,di)}function Zn(){At.ext_disjoint_timer_query.endQueryEXT(Xv)}function ri(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Ci=[];function _i(){return Ci.pop()||new ri}function Li(di){Ci.push(di)}var Fi=[];function hi(di,Gi,Yn){var ia=_i();ia.startQueryIndex=di,ia.endQueryIndex=Gi,ia.sum=0,ia.stats=Yn,Fi.push(ia)}var ki=[],Wr=[];function bn(){var di,Gi,Yn=ln.length;if(Yn!==0){Wr.length=Math.max(Wr.length,Yn+1),ki.length=Math.max(ki.length,Yn+1),ki[0]=0,Wr[0]=0;var ia=0;for(di=0,Gi=0;Gi<ln.length;++Gi){var oi=ln[Gi];At.ext_disjoint_timer_query.getQueryObjectEXT(oi,al)?(ia+=At.ext_disjoint_timer_query.getQueryObjectEXT(oi,Wv),Dn(oi)):ln[di++]=oi,ki[Gi+1]=ia,Wr[Gi+1]=di}for(ln.length=di,di=0,Gi=0;Gi<Fi.length;++Gi){var Di=Fi[Gi],qn=Di.startQueryIndex,Ai=Di.endQueryIndex;Di.sum+=ki[Ai]-ki[qn];var Oa=Wr[qn],Ya=Wr[Ai];Ya===Oa?(Di.stats.gpuTime+=Di.sum/1e6,Li(Di)):(Di.startQueryIndex=Oa,Di.endQueryIndex=Ya,Fi[di++]=Di)}Fi.length=di}}return{beginQuery:_n,endQuery:Zn,pushScopeStats:hi,update:bn,getNumPendingQueries:function(){return ln.length},clear:function(){Gt.push.apply(Gt,ln);for(var di=0;di<Gt.length;di++)At.ext_disjoint_timer_query.deleteQueryEXT(Gt[di]);ln.length=0,Gt.length=0},restore:function(){ln.length=0,Gt.length=0}}},yv=16384,_g=256,mm=1024,bg=34962,Kp="webglcontextlost",Bm="webglcontextrestored",Ad=1,ev=2,Fc=3;function tp(ze,At){for(var Gt=0;Gt<ze.length;++Gt)if(ze[Gt]===At)return Gt;return-1}function Nd(ze){var At=qe(ze);if(!At)return null;var Gt=At.gl,fn=Gt.getContextAttributes(),Dn=Gt.isContextLost(),ln=se(Gt,At);if(!ln)return null;var _n=Xn(),Zn=zl(),ri=ln.extensions,Ci=Qd(Gt,ri),_i=on(),Li=Gt.drawingBufferWidth,Fi=Gt.drawingBufferHeight,hi={tick:0,time:0,viewportWidth:Li,viewportHeight:Fi,framebufferWidth:Li,framebufferHeight:Fi,drawingBufferWidth:Li,drawingBufferHeight:Fi,pixelRatio:At.pixelRatio},ki={},Wr={elements:null,primitive:4,count:-1,offset:0,instances:-1},bn=zu(Gt,ri),di=Hf(Gt,Zn,At,Yn),Gi=He(Gt,ri,bn,Zn,di);function Yn(Fa){return Gi.destroyBuffer(Fa)}var ia=af(Gt,ri,di,Zn),oi=dt(Gt,_n,Zn,At),Di=Dl(Gt,ri,bn,function(){Oa.procs.poll()},hi,Zn,At),qn=df(Gt,ri,bn,Zn,At),Ai=oe(Gt,ri,bn,Di,qn,Zn),Oa=vm(Gt,_n,ri,bn,di,ia,Di,Ai,ki,Gi,oi,Wr,hi,Ci,At),Ya=_r(Gt,Ai,Oa.procs.poll,hi,fn,ri,bn),Oi=Oa.next,Qn=Gt.canvas,Hn=[],mo=[],so=[],sa=[At.onDestroy],Cs=null;function Vo(){if(Hn.length===0){Ci&&Ci.update(),Cs=null;return}Cs=ea.next(Vo),Hu();for(var Fa=Hn.length-1;Fa>=0;--Fa){var Ts=Hn[Fa];Ts&&Ts(hi,null,0)}Gt.flush(),Ci&&Ci.update()}function Go(){!Cs&&Hn.length>0&&(Cs=ea.next(Vo))}function Fs(){Cs&&(ea.cancel(Vo),Cs=null)}function xl(Fa){Fa.preventDefault(),Dn=!0,Fs(),mo.forEach(function(Ts){Ts()})}function ks(Fa){Gt.getError(),Dn=!1,ln.restore(),oi.restore(),di.restore(),Di.restore(),qn.restore(),Ai.restore(),Gi.restore(),Ci&&Ci.restore(),Oa.procs.refresh(),Go(),so.forEach(function(Ts){Ts()})}Qn&&(Qn.addEventListener(Kp,xl,!1),Qn.addEventListener(Bm,ks,!1));function Ho(){Hn.length=0,Fs(),Qn&&(Qn.removeEventListener(Kp,xl),Qn.removeEventListener(Bm,ks)),oi.clear(),Ai.clear(),qn.clear(),Di.clear(),ia.clear(),di.clear(),Gi.clear(),Ci&&Ci.clear(),sa.forEach(function(Fa){Fa()})}function ss(Fa){be(!!Fa,"invalid args to regl({...})"),be.type(Fa,"object","invalid args to regl({...})");function Ts($r){var wr=G({},$r);delete wr.uniforms,delete wr.attributes,delete wr.context,delete wr.vao,"stencil"in wr&&wr.stencil.op&&(wr.stencil.opBack=wr.stencil.opFront=wr.stencil.op,delete wr.stencil.op);function ur(Lr){if(Lr in wr){var Zt=wr[Lr];delete wr[Lr],Object.keys(Zt).forEach(function(lr){wr[Lr+"."+lr]=Zt[lr]})}}return ur("blend"),ur("depth"),ur("cull"),ur("stencil"),ur("polygonOffset"),ur("scissor"),ur("sample"),"vao"in $r&&(wr.vao=$r.vao),wr}function us($r,wr){var ur={},Lr={};return Object.keys($r).forEach(function(Zt){var lr=$r[Zt];if(Yi.isDynamic(lr)){Lr[Zt]=Yi.unbox(lr,Zt);return}else if(wr&&Array.isArray(lr)){for(var It=0;It<lr.length;++It)if(Yi.isDynamic(lr[It])){Lr[Zt]=Yi.unbox(lr,Zt);return}}ur[Zt]=lr}),{dynamic:Lr,static:ur}}var Iu=us(Fa.context||{},!0),zh=us(Fa.uniforms||{},!0),rp=us(Fa.attributes||{},!1),qt=us(Ts(Fa),!1),pn={gpuTime:0,cpuTime:0,count:0},en=Oa.compile(qt,rp,zh,Iu,pn),ua=en.draw,ls=en.batch,Nt=en.scope,Et=[];function gr($r){for(;Et.length<$r;)Et.push(null);return Et}function Vr($r,wr){var ur;if(Dn&&be.raise("context lost"),typeof $r=="function")return Nt.call(this,null,$r,0);if(typeof wr=="function")if(typeof $r=="number")for(ur=0;ur<$r;++ur)Nt.call(this,null,wr,ur);else if(Array.isArray($r))for(ur=0;ur<$r.length;++ur)Nt.call(this,$r[ur],wr,ur);else return Nt.call(this,$r,wr,0);else if(typeof $r=="number"){if($r>0)return ls.call(this,gr($r|0),$r|0)}else if(Array.isArray($r)){if($r.length)return ls.call(this,$r,$r.length)}else return ua.call(this,$r)}return G(Vr,{stats:pn,destroy:function(){en.destroy()}})}var As=Ai.setFBO=ss({framebuffer:Yi.define.call(null,Ad,"framebuffer")});function Lo(Fa,Ts){var us=0;Oa.procs.poll();var Iu=Ts.color;Iu&&(Gt.clearColor(+Iu[0]||0,+Iu[1]||0,+Iu[2]||0,+Iu[3]||0),us|=yv),"depth"in Ts&&(Gt.clearDepth(+Ts.depth),us|=_g),"stencil"in Ts&&(Gt.clearStencil(Ts.stencil|0),us|=mm),be(!!us,"called regl.clear with no buffer specified"),Gt.clear(us)}function Pl(Fa){if(be(typeof Fa=="object"&&Fa,"regl.clear() takes an object as input"),"framebuffer"in Fa)if(Fa.framebuffer&&Fa.framebuffer_reglType==="framebufferCube")for(var Ts=0;Ts<6;++Ts)As(G({framebuffer:Fa.framebuffer.faces[Ts]},Fa),Lo);else As(Fa,Lo);else Lo(null,Fa)}function $l(Fa){be.type(Fa,"function","regl.frame() callback must be a function"),Hn.push(Fa);function Ts(){var us=tp(Hn,Fa);be(us>=0,"cannot cancel a frame twice");function Iu(){var zh=tp(Hn,Iu);Hn[zh]=Hn[Hn.length-1],Hn.length-=1,Hn.length<=0&&Fs()}Hn[us]=Iu}return Go(),{cancel:Ts}}function bu(){var Fa=Oi.viewport,Ts=Oi.scissor_box;Fa[0]=Fa[1]=Ts[0]=Ts[1]=0,hi.viewportWidth=hi.framebufferWidth=hi.drawingBufferWidth=Fa[2]=Ts[2]=Gt.drawingBufferWidth,hi.viewportHeight=hi.framebufferHeight=hi.drawingBufferHeight=Fa[3]=Ts[3]=Gt.drawingBufferHeight}function Hu(){hi.tick+=1,hi.time=Ro(),bu(),Oa.procs.poll()}function Du(){Di.refresh(),bu(),Oa.procs.refresh(),Ci&&Ci.update()}function Ro(){return(on()-_i)/1e3}Du();function Kc(Fa,Ts){be.type(Ts,"function","listener callback must be a function");var us;switch(Fa){case"frame":return $l(Ts);case"lost":us=mo;break;case"restore":us=so;break;case"destroy":us=sa;break;default:be.raise("invalid event, must be one of frame,lost,restore,destroy")}return us.push(Ts),{cancel:function(){for(var Iu=0;Iu<us.length;++Iu)if(us[Iu]===Ts){us[Iu]=us[us.length-1],us.pop();return}}}}var lu=G(ss,{clear:Pl,prop:Yi.define.bind(null,Ad),context:Yi.define.bind(null,ev),this:Yi.define.bind(null,Fc),draw:ss({}),buffer:function(Fa){return di.create(Fa,bg,!1,!1)},elements:function(Fa){return ia.create(Fa,!1)},texture:Di.create2D,cube:Di.createCube,renderbuffer:qn.create,framebuffer:Ai.create,framebufferCube:Ai.createCube,vao:Gi.createVAO,attributes:fn,frame:$l,on:Kc,limits:bn,hasExtension:function(Fa){return bn.extensions.indexOf(Fa.toLowerCase())>=0},read:Ya,destroy:Ho,_gl:Gt,_refresh:Du,poll:function(){Hu(),Ci&&Ci.update()},now:Ro,stats:Zn});return At.onDone(null,lu),lu}return Nd})},86851:function(Ue,_e,G){"use strict";var K=G(35171),j=Array.prototype.concat,P=Array.prototype.slice,M=Ue.exports=function(te){for(var pe=[],Ce=0,le=te.length;Ce<le;Ce++){var Ie=te[Ce];K(Ie)?pe=j.call(pe,P.call(Ie)):pe.push(Ie)}return pe};M.wrap=function(ee){return function(){return ee(M(arguments))}}},69848:function(Ue){(function(_e,G){Ue.exports=G()})(this,function(){"use strict";function _e(rr,Jt,br,or,Br,an){if(!(Br-or<=br)){var ot=or+Br>>1;G(rr,Jt,ot,or,Br,an%2),_e(rr,Jt,br,or,ot-1,an+1),_e(rr,Jt,br,ot+1,Br,an+1)}}function G(rr,Jt,br,or,Br,an){for(;Br>or;){if(Br-or>600){var ot=Br-or+1,Dt=br-or+1,Ee=Math.log(ot),Bt=.5*Math.exp(2*Ee/3),Ot=.5*Math.sqrt(Ee*Bt*(ot-Bt)/ot)*(Dt-ot/2<0?-1:1),Pr=Math.max(or,Math.floor(br-Dt*Bt/ot+Ot)),Fr=Math.min(Br,Math.floor(br+(ot-Dt)*Bt/ot+Ot));G(rr,Jt,br,Pr,Fr,an)}var Nr=Jt[2*br+an],hn=or,xn=Br;for(K(rr,Jt,or,br),Jt[2*Br+an]>Nr&&K(rr,Jt,or,Br);hn<xn;){for(K(rr,Jt,hn,xn),hn++,xn--;Jt[2*hn+an]<Nr;)hn++;for(;Jt[2*xn+an]>Nr;)xn--}Jt[2*or+an]===Nr?K(rr,Jt,or,xn):(xn++,K(rr,Jt,xn,Br)),xn<=br&&(or=xn+1),br<=xn&&(Br=xn-1)}}function K(rr,Jt,br,or){j(rr,br,or),j(Jt,2*br,2*or),j(Jt,2*br+1,2*or+1)}function j(rr,Jt,br){var or=rr[Jt];rr[Jt]=rr[br],rr[br]=or}function P(rr,Jt,br,or,Br,an,ot){for(var Dt=[0,rr.length-1,0],Ee=[],Bt,Ot;Dt.length;){var Pr=Dt.pop(),Fr=Dt.pop(),Nr=Dt.pop();if(Fr-Nr<=ot){for(var hn=Nr;hn<=Fr;hn++)Bt=Jt[2*hn],Ot=Jt[2*hn+1],Bt>=br&&Bt<=Br&&Ot>=or&&Ot<=an&&Ee.push(rr[hn]);continue}var xn=Math.floor((Nr+Fr)/2);Bt=Jt[2*xn],Ot=Jt[2*xn+1],Bt>=br&&Bt<=Br&&Ot>=or&&Ot<=an&&Ee.push(rr[xn]);var Ji=(Pr+1)%2;(Pr===0?br<=Bt:or<=Ot)&&(Dt.push(Nr),Dt.push(xn-1),Dt.push(Ji)),(Pr===0?Br>=Bt:an>=Ot)&&(Dt.push(xn+1),Dt.push(Fr),Dt.push(Ji))}return Ee}function M(rr,Jt,br,or,Br,an){for(var ot=[0,rr.length-1,0],Dt=[],Ee=Br*Br;ot.length;){var Bt=ot.pop(),Ot=ot.pop(),Pr=ot.pop();if(Ot-Pr<=an){for(var Fr=Pr;Fr<=Ot;Fr++)ee(Jt[2*Fr],Jt[2*Fr+1],br,or)<=Ee&&Dt.push(rr[Fr]);continue}var Nr=Math.floor((Pr+Ot)/2),hn=Jt[2*Nr],xn=Jt[2*Nr+1];ee(hn,xn,br,or)<=Ee&&Dt.push(rr[Nr]);var Ji=(Bt+1)%2;(Bt===0?br-Br<=hn:or-Br<=xn)&&(ot.push(Pr),ot.push(Nr-1),ot.push(Ji)),(Bt===0?br+Br>=hn:or+Br>=xn)&&(ot.push(Nr+1),ot.push(Ot),ot.push(Ji))}return Dt}function ee(rr,Jt,br,or){var Br=rr-br,an=Jt-or;return Br*Br+an*an}var te=function(rr){return rr[0]},pe=function(rr){return rr[1]},Ce=function(Jt,br,or,Br,an){br===void 0&&(br=te),or===void 0&&(or=pe),Br===void 0&&(Br=64),an===void 0&&(an=Float64Array),this.nodeSize=Br,this.points=Jt;for(var ot=Jt.length<65536?Uint16Array:Uint32Array,Dt=this.ids=new ot(Jt.length),Ee=this.coords=new an(Jt.length*2),Bt=0;Bt<Jt.length;Bt++)Dt[Bt]=Bt,Ee[2*Bt]=br(Jt[Bt]),Ee[2*Bt+1]=or(Jt[Bt]);_e(Dt,Ee,Br,0,Dt.length-1,0)};Ce.prototype.range=function(Jt,br,or,Br){return P(this.ids,this.coords,Jt,br,or,Br,this.nodeSize)},Ce.prototype.within=function(Jt,br,or){return M(this.ids,this.coords,Jt,br,or,this.nodeSize)};var le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(rr){return rr}},Ie=Math.fround||function(rr){return function(Jt){return rr[0]=+Jt,rr[0]}}(new Float32Array(1)),rt=function(Jt){this.options=gn(Object.create(le),Jt),this.trees=new Array(this.options.maxZoom+1)};rt.prototype.load=function(Jt){var br=this.options,or=br.log,Br=br.minZoom,an=br.maxZoom,ot=br.nodeSize;or&&console.time("total time");var Dt="prepare "+Jt.length+" points";or&&console.time(Dt),this.points=Jt;for(var Ee=[],Bt=0;Bt<Jt.length;Bt++)Jt[Bt].geometry&&Ee.push(nt(Jt[Bt],Bt));this.trees[an+1]=new Ce(Ee,Rr,vn,ot,Float32Array),or&&console.timeEnd(Dt);for(var Ot=an;Ot>=Br;Ot--){var Pr=+Date.now();Ee=this._cluster(Ee,Ot),this.trees[Ot]=new Ce(Ee,Rr,vn,ot,Float32Array),or&&console.log("z%d: %d clusters in %dms",Ot,Ee.length,+Date.now()-Pr)}return or&&console.timeEnd("total time"),this},rt.prototype.getClusters=function(Jt,br){var or=((Jt[0]+180)%360+360)%360-180,Br=Math.max(-90,Math.min(90,Jt[1])),an=Jt[2]===180?180:((Jt[2]+180)%360+360)%360-180,ot=Math.max(-90,Math.min(90,Jt[3]));if(Jt[2]-Jt[0]>=360)or=-180,an=180;else if(or>an){var Dt=this.getClusters([or,Br,180,ot],br),Ee=this.getClusters([-180,Br,an,ot],br);return Dt.concat(Ee)}for(var Bt=this.trees[this._limitZoom(br)],Ot=Bt.range(Vt(or),Rt(ot),Vt(an),Rt(Br)),Pr=[],Fr=0,Nr=Ot;Fr<Nr.length;Fr+=1){var hn=Nr[Fr],xn=Bt.points[hn];Pr.push(xn.numPoints?Ct(xn):this.points[xn.index])}return Pr},rt.prototype.getChildren=function(Jt){var br=this._getOriginId(Jt),or=this._getOriginZoom(Jt),Br="No cluster with the specified id.",an=this.trees[or];if(!an)throw new Error(Br);var ot=an.points[br];if(!ot)throw new Error(Br);for(var Dt=this.options.radius/(this.options.extent*Math.pow(2,or-1)),Ee=an.within(ot.x,ot.y,Dt),Bt=[],Ot=0,Pr=Ee;Ot<Pr.length;Ot+=1){var Fr=Pr[Ot],Nr=an.points[Fr];Nr.parentId===Jt&&Bt.push(Nr.numPoints?Ct(Nr):this.points[Nr.index])}if(Bt.length===0)throw new Error(Br);return Bt},rt.prototype.getLeaves=function(Jt,br,or){br=br||10,or=or||0;var Br=[];return this._appendLeaves(Br,Jt,br,or,0),Br},rt.prototype.getTile=function(Jt,br,or){var Br=this.trees[this._limitZoom(Jt)],an=Math.pow(2,Jt),ot=this.options,Dt=ot.extent,Ee=ot.radius,Bt=Ee/Dt,Ot=(or-Bt)/an,Pr=(or+1+Bt)/an,Fr={features:[]};return this._addTileFeatures(Br.range((br-Bt)/an,Ot,(br+1+Bt)/an,Pr),Br.points,br,or,an,Fr),br===0&&this._addTileFeatures(Br.range(1-Bt/an,Ot,1,Pr),Br.points,an,or,an,Fr),br===an-1&&this._addTileFeatures(Br.range(0,Ot,Bt/an,Pr),Br.points,-1,or,an,Fr),Fr.features.length?Fr:null},rt.prototype.getClusterExpansionZoom=function(Jt){for(var br=this._getOriginZoom(Jt)-1;br<=this.options.maxZoom;){var or=this.getChildren(Jt);if(br++,or.length!==1)break;Jt=or[0].properties.cluster_id}return br},rt.prototype._appendLeaves=function(Jt,br,or,Br,an){for(var ot=this.getChildren(br),Dt=0,Ee=ot;Dt<Ee.length;Dt+=1){var Bt=Ee[Dt],Ot=Bt.properties;if(Ot&&Ot.cluster?an+Ot.point_count<=Br?an+=Ot.point_count:an=this._appendLeaves(Jt,Ot.cluster_id,or,Br,an):an<Br?an++:Jt.push(Bt),Jt.length===or)break}return an},rt.prototype._addTileFeatures=function(Jt,br,or,Br,an,ot){for(var Dt=0,Ee=Jt;Dt<Ee.length;Dt+=1){var Bt=Ee[Dt],Ot=br[Bt],Pr=Ot.numPoints,Fr=void 0,Nr=void 0,hn=void 0;if(Pr)Fr=jt(Ot),Nr=Ot.x,hn=Ot.y;else{var xn=this.points[Ot.index];Fr=xn.properties,Nr=Vt(xn.geometry.coordinates[0]),hn=Rt(xn.geometry.coordinates[1])}var Ji={type:1,geometry:[[Math.round(this.options.extent*(Nr*an-or)),Math.round(this.options.extent*(hn*an-Br))]],tags:Fr},pi=void 0;Pr?pi=Ot.id:this.options.generateId?pi=Ot.index:this.points[Ot.index].id&&(pi=this.points[Ot.index].id),pi!==void 0&&(Ji.id=pi),ot.features.push(Ji)}},rt.prototype._limitZoom=function(Jt){return Math.max(this.options.minZoom,Math.min(Math.floor(+Jt),this.options.maxZoom+1))},rt.prototype._cluster=function(Jt,br){for(var or=[],Br=this.options,an=Br.radius,ot=Br.extent,Dt=Br.reduce,Ee=Br.minPoints,Bt=an/(ot*Math.pow(2,br)),Ot=0;Ot<Jt.length;Ot++){var Pr=Jt[Ot];if(!(Pr.zoom<=br)){Pr.zoom=br;for(var Fr=this.trees[br+1],Nr=Fr.within(Pr.x,Pr.y,Bt),hn=Pr.numPoints||1,xn=hn,Ji=0,pi=Nr;Ji<pi.length;Ji+=1){var Ka=pi[Ji],na=Fr.points[Ka];na.zoom>br&&(xn+=na.numPoints||1)}if(xn>hn&&xn>=Ee){for(var ca=Pr.x*hn,po=Pr.y*hn,La=Dt&&hn>1?this._map(Pr,!0):null,$i=(Ot<<5)+(br+1)+this.points.length,qo=0,is=Nr;qo<is.length;qo+=1){var Ko=is[qo],Za=Fr.points[Ko];if(!(Za.zoom<=br)){Za.zoom=br;var ha=Za.numPoints||1;ca+=Za.x*ha,po+=Za.y*ha,Za.parentId=$i,Dt&&(La||(La=this._map(Pr,!0)),Dt(La,this._map(Za)))}}Pr.parentId=$i,or.push(xt(ca/xn,po/xn,$i,xn,La))}else if(or.push(Pr),xn>1)for(var Fo=0,un=Nr;Fo<un.length;Fo+=1){var Ua=un[Fo],zr=Fr.points[Ua];zr.zoom<=br||(zr.zoom=br,or.push(zr))}}}return or},rt.prototype._getOriginId=function(Jt){return Jt-this.points.length>>5},rt.prototype._getOriginZoom=function(Jt){return(Jt-this.points.length)%32},rt.prototype._map=function(Jt,br){if(Jt.numPoints)return br?gn({},Jt.properties):Jt.properties;var or=this.points[Jt.index].properties,Br=this.options.map(or);return br&&Br===or?gn({},Br):Br};function xt(rr,Jt,br,or,Br){return{x:Ie(rr),y:Ie(Jt),zoom:1/0,id:br,parentId:-1,numPoints:or,properties:Br}}function nt(rr,Jt){var br=rr.geometry.coordinates,or=br[0],Br=br[1];return{x:Ie(Vt(or)),y:Ie(Rt(Br)),zoom:1/0,index:Jt,parentId:-1}}function Ct(rr){return{type:"Feature",id:rr.id,properties:jt(rr),geometry:{type:"Point",coordinates:[hr(rr.x),er(rr.y)]}}}function jt(rr){var Jt=rr.numPoints,br=Jt>=1e4?Math.round(Jt/1e3)+"k":Jt>=1e3?Math.round(Jt/100)/10+"k":Jt;return gn(gn({},rr.properties),{cluster:!0,cluster_id:rr.id,point_count:Jt,point_count_abbreviated:br})}function Vt(rr){return rr/360+.5}function Rt(rr){var Jt=Math.sin(rr*Math.PI/180),br=.5-.25*Math.log((1+Jt)/(1-Jt))/Math.PI;return br<0?0:br>1?1:br}function hr(rr){return(rr-.5)*360}function er(rr){var Jt=(180-rr*360)*Math.PI/180;return 360*Math.atan(Math.exp(Jt))/Math.PI-90}function gn(rr,Jt){for(var br in Jt)rr[br]=Jt[br];return rr}function Rr(rr){return rr.x}function vn(rr){return rr.y}return rt})},64687:function(Ue,_e,G){var K=G(17061)();Ue.exports=K;try{regeneratorRuntime=K}catch(j){typeof globalThis=="object"?globalThis.regeneratorRuntime=K:Function("r","regeneratorRuntime = r")(K)}},24613:function(Ue){(function(_e,G){Ue.exports=G()})(this,function(){"use strict";var _e,G,K;function j(M,ee){if(!_e)_e=ee;else if(!G)G=ee;else{var te="var sharedChunk = {}; ("+_e+")(sharedChunk); ("+G+")(sharedChunk);",pe={};_e(pe),K=ee(pe),typeof window!="undefined"&&(K.workerUrl=window.URL.createObjectURL(new Blob([te],{type:"text/javascript"})))}}j(["exports"],function(M){"use strict";function ee(v,c,b,k){return new(b||(b=Promise))(function(z,V){function W(Se){try{he(k.next(Se))}catch(Ne){V(Ne)}}function ne(Se){try{he(k.throw(Se))}catch(Ne){V(Ne)}}function he(Se){var Ne;Se.done?z(Se.value):(Ne=Se.value,Ne instanceof b?Ne:new b(function(We){We(Ne)})).then(W,ne)}he((k=k.apply(v,c||[])).next())})}function te(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}typeof SuppressedError=="function"&&SuppressedError;var pe=Ce;function Ce(v,c){this.x=v,this.y=c}Ce.prototype={clone:function(){return new Ce(this.x,this.y)},add:function(v){return this.clone()._add(v)},sub:function(v){return this.clone()._sub(v)},multByPoint:function(v){return this.clone()._multByPoint(v)},divByPoint:function(v){return this.clone()._divByPoint(v)},mult:function(v){return this.clone()._mult(v)},div:function(v){return this.clone()._div(v)},rotate:function(v){return this.clone()._rotate(v)},rotateAround:function(v,c){return this.clone()._rotateAround(v,c)},matMult:function(v){return this.clone()._matMult(v)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(v){return this.x===v.x&&this.y===v.y},dist:function(v){return Math.sqrt(this.distSqr(v))},distSqr:function(v){var c=v.x-this.x,b=v.y-this.y;return c*c+b*b},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith:function(v){return this.angleWithSep(v.x,v.y)},angleWithSep:function(v,c){return Math.atan2(this.x*c-this.y*v,this.x*v+this.y*c)},_matMult:function(v){var c=v[2]*this.x+v[3]*this.y;return this.x=v[0]*this.x+v[1]*this.y,this.y=c,this},_add:function(v){return this.x+=v.x,this.y+=v.y,this},_sub:function(v){return this.x-=v.x,this.y-=v.y,this},_mult:function(v){return this.x*=v,this.y*=v,this},_div:function(v){return this.x/=v,this.y/=v,this},_multByPoint:function(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint:function(v){return this.x/=v.x,this.y/=v.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var v=this.y;return this.y=this.x,this.x=-v,this},_rotate:function(v){var c=Math.cos(v),b=Math.sin(v),k=b*this.x+c*this.y;return this.x=c*this.x-b*this.y,this.y=k,this},_rotateAround:function(v,c){var b=Math.cos(v),k=Math.sin(v),z=c.y+k*(this.x-c.x)+b*(this.y-c.y);return this.x=c.x+b*(this.x-c.x)-k*(this.y-c.y),this.y=z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ce.convert=function(v){return v instanceof Ce?v:Array.isArray(v)?new Ce(v[0],v[1]):v};var le=te(pe),Ie=rt;function rt(v,c,b,k){this.cx=3*v,this.bx=3*(b-v)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(k-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=v,this.p1y=c,this.p2x=b,this.p2y=k}rt.prototype={sampleCurveX:function(v){return((this.ax*v+this.bx)*v+this.cx)*v},sampleCurveY:function(v){return((this.ay*v+this.by)*v+this.cy)*v},sampleCurveDerivativeX:function(v){return(3*this.ax*v+2*this.bx)*v+this.cx},solveCurveX:function(v,c){if(c===void 0&&(c=1e-6),v<0)return 0;if(v>1)return 1;for(var b=v,k=0;k<8;k++){var z=this.sampleCurveX(b)-v;if(Math.abs(z)<c)return b;var V=this.sampleCurveDerivativeX(b);if(Math.abs(V)<1e-6)break;b-=z/V}var W=0,ne=1;for(b=v,k=0;k<20&&(z=this.sampleCurveX(b),!(Math.abs(z-v)<c));k++)v>z?W=b:ne=b,b=.5*(ne-W)+W;return b},solve:function(v,c){return this.sampleCurveY(this.solveCurveX(v,c))}};var xt=te(Ie);let nt,Ct;function jt(){return nt==null&&(nt=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),nt}function Vt(){if(Ct==null&&(Ct=!1,jt())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let k=0;k<5*5;k++){const z=4*k;c.fillStyle=`rgb(${z},${z+1},${z+2})`,c.fillRect(k%5,Math.floor(k/5),1,1)}const b=c.getImageData(0,0,5,5).data;for(let k=0;k<5*5*4;k++)if(k%4!=3&&b[k]!==k){Ct=!0;break}}}return Ct||!1}function Rt(v,c,b,k){const z=new xt(v,c,b,k);return function(V){return z.solve(V)}}const hr=Rt(.25,.1,.25,1);function er(v,c,b){return Math.min(b,Math.max(c,v))}function gn(v,c,b){const k=b-c,z=((v-c)%k+k)%k+c;return z===c?b:z}function Rr(v,...c){for(const b of c)for(const k in b)v[k]=b[k];return v}let vn=1;function rr(v,c,b){const k={};for(const z in v)k[z]=c.call(b||this,v[z],z,v);return k}function Jt(v,c,b){const k={};for(const z in v)c.call(b||this,v[z],z,v)&&(k[z]=v[z]);return k}function br(v){return Array.isArray(v)?v.map(br):typeof v=="object"&&v?rr(v,br):v}const or={};function Br(v){or[v]||(typeof console!="undefined"&&console.warn(v),or[v]=!0)}function an(v,c,b){return(b.y-v.y)*(c.x-v.x)>(c.y-v.y)*(b.x-v.x)}function ot(v){let c=0;for(let b,k,z=0,V=v.length,W=V-1;z<V;W=z++)b=v[z],k=v[W],c+=(k.x-b.x)*(b.y+k.y);return c}function Dt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}let Ee=null;function Bt(v){return typeof ImageBitmap!="undefined"&&v instanceof ImageBitmap}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pr(v,c,b,k,z){return ee(this,void 0,void 0,function*(){if(typeof VideoFrame=="undefined")throw new Error("VideoFrame not supported");const V=new VideoFrame(v,{timestamp:0});try{const W=V==null?void 0:V.format;if(!W||!W.startsWith("BGR")&&!W.startsWith("RGB"))throw new Error(`Unrecognized format ${W}`);const ne=W.startsWith("BGR"),he=new Uint8ClampedArray(k*z*4);if(yield V.copyTo(he,function(Se,Ne,We,ht,gt){const St=4*Math.max(-Ne,0),Ht=(Math.max(0,We)-We)*ht*4+St,ir=4*ht,fr=Math.max(0,Ne),Gr=Math.max(0,We);return{rect:{x:fr,y:Gr,width:Math.min(Se.width,Ne+ht)-fr,height:Math.min(Se.height,We+gt)-Gr},layout:[{offset:Ht,stride:ir}]}}(v,c,b,k,z)),ne)for(let Se=0;Se<he.length;Se+=4){const Ne=he[Se];he[Se]=he[Se+2],he[Se+2]=Ne}return he}finally{V.close()}})}let Fr,Nr,hn,xn;const Ji={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(v){const c=requestAnimationFrame(v);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(v,c=0){return this.getImageCanvasContext(v).getImageData(-c,-c,v.width+2*c,v.height+2*c)},getImageCanvasContext(v){const c=window.document.createElement("canvas"),b=c.getContext("2d",{willReadFrequently:!0});if(!b)throw new Error("failed to create canvas 2d context");return c.width=v.width,c.height=v.height,b.drawImage(v,0,0,v.width,v.height),b},resolveURL:v=>(hn||(hn=document.createElement("a")),hn.href=v,hn.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xn==null&&(xn=matchMedia("(prefers-reduced-motion: reduce)")),xn.matches)}},pi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ka extends Error{constructor(c,b,k,z){super(`AJAXError: ${b} (${c}): ${k}`),this.status=c,this.statusText=b,this.url=k,this.body=z}}const na=Dt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ca=v=>pi.REGISTERED_PROTOCOLS[v.substring(0,v.indexOf("://"))];function po(v,c){const b=new AbortController,k=new Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,cache:v.cache,referrer:na(),signal:b.signal});let z=!1,V=!1;return v.type==="json"&&k.headers.set("Accept","application/json"),V||fetch(k).then(W=>W.ok?(ne=>{(v.type==="arrayBuffer"||v.type==="image"?ne.arrayBuffer():v.type==="json"?ne.json():ne.text()).then(he=>{V||(z=!0,c(null,he,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(he=>{V||c(new Error(he.message))})})(W):W.blob().then(ne=>c(new Ka(W.status,W.statusText,v.url,ne)))).catch(W=>{W.code!==20&&c(new Error(W.message))}),{cancel:()=>{V=!0,z||b.abort()}}}const La=function(v,c){if(/:\/\//.test(v.url)&&!/^https?:|^file:/.test(v.url)){if(Dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",v,c);if(!Dt())return(ca(v.url)||po)(v,c)}if(!(/^file:/.test(b=v.url)||/^file:/.test(na())&&!/^\w+:/.test(b))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return po(v,c);if(Dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",v,c,void 0,!0)}var b;return function(k,z){const V=new XMLHttpRequest;V.open(k.method||"GET",k.url,!0),k.type!=="arrayBuffer"&&k.type!=="image"||(V.responseType="arraybuffer");for(const W in k.headers)V.setRequestHeader(W,k.headers[W]);return k.type==="json"&&(V.responseType="text",V.setRequestHeader("Accept","application/json")),V.withCredentials=k.credentials==="include",V.onerror=()=>{z(new Error(V.statusText))},V.onload=()=>{if((V.status>=200&&V.status<300||V.status===0)&&V.response!==null){let W=V.response;if(k.type==="json")try{W=JSON.parse(V.response)}catch(ne){return z(ne)}z(null,W,V.getResponseHeader("Cache-Control"),V.getResponseHeader("Expires"))}else{const W=new Blob([V.response],{type:V.getResponseHeader("Content-Type")});z(new Ka(V.status,V.statusText,k.url,W))}},V.send(k.body),{cancel:()=>V.abort()}}(v,c)},$i=function(v,c){return La(Rr(v,{type:"arrayBuffer"}),c)};function qo(v){if(!v||v.indexOf("://")<=0||v.indexOf("data:image/")===0||v.indexOf("blob:")===0)return!0;const c=new URL(v),b=window.location;return c.protocol===b.protocol&&c.host===b.host}function is(v,c,b){b[v]&&b[v].indexOf(c)!==-1||(b[v]=b[v]||[],b[v].push(c))}function Ko(v,c,b){if(b&&b[v]){const k=b[v].indexOf(c);k!==-1&&b[v].splice(k,1)}}class Za{constructor(c,b={}){Rr(this,b),this.type=c}}class ha extends Za{constructor(c,b={}){super("error",Rr({error:c},b))}}class Fo{on(c,b){return this._listeners=this._listeners||{},is(c,b,this._listeners),this}off(c,b){return Ko(c,b,this._listeners),Ko(c,b,this._oneTimeListeners),this}once(c,b){return b?(this._oneTimeListeners=this._oneTimeListeners||{},is(c,b,this._oneTimeListeners),this):new Promise(k=>this.once(c,k))}fire(c,b){typeof c=="string"&&(c=new Za(c,b||{}));const k=c.type;if(this.listens(k)){c.target=this;const z=this._listeners&&this._listeners[k]?this._listeners[k].slice():[];for(const ne of z)ne.call(this,c);const V=this._oneTimeListeners&&this._oneTimeListeners[k]?this._oneTimeListeners[k].slice():[];for(const ne of V)Ko(k,ne,this._oneTimeListeners),ne.call(this,c);const W=this._eventedParent;W&&(Rr(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),W.fire(c))}else c instanceof ha&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,b){return this._eventedParent=c,this._eventedParentData=b,this}}var un={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ua=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zr(v,c){const b={};for(const k in v)k!=="ref"&&(b[k]=v[k]);return Ua.forEach(k=>{k in c&&(b[k]=c[k])}),b}function be(v,c){if(Array.isArray(v)){if(!Array.isArray(c)||v.length!==c.length)return!1;for(let b=0;b<v.length;b++)if(!be(v[b],c[b]))return!1;return!0}if(typeof v=="object"&&v!==null&&c!==null){if(typeof c!="object"||Object.keys(v).length!==Object.keys(c).length)return!1;for(const b in v)if(!be(v[b],c[b]))return!1;return!0}return v===c}const lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function mt(v,c,b){b.push({command:lt.addSource,args:[v,c[v]]})}function Qt(v,c,b){c.push({command:lt.removeSource,args:[v]}),b[v]=!0}function xr(v,c,b,k){Qt(v,b,k),mt(v,c,b)}function mn(v,c,b){let k;for(k in v[b])if(Object.prototype.hasOwnProperty.call(v[b],k)&&k!=="data"&&!be(v[b][k],c[b][k]))return!1;for(k in c[b])if(Object.prototype.hasOwnProperty.call(c[b],k)&&k!=="data"&&!be(v[b][k],c[b][k]))return!1;return!0}function Wn(v,c,b,k,z,V){let W;for(W in c=c||{},v=v||{})Object.prototype.hasOwnProperty.call(v,W)&&(be(v[W],c[W])||b.push({command:V,args:[k,W,c[W],z]}));for(W in c)Object.prototype.hasOwnProperty.call(c,W)&&!Object.prototype.hasOwnProperty.call(v,W)&&(be(v[W],c[W])||b.push({command:V,args:[k,W,c[W],z]}))}function tr(v){return v.id}function Hr(v,c){return v[c.id]=c,v}class dr{constructor(c,b,k,z){this.message=(c?`${c}: `:"")+k,z&&(this.identifier=z),b!=null&&b.__line__&&(this.line=b.__line__)}}function Un(v,...c){for(const b of c)for(const k in b)v[k]=b[k];return v}class ti extends Error{constructor(c,b){super(b),this.message=b,this.key=c}}class Yi{constructor(c,b=[]){this.parent=c,this.bindings={};for(const[k,z]of b)this.bindings[k]=z}concat(c){return new Yi(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const ea={kind:"null"},on={kind:"number"},Xn={kind:"string"},Pi={kind:"boolean"},Pa={kind:"color"},zo={kind:"object"},ya={kind:"value"},Xu={kind:"collator"},Wt={kind:"formatted"},qe={kind:"padding"},se={kind:"resolvedImage"},ve={kind:"variableAnchorOffsetCollection"};function Ae(v,c){return{kind:"array",itemType:v,N:c}}function Re(v){if(v.kind==="array"){const c=Re(v.itemType);return typeof v.N=="number"?`array<${c}, ${v.N}>`:v.itemType.kind==="value"?"array":`array<${c}>`}return v.kind}const Xe=[ea,on,Xn,Pi,Pa,Wt,zo,Ae(ya),qe,se,ve];function Qe(v,c){if(c.kind==="error")return null;if(v.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Qe(v.itemType,c.itemType))&&(typeof v.N!="number"||v.N===c.N))return null}else{if(v.kind===c.kind)return null;if(v.kind==="value"){for(const b of Xe)if(!Qe(b,c))return null}}return`Expected ${Re(v)} but found ${Re(c)} instead.`}function Ye(v,c){return c.some(b=>b.kind===v.kind)}function Fe(v,c){return c.some(b=>b==="null"?v===null:b==="array"?Array.isArray(v):b==="object"?v&&!Array.isArray(v)&&typeof v=="object":b===typeof v)}function Me(v,c){return v.kind==="array"&&c.kind==="array"?v.itemType.kind===c.itemType.kind&&typeof v.N=="number":v.kind===c.kind}const Be=.96422,yt=.82521,zt=4/29,Ze=6/29,Yr=3*Ze*Ze,Fn=Ze*Ze*Ze,Nn=Math.PI/180,qr=180/Math.PI;function li(v){return(v%=360)<0&&(v+=360),v}function zn([v,c,b,k]){let z,V;const W=Ca((.2225045*(v=jn(v))+.7168786*(c=jn(c))+.0606169*(b=jn(b)))/1);v===c&&c===b?z=V=W:(z=Ca((.4360747*v+.3850649*c+.1430804*b)/Be),V=Ca((.0139322*v+.0971045*c+.7141733*b)/yt));const ne=116*W-16;return[ne<0?0:ne,500*(z-W),200*(W-V),k]}function jn(v){return v<=.04045?v/12.92:Math.pow((v+.055)/1.055,2.4)}function Ca(v){return v>Fn?Math.pow(v,1/3):v/Yr+zt}function ni([v,c,b,k]){let z=(v+16)/116,V=isNaN(c)?z:z+c/500,W=isNaN(b)?z:z-b/200;return z=1*Ao(z),V=Be*Ao(V),W=yt*Ao(W),[za(3.1338561*V-1.6168667*z-.4906146*W),za(-.9787684*V+1.9161415*z+.033454*W),za(.0719453*V-.2289914*z+1.4052427*W),k]}function za(v){return(v=v<=.00304?12.92*v:1.055*Math.pow(v,1/2.4)-.055)<0?0:v>1?1:v}function Ao(v){return v>Ze?v*v*v:Yr*(v-zt)}function io(v){return parseInt(v.padEnd(2,v),16)/255}function ys(v,c){return oo(c?v/100:v,0,1)}function oo(v,c,b){return Math.min(Math.max(c,v),b)}function el(v){return!v.some(Number.isNaN)}const Qs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class vo{constructor(c,b,k,z=1,V=!0){this.r=c,this.g=b,this.b=k,this.a=z,V||(this.r*=z,this.g*=z,this.b*=z,z||this.overwriteGetter("rgb",[c,b,k,z]))}static parse(c){if(c instanceof vo)return c;if(typeof c!="string")return;const b=function(k){if((k=k.toLowerCase().trim())==="transparent")return[0,0,0,0];const z=Qs[k];if(z){const[W,ne,he]=z;return[W/255,ne/255,he/255,1]}if(k.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(k)){const W=k.length<6?1:2;let ne=1;return[io(k.slice(ne,ne+=W)),io(k.slice(ne,ne+=W)),io(k.slice(ne,ne+=W)),io(k.slice(ne,ne+W)||"ff")]}if(k.startsWith("rgb")){const W=k.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(W){const[ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr,Gr]=W,Tr=[Ne||" ",gt||" ",ir].join("");if(Tr==="  "||Tr==="  /"||Tr===",,"||Tr===",,,"){const Jr=[Se,ht,Ht].join(""),wn=Jr==="%%%"?100:Jr===""?255:0;if(wn){const ii=[oo(+he/wn,0,1),oo(+We/wn,0,1),oo(+St/wn,0,1),fr?ys(+fr,Gr):1];if(el(ii))return ii}}return}}const V=k.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[W,ne,he,Se,Ne,We,ht,gt,St]=V,Ht=[he||" ",Ne||" ",ht].join("");if(Ht==="  "||Ht==="  /"||Ht===",,"||Ht===",,,"){const ir=[+ne,oo(+Se,0,100),oo(+We,0,100),gt?ys(+gt,St):1];if(el(ir))return function([fr,Gr,Tr,Jr]){function wn(ii){const da=(ii+fr/30)%12,$a=Gr*Math.min(Tr,1-Tr);return Tr-$a*Math.max(-1,Math.min(da-3,9-da,1))}return fr=li(fr),Gr/=100,Tr/=100,[wn(0),wn(8),wn(4),Jr]}(ir)}}}(c);return b?new vo(...b,!1):void 0}get rgb(){const{r:c,g:b,b:k,a:z}=this,V=z||1/0;return this.overwriteGetter("rgb",[c/V,b/V,k/V,z])}get hcl(){return this.overwriteGetter("hcl",function(c){const[b,k,z,V]=zn(c),W=Math.sqrt(k*k+z*z);return[Math.round(1e4*W)?li(Math.atan2(z,k)*qr):NaN,W,b,V]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zn(this.rgb))}overwriteGetter(c,b){return Object.defineProperty(this,c,{value:b}),b}toString(){const[c,b,k,z]=this.rgb;return`rgba(${[c,b,k].map(V=>Math.round(255*V)).join(",")},${z})`}}vo.black=new vo(0,0,0,1),vo.white=new vo(1,1,1,1),vo.transparent=new vo(0,0,0,0),vo.red=new vo(1,0,0,1);class as{constructor(c,b,k){this.sensitivity=c?b?"variant":"case":b?"accent":"base",this.locale=k,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,b){return this.collator.compare(c,b)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class To{constructor(c,b,k,z,V){this.text=c,this.image=b,this.scale=k,this.fontStack=z,this.textColor=V}}class to{constructor(c){this.sections=c}static fromString(c){return new to([new To(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof to?c:to.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class js{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof js)return c;if(typeof c=="number")return new js([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const b of c)if(typeof b!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new js(c)}}toString(){return JSON.stringify(this.values)}}const Vc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ws{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof ws)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let b=0;b<c.length;b+=2){const k=c[b],z=c[b+1];if(typeof k!="string"||!Vc.has(k)||!Array.isArray(z)||z.length!==2||typeof z[0]!="number"||typeof z[1]!="number")return}return new ws(c)}}toString(){return JSON.stringify(this.values)}}class Ss{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Ss({name:c,available:!1}):null}}function eh(v,c,b,k){return typeof v=="number"&&v>=0&&v<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof b=="number"&&b>=0&&b<=255?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid rgba value [${[v,c,b,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof k=="number"?[v,c,b,k]:[v,c,b]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kc(v){if(v===null||typeof v=="string"||typeof v=="boolean"||typeof v=="number"||v instanceof vo||v instanceof as||v instanceof to||v instanceof js||v instanceof ws||v instanceof Ss)return!0;if(Array.isArray(v)){for(const c of v)if(!kc(c))return!1;return!0}if(typeof v=="object"){for(const c in v)if(!kc(v[c]))return!1;return!0}return!1}function Io(v){if(v===null)return ea;if(typeof v=="string")return Xn;if(typeof v=="boolean")return Pi;if(typeof v=="number")return on;if(v instanceof vo)return Pa;if(v instanceof as)return Xu;if(v instanceof to)return Wt;if(v instanceof js)return qe;if(v instanceof ws)return ve;if(v instanceof Ss)return se;if(Array.isArray(v)){const c=v.length;let b;for(const k of v){const z=Io(k);if(b){if(b===z)continue;b=ya;break}b=z}return Ae(b||ya,c)}return zo}function bo(v){const c=typeof v;return v===null?"":c==="string"||c==="number"||c==="boolean"?String(v):v instanceof vo||v instanceof to||v instanceof js||v instanceof ws||v instanceof Ss?v.toString():JSON.stringify(v)}class du{constructor(c,b){this.type=c,this.value=b}static parse(c,b){if(c.length!==2)return b.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!kc(c[1]))return b.error("invalid value");const k=c[1];let z=Io(k);const V=b.expectedType;return z.kind!=="array"||z.N!==0||!V||V.kind!=="array"||typeof V.N=="number"&&V.N!==0||(z=V),new du(z,k)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Zo{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Il={string:Xn,number:on,boolean:Pi,object:zo};class Uo{constructor(c,b){this.type=c,this.args=b}static parse(c,b){if(c.length<2)return b.error("Expected at least one argument.");let k,z=1;const V=c[0];if(V==="array"){let ne,he;if(c.length>2){const Se=c[1];if(typeof Se!="string"||!(Se in Il)||Se==="object")return b.error('The item type argument of "array" must be one of string, number, boolean',1);ne=Il[Se],z++}else ne=ya;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return b.error('The length argument to "array" must be a positive integer literal',2);he=c[2],z++}k=Ae(ne,he)}else{if(!Il[V])throw new Error(`Types doesn't contain name = ${V}`);k=Il[V]}const W=[];for(;z<c.length;z++){const ne=b.parse(c[z],z,ya);if(!ne)return null;W.push(ne)}return new Uo(k,W)}evaluate(c){for(let b=0;b<this.args.length;b++){const k=this.args[b].evaluate(c);if(!Qe(this.type,Io(k)))return k;if(b===this.args.length-1)throw new Zo(`Expected value to be of type ${Re(this.type)}, but found ${Re(Io(k))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Ws={"to-boolean":Pi,"to-color":Pa,"to-number":on,"to-string":Xn};class eu{constructor(c,b){this.type=c,this.args=b}static parse(c,b){if(c.length<2)return b.error("Expected at least one argument.");const k=c[0];if(!Ws[k])throw new Error(`Can't parse ${k} as it is not part of the known types`);if((k==="to-boolean"||k==="to-string")&&c.length!==2)return b.error("Expected one argument.");const z=Ws[k],V=[];for(let W=1;W<c.length;W++){const ne=b.parse(c[W],W,ya);if(!ne)return null;V.push(ne)}return new eu(z,V)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let b,k;for(const z of this.args){if(b=z.evaluate(c),k=null,b instanceof vo)return b;if(typeof b=="string"){const V=c.parseColor(b);if(V)return V}else if(Array.isArray(b)&&(k=b.length<3||b.length>4?`Invalid rbga value ${JSON.stringify(b)}: expected an array containing either three or four numeric values.`:eh(b[0],b[1],b[2],b[3]),!k))return new vo(b[0]/255,b[1]/255,b[2]/255,b[3])}throw new Zo(k||`Could not parse color from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"padding":{let b;for(const k of this.args){b=k.evaluate(c);const z=js.parse(b);if(z)return z}throw new Zo(`Could not parse padding from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"variableAnchorOffsetCollection":{let b;for(const k of this.args){b=k.evaluate(c);const z=ws.parse(b);if(z)return z}throw new Zo(`Could not parse variableAnchorOffsetCollection from value '${typeof b=="string"?b:JSON.stringify(b)}'`)}case"number":{let b=null;for(const k of this.args){if(b=k.evaluate(c),b===null)return 0;const z=Number(b);if(!isNaN(z))return z}throw new Zo(`Could not convert ${JSON.stringify(b)} to number.`)}case"formatted":return to.fromString(bo(this.args[0].evaluate(c)));case"resolvedImage":return Ss.fromString(bo(this.args[0].evaluate(c)));default:return bo(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const sl=["Unknown","Point","LineString","Polygon"];class ul{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let b=this._parseColorCache[c];return b||(b=this._parseColorCache[c]=vo.parse(c)),b}}class ll{constructor(c,b,k=[],z,V=new Yi,W=[]){this.registry=c,this.path=k,this.key=k.map(ne=>`[${ne}]`).join(""),this.scope=V,this.errors=W,this.expectedType=z,this._isConstant=b}parse(c,b,k,z,V={}){return b?this.concat(b,k,z)._parse(c,V):this._parse(c,V)}_parse(c,b){function k(z,V,W){return W==="assert"?new Uo(V,[z]):W==="coerce"?new eu(V,[z]):z}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const z=c[0];if(typeof z!="string")return this.error(`Expression name must be a string, but found ${typeof z} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const V=this.registry[z];if(V){let W=V.parse(c,this);if(!W)return null;if(this.expectedType){const ne=this.expectedType,he=W.type;if(ne.kind!=="string"&&ne.kind!=="number"&&ne.kind!=="boolean"&&ne.kind!=="object"&&ne.kind!=="array"||he.kind!=="value")if(ne.kind!=="color"&&ne.kind!=="formatted"&&ne.kind!=="resolvedImage"||he.kind!=="value"&&he.kind!=="string")if(ne.kind!=="padding"||he.kind!=="value"&&he.kind!=="number"&&he.kind!=="array")if(ne.kind!=="variableAnchorOffsetCollection"||he.kind!=="value"&&he.kind!=="array"){if(this.checkSubtype(ne,he))return null}else W=k(W,ne,b.typeAnnotation||"coerce");else W=k(W,ne,b.typeAnnotation||"coerce");else W=k(W,ne,b.typeAnnotation||"coerce");else W=k(W,ne,b.typeAnnotation||"assert")}if(!(W instanceof du)&&W.type.kind!=="resolvedImage"&&this._isConstant(W)){const ne=new ul;try{W=new du(W.type,W.evaluate(ne))}catch(he){return this.error(he.message),null}}return W}return this.error(`Unknown expression "${z}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,b,k){const z=typeof c=="number"?this.path.concat(c):this.path,V=k?this.scope.concat(k):this.scope;return new ll(this.registry,this._isConstant,z,b||null,V,this.errors)}error(c,...b){const k=`${this.key}${b.map(z=>`[${z}]`).join("")}`;this.errors.push(new ti(k,c))}checkSubtype(c,b){const k=Qe(c,b);return k&&this.error(k),k}}class _c{constructor(c,b,k){this.type=Xu,this.locale=k,this.caseSensitive=c,this.diacriticSensitive=b}static parse(c,b){if(c.length!==2)return b.error("Expected one argument.");const k=c[1];if(typeof k!="object"||Array.isArray(k))return b.error("Collator options argument must be an object.");const z=b.parse(k["case-sensitive"]!==void 0&&k["case-sensitive"],1,Pi);if(!z)return null;const V=b.parse(k["diacritic-sensitive"]!==void 0&&k["diacritic-sensitive"],1,Pi);if(!V)return null;let W=null;return k.locale&&(W=b.parse(k.locale,1,Xn),!W)?null:new _c(z,V,W)}evaluate(c){return new as(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const zu=8192;function cl(v,c){v[0]=Math.min(v[0],c[0]),v[1]=Math.min(v[1],c[1]),v[2]=Math.max(v[2],c[0]),v[3]=Math.max(v[3],c[1])}function iu(v,c){return!(v[0]<=c[0]||v[2]>=c[2]||v[1]<=c[1]||v[3]>=c[3])}function _t(v,c){const b=(180+v[0])/360,k=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+v[1]*Math.PI/360)))/360,z=Math.pow(2,c.z);return[Math.round(b*z*zu),Math.round(k*z*zu)]}function Ut(v,c,b){const k=v[0]-c[0],z=v[1]-c[1],V=v[0]-b[0],W=v[1]-b[1];return k*W-V*z==0&&k*V<=0&&z*W<=0}function Er(v,c){let b=!1;for(let W=0,ne=c.length;W<ne;W++){const he=c[W];for(let Se=0,Ne=he.length;Se<Ne-1;Se++){if(Ut(v,he[Se],he[Se+1]))return!1;(z=he[Se])[1]>(k=v)[1]!=(V=he[Se+1])[1]>k[1]&&k[0]<(V[0]-z[0])*(k[1]-z[1])/(V[1]-z[1])+z[0]&&(b=!b)}}var k,z,V;return b}function Sn(v,c){for(let b=0;b<c.length;b++)if(Er(v,c[b]))return!0;return!1}function kr(v,c,b,k){const z=k[0]-b[0],V=k[1]-b[1],W=(v[0]-b[0])*V-z*(v[1]-b[1]),ne=(c[0]-b[0])*V-z*(c[1]-b[1]);return W>0&&ne<0||W<0&&ne>0}function wa(v,c,b){for(const Se of b)for(let Ne=0;Ne<Se.length-1;++Ne)if((ne=[(W=Se[Ne+1])[0]-(V=Se[Ne])[0],W[1]-V[1]])[0]*(he=[(z=c)[0]-(k=v)[0],z[1]-k[1]])[1]-ne[1]*he[0]!=0&&kr(k,z,V,W)&&kr(V,W,k,z))return!0;var k,z,V,W,ne,he;return!1}function Xa(v,c){for(let b=0;b<v.length;++b)if(!Er(v[b],c))return!1;for(let b=0;b<v.length-1;++b)if(wa(v[b],v[b+1],c))return!1;return!0}function yl(v,c){for(let b=0;b<c.length;b++)if(Xa(v,c[b]))return!0;return!1}function Jo(v,c,b){const k=[];for(let z=0;z<v.length;z++){const V=[];for(let W=0;W<v[z].length;W++){const ne=_t(v[z][W],b);cl(c,ne),V.push(ne)}k.push(V)}return k}function au(v,c,b){const k=[];for(let z=0;z<v.length;z++){const V=Jo(v[z],c,b);k.push(V)}return k}function ou(v,c,b,k){if(v[0]<b[0]||v[0]>b[2]){const z=.5*k;let V=v[0]-b[0]>z?-k:b[0]-v[0]>z?k:0;V===0&&(V=v[0]-b[2]>z?-k:b[2]-v[0]>z?k:0),v[0]+=V}cl(c,v)}function Ra(v,c,b,k){const z=Math.pow(2,k.z)*zu,V=[k.x*zu,k.y*zu],W=[];for(const ne of v)for(const he of ne){const Se=[he.x+V[0],he.y+V[1]];ou(Se,c,b,z),W.push(Se)}return W}function Mp(v,c,b,k){const z=Math.pow(2,k.z)*zu,V=[k.x*zu,k.y*zu],W=[];for(const he of v){const Se=[];for(const Ne of he){const We=[Ne.x+V[0],Ne.y+V[1]];cl(c,We),Se.push(We)}W.push(Se)}if(c[2]-c[0]<=z/2){(ne=c)[0]=ne[1]=1/0,ne[2]=ne[3]=-1/0;for(const he of W)for(const Se of he)ou(Se,c,b,z)}var ne;return W}class th{constructor(c,b){this.type=Pi,this.geojson=c,this.geometries=b}static parse(c,b){if(c.length!==2)return b.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(kc(c[1])){const k=c[1];if(k.type==="FeatureCollection")for(let z=0;z<k.features.length;++z){const V=k.features[z].geometry.type;if(V==="Polygon"||V==="MultiPolygon")return new th(k,k.features[z].geometry)}else if(k.type==="Feature"){const z=k.geometry.type;if(z==="Polygon"||z==="MultiPolygon")return new th(k,k.geometry)}else if(k.type==="Polygon"||k.type==="MultiPolygon")return new th(k,k)}return b.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(b,k){const z=[1/0,1/0,-1/0,-1/0],V=[1/0,1/0,-1/0,-1/0],W=b.canonicalID();if(k.type==="Polygon"){const ne=Jo(k.coordinates,V,W),he=Ra(b.geometry(),z,V,W);if(!iu(z,V))return!1;for(const Se of he)if(!Er(Se,ne))return!1}if(k.type==="MultiPolygon"){const ne=au(k.coordinates,V,W),he=Ra(b.geometry(),z,V,W);if(!iu(z,V))return!1;for(const Se of he)if(!Sn(Se,ne))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(b,k){const z=[1/0,1/0,-1/0,-1/0],V=[1/0,1/0,-1/0,-1/0],W=b.canonicalID();if(k.type==="Polygon"){const ne=Jo(k.coordinates,V,W),he=Mp(b.geometry(),z,V,W);if(!iu(z,V))return!1;for(const Se of he)if(!Xa(Se,ne))return!1}if(k.type==="MultiPolygon"){const ne=au(k.coordinates,V,W),he=Mp(b.geometry(),z,V,W);if(!iu(z,V))return!1;for(const Se of he)if(!yl(Se,ne))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class su{constructor(c,b){this.type=b.type,this.name=c,this.boundExpression=b}static parse(c,b){if(c.length!==2||typeof c[1]!="string")return b.error("'var' expression requires exactly one string literal argument.");const k=c[1];return b.scope.has(k)?new su(k,b.scope.get(k)):b.error(`Unknown variable "${k}". Make sure "${k}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class _a{constructor(c,b,k,z){this.name=c,this.type=b,this._evaluate=k,this.args=z}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,b){const k=c[0],z=_a.definitions[k];if(!z)return b.error(`Unknown expression "${k}". If you wanted a literal array, use ["literal", [...]].`,0);const V=Array.isArray(z)?z[0]:z.type,W=Array.isArray(z)?[[z[1],z[2]]]:z.overloads,ne=W.filter(([Se])=>!Array.isArray(Se)||Se.length===c.length-1);let he=null;for(const[Se,Ne]of ne){he=new ll(b.registry,os,b.path,null,b.scope);const We=[];let ht=!1;for(let gt=1;gt<c.length;gt++){const St=c[gt],Ht=Array.isArray(Se)?Se[gt-1]:Se.type,ir=he.parse(St,1+We.length,Ht);if(!ir){ht=!0;break}We.push(ir)}if(!ht)if(Array.isArray(Se)&&Se.length!==We.length)he.error(`Expected ${Se.length} arguments, but found ${We.length} instead.`);else{for(let gt=0;gt<We.length;gt++){const St=Array.isArray(Se)?Se[gt]:Se.type,Ht=We[gt];he.concat(gt+1).checkSubtype(St,Ht.type)}if(he.errors.length===0)return new _a(k,V,Ne,We)}}if(ne.length===1)b.errors.push(...he.errors);else{const Se=(ne.length?ne:W).map(([We])=>{return ht=We,Array.isArray(ht)?`(${ht.map(Re).join(", ")})`:`(${Re(ht.type)}...)`;var ht}).join(" | "),Ne=[];for(let We=1;We<c.length;We++){const ht=b.parse(c[We],1+Ne.length);if(!ht)return null;Ne.push(Re(ht.type))}b.error(`Expected arguments of type ${Se}, but found (${Ne.join(", ")}) instead.`)}return null}static register(c,b){_a.definitions=b;for(const k in b)c[k]=_a}}function os(v){if(v instanceof su)return os(v.boundExpression);if(v instanceof _a&&v.name==="error"||v instanceof _c||v instanceof th)return!1;const c=v instanceof eu||v instanceof Uo;let b=!0;return v.eachChild(k=>{b=c?b&&os(k):b&&k instanceof du}),!!b&&Su(v)&&Mo(v,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Su(v){if(v instanceof _a&&(v.name==="get"&&v.args.length===1||v.name==="feature-state"||v.name==="has"&&v.args.length===1||v.name==="properties"||v.name==="geometry-type"||v.name==="id"||/^filter-/.test(v.name))||v instanceof th)return!1;let c=!0;return v.eachChild(b=>{c&&!Su(b)&&(c=!1)}),c}function Eh(v){if(v instanceof _a&&v.name==="feature-state")return!1;let c=!0;return v.eachChild(b=>{c&&!Eh(b)&&(c=!1)}),c}function Mo(v,c){if(v instanceof _a&&c.indexOf(v.name)>=0)return!1;let b=!0;return v.eachChild(k=>{b&&!Mo(k,c)&&(b=!1)}),b}function cc(v,c){const b=v.length-1;let k,z,V=0,W=b,ne=0;for(;V<=W;)if(ne=Math.floor((V+W)/2),k=v[ne],z=v[ne+1],k<=c){if(ne===b||c<z)return ne;V=ne+1}else{if(!(k>c))throw new Zo("Input is not a number.");W=ne-1}return 0}class uu{constructor(c,b,k){this.type=c,this.input=b,this.labels=[],this.outputs=[];for(const[z,V]of k)this.labels.push(z),this.outputs.push(V)}static parse(c,b){if(c.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return b.error("Expected an even number of arguments.");const k=b.parse(c[1],1,on);if(!k)return null;const z=[];let V=null;b.expectedType&&b.expectedType.kind!=="value"&&(V=b.expectedType);for(let W=1;W<c.length;W+=2){const ne=W===1?-1/0:c[W],he=c[W+1],Se=W,Ne=W+1;if(typeof ne!="number")return b.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Se);if(z.length&&z[z.length-1][0]>=ne)return b.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Se);const We=b.parse(he,Ne,V);if(!We)return null;V=V||We.type,z.push([ne,We])}return new uu(V,k,z)}evaluate(c){const b=this.labels,k=this.outputs;if(b.length===1)return k[0].evaluate(c);const z=this.input.evaluate(c);if(z<=b[0])return k[0].evaluate(c);const V=b.length;return z>=b[V-1]?k[V-1].evaluate(c):k[cc(b,z)].evaluate(c)}eachChild(c){c(this.input);for(const b of this.outputs)c(b)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Ja(v,c,b){return v+b*(c-v)}function rf(v,c,b){return v.map((k,z)=>Ja(k,c[z],b))}const Yu={number:Ja,color:function(v,c,b,k="rgb"){switch(k){case"rgb":{const[z,V,W,ne]=rf(v.rgb,c.rgb,b);return new vo(z,V,W,ne,!1)}case"hcl":{const[z,V,W,ne]=v.hcl,[he,Se,Ne,We]=c.hcl;let ht,gt;if(isNaN(z)||isNaN(he))isNaN(z)?isNaN(he)?ht=NaN:(ht=he,W!==1&&W!==0||(gt=Se)):(ht=z,Ne!==1&&Ne!==0||(gt=V));else{let Gr=he-z;he>z&&Gr>180?Gr-=360:he<z&&z-he>180&&(Gr+=360),ht=z+b*Gr}const[St,Ht,ir,fr]=function([Gr,Tr,Jr,wn]){return Gr=isNaN(Gr)?0:Gr*Nn,ni([Jr,Math.cos(Gr)*Tr,Math.sin(Gr)*Tr,wn])}([ht,gt!=null?gt:Ja(V,Se,b),Ja(W,Ne,b),Ja(ne,We,b)]);return new vo(St,Ht,ir,fr,!1)}case"lab":{const[z,V,W,ne]=ni(rf(v.lab,c.lab,b));return new vo(z,V,W,ne,!1)}}},array:rf,padding:function(v,c,b){return new js(rf(v.values,c.values,b))},variableAnchorOffsetCollection:function(v,c,b){const k=v.values,z=c.values;if(k.length!==z.length)throw new Zo(`Cannot interpolate values of different length. from: ${v.toString()}, to: ${c.toString()}`);const V=[];for(let W=0;W<k.length;W+=2){if(k[W]!==z[W])throw new Zo(`Cannot interpolate values containing mismatched anchors. from[${W}]: ${k[W]}, to[${W}]: ${z[W]}`);V.push(k[W]);const[ne,he]=k[W+1],[Se,Ne]=z[W+1];V.push([Ja(ne,Se,b),Ja(he,Ne,b)])}return new ws(V)}};class Vs{constructor(c,b,k,z,V){this.type=c,this.operator=b,this.interpolation=k,this.input=z,this.labels=[],this.outputs=[];for(const[W,ne]of V)this.labels.push(W),this.outputs.push(ne)}static interpolationFactor(c,b,k,z){let V=0;if(c.name==="exponential")V=yh(b,c.base,k,z);else if(c.name==="linear")V=yh(b,1,k,z);else if(c.name==="cubic-bezier"){const W=c.controlPoints;V=new xt(W[0],W[1],W[2],W[3]).solve(yh(b,1,k,z))}return V}static parse(c,b){let[k,z,V,...W]=c;if(!Array.isArray(z)||z.length===0)return b.error("Expected an interpolation type expression.",1);if(z[0]==="linear")z={name:"linear"};else if(z[0]==="exponential"){const Se=z[1];if(typeof Se!="number")return b.error("Exponential interpolation requires a numeric base.",1,1);z={name:"exponential",base:Se}}else{if(z[0]!=="cubic-bezier")return b.error(`Unknown interpolation type ${String(z[0])}`,1,0);{const Se=z.slice(1);if(Se.length!==4||Se.some(Ne=>typeof Ne!="number"||Ne<0||Ne>1))return b.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);z={name:"cubic-bezier",controlPoints:Se}}}if(c.length-1<4)return b.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return b.error("Expected an even number of arguments.");if(V=b.parse(V,2,on),!V)return null;const ne=[];let he=null;k==="interpolate-hcl"||k==="interpolate-lab"?he=Pa:b.expectedType&&b.expectedType.kind!=="value"&&(he=b.expectedType);for(let Se=0;Se<W.length;Se+=2){const Ne=W[Se],We=W[Se+1],ht=Se+3,gt=Se+4;if(typeof Ne!="number")return b.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ht);if(ne.length&&ne[ne.length-1][0]>=Ne)return b.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ht);const St=b.parse(We,gt,he);if(!St)return null;he=he||St.type,ne.push([Ne,St])}return Me(he,on)||Me(he,Pa)||Me(he,qe)||Me(he,ve)||Me(he,Ae(on))?new Vs(he,k,z,V,ne):b.error(`Type ${Re(he)} is not interpolatable.`)}evaluate(c){const b=this.labels,k=this.outputs;if(b.length===1)return k[0].evaluate(c);const z=this.input.evaluate(c);if(z<=b[0])return k[0].evaluate(c);const V=b.length;if(z>=b[V-1])return k[V-1].evaluate(c);const W=cc(b,z),ne=Vs.interpolationFactor(this.interpolation,z,b[W],b[W+1]),he=k[W].evaluate(c),Se=k[W+1].evaluate(c);switch(this.operator){case"interpolate":return Yu[this.type.kind](he,Se,ne);case"interpolate-hcl":return Yu.color(he,Se,ne,"hcl");case"interpolate-lab":return Yu.color(he,Se,ne,"lab")}}eachChild(c){c(this.input);for(const b of this.outputs)c(b)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function yh(v,c,b,k){const z=k-b,V=v-b;return z===0?0:c===1?V/z:(Math.pow(c,V)-1)/(Math.pow(c,z)-1)}class tl{constructor(c,b){this.type=c,this.args=b}static parse(c,b){if(c.length<2)return b.error("Expectected at least one argument.");let k=null;const z=b.expectedType;z&&z.kind!=="value"&&(k=z);const V=[];for(const ne of c.slice(1)){const he=b.parse(ne,1+V.length,k,void 0,{typeAnnotation:"omit"});if(!he)return null;k=k||he.type,V.push(he)}if(!k)throw new Error("No output type");const W=z&&V.some(ne=>Qe(z,ne.type));return new tl(W?ya:k,V)}evaluate(c){let b,k=null,z=0;for(const V of this.args)if(z++,k=V.evaluate(c),k&&k instanceof Ss&&!k.available&&(b||(b=k.name),k=null,z===this.args.length&&(k=b)),k!==null)break;return k}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class vu{constructor(c,b){this.type=b.type,this.bindings=[].concat(c),this.result=b}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const b of this.bindings)c(b[1]);c(this.result)}static parse(c,b){if(c.length<4)return b.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const k=[];for(let V=1;V<c.length-1;V+=2){const W=c[V];if(typeof W!="string")return b.error(`Expected string, but found ${typeof W} instead.`,V);if(/[^a-zA-Z0-9_]/.test(W))return b.error("Variable names must contain only alphanumeric characters or '_'.",V);const ne=b.parse(c[V+1],V+1);if(!ne)return null;k.push([W,ne])}const z=b.parse(c[c.length-1],c.length-1,b.expectedType,k);return z?new vu(k,z):null}outputDefined(){return this.result.outputDefined()}}class Ch{constructor(c,b,k){this.type=c,this.index=b,this.input=k}static parse(c,b){if(c.length!==3)return b.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const k=b.parse(c[1],1,on),z=b.parse(c[2],2,Ae(b.expectedType||ya));return k&&z?new Ch(z.type.itemType,k,z):null}evaluate(c){const b=this.index.evaluate(c),k=this.input.evaluate(c);if(b<0)throw new Zo(`Array index out of bounds: ${b} < 0.`);if(b>=k.length)throw new Zo(`Array index out of bounds: ${b} > ${k.length-1}.`);if(b!==Math.floor(b))throw new Zo(`Array index must be an integer, but found ${b} instead.`);return k[b]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Hf{constructor(c,b){this.type=Pi,this.needle=c,this.haystack=b}static parse(c,b){if(c.length!==3)return b.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const k=b.parse(c[1],1,ya),z=b.parse(c[2],2,ya);return k&&z?Ye(k.type,[Pi,Xn,on,ea,ya])?new Hf(k,z):b.error(`Expected first argument to be of type boolean, string, number or null, but found ${Re(k.type)} instead`):null}evaluate(c){const b=this.needle.evaluate(c),k=this.haystack.evaluate(c);if(!k)return!1;if(!Fe(b,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${Re(Io(b))} instead.`);if(!Fe(k,["string","array"]))throw new Zo(`Expected second argument to be of type array or string, but found ${Re(Io(k))} instead.`);return k.indexOf(b)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Vn{constructor(c,b,k){this.type=on,this.needle=c,this.haystack=b,this.fromIndex=k}static parse(c,b){if(c.length<=2||c.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const k=b.parse(c[1],1,ya),z=b.parse(c[2],2,ya);if(!k||!z)return null;if(!Ye(k.type,[Pi,Xn,on,ea,ya]))return b.error(`Expected first argument to be of type boolean, string, number or null, but found ${Re(k.type)} instead`);if(c.length===4){const V=b.parse(c[3],3,on);return V?new Vn(k,z,V):null}return new Vn(k,z)}evaluate(c){const b=this.needle.evaluate(c),k=this.haystack.evaluate(c);if(!Fe(b,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${Re(Io(b))} instead.`);if(!Fe(k,["string","array"]))throw new Zo(`Expected second argument to be of type array or string, but found ${Re(Io(k))} instead.`);if(this.fromIndex){const z=this.fromIndex.evaluate(c);return k.indexOf(b,z)}return k.indexOf(b)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class gi{constructor(c,b,k,z,V,W){this.inputType=c,this.type=b,this.input=k,this.cases=z,this.outputs=V,this.otherwise=W}static parse(c,b){if(c.length<5)return b.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return b.error("Expected an even number of arguments.");let k,z;b.expectedType&&b.expectedType.kind!=="value"&&(z=b.expectedType);const V={},W=[];for(let Se=2;Se<c.length-1;Se+=2){let Ne=c[Se];const We=c[Se+1];Array.isArray(Ne)||(Ne=[Ne]);const ht=b.concat(Se);if(Ne.length===0)return ht.error("Expected at least one branch label.");for(const St of Ne){if(typeof St!="number"&&typeof St!="string")return ht.error("Branch labels must be numbers or strings.");if(typeof St=="number"&&Math.abs(St)>Number.MAX_SAFE_INTEGER)return ht.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof St=="number"&&Math.floor(St)!==St)return ht.error("Numeric branch labels must be integer values.");if(k){if(ht.checkSubtype(k,Io(St)))return null}else k=Io(St);if(V[String(St)]!==void 0)return ht.error("Branch labels must be unique.");V[String(St)]=W.length}const gt=b.parse(We,Se,z);if(!gt)return null;z=z||gt.type,W.push(gt)}const ne=b.parse(c[1],1,ya);if(!ne)return null;const he=b.parse(c[c.length-1],c.length-1,z);return he?ne.type.kind!=="value"&&b.concat(1).checkSubtype(k,ne.type)?null:new gi(k,z,ne,V,W,he):null}evaluate(c){const b=this.input.evaluate(c);return(Io(b)===this.inputType&&this.outputs[this.cases[b]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class Hp{constructor(c,b,k){this.type=c,this.branches=b,this.otherwise=k}static parse(c,b){if(c.length<4)return b.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return b.error("Expected an odd number of arguments.");let k;b.expectedType&&b.expectedType.kind!=="value"&&(k=b.expectedType);const z=[];for(let W=1;W<c.length-1;W+=2){const ne=b.parse(c[W],W,Pi);if(!ne)return null;const he=b.parse(c[W+1],W+1,k);if(!he)return null;z.push([ne,he]),k=k||he.type}const V=b.parse(c[c.length-1],c.length-1,k);if(!V)return null;if(!k)throw new Error("Can't infer output type");return new Hp(k,z,V)}evaluate(c){for(const[b,k]of this.branches)if(b.evaluate(c))return k.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[b,k]of this.branches)c(b),c(k);c(this.otherwise)}outputDefined(){return this.branches.every(([c,b])=>b.outputDefined())&&this.otherwise.outputDefined()}}class nf{constructor(c,b,k,z){this.type=c,this.input=b,this.beginIndex=k,this.endIndex=z}static parse(c,b){if(c.length<=2||c.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const k=b.parse(c[1],1,ya),z=b.parse(c[2],2,on);if(!k||!z)return null;if(!Ye(k.type,[Ae(ya),Xn,ya]))return b.error(`Expected first argument to be of type array or string, but found ${Re(k.type)} instead`);if(c.length===4){const V=b.parse(c[3],3,on);return V?new nf(k.type,k,z,V):null}return new nf(k.type,k,z)}evaluate(c){const b=this.input.evaluate(c),k=this.beginIndex.evaluate(c);if(!Fe(b,["string","array"]))throw new Zo(`Expected first argument to be of type array or string, but found ${Re(Io(b))} instead.`);if(this.endIndex){const z=this.endIndex.evaluate(c);return b.slice(k,z)}return b.slice(k)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function Gc(v,c){return v==="=="||v==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function sd(v,c,b,k){return k.compare(c,b)===0}function Bu(v,c,b){const k=v!=="=="&&v!=="!=";return class sR{constructor(V,W,ne){this.type=Pi,this.lhs=V,this.rhs=W,this.collator=ne,this.hasUntypedArgument=V.type.kind==="value"||W.type.kind==="value"}static parse(V,W){if(V.length!==3&&V.length!==4)return W.error("Expected two or three arguments.");const ne=V[0];let he=W.parse(V[1],1,ya);if(!he)return null;if(!Gc(ne,he.type))return W.concat(1).error(`"${ne}" comparisons are not supported for type '${Re(he.type)}'.`);let Se=W.parse(V[2],2,ya);if(!Se)return null;if(!Gc(ne,Se.type))return W.concat(2).error(`"${ne}" comparisons are not supported for type '${Re(Se.type)}'.`);if(he.type.kind!==Se.type.kind&&he.type.kind!=="value"&&Se.type.kind!=="value")return W.error(`Cannot compare types '${Re(he.type)}' and '${Re(Se.type)}'.`);k&&(he.type.kind==="value"&&Se.type.kind!=="value"?he=new Uo(Se.type,[he]):he.type.kind!=="value"&&Se.type.kind==="value"&&(Se=new Uo(he.type,[Se])));let Ne=null;if(V.length===4){if(he.type.kind!=="string"&&Se.type.kind!=="string"&&he.type.kind!=="value"&&Se.type.kind!=="value")return W.error("Cannot use collator to compare non-string types.");if(Ne=W.parse(V[3],3,Xu),!Ne)return null}return new sR(he,Se,Ne)}evaluate(V){const W=this.lhs.evaluate(V),ne=this.rhs.evaluate(V);if(k&&this.hasUntypedArgument){const he=Io(W),Se=Io(ne);if(he.kind!==Se.kind||he.kind!=="string"&&he.kind!=="number")throw new Zo(`Expected arguments for "${v}" to be (string, string) or (number, number), but found (${he.kind}, ${Se.kind}) instead.`)}if(this.collator&&!k&&this.hasUntypedArgument){const he=Io(W),Se=Io(ne);if(he.kind!=="string"||Se.kind!=="string")return c(V,W,ne)}return this.collator?b(V,W,ne,this.collator.evaluate(V)):c(V,W,ne)}eachChild(V){V(this.lhs),V(this.rhs),this.collator&&V(this.collator)}outputDefined(){return!0}}}const $d=Bu("==",function(v,c,b){return c===b},sd),rh=Bu("!=",function(v,c,b){return c!==b},function(v,c,b,k){return!sd(0,c,b,k)}),Ah=Bu("<",function(v,c,b){return c<b},function(v,c,b,k){return k.compare(c,b)<0}),lp=Bu(">",function(v,c,b){return c>b},function(v,c,b,k){return k.compare(c,b)>0}),hl=Bu("<=",function(v,c,b){return c<=b},function(v,c,b,k){return k.compare(c,b)<=0}),$f=Bu(">=",function(v,c,b){return c>=b},function(v,c,b,k){return k.compare(c,b)>=0});class Th{constructor(c,b,k,z,V){this.type=Xn,this.number=c,this.locale=b,this.currency=k,this.minFractionDigits=z,this.maxFractionDigits=V}static parse(c,b){if(c.length!==3)return b.error("Expected two arguments.");const k=b.parse(c[1],1,on);if(!k)return null;const z=c[2];if(typeof z!="object"||Array.isArray(z))return b.error("NumberFormat options argument must be an object.");let V=null;if(z.locale&&(V=b.parse(z.locale,1,Xn),!V))return null;let W=null;if(z.currency&&(W=b.parse(z.currency,1,Xn),!W))return null;let ne=null;if(z["min-fraction-digits"]&&(ne=b.parse(z["min-fraction-digits"],1,on),!ne))return null;let he=null;return z["max-fraction-digits"]&&(he=b.parse(z["max-fraction-digits"],1,on),!he)?null:new Th(k,V,W,ne,he)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class _h{constructor(c){this.type=Wt,this.sections=c}static parse(c,b){if(c.length<2)return b.error("Expected at least one argument.");const k=c[1];if(!Array.isArray(k)&&typeof k=="object")return b.error("First argument must be an image or text section.");const z=[];let V=!1;for(let W=1;W<=c.length-1;++W){const ne=c[W];if(V&&typeof ne=="object"&&!Array.isArray(ne)){V=!1;let he=null;if(ne["font-scale"]&&(he=b.parse(ne["font-scale"],1,on),!he))return null;let Se=null;if(ne["text-font"]&&(Se=b.parse(ne["text-font"],1,Ae(Xn)),!Se))return null;let Ne=null;if(ne["text-color"]&&(Ne=b.parse(ne["text-color"],1,Pa),!Ne))return null;const We=z[z.length-1];We.scale=he,We.font=Se,We.textColor=Ne}else{const he=b.parse(c[W],1,ya);if(!he)return null;const Se=he.type.kind;if(Se!=="string"&&Se!=="value"&&Se!=="null"&&Se!=="resolvedImage")return b.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");V=!0,z.push({content:he,scale:null,font:null,textColor:null})}}return new _h(z)}evaluate(c){return new to(this.sections.map(b=>{const k=b.content.evaluate(c);return Io(k)===se?new To("",k,null,null,null):new To(bo(k),null,b.scale?b.scale.evaluate(c):null,b.font?b.font.evaluate(c).join(","):null,b.textColor?b.textColor.evaluate(c):null)}))}eachChild(c){for(const b of this.sections)c(b.content),b.scale&&c(b.scale),b.font&&c(b.font),b.textColor&&c(b.textColor)}outputDefined(){return!1}}class nh{constructor(c){this.type=se,this.input=c}static parse(c,b){if(c.length!==2)return b.error("Expected two arguments.");const k=b.parse(c[1],1,Xn);return k?new nh(k):b.error("No image name provided.")}evaluate(c){const b=this.input.evaluate(c),k=Ss.fromString(b);return k&&c.availableImages&&(k.available=c.availableImages.indexOf(b)>-1),k}eachChild(c){c(this.input)}outputDefined(){return!1}}class $p{constructor(c){this.type=on,this.input=c}static parse(c,b){if(c.length!==2)return b.error(`Expected 1 argument, but found ${c.length-1} instead.`);const k=b.parse(c[1],1);return k?k.type.kind!=="array"&&k.type.kind!=="string"&&k.type.kind!=="value"?b.error(`Expected argument of type string or array, but found ${Re(k.type)} instead.`):new $p(k):null}evaluate(c){const b=this.input.evaluate(c);if(typeof b=="string"||Array.isArray(b))return b.length;throw new Zo(`Expected value to be of type string or array, but found ${Re(Io(b))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const cp={"==":$d,"!=":rh,">":lp,"<":Ah,">=":$f,"<=":hl,array:Uo,at:Ch,boolean:Uo,case:Hp,coalesce:tl,collator:_c,format:_h,image:nh,in:Hf,"index-of":Vn,interpolate:Vs,"interpolate-hcl":Vs,"interpolate-lab":Vs,length:$p,let:vu,literal:du,match:gi,number:Uo,"number-format":Th,object:Uo,slice:nf,step:uu,string:Uo,"to-boolean":eu,"to-color":eu,"to-number":eu,"to-string":eu,var:su,within:th};function Mu(v,[c,b,k,z]){c=c.evaluate(v),b=b.evaluate(v),k=k.evaluate(v);const V=z?z.evaluate(v):1,W=eh(c,b,k,V);if(W)throw new Zo(W);return new vo(c/255,b/255,k/255,V,!1)}function af(v,c){return v in c}function hp(v,c){const b=c[v];return b===void 0?null:b}function ih(v){return{type:v}}function fp(v){return{result:"success",value:v}}function Vh(v){return{result:"error",value:v}}function Nu(v){return v["property-type"]==="data-driven"||v["property-type"]==="cross-faded-data-driven"}function Wf(v){return!!v.expression&&v.expression.parameters.indexOf("zoom")>-1}function Sf(v){return!!v.expression&&v.expression.interpolated}function ko(v){return v instanceof Number?"number":v instanceof String?"string":v instanceof Boolean?"boolean":Array.isArray(v)?"array":v===null?"null":typeof v}function rl(v){return typeof v=="object"&&v!==null&&!Array.isArray(v)}function pp(v){return v}function jo(v,c){const b=c.type==="color",k=v.stops&&typeof v.stops[0][0]=="object",z=k||!(k||v.property!==void 0),V=v.type||(Sf(c)?"exponential":"interval");if(b||c.type==="padding"){const Ne=b?vo.parse:js.parse;(v=Un({},v)).stops&&(v.stops=v.stops.map(We=>[We[0],Ne(We[1])])),v.default=Ne(v.default?v.default:c.default)}if(v.colorSpace&&(W=v.colorSpace)!=="rgb"&&W!=="hcl"&&W!=="lab")throw new Error(`Unknown color space: "${v.colorSpace}"`);var W;let ne,he,Se;if(V==="exponential")ne=Mh;else if(V==="interval")ne=mu;else if(V==="categorical"){ne=_u,he=Object.create(null);for(const Ne of v.stops)he[Ne[0]]=Ne[1];Se=typeof v.stops[0][0]}else{if(V!=="identity")throw new Error(`Unknown function type "${V}"`);ne=ud}if(k){const Ne={},We=[];for(let St=0;St<v.stops.length;St++){const Ht=v.stops[St],ir=Ht[0].zoom;Ne[ir]===void 0&&(Ne[ir]={zoom:ir,type:v.type,property:v.property,default:v.default,stops:[]},We.push(ir)),Ne[ir].stops.push([Ht[0].value,Ht[1]])}const ht=[];for(const St of We)ht.push([Ne[St].zoom,jo(Ne[St],c)]);const gt={name:"linear"};return{kind:"composite",interpolationType:gt,interpolationFactor:Vs.interpolationFactor.bind(void 0,gt),zoomStops:ht.map(St=>St[0]),evaluate:({zoom:St},Ht)=>Mh({stops:ht,base:v.base},c,St).evaluate(St,Ht)}}if(z){const Ne=V==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:Ne,interpolationFactor:Vs.interpolationFactor.bind(void 0,Ne),zoomStops:v.stops.map(We=>We[0]),evaluate:({zoom:We})=>ne(v,c,We,he,Se)}}return{kind:"source",evaluate(Ne,We){const ht=We&&We.properties?We.properties[v.property]:void 0;return ht===void 0?hc(v.default,c.default):ne(v,c,ht,he,Se)}}}function hc(v,c,b){return v!==void 0?v:c!==void 0?c:b!==void 0?b:void 0}function _u(v,c,b,k,z){return hc(typeof b===z?k[b]:void 0,v.default,c.default)}function mu(v,c,b){if(ko(b)!=="number")return hc(v.default,c.default);const k=v.stops.length;if(k===1||b<=v.stops[0][0])return v.stops[0][1];if(b>=v.stops[k-1][0])return v.stops[k-1][1];const z=cc(v.stops.map(V=>V[0]),b);return v.stops[z][1]}function Mh(v,c,b){const k=v.base!==void 0?v.base:1;if(ko(b)!=="number")return hc(v.default,c.default);const z=v.stops.length;if(z===1||b<=v.stops[0][0])return v.stops[0][1];if(b>=v.stops[z-1][0])return v.stops[z-1][1];const V=cc(v.stops.map(Ne=>Ne[0]),b),W=function(Ne,We,ht,gt){const St=gt-ht,Ht=Ne-ht;return St===0?0:We===1?Ht/St:(Math.pow(We,Ht)-1)/(Math.pow(We,St)-1)}(b,k,v.stops[V][0],v.stops[V+1][0]),ne=v.stops[V][1],he=v.stops[V+1][1],Se=Yu[c.type]||pp;return typeof ne.evaluate=="function"?{evaluate(...Ne){const We=ne.evaluate.apply(void 0,Ne),ht=he.evaluate.apply(void 0,Ne);if(We!==void 0&&ht!==void 0)return Se(We,ht,W,v.colorSpace)}}:Se(ne,he,W,v.colorSpace)}function ud(v,c,b){switch(c.type){case"color":b=vo.parse(b);break;case"formatted":b=to.fromString(b.toString());break;case"resolvedImage":b=Ss.fromString(b.toString());break;case"padding":b=js.parse(b);break;default:ko(b)===c.type||c.type==="enum"&&c.values[b]||(b=void 0)}return hc(b,v.default,c.default)}_a.register(cp,{error:[{kind:"error"},[Xn],(v,[c])=>{throw new Zo(c.evaluate(v))}],typeof:[Xn,[ya],(v,[c])=>Re(Io(c.evaluate(v)))],"to-rgba":[Ae(on,4),[Pa],(v,[c])=>{const[b,k,z,V]=c.evaluate(v).rgb;return[255*b,255*k,255*z,V]}],rgb:[Pa,[on,on,on],Mu],rgba:[Pa,[on,on,on,on],Mu],has:{type:Pi,overloads:[[[Xn],(v,[c])=>af(c.evaluate(v),v.properties())],[[Xn,zo],(v,[c,b])=>af(c.evaluate(v),b.evaluate(v))]]},get:{type:ya,overloads:[[[Xn],(v,[c])=>hp(c.evaluate(v),v.properties())],[[Xn,zo],(v,[c,b])=>hp(c.evaluate(v),b.evaluate(v))]]},"feature-state":[ya,[Xn],(v,[c])=>hp(c.evaluate(v),v.featureState||{})],properties:[zo,[],v=>v.properties()],"geometry-type":[Xn,[],v=>v.geometryType()],id:[ya,[],v=>v.id()],zoom:[on,[],v=>v.globals.zoom],"heatmap-density":[on,[],v=>v.globals.heatmapDensity||0],"line-progress":[on,[],v=>v.globals.lineProgress||0],accumulated:[ya,[],v=>v.globals.accumulated===void 0?null:v.globals.accumulated],"+":[on,ih(on),(v,c)=>{let b=0;for(const k of c)b+=k.evaluate(v);return b}],"*":[on,ih(on),(v,c)=>{let b=1;for(const k of c)b*=k.evaluate(v);return b}],"-":{type:on,overloads:[[[on,on],(v,[c,b])=>c.evaluate(v)-b.evaluate(v)],[[on],(v,[c])=>-c.evaluate(v)]]},"/":[on,[on,on],(v,[c,b])=>c.evaluate(v)/b.evaluate(v)],"%":[on,[on,on],(v,[c,b])=>c.evaluate(v)%b.evaluate(v)],ln2:[on,[],()=>Math.LN2],pi:[on,[],()=>Math.PI],e:[on,[],()=>Math.E],"^":[on,[on,on],(v,[c,b])=>Math.pow(c.evaluate(v),b.evaluate(v))],sqrt:[on,[on],(v,[c])=>Math.sqrt(c.evaluate(v))],log10:[on,[on],(v,[c])=>Math.log(c.evaluate(v))/Math.LN10],ln:[on,[on],(v,[c])=>Math.log(c.evaluate(v))],log2:[on,[on],(v,[c])=>Math.log(c.evaluate(v))/Math.LN2],sin:[on,[on],(v,[c])=>Math.sin(c.evaluate(v))],cos:[on,[on],(v,[c])=>Math.cos(c.evaluate(v))],tan:[on,[on],(v,[c])=>Math.tan(c.evaluate(v))],asin:[on,[on],(v,[c])=>Math.asin(c.evaluate(v))],acos:[on,[on],(v,[c])=>Math.acos(c.evaluate(v))],atan:[on,[on],(v,[c])=>Math.atan(c.evaluate(v))],min:[on,ih(on),(v,c)=>Math.min(...c.map(b=>b.evaluate(v)))],max:[on,ih(on),(v,c)=>Math.max(...c.map(b=>b.evaluate(v)))],abs:[on,[on],(v,[c])=>Math.abs(c.evaluate(v))],round:[on,[on],(v,[c])=>{const b=c.evaluate(v);return b<0?-Math.round(-b):Math.round(b)}],floor:[on,[on],(v,[c])=>Math.floor(c.evaluate(v))],ceil:[on,[on],(v,[c])=>Math.ceil(c.evaluate(v))],"filter-==":[Pi,[Xn,ya],(v,[c,b])=>v.properties()[c.value]===b.value],"filter-id-==":[Pi,[ya],(v,[c])=>v.id()===c.value],"filter-type-==":[Pi,[Xn],(v,[c])=>v.geometryType()===c.value],"filter-<":[Pi,[Xn,ya],(v,[c,b])=>{const k=v.properties()[c.value],z=b.value;return typeof k==typeof z&&k<z}],"filter-id-<":[Pi,[ya],(v,[c])=>{const b=v.id(),k=c.value;return typeof b==typeof k&&b<k}],"filter->":[Pi,[Xn,ya],(v,[c,b])=>{const k=v.properties()[c.value],z=b.value;return typeof k==typeof z&&k>z}],"filter-id->":[Pi,[ya],(v,[c])=>{const b=v.id(),k=c.value;return typeof b==typeof k&&b>k}],"filter-<=":[Pi,[Xn,ya],(v,[c,b])=>{const k=v.properties()[c.value],z=b.value;return typeof k==typeof z&&k<=z}],"filter-id-<=":[Pi,[ya],(v,[c])=>{const b=v.id(),k=c.value;return typeof b==typeof k&&b<=k}],"filter->=":[Pi,[Xn,ya],(v,[c,b])=>{const k=v.properties()[c.value],z=b.value;return typeof k==typeof z&&k>=z}],"filter-id->=":[Pi,[ya],(v,[c])=>{const b=v.id(),k=c.value;return typeof b==typeof k&&b>=k}],"filter-has":[Pi,[ya],(v,[c])=>c.value in v.properties()],"filter-has-id":[Pi,[],v=>v.id()!==null&&v.id()!==void 0],"filter-type-in":[Pi,[Ae(Xn)],(v,[c])=>c.value.indexOf(v.geometryType())>=0],"filter-id-in":[Pi,[Ae(ya)],(v,[c])=>c.value.indexOf(v.id())>=0],"filter-in-small":[Pi,[Xn,Ae(ya)],(v,[c,b])=>b.value.indexOf(v.properties()[c.value])>=0],"filter-in-large":[Pi,[Xn,Ae(ya)],(v,[c,b])=>function(k,z,V,W){for(;V<=W;){const ne=V+W>>1;if(z[ne]===k)return!0;z[ne]>k?W=ne-1:V=ne+1}return!1}(v.properties()[c.value],b.value,0,b.value.length-1)],all:{type:Pi,overloads:[[[Pi,Pi],(v,[c,b])=>c.evaluate(v)&&b.evaluate(v)],[ih(Pi),(v,c)=>{for(const b of c)if(!b.evaluate(v))return!1;return!0}]]},any:{type:Pi,overloads:[[[Pi,Pi],(v,[c,b])=>c.evaluate(v)||b.evaluate(v)],[ih(Pi),(v,c)=>{for(const b of c)if(b.evaluate(v))return!0;return!1}]]},"!":[Pi,[Pi],(v,[c])=>!c.evaluate(v)],"is-supported-script":[Pi,[Xn],(v,[c])=>{const b=v.globals&&v.globals.isSupportedScript;return!b||b(c.evaluate(v))}],upcase:[Xn,[Xn],(v,[c])=>c.evaluate(v).toUpperCase()],downcase:[Xn,[Xn],(v,[c])=>c.evaluate(v).toLowerCase()],concat:[Xn,ih(ya),(v,c)=>c.map(b=>bo(b.evaluate(v))).join("")],"resolved-locale":[Xn,[Xu],(v,[c])=>c.evaluate(v).resolvedLocale()]});class of{constructor(c,b){var k;this.expression=c,this._warningHistory={},this._evaluator=new ul,this._defaultValue=b?(k=b).type==="color"&&rl(k.default)?new vo(0,0,0,0):k.type==="color"?vo.parse(k.default)||null:k.type==="padding"?js.parse(k.default)||null:k.type==="variableAnchorOffsetCollection"?ws.parse(k.default)||null:k.default===void 0?null:k.default:null,this._enumValues=b&&b.type==="enum"?b.values:null}evaluateWithoutErrorHandling(c,b,k,z,V,W){return this._evaluator.globals=c,this._evaluator.feature=b,this._evaluator.featureState=k,this._evaluator.canonical=z,this._evaluator.availableImages=V||null,this._evaluator.formattedSection=W,this.expression.evaluate(this._evaluator)}evaluate(c,b,k,z,V,W){this._evaluator.globals=c,this._evaluator.feature=b||null,this._evaluator.featureState=k||null,this._evaluator.canonical=z,this._evaluator.availableImages=V||null,this._evaluator.formattedSection=W||null;try{const ne=this.expression.evaluate(this._evaluator);if(ne==null||typeof ne=="number"&&ne!=ne)return this._defaultValue;if(this._enumValues&&!(ne in this._enumValues))throw new Zo(`Expected value to be one of ${Object.keys(this._enumValues).map(he=>JSON.stringify(he)).join(", ")}, but found ${JSON.stringify(ne)} instead.`);return ne}catch(ne){return this._warningHistory[ne.message]||(this._warningHistory[ne.message]=!0,typeof console!="undefined"&&console.warn(ne.message)),this._defaultValue}}}function Eu(v){return Array.isArray(v)&&v.length>0&&typeof v[0]=="string"&&v[0]in cp}function dp(v,c){const b=new ll(cp,os,[],c?function(z){const V={color:Pa,string:Xn,number:on,enum:Xn,boolean:Pi,formatted:Wt,padding:qe,resolvedImage:se,variableAnchorOffsetCollection:ve};return z.type==="array"?Ae(V[z.value]||ya,z.length):V[z.type]}(c):void 0),k=b.parse(v,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return k?fp(new of(k,c)):Vh(b.errors)}class Wp{constructor(c,b){this.kind=c,this._styleExpression=b,this.isStateDependent=c!=="constant"&&!Eh(b.expression)}evaluateWithoutErrorHandling(c,b,k,z,V,W){return this._styleExpression.evaluateWithoutErrorHandling(c,b,k,z,V,W)}evaluate(c,b,k,z,V,W){return this._styleExpression.evaluate(c,b,k,z,V,W)}}class Ph{constructor(c,b,k,z){this.kind=c,this.zoomStops=k,this._styleExpression=b,this.isStateDependent=c!=="camera"&&!Eh(b.expression),this.interpolationType=z}evaluateWithoutErrorHandling(c,b,k,z,V,W){return this._styleExpression.evaluateWithoutErrorHandling(c,b,k,z,V,W)}evaluate(c,b,k,z,V,W){return this._styleExpression.evaluate(c,b,k,z,V,W)}interpolationFactor(c,b,k){return this.interpolationType?Vs.interpolationFactor(this.interpolationType,c,b,k):0}}function wd(v,c){const b=dp(v,c);if(b.result==="error")return b;const k=b.value.expression,z=Su(k);if(!z&&!Nu(c))return Vh([new ti("","data expressions not supported")]);const V=Mo(k,["zoom"]);if(!V&&!Wf(c))return Vh([new ti("","zoom expressions not supported")]);const W=vp(k);return W||V?W instanceof ti?Vh([W]):W instanceof Vs&&!Sf(c)?Vh([new ti("",'"interpolate" expressions cannot be used with this property')]):fp(W?new Ph(z?"camera":"composite",b.value,W.labels,W instanceof Vs?W.interpolation:void 0):new Wp(z?"constant":"source",b.value)):Vh([new ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xp{constructor(c,b){this._parameters=c,this._specification=b,Un(this,jo(this._parameters,this._specification))}static deserialize(c){return new Xp(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function vp(v){let c=null;if(v instanceof vu)c=vp(v.result);else if(v instanceof tl){for(const b of v.args)if(c=vp(b),c)break}else(v instanceof uu||v instanceof Vs)&&v.input instanceof _a&&v.input.name==="zoom"&&(c=v);return c instanceof ti||v.eachChild(b=>{const k=vp(b);k instanceof ti?c=k:!c&&k?c=new ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&k&&c!==k&&(c=new ti("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function Ga(v){if(v===!0||v===!1)return!0;if(!Array.isArray(v)||v.length===0)return!1;switch(v[0]){case"has":return v.length>=2&&v[1]!=="$id"&&v[1]!=="$type";case"in":return v.length>=3&&(typeof v[1]!="string"||Array.isArray(v[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return v.length!==3||Array.isArray(v[1])||Array.isArray(v[2]);case"any":case"all":for(const c of v.slice(1))if(!Ga(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const mp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hc(v){if(v==null)return{filter:()=>!0,needGeometry:!1};Ga(v)||(v=ah(v));const c=dp(v,mp);if(c.result==="error")throw new Error(c.value.map(b=>`${b.key}: ${b.message}`).join(", "));return{filter:(b,k,z)=>c.value.evaluate(b,k,{},z),needGeometry:sf(v)}}function gp(v,c){return v<c?-1:v>c?1:0}function sf(v){if(!Array.isArray(v))return!1;if(v[0]==="within")return!0;for(let c=1;c<v.length;c++)if(sf(v[c]))return!0;return!1}function ah(v){if(!v)return!0;const c=v[0];return v.length<=1?c!=="any":c==="=="?wo(v[1],v[2],"=="):c==="!="?bh(wo(v[1],v[2],"==")):c==="<"||c===">"||c==="<="||c===">="?wo(v[1],v[2],c):c==="any"?(b=v.slice(1),["any"].concat(b.map(ah))):c==="all"?["all"].concat(v.slice(1).map(ah)):c==="none"?["all"].concat(v.slice(1).map(ah).map(bh)):c==="in"?fl(v[1],v.slice(2)):c==="!in"?bh(fl(v[1],v.slice(2))):c==="has"?pl(v[1]):c==="!has"?bh(pl(v[1])):c!=="within"||v;var b}function wo(v,c,b){switch(v){case"$type":return[`filter-type-${b}`,c];case"$id":return[`filter-id-${b}`,c];default:return[`filter-${b}`,v,c]}}function fl(v,c){if(c.length===0)return!1;switch(v){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(b=>typeof b!=typeof c[0])?["filter-in-large",v,["literal",c.sort(gp)]]:["filter-in-small",v,["literal",c]]}}function pl(v){switch(v){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",v]}}function bh(v){return["!",v]}function Xf(v){const c=typeof v;if(c==="number"||c==="boolean"||c==="string"||v==null)return JSON.stringify(v);if(Array.isArray(v)){let z="[";for(const V of v)z+=`${Xf(V)},`;return`${z}]`}const b=Object.keys(v).sort();let k="{";for(let z=0;z<b.length;z++)k+=`${JSON.stringify(b[z])}:${Xf(v[b[z]])},`;return`${k}}`}function yp(v){let c="";for(const b of Ua)c+=`/${Xf(v[b])}`;return c}function Gh(v){const c=v.value;return c?[new dr(v.key,c,"constants have been deprecated as of v8")]:[]}function Vu(v){return v instanceof Number||v instanceof String||v instanceof Boolean?v.valueOf():v}function Yf(v){if(Array.isArray(v))return v.map(Yf);if(v instanceof Object&&!(v instanceof Number||v instanceof String||v instanceof Boolean)){const c={};for(const b in v)c[b]=Yf(v[b]);return c}return Vu(v)}function Ll(v){const c=v.key,b=v.value,k=v.valueSpec||{},z=v.objectElementValidators||{},V=v.style,W=v.styleSpec,ne=v.validateSpec;let he=[];const Se=ko(b);if(Se!=="object")return[new dr(c,b,`object expected, ${Se} found`)];for(const Ne in b){const We=Ne.split(".")[0],ht=k[We]||k["*"];let gt;if(z[We])gt=z[We];else if(k[We])gt=ne;else if(z["*"])gt=z["*"];else{if(!k["*"]){he.push(new dr(c,b[Ne],`unknown property "${Ne}"`));continue}gt=ne}he=he.concat(gt({key:(c&&`${c}.`)+Ne,value:b[Ne],valueSpec:ht,style:V,styleSpec:W,object:b,objectKey:Ne,validateSpec:ne},b))}for(const Ne in k)z[Ne]||k[Ne].required&&k[Ne].default===void 0&&b[Ne]===void 0&&he.push(new dr(c,b,`missing required property "${Ne}"`));return he}function uf(v){const c=v.value,b=v.valueSpec,k=v.style,z=v.styleSpec,V=v.key,W=v.arrayElementValidator||v.validateSpec;if(ko(c)!=="array")return[new dr(V,c,`array expected, ${ko(c)} found`)];if(b.length&&c.length!==b.length)return[new dr(V,c,`array length ${b.length} expected, length ${c.length} found`)];if(b["min-length"]&&c.length<b["min-length"])return[new dr(V,c,`array length at least ${b["min-length"]} expected, length ${c.length} found`)];let ne={type:b.value,values:b.values};z.$version<7&&(ne.function=b.function),ko(b.value)==="object"&&(ne=b.value);let he=[];for(let Se=0;Se<c.length;Se++)he=he.concat(W({array:c,arrayIndex:Se,value:c[Se],valueSpec:ne,validateSpec:v.validateSpec,style:k,styleSpec:z,key:`${V}[${Se}]`}));return he}function Pp(v){const c=v.key,b=v.value,k=v.valueSpec;let z=ko(b);return z==="number"&&b!=b&&(z="NaN"),z!=="number"?[new dr(c,b,`number expected, ${z} found`)]:"minimum"in k&&b<k.minimum?[new dr(c,b,`${b} is less than the minimum value ${k.minimum}`)]:"maximum"in k&&b>k.maximum?[new dr(c,b,`${b} is greater than the maximum value ${k.maximum}`)]:[]}function kh(v){const c=v.valueSpec,b=Vu(v.value.type);let k,z,V,W={};const ne=b!=="categorical"&&v.value.property===void 0,he=!ne,Se=ko(v.value.stops)==="array"&&ko(v.value.stops[0])==="array"&&ko(v.value.stops[0][0])==="object",Ne=Ll({key:v.key,value:v.value,valueSpec:v.styleSpec.function,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{stops:function(gt){if(b==="identity")return[new dr(gt.key,gt.value,'identity function may not have a "stops" property')];let St=[];const Ht=gt.value;return St=St.concat(uf({key:gt.key,value:Ht,valueSpec:gt.valueSpec,validateSpec:gt.validateSpec,style:gt.style,styleSpec:gt.styleSpec,arrayElementValidator:We})),ko(Ht)==="array"&&Ht.length===0&&St.push(new dr(gt.key,Ht,"array must have at least one stop")),St},default:function(gt){return gt.validateSpec({key:gt.key,value:gt.value,valueSpec:c,validateSpec:gt.validateSpec,style:gt.style,styleSpec:gt.styleSpec})}}});return b==="identity"&&ne&&Ne.push(new dr(v.key,v.value,'missing required property "property"')),b==="identity"||v.value.stops||Ne.push(new dr(v.key,v.value,'missing required property "stops"')),b==="exponential"&&v.valueSpec.expression&&!Sf(v.valueSpec)&&Ne.push(new dr(v.key,v.value,"exponential functions not supported")),v.styleSpec.$version>=8&&(he&&!Nu(v.valueSpec)?Ne.push(new dr(v.key,v.value,"property functions not supported")):ne&&!Wf(v.valueSpec)&&Ne.push(new dr(v.key,v.value,"zoom functions not supported"))),b!=="categorical"&&!Se||v.value.property!==void 0||Ne.push(new dr(v.key,v.value,'"property" property is required')),Ne;function We(gt){let St=[];const Ht=gt.value,ir=gt.key;if(ko(Ht)!=="array")return[new dr(ir,Ht,`array expected, ${ko(Ht)} found`)];if(Ht.length!==2)return[new dr(ir,Ht,`array length 2 expected, length ${Ht.length} found`)];if(Se){if(ko(Ht[0])!=="object")return[new dr(ir,Ht,`object expected, ${ko(Ht[0])} found`)];if(Ht[0].zoom===void 0)return[new dr(ir,Ht,"object stop key must have zoom")];if(Ht[0].value===void 0)return[new dr(ir,Ht,"object stop key must have value")];if(V&&V>Vu(Ht[0].zoom))return[new dr(ir,Ht[0].zoom,"stop zoom values must appear in ascending order")];Vu(Ht[0].zoom)!==V&&(V=Vu(Ht[0].zoom),z=void 0,W={}),St=St.concat(Ll({key:`${ir}[0]`,value:Ht[0],valueSpec:{zoom:{}},validateSpec:gt.validateSpec,style:gt.style,styleSpec:gt.styleSpec,objectElementValidators:{zoom:Pp,value:ht}}))}else St=St.concat(ht({key:`${ir}[0]`,value:Ht[0],valueSpec:{},validateSpec:gt.validateSpec,style:gt.style,styleSpec:gt.styleSpec},Ht));return Eu(Yf(Ht[1]))?St.concat([new dr(`${ir}[1]`,Ht[1],"expressions are not allowed in function stops.")]):St.concat(gt.validateSpec({key:`${ir}[1]`,value:Ht[1],valueSpec:c,validateSpec:gt.validateSpec,style:gt.style,styleSpec:gt.styleSpec}))}function ht(gt,St){const Ht=ko(gt.value),ir=Vu(gt.value),fr=gt.value!==null?gt.value:St;if(k){if(Ht!==k)return[new dr(gt.key,fr,`${Ht} stop domain type must match previous stop domain type ${k}`)]}else k=Ht;if(Ht!=="number"&&Ht!=="string"&&Ht!=="boolean")return[new dr(gt.key,fr,"stop domain value must be a number, string, or boolean")];if(Ht!=="number"&&b!=="categorical"){let Gr=`number expected, ${Ht} found`;return Nu(c)&&b===void 0&&(Gr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dr(gt.key,fr,Gr)]}return b!=="categorical"||Ht!=="number"||isFinite(ir)&&Math.floor(ir)===ir?b!=="categorical"&&Ht==="number"&&z!==void 0&&ir<z?[new dr(gt.key,fr,"stop domain values must appear in ascending order")]:(z=ir,b==="categorical"&&ir in W?[new dr(gt.key,fr,"stop domain values must be unique")]:(W[ir]=!0,[])):[new dr(gt.key,fr,`integer expected, found ${ir}`)]}}function Xs(v){const c=(v.expressionContext==="property"?wd:dp)(Yf(v.value),v.valueSpec);if(c.result==="error")return c.value.map(k=>new dr(`${v.key}${k.key}`,v.value,k.message));const b=c.value.expression||c.value._styleExpression.expression;if(v.expressionContext==="property"&&v.propertyKey==="text-font"&&!b.outputDefined())return[new dr(v.key,v.value,`Invalid data expression for "${v.propertyKey}". Output values must be contained as literals within the expression.`)];if(v.expressionContext==="property"&&v.propertyType==="layout"&&!Eh(b))return[new dr(v.key,v.value,'"feature-state" data expressions are not supported with layout properties.')];if(v.expressionContext==="filter"&&!Eh(b))return[new dr(v.key,v.value,'"feature-state" data expressions are not supported with filters.')];if(v.expressionContext&&v.expressionContext.indexOf("cluster")===0){if(!Mo(b,["zoom","feature-state"]))return[new dr(v.key,v.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(v.expressionContext==="cluster-initial"&&!Su(b))return[new dr(v.key,v.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qf(v){const c=v.key,b=v.value,k=v.valueSpec,z=[];return Array.isArray(k.values)?k.values.indexOf(Vu(b))===-1&&z.push(new dr(c,b,`expected one of [${k.values.join(", ")}], ${JSON.stringify(b)} found`)):Object.keys(k.values).indexOf(Vu(b))===-1&&z.push(new dr(c,b,`expected one of [${Object.keys(k.values).join(", ")}], ${JSON.stringify(b)} found`)),z}function _p(v){return Ga(Yf(v.value))?Xs(Un({},v,{expressionContext:"filter",valueSpec:{value:"boolean"}})):bp(v)}function bp(v){const c=v.value,b=v.key;if(ko(c)!=="array")return[new dr(b,c,`array expected, ${ko(c)} found`)];const k=v.styleSpec;let z,V=[];if(c.length<1)return[new dr(b,c,"filter array must have at least 1 element")];switch(V=V.concat(qf({key:`${b}[0]`,value:c[0],valueSpec:k.filter_operator,style:v.style,styleSpec:v.styleSpec})),Vu(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Vu(c[1])==="$type"&&V.push(new dr(b,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&V.push(new dr(b,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(z=ko(c[1]),z!=="string"&&V.push(new dr(`${b}[1]`,c[1],`string expected, ${z} found`)));for(let W=2;W<c.length;W++)z=ko(c[W]),Vu(c[1])==="$type"?V=V.concat(qf({key:`${b}[${W}]`,value:c[W],valueSpec:k.geometry_type,style:v.style,styleSpec:v.styleSpec})):z!=="string"&&z!=="number"&&z!=="boolean"&&V.push(new dr(`${b}[${W}]`,c[W],`string, number, or boolean expected, ${z} found`));break;case"any":case"all":case"none":for(let W=1;W<c.length;W++)V=V.concat(bp({key:`${b}[${W}]`,value:c[W],style:v.style,styleSpec:v.styleSpec}));break;case"has":case"!has":z=ko(c[1]),c.length!==2?V.push(new dr(b,c,`filter array for "${c[0]}" operator must have 2 elements`)):z!=="string"&&V.push(new dr(`${b}[1]`,c[1],`string expected, ${z} found`));break;case"within":z=ko(c[1]),c.length!==2?V.push(new dr(b,c,`filter array for "${c[0]}" operator must have 2 elements`)):z!=="object"&&V.push(new dr(`${b}[1]`,c[1],`object expected, ${z} found`))}return V}function Yp(v,c){const b=v.key,k=v.validateSpec,z=v.style,V=v.styleSpec,W=v.value,ne=v.objectKey,he=V[`${c}_${v.layerType}`];if(!he)return[];const Se=ne.match(/^(.*)-transition$/);if(c==="paint"&&Se&&he[Se[1]]&&he[Se[1]].transition)return k({key:b,value:W,valueSpec:V.transition,style:z,styleSpec:V});const Ne=v.valueSpec||he[ne];if(!Ne)return[new dr(b,W,`unknown property "${ne}"`)];let We;if(ko(W)==="string"&&Nu(Ne)&&!Ne.tokens&&(We=/^{([^}]+)}$/.exec(W)))return[new dr(b,W,`"${ne}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(We[1])} }\`.`)];const ht=[];return v.layerType==="symbol"&&(ne==="text-field"&&z&&!z.glyphs&&ht.push(new dr(b,W,'use of "text-field" requires a style "glyphs" property')),ne==="text-font"&&rl(Yf(W))&&Vu(W.type)==="identity"&&ht.push(new dr(b,W,'"text-font" does not support identity functions'))),ht.concat(k({key:v.key,value:W,valueSpec:Ne,style:z,styleSpec:V,expressionContext:"property",propertyType:c,propertyKey:ne}))}function kp(v){return Yp(v,"paint")}function xp(v){return Yp(v,"layout")}function Kl(v){let c=[];const b=v.value,k=v.key,z=v.style,V=v.styleSpec;b.type||b.ref||c.push(new dr(k,b,'either "type" or "ref" is required'));let W=Vu(b.type);const ne=Vu(b.ref);if(b.id){const he=Vu(b.id);for(let Se=0;Se<v.arrayIndex;Se++){const Ne=z.layers[Se];Vu(Ne.id)===he&&c.push(new dr(k,b.id,`duplicate layer id "${b.id}", previously used at line ${Ne.id.__line__}`))}}if("ref"in b){let he;["type","source","source-layer","filter","layout"].forEach(Se=>{Se in b&&c.push(new dr(k,b[Se],`"${Se}" is prohibited for ref layers`))}),z.layers.forEach(Se=>{Vu(Se.id)===ne&&(he=Se)}),he?he.ref?c.push(new dr(k,b.ref,"ref cannot reference another ref layer")):W=Vu(he.type):c.push(new dr(k,b.ref,`ref layer "${ne}" not found`))}else if(W!=="background")if(b.source){const he=z.sources&&z.sources[b.source],Se=he&&Vu(he.type);he?Se==="vector"&&W==="raster"?c.push(new dr(k,b.source,`layer "${b.id}" requires a raster source`)):Se!=="raster-dem"&&W==="hillshade"?c.push(new dr(k,b.source,`layer "${b.id}" requires a raster-dem source`)):Se==="raster"&&W!=="raster"?c.push(new dr(k,b.source,`layer "${b.id}" requires a vector source`)):Se!=="vector"||b["source-layer"]?Se==="raster-dem"&&W!=="hillshade"?c.push(new dr(k,b.source,"raster-dem source can only be used with layer type 'hillshade'.")):W!=="line"||!b.paint||!b.paint["line-gradient"]||Se==="geojson"&&he.lineMetrics||c.push(new dr(k,b,`layer "${b.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new dr(k,b,`layer "${b.id}" must specify a "source-layer"`)):c.push(new dr(k,b.source,`source "${b.source}" not found`))}else c.push(new dr(k,b,'missing required property "source"'));return c=c.concat(Ll({key:k,value:b,valueSpec:V.layer,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":()=>[],type:()=>v.validateSpec({key:`${k}.type`,value:b.type,valueSpec:V.layer.type,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,object:b,objectKey:"type"}),filter:_p,layout:he=>Ll({layer:b,key:he.key,value:he.value,style:he.style,styleSpec:he.styleSpec,validateSpec:he.validateSpec,objectElementValidators:{"*":Se=>xp(Un({layerType:W},Se))}}),paint:he=>Ll({layer:b,key:he.key,value:he.value,style:he.style,styleSpec:he.styleSpec,validateSpec:he.validateSpec,objectElementValidators:{"*":Se=>kp(Un({layerType:W},Se))}})}})),c}function $c(v){const c=v.value,b=v.key,k=ko(c);return k!=="string"?[new dr(b,c,`string expected, ${k} found`)]:[]}const Rl={promoteId:function({key:v,value:c}){if(ko(c)==="string")return $c({key:v,value:c});{const b=[];for(const k in c)b.push(...$c({key:`${v}.${k}`,value:c[k]}));return b}}};function Ms(v){const c=v.value,b=v.key,k=v.styleSpec,z=v.style,V=v.validateSpec;if(!c.type)return[new dr(b,c,'"type" is required')];const W=Vu(c.type);let ne;switch(W){case"vector":case"raster":return ne=Ll({key:b,value:c,valueSpec:k[`source_${W.replace("-","_")}`],style:v.style,styleSpec:k,objectElementValidators:Rl,validateSpec:V}),ne;case"raster-dem":return ne=function(he){var Se;const Ne=(Se=he.sourceName)!==null&&Se!==void 0?Se:"",We=he.value,ht=he.styleSpec,gt=ht.source_raster_dem,St=he.style;let Ht=[];const ir=ko(We);if(We===void 0)return Ht;if(ir!=="object")return Ht.push(new dr("source_raster_dem",We,`object expected, ${ir} found`)),Ht;const fr=Vu(We.encoding)==="custom",Gr=["redFactor","greenFactor","blueFactor","baseShift"],Tr=he.value.encoding?`"${he.value.encoding}"`:"Default";for(const Jr in We)!fr&&Gr.includes(Jr)?Ht.push(new dr(Jr,We[Jr],`In "${Ne}": "${Jr}" is only valid when "encoding" is set to "custom". ${Tr} encoding found`)):gt[Jr]?Ht=Ht.concat(he.validateSpec({key:Jr,value:We[Jr],valueSpec:gt[Jr],validateSpec:he.validateSpec,style:St,styleSpec:ht})):Ht.push(new dr(Jr,We[Jr],`unknown property "${Jr}"`));return Ht}({sourceName:b,value:c,style:v.style,styleSpec:k,validateSpec:V}),ne;case"geojson":if(ne=Ll({key:b,value:c,valueSpec:k.source_geojson,style:z,styleSpec:k,validateSpec:V,objectElementValidators:Rl}),c.cluster)for(const he in c.clusterProperties){const[Se,Ne]=c.clusterProperties[he],We=typeof Se=="string"?[Se,["accumulated"],["get",he]]:Se;ne.push(...Xs({key:`${b}.${he}.map`,value:Ne,validateSpec:V,expressionContext:"cluster-map"})),ne.push(...Xs({key:`${b}.${he}.reduce`,value:We,validateSpec:V,expressionContext:"cluster-reduce"}))}return ne;case"video":return Ll({key:b,value:c,valueSpec:k.source_video,style:z,validateSpec:V,styleSpec:k});case"image":return Ll({key:b,value:c,valueSpec:k.source_image,style:z,validateSpec:V,styleSpec:k});case"canvas":return[new dr(b,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qf({key:`${b}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:z,validateSpec:V,styleSpec:k})}}function Hh(v){const c=v.value,b=v.styleSpec,k=b.light,z=v.style;let V=[];const W=ko(c);if(c===void 0)return V;if(W!=="object")return V=V.concat([new dr("light",c,`object expected, ${W} found`)]),V;for(const ne in c){const he=ne.match(/^(.*)-transition$/);V=V.concat(he&&k[he[1]]&&k[he[1]].transition?v.validateSpec({key:ne,value:c[ne],valueSpec:b.transition,validateSpec:v.validateSpec,style:z,styleSpec:b}):k[ne]?v.validateSpec({key:ne,value:c[ne],valueSpec:k[ne],validateSpec:v.validateSpec,style:z,styleSpec:b}):[new dr(ne,c[ne],`unknown property "${ne}"`)])}return V}function lf(v){const c=v.value,b=v.styleSpec,k=b.terrain,z=v.style;let V=[];const W=ko(c);if(c===void 0)return V;if(W!=="object")return V=V.concat([new dr("terrain",c,`object expected, ${W} found`)]),V;for(const ne in c)V=V.concat(k[ne]?v.validateSpec({key:ne,value:c[ne],valueSpec:k[ne],validateSpec:v.validateSpec,style:z,styleSpec:b}):[new dr(ne,c[ne],`unknown property "${ne}"`)]);return V}function Ef(v){let c=[];const b=v.value,k=v.key;if(Array.isArray(b)){const z=[],V=[];for(const W in b)b[W].id&&z.includes(b[W].id)&&c.push(new dr(k,b,`all the sprites' ids must be unique, but ${b[W].id} is duplicated`)),z.push(b[W].id),b[W].url&&V.includes(b[W].url)&&c.push(new dr(k,b,`all the sprites' URLs must be unique, but ${b[W].url} is duplicated`)),V.push(b[W].url),c=c.concat(Ll({key:`${k}[${W}]`,value:b[W],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:v.validateSpec}));return c}return $c({key:k,value:b})}const vs={"*":()=>[],array:uf,boolean:function(v){const c=v.value,b=v.key,k=ko(c);return k!=="boolean"?[new dr(b,c,`boolean expected, ${k} found`)]:[]},number:Pp,color:function(v){const c=v.key,b=v.value,k=ko(b);return k!=="string"?[new dr(c,b,`color expected, ${k} found`)]:vo.parse(String(b))?[]:[new dr(c,b,`color expected, "${b}" found`)]},constants:Gh,enum:qf,filter:_p,function:kh,layer:Kl,object:Ll,source:Ms,light:Hh,terrain:lf,string:$c,formatted:function(v){return $c(v).length===0?[]:Xs(v)},resolvedImage:function(v){return $c(v).length===0?[]:Xs(v)},padding:function(v){const c=v.key,b=v.value;if(ko(b)==="array"){if(b.length<1||b.length>4)return[new dr(c,b,`padding requires 1 to 4 values; ${b.length} values found`)];const k={type:"number"};let z=[];for(let V=0;V<b.length;V++)z=z.concat(v.validateSpec({key:`${c}[${V}]`,value:b[V],validateSpec:v.validateSpec,valueSpec:k}));return z}return Pp({key:c,value:b,valueSpec:{}})},variableAnchorOffsetCollection:function(v){const c=v.key,b=v.value,k=ko(b),z=v.styleSpec;if(k!=="array"||b.length<1||b.length%2!=0)return[new dr(c,b,"variableAnchorOffsetCollection requires a non-empty array of even length")];let V=[];for(let W=0;W<b.length;W+=2)V=V.concat(qf({key:`${c}[${W}]`,value:b[W],valueSpec:z.layout_symbol["text-anchor"]})),V=V.concat(uf({key:`${c}[${W+1}]`,value:b[W+1],valueSpec:{length:2,value:"number"},validateSpec:v.validateSpec,style:v.style,styleSpec:z}));return V},sprite:Ef};function Ns(v){const c=v.value,b=v.valueSpec,k=v.styleSpec;return v.validateSpec=Ns,b.expression&&rl(Vu(c))?kh(v):b.expression&&Eu(Yf(c))?Xs(v):b.type&&vs[b.type]?vs[b.type](v):Ll(Un({},v,{valueSpec:b.type?k[b.type]:b}))}function bc(v){const c=v.value,b=v.key,k=$c(v);return k.length||(c.indexOf("{fontstack}")===-1&&k.push(new dr(b,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&k.push(new dr(b,c,'"glyphs" url must include a "{range}" token'))),k}function fc(v,c=un){let b=[];return b=b.concat(Ns({key:"",value:v,valueSpec:c.$root,styleSpec:c,style:v,validateSpec:Ns,objectElementValidators:{glyphs:bc,"*":()=>[]}})),v.constants&&(b=b.concat(Gh({key:"constants",value:v.constants,style:v,styleSpec:c,validateSpec:Ns}))),Pe(b)}function xc(v){return function(c){return v(oR(aR({},c),{validateSpec:Ns}))}}function Pe(v){return[].concat(v).sort((c,b)=>c.line-b.line)}function Ih(v){return function(...c){return Pe(v.apply(this,c))}}fc.source=Ih(xc(Ms)),fc.sprite=Ih(xc(Ef)),fc.glyphs=Ih(xc(bc)),fc.light=Ih(xc(Hh)),fc.terrain=Ih(xc(lf)),fc.layer=Ih(xc(Kl)),fc.filter=Ih(xc(_p)),fc.paintProperty=Ih(xc(kp)),fc.layoutProperty=Ih(xc(xp));const cf=fc,Cf=cf.light,Af=cf.paintProperty,Lh=cf.layoutProperty;function Cu(v,c){let b=!1;if(c&&c.length)for(const k of c)v.fire(new ha(new Error(k.message))),b=!0;return b}class nl{constructor(c,b,k){const z=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const W=new Int32Array(this.arrayBuffer);c=W[0],this.d=(b=W[1])+2*(k=W[2]);for(let he=0;he<this.d*this.d;he++){const Se=W[3+he],Ne=W[3+he+1];z.push(Se===Ne?null:W.subarray(Se,Ne))}const ne=W[3+z.length+1];this.keys=W.subarray(W[3+z.length],ne),this.bboxes=W.subarray(ne),this.insert=this._insertReadonly}else{this.d=b+2*k;for(let W=0;W<this.d*this.d;W++)z.push([]);this.keys=[],this.bboxes=[]}this.n=b,this.extent=c,this.padding=k,this.scale=b/c,this.uid=0;const V=k/b*c;this.min=-V,this.max=c+V}insert(c,b,k,z,V){this._forEachCell(b,k,z,V,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(b),this.bboxes.push(k),this.bboxes.push(z),this.bboxes.push(V)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,b,k,z,V,W){this.cells[V].push(W)}query(c,b,k,z,V){const W=this.min,ne=this.max;if(c<=W&&b<=W&&ne<=k&&ne<=z&&!V)return Array.prototype.slice.call(this.keys);{const he=[];return this._forEachCell(c,b,k,z,this._queryCell,he,{},V),he}}_queryCell(c,b,k,z,V,W,ne,he){const Se=this.cells[V];if(Se!==null){const Ne=this.keys,We=this.bboxes;for(let ht=0;ht<Se.length;ht++){const gt=Se[ht];if(ne[gt]===void 0){const St=4*gt;(he?he(We[St+0],We[St+1],We[St+2],We[St+3]):c<=We[St+2]&&b<=We[St+3]&&k>=We[St+0]&&z>=We[St+1])?(ne[gt]=!0,W.push(Ne[gt])):ne[gt]=!1}}}}_forEachCell(c,b,k,z,V,W,ne,he){const Se=this._convertToCellCoord(c),Ne=this._convertToCellCoord(b),We=this._convertToCellCoord(k),ht=this._convertToCellCoord(z);for(let gt=Se;gt<=We;gt++)for(let St=Ne;St<=ht;St++){const Ht=this.d*St+gt;if((!he||he(this._convertFromCellCoord(gt),this._convertFromCellCoord(St),this._convertFromCellCoord(gt+1),this._convertFromCellCoord(St+1)))&&V.call(this,c,b,k,z,Ht,W,ne,he))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,b=3+this.cells.length+1+1;let k=0;for(let W=0;W<this.cells.length;W++)k+=this.cells[W].length;const z=new Int32Array(b+k+this.keys.length+this.bboxes.length);z[0]=this.extent,z[1]=this.n,z[2]=this.padding;let V=b;for(let W=0;W<c.length;W++){const ne=c[W];z[3+W]=V,z.set(ne,V),V+=ne.length}return z[3+c.length]=V,z.set(this.keys,V),V+=this.keys.length,z[3+c.length+1]=V,z.set(this.bboxes,V),V+=this.bboxes.length,z.buffer}static serialize(c,b){const k=c.toArrayBuffer();return b&&b.push(k),{buffer:k}}static deserialize(c){return new nl(c.buffer)}}const Wc={};function zi(v,c,b={}){if(Wc[v])throw new Error(`${v} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:v,writeable:!1}),Wc[v]={klass:c,omit:b.omit||[],shallow:b.shallow||[]}}zi("Object",Object),zi("TransferableGridIndex",nl),zi("Color",vo),zi("Error",Error),zi("AJAXError",Ka),zi("ResolvedImage",Ss),zi("StylePropertyFunction",Xp),zi("StyleExpression",of,{omit:["_evaluator"]}),zi("ZoomDependentExpression",Ph),zi("ZoomConstantExpression",Wp),zi("CompoundExpression",_a,{omit:["_evaluate"]});for(const v in cp)cp[v]._classRegistryKey||zi(`Expression_${v}`,cp[v]);function Ui(v){return v&&typeof ArrayBuffer!="undefined"&&(v instanceof ArrayBuffer||v.constructor&&v.constructor.name==="ArrayBuffer")}function Gu(v,c){if(v==null||typeof v=="boolean"||typeof v=="number"||typeof v=="string"||v instanceof Boolean||v instanceof Number||v instanceof String||v instanceof Date||v instanceof RegExp||v instanceof Blob)return v;if(Ui(v)||Bt(v))return c&&c.push(v),v;if(ArrayBuffer.isView(v)){const b=v;return c&&c.push(b.buffer),b}if(v instanceof ImageData)return c&&c.push(v.data.buffer),v;if(Array.isArray(v)){const b=[];for(const k of v)b.push(Gu(k,c));return b}if(typeof v=="object"){const b=v.constructor,k=b._classRegistryKey;if(!k)throw new Error("can't serialize object of unregistered class");if(!Wc[k])throw new Error(`${k} is not registered.`);const z=b.serialize?b.serialize(v,c):{};if(b.serialize){if(c&&z===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const V in v){if(!v.hasOwnProperty(V)||Wc[k].omit.indexOf(V)>=0)continue;const W=v[V];z[V]=Wc[k].shallow.indexOf(V)>=0?W:Gu(W,c)}v instanceof Error&&(z.message=v.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return k!=="Object"&&(z.$name=k),z}throw new Error("can't serialize object of type "+typeof v)}function $h(v){if(v==null||typeof v=="boolean"||typeof v=="number"||typeof v=="string"||v instanceof Boolean||v instanceof Number||v instanceof String||v instanceof Date||v instanceof RegExp||v instanceof Blob||Ui(v)||Bt(v)||ArrayBuffer.isView(v)||v instanceof ImageData)return v;if(Array.isArray(v))return v.map($h);if(typeof v=="object"){const c=v.$name||"Object";if(!Wc[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:b}=Wc[c];if(!b)throw new Error(`can't deserialize unregistered class ${c}`);if(b.deserialize)return b.deserialize(v);const k=Object.create(b.prototype);for(const z of Object.keys(v)){if(z==="$name")continue;const V=v[z];k[z]=Wc[c].shallow.indexOf(z)>=0?V:$h(V)}return k}throw new Error("can't deserialize object of type "+typeof v)}class Wh{constructor(){this.first=!0}update(c,b){const k=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=k,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=k,!0):(this.lastFloorZoom>k?(this.lastIntegerZoom=k+1,this.lastIntegerZoomTime=b):this.lastFloorZoom<k&&(this.lastIntegerZoom=k,this.lastIntegerZoomTime=b),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=k,!0))}}const ji={"Latin-1 Supplement":v=>v>=128&&v<=255,Arabic:v=>v>=1536&&v<=1791,"Arabic Supplement":v=>v>=1872&&v<=1919,"Arabic Extended-A":v=>v>=2208&&v<=2303,"Hangul Jamo":v=>v>=4352&&v<=4607,"Unified Canadian Aboriginal Syllabics":v=>v>=5120&&v<=5759,Khmer:v=>v>=6016&&v<=6143,"Unified Canadian Aboriginal Syllabics Extended":v=>v>=6320&&v<=6399,"General Punctuation":v=>v>=8192&&v<=8303,"Letterlike Symbols":v=>v>=8448&&v<=8527,"Number Forms":v=>v>=8528&&v<=8591,"Miscellaneous Technical":v=>v>=8960&&v<=9215,"Control Pictures":v=>v>=9216&&v<=9279,"Optical Character Recognition":v=>v>=9280&&v<=9311,"Enclosed Alphanumerics":v=>v>=9312&&v<=9471,"Geometric Shapes":v=>v>=9632&&v<=9727,"Miscellaneous Symbols":v=>v>=9728&&v<=9983,"Miscellaneous Symbols and Arrows":v=>v>=11008&&v<=11263,"CJK Radicals Supplement":v=>v>=11904&&v<=12031,"Kangxi Radicals":v=>v>=12032&&v<=12255,"Ideographic Description Characters":v=>v>=12272&&v<=12287,"CJK Symbols and Punctuation":v=>v>=12288&&v<=12351,Hiragana:v=>v>=12352&&v<=12447,Katakana:v=>v>=12448&&v<=12543,Bopomofo:v=>v>=12544&&v<=12591,"Hangul Compatibility Jamo":v=>v>=12592&&v<=12687,Kanbun:v=>v>=12688&&v<=12703,"Bopomofo Extended":v=>v>=12704&&v<=12735,"CJK Strokes":v=>v>=12736&&v<=12783,"Katakana Phonetic Extensions":v=>v>=12784&&v<=12799,"Enclosed CJK Letters and Months":v=>v>=12800&&v<=13055,"CJK Compatibility":v=>v>=13056&&v<=13311,"CJK Unified Ideographs Extension A":v=>v>=13312&&v<=19903,"Yijing Hexagram Symbols":v=>v>=19904&&v<=19967,"CJK Unified Ideographs":v=>v>=19968&&v<=40959,"Yi Syllables":v=>v>=40960&&v<=42127,"Yi Radicals":v=>v>=42128&&v<=42191,"Hangul Jamo Extended-A":v=>v>=43360&&v<=43391,"Hangul Syllables":v=>v>=44032&&v<=55215,"Hangul Jamo Extended-B":v=>v>=55216&&v<=55295,"Private Use Area":v=>v>=57344&&v<=63743,"CJK Compatibility Ideographs":v=>v>=63744&&v<=64255,"Arabic Presentation Forms-A":v=>v>=64336&&v<=65023,"Vertical Forms":v=>v>=65040&&v<=65055,"CJK Compatibility Forms":v=>v>=65072&&v<=65103,"Small Form Variants":v=>v>=65104&&v<=65135,"Arabic Presentation Forms-B":v=>v>=65136&&v<=65279,"Halfwidth and Fullwidth Forms":v=>v>=65280&&v<=65519};function Ic(v){for(const c of v)if(ld(c.charCodeAt(0)))return!0;return!1}function hf(v){for(const c of v)if(!Gn(c.charCodeAt(0)))return!1;return!0}function Gn(v){return!(ji.Arabic(v)||ji["Arabic Supplement"](v)||ji["Arabic Extended-A"](v)||ji["Arabic Presentation Forms-A"](v)||ji["Arabic Presentation Forms-B"](v))}function ld(v){return!(v!==746&&v!==747&&(v<4352||!(ji["Bopomofo Extended"](v)||ji.Bopomofo(v)||ji["CJK Compatibility Forms"](v)&&!(v>=65097&&v<=65103)||ji["CJK Compatibility Ideographs"](v)||ji["CJK Compatibility"](v)||ji["CJK Radicals Supplement"](v)||ji["CJK Strokes"](v)||!(!ji["CJK Symbols and Punctuation"](v)||v>=12296&&v<=12305||v>=12308&&v<=12319||v===12336)||ji["CJK Unified Ideographs Extension A"](v)||ji["CJK Unified Ideographs"](v)||ji["Enclosed CJK Letters and Months"](v)||ji["Hangul Compatibility Jamo"](v)||ji["Hangul Jamo Extended-A"](v)||ji["Hangul Jamo Extended-B"](v)||ji["Hangul Jamo"](v)||ji["Hangul Syllables"](v)||ji.Hiragana(v)||ji["Ideographic Description Characters"](v)||ji.Kanbun(v)||ji["Kangxi Radicals"](v)||ji["Katakana Phonetic Extensions"](v)||ji.Katakana(v)&&v!==12540||!(!ji["Halfwidth and Fullwidth Forms"](v)||v===65288||v===65289||v===65293||v>=65306&&v<=65310||v===65339||v===65341||v===65343||v>=65371&&v<=65503||v===65507||v>=65512&&v<=65519)||!(!ji["Small Form Variants"](v)||v>=65112&&v<=65118||v>=65123&&v<=65126)||ji["Unified Canadian Aboriginal Syllabics"](v)||ji["Unified Canadian Aboriginal Syllabics Extended"](v)||ji["Vertical Forms"](v)||ji["Yijing Hexagram Symbols"](v)||ji["Yi Syllables"](v)||ji["Yi Radicals"](v))))}function xh(v){return!(ld(v)||function(c){return!!(ji["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||ji["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||ji["Letterlike Symbols"](c)||ji["Number Forms"](c)||ji["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||ji["Control Pictures"](c)&&c!==9251||ji["Optical Character Recognition"](c)||ji["Enclosed Alphanumerics"](c)||ji["Geometric Shapes"](c)||ji["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||ji["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||ji["CJK Symbols and Punctuation"](c)||ji.Katakana(c)||ji["Private Use Area"](c)||ji["CJK Compatibility Forms"](c)||ji["Small Form Variants"](c)||ji["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(v))}function Xh(v){return v>=1424&&v<=2303||ji["Arabic Presentation Forms-A"](v)||ji["Arabic Presentation Forms-B"](v)}function wh(v,c){return!(!c&&Xh(v)||v>=2304&&v<=3583||v>=3840&&v<=4255||ji.Khmer(v))}function oh(v){for(const c of v)if(Xh(c.charCodeAt(0)))return!0;return!1}const ff="deferred",Tf="loading",Jl="loaded";let wc=null,Ql="unavailable",Yh=null;const Mf=function(v){v&&typeof v=="string"&&v.indexOf("NetworkError")>-1&&(Ql="error"),wc&&wc(v)};function pf(){Lc.fire(new Za("pluginStateChange",{pluginStatus:Ql,pluginURL:Yh}))}const Lc=new Fo,_l=function(){return Ql},xo=function(){if(Ql!==ff||!Yh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ql=Tf,pf(),Yh&&$i({url:Yh},v=>{v?Mf(v):(Ql=Jl,pf())})},Dl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ql===Jl||Dl.applyArabicShaping!=null,isLoading:()=>Ql===Tf,setState(v){if(!Dt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Ql=v.pluginStatus,Yh=v.pluginURL},isParsed(){if(!Dt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Dl.applyArabicShaping!=null&&Dl.processBidirectionalText!=null&&Dl.processStyledBidirectionalText!=null},getPluginURL(){if(!Dt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Yh}};class Po{constructor(c,b){this.zoom=c,b?(this.now=b.now,this.fadeDuration=b.fadeDuration,this.zoomHistory=b.zoomHistory,this.transition=b.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wh,this.transition={})}isSupportedScript(c){return function(b,k){for(const z of b)if(!wh(z.charCodeAt(0),k))return!1;return!0}(c,Dl.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,b=c-Math.floor(c),k=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:b+(1-b)*k}:{fromScale:.5,toScale:1,t:1-(1-k)*b}}}class dl{constructor(c,b){this.property=c,this.value=b,this.expression=function(k,z){if(rl(k))return new Xp(k,z);if(Eu(k)){const V=wd(k,z);if(V.result==="error")throw new Error(V.value.map(W=>`${W.key}: ${W.message}`).join(", "));return V.value}{let V=k;return z.type==="color"&&typeof k=="string"?V=vo.parse(k):z.type!=="padding"||typeof k!="number"&&!Array.isArray(k)?z.type==="variableAnchorOffsetCollection"&&Array.isArray(k)&&(V=ws.parse(k)):V=js.parse(k),{kind:"constant",evaluate:()=>V}}}(b===void 0?c.specification.default:b,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,b,k){return this.property.possiblyEvaluate(this,c,b,k)}}class Kf{constructor(c){this.property=c,this.value=new dl(c,void 0)}transitioned(c,b){return new Sc(this.property,this.value,b,Rr({},c.transition,this.transition),c.now)}untransitioned(){return new Sc(this.property,this.value,null,{},0)}}class Pf{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return br(this._values[c].value.value)}setValue(c,b){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Kf(this._values[c].property)),this._values[c].value=new dl(this._values[c].property,b===null?void 0:br(b))}getTransition(c){return br(this._values[c].transition)}setTransition(c,b){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Kf(this._values[c].property)),this._values[c].transition=br(b)||void 0}serialize(){const c={};for(const b of Object.keys(this._values)){const k=this.getValue(b);k!==void 0&&(c[b]=k);const z=this.getTransition(b);z!==void 0&&(c[`${b}-transition`]=z)}return c}transitioned(c,b){const k=new Ec(this._properties);for(const z of Object.keys(this._values))k._values[z]=this._values[z].transitioned(c,b._values[z]);return k}untransitioned(){const c=new Ec(this._properties);for(const b of Object.keys(this._values))c._values[b]=this._values[b].untransitioned();return c}}class Sc{constructor(c,b,k,z,V){this.property=c,this.value=b,this.begin=V+z.delay||0,this.end=this.begin+z.duration||0,c.specification.transition&&(z.delay||z.duration)&&(this.prior=k)}possiblyEvaluate(c,b,k){const z=c.now||0,V=this.value.possiblyEvaluate(c,b,k),W=this.prior;if(W){if(z>this.end)return this.prior=null,V;if(this.value.isDataDriven())return this.prior=null,V;if(z<this.begin)return W.possiblyEvaluate(c,b,k);{const ne=(z-this.begin)/(this.end-this.begin);return this.property.interpolate(W.possiblyEvaluate(c,b,k),V,function(he){if(he<=0)return 0;if(he>=1)return 1;const Se=he*he,Ne=Se*he;return 4*(he<.5?Ne:3*(he-Se)+Ne-.75)}(ne))}}return V}}class Ec{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,b,k){const z=new ta(this._properties);for(const V of Object.keys(this._values))z._values[V]=this._values[V].possiblyEvaluate(c,b,k);return z}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class Al{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return br(this._values[c].value)}setValue(c,b){this._values[c]=new dl(this._values[c].property,b===null?void 0:br(b))}serialize(){const c={};for(const b of Object.keys(this._values)){const k=this.getValue(b);k!==void 0&&(c[b]=k)}return c}possiblyEvaluate(c,b,k){const z=new ta(this._properties);for(const V of Object.keys(this._values))z._values[V]=this._values[V].possiblyEvaluate(c,b,k);return z}}class aa{constructor(c,b,k){this.property=c,this.value=b,this.parameters=k}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,b,k,z){return this.property.evaluate(this.value,this.parameters,c,b,k,z)}}class ta{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class Da{constructor(c){this.specification=c}possiblyEvaluate(c,b){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(b)}interpolate(c,b,k){const z=Yu[this.specification.type];return z?z(c,b,k):c}}class ba{constructor(c,b){this.specification=c,this.overrides=b}possiblyEvaluate(c,b,k,z){return new aa(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(b,null,{},k,z)}:c.expression,b)}interpolate(c,b,k){if(c.value.kind!=="constant"||b.value.kind!=="constant")return c;if(c.value.value===void 0||b.value.value===void 0)return new aa(this,{kind:"constant",value:void 0},c.parameters);const z=Yu[this.specification.type];if(z){const V=z(c.value.value,b.value.value,k);return new aa(this,{kind:"constant",value:V},c.parameters)}return c}evaluate(c,b,k,z,V,W){return c.kind==="constant"?c.value:c.evaluate(b,k,z,V,W)}}class bl extends ba{possiblyEvaluate(c,b,k,z){if(c.value===void 0)return new aa(this,{kind:"constant",value:void 0},b);if(c.expression.kind==="constant"){const V=c.expression.evaluate(b,null,{},k,z),W=c.property.specification.type==="resolvedImage"&&typeof V!="string"?V.name:V,ne=this._calculate(W,W,W,b);return new aa(this,{kind:"constant",value:ne},b)}if(c.expression.kind==="camera"){const V=this._calculate(c.expression.evaluate({zoom:b.zoom-1}),c.expression.evaluate({zoom:b.zoom}),c.expression.evaluate({zoom:b.zoom+1}),b);return new aa(this,{kind:"constant",value:V},b)}return new aa(this,c.expression,b)}evaluate(c,b,k,z,V,W){if(c.kind==="source"){const ne=c.evaluate(b,k,z,V,W);return this._calculate(ne,ne,ne,b)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(b.zoom)-1},k,z),c.evaluate({zoom:Math.floor(b.zoom)},k,z),c.evaluate({zoom:Math.floor(b.zoom)+1},k,z),b):c.value}_calculate(c,b,k,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:c,to:b}:{from:k,to:b}}interpolate(c){return c}}class jl{constructor(c){this.specification=c}possiblyEvaluate(c,b,k,z){if(c.value!==void 0){if(c.expression.kind==="constant"){const V=c.expression.evaluate(b,null,{},k,z);return this._calculate(V,V,V,b)}return this._calculate(c.expression.evaluate(new Po(Math.floor(b.zoom-1),b)),c.expression.evaluate(new Po(Math.floor(b.zoom),b)),c.expression.evaluate(new Po(Math.floor(b.zoom+1),b)),b)}}_calculate(c,b,k,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:c,to:b}:{from:k,to:b}}interpolate(c){return c}}class df{constructor(c){this.specification=c}possiblyEvaluate(c,b,k,z){return!!c.expression.evaluate(b,null,{},k,z)}interpolate(){return!1}}class Pu{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const b in c){const k=c[b];k.specification.overridable&&this.overridableProperties.push(b);const z=this.defaultPropertyValues[b]=new dl(k,void 0),V=this.defaultTransitionablePropertyValues[b]=new Kf(k);this.defaultTransitioningPropertyValues[b]=V.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=z.possiblyEvaluate({})}}}zi("DataDrivenProperty",ba),zi("DataConstantProperty",Da),zi("CrossFadedDataDrivenProperty",bl),zi("CrossFadedProperty",jl),zi("ColorRampProperty",df);const Rh="-transition";class ho extends Fo{constructor(c,b){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),b.layout&&(this._unevaluatedLayout=new Al(b.layout)),b.paint)){this._transitionablePaint=new Pf(b.paint);for(const k in c.paint)this.setPaintProperty(k,c.paint[k],{validate:!1});for(const k in c.layout)this.setLayoutProperty(k,c.layout[k],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ta(b.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,b,k={}){b!=null&&this._validate(Lh,`layers.${this.id}.layout.${c}`,c,b,k)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,b):this.visibility=b)}getPaintProperty(c){return c.endsWith(Rh)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,b,k={}){if(b!=null&&this._validate(Af,`layers.${this.id}.paint.${c}`,c,b,k))return!1;if(c.endsWith(Rh))return this._transitionablePaint.setTransition(c.slice(0,-11),b||void 0),!1;{const z=this._transitionablePaint._values[c],V=z.property.specification["property-type"]==="cross-faded-data-driven",W=z.value.isDataDriven(),ne=z.value;this._transitionablePaint.setValue(c,b),this._handleSpecialPaintPropertyUpdate(c);const he=this._transitionablePaint._values[c].value;return he.isDataDriven()||W||V||this._handleOverridablePaintPropertyUpdate(c,ne,he)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,b,k){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,b){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,b)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,b)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Jt(c,(b,k)=>!(b===void 0||k==="layout"&&!Object.keys(b).length||k==="paint"&&!Object.keys(b).length))}_validate(c,b,k,z,V={}){return(!V||V.validate!==!1)&&Cu(this,c.call(cf,{key:b,layerType:this.type,objectKey:k,value:z,styleSpec:un,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const b=this.paint.get(c);if(b instanceof aa&&Nu(b.property.specification)&&(b.value.kind==="source"||b.value.kind==="composite")&&b.value.isStateDependent)return!0}return!1}}const vl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kf{constructor(c,b){this._structArray=c,this._pos1=b*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zu{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,b){return c._trim(),b&&(c.isTransferred=!0,b.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const b=Object.create(this.prototype);return b.arrayBuffer=c.arrayBuffer,b.length=c.length,b.capacity=c.arrayBuffer.byteLength/b.bytesPerElement,b._refreshViews(),b}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const b=this.uint8;this._refreshViews(),b&&this.uint8.set(b)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function il(v,c=1){let b=0,k=0;return{members:v.map(z=>{const V=vl[z.type].BYTES_PER_ELEMENT,W=b=sh(b,Math.max(c,V)),ne=z.components||1;return k=Math.max(k,V),b+=V*ne,{name:z.name,type:z.type,components:ne,offset:W}}),size:sh(b,Math.max(k,c)),alignment:c}}function sh(v,c){return Math.ceil(v/c)*c}class ec extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b){const k=this.length;return this.resize(k+1),this.emplace(k,c,b)}emplace(c,b,k){const z=2*c;return this.int16[z+0]=b,this.int16[z+1]=k,c}}ec.prototype.bytesPerElement=4,zi("StructArrayLayout2i4",ec);class If extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k){const z=this.length;return this.resize(z+1),this.emplace(z,c,b,k)}emplace(c,b,k,z){const V=3*c;return this.int16[V+0]=b,this.int16[V+1]=k,this.int16[V+2]=z,c}}If.prototype.bytesPerElement=6,zi("StructArrayLayout3i6",If);class Rc extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k,z){const V=this.length;return this.resize(V+1),this.emplace(V,c,b,k,z)}emplace(c,b,k,z,V){const W=4*c;return this.int16[W+0]=b,this.int16[W+1]=k,this.int16[W+2]=z,this.int16[W+3]=V,c}}Rc.prototype.bytesPerElement=8,zi("StructArrayLayout4i8",Rc);class Cc extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W){const ne=this.length;return this.resize(ne+1),this.emplace(ne,c,b,k,z,V,W)}emplace(c,b,k,z,V,W,ne){const he=6*c;return this.int16[he+0]=b,this.int16[he+1]=k,this.int16[he+2]=z,this.int16[he+3]=V,this.int16[he+4]=W,this.int16[he+5]=ne,c}}Cc.prototype.bytesPerElement=12,zi("StructArrayLayout2i4i12",Cc);class Lf extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W){const ne=this.length;return this.resize(ne+1),this.emplace(ne,c,b,k,z,V,W)}emplace(c,b,k,z,V,W,ne){const he=4*c,Se=8*c;return this.int16[he+0]=b,this.int16[he+1]=k,this.uint8[Se+4]=z,this.uint8[Se+5]=V,this.uint8[Se+6]=W,this.uint8[Se+7]=ne,c}}Lf.prototype.bytesPerElement=8,zi("StructArrayLayout2i4ub8",Lf);class Dh extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b){const k=this.length;return this.resize(k+1),this.emplace(k,c,b)}emplace(c,b,k){const z=2*c;return this.float32[z+0]=b,this.float32[z+1]=k,c}}Dh.prototype.bytesPerElement=8,zi("StructArrayLayout2f8",Dh);class wp extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W,ne,he,Se,Ne){const We=this.length;return this.resize(We+1),this.emplace(We,c,b,k,z,V,W,ne,he,Se,Ne)}emplace(c,b,k,z,V,W,ne,he,Se,Ne,We){const ht=10*c;return this.uint16[ht+0]=b,this.uint16[ht+1]=k,this.uint16[ht+2]=z,this.uint16[ht+3]=V,this.uint16[ht+4]=W,this.uint16[ht+5]=ne,this.uint16[ht+6]=he,this.uint16[ht+7]=Se,this.uint16[ht+8]=Ne,this.uint16[ht+9]=We,c}}wp.prototype.bytesPerElement=20,zi("StructArrayLayout10ui20",wp);class Jf extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W,ne,he,Se,Ne,We,ht){const gt=this.length;return this.resize(gt+1),this.emplace(gt,c,b,k,z,V,W,ne,he,Se,Ne,We,ht)}emplace(c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt){const St=12*c;return this.int16[St+0]=b,this.int16[St+1]=k,this.int16[St+2]=z,this.int16[St+3]=V,this.uint16[St+4]=W,this.uint16[St+5]=ne,this.uint16[St+6]=he,this.uint16[St+7]=Se,this.int16[St+8]=Ne,this.int16[St+9]=We,this.int16[St+10]=ht,this.int16[St+11]=gt,c}}Jf.prototype.bytesPerElement=24,zi("StructArrayLayout4i4ui4i24",Jf);class mr extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k){const z=this.length;return this.resize(z+1),this.emplace(z,c,b,k)}emplace(c,b,k,z){const V=3*c;return this.float32[V+0]=b,this.float32[V+1]=k,this.float32[V+2]=z,c}}mr.prototype.bytesPerElement=12,zi("StructArrayLayout3f12",mr);class D extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const b=this.length;return this.resize(b+1),this.emplace(b,c)}emplace(c,b){return this.uint32[1*c+0]=b,c}}D.prototype.bytesPerElement=4,zi("StructArrayLayout1ul4",D);class h extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W,ne,he,Se){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,c,b,k,z,V,W,ne,he,Se)}emplace(c,b,k,z,V,W,ne,he,Se,Ne){const We=10*c,ht=5*c;return this.int16[We+0]=b,this.int16[We+1]=k,this.int16[We+2]=z,this.int16[We+3]=V,this.int16[We+4]=W,this.int16[We+5]=ne,this.uint32[ht+3]=he,this.uint16[We+8]=Se,this.uint16[We+9]=Ne,c}}h.prototype.bytesPerElement=20,zi("StructArrayLayout6i1ul2ui20",h);class x extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W){const ne=this.length;return this.resize(ne+1),this.emplace(ne,c,b,k,z,V,W)}emplace(c,b,k,z,V,W,ne){const he=6*c;return this.int16[he+0]=b,this.int16[he+1]=k,this.int16[he+2]=z,this.int16[he+3]=V,this.int16[he+4]=W,this.int16[he+5]=ne,c}}x.prototype.bytesPerElement=12,zi("StructArrayLayout2i2i2i12",x);class O extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V){const W=this.length;return this.resize(W+1),this.emplace(W,c,b,k,z,V)}emplace(c,b,k,z,V,W){const ne=4*c,he=8*c;return this.float32[ne+0]=b,this.float32[ne+1]=k,this.float32[ne+2]=z,this.int16[he+6]=V,this.int16[he+7]=W,c}}O.prototype.bytesPerElement=16,zi("StructArrayLayout2f1f2i16",O);class Z extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k,z){const V=this.length;return this.resize(V+1),this.emplace(V,c,b,k,z)}emplace(c,b,k,z,V){const W=12*c,ne=3*c;return this.uint8[W+0]=b,this.uint8[W+1]=k,this.float32[ne+1]=z,this.float32[ne+2]=V,c}}Z.prototype.bytesPerElement=12,zi("StructArrayLayout2ub2f12",Z);class H extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b,k){const z=this.length;return this.resize(z+1),this.emplace(z,c,b,k)}emplace(c,b,k,z){const V=3*c;return this.uint16[V+0]=b,this.uint16[V+1]=k,this.uint16[V+2]=z,c}}H.prototype.bytesPerElement=6,zi("StructArrayLayout3ui6",H);class ae extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr){const Gr=this.length;return this.resize(Gr+1),this.emplace(Gr,c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr)}emplace(c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr,Gr){const Tr=24*c,Jr=12*c,wn=48*c;return this.int16[Tr+0]=b,this.int16[Tr+1]=k,this.uint16[Tr+2]=z,this.uint16[Tr+3]=V,this.uint32[Jr+2]=W,this.uint32[Jr+3]=ne,this.uint32[Jr+4]=he,this.uint16[Tr+10]=Se,this.uint16[Tr+11]=Ne,this.uint16[Tr+12]=We,this.float32[Jr+7]=ht,this.float32[Jr+8]=gt,this.uint8[wn+36]=St,this.uint8[wn+37]=Ht,this.uint8[wn+38]=ir,this.uint32[Jr+10]=fr,this.int16[Tr+22]=Gr,c}}ae.prototype.bytesPerElement=48,zi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ae);class ue extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr,Gr,Tr,Jr,wn,ii,da,$a,fa,ra,Xi,ga){const qi=this.length;return this.resize(qi+1),this.emplace(qi,c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr,Gr,Tr,Jr,wn,ii,da,$a,fa,ra,Xi,ga)}emplace(c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht,ir,fr,Gr,Tr,Jr,wn,ii,da,$a,fa,ra,Xi,ga,qi){const Ei=32*c,Wa=16*c;return this.int16[Ei+0]=b,this.int16[Ei+1]=k,this.int16[Ei+2]=z,this.int16[Ei+3]=V,this.int16[Ei+4]=W,this.int16[Ei+5]=ne,this.int16[Ei+6]=he,this.int16[Ei+7]=Se,this.uint16[Ei+8]=Ne,this.uint16[Ei+9]=We,this.uint16[Ei+10]=ht,this.uint16[Ei+11]=gt,this.uint16[Ei+12]=St,this.uint16[Ei+13]=Ht,this.uint16[Ei+14]=ir,this.uint16[Ei+15]=fr,this.uint16[Ei+16]=Gr,this.uint16[Ei+17]=Tr,this.uint16[Ei+18]=Jr,this.uint16[Ei+19]=wn,this.uint16[Ei+20]=ii,this.uint16[Ei+21]=da,this.uint16[Ei+22]=$a,this.uint32[Wa+12]=fa,this.float32[Wa+13]=ra,this.float32[Wa+14]=Xi,this.uint16[Ei+30]=ga,this.uint16[Ei+31]=qi,c}}ue.prototype.bytesPerElement=64,zi("StructArrayLayout8i15ui1ul2f2ui64",ue);class ge extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const b=this.length;return this.resize(b+1),this.emplace(b,c)}emplace(c,b){return this.float32[1*c+0]=b,c}}ge.prototype.bytesPerElement=4,zi("StructArrayLayout1f4",ge);class Le extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k){const z=this.length;return this.resize(z+1),this.emplace(z,c,b,k)}emplace(c,b,k,z){const V=3*c;return this.uint16[6*c+0]=b,this.float32[V+1]=k,this.float32[V+2]=z,c}}Le.prototype.bytesPerElement=12,zi("StructArrayLayout1ui2f12",Le);class m extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b,k){const z=this.length;return this.resize(z+1),this.emplace(z,c,b,k)}emplace(c,b,k,z){const V=4*c;return this.uint32[2*c+0]=b,this.uint16[V+2]=k,this.uint16[V+3]=z,c}}m.prototype.bytesPerElement=8,zi("StructArrayLayout1ul2ui8",m);class w extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,b){const k=this.length;return this.resize(k+1),this.emplace(k,c,b)}emplace(c,b,k){const z=2*c;return this.uint16[z+0]=b,this.uint16[z+1]=k,c}}w.prototype.bytesPerElement=4,zi("StructArrayLayout2ui4",w);class _ extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const b=this.length;return this.resize(b+1),this.emplace(b,c)}emplace(c,b){return this.uint16[1*c+0]=b,c}}_.prototype.bytesPerElement=2,zi("StructArrayLayout1ui2",_);class T extends Zu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,b,k,z){const V=this.length;return this.resize(V+1),this.emplace(V,c,b,k,z)}emplace(c,b,k,z,V){const W=4*c;return this.float32[W+0]=b,this.float32[W+1]=k,this.float32[W+2]=z,this.float32[W+3]=V,c}}T.prototype.bytesPerElement=16,zi("StructArrayLayout4f16",T);class N extends kf{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new le(this.anchorPointX,this.anchorPointY)}}N.prototype.size=20;class $ extends h{get(c){return new N(this,c)}}zi("CollisionBoxArray",$);class X extends kf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}X.prototype.size=48;class oe extends ae{get(c){return new X(this,c)}}zi("PlacedSymbolArray",oe);class xe extends kf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}xe.prototype.size=64;class ye extends ue{get(c){return new xe(this,c)}}zi("SymbolInstanceArray",ye);class De extends ge{getoffsetX(c){return this.float32[1*c+0]}}zi("GlyphOffsetArray",De);class He extends If{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}zi("SymbolLineVertexArray",He);class $e extends kf{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}$e.prototype.size=12;class ft extends Le{get(c){return new $e(this,c)}}zi("TextAnchorOffsetArray",ft);class pt extends kf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pt.prototype.size=8;class wt extends m{get(c){return new pt(this,c)}}zi("FeatureIndexArray",wt);class dt extends ec{}class Ft extends ec{}class ar extends ec{}class nr extends Cc{}class Ir extends Lf{}class _r extends Dh{}class Qr extends wp{}class nn extends Jf{}class Ln extends mr{}class Mn extends D{}class yi extends x{}class Ri extends Z{}class Qi extends H{}class Vi extends w{}const ao=il([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bi}=ao;class oa{constructor(c=[]){this.segments=c}prepareSegment(c,b,k,z){let V=this.segments[this.segments.length-1];return c>oa.MAX_VERTEX_ARRAY_LENGTH&&Br(`Max vertices per segment is ${oa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!V||V.vertexLength+c>oa.MAX_VERTEX_ARRAY_LENGTH||V.sortKey!==z)&&(V={vertexOffset:b.length,primitiveOffset:k.length,vertexLength:0,primitiveLength:0},z!==void 0&&(V.sortKey=z),this.segments.push(V)),V}get(){return this.segments}destroy(){for(const c of this.segments)for(const b in c.vaos)c.vaos[b].destroy()}static simpleSegment(c,b,k,z){return new oa([{vertexOffset:c,primitiveOffset:b,vertexLength:k,primitiveLength:z,vaos:{},sortKey:0}])}}function Ha(v,c){return 256*(v=er(Math.floor(v),0,255))+er(Math.floor(c),0,255)}oa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zi("SegmentVector",oa);const ja=il([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Sa={exports:{}},Qa={exports:{}};Qa.exports=function(v,c){var b,k,z,V,W,ne,he,Se;for(k=v.length-(b=3&v.length),z=c,W=3432918353,ne=461845907,Se=0;Se<k;)he=255&v.charCodeAt(Se)|(255&v.charCodeAt(++Se))<<8|(255&v.charCodeAt(++Se))<<16|(255&v.charCodeAt(++Se))<<24,++Se,z=27492+(65535&(V=5*(65535&(z=(z^=he=(65535&(he=(he=(65535&he)*W+(((he>>>16)*W&65535)<<16)&4294967295)<<15|he>>>17))*ne+(((he>>>16)*ne&65535)<<16)&4294967295)<<13|z>>>19))+((5*(z>>>16)&65535)<<16)&4294967295))+((58964+(V>>>16)&65535)<<16);switch(he=0,b){case 3:he^=(255&v.charCodeAt(Se+2))<<16;case 2:he^=(255&v.charCodeAt(Se+1))<<8;case 1:z^=he=(65535&(he=(he=(65535&(he^=255&v.charCodeAt(Se)))*W+(((he>>>16)*W&65535)<<16)&4294967295)<<15|he>>>17))*ne+(((he>>>16)*ne&65535)<<16)&4294967295}return z^=v.length,z=2246822507*(65535&(z^=z>>>16))+((2246822507*(z>>>16)&65535)<<16)&4294967295,z=3266489909*(65535&(z^=z>>>13))+((3266489909*(z>>>16)&65535)<<16)&4294967295,(z^=z>>>16)>>>0};var eo=Qa.exports,va={exports:{}};va.exports=function(v,c){for(var b,k=v.length,z=c^k,V=0;k>=4;)b=1540483477*(65535&(b=255&v.charCodeAt(V)|(255&v.charCodeAt(++V))<<8|(255&v.charCodeAt(++V))<<16|(255&v.charCodeAt(++V))<<24))+((1540483477*(b>>>16)&65535)<<16),z=1540483477*(65535&z)+((1540483477*(z>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),k-=4,++V;switch(k){case 3:z^=(255&v.charCodeAt(V+2))<<16;case 2:z^=(255&v.charCodeAt(V+1))<<8;case 1:z=1540483477*(65535&(z^=255&v.charCodeAt(V)))+((1540483477*(z>>>16)&65535)<<16)}return z=1540483477*(65535&(z^=z>>>13))+((1540483477*(z>>>16)&65535)<<16),(z^=z>>>15)>>>0};var tu=eo,Gs=va.exports;Sa.exports=tu,Sa.exports.murmur3=tu,Sa.exports.murmur2=Gs;var Tl=te(Sa.exports);class Ps{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,b,k,z){this.ids.push(Qo(c)),this.positions.push(b,k,z)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const b=Qo(c);let k=0,z=this.ids.length-1;for(;k<z;){const W=k+z>>1;this.ids[W]>=b?z=W:k=W+1}const V=[];for(;this.ids[k]===b;)V.push({index:this.positions[3*k],start:this.positions[3*k+1],end:this.positions[3*k+2]}),k++;return V}static serialize(c,b){const k=new Float64Array(c.ids),z=new Uint32Array(c.positions);return Zs(k,z,0,k.length-1),b&&b.push(k.buffer,z.buffer),{ids:k,positions:z}}static deserialize(c){const b=new Ps;return b.ids=c.ids,b.positions=c.positions,b.indexed=!0,b}}function Qo(v){const c=+v;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Tl(String(v))}function Zs(v,c,b,k){for(;b<k;){const z=v[b+k>>1];let V=b-1,W=k+1;for(;;){do V++;while(v[V]<z);do W--;while(v[W]>z);if(V>=W)break;Hs(v,V,W),Hs(c,3*V,3*W),Hs(c,3*V+1,3*W+1),Hs(c,3*V+2,3*W+2)}W-b<k-W?(Zs(v,c,b,W),b=W+1):(Zs(v,c,W+1,k),k=W)}}function Hs(v,c,b){const k=v[c];v[c]=v[b],v[b]=k}zi("FeaturePositionMap",Ps);class Uu{constructor(c,b){this.gl=c.gl,this.location=b}}class uh extends Uu{constructor(c,b){super(c,b),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class pc extends Uu{constructor(c,b){super(c,b),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Xc extends Uu{constructor(c,b){super(c,b),this.current=vo.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const Yc=new Float32Array(16);function Qf(v){return[Ha(255*v.r,255*v.g),Ha(255*v.b,255*v.a)]}class dc{constructor(c,b,k){this.value=c,this.uniformNames=b.map(z=>`u_${z}`),this.type=k}setUniform(c,b,k){c.set(k.constantOr(this.value))}getBinding(c,b,k){return this.type==="color"?new Xc(c,b):new uh(c,b)}}class vc{constructor(c,b){this.uniformNames=b.map(k=>`u_${k}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,b){this.pixelRatioFrom=b.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=b.tlbr,this.patternTo=c.tlbr}setUniform(c,b,k,z){const V=z==="u_pattern_to"?this.patternTo:z==="u_pattern_from"?this.patternFrom:z==="u_pixel_ratio_to"?this.pixelRatioTo:z==="u_pixel_ratio_from"?this.pixelRatioFrom:null;V&&c.set(V)}getBinding(c,b,k){return k.substr(0,9)==="u_pattern"?new pc(c,b):new uh(c,b)}}class Dc{constructor(c,b,k,z){this.expression=c,this.type=k,this.maxValue=0,this.paintVertexAttributes=b.map(V=>({name:`a_${V}`,type:"Float32",components:k==="color"?2:1,offset:0})),this.paintVertexArray=new z}populatePaintArray(c,b,k,z,V){const W=this.paintVertexArray.length,ne=this.expression.evaluate(new Po(0),b,{},z,[],V);this.paintVertexArray.resize(c),this._setPaintValue(W,c,ne)}updatePaintArray(c,b,k,z){const V=this.expression.evaluate({zoom:0},k,z);this._setPaintValue(c,b,V)}_setPaintValue(c,b,k){if(this.type==="color"){const z=Qf(k);for(let V=c;V<b;V++)this.paintVertexArray.emplace(V,z[0],z[1])}else{for(let z=c;z<b;z++)this.paintVertexArray.emplace(z,k);this.maxValue=Math.max(this.maxValue,Math.abs(k))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vl{constructor(c,b,k,z,V,W){this.expression=c,this.uniformNames=b.map(ne=>`u_${ne}_t`),this.type=k,this.useIntegerZoom=z,this.zoom=V,this.maxValue=0,this.paintVertexAttributes=b.map(ne=>({name:`a_${ne}`,type:"Float32",components:k==="color"?4:2,offset:0})),this.paintVertexArray=new W}populatePaintArray(c,b,k,z,V){const W=this.expression.evaluate(new Po(this.zoom),b,{},z,[],V),ne=this.expression.evaluate(new Po(this.zoom+1),b,{},z,[],V),he=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(he,c,W,ne)}updatePaintArray(c,b,k,z){const V=this.expression.evaluate({zoom:this.zoom},k,z),W=this.expression.evaluate({zoom:this.zoom+1},k,z);this._setPaintValue(c,b,V,W)}_setPaintValue(c,b,k,z){if(this.type==="color"){const V=Qf(k),W=Qf(z);for(let ne=c;ne<b;ne++)this.paintVertexArray.emplace(ne,V[0],V[1],W[0],W[1])}else{for(let V=c;V<b;V++)this.paintVertexArray.emplace(V,k,z);this.maxValue=Math.max(this.maxValue,Math.abs(k),Math.abs(z))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,b){const k=this.useIntegerZoom?Math.floor(b.zoom):b.zoom,z=er(this.expression.interpolationFactor(k,this.zoom,this.zoom+1),0,1);c.set(z)}getBinding(c,b,k){return new uh(c,b)}}class Gl{constructor(c,b,k,z,V,W){this.expression=c,this.type=b,this.useIntegerZoom=k,this.zoom=z,this.layerId=W,this.zoomInPaintVertexArray=new V,this.zoomOutPaintVertexArray=new V}populatePaintArray(c,b,k){const z=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(z,c,b.patterns&&b.patterns[this.layerId],k)}updatePaintArray(c,b,k,z,V){this._setPaintValues(c,b,k.patterns&&k.patterns[this.layerId],V)}_setPaintValues(c,b,k,z){if(!z||!k)return;const{min:V,mid:W,max:ne}=k,he=z[V],Se=z[W],Ne=z[ne];if(he&&Se&&Ne)for(let We=c;We<b;We++)this.zoomInPaintVertexArray.emplace(We,Se.tl[0],Se.tl[1],Se.br[0],Se.br[1],he.tl[0],he.tl[1],he.br[0],he.br[1],Se.pixelRatio,he.pixelRatio),this.zoomOutPaintVertexArray.emplace(We,Se.tl[0],Se.tl[1],Se.br[0],Se.br[1],Ne.tl[0],Ne.tl[1],Ne.br[0],Ne.br[1],Se.pixelRatio,Ne.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,ja.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,ja.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class vf{constructor(c,b,k){this.binders={},this._buffers=[];const z=[];for(const V in c.paint._values){if(!k(V))continue;const W=c.paint.get(V);if(!(W instanceof aa&&Nu(W.property.specification)))continue;const ne=Hl(V,c.type),he=W.value,Se=W.property.specification.type,Ne=W.property.useIntegerZoom,We=W.property.specification["property-type"],ht=We==="cross-faded"||We==="cross-faded-data-driven";if(he.kind==="constant")this.binders[V]=ht?new vc(he.value,ne):new dc(he.value,ne,Se),z.push(`/u_${V}`);else if(he.kind==="source"||ht){const gt=lh(V,Se,"source");this.binders[V]=ht?new Gl(he,Se,Ne,b,gt,c.id):new Dc(he,ne,Se,gt),z.push(`/a_${V}`)}else{const gt=lh(V,Se,"composite");this.binders[V]=new Vl(he,ne,Se,Ne,b,gt),z.push(`/z_${V}`)}}this.cacheKey=z.sort().join("")}getMaxValue(c){const b=this.binders[c];return b instanceof Dc||b instanceof Vl?b.maxValue:0}populatePaintArrays(c,b,k,z,V){for(const W in this.binders){const ne=this.binders[W];(ne instanceof Dc||ne instanceof Vl||ne instanceof Gl)&&ne.populatePaintArray(c,b,k,z,V)}}setConstantPatternPositions(c,b){for(const k in this.binders){const z=this.binders[k];z instanceof vc&&z.setConstantPatternPositions(c,b)}}updatePaintArrays(c,b,k,z,V){let W=!1;for(const ne in c){const he=b.getPositions(ne);for(const Se of he){const Ne=k.feature(Se.index);for(const We in this.binders){const ht=this.binders[We];if((ht instanceof Dc||ht instanceof Vl||ht instanceof Gl)&&ht.expression.isStateDependent===!0){const gt=z.paint.get(We);ht.expression=gt.value,ht.updatePaintArray(Se.start,Se.end,Ne,c[ne],V),W=!0}}}}return W}defines(){const c=[];for(const b in this.binders){const k=this.binders[b];(k instanceof dc||k instanceof vc)&&c.push(...k.uniformNames.map(z=>`#define HAS_UNIFORM_${z}`))}return c}getBinderAttributes(){const c=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof Dc||k instanceof Vl)for(let z=0;z<k.paintVertexAttributes.length;z++)c.push(k.paintVertexAttributes[z].name);else if(k instanceof Gl)for(let z=0;z<ja.members.length;z++)c.push(ja.members[z].name)}return c}getBinderUniforms(){const c=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof dc||k instanceof vc||k instanceof Vl)for(const z of k.uniformNames)c.push(z)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,b){const k=[];for(const z in this.binders){const V=this.binders[z];if(V instanceof dc||V instanceof vc||V instanceof Vl){for(const W of V.uniformNames)if(b[W]){const ne=V.getBinding(c,b[W],W);k.push({name:W,property:z,binding:ne})}}}return k}setUniforms(c,b,k,z){for(const{name:V,property:W,binding:ne}of b)this.binders[W].setUniform(ne,z,k.get(W),V)}updatePaintBuffers(c){this._buffers=[];for(const b in this.binders){const k=this.binders[b];if(c&&k instanceof Gl){const z=c.fromScale===2?k.zoomInPaintVertexBuffer:k.zoomOutPaintVertexBuffer;z&&this._buffers.push(z)}else(k instanceof Dc||k instanceof Vl)&&k.paintVertexBuffer&&this._buffers.push(k.paintVertexBuffer)}}upload(c){for(const b in this.binders){const k=this.binders[b];(k instanceof Dc||k instanceof Vl||k instanceof Gl)&&k.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const b=this.binders[c];(b instanceof Dc||b instanceof Vl||b instanceof Gl)&&b.destroy()}}}class mc{constructor(c,b,k=()=>!0){this.programConfigurations={};for(const z of c)this.programConfigurations[z.id]=new vf(z,b,k);this.needsUpload=!1,this._featureMap=new Ps,this._bufferOffset=0}populatePaintArrays(c,b,k,z,V,W){for(const ne in this.programConfigurations)this.programConfigurations[ne].populatePaintArrays(c,b,z,V,W);b.id!==void 0&&this._featureMap.add(b.id,k,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,b,k,z){for(const V of k)this.needsUpload=this.programConfigurations[V.id].updatePaintArrays(c,this._featureMap,b,V,z)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const b in this.programConfigurations)this.programConfigurations[b].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Hl(v,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[v]||[v.replace(`${c}-`,"").replace(/-/g,"_")]}function lh(v,c,b){const k={color:{source:Dh,composite:T},number:{source:ge,composite:Dh}},z=function(V){return{"line-pattern":{source:Qr,composite:Qr},"fill-pattern":{source:Qr,composite:Qr},"fill-extrusion-pattern":{source:Qr,composite:Qr}}[V]}(v);return z&&z[b]||k[c][b]}zi("ConstantBinder",dc),zi("CrossFadedConstantBinder",vc),zi("SourceExpressionBinder",Dc),zi("CrossFadedCompositeBinder",Gl),zi("CompositeExpressionBinder",Vl),zi("ProgramConfiguration",vf,{omit:["_buffers"]}),zi("ProgramConfigurationSet",mc);const Os=8192,ch=Math.pow(2,14)-1,Es=-ch-1;function Ol(v){const c=Os/v.extent,b=v.loadGeometry();for(let k=0;k<b.length;k++){const z=b[k];for(let V=0;V<z.length;V++){const W=z[V],ne=Math.round(W.x*c),he=Math.round(W.y*c);W.x=er(ne,Es,ch),W.y=er(he,Es,ch),(ne<W.x||ne>W.x+1||he<W.y||he>W.y+1)&&Br("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return b}function ml(v,c){return{type:v.type,id:v.id,properties:v.properties,geometry:c?Ol(v):[]}}function mf(v,c,b,k,z){v.emplaceBack(2*c+(k+1)/2,2*b+(z+1)/2)}class ku{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(b=>b.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Ft,this.indexArray=new Qi,this.segments=new oa,this.programConfigurations=new mc(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(c,b,k){const z=this.layers[0],V=[];let W=null,ne=!1;z.type==="circle"&&(W=z.layout.get("circle-sort-key"),ne=!W.isConstant());for(const{feature:he,id:Se,index:Ne,sourceLayerIndex:We}of c){const ht=this.layers[0]._featureFilter.needGeometry,gt=ml(he,ht);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),gt,k))continue;const St=ne?W.evaluate(gt,{},k):void 0,Ht={id:Se,properties:he.properties,type:he.type,sourceLayerIndex:We,index:Ne,geometry:ht?gt.geometry:Ol(he),patterns:{},sortKey:St};V.push(Ht)}ne&&V.sort((he,Se)=>he.sortKey-Se.sortKey);for(const he of V){const{geometry:Se,index:Ne,sourceLayerIndex:We}=he,ht=c[Ne].feature;this.addFeature(he,Se,Ne,k),b.featureIndex.insert(ht,Se,Ne,We,this.index)}}update(c,b,k){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,b,this.stateDependentLayers,k)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Bi),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,b,k,z){for(const V of b)for(const W of V){const ne=W.x,he=W.y;if(ne<0||ne>=Os||he<0||he>=Os)continue;const Se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),Ne=Se.vertexLength;mf(this.layoutVertexArray,ne,he,-1,-1),mf(this.layoutVertexArray,ne,he,1,-1),mf(this.layoutVertexArray,ne,he,1,1),mf(this.layoutVertexArray,ne,he,-1,1),this.indexArray.emplaceBack(Ne,Ne+1,Ne+2),this.indexArray.emplaceBack(Ne,Ne+3,Ne+2),Se.vertexLength+=4,Se.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,k,{},z)}}function ep(v,c){for(let b=0;b<v.length;b++)if(Wd(c,v[b]))return!0;for(let b=0;b<c.length;b++)if(Wd(v,c[b]))return!0;return!!Rf(v,c)}function cd(v,c,b){return!!Wd(v,c)||!!Sd(c,v,b)}function qh(v,c){if(v.length===1)return Fl(c,v[0]);for(let b=0;b<c.length;b++){const k=c[b];for(let z=0;z<k.length;z++)if(Wd(v,k[z]))return!0}for(let b=0;b<v.length;b++)if(Fl(c,v[b]))return!0;for(let b=0;b<c.length;b++)if(Rf(v,c[b]))return!0;return!1}function Rd(v,c,b){if(v.length>1){if(Rf(v,c))return!0;for(let k=0;k<c.length;k++)if(Sd(c[k],v,b))return!0}for(let k=0;k<v.length;k++)if(Sd(v[k],c,b))return!0;return!1}function Rf(v,c){if(v.length===0||c.length===0)return!1;for(let b=0;b<v.length-1;b++){const k=v[b],z=v[b+1];for(let V=0;V<c.length-1;V++)if(hd(k,z,c[V],c[V+1]))return!0}return!1}function hd(v,c,b,k){return an(v,b,k)!==an(c,b,k)&&an(v,c,b)!==an(v,c,k)}function Sd(v,c,b){const k=b*b;if(c.length===1)return v.distSqr(c[0])<k;for(let z=1;z<c.length;z++)if(Ip(v,c[z-1],c[z])<k)return!0;return!1}function Ip(v,c,b){const k=c.distSqr(b);if(k===0)return v.distSqr(c);const z=((v.x-c.x)*(b.x-c.x)+(v.y-c.y)*(b.y-c.y))/k;return v.distSqr(z<0?c:z>1?b:b.sub(c)._mult(z)._add(c))}function Fl(v,c){let b,k,z,V=!1;for(let W=0;W<v.length;W++){b=v[W];for(let ne=0,he=b.length-1;ne<b.length;he=ne++)k=b[ne],z=b[he],k.y>c.y!=z.y>c.y&&c.x<(z.x-k.x)*(c.y-k.y)/(z.y-k.y)+k.x&&(V=!V)}return V}function Wd(v,c){let b=!1;for(let k=0,z=v.length-1;k<v.length;z=k++){const V=v[k],W=v[z];V.y>c.y!=W.y>c.y&&c.x<(W.x-V.x)*(c.y-V.y)/(W.y-V.y)+V.x&&(b=!b)}return b}function Qm(v,c,b){const k=b[0],z=b[2];if(v.x<k.x&&c.x<k.x||v.x>z.x&&c.x>z.x||v.y<k.y&&c.y<k.y||v.y>z.y&&c.y>z.y)return!1;const V=an(v,c,b[0]);return V!==an(v,c,b[1])||V!==an(v,c,b[2])||V!==an(v,c,b[3])}function Tv(v,c,b){const k=c.paint.get(v).value;return k.kind==="constant"?k.value:b.programConfigurations.get(c.id).getMaxValue(v)}function Mv(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1])}function Dd(v,c,b,k,z){if(!c[0]&&!c[1])return v;const V=le.convert(c)._mult(z);b==="viewport"&&V._rotate(-k);const W=[];for(let ne=0;ne<v.length;ne++)W.push(v[ne].sub(V));return W}let Pv,fd;zi("CircleBucket",ku,{omit:["layers"]});var jv={get paint(){return fd=fd||new Pu({"circle-radius":new ba(un.paint_circle["circle-radius"]),"circle-color":new ba(un.paint_circle["circle-color"]),"circle-blur":new ba(un.paint_circle["circle-blur"]),"circle-opacity":new ba(un.paint_circle["circle-opacity"]),"circle-translate":new Da(un.paint_circle["circle-translate"]),"circle-translate-anchor":new Da(un.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Da(un.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Da(un.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ba(un.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ba(un.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ba(un.paint_circle["circle-stroke-opacity"])})},get layout(){return Pv=Pv||new Pu({"circle-sort-key":new ba(un.layout_circle["circle-sort-key"])})}},hh=1e-6,dv=typeof Float32Array!="undefined"?Float32Array:Array;function Df(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function Xd(v,c,b){var k=c[0],z=c[1],V=c[2],W=c[3],ne=c[4],he=c[5],Se=c[6],Ne=c[7],We=c[8],ht=c[9],gt=c[10],St=c[11],Ht=c[12],ir=c[13],fr=c[14],Gr=c[15],Tr=b[0],Jr=b[1],wn=b[2],ii=b[3];return v[0]=Tr*k+Jr*ne+wn*We+ii*Ht,v[1]=Tr*z+Jr*he+wn*ht+ii*ir,v[2]=Tr*V+Jr*Se+wn*gt+ii*fr,v[3]=Tr*W+Jr*Ne+wn*St+ii*Gr,v[4]=(Tr=b[4])*k+(Jr=b[5])*ne+(wn=b[6])*We+(ii=b[7])*Ht,v[5]=Tr*z+Jr*he+wn*ht+ii*ir,v[6]=Tr*V+Jr*Se+wn*gt+ii*fr,v[7]=Tr*W+Jr*Ne+wn*St+ii*Gr,v[8]=(Tr=b[8])*k+(Jr=b[9])*ne+(wn=b[10])*We+(ii=b[11])*Ht,v[9]=Tr*z+Jr*he+wn*ht+ii*ir,v[10]=Tr*V+Jr*Se+wn*gt+ii*fr,v[11]=Tr*W+Jr*Ne+wn*St+ii*Gr,v[12]=(Tr=b[12])*k+(Jr=b[13])*ne+(wn=b[14])*We+(ii=b[15])*Ht,v[13]=Tr*z+Jr*he+wn*ht+ii*ir,v[14]=Tr*V+Jr*Se+wn*gt+ii*fr,v[15]=Tr*W+Jr*Ne+wn*St+ii*Gr,v}Math.hypot||(Math.hypot=function(){for(var v=0,c=arguments.length;c--;)v+=arguments[c]*arguments[c];return Math.sqrt(v)});var Yd,Vv=Xd;function lm(v,c,b){var k=c[0],z=c[1],V=c[2],W=c[3];return v[0]=b[0]*k+b[4]*z+b[8]*V+b[12]*W,v[1]=b[1]*k+b[5]*z+b[9]*V+b[13]*W,v[2]=b[2]*k+b[6]*z+b[10]*V+b[14]*W,v[3]=b[3]*k+b[7]*z+b[11]*V+b[15]*W,v}Yd=new dv(4),dv!=Float32Array&&(Yd[0]=0,Yd[1]=0,Yd[2]=0,Yd[3]=0);class Om extends ho{constructor(c){super(c,jv)}createBucket(c){return new ku(c)}queryRadius(c){const b=c;return Tv("circle-radius",this,b)+Tv("circle-stroke-width",this,b)+Mv(this.paint.get("circle-translate"))}queryIntersectsFeature(c,b,k,z,V,W,ne,he){const Se=Dd(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),W.angle,ne),Ne=this.paint.get("circle-radius").evaluate(b,k)+this.paint.get("circle-stroke-width").evaluate(b,k),We=this.paint.get("circle-pitch-alignment")==="map",ht=We?Se:function(St,Ht){return St.map(ir=>Fm(ir,Ht))}(Se,he),gt=We?Ne*ne:Ne;for(const St of z)for(const Ht of St){const ir=We?Ht:Fm(Ht,he);let fr=gt;const Gr=lm([],[Ht.x,Ht.y,0,1],he);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fr*=Gr[3]/W.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fr*=W.cameraToCenterDistance/Gr[3]),cd(ht,ir,fr))return!0}return!1}}function Fm(v,c){const b=lm([],[v.x,v.y,0,1],c);return new le(b[0]/b[3],b[1]/b[3])}class cm extends ku{}let hm;zi("HeatmapBucket",cm,{omit:["layers"]});var zm={get paint(){return hm=hm||new Pu({"heatmap-radius":new ba(un.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ba(un.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Da(un.paint_heatmap["heatmap-intensity"]),"heatmap-color":new df(un.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Da(un.paint_heatmap["heatmap-opacity"])})}};function qd(v,{width:c,height:b},k,z){if(z){if(z instanceof Uint8ClampedArray)z=new Uint8Array(z.buffer);else if(z.length!==c*b*k)throw new RangeError(`mismatched image size. expected: ${z.length} but got: ${c*b*k}`)}else z=new Uint8Array(c*b*k);return v.width=c,v.height=b,v.data=z,v}function Sp(v,{width:c,height:b},k){if(c===v.width&&b===v.height)return;const z=qd({},{width:c,height:b},k);Ed(v,z,{x:0,y:0},{x:0,y:0},{width:Math.min(v.width,c),height:Math.min(v.height,b)},k),v.width=c,v.height=b,v.data=z.data}function Ed(v,c,b,k,z,V){if(z.width===0||z.height===0)return c;if(z.width>v.width||z.height>v.height||b.x>v.width-z.width||b.y>v.height-z.height)throw new RangeError("out of range source coordinates for image copy");if(z.width>c.width||z.height>c.height||k.x>c.width-z.width||k.y>c.height-z.height)throw new RangeError("out of range destination coordinates for image copy");const W=v.data,ne=c.data;if(W===ne)throw new Error("srcData equals dstData, so image is already copied");for(let he=0;he<z.height;he++){const Se=((b.y+he)*v.width+b.x)*V,Ne=((k.y+he)*c.width+k.x)*V;for(let We=0;We<z.width*V;We++)ne[Ne+We]=W[Se+We]}return c}class qu{constructor(c,b){qd(this,c,1,b)}resize(c){Sp(this,c,1)}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,b,k,z,V){Ed(c,b,k,z,V,1)}}class fh{constructor(c,b){qd(this,c,4,b)}resize(c){Sp(this,c,4)}replace(c,b){b?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new fh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,b,k,z,V){Ed(c,b,k,z,V,4)}}function Oh(v){const c={},b=v.resolution||256,k=v.clips?v.clips.length:1,z=v.image||new fh({width:b,height:k});if(Math.log(b)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${b}`);const V=(W,ne,he)=>{c[v.evaluationKey]=he;const Se=v.expression.evaluate(c);z.data[W+ne+0]=Math.floor(255*Se.r/Se.a),z.data[W+ne+1]=Math.floor(255*Se.g/Se.a),z.data[W+ne+2]=Math.floor(255*Se.b/Se.a),z.data[W+ne+3]=Math.floor(255*Se.a)};if(v.clips)for(let W=0,ne=0;W<k;++W,ne+=4*b)for(let he=0,Se=0;he<b;he++,Se+=4){const Ne=he/(b-1),{start:We,end:ht}=v.clips[W];V(ne,Se,We*(1-Ne)+ht*Ne)}else for(let W=0,ne=0;W<b;W++,ne+=4)V(0,ne,W/(b-1));return z}zi("AlphaImage",qu),zi("RGBAImage",fh);class Ku extends ho{createBucket(c){return new cm(c)}constructor(c){super(c,zm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Oh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ml;var qp={get paint(){return Ml=Ml||new Pu({"hillshade-illumination-direction":new Da(un.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Da(un.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Da(un.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Da(un.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Da(un.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Da(un.paint_hillshade["hillshade-accent-color"])})}};class kv extends ho{constructor(c){super(c,qp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Kd=il([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ju}=Kd;var Od={exports:{}};function _s(v,c,b){b=b||2;var k,z,V,W,ne,he,Se,Ne=c&&c.length,We=Ne?c[0]*b:v.length,ht=vv(v,0,We,b,!0),gt=[];if(!ht||ht.next===ht.prev)return gt;if(Ne&&(ht=function(Ht,ir,fr,Gr){var Tr,Jr,wn,ii=[];for(Tr=0,Jr=ir.length;Tr<Jr;Tr++)(wn=vv(Ht,ir[Tr]*Gr,Tr<Jr-1?ir[Tr+1]*Gr:Ht.length,Gr,!1))===wn.next&&(wn.steiner=!0),ii.push(fm(wn));for(ii.sort(Oc),Tr=0;Tr<ii.length;Tr++)fr=zd(ii[Tr],fr);return fr}(v,c,ht,b)),v.length>80*b){k=V=v[0],z=W=v[1];for(var St=b;St<We;St+=b)(ne=v[St])<k&&(k=ne),(he=v[St+1])<z&&(z=he),ne>V&&(V=ne),he>W&&(W=he);Se=(Se=Math.max(V-k,W-z))!==0?32767/Se:0}return Sh(ht,gt,b,k,z,Se,0),gt}function vv(v,c,b,k,z){var V,W;if(z===zf(v,c,b,k)>0)for(V=c;V<b;V+=k)W=Kh(V,v[V],v[V+1],W);else for(V=b-k;V>=c;V-=k)W=Kh(V,v[V],v[V+1],W);return W&&Hv(W,W.next)&&(qc(W),W=W.next),W}function Ac(v,c){if(!v)return v;c||(c=v);var b,k=v;do if(b=!1,k.steiner||!Hv(k,k.next)&&gc(k.prev,k,k.next)!==0)k=k.next;else{if(qc(k),(k=c=k.prev)===k.next)break;b=!0}while(b||k!==c);return c}function Sh(v,c,b,k,z,V,W){if(v){!W&&V&&function(Ne,We,ht,gt){var St=Ne;do St.z===0&&(St.z=Gv(St.x,St.y,We,ht,gt)),St.prevZ=St.prev,St.nextZ=St.next,St=St.next;while(St!==Ne);St.prevZ.nextZ=null,St.prevZ=null,function(Ht){var ir,fr,Gr,Tr,Jr,wn,ii,da,$a=1;do{for(fr=Ht,Ht=null,Jr=null,wn=0;fr;){for(wn++,Gr=fr,ii=0,ir=0;ir<$a&&(ii++,Gr=Gr.nextZ);ir++);for(da=$a;ii>0||da>0&&Gr;)ii!==0&&(da===0||!Gr||fr.z<=Gr.z)?(Tr=fr,fr=fr.nextZ,ii--):(Tr=Gr,Gr=Gr.nextZ,da--),Jr?Jr.nextZ=Tr:Ht=Tr,Tr.prevZ=Jr,Jr=Tr;fr=Gr}Jr.nextZ=null,$a*=2}while(wn>1)}(St)}(v,k,z,V);for(var ne,he,Se=v;v.prev!==v.next;)if(ne=v.prev,he=v.next,V?Tc(v,k,z,V):Lp(v))c.push(ne.i/b|0),c.push(v.i/b|0),c.push(he.i/b|0),qc(v),v=he.next,Se=he.next;else if((v=he)===Se){W?W===1?Sh(v=Of(Ac(v),c,b),c,b,k,z,V,2):W===2&&Fd(v,c,b,k,z,V):Sh(Ac(v),c,b,k,z,V,1);break}}}function Lp(v){var c=v.prev,b=v,k=v.next;if(gc(c,b,k)>=0)return!1;for(var z=c.x,V=b.x,W=k.x,ne=c.y,he=b.y,Se=k.y,Ne=z<V?z<W?z:W:V<W?V:W,We=ne<he?ne<Se?ne:Se:he<Se?he:Se,ht=z>V?z>W?z:W:V>W?V:W,gt=ne>he?ne>Se?ne:Se:he>Se?he:Se,St=k.next;St!==c;){if(St.x>=Ne&&St.x<=ht&&St.y>=We&&St.y<=gt&&Ff(z,ne,V,he,W,Se,St.x,St.y)&&gc(St.prev,St,St.next)>=0)return!1;St=St.next}return!0}function Tc(v,c,b,k){var z=v.prev,V=v,W=v.next;if(gc(z,V,W)>=0)return!1;for(var ne=z.x,he=V.x,Se=W.x,Ne=z.y,We=V.y,ht=W.y,gt=ne<he?ne<Se?ne:Se:he<Se?he:Se,St=Ne<We?Ne<ht?Ne:ht:We<ht?We:ht,Ht=ne>he?ne>Se?ne:Se:he>Se?he:Se,ir=Ne>We?Ne>ht?Ne:ht:We>ht?We:ht,fr=Gv(gt,St,c,b,k),Gr=Gv(Ht,ir,c,b,k),Tr=v.prevZ,Jr=v.nextZ;Tr&&Tr.z>=fr&&Jr&&Jr.z<=Gr;){if(Tr.x>=gt&&Tr.x<=Ht&&Tr.y>=St&&Tr.y<=ir&&Tr!==z&&Tr!==W&&Ff(ne,Ne,he,We,Se,ht,Tr.x,Tr.y)&&gc(Tr.prev,Tr,Tr.next)>=0||(Tr=Tr.prevZ,Jr.x>=gt&&Jr.x<=Ht&&Jr.y>=St&&Jr.y<=ir&&Jr!==z&&Jr!==W&&Ff(ne,Ne,he,We,Se,ht,Jr.x,Jr.y)&&gc(Jr.prev,Jr,Jr.next)>=0))return!1;Jr=Jr.nextZ}for(;Tr&&Tr.z>=fr;){if(Tr.x>=gt&&Tr.x<=Ht&&Tr.y>=St&&Tr.y<=ir&&Tr!==z&&Tr!==W&&Ff(ne,Ne,he,We,Se,ht,Tr.x,Tr.y)&&gc(Tr.prev,Tr,Tr.next)>=0)return!1;Tr=Tr.prevZ}for(;Jr&&Jr.z<=Gr;){if(Jr.x>=gt&&Jr.x<=Ht&&Jr.y>=St&&Jr.y<=ir&&Jr!==z&&Jr!==W&&Ff(ne,Ne,he,We,Se,ht,Jr.x,Jr.y)&&gc(Jr.prev,Jr,Jr.next)>=0)return!1;Jr=Jr.nextZ}return!0}function Of(v,c,b){var k=v;do{var z=k.prev,V=k.next.next;!Hv(z,V)&&pm(z,k,k.next,V)&&gf(z,V)&&gf(V,z)&&(c.push(z.i/b|0),c.push(k.i/b|0),c.push(V.i/b|0),qc(k),qc(k.next),k=v=V),k=k.next}while(k!==v);return Ac(k)}function Fd(v,c,b,k,z,V){var W=v;do{for(var ne=W.next.next;ne!==W.prev;){if(W.i!==ne.i&&mv(W,ne)){var he=Jd(W,ne);return W=Ac(W,W.next),he=Ac(he,he.next),Sh(W,c,b,k,z,V,0),void Sh(he,c,b,k,z,V,0)}ne=ne.next}W=W.next}while(W!==v)}function Oc(v,c){return v.x-c.x}function zd(v,c){var b=function(z,V){var W,ne=V,he=z.x,Se=z.y,Ne=-1/0;do{if(Se<=ne.y&&Se>=ne.next.y&&ne.next.y!==ne.y){var We=ne.x+(Se-ne.y)*(ne.next.x-ne.x)/(ne.next.y-ne.y);if(We<=he&&We>Ne&&(Ne=We,W=ne.x<ne.next.x?ne:ne.next,We===he))return W}ne=ne.next}while(ne!==V);if(!W)return null;var ht,gt=W,St=W.x,Ht=W.y,ir=1/0;ne=W;do he>=ne.x&&ne.x>=St&&he!==ne.x&&Ff(Se<Ht?he:Ne,Se,St,Ht,Se<Ht?Ne:he,Se,ne.x,ne.y)&&(ht=Math.abs(Se-ne.y)/(he-ne.x),gf(ne,z)&&(ht<ir||ht===ir&&(ne.x>W.x||ne.x===W.x&&yg(W,ne)))&&(W=ne,ir=ht)),ne=ne.next;while(ne!==gt);return W}(v,c);if(!b)return c;var k=Jd(b,v);return Ac(k,k.next),Ac(b,b.next)}function yg(v,c){return gc(v.prev,v,c.prev)<0&&gc(c.next,v,v.next)<0}function Gv(v,c,b,k,z){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v=(v-b)*z|0)|v<<8))|v<<4))|v<<2))|v<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-k)*z|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function fm(v){var c=v,b=v;do(c.x<b.x||c.x===b.x&&c.y<b.y)&&(b=c),c=c.next;while(c!==v);return b}function Ff(v,c,b,k,z,V,W,ne){return(z-W)*(c-ne)>=(v-W)*(V-ne)&&(v-W)*(k-ne)>=(b-W)*(c-ne)&&(b-W)*(V-ne)>=(z-W)*(k-ne)}function mv(v,c){return v.next.i!==c.i&&v.prev.i!==c.i&&!function(b,k){var z=b;do{if(z.i!==b.i&&z.next.i!==b.i&&z.i!==k.i&&z.next.i!==k.i&&pm(z,z.next,b,k))return!0;z=z.next}while(z!==b);return!1}(v,c)&&(gf(v,c)&&gf(c,v)&&function(b,k){var z=b,V=!1,W=(b.x+k.x)/2,ne=(b.y+k.y)/2;do z.y>ne!=z.next.y>ne&&z.next.y!==z.y&&W<(z.next.x-z.x)*(ne-z.y)/(z.next.y-z.y)+z.x&&(V=!V),z=z.next;while(z!==b);return V}(v,c)&&(gc(v.prev,v,c.prev)||gc(v,c.prev,c))||Hv(v,c)&&gc(v.prev,v,v.next)>0&&gc(c.prev,c,c.next)>0)}function gc(v,c,b){return(c.y-v.y)*(b.x-c.x)-(c.x-v.x)*(b.y-c.y)}function Hv(v,c){return v.x===c.x&&v.y===c.y}function pm(v,c,b,k){var z=dm(gc(v,c,b)),V=dm(gc(v,c,k)),W=dm(gc(b,k,v)),ne=dm(gc(b,k,c));return z!==V&&W!==ne||!(z!==0||!Cd(v,b,c))||!(V!==0||!Cd(v,k,c))||!(W!==0||!Cd(b,v,k))||!(ne!==0||!Cd(b,c,k))}function Cd(v,c,b){return c.x<=Math.max(v.x,b.x)&&c.x>=Math.min(v.x,b.x)&&c.y<=Math.max(v.y,b.y)&&c.y>=Math.min(v.y,b.y)}function dm(v){return v>0?1:v<0?-1:0}function gf(v,c){return gc(v.prev,v,v.next)<0?gc(v,c,v.next)>=0&&gc(v,v.prev,c)>=0:gc(v,c,v.prev)<0||gc(v,v.next,c)<0}function Jd(v,c){var b=new Bd(v.i,v.x,v.y),k=new Bd(c.i,c.x,c.y),z=v.next,V=c.prev;return v.next=c,c.prev=v,b.next=z,z.prev=b,k.next=b,b.prev=k,V.next=k,k.prev=V,k}function Kh(v,c,b,k){var z=new Bd(v,c,b);return k?(z.next=k.next,z.prev=k,k.next.prev=z,k.next=z):(z.prev=z,z.next=z),z}function qc(v){v.next.prev=v.prev,v.prev.next=v.next,v.prevZ&&(v.prevZ.nextZ=v.nextZ),v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function Bd(v,c,b){this.i=v,this.x=c,this.y=b,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(v,c,b,k){for(var z=0,V=c,W=b-k;V<b;V+=k)z+=(v[W]-v[V])*(v[V+1]+v[W+1]),W=V;return z}Od.exports=_s,Od.exports.default=_s,_s.deviation=function(v,c,b,k){var z=c&&c.length,V=Math.abs(zf(v,0,z?c[0]*b:v.length,b));if(z)for(var W=0,ne=c.length;W<ne;W++)V-=Math.abs(zf(v,c[W]*b,W<ne-1?c[W+1]*b:v.length,b));var he=0;for(W=0;W<k.length;W+=3){var Se=k[W]*b,Ne=k[W+1]*b,We=k[W+2]*b;he+=Math.abs((v[Se]-v[We])*(v[Ne+1]-v[Se+1])-(v[Se]-v[Ne])*(v[We+1]-v[Se+1]))}return V===0&&he===0?0:Math.abs((he-V)/V)},_s.flatten=function(v){for(var c=v[0][0].length,b={vertices:[],holes:[],dimensions:c},k=0,z=0;z<v.length;z++){for(var V=0;V<v[z].length;V++)for(var W=0;W<c;W++)b.vertices.push(v[z][V][W]);z>0&&b.holes.push(k+=v[z-1].length)}return b};var gv=te(Od.exports);function eg(v,c,b,k,z){Fh(v,c,b||0,k||v.length-1,z||tc)}function Fh(v,c,b,k,z){for(;k>b;){if(k-b>600){var V=k-b+1,W=c-b+1,ne=Math.log(V),he=.5*Math.exp(2*ne/3),Se=.5*Math.sqrt(ne*he*(V-he)/V)*(W-V/2<0?-1:1);Fh(v,c,Math.max(b,Math.floor(c-W*he/V+Se)),Math.min(k,Math.floor(c+(V-W)*he/V+Se)),z)}var Ne=v[c],We=b,ht=k;for(yf(v,b,c),z(v[k],Ne)>0&&yf(v,b,k);We<ht;){for(yf(v,We,ht),We++,ht--;z(v[We],Ne)<0;)We++;for(;z(v[ht],Ne)>0;)ht--}z(v[b],Ne)===0?yf(v,b,ht):yf(v,++ht,k),ht<=c&&(b=ht+1),c<=ht&&(k=ht-1)}}function yf(v,c,b){var k=v[c];v[c]=v[b],v[b]=k}function tc(v,c){return v<c?-1:v>c?1:0}function _f(v,c){const b=v.length;if(b<=1)return[v];const k=[];let z,V;for(let W=0;W<b;W++){const ne=ot(v[W]);ne!==0&&(v[W].area=Math.abs(ne),V===void 0&&(V=ne<0),V===ne<0?(z&&k.push(z),z=[v[W]]):z.push(v[W]))}if(z&&k.push(z),c>1)for(let W=0;W<k.length;W++)k[W].length<=c||(eg(k[W],c,1,k[W].length-1,$v),k[W]=k[W].slice(0,c));return k}function $v(v,c){return c.area-v.area}function vm(v,c,b){const k=b.patternDependencies;let z=!1;for(const V of c){const W=V.paint.get(`${v}-pattern`);W.isConstant()||(z=!0);const ne=W.constantOr(null);ne&&(z=!0,k[ne.to]=!0,k[ne.from]=!0)}return z}function zl(v,c,b,k,z){const V=z.patternDependencies;for(const W of c){const ne=W.paint.get(`${v}-pattern`).value;if(ne.kind!=="constant"){let he=ne.evaluate({zoom:k-1},b,{},z.availableImages),Se=ne.evaluate({zoom:k},b,{},z.availableImages),Ne=ne.evaluate({zoom:k+1},b,{},z.availableImages);he=he&&he.name?he.name:he,Se=Se&&Se.name?Se.name:Se,Ne=Ne&&Ne.name?Ne.name:Ne,V[he]=!0,V[Se]=!0,V[Ne]=!0,b.patterns[W.id]={min:he,mid:Se,max:Ne}}}return b}class Wv{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(b=>b.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ar,this.indexArray=new Qi,this.indexArray2=new Vi,this.programConfigurations=new mc(c.layers,c.zoom),this.segments=new oa,this.segments2=new oa,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(c,b,k){this.hasPattern=vm("fill",this.layers,b);const z=this.layers[0].layout.get("fill-sort-key"),V=!z.isConstant(),W=[];for(const{feature:ne,id:he,index:Se,sourceLayerIndex:Ne}of c){const We=this.layers[0]._featureFilter.needGeometry,ht=ml(ne,We);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),ht,k))continue;const gt=V?z.evaluate(ht,{},k,b.availableImages):void 0,St={id:he,properties:ne.properties,type:ne.type,sourceLayerIndex:Ne,index:Se,geometry:We?ht.geometry:Ol(ne),patterns:{},sortKey:gt};W.push(St)}V&&W.sort((ne,he)=>ne.sortKey-he.sortKey);for(const ne of W){const{geometry:he,index:Se,sourceLayerIndex:Ne}=ne;if(this.hasPattern){const We=zl("fill",this.layers,ne,this.zoom,b);this.patternFeatures.push(We)}else this.addFeature(ne,he,Se,k,{});b.featureIndex.insert(c[Se].feature,he,Se,Ne,this.index)}}update(c,b,k){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,b,this.stateDependentLayers,k)}addFeatures(c,b,k){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,b,k)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ju),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,b,k,z,V){for(const W of _f(b,500)){let ne=0;for(const gt of W)ne+=gt.length;const he=this.segments.prepareSegment(ne,this.layoutVertexArray,this.indexArray),Se=he.vertexLength,Ne=[],We=[];for(const gt of W){if(gt.length===0)continue;gt!==W[0]&&We.push(Ne.length/2);const St=this.segments2.prepareSegment(gt.length,this.layoutVertexArray,this.indexArray2),Ht=St.vertexLength;this.layoutVertexArray.emplaceBack(gt[0].x,gt[0].y),this.indexArray2.emplaceBack(Ht+gt.length-1,Ht),Ne.push(gt[0].x),Ne.push(gt[0].y);for(let ir=1;ir<gt.length;ir++)this.layoutVertexArray.emplaceBack(gt[ir].x,gt[ir].y),this.indexArray2.emplaceBack(Ht+ir-1,Ht+ir),Ne.push(gt[ir].x),Ne.push(gt[ir].y);St.vertexLength+=gt.length,St.primitiveLength+=gt.length}const ht=gv(Ne,We);for(let gt=0;gt<ht.length;gt+=3)this.indexArray.emplaceBack(Se+ht[gt],Se+ht[gt+1],Se+ht[gt+2]);he.vertexLength+=ne,he.primitiveLength+=ht.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,k,V,z)}}let al,Xv;zi("FillBucket",Wv,{omit:["layers","patternFeatures"]});var Qd={get paint(){return Xv=Xv||new Pu({"fill-antialias":new Da(un.paint_fill["fill-antialias"]),"fill-opacity":new ba(un.paint_fill["fill-opacity"]),"fill-color":new ba(un.paint_fill["fill-color"]),"fill-outline-color":new ba(un.paint_fill["fill-outline-color"]),"fill-translate":new Da(un.paint_fill["fill-translate"]),"fill-translate-anchor":new Da(un.paint_fill["fill-translate-anchor"]),"fill-pattern":new bl(un.paint_fill["fill-pattern"])})},get layout(){return al=al||new Pu({"fill-sort-key":new ba(un.layout_fill["fill-sort-key"])})}};class yv extends ho{constructor(c){super(c,Qd)}recalculate(c,b){super.recalculate(c,b);const k=this.paint._values["fill-outline-color"];k.value.kind==="constant"&&k.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Wv(c)}queryRadius(){return Mv(this.paint.get("fill-translate"))}queryIntersectsFeature(c,b,k,z,V,W,ne){return qh(Dd(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),W.angle,ne),z)}isTileClipped(){return!0}}const _g=il([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),mm=il([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bg}=_g;var Kp={},Bm=pe,Ad=ev;function ev(v,c,b,k,z){this.properties={},this.extent=b,this.type=0,this._pbf=v,this._geometry=-1,this._keys=k,this._values=z,v.readFields(Fc,this,c)}function Fc(v,c,b){v==1?c.id=b.readVarint():v==2?function(k,z){for(var V=k.readVarint()+k.pos;k.pos<V;){var W=z._keys[k.readVarint()],ne=z._values[k.readVarint()];z.properties[W]=ne}}(b,c):v==3?c.type=b.readVarint():v==4&&(c._geometry=b.pos)}function tp(v){for(var c,b,k=0,z=0,V=v.length,W=V-1;z<V;W=z++)k+=((b=v[W]).x-(c=v[z]).x)*(c.y+b.y);return k}ev.types=["Unknown","Point","LineString","Polygon"],ev.prototype.loadGeometry=function(){var v=this._pbf;v.pos=this._geometry;for(var c,b=v.readVarint()+v.pos,k=1,z=0,V=0,W=0,ne=[];v.pos<b;){if(z<=0){var he=v.readVarint();k=7&he,z=he>>3}if(z--,k===1||k===2)V+=v.readSVarint(),W+=v.readSVarint(),k===1&&(c&&ne.push(c),c=[]),c.push(new Bm(V,W));else{if(k!==7)throw new Error("unknown command "+k);c&&c.push(c[0].clone())}}return c&&ne.push(c),ne},ev.prototype.bbox=function(){var v=this._pbf;v.pos=this._geometry;for(var c=v.readVarint()+v.pos,b=1,k=0,z=0,V=0,W=1/0,ne=-1/0,he=1/0,Se=-1/0;v.pos<c;){if(k<=0){var Ne=v.readVarint();b=7&Ne,k=Ne>>3}if(k--,b===1||b===2)(z+=v.readSVarint())<W&&(W=z),z>ne&&(ne=z),(V+=v.readSVarint())<he&&(he=V),V>Se&&(Se=V);else if(b!==7)throw new Error("unknown command "+b)}return[W,he,ne,Se]},ev.prototype.toGeoJSON=function(v,c,b){var k,z,V=this.extent*Math.pow(2,b),W=this.extent*v,ne=this.extent*c,he=this.loadGeometry(),Se=ev.types[this.type];function Ne(gt){for(var St=0;St<gt.length;St++){var Ht=gt[St];gt[St]=[360*(Ht.x+W)/V-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ht.y+ne)/V)*Math.PI/180))-90]}}switch(this.type){case 1:var We=[];for(k=0;k<he.length;k++)We[k]=he[k][0];Ne(he=We);break;case 2:for(k=0;k<he.length;k++)Ne(he[k]);break;case 3:for(he=function(gt){var St=gt.length;if(St<=1)return[gt];for(var Ht,ir,fr=[],Gr=0;Gr<St;Gr++){var Tr=tp(gt[Gr]);Tr!==0&&(ir===void 0&&(ir=Tr<0),ir===Tr<0?(Ht&&fr.push(Ht),Ht=[gt[Gr]]):Ht.push(gt[Gr]))}return Ht&&fr.push(Ht),fr}(he),k=0;k<he.length;k++)for(z=0;z<he[k].length;z++)Ne(he[k][z])}he.length===1?he=he[0]:Se="Multi"+Se;var ht={type:"Feature",geometry:{type:Se,coordinates:he},properties:this.properties};return"id"in this&&(ht.id=this.id),ht};var Nd=Ad,ze=At;function At(v,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=v,this._keys=[],this._values=[],this._features=[],v.readFields(Gt,this,c),this.length=this._features.length}function Gt(v,c,b){v===15?c.version=b.readVarint():v===1?c.name=b.readString():v===5?c.extent=b.readVarint():v===2?c._features.push(b.pos):v===3?c._keys.push(b.readString()):v===4&&c._values.push(function(k){for(var z=null,V=k.readVarint()+k.pos;k.pos<V;){var W=k.readVarint()>>3;z=W===1?k.readString():W===2?k.readFloat():W===3?k.readDouble():W===4?k.readVarint64():W===5?k.readVarint():W===6?k.readSVarint():W===7?k.readBoolean():null}return z}(b))}At.prototype.feature=function(v){if(v<0||v>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[v];var c=this._pbf.readVarint()+this._pbf.pos;return new Nd(this._pbf,c,this.extent,this._keys,this._values)};var fn=ze;function Dn(v,c,b){if(v===3){var k=new fn(b,b.readVarint()+b.pos);k.length&&(c[k.name]=k)}}Kp.VectorTile=function(v,c){this.layers=v.readFields(Dn,{},c)},Kp.VectorTileFeature=Ad,Kp.VectorTileLayer=ze;const ln=Kp.VectorTileFeature.types,_n=Math.pow(2,13);function Zn(v,c,b,k,z,V,W,ne){v.emplaceBack(c,b,2*Math.floor(k*_n)+W,z*_n*2,V*_n*2,Math.round(ne))}class ri{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(b=>b.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new nr,this.centroidVertexArray=new dt,this.indexArray=new Qi,this.programConfigurations=new mc(c.layers,c.zoom),this.segments=new oa,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(c,b,k){this.features=[],this.hasPattern=vm("fill-extrusion",this.layers,b);for(const{feature:z,id:V,index:W,sourceLayerIndex:ne}of c){const he=this.layers[0]._featureFilter.needGeometry,Se=ml(z,he);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),Se,k))continue;const Ne={id:V,sourceLayerIndex:ne,index:W,geometry:he?Se.geometry:Ol(z),properties:z.properties,type:z.type,patterns:{}};this.hasPattern?this.features.push(zl("fill-extrusion",this.layers,Ne,this.zoom,b)):this.addFeature(Ne,Ne.geometry,W,k,{}),b.featureIndex.insert(z,Ne.geometry,W,ne,this.index,!0)}}addFeatures(c,b,k){for(const z of this.features){const{geometry:V}=z;this.addFeature(z,V,z.index,b,k)}}update(c,b,k){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,b,this.stateDependentLayers,k)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,bg),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,mm.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,b,k,z,V){const W={x:0,y:0,vertexCount:0};for(const ne of _f(b,500)){let he=0;for(const St of ne)he+=St.length;let Se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const St of ne){if(St.length===0||_i(St))continue;let Ht=0;for(let ir=0;ir<St.length;ir++){const fr=St[ir];if(ir>=1){const Gr=St[ir-1];if(!Ci(fr,Gr)){Se.vertexLength+4>oa.MAX_VERTEX_ARRAY_LENGTH&&(Se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Tr=fr.sub(Gr)._perp()._unit(),Jr=Gr.dist(fr);Ht+Jr>32768&&(Ht=0),Zn(this.layoutVertexArray,fr.x,fr.y,Tr.x,Tr.y,0,0,Ht),Zn(this.layoutVertexArray,fr.x,fr.y,Tr.x,Tr.y,0,1,Ht),W.x+=2*fr.x,W.y+=2*fr.y,W.vertexCount+=2,Ht+=Jr,Zn(this.layoutVertexArray,Gr.x,Gr.y,Tr.x,Tr.y,0,0,Ht),Zn(this.layoutVertexArray,Gr.x,Gr.y,Tr.x,Tr.y,0,1,Ht),W.x+=2*Gr.x,W.y+=2*Gr.y,W.vertexCount+=2;const wn=Se.vertexLength;this.indexArray.emplaceBack(wn,wn+2,wn+1),this.indexArray.emplaceBack(wn+1,wn+2,wn+3),Se.vertexLength+=4,Se.primitiveLength+=2}}}}if(Se.vertexLength+he>oa.MAX_VERTEX_ARRAY_LENGTH&&(Se=this.segments.prepareSegment(he,this.layoutVertexArray,this.indexArray)),ln[c.type]!=="Polygon")continue;const Ne=[],We=[],ht=Se.vertexLength;for(const St of ne)if(St.length!==0){St!==ne[0]&&We.push(Ne.length/2);for(let Ht=0;Ht<St.length;Ht++){const ir=St[Ht];Zn(this.layoutVertexArray,ir.x,ir.y,0,0,1,1,0),W.x+=ir.x,W.y+=ir.y,W.vertexCount+=1,Ne.push(ir.x),Ne.push(ir.y)}}const gt=gv(Ne,We);for(let St=0;St<gt.length;St+=3)this.indexArray.emplaceBack(ht+gt[St],ht+gt[St+2],ht+gt[St+1]);Se.primitiveLength+=gt.length/3,Se.vertexLength+=he}for(let ne=0;ne<W.vertexCount;ne++)this.centroidVertexArray.emplaceBack(Math.floor(W.x/W.vertexCount),Math.floor(W.y/W.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,k,V,z)}}function Ci(v,c){return v.x===c.x&&(v.x<0||v.x>Os)||v.y===c.y&&(v.y<0||v.y>Os)}function _i(v){return v.every(c=>c.x<0)||v.every(c=>c.x>Os)||v.every(c=>c.y<0)||v.every(c=>c.y>Os)}let Li;zi("FillExtrusionBucket",ri,{omit:["layers","features"]});var Fi={get paint(){return Li=Li||new Pu({"fill-extrusion-opacity":new Da(un["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ba(un["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Da(un["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Da(un["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bl(un["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ba(un["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ba(un["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Da(un["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class hi extends ho{constructor(c){super(c,Fi)}createBucket(c){return new ri(c)}queryRadius(){return Mv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,b,k,z,V,W,ne,he){const Se=Dd(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),W.angle,ne),Ne=this.paint.get("fill-extrusion-height").evaluate(b,k),We=this.paint.get("fill-extrusion-base").evaluate(b,k),ht=function(St,Ht,ir,fr){const Gr=[];for(const Tr of St){const Jr=[Tr.x,Tr.y,0,1];lm(Jr,Jr,Ht),Gr.push(new le(Jr[0]/Jr[3],Jr[1]/Jr[3]))}return Gr}(Se,he),gt=function(St,Ht,ir,fr){const Gr=[],Tr=[],Jr=fr[8]*Ht,wn=fr[9]*Ht,ii=fr[10]*Ht,da=fr[11]*Ht,$a=fr[8]*ir,fa=fr[9]*ir,ra=fr[10]*ir,Xi=fr[11]*ir;for(const ga of St){const qi=[],Ei=[];for(const Wa of ga){const Ta=Wa.x,gs=Wa.y,gl=fr[0]*Ta+fr[4]*gs+fr[12],Sl=fr[1]*Ta+fr[5]*gs+fr[13],zc=fr[2]*Ta+fr[6]*gs+fr[14],Dp=fr[3]*Ta+fr[7]*gs+fr[15],Op=zc+ii,dh=Dp+da,Jh=gl+$a,Nh=Sl+fa,vh=zc+ra,nc=Dp+Xi,Us=new le((gl+Jr)/dh,(Sl+wn)/dh);Us.z=Op/dh,qi.push(Us);const zs=new le(Jh/nc,Nh/nc);zs.z=vh/nc,Ei.push(zs)}Gr.push(qi),Tr.push(Ei)}return[Gr,Tr]}(z,We,Ne,he);return function(St,Ht,ir){let fr=1/0;qh(ir,Ht)&&(fr=Wr(ir,Ht[0]));for(let Gr=0;Gr<Ht.length;Gr++){const Tr=Ht[Gr],Jr=St[Gr];for(let wn=0;wn<Tr.length-1;wn++){const ii=Tr[wn],da=[ii,Tr[wn+1],Jr[wn+1],Jr[wn],ii];ep(ir,da)&&(fr=Math.min(fr,Wr(ir,da)))}}return fr!==1/0&&fr}(gt[0],gt[1],ht)}}function ki(v,c){return v.x*c.x+v.y*c.y}function Wr(v,c){if(v.length===1){let b=0;const k=c[b++];let z;for(;!z||k.equals(z);)if(z=c[b++],!z)return 1/0;for(;b<c.length;b++){const V=c[b],W=v[0],ne=z.sub(k),he=V.sub(k),Se=W.sub(k),Ne=ki(ne,ne),We=ki(ne,he),ht=ki(he,he),gt=ki(Se,ne),St=ki(Se,he),Ht=Ne*ht-We*We,ir=(ht*gt-We*St)/Ht,fr=(Ne*St-We*gt)/Ht,Gr=k.z*(1-ir-fr)+z.z*ir+V.z*fr;if(isFinite(Gr))return Gr}return 1/0}{let b=1/0;for(const k of c)b=Math.min(b,k.z);return b}}const bn=il([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:di}=bn,Gi=il([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yn}=Gi,ia=Kp.VectorTileFeature.types,oi=Math.cos(Math.PI/180*37.5),Di=Math.pow(2,14)/.5;class qn{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(b=>b.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(b=>{this.gradients[b.id]={}}),this.layoutVertexArray=new Ir,this.layoutVertexArray2=new _r,this.indexArray=new Qi,this.programConfigurations=new mc(c.layers,c.zoom),this.segments=new oa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id)}populate(c,b,k){this.hasPattern=vm("line",this.layers,b);const z=this.layers[0].layout.get("line-sort-key"),V=!z.isConstant(),W=[];for(const{feature:ne,id:he,index:Se,sourceLayerIndex:Ne}of c){const We=this.layers[0]._featureFilter.needGeometry,ht=ml(ne,We);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),ht,k))continue;const gt=V?z.evaluate(ht,{},k):void 0,St={id:he,properties:ne.properties,type:ne.type,sourceLayerIndex:Ne,index:Se,geometry:We?ht.geometry:Ol(ne),patterns:{},sortKey:gt};W.push(St)}V&&W.sort((ne,he)=>ne.sortKey-he.sortKey);for(const ne of W){const{geometry:he,index:Se,sourceLayerIndex:Ne}=ne;if(this.hasPattern){const We=zl("line",this.layers,ne,this.zoom,b);this.patternFeatures.push(We)}else this.addFeature(ne,he,Se,k,{});b.featureIndex.insert(c[Se].feature,he,Se,Ne,this.index)}}update(c,b,k){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,b,this.stateDependentLayers,k)}addFeatures(c,b,k){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,b,k)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,Yn)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,di),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,b,k,z,V){const W=this.layers[0].layout,ne=W.get("line-join").evaluate(c,{}),he=W.get("line-cap"),Se=W.get("line-miter-limit"),Ne=W.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const We of b)this.addLine(We,c,ne,he,Se,Ne);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,k,V,z)}addLine(c,b,k,z,V,W){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let fr=0;fr<c.length-1;fr++)this.totalDistance+=c[fr].dist(c[fr+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const ne=ia[b.type]==="Polygon";let he=c.length;for(;he>=2&&c[he-1].equals(c[he-2]);)he--;let Se=0;for(;Se<he-1&&c[Se].equals(c[Se+1]);)Se++;if(he<(ne?3:2))return;k==="bevel"&&(V=1.05);const Ne=this.overscaling<=16?15*Os/(512*this.overscaling):0,We=this.segments.prepareSegment(10*he,this.layoutVertexArray,this.indexArray);let ht,gt,St,Ht,ir;this.e1=this.e2=-1,ne&&(ht=c[he-2],ir=c[Se].sub(ht)._unit()._perp());for(let fr=Se;fr<he;fr++){if(St=fr===he-1?ne?c[Se+1]:void 0:c[fr+1],St&&c[fr].equals(St))continue;ir&&(Ht=ir),ht&&(gt=ht),ht=c[fr],ir=St?St.sub(ht)._unit()._perp():Ht,Ht=Ht||ir;let Gr=Ht.add(ir);Gr.x===0&&Gr.y===0||Gr._unit();const Tr=Ht.x*ir.x+Ht.y*ir.y,Jr=Gr.x*ir.x+Gr.y*ir.y,wn=Jr!==0?1/Jr:1/0,ii=2*Math.sqrt(2-2*Jr),da=Jr<oi&&gt&&St,$a=Ht.x*ir.y-Ht.y*ir.x>0;if(da&&fr>Se){const Xi=ht.dist(gt);if(Xi>2*Ne){const ga=ht.sub(ht.sub(gt)._mult(Ne/Xi)._round());this.updateDistance(gt,ga),this.addCurrentVertex(ga,Ht,0,0,We),gt=ga}}const fa=gt&&St;let ra=fa?k:ne?"butt":z;if(fa&&ra==="round"&&(wn<W?ra="miter":wn<=2&&(ra="fakeround")),ra==="miter"&&wn>V&&(ra="bevel"),ra==="bevel"&&(wn>2&&(ra="flipbevel"),wn<V&&(ra="miter")),gt&&this.updateDistance(gt,ht),ra==="miter")Gr._mult(wn),this.addCurrentVertex(ht,Gr,0,0,We);else if(ra==="flipbevel"){if(wn>100)Gr=ir.mult(-1);else{const Xi=wn*Ht.add(ir).mag()/Ht.sub(ir).mag();Gr._perp()._mult(Xi*($a?-1:1))}this.addCurrentVertex(ht,Gr,0,0,We),this.addCurrentVertex(ht,Gr.mult(-1),0,0,We)}else if(ra==="bevel"||ra==="fakeround"){const Xi=-Math.sqrt(wn*wn-1),ga=$a?Xi:0,qi=$a?0:Xi;if(gt&&this.addCurrentVertex(ht,Ht,ga,qi,We),ra==="fakeround"){const Ei=Math.round(180*ii/Math.PI/20);for(let Wa=1;Wa<Ei;Wa++){let Ta=Wa/Ei;if(Ta!==.5){const gl=Ta-.5;Ta+=Ta*gl*(Ta-1)*((1.0904+Tr*(Tr*(3.55645-1.43519*Tr)-3.2452))*gl*gl+(.848013+Tr*(.215638*Tr-1.06021)))}const gs=ir.sub(Ht)._mult(Ta)._add(Ht)._unit()._mult($a?-1:1);this.addHalfVertex(ht,gs.x,gs.y,!1,$a,0,We)}}St&&this.addCurrentVertex(ht,ir,-ga,-qi,We)}else if(ra==="butt")this.addCurrentVertex(ht,Gr,0,0,We);else if(ra==="square"){const Xi=gt?1:-1;this.addCurrentVertex(ht,Gr,Xi,Xi,We)}else ra==="round"&&(gt&&(this.addCurrentVertex(ht,Ht,0,0,We),this.addCurrentVertex(ht,Ht,1,1,We,!0)),St&&(this.addCurrentVertex(ht,ir,-1,-1,We,!0),this.addCurrentVertex(ht,ir,0,0,We)));if(da&&fr<he-1){const Xi=ht.dist(St);if(Xi>2*Ne){const ga=ht.add(St.sub(ht)._mult(Ne/Xi)._round());this.updateDistance(ht,ga),this.addCurrentVertex(ga,ir,0,0,We),ht=ga}}}}addCurrentVertex(c,b,k,z,V,W=!1){const ne=b.y*z-b.x,he=-b.y-b.x*z;this.addHalfVertex(c,b.x+b.y*k,b.y-b.x*k,W,!1,k,V),this.addHalfVertex(c,ne,he,W,!0,-z,V),this.distance>Di/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,b,k,z,V,W))}addHalfVertex({x:c,y:b},k,z,V,W,ne,he){const Se=.5*(this.lineClips?this.scaledDistance*(Di-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((c<<1)+(V?1:0),(b<<1)+(W?1:0),Math.round(63*k)+128,Math.round(63*z)+128,1+(ne===0?0:ne<0?-1:1)|(63&Se)<<2,Se>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ne=he.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ne),he.primitiveLength++),W?this.e2=Ne:this.e1=Ne}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,b){this.distance+=c.dist(b),this.updateScaledDistance()}}let Ai,Oa;zi("LineBucket",qn,{omit:["layers","patternFeatures"]});var Ya={get paint(){return Oa=Oa||new Pu({"line-opacity":new ba(un.paint_line["line-opacity"]),"line-color":new ba(un.paint_line["line-color"]),"line-translate":new Da(un.paint_line["line-translate"]),"line-translate-anchor":new Da(un.paint_line["line-translate-anchor"]),"line-width":new ba(un.paint_line["line-width"]),"line-gap-width":new ba(un.paint_line["line-gap-width"]),"line-offset":new ba(un.paint_line["line-offset"]),"line-blur":new ba(un.paint_line["line-blur"]),"line-dasharray":new jl(un.paint_line["line-dasharray"]),"line-pattern":new bl(un.paint_line["line-pattern"]),"line-gradient":new df(un.paint_line["line-gradient"])})},get layout(){return Ai=Ai||new Pu({"line-cap":new Da(un.layout_line["line-cap"]),"line-join":new ba(un.layout_line["line-join"]),"line-miter-limit":new Da(un.layout_line["line-miter-limit"]),"line-round-limit":new Da(un.layout_line["line-round-limit"]),"line-sort-key":new ba(un.layout_line["line-sort-key"])})}};class Oi extends ba{possiblyEvaluate(c,b){return b=new Po(Math.floor(b.zoom),{now:b.now,fadeDuration:b.fadeDuration,zoomHistory:b.zoomHistory,transition:b.transition}),super.possiblyEvaluate(c,b)}evaluate(c,b,k,z){return b=Rr({},b,{zoom:Math.floor(b.zoom)}),super.evaluate(c,b,k,z)}}let Qn;class Hn extends ho{constructor(c){super(c,Ya),this.gradientVersion=0,Qn||(Qn=new Oi(Ya.paint.properties["line-width"].specification),Qn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const b=this.gradientExpression();this.stepInterpolant=!!function(k){return k._styleExpression!==void 0}(b)&&b._styleExpression.expression instanceof uu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,b){super.recalculate(c,b),this.paint._values["line-floorwidth"]=Qn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new qn(c)}queryRadius(c){const b=c,k=mo(Tv("line-width",this,b),Tv("line-gap-width",this,b)),z=Tv("line-offset",this,b);return k/2+Math.abs(z)+Mv(this.paint.get("line-translate"))}queryIntersectsFeature(c,b,k,z,V,W,ne){const he=Dd(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),W.angle,ne),Se=ne/2*mo(this.paint.get("line-width").evaluate(b,k),this.paint.get("line-gap-width").evaluate(b,k)),Ne=this.paint.get("line-offset").evaluate(b,k);return Ne&&(z=function(We,ht){const gt=[];for(let St=0;St<We.length;St++){const Ht=We[St],ir=[];for(let fr=0;fr<Ht.length;fr++){const Gr=Ht[fr-1],Tr=Ht[fr],Jr=Ht[fr+1],wn=fr===0?new le(0,0):Tr.sub(Gr)._unit()._perp(),ii=fr===Ht.length-1?new le(0,0):Jr.sub(Tr)._unit()._perp(),da=wn._add(ii)._unit(),$a=da.x*ii.x+da.y*ii.y;$a!==0&&da._mult(1/$a),ir.push(da._mult(ht)._add(Tr))}gt.push(ir)}return gt}(z,Ne*ne)),function(We,ht,gt){for(let St=0;St<ht.length;St++){const Ht=ht[St];if(We.length>=3){for(let ir=0;ir<Ht.length;ir++)if(Wd(We,Ht[ir]))return!0}if(Rd(We,Ht,gt))return!0}return!1}(he,z,Se)}isTileClipped(){return!0}}function mo(v,c){return c>0?c+2*v:v}const so=il([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sa=il([{name:"a_projected_pos",components:3,type:"Float32"}],4);il([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cs=il([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);il([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vo=il([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Go=il([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fs(v,c,b){return v.sections.forEach(k=>{k.text=function(z,V,W){const ne=V.layout.get("text-transform").evaluate(W,{});return ne==="uppercase"?z=z.toLocaleUpperCase():ne==="lowercase"&&(z=z.toLocaleLowerCase()),Dl.applyArabicShaping&&(z=Dl.applyArabicShaping(z)),z}(k.text,c,b)}),v}il([{name:"triangle",components:3,type:"Uint16"}]),il([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),il([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),il([{type:"Float32",name:"offsetX"}]),il([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),il([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var ks=24,Ho=Lo,ss=function(v,c,b,k,z){var V,W,ne=8*z-k-1,he=(1<<ne)-1,Se=he>>1,Ne=-7,We=b?z-1:0,ht=b?-1:1,gt=v[c+We];for(We+=ht,V=gt&(1<<-Ne)-1,gt>>=-Ne,Ne+=ne;Ne>0;V=256*V+v[c+We],We+=ht,Ne-=8);for(W=V&(1<<-Ne)-1,V>>=-Ne,Ne+=k;Ne>0;W=256*W+v[c+We],We+=ht,Ne-=8);if(V===0)V=1-Se;else{if(V===he)return W?NaN:1/0*(gt?-1:1);W+=Math.pow(2,k),V-=Se}return(gt?-1:1)*W*Math.pow(2,V-k)},As=function(v,c,b,k,z,V){var W,ne,he,Se=8*V-z-1,Ne=(1<<Se)-1,We=Ne>>1,ht=z===23?Math.pow(2,-24)-Math.pow(2,-77):0,gt=k?0:V-1,St=k?1:-1,Ht=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(ne=isNaN(c)?1:0,W=Ne):(W=Math.floor(Math.log(c)/Math.LN2),c*(he=Math.pow(2,-W))<1&&(W--,he*=2),(c+=W+We>=1?ht/he:ht*Math.pow(2,1-We))*he>=2&&(W++,he/=2),W+We>=Ne?(ne=0,W=Ne):W+We>=1?(ne=(c*he-1)*Math.pow(2,z),W+=We):(ne=c*Math.pow(2,We-1)*Math.pow(2,z),W=0));z>=8;v[b+gt]=255&ne,gt+=St,ne/=256,z-=8);for(W=W<<z|ne,Se+=z;Se>0;v[b+gt]=255&W,gt+=St,W/=256,Se-=8);v[b+gt-St]|=128*Ht};function Lo(v){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(v)?v:new Uint8Array(v||0),this.pos=0,this.type=0,this.length=this.buf.length}Lo.Varint=0,Lo.Fixed64=1,Lo.Bytes=2,Lo.Fixed32=5;var Pl=4294967296,$l=1/Pl,bu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Hu(v){return v.type===Lo.Bytes?v.readVarint()+v.pos:v.pos+1}function Du(v,c,b){return b?4294967296*c+(v>>>0):4294967296*(c>>>0)+(v>>>0)}function Ro(v,c,b){var k=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));b.realloc(k);for(var z=b.pos-1;z>=v;z--)b.buf[z+k]=b.buf[z]}function Kc(v,c){for(var b=0;b<v.length;b++)c.writeVarint(v[b])}function lu(v,c){for(var b=0;b<v.length;b++)c.writeSVarint(v[b])}function Fa(v,c){for(var b=0;b<v.length;b++)c.writeFloat(v[b])}function Ts(v,c){for(var b=0;b<v.length;b++)c.writeDouble(v[b])}function us(v,c){for(var b=0;b<v.length;b++)c.writeBoolean(v[b])}function Iu(v,c){for(var b=0;b<v.length;b++)c.writeFixed32(v[b])}function zh(v,c){for(var b=0;b<v.length;b++)c.writeSFixed32(v[b])}function rp(v,c){for(var b=0;b<v.length;b++)c.writeFixed64(v[b])}function qt(v,c){for(var b=0;b<v.length;b++)c.writeSFixed64(v[b])}function pn(v,c){return(v[c]|v[c+1]<<8|v[c+2]<<16)+16777216*v[c+3]}function en(v,c,b){v[b]=c,v[b+1]=c>>>8,v[b+2]=c>>>16,v[b+3]=c>>>24}function ua(v,c){return(v[c]|v[c+1]<<8|v[c+2]<<16)+(v[c+3]<<24)}Lo.prototype={destroy:function(){this.buf=null},readFields:function(v,c,b){for(b=b||this.length;this.pos<b;){var k=this.readVarint(),z=k>>3,V=this.pos;this.type=7&k,v(z,c,this),this.pos===V&&this.skip(k)}return c},readMessage:function(v,c){return this.readFields(v,c,this.readVarint()+this.pos)},readFixed32:function(){var v=pn(this.buf,this.pos);return this.pos+=4,v},readSFixed32:function(){var v=ua(this.buf,this.pos);return this.pos+=4,v},readFixed64:function(){var v=pn(this.buf,this.pos)+pn(this.buf,this.pos+4)*Pl;return this.pos+=8,v},readSFixed64:function(){var v=pn(this.buf,this.pos)+ua(this.buf,this.pos+4)*Pl;return this.pos+=8,v},readFloat:function(){var v=ss(this.buf,this.pos,!0,23,4);return this.pos+=4,v},readDouble:function(){var v=ss(this.buf,this.pos,!0,52,8);return this.pos+=8,v},readVarint:function(v){var c,b,k=this.buf;return c=127&(b=k[this.pos++]),b<128?c:(c|=(127&(b=k[this.pos++]))<<7,b<128?c:(c|=(127&(b=k[this.pos++]))<<14,b<128?c:(c|=(127&(b=k[this.pos++]))<<21,b<128?c:function(z,V,W){var ne,he,Se=W.buf;if(ne=(112&(he=Se[W.pos++]))>>4,he<128||(ne|=(127&(he=Se[W.pos++]))<<3,he<128)||(ne|=(127&(he=Se[W.pos++]))<<10,he<128)||(ne|=(127&(he=Se[W.pos++]))<<17,he<128)||(ne|=(127&(he=Se[W.pos++]))<<24,he<128)||(ne|=(1&(he=Se[W.pos++]))<<31,he<128))return Du(z,ne,V);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(b=k[this.pos]))<<28,v,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var v=this.readVarint();return v%2==1?(v+1)/-2:v/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var v=this.readVarint()+this.pos,c=this.pos;return this.pos=v,v-c>=12&&bu?function(b,k,z){return bu.decode(b.subarray(k,z))}(this.buf,c,v):function(b,k,z){for(var V="",W=k;W<z;){var ne,he,Se,Ne=b[W],We=null,ht=Ne>239?4:Ne>223?3:Ne>191?2:1;if(W+ht>z)break;ht===1?Ne<128&&(We=Ne):ht===2?(192&(ne=b[W+1]))==128&&(We=(31&Ne)<<6|63&ne)<=127&&(We=null):ht===3?(he=b[W+2],(192&(ne=b[W+1]))==128&&(192&he)==128&&((We=(15&Ne)<<12|(63&ne)<<6|63&he)<=2047||We>=55296&&We<=57343)&&(We=null)):ht===4&&(he=b[W+2],Se=b[W+3],(192&(ne=b[W+1]))==128&&(192&he)==128&&(192&Se)==128&&((We=(15&Ne)<<18|(63&ne)<<12|(63&he)<<6|63&Se)<=65535||We>=1114112)&&(We=null)),We===null?(We=65533,ht=1):We>65535&&(We-=65536,V+=String.fromCharCode(We>>>10&1023|55296),We=56320|1023&We),V+=String.fromCharCode(We),W+=ht}return V}(this.buf,c,v)},readBytes:function(){var v=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,v);return this.pos=v,c},readPackedVarint:function(v,c){if(this.type!==Lo.Bytes)return v.push(this.readVarint(c));var b=Hu(this);for(v=v||[];this.pos<b;)v.push(this.readVarint(c));return v},readPackedSVarint:function(v){if(this.type!==Lo.Bytes)return v.push(this.readSVarint());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readSVarint());return v},readPackedBoolean:function(v){if(this.type!==Lo.Bytes)return v.push(this.readBoolean());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readBoolean());return v},readPackedFloat:function(v){if(this.type!==Lo.Bytes)return v.push(this.readFloat());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readFloat());return v},readPackedDouble:function(v){if(this.type!==Lo.Bytes)return v.push(this.readDouble());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readDouble());return v},readPackedFixed32:function(v){if(this.type!==Lo.Bytes)return v.push(this.readFixed32());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readFixed32());return v},readPackedSFixed32:function(v){if(this.type!==Lo.Bytes)return v.push(this.readSFixed32());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readSFixed32());return v},readPackedFixed64:function(v){if(this.type!==Lo.Bytes)return v.push(this.readFixed64());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readFixed64());return v},readPackedSFixed64:function(v){if(this.type!==Lo.Bytes)return v.push(this.readSFixed64());var c=Hu(this);for(v=v||[];this.pos<c;)v.push(this.readSFixed64());return v},skip:function(v){var c=7&v;if(c===Lo.Varint)for(;this.buf[this.pos++]>127;);else if(c===Lo.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Lo.Fixed32)this.pos+=4;else{if(c!==Lo.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(v,c){this.writeVarint(v<<3|c)},realloc:function(v){for(var c=this.length||16;c<this.pos+v;)c*=2;if(c!==this.length){var b=new Uint8Array(c);b.set(this.buf),this.buf=b,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(v){this.realloc(4),en(this.buf,v,this.pos),this.pos+=4},writeSFixed32:function(v){this.realloc(4),en(this.buf,v,this.pos),this.pos+=4},writeFixed64:function(v){this.realloc(8),en(this.buf,-1&v,this.pos),en(this.buf,Math.floor(v*$l),this.pos+4),this.pos+=8},writeSFixed64:function(v){this.realloc(8),en(this.buf,-1&v,this.pos),en(this.buf,Math.floor(v*$l),this.pos+4),this.pos+=8},writeVarint:function(v){(v=+v||0)>268435455||v<0?function(c,b){var k,z;if(c>=0?(k=c%4294967296|0,z=c/4294967296|0):(z=~(-c/4294967296),4294967295^(k=~(-c%4294967296))?k=k+1|0:(k=0,z=z+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");b.realloc(10),function(V,W,ne){ne.buf[ne.pos++]=127&V|128,V>>>=7,ne.buf[ne.pos++]=127&V|128,V>>>=7,ne.buf[ne.pos++]=127&V|128,V>>>=7,ne.buf[ne.pos++]=127&V|128,ne.buf[ne.pos]=127&(V>>>=7)}(k,0,b),function(V,W){var ne=(7&V)<<4;W.buf[W.pos++]|=ne|((V>>>=3)?128:0),V&&(W.buf[W.pos++]=127&V|((V>>>=7)?128:0),V&&(W.buf[W.pos++]=127&V|((V>>>=7)?128:0),V&&(W.buf[W.pos++]=127&V|((V>>>=7)?128:0),V&&(W.buf[W.pos++]=127&V|((V>>>=7)?128:0),V&&(W.buf[W.pos++]=127&V)))))}(z,b)}(v,this):(this.realloc(4),this.buf[this.pos++]=127&v|(v>127?128:0),v<=127||(this.buf[this.pos++]=127&(v>>>=7)|(v>127?128:0),v<=127||(this.buf[this.pos++]=127&(v>>>=7)|(v>127?128:0),v<=127||(this.buf[this.pos++]=v>>>7&127))))},writeSVarint:function(v){this.writeVarint(v<0?2*-v-1:2*v)},writeBoolean:function(v){this.writeVarint(!!v)},writeString:function(v){v=String(v),this.realloc(4*v.length),this.pos++;var c=this.pos;this.pos=function(k,z,V){for(var W,ne,he=0;he<z.length;he++){if((W=z.charCodeAt(he))>55295&&W<57344){if(!ne){W>56319||he+1===z.length?(k[V++]=239,k[V++]=191,k[V++]=189):ne=W;continue}if(W<56320){k[V++]=239,k[V++]=191,k[V++]=189,ne=W;continue}W=ne-55296<<10|W-56320|65536,ne=null}else ne&&(k[V++]=239,k[V++]=191,k[V++]=189,ne=null);W<128?k[V++]=W:(W<2048?k[V++]=W>>6|192:(W<65536?k[V++]=W>>12|224:(k[V++]=W>>18|240,k[V++]=W>>12&63|128),k[V++]=W>>6&63|128),k[V++]=63&W|128)}return V}(this.buf,v,this.pos);var b=this.pos-c;b>=128&&Ro(c,b,this),this.pos=c-1,this.writeVarint(b),this.pos+=b},writeFloat:function(v){this.realloc(4),As(this.buf,v,this.pos,!0,23,4),this.pos+=4},writeDouble:function(v){this.realloc(8),As(this.buf,v,this.pos,!0,52,8),this.pos+=8},writeBytes:function(v){var c=v.length;this.writeVarint(c),this.realloc(c);for(var b=0;b<c;b++)this.buf[this.pos++]=v[b]},writeRawMessage:function(v,c){this.pos++;var b=this.pos;v(c,this);var k=this.pos-b;k>=128&&Ro(b,k,this),this.pos=b-1,this.writeVarint(k),this.pos+=k},writeMessage:function(v,c,b){this.writeTag(v,Lo.Bytes),this.writeRawMessage(c,b)},writePackedVarint:function(v,c){c.length&&this.writeMessage(v,Kc,c)},writePackedSVarint:function(v,c){c.length&&this.writeMessage(v,lu,c)},writePackedBoolean:function(v,c){c.length&&this.writeMessage(v,us,c)},writePackedFloat:function(v,c){c.length&&this.writeMessage(v,Fa,c)},writePackedDouble:function(v,c){c.length&&this.writeMessage(v,Ts,c)},writePackedFixed32:function(v,c){c.length&&this.writeMessage(v,Iu,c)},writePackedSFixed32:function(v,c){c.length&&this.writeMessage(v,zh,c)},writePackedFixed64:function(v,c){c.length&&this.writeMessage(v,rp,c)},writePackedSFixed64:function(v,c){c.length&&this.writeMessage(v,qt,c)},writeBytesField:function(v,c){this.writeTag(v,Lo.Bytes),this.writeBytes(c)},writeFixed32Field:function(v,c){this.writeTag(v,Lo.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(v,c){this.writeTag(v,Lo.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(v,c){this.writeTag(v,Lo.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(v,c){this.writeTag(v,Lo.Fixed64),this.writeSFixed64(c)},writeVarintField:function(v,c){this.writeTag(v,Lo.Varint),this.writeVarint(c)},writeSVarintField:function(v,c){this.writeTag(v,Lo.Varint),this.writeSVarint(c)},writeStringField:function(v,c){this.writeTag(v,Lo.Bytes),this.writeString(c)},writeFloatField:function(v,c){this.writeTag(v,Lo.Fixed32),this.writeFloat(c)},writeDoubleField:function(v,c){this.writeTag(v,Lo.Fixed64),this.writeDouble(c)},writeBooleanField:function(v,c){this.writeVarintField(v,!!c)}};var ls=te(Ho);const Nt=3;function Et(v,c,b){v===1&&b.readMessage(gr,c)}function gr(v,c,b){if(v===3){const{id:k,bitmap:z,width:V,height:W,left:ne,top:he,advance:Se}=b.readMessage(Vr,{});c.push({id:k,bitmap:new qu({width:V+2*Nt,height:W+2*Nt},z),metrics:{width:V,height:W,left:ne,top:he,advance:Se}})}}function Vr(v,c,b){v===1?c.id=b.readVarint():v===2?c.bitmap=b.readBytes():v===3?c.width=b.readVarint():v===4?c.height=b.readVarint():v===5?c.left=b.readSVarint():v===6?c.top=b.readSVarint():v===7&&(c.advance=b.readVarint())}const $r=Nt;function wr(v){let c=0,b=0;for(const W of v)c+=W.w*W.h,b=Math.max(b,W.w);v.sort((W,ne)=>ne.h-W.h);const k=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),b),h:1/0}];let z=0,V=0;for(const W of v)for(let ne=k.length-1;ne>=0;ne--){const he=k[ne];if(!(W.w>he.w||W.h>he.h)){if(W.x=he.x,W.y=he.y,V=Math.max(V,W.y+W.h),z=Math.max(z,W.x+W.w),W.w===he.w&&W.h===he.h){const Se=k.pop();ne<k.length&&(k[ne]=Se)}else W.h===he.h?(he.x+=W.w,he.w-=W.w):W.w===he.w?(he.y+=W.h,he.h-=W.h):(k.push({x:he.x+W.w,y:he.y,w:he.w-W.w,h:W.h}),he.y+=W.h,he.h-=W.h);break}}return{w:z,h:V,fill:c/(z*V)||0}}const ur=1;class Lr{constructor(c,{pixelRatio:b,version:k,stretchX:z,stretchY:V,content:W}){this.paddedRect=c,this.pixelRatio=b,this.stretchX=z,this.stretchY=V,this.content=W,this.version=k}get tl(){return[this.paddedRect.x+ur,this.paddedRect.y+ur]}get br(){return[this.paddedRect.x+this.paddedRect.w-ur,this.paddedRect.y+this.paddedRect.h-ur]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ur)/this.pixelRatio,(this.paddedRect.h-2*ur)/this.pixelRatio]}}class Zt{constructor(c,b){const k={},z={};this.haveRenderCallbacks=[];const V=[];this.addImages(c,k,V),this.addImages(b,z,V);const{w:W,h:ne}=wr(V),he=new fh({width:W||1,height:ne||1});for(const Se in c){const Ne=c[Se],We=k[Se].paddedRect;fh.copy(Ne.data,he,{x:0,y:0},{x:We.x+ur,y:We.y+ur},Ne.data)}for(const Se in b){const Ne=b[Se],We=z[Se].paddedRect,ht=We.x+ur,gt=We.y+ur,St=Ne.data.width,Ht=Ne.data.height;fh.copy(Ne.data,he,{x:0,y:0},{x:ht,y:gt},Ne.data),fh.copy(Ne.data,he,{x:0,y:Ht-1},{x:ht,y:gt-1},{width:St,height:1}),fh.copy(Ne.data,he,{x:0,y:0},{x:ht,y:gt+Ht},{width:St,height:1}),fh.copy(Ne.data,he,{x:St-1,y:0},{x:ht-1,y:gt},{width:1,height:Ht}),fh.copy(Ne.data,he,{x:0,y:0},{x:ht+St,y:gt},{width:1,height:Ht})}this.image=he,this.iconPositions=k,this.patternPositions=z}addImages(c,b,k){for(const z in c){const V=c[z],W={x:0,y:0,w:V.data.width+2*ur,h:V.data.height+2*ur};k.push(W),b[z]=new Lr(W,V),V.hasRenderCallback&&this.haveRenderCallbacks.push(z)}}patchUpdatedImages(c,b){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const k in c.updatedImages)this.patchUpdatedImage(this.iconPositions[k],c.getImage(k),b),this.patchUpdatedImage(this.patternPositions[k],c.getImage(k),b)}patchUpdatedImage(c,b,k){if(!c||!b||c.version===b.version)return;c.version=b.version;const[z,V]=c.tl;k.update(b.data,void 0,{x:z,y:V})}}var lr;zi("ImagePosition",Lr),zi("ImageAtlas",Zt),M.ai=void 0,(lr=M.ai||(M.ai={}))[lr.none=0]="none",lr[lr.horizontal=1]="horizontal",lr[lr.vertical=2]="vertical",lr[lr.horizontalOnly=3]="horizontalOnly";const It=-17;class Zr{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,b){const k=new Zr;return k.scale=c||1,k.fontStack=b,k}static forImage(c){const b=new Zr;return b.imageName=c,b}}class Xr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,b){const k=new Xr;for(let z=0;z<c.sections.length;z++){const V=c.sections[z];V.image?k.addImageSection(V):k.addTextSection(V,b)}return k}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let b="";for(let k=0;k<c.length;k++){const z=c.charCodeAt(k+1)||null,V=c.charCodeAt(k-1)||null;b+=z&&xh(z)&&!xl[c[k+1]]||V&&xh(V)&&!xl[c[k-1]]||!xl[c[k]]?c[k]:xl[c[k]]}return b}(this.text)}trim(){let c=0;for(let k=0;k<this.text.length&&dn[this.text.charCodeAt(k)];k++)c++;let b=this.text.length;for(let k=this.text.length-1;k>=0&&k>=c&&dn[this.text.charCodeAt(k)];k--)b--;this.text=this.text.substring(c,b),this.sectionIndex=this.sectionIndex.slice(c,b)}substring(c,b){const k=new Xr;return k.text=this.text.substring(c,b),k.sectionIndex=this.sectionIndex.slice(c,b),k.sections=this.sections,k}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,b)=>Math.max(c,this.sections[b].scale),0)}addTextSection(c,b){this.text+=c.text,this.sections.push(Zr.forText(c.scale,c.fontStack||b));const k=this.sections.length-1;for(let z=0;z<c.text.length;++z)this.sectionIndex.push(k)}addImageSection(c){const b=c.image?c.image.name:"";if(b.length===0)return void Br("Can't add FormattedSection with an empty image.");const k=this.getNextImageSectionCharCode();k?(this.text+=String.fromCharCode(k),this.sections.push(Zr.forImage(b)),this.sectionIndex.push(this.sections.length-1)):Br("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rn(v,c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht){const ir=Xr.fromFeature(v,z);let fr;We===M.ai.vertical&&ir.verticalizePunctuation();const{processBidirectionalText:Gr,processStyledBidirectionalText:Tr}=Dl;if(Gr&&ir.sections.length===1){fr=[];const ii=Gr(ir.toString(),Do(ir,Se,V,c,k,gt,St));for(const da of ii){const $a=new Xr;$a.text=da,$a.sections=ir.sections;for(let fa=0;fa<da.length;fa++)$a.sectionIndex.push(0);fr.push($a)}}else if(Tr){fr=[];const ii=Tr(ir.text,ir.sectionIndex,Do(ir,Se,V,c,k,gt,St));for(const da of ii){const $a=new Xr;$a.text=da[0],$a.sectionIndex=da[1],$a.sections=ir.sections,fr.push($a)}}else fr=function(ii,da){const $a=[],fa=ii.text;let ra=0;for(const Xi of da)$a.push(ii.substring(ra,Xi)),ra=Xi;return ra<fa.length&&$a.push(ii.substring(ra,fa.length)),$a}(ir,Do(ir,Se,V,c,k,gt,St));const Jr=[],wn={positionedLines:Jr,text:ir.toString(),top:Ne[1],bottom:Ne[1],left:Ne[0],right:Ne[0],writingMode:We,iconsInText:!1,verticalizable:!1};return function(ii,da,$a,fa,ra,Xi,ga,qi,Ei,Wa,Ta,gs){let gl=0,Sl=It,zc=0,Dp=0;const Op=qi==="right"?1:qi==="left"?0:.5;let dh=0;for(const Us of ra){Us.trim();const zs=Us.getMaxScale(),Fp=(zs-1)*ks,Zh={positionedGlyphs:[],lineOffset:0};ii.positionedLines[dh]=Zh;const Bf=Zh.positionedGlyphs;let zp=0;if(!Us.length()){Sl+=Xi,++dh;continue}for(let ic=0;ic<Us.length();ic++){const yu=Us.getSection(ic),xf=Us.getSectionIndex(ic),yo=Us.getCharCode(ic);let ro=0,Bp=null,av=null,Np=null,qv=ks;const ov=!(Ei===M.ai.horizontal||!Ta&&!ld(yo)||Ta&&(dn[yo]||(Jh=yo,ji.Arabic(Jh)||ji["Arabic Supplement"](Jh)||ji["Arabic Extended-A"](Jh)||ji["Arabic Presentation Forms-A"](Jh)||ji["Arabic Presentation Forms-B"](Jh))));if(yu.imageName){const Md=fa[yu.imageName];if(!Md)continue;Np=yu.imageName,ii.iconsInText=ii.iconsInText||!0,av=Md.paddedRect;const vd=Md.displaySize;yu.scale=yu.scale*ks/gs,Bp={width:vd[0],height:vd[1],left:ur,top:-$r,advance:ov?vd[1]:vd[0]},ro=Fp+(ks-vd[1]*yu.scale),qv=Bp.advance;const Kv=ov?vd[0]*yu.scale-ks*zs:vd[1]*yu.scale-ks*zs;Kv>0&&Kv>zp&&(zp=Kv)}else{const Md=$a[yu.fontStack],vd=Md&&Md[yo];if(vd&&vd.rect)av=vd.rect,Bp=vd.metrics;else{const Kv=da[yu.fontStack],Ep=Kv&&Kv[yo];if(!Ep)continue;Bp=Ep.metrics}ro=(zs-yu.scale)*ks}ov?(ii.verticalizable=!0,Bf.push({glyph:yo,imageName:Np,x:gl,y:Sl+ro,vertical:ov,scale:yu.scale,fontStack:yu.fontStack,sectionIndex:xf,metrics:Bp,rect:av}),gl+=qv*yu.scale+Wa):(Bf.push({glyph:yo,imageName:Np,x:gl,y:Sl+ro,vertical:ov,scale:yu.scale,fontStack:yu.fontStack,sectionIndex:xf,metrics:Bp,rect:av}),gl+=Bp.advance*yu.scale+Wa)}Bf.length!==0&&(zc=Math.max(gl-Wa,zc),Wl(Bf,0,Bf.length-1,Op,zp)),gl=0;const np=Xi*zs+zp;Zh.lineOffset=Math.max(zp,Fp),Sl+=np,Dp=Math.max(np,Dp),++dh}var Jh;const Nh=Sl-It,{horizontalAlign:vh,verticalAlign:nc}=Ys(ga);(function(Us,zs,Fp,Zh,Bf,zp,np,ic,yu){const xf=(zs-Fp)*Bf;let yo=0;yo=zp!==np?-ic*Zh-It:(-Zh*yu+.5)*np;for(const ro of Us)for(const Bp of ro.positionedGlyphs)Bp.x+=xf,Bp.y+=yo})(ii.positionedLines,Op,vh,nc,zc,Dp,Xi,Nh,ra.length),ii.top+=-nc*Nh,ii.bottom=ii.top+Nh,ii.left+=-vh*zc,ii.right=ii.left+zc}(wn,c,b,k,fr,W,ne,he,We,Se,ht,Ht),!function(ii){for(const da of ii)if(da.positionedGlyphs.length!==0)return!1;return!0}(Jr)&&wn}const dn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pn={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vi(v,c,b,k,z,V){if(c.imageName){const W=k[c.imageName];return W?W.displaySize[0]*c.scale*ks/V+z:0}{const W=b[c.fontStack],ne=W&&W[v];return ne?ne.metrics.advance*c.scale+z:0}}function Ea(v,c,b,k){const z=Math.pow(v-c,2);return k?v<c?z/2:2*z:z+Math.abs(b)*b}function ts(v,c,b){let k=0;return v===10&&(k-=1e4),b&&(k+=150),v!==40&&v!==65288||(k+=50),c!==41&&c!==65289||(k+=50),k}function ma(v,c,b,k,z,V){let W=null,ne=Ea(c,b,z,V);for(const he of k){const Se=Ea(c-he.x,b,z,V)+he.badness;Se<=ne&&(W=he,ne=Se)}return{index:v,x:c,priorBreak:W,badness:ne}}function uo(v){return v?uo(v.priorBreak).concat(v.index):[]}function Do(v,c,b,k,z,V,W){if(V!=="point")return[];if(!v)return[];const ne=[],he=function(ht,gt,St,Ht,ir,fr){let Gr=0;for(let Tr=0;Tr<ht.length();Tr++){const Jr=ht.getSection(Tr);Gr+=vi(ht.getCharCode(Tr),Jr,Ht,ir,gt,fr)}return Gr/Math.max(1,Math.ceil(Gr/St))}(v,c,b,k,z,W),Se=v.text.indexOf("\u200B")>=0;let Ne=0;for(let ht=0;ht<v.length();ht++){const gt=v.getSection(ht),St=v.getCharCode(ht);if(dn[St]||(Ne+=vi(St,gt,k,z,c,W)),ht<v.length()-1){const Ht=!((We=St)<11904||!(ji["Bopomofo Extended"](We)||ji.Bopomofo(We)||ji["CJK Compatibility Forms"](We)||ji["CJK Compatibility Ideographs"](We)||ji["CJK Compatibility"](We)||ji["CJK Radicals Supplement"](We)||ji["CJK Strokes"](We)||ji["CJK Symbols and Punctuation"](We)||ji["CJK Unified Ideographs Extension A"](We)||ji["CJK Unified Ideographs"](We)||ji["Enclosed CJK Letters and Months"](We)||ji["Halfwidth and Fullwidth Forms"](We)||ji.Hiragana(We)||ji["Ideographic Description Characters"](We)||ji["Kangxi Radicals"](We)||ji["Katakana Phonetic Extensions"](We)||ji.Katakana(We)||ji["Vertical Forms"](We)||ji["Yi Radicals"](We)||ji["Yi Syllables"](We)));(Pn[St]||Ht||gt.imageName)&&ne.push(ma(ht+1,Ne,he,ne,ts(St,v.getCharCode(ht+1),Ht&&Se),!1))}}var We;return uo(ma(v.length(),Ne,he,ne,0,!0))}function Ys(v){let c=.5,b=.5;switch(v){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(v){case"bottom":case"bottom-right":case"bottom-left":b=1;break;case"top":case"top-right":case"top-left":b=0}return{horizontalAlign:c,verticalAlign:b}}function Wl(v,c,b,k,z){if(!k&&!z)return;const V=v[b],W=(v[b].x+V.metrics.advance*V.scale)*k;for(let ne=c;ne<=b;ne++)v[ne].x-=W,v[ne].y+=z}function bf(v,c,b){const{horizontalAlign:k,verticalAlign:z}=Ys(b),V=c[0]-v.displaySize[0]*k,W=c[1]-v.displaySize[1]*z;return{image:v,top:W,bottom:W+v.displaySize[1],left:V,right:V+v.displaySize[0]}}function Iv(v,c,b,k,z,V){const W=v.image;let ne;if(W.content){const ir=W.content,fr=W.pixelRatio||1;ne=[ir[0]/fr,ir[1]/fr,W.displaySize[0]-ir[2]/fr,W.displaySize[1]-ir[3]/fr]}const he=c.left*V,Se=c.right*V;let Ne,We,ht,gt;b==="width"||b==="both"?(gt=z[0]+he-k[3],We=z[0]+Se+k[1]):(gt=z[0]+(he+Se-W.displaySize[0])/2,We=gt+W.displaySize[0]);const St=c.top*V,Ht=c.bottom*V;return b==="height"||b==="both"?(Ne=z[1]+St-k[0],ht=z[1]+Ht+k[2]):(Ne=z[1]+(St+Ht-W.displaySize[1])/2,ht=Ne+W.displaySize[1]),{image:W,top:Ne,right:We,bottom:ht,left:gt,collisionPadding:ne}}const Bh=255,Rp=128,ph=Bh*Rp;function tv(v,c){const{expression:b}=c;if(b.kind==="constant")return{kind:"constant",layoutSize:b.evaluate(new Po(v+1))};if(b.kind==="source")return{kind:"source"};{const{zoomStops:k,interpolationType:z}=b;let V=0;for(;V<k.length&&k[V]<=v;)V++;V=Math.max(0,V-1);let W=V;for(;W<k.length&&k[W]<v+1;)W++;W=Math.min(k.length-1,W);const ne=k[V],he=k[W];return b.kind==="composite"?{kind:"composite",minZoom:ne,maxZoom:he,interpolationType:z}:{kind:"camera",minZoom:ne,maxZoom:he,minSize:b.evaluate(new Po(ne)),maxSize:b.evaluate(new Po(he)),interpolationType:z}}}function Td(v,c,b){let k="never";const z=v.get(c);return z?k=z:v.get(b)&&(k="always"),k}const _v=Kp.VectorTileFeature.types,Lv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gm(v,c,b,k,z,V,W,ne,he,Se,Ne,We,ht){const gt=ne?Math.min(ph,Math.round(ne[0])):0,St=ne?Math.min(ph,Math.round(ne[1])):0;v.emplaceBack(c,b,Math.round(32*k),Math.round(32*z),V,W,(gt<<1)+(he?1:0),St,16*Se,16*Ne,256*We,256*ht)}function rc(v,c,b){v.emplaceBack(c.x,c.y,b),v.emplaceBack(c.x,c.y,b),v.emplaceBack(c.x,c.y,b),v.emplaceBack(c.x,c.y,b)}function wl(v){for(const c of v.sections)if(oh(c.text))return!0;return!1}class Nm{constructor(c){this.layoutVertexArray=new nn,this.indexArray=new Qi,this.programConfigurations=c,this.segments=new oa,this.dynamicLayoutVertexArray=new Ln,this.opacityVertexArray=new Mn,this.hasVisibleVertices=!1,this.placedSymbolArray=new oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,b,k,z){this.isEmpty()||(k&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,so.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,b),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,sa.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,Lv,!0),this.opacityVertexBuffer.itemSize=1),(k||z)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zi("SymbolBuffers",Nm);class Yv{constructor(c,b,k){this.layoutVertexArray=new c,this.layoutAttributes=b,this.indexArray=new k,this.segments=new oa,this.collisionVertexArray=new Ri}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Cs.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zi("CollisionBuffers",Yv);class rv{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(W=>W.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Df([]),this.placementViewportMatrix=Df([]);const b=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tv(this.zoom,b["text-size"]),this.iconSizeData=tv(this.zoom,b["icon-size"]);const k=this.layers[0].layout,z=k.get("symbol-sort-key"),V=k.get("symbol-z-order");this.canOverlap=Td(k,"text-overlap","text-allow-overlap")!=="never"||Td(k,"icon-overlap","icon-allow-overlap")!=="never"||k.get("text-ignore-placement")||k.get("icon-ignore-placement"),this.sortFeaturesByKey=V!=="viewport-y"&&!z.isConstant(),this.sortFeaturesByY=(V==="viewport-y"||V==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,k.get("symbol-placement")==="point"&&(this.writingModes=k.get("text-writing-mode").map(W=>M.ai[W])),this.stateDependentLayerIds=this.layers.filter(W=>W.isStateDependent()).map(W=>W.id),this.sourceID=c.sourceID}createArrays(){this.text=new Nm(new mc(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new Nm(new mc(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new De,this.lineVertexArray=new He,this.symbolInstances=new ye,this.textAnchorOffsets=new ft}calculateGlyphDependencies(c,b,k,z,V){for(let W=0;W<c.length;W++)if(b[c.charCodeAt(W)]=!0,(k||z)&&V){const ne=xl[c.charAt(W)];ne&&(b[ne.charCodeAt(0)]=!0)}}populate(c,b,k){const z=this.layers[0],V=z.layout,W=V.get("text-font"),ne=V.get("text-field"),he=V.get("icon-image"),Se=(ne.value.kind!=="constant"||ne.value.value instanceof to&&!ne.value.value.isEmpty()||ne.value.value.toString().length>0)&&(W.value.kind!=="constant"||W.value.value.length>0),Ne=he.value.kind!=="constant"||!!he.value.value||Object.keys(he.parameters).length>0,We=V.get("symbol-sort-key");if(this.features=[],!Se&&!Ne)return;const ht=b.iconDependencies,gt=b.glyphDependencies,St=b.availableImages,Ht=new Po(this.zoom);for(const{feature:ir,id:fr,index:Gr,sourceLayerIndex:Tr}of c){const Jr=z._featureFilter.needGeometry,wn=ml(ir,Jr);if(!z._featureFilter.filter(Ht,wn,k))continue;let ii,da;if(Jr||(wn.geometry=Ol(ir)),Se){const fa=z.getValueAndResolveTokens("text-field",wn,k,St),ra=to.factory(fa);wl(ra)&&(this.hasRTLText=!0),(!this.hasRTLText||_l()==="unavailable"||this.hasRTLText&&Dl.isParsed())&&(ii=Fs(ra,z,wn))}if(Ne){const fa=z.getValueAndResolveTokens("icon-image",wn,k,St);da=fa instanceof Ss?fa:Ss.fromString(fa)}if(!ii&&!da)continue;const $a=this.sortFeaturesByKey?We.evaluate(wn,{},k):void 0;if(this.features.push({id:fr,text:ii,icon:da,index:Gr,sourceLayerIndex:Tr,geometry:wn.geometry,properties:ir.properties,type:_v[ir.type],sortKey:$a}),da&&(ht[da.name]=!0),ii){const fa=W.evaluate(wn,{},k).join(","),ra=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(M.ai.vertical)>=0;for(const Xi of ii.sections)if(Xi.image)ht[Xi.image.name]=!0;else{const ga=Ic(ii.toString()),qi=Xi.fontStack||fa,Ei=gt[qi]=gt[qi]||{};this.calculateGlyphDependencies(Xi.text,Ei,ra,this.allowVerticalPlacement,ga)}}}V.get("symbol-placement")==="line"&&(this.features=function(ir){const fr={},Gr={},Tr=[];let Jr=0;function wn(fa){Tr.push(ir[fa]),Jr++}function ii(fa,ra,Xi){const ga=Gr[fa];return delete Gr[fa],Gr[ra]=ga,Tr[ga].geometry[0].pop(),Tr[ga].geometry[0]=Tr[ga].geometry[0].concat(Xi[0]),ga}function da(fa,ra,Xi){const ga=fr[ra];return delete fr[ra],fr[fa]=ga,Tr[ga].geometry[0].shift(),Tr[ga].geometry[0]=Xi[0].concat(Tr[ga].geometry[0]),ga}function $a(fa,ra,Xi){const ga=Xi?ra[0][ra[0].length-1]:ra[0][0];return`${fa}:${ga.x}:${ga.y}`}for(let fa=0;fa<ir.length;fa++){const ra=ir[fa],Xi=ra.geometry,ga=ra.text?ra.text.toString():null;if(!ga){wn(fa);continue}const qi=$a(ga,Xi),Ei=$a(ga,Xi,!0);if(qi in Gr&&Ei in fr&&Gr[qi]!==fr[Ei]){const Wa=da(qi,Ei,Xi),Ta=ii(qi,Ei,Tr[Wa].geometry);delete fr[qi],delete Gr[Ei],Gr[$a(ga,Tr[Ta].geometry,!0)]=Ta,Tr[Wa].geometry=null}else qi in Gr?ii(qi,Ei,Xi):Ei in fr?da(qi,Ei,Xi):(wn(fa),fr[qi]=Jr-1,Gr[Ei]=Jr-1)}return Tr.filter(fa=>fa.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ir,fr)=>ir.sortKey-fr.sortKey)}update(c,b,k){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,b,this.layers,k),this.icon.programConfigurations.updatePaintArrays(c,b,this.layers,k))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,b){const k=this.lineVertexArray.length;if(c.segment!==void 0){let z=c.dist(b[c.segment+1]),V=c.dist(b[c.segment]);const W={};for(let ne=c.segment+1;ne<b.length;ne++)W[ne]={x:b[ne].x,y:b[ne].y,tileUnitDistanceFromAnchor:z},ne<b.length-1&&(z+=b[ne+1].dist(b[ne]));for(let ne=c.segment||0;ne>=0;ne--)W[ne]={x:b[ne].x,y:b[ne].y,tileUnitDistanceFromAnchor:V},ne>0&&(V+=b[ne-1].dist(b[ne]));for(let ne=0;ne<b.length;ne++){const he=W[ne];this.lineVertexArray.emplaceBack(he.x,he.y,he.tileUnitDistanceFromAnchor)}}return{lineStartIndex:k,lineLength:this.lineVertexArray.length-k}}addSymbols(c,b,k,z,V,W,ne,he,Se,Ne,We,ht){const gt=c.indexArray,St=c.layoutVertexArray,Ht=c.segments.prepareSegment(4*b.length,St,gt,this.canOverlap?W.sortKey:void 0),ir=this.glyphOffsetArray.length,fr=Ht.vertexLength,Gr=this.allowVerticalPlacement&&ne===M.ai.vertical?Math.PI/2:0,Tr=W.text&&W.text.sections;for(let Jr=0;Jr<b.length;Jr++){const{tl:wn,tr:ii,bl:da,br:$a,tex:fa,pixelOffsetTL:ra,pixelOffsetBR:Xi,minFontScaleX:ga,minFontScaleY:qi,glyphOffset:Ei,isSDF:Wa,sectionIndex:Ta}=b[Jr],gs=Ht.vertexLength,gl=Ei[1];gm(St,he.x,he.y,wn.x,gl+wn.y,fa.x,fa.y,k,Wa,ra.x,ra.y,ga,qi),gm(St,he.x,he.y,ii.x,gl+ii.y,fa.x+fa.w,fa.y,k,Wa,Xi.x,ra.y,ga,qi),gm(St,he.x,he.y,da.x,gl+da.y,fa.x,fa.y+fa.h,k,Wa,ra.x,Xi.y,ga,qi),gm(St,he.x,he.y,$a.x,gl+$a.y,fa.x+fa.w,fa.y+fa.h,k,Wa,Xi.x,Xi.y,ga,qi),rc(c.dynamicLayoutVertexArray,he,Gr),gt.emplaceBack(gs,gs+1,gs+2),gt.emplaceBack(gs+1,gs+2,gs+3),Ht.vertexLength+=4,Ht.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ei[0]),Jr!==b.length-1&&Ta===b[Jr+1].sectionIndex||c.programConfigurations.populatePaintArrays(St.length,W,W.index,{},ht,Tr&&Tr[Ta])}c.placedSymbolArray.emplaceBack(he.x,he.y,ir,this.glyphOffsetArray.length-ir,fr,Se,Ne,he.segment,k?k[0]:0,k?k[1]:0,z[0],z[1],ne,0,!1,0,We)}_addCollisionDebugVertex(c,b,k,z,V,W){return b.emplaceBack(0,0),c.emplaceBack(k.x,k.y,z,V,Math.round(W.x),Math.round(W.y))}addCollisionDebugVertices(c,b,k,z,V,W,ne){const he=V.segments.prepareSegment(4,V.layoutVertexArray,V.indexArray),Se=he.vertexLength,Ne=V.layoutVertexArray,We=V.collisionVertexArray,ht=ne.anchorX,gt=ne.anchorY;this._addCollisionDebugVertex(Ne,We,W,ht,gt,new le(c,b)),this._addCollisionDebugVertex(Ne,We,W,ht,gt,new le(k,b)),this._addCollisionDebugVertex(Ne,We,W,ht,gt,new le(k,z)),this._addCollisionDebugVertex(Ne,We,W,ht,gt,new le(c,z)),he.vertexLength+=4;const St=V.indexArray;St.emplaceBack(Se,Se+1),St.emplaceBack(Se+1,Se+2),St.emplaceBack(Se+2,Se+3),St.emplaceBack(Se+3,Se),he.primitiveLength+=4}addDebugCollisionBoxes(c,b,k,z){for(let V=c;V<b;V++){const W=this.collisionBoxArray.get(V);this.addCollisionDebugVertices(W.x1,W.y1,W.x2,W.y2,z?this.textCollisionBox:this.iconCollisionBox,W.anchorPoint,k)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yv(yi,Vo.members,Vi),this.iconCollisionBox=new Yv(yi,Vo.members,Vi);for(let c=0;c<this.symbolInstances.length;c++){const b=this.symbolInstances.get(c);this.addDebugCollisionBoxes(b.textBoxStartIndex,b.textBoxEndIndex,b,!0),this.addDebugCollisionBoxes(b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,!0),this.addDebugCollisionBoxes(b.iconBoxStartIndex,b.iconBoxEndIndex,b,!1),this.addDebugCollisionBoxes(b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,!1)}}_deserializeCollisionBoxesForSymbol(c,b,k,z,V,W,ne,he,Se){const Ne={};for(let We=b;We<k;We++){const ht=c.get(We);Ne.textBox={x1:ht.x1,y1:ht.y1,x2:ht.x2,y2:ht.y2,anchorPointX:ht.anchorPointX,anchorPointY:ht.anchorPointY},Ne.textFeatureIndex=ht.featureIndex;break}for(let We=z;We<V;We++){const ht=c.get(We);Ne.verticalTextBox={x1:ht.x1,y1:ht.y1,x2:ht.x2,y2:ht.y2,anchorPointX:ht.anchorPointX,anchorPointY:ht.anchorPointY},Ne.verticalTextFeatureIndex=ht.featureIndex;break}for(let We=W;We<ne;We++){const ht=c.get(We);Ne.iconBox={x1:ht.x1,y1:ht.y1,x2:ht.x2,y2:ht.y2,anchorPointX:ht.anchorPointX,anchorPointY:ht.anchorPointY},Ne.iconFeatureIndex=ht.featureIndex;break}for(let We=he;We<Se;We++){const ht=c.get(We);Ne.verticalIconBox={x1:ht.x1,y1:ht.y1,x2:ht.x2,y2:ht.y2,anchorPointX:ht.anchorPointX,anchorPointY:ht.anchorPointY},Ne.verticalIconFeatureIndex=ht.featureIndex;break}return Ne}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let b=0;b<this.symbolInstances.length;b++){const k=this.symbolInstances.get(b);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,k.textBoxStartIndex,k.textBoxEndIndex,k.verticalTextBoxStartIndex,k.verticalTextBoxEndIndex,k.iconBoxStartIndex,k.iconBoxEndIndex,k.verticalIconBoxStartIndex,k.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,b){const k=c.placedSymbolArray.get(b),z=k.vertexStartIndex+4*k.numGlyphs;for(let V=k.vertexStartIndex;V<z;V+=4)c.indexArray.emplaceBack(V,V+1,V+2),c.indexArray.emplaceBack(V+1,V+2,V+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const b=Math.sin(c),k=Math.cos(c),z=[],V=[],W=[];for(let ne=0;ne<this.symbolInstances.length;++ne){W.push(ne);const he=this.symbolInstances.get(ne);z.push(0|Math.round(b*he.anchorX+k*he.anchorY)),V.push(he.featureIndex)}return W.sort((ne,he)=>z[ne]-z[he]||V[he]-V[ne]),W}addToSortKeyRanges(c,b){const k=this.sortKeyRanges[this.sortKeyRanges.length-1];k&&k.sortKey===b?k.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:b,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const b of this.symbolInstanceIndexes){const k=this.symbolInstances.get(b);this.featureSortOrder.push(k.featureIndex),[k.rightJustifiedTextSymbolIndex,k.centerJustifiedTextSymbolIndex,k.leftJustifiedTextSymbolIndex].forEach((z,V,W)=>{z>=0&&W.indexOf(z)===V&&this.addIndicesForPlacedSymbol(this.text,z)}),k.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,k.verticalPlacedTextSymbolIndex),k.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,k.placedIconSymbolIndex),k.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,k.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ym,Zm;zi("SymbolBucket",rv,{omit:["layers","collisionBoxArray","features","compareText"]}),rv.MAX_GLYPHS=65535,rv.addDynamicAttributes=rc;var Rv={get paint(){return Zm=Zm||new Pu({"icon-opacity":new ba(un.paint_symbol["icon-opacity"]),"icon-color":new ba(un.paint_symbol["icon-color"]),"icon-halo-color":new ba(un.paint_symbol["icon-halo-color"]),"icon-halo-width":new ba(un.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ba(un.paint_symbol["icon-halo-blur"]),"icon-translate":new Da(un.paint_symbol["icon-translate"]),"icon-translate-anchor":new Da(un.paint_symbol["icon-translate-anchor"]),"text-opacity":new ba(un.paint_symbol["text-opacity"]),"text-color":new ba(un.paint_symbol["text-color"],{runtimeType:Pa,getOverride:v=>v.textColor,hasOverride:v=>!!v.textColor}),"text-halo-color":new ba(un.paint_symbol["text-halo-color"]),"text-halo-width":new ba(un.paint_symbol["text-halo-width"]),"text-halo-blur":new ba(un.paint_symbol["text-halo-blur"]),"text-translate":new Da(un.paint_symbol["text-translate"]),"text-translate-anchor":new Da(un.paint_symbol["text-translate-anchor"])})},get layout(){return ym=ym||new Pu({"symbol-placement":new Da(un.layout_symbol["symbol-placement"]),"symbol-spacing":new Da(un.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Da(un.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ba(un.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Da(un.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Da(un.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Da(un.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Da(un.layout_symbol["icon-ignore-placement"]),"icon-optional":new Da(un.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Da(un.layout_symbol["icon-rotation-alignment"]),"icon-size":new ba(un.layout_symbol["icon-size"]),"icon-text-fit":new Da(un.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Da(un.layout_symbol["icon-text-fit-padding"]),"icon-image":new ba(un.layout_symbol["icon-image"]),"icon-rotate":new ba(un.layout_symbol["icon-rotate"]),"icon-padding":new ba(un.layout_symbol["icon-padding"]),"icon-keep-upright":new Da(un.layout_symbol["icon-keep-upright"]),"icon-offset":new ba(un.layout_symbol["icon-offset"]),"icon-anchor":new ba(un.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Da(un.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Da(un.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Da(un.layout_symbol["text-rotation-alignment"]),"text-field":new ba(un.layout_symbol["text-field"]),"text-font":new ba(un.layout_symbol["text-font"]),"text-size":new ba(un.layout_symbol["text-size"]),"text-max-width":new ba(un.layout_symbol["text-max-width"]),"text-line-height":new Da(un.layout_symbol["text-line-height"]),"text-letter-spacing":new ba(un.layout_symbol["text-letter-spacing"]),"text-justify":new ba(un.layout_symbol["text-justify"]),"text-radial-offset":new ba(un.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Da(un.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ba(un.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ba(un.layout_symbol["text-anchor"]),"text-max-angle":new Da(un.layout_symbol["text-max-angle"]),"text-writing-mode":new Da(un.layout_symbol["text-writing-mode"]),"text-rotate":new ba(un.layout_symbol["text-rotate"]),"text-padding":new Da(un.layout_symbol["text-padding"]),"text-keep-upright":new Da(un.layout_symbol["text-keep-upright"]),"text-transform":new ba(un.layout_symbol["text-transform"]),"text-offset":new ba(un.layout_symbol["text-offset"]),"text-allow-overlap":new Da(un.layout_symbol["text-allow-overlap"]),"text-overlap":new Da(un.layout_symbol["text-overlap"]),"text-ignore-placement":new Da(un.layout_symbol["text-ignore-placement"]),"text-optional":new Da(un.layout_symbol["text-optional"])})}};class Zd{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:ea,this.defaultValue=c}evaluate(c){if(c.formattedSection){const b=this.defaultValue.property.overrides;if(b&&b.hasOverride(c.formattedSection))return b.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zi("FormatSectionOverride",Zd,{omit:["defaultValue"]});class pd extends ho{constructor(c){super(c,Rv)}recalculate(c,b){if(super.recalculate(c,b),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const k=this.layout.get("text-writing-mode");if(k){const z=[];for(const V of k)z.indexOf(V)<0&&z.push(V);this.layout._values["text-writing-mode"]=z}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,b,k,z){const V=this.layout.get(c).evaluate(b,{},k,z),W=this._unevaluatedLayout._values[c];return W.isDataDriven()||Eu(W.value)||!V?V:function(ne,he){return he.replace(/{([^{}]+)}/g,(Se,Ne)=>Ne in ne?String(ne[Ne]):"")}(b.properties,V)}createBucket(c){return new rv(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of Rv.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,c))continue;const b=this.paint.get(c),k=new Zd(b),z=new of(k,b.property.specification);let V=null;V=b.value.kind==="constant"||b.value.kind==="source"?new Wp("source",z):new Ph("composite",z,b.value.zoomStops),this.paint._values[c]=new aa(b.property,V,b.parameters)}}_handleOverridablePaintPropertyUpdate(c,b,k){return!(!this.layout||b.isDataDriven()||k.isDataDriven())&&pd.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,b){const k=c.get("text-field"),z=Rv.paint.properties[b];let V=!1;const W=ne=>{for(const he of ne)if(z.overrides&&z.overrides.hasOverride(he))return void(V=!0)};if(k.value.kind==="constant"&&k.value.value instanceof to)W(k.value.value.sections);else if(k.value.kind==="source"){const ne=Se=>{V||(Se instanceof du&&Io(Se.value)===Wt?W(Se.value.sections):Se instanceof _h?W(Se.sections):Se.eachChild(ne))},he=k.value;he._styleExpression&&ne(he._styleExpression.expression)}return V}}let _m;var Jc={get paint(){return _m=_m||new Pu({"background-color":new Da(un.paint_background["background-color"]),"background-pattern":new jl(un.paint_background["background-pattern"]),"background-opacity":new Da(un.paint_background["background-opacity"])})}};class Ii extends ho{constructor(c){super(c,Jc)}}let Ud;var cn={get paint(){return Ud=Ud||new Pu({"raster-opacity":new Da(un.paint_raster["raster-opacity"]),"raster-hue-rotate":new Da(un.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Da(un.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Da(un.paint_raster["raster-brightness-max"]),"raster-saturation":new Da(un.paint_raster["raster-saturation"]),"raster-contrast":new Da(un.paint_raster["raster-contrast"]),"raster-resampling":new Da(un.paint_raster["raster-resampling"]),"raster-fade-duration":new Da(un.paint_raster["raster-fade-duration"])})}};class nv extends ho{constructor(c){super(c,cn)}}class tg extends ho{constructor(c){super(c,{}),this.onAdd=b=>{this.implementation.onAdd&&this.implementation.onAdd(b,b.painter.context.gl)},this.onRemove=b=>{this.implementation.onRemove&&this.implementation.onRemove(b,b.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bv{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const dd=63710088e-1;class jd{constructor(c,b){if(isNaN(c)||isNaN(b))throw new Error(`Invalid LngLat object: (${c}, ${b})`);if(this.lng=+c,this.lat=+b,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jd(gn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const b=Math.PI/180,k=this.lat*b,z=c.lat*b,V=Math.sin(k)*Math.sin(z)+Math.cos(k)*Math.cos(z)*Math.cos((c.lng-this.lng)*b);return dd*Math.acos(Math.min(V,1))}static convert(c){if(c instanceof jd)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new jd(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new jd(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rg=2*Math.PI*dd;function Um(v){return rg*Math.cos(v*Math.PI/180)}function yc(v){return(180+v)/360}function iv(v){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+v*Math.PI/360)))/360}function L(v,c){return v/Um(c)}function i(v){return 360/Math.PI*Math.atan(Math.exp((180-360*v)*Math.PI/180))-90}class s{constructor(c,b,k=0){this.x=+c,this.y=+b,this.z=+k}static fromLngLat(c,b=0){const k=jd.convert(c);return new s(yc(k.lng),iv(k.lat),L(b,k.lat))}toLngLat(){return new jd(360*this.x-180,i(this.y))}toAltitude(){return this.z*Um(i(this.y))}meterInMercatorCoordinateUnits(){return 1/rg*(c=i(this.y),1/Math.cos(c*Math.PI/180));var c}}function l(v,c,b){var k=2*Math.PI*6378137/256/Math.pow(2,b);return[v*k-2*Math.PI*6378137/2,c*k-2*Math.PI*6378137/2]}class p{constructor(c,b,k){if(c<0||c>25||k<0||k>=Math.pow(2,c)||b<0||b>=Math.pow(2,c))throw new Error(`x=${b}, y=${k}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=b,this.y=k,this.key=I(0,c,c,b,k)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,b,k){const z=(W=this.y,ne=this.z,he=l(256*(V=this.x),256*(W=Math.pow(2,ne)-W-1),ne),Se=l(256*(V+1),256*(W+1),ne),he[0]+","+he[1]+","+Se[0]+","+Se[1]);var V,W,ne,he,Se;const Ne=function(We,ht,gt){let St,Ht="";for(let ir=We;ir>0;ir--)St=1<<ir-1,Ht+=(ht&St?1:0)+(gt&St?2:0);return Ht}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(k==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,b>1?"@2x":"").replace(/{quadkey}/g,Ne).replace(/{bbox-epsg-3857}/g,z)}isChildOf(c){const b=this.z-c.z;return b>0&&c.x===this.x>>b&&c.y===this.y>>b}getTilePoint(c){const b=Math.pow(2,this.z);return new le((c.x*b-this.x)*Os,(c.y*b-this.y)*Os)}toString(){return`${this.z}/${this.x}/${this.y}`}}class S{constructor(c,b){this.wrap=c,this.canonical=b,this.key=I(c,b.z,b.z,b.x,b.y)}}class A{constructor(c,b,k,z,V){if(c<k)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${k}`);this.overscaledZ=c,this.wrap=b,this.canonical=new p(k,+z,+V),this.key=I(b,c,k,z,V)}clone(){return new A(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const b=this.canonical.z-c;return c>this.canonical.z?new A(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new A(c,this.wrap,c,this.canonical.x>>b,this.canonical.y>>b)}calculateScaledKey(c,b){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const k=this.canonical.z-c;return c>this.canonical.z?I(this.wrap*+b,c,this.canonical.z,this.canonical.x,this.canonical.y):I(this.wrap*+b,c,c,this.canonical.x>>k,this.canonical.y>>k)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const b=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>b&&c.canonical.y===this.canonical.y>>b}children(c){if(this.overscaledZ>=c)return[new A(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const b=this.canonical.z+1,k=2*this.canonical.x,z=2*this.canonical.y;return[new A(b,this.wrap,b,k,z),new A(b,this.wrap,b,k+1,z),new A(b,this.wrap,b,k,z+1),new A(b,this.wrap,b,k+1,z+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new A(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new A(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new S(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new s(c.x-this.wrap,c.y))}}function I(v,c,b,k,z){(v*=2)<0&&(v=-1*v-1);const V=1<<b;return(V*V*v+V*z+k).toString(36)+b.toString(36)+c.toString(36)}zi("CanonicalTileID",p),zi("OverscaledTileID",A,{omit:["posMatrix"]});class U{constructor(c,b,k,z=1,V=1,W=1,ne=0){if(this.uid=c,b.height!==b.width)throw new RangeError("DEM tiles must be square");if(k&&!["mapbox","terrarium","custom"].includes(k))return void Br(`"${k}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=b.height;const he=this.dim=b.height-2;switch(this.data=new Uint32Array(b.data.buffer),k){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=z,this.greenFactor=V,this.blueFactor=W,this.baseShift=ne;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Se=0;Se<he;Se++)this.data[this._idx(-1,Se)]=this.data[this._idx(0,Se)],this.data[this._idx(he,Se)]=this.data[this._idx(he-1,Se)],this.data[this._idx(Se,-1)]=this.data[this._idx(Se,0)],this.data[this._idx(Se,he)]=this.data[this._idx(Se,he-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(he,-1)]=this.data[this._idx(he-1,0)],this.data[this._idx(-1,he)]=this.data[this._idx(0,he-1)],this.data[this._idx(he,he)]=this.data[this._idx(he-1,he-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Se=0;Se<he;Se++)for(let Ne=0;Ne<he;Ne++){const We=this.get(Se,Ne);We>this.max&&(this.max=We),We<this.min&&(this.min=We)}}get(c,b){const k=new Uint8Array(this.data.buffer),z=4*this._idx(c,b);return this.unpack(k[z],k[z+1],k[z+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,b){if(c<-1||c>=this.dim+1||b<-1||b>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(b+1)*this.stride+(c+1)}unpack(c,b,k){return c*this.redFactor+b*this.greenFactor+k*this.blueFactor-this.baseShift}getPixels(){return new fh({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,b,k){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let z=b*this.dim,V=b*this.dim+this.dim,W=k*this.dim,ne=k*this.dim+this.dim;switch(b){case-1:z=V-1;break;case 1:V=z+1}switch(k){case-1:W=ne-1;break;case 1:ne=W+1}const he=-b*this.dim,Se=-k*this.dim;for(let Ne=W;Ne<ne;Ne++)for(let We=z;We<V;We++)this.data[this._idx(We,Ne)]=c.data[this._idx(We+he,Ne+Se)]}}zi("DEMData",U);class q{constructor(c){this._stringToNumber={},this._numberToString=[];for(let b=0;b<c.length;b++){const k=c[b];this._stringToNumber[k]=b,this._numberToString[b]=k}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class re{constructor(c,b,k,z,V){this.type="Feature",this._vectorTileFeature=c,c._z=b,c._x=k,c._y=z,this.properties=c.properties,this.id=V}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const b in this)b!=="_geometry"&&b!=="_vectorTileFeature"&&(c[b]=this[b]);return c}}class de{constructor(c,b){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new nl(Os,16,0),this.grid3D=new nl(Os,16,0),this.featureIndexArray=new wt,this.promoteId=b}insert(c,b,k,z,V,W){const ne=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(k,z,V);const he=W?this.grid3D:this.grid;for(let Se=0;Se<b.length;Se++){const Ne=b[Se],We=[1/0,1/0,-1/0,-1/0];for(let ht=0;ht<Ne.length;ht++){const gt=Ne[ht];We[0]=Math.min(We[0],gt.x),We[1]=Math.min(We[1],gt.y),We[2]=Math.max(We[2],gt.x),We[3]=Math.max(We[3],gt.y)}We[0]<Os&&We[1]<Os&&We[2]>=0&&We[3]>=0&&he.insert(ne,We[0],We[1],We[2],We[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kp.VectorTile(new ls(this.rawTileData)).layers,this.sourceLayerCoder=new q(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,b,k,z){this.loadVTLayers();const V=c.params||{},W=Os/c.tileSize/c.scale,ne=Hc(V.filter),he=c.queryGeometry,Se=c.queryPadding*W,Ne=Oe(he),We=this.grid.query(Ne.minX-Se,Ne.minY-Se,Ne.maxX+Se,Ne.maxY+Se),ht=Oe(c.cameraQueryGeometry),gt=this.grid3D.query(ht.minX-Se,ht.minY-Se,ht.maxX+Se,ht.maxY+Se,(ir,fr,Gr,Tr)=>function(Jr,wn,ii,da,$a){for(const ra of Jr)if(wn<=ra.x&&ii<=ra.y&&da>=ra.x&&$a>=ra.y)return!0;const fa=[new le(wn,ii),new le(wn,$a),new le(da,$a),new le(da,ii)];if(Jr.length>2){for(const ra of fa)if(Wd(Jr,ra))return!0}for(let ra=0;ra<Jr.length-1;ra++)if(Qm(Jr[ra],Jr[ra+1],fa))return!0;return!1}(c.cameraQueryGeometry,ir-Se,fr-Se,Gr+Se,Tr+Se));for(const ir of gt)We.push(ir);We.sort(Ge);const St={};let Ht;for(let ir=0;ir<We.length;ir++){const fr=We[ir];if(fr===Ht)continue;Ht=fr;const Gr=this.featureIndexArray.get(fr);let Tr=null;this.loadMatchingFeature(St,Gr.bucketIndex,Gr.sourceLayerIndex,Gr.featureIndex,ne,V.layers,V.availableImages,b,k,z,(Jr,wn,ii)=>(Tr||(Tr=Ol(Jr)),wn.queryIntersectsFeature(he,Jr,ii,Tr,this.z,c.transform,W,c.pixelPosMatrix)))}return St}loadMatchingFeature(c,b,k,z,V,W,ne,he,Se,Ne,We){const ht=this.bucketLayerIDs[b];if(W&&!function(ir,fr){for(let Gr=0;Gr<ir.length;Gr++)if(fr.indexOf(ir[Gr])>=0)return!0;return!1}(W,ht))return;const gt=this.sourceLayerCoder.decode(k),St=this.vtLayers[gt].feature(z);if(V.needGeometry){const ir=ml(St,!0);if(!V.filter(new Po(this.tileID.overscaledZ),ir,this.tileID.canonical))return}else if(!V.filter(new Po(this.tileID.overscaledZ),St))return;const Ht=this.getId(St,gt);for(let ir=0;ir<ht.length;ir++){const fr=ht[ir];if(W&&W.indexOf(fr)<0)continue;const Gr=he[fr];if(!Gr)continue;let Tr={};Ht&&Ne&&(Tr=Ne.getState(Gr.sourceLayer||"_geojsonTileLayer",Ht));const Jr=Rr({},Se[fr]);Jr.paint=we(Jr.paint,Gr.paint,St,Tr,ne),Jr.layout=we(Jr.layout,Gr.layout,St,Tr,ne);const wn=!We||We(St,Gr,Tr);if(!wn)continue;const ii=new re(St,this.z,this.x,this.y,Ht);ii.layer=Jr;let da=c[fr];da===void 0&&(da=c[fr]=[]),da.push({featureIndex:z,feature:ii,intersectionZ:wn})}}lookupSymbolFeatures(c,b,k,z,V,W,ne,he){const Se={};this.loadVTLayers();const Ne=Hc(V);for(const We of c)this.loadMatchingFeature(Se,k,z,We,Ne,W,ne,he,b);return Se}hasLayer(c){for(const b of this.bucketLayerIDs)for(const k of b)if(c===k)return!0;return!1}getId(c,b){let k=c.id;return this.promoteId&&(k=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[b]],typeof k=="boolean"&&(k=Number(k))),k}}function we(v,c,b,k,z){return rr(v,(V,W)=>{const ne=c instanceof ta?c.get(W):null;return ne&&ne.evaluate?ne.evaluate(b,k,z):ne})}function Oe(v){let c=1/0,b=1/0,k=-1/0,z=-1/0;for(const V of v)c=Math.min(c,V.x),b=Math.min(b,V.y),k=Math.max(k,V.x),z=Math.max(z,V.y);return{minX:c,minY:b,maxX:k,maxY:z}}function Ge(v,c){return c-v}function it(v,c,b,k,z){const V=[];for(let W=0;W<v.length;W++){const ne=v[W];let he;for(let Se=0;Se<ne.length-1;Se++){let Ne=ne[Se],We=ne[Se+1];Ne.x<c&&We.x<c||(Ne.x<c?Ne=new le(c,Ne.y+(c-Ne.x)/(We.x-Ne.x)*(We.y-Ne.y))._round():We.x<c&&(We=new le(c,Ne.y+(c-Ne.x)/(We.x-Ne.x)*(We.y-Ne.y))._round()),Ne.y<b&&We.y<b||(Ne.y<b?Ne=new le(Ne.x+(b-Ne.y)/(We.y-Ne.y)*(We.x-Ne.x),b)._round():We.y<b&&(We=new le(Ne.x+(b-Ne.y)/(We.y-Ne.y)*(We.x-Ne.x),b)._round()),Ne.x>=k&&We.x>=k||(Ne.x>=k?Ne=new le(k,Ne.y+(k-Ne.x)/(We.x-Ne.x)*(We.y-Ne.y))._round():We.x>=k&&(We=new le(k,Ne.y+(k-Ne.x)/(We.x-Ne.x)*(We.y-Ne.y))._round()),Ne.y>=z&&We.y>=z||(Ne.y>=z?Ne=new le(Ne.x+(z-Ne.y)/(We.y-Ne.y)*(We.x-Ne.x),z)._round():We.y>=z&&(We=new le(Ne.x+(z-Ne.y)/(We.y-Ne.y)*(We.x-Ne.x),z)._round()),he&&Ne.equals(he[he.length-1])||(he=[Ne],V.push(he)),he.push(We)))))}}return V}zi("FeatureIndex",de,{omit:["rawTileData","sourceLayerCoder"]});class tt extends le{constructor(c,b,k,z){super(c,b),this.angle=k,z!==void 0&&(this.segment=z)}clone(){return new tt(this.x,this.y,this.angle,this.segment)}}function ct(v,c,b,k,z){if(c.segment===void 0||b===0)return!0;let V=c,W=c.segment+1,ne=0;for(;ne>-b/2;){if(W--,W<0)return!1;ne-=v[W].dist(V),V=v[W]}ne+=v[W].dist(v[W+1]),W++;const he=[];let Se=0;for(;ne<b/2;){const Ne=v[W],We=v[W+1];if(!We)return!1;let ht=v[W-1].angleTo(Ne)-Ne.angleTo(We);for(ht=Math.abs((ht+3*Math.PI)%(2*Math.PI)-Math.PI),he.push({distance:ne,angleDelta:ht}),Se+=ht;ne-he[0].distance>k;)Se-=he.shift().angleDelta;if(Se>z)return!1;W++,ne+=Ne.dist(We)}return!0}function ut(v){let c=0;for(let b=0;b<v.length-1;b++)c+=v[b].dist(v[b+1]);return c}function Je(v,c,b){return v?.6*c*b:0}function Pt(v,c){return Math.max(v?v.right-v.left:0,c?c.right-c.left:0)}function Xt(v,c,b,k,z,V){const W=Je(b,z,V),ne=Pt(b,k)*V;let he=0;const Se=ut(v)/2;for(let Ne=0;Ne<v.length-1;Ne++){const We=v[Ne],ht=v[Ne+1],gt=We.dist(ht);if(he+gt>Se){const St=(Se-he)/gt,Ht=Yu.number(We.x,ht.x,St),ir=Yu.number(We.y,ht.y,St),fr=new tt(Ht,ir,ht.angleTo(We),Ne);return fr._round(),!W||ct(v,fr,ne,W,c)?fr:void 0}he+=gt}}function pr(v,c,b,k,z,V,W,ne,he){const Se=Je(k,V,W),Ne=Pt(k,z),We=Ne*W,ht=v[0].x===0||v[0].x===he||v[0].y===0||v[0].y===he;return c-We<c/4&&(c=We+c/4),Ur(v,ht?c/2*ne%c:(Ne/2+2*V)*W*ne%c,c,Se,b,We,ht,!1,he)}function Ur(v,c,b,k,z,V,W,ne,he){const Se=V/2,Ne=ut(v);let We=0,ht=c-b,gt=[];for(let St=0;St<v.length-1;St++){const Ht=v[St],ir=v[St+1],fr=Ht.dist(ir),Gr=ir.angleTo(Ht);for(;ht+b<We+fr;){ht+=b;const Tr=(ht-We)/fr,Jr=Yu.number(Ht.x,ir.x,Tr),wn=Yu.number(Ht.y,ir.y,Tr);if(Jr>=0&&Jr<he&&wn>=0&&wn<he&&ht-Se>=0&&ht+Se<=Ne){const ii=new tt(Jr,wn,Gr,St);ii._round(),k&&!ct(v,ii,V,k,z)||gt.push(ii)}}We+=fr}return ne||gt.length||W||(gt=Ur(v,We/2,b,k,z,V,W,!0,he)),gt}zi("Anchor",tt);const tn=ur;function An(v,c,b,k){const z=[],V=v.image,W=V.pixelRatio,ne=V.paddedRect.w-2*tn,he=V.paddedRect.h-2*tn,Se=v.right-v.left,Ne=v.bottom-v.top,We=V.stretchX||[[0,ne]],ht=V.stretchY||[[0,he]],gt=(Xi,ga)=>Xi+ga[1]-ga[0],St=We.reduce(gt,0),Ht=ht.reduce(gt,0),ir=ne-St,fr=he-Ht;let Gr=0,Tr=St,Jr=0,wn=Ht,ii=0,da=ir,$a=0,fa=fr;if(V.content&&k){const Xi=V.content;Gr=xi(We,0,Xi[0]),Jr=xi(ht,0,Xi[1]),Tr=xi(We,Xi[0],Xi[2]),wn=xi(ht,Xi[1],Xi[3]),ii=Xi[0]-Gr,$a=Xi[1]-Jr,da=Xi[2]-Xi[0]-Tr,fa=Xi[3]-Xi[1]-wn}const ra=(Xi,ga,qi,Ei)=>{const Wa=si(Xi.stretch-Gr,Tr,Se,v.left),Ta=kn(Xi.fixed-ii,da,Xi.stretch,St),gs=si(ga.stretch-Jr,wn,Ne,v.top),gl=kn(ga.fixed-$a,fa,ga.stretch,Ht),Sl=si(qi.stretch-Gr,Tr,Se,v.left),zc=kn(qi.fixed-ii,da,qi.stretch,St),Dp=si(Ei.stretch-Jr,wn,Ne,v.top),Op=kn(Ei.fixed-$a,fa,Ei.stretch,Ht),dh=new le(Wa,gs),Jh=new le(Sl,gs),Nh=new le(Sl,Dp),vh=new le(Wa,Dp),nc=new le(Ta/W,gl/W),Us=new le(zc/W,Op/W),zs=c*Math.PI/180;if(zs){const Bf=Math.sin(zs),zp=Math.cos(zs),np=[zp,-Bf,Bf,zp];dh._matMult(np),Jh._matMult(np),vh._matMult(np),Nh._matMult(np)}const Fp=Xi.stretch+Xi.fixed,Zh=ga.stretch+ga.fixed;return{tl:dh,tr:Jh,bl:vh,br:Nh,tex:{x:V.paddedRect.x+tn+Fp,y:V.paddedRect.y+tn+Zh,w:qi.stretch+qi.fixed-Fp,h:Ei.stretch+Ei.fixed-Zh},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:nc,pixelOffsetBR:Us,minFontScaleX:da/W/Se,minFontScaleY:fa/W/Ne,isSDF:b}};if(k&&(V.stretchX||V.stretchY)){const Xi=On(We,ir,St),ga=On(ht,fr,Ht);for(let qi=0;qi<Xi.length-1;qi++){const Ei=Xi[qi],Wa=Xi[qi+1];for(let Ta=0;Ta<ga.length-1;Ta++)z.push(ra(Ei,ga[Ta],Wa,ga[Ta+1]))}}else z.push(ra({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ne+1},{fixed:0,stretch:he+1}));return z}function xi(v,c,b){let k=0;for(const z of v)k+=Math.max(c,Math.min(b,z[1]))-Math.max(c,Math.min(b,z[0]));return k}function On(v,c,b){const k=[{fixed:-tn,stretch:0}];for(const[z,V]of v){const W=k[k.length-1];k.push({fixed:z-W.stretch,stretch:W.stretch}),k.push({fixed:z-W.stretch,stretch:W.stretch+(V-z)})}return k.push({fixed:c+tn,stretch:b}),k}function si(v,c,b,k){return v/c*b+k}function kn(v,c,b,k){return v-c*b/k}class ci{constructor(c,b,k,z,V,W,ne,he,Se,Ne){if(this.boxStartIndex=c.length,Se){let We=W.top,ht=W.bottom;const gt=W.collisionPadding;gt&&(We-=gt[1],ht+=gt[3]);let St=ht-We;St>0&&(St=Math.max(10,St),this.circleDiameter=St)}else{let We=W.top*ne-he[0],ht=W.bottom*ne+he[2],gt=W.left*ne-he[3],St=W.right*ne+he[1];const Ht=W.collisionPadding;if(Ht&&(gt-=Ht[0]*ne,We-=Ht[1]*ne,St+=Ht[2]*ne,ht+=Ht[3]*ne),Ne){const ir=new le(gt,We),fr=new le(St,We),Gr=new le(gt,ht),Tr=new le(St,ht),Jr=Ne*Math.PI/180;ir._rotate(Jr),fr._rotate(Jr),Gr._rotate(Jr),Tr._rotate(Jr),gt=Math.min(ir.x,fr.x,Gr.x,Tr.x),St=Math.max(ir.x,fr.x,Gr.x,Tr.x),We=Math.min(ir.y,fr.y,Gr.y,Tr.y),ht=Math.max(ir.y,fr.y,Gr.y,Tr.y)}c.emplaceBack(b.x,b.y,gt,We,St,ht,k,z,V)}this.boxEndIndex=c.length}}class wi{constructor(c=[],b=$n){if(this.data=c,this.length=this.data.length,this.compare=b,this.length>0)for(let k=(this.length>>1)-1;k>=0;k--)this._down(k)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],b=this.data.pop();return this.length--,this.length>0&&(this.data[0]=b,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:b,compare:k}=this,z=b[c];for(;c>0;){const V=c-1>>1,W=b[V];if(k(z,W)>=0)break;b[c]=W,c=V}b[c]=z}_down(c){const{data:b,compare:k}=this,z=this.length>>1,V=b[c];for(;c<z;){let W=1+(c<<1),ne=b[W];const he=W+1;if(he<this.length&&k(b[he],ne)<0&&(W=he,ne=b[he]),k(ne,V)>=0)break;b[c]=ne,c=W}b[c]=V}}function $n(v,c){return v<c?-1:v>c?1:0}function Si(v,c=1,b=!1){let k=1/0,z=1/0,V=-1/0,W=-1/0;const ne=v[0];for(let gt=0;gt<ne.length;gt++){const St=ne[gt];(!gt||St.x<k)&&(k=St.x),(!gt||St.y<z)&&(z=St.y),(!gt||St.x>V)&&(V=St.x),(!gt||St.y>W)&&(W=St.y)}const he=Math.min(V-k,W-z);let Se=he/2;const Ne=new wi([],Kn);if(he===0)return new le(k,z);for(let gt=k;gt<V;gt+=he)for(let St=z;St<W;St+=he)Ne.push(new la(gt+Se,St+Se,Se,v));let We=function(gt){let St=0,Ht=0,ir=0;const fr=gt[0];for(let Gr=0,Tr=fr.length,Jr=Tr-1;Gr<Tr;Jr=Gr++){const wn=fr[Gr],ii=fr[Jr],da=wn.x*ii.y-ii.x*wn.y;Ht+=(wn.x+ii.x)*da,ir+=(wn.y+ii.y)*da,St+=3*da}return new la(Ht/St,ir/St,0,gt)}(v),ht=Ne.length;for(;Ne.length;){const gt=Ne.pop();(gt.d>We.d||!We.d)&&(We=gt,b&&console.log("found best %d after %d probes",Math.round(1e4*gt.d)/1e4,ht)),gt.max-We.d<=c||(Se=gt.h/2,Ne.push(new la(gt.p.x-Se,gt.p.y-Se,Se,v)),Ne.push(new la(gt.p.x+Se,gt.p.y-Se,Se,v)),Ne.push(new la(gt.p.x-Se,gt.p.y+Se,Se,v)),Ne.push(new la(gt.p.x+Se,gt.p.y+Se,Se,v)),ht+=4)}return b&&(console.log(`num probes: ${ht}`),console.log(`best distance: ${We.d}`)),We.p}function Kn(v,c){return c.max-v.max}function la(v,c,b,k){this.p=new le(v,c),this.h=b,this.d=function(z,V){let W=!1,ne=1/0;for(let he=0;he<V.length;he++){const Se=V[he];for(let Ne=0,We=Se.length,ht=We-1;Ne<We;ht=Ne++){const gt=Se[Ne],St=Se[ht];gt.y>z.y!=St.y>z.y&&z.x<(St.x-gt.x)*(z.y-gt.y)/(St.y-gt.y)+gt.x&&(W=!W),ne=Math.min(ne,Ip(z,gt,St))}}return(W?1:-1)*Math.sqrt(ne)}(this.p,k),this.max=this.d+this.h*Math.SQRT2}var yn;M.aq=void 0,(yn=M.aq||(M.aq={}))[yn.center=1]="center",yn[yn.left=2]="left",yn[yn.right=3]="right",yn[yn.top=4]="top",yn[yn.bottom=5]="bottom",yn[yn["top-left"]=6]="top-left",yn[yn["top-right"]=7]="top-right",yn[yn["bottom-left"]=8]="bottom-left",yn[yn["bottom-right"]=9]="bottom-right";const Ti=7,Aa=Number.POSITIVE_INFINITY;function $o(v,c){return c[1]!==Aa?function(b,k,z){let V=0,W=0;switch(k=Math.abs(k),z=Math.abs(z),b){case"top-right":case"top-left":case"top":W=z-Ti;break;case"bottom-right":case"bottom-left":case"bottom":W=-z+Ti}switch(b){case"top-right":case"bottom-right":case"right":V=-k;break;case"top-left":case"bottom-left":case"left":V=k}return[V,W]}(v,c[0],c[1]):function(b,k){let z=0,V=0;k<0&&(k=0);const W=k/Math.SQRT2;switch(b){case"top-right":case"top-left":V=W-Ti;break;case"bottom-right":case"bottom-left":V=-W+Ti;break;case"bottom":V=-k+Ti;break;case"top":V=k-Ti}switch(b){case"top-right":case"bottom-right":z=-W;break;case"top-left":case"bottom-left":z=W;break;case"left":z=k;break;case"right":z=-k}return[z,V]}(v,c[0])}function lo(v,c,b){var k;const z=v.layout,V=(k=z.get("text-variable-anchor-offset"))===null||k===void 0?void 0:k.evaluate(c,{},b);if(V){const ne=V.values,he=[];for(let Se=0;Se<ne.length;Se+=2){const Ne=he[Se]=ne[Se],We=ne[Se+1].map(ht=>ht*ks);Ne.startsWith("top")?We[1]-=Ti:Ne.startsWith("bottom")&&(We[1]+=Ti),he[Se+1]=We}return new ws(he)}const W=z.get("text-variable-anchor");if(W){let ne;ne=v._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[z.get("text-radial-offset").evaluate(c,{},b)*ks,Aa]:z.get("text-offset").evaluate(c,{},b).map(Se=>Se*ks);const he=[];for(const Se of W)he.push(Se,$o(Se,ne));return new ws(he)}return null}function Oo(v){switch(v){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function So(v,c,b,k,z,V,W,ne,he,Se,Ne){let We=V.textMaxSize.evaluate(c,{});We===void 0&&(We=W);const ht=v.layers[0].layout,gt=ht.get("icon-offset").evaluate(c,{},Ne),St=Wo(b.horizontal),Ht=W/24,ir=v.tilePixelRatio*Ht,fr=v.tilePixelRatio*We/24,Gr=v.tilePixelRatio*ne,Tr=v.tilePixelRatio*ht.get("symbol-spacing"),Jr=ht.get("text-padding")*v.tilePixelRatio,wn=function(Ei,Wa,Ta,gs=1){const gl=Ei.get("icon-padding").evaluate(Wa,{},Ta),Sl=gl&&gl.values;return[Sl[0]*gs,Sl[1]*gs,Sl[2]*gs,Sl[3]*gs]}(ht,c,Ne,v.tilePixelRatio),ii=ht.get("text-max-angle")/180*Math.PI,da=ht.get("text-rotation-alignment")!=="viewport"&&ht.get("symbol-placement")!=="point",$a=ht.get("icon-rotation-alignment")==="map"&&ht.get("symbol-placement")!=="point",fa=ht.get("symbol-placement"),ra=Tr/2,Xi=ht.get("icon-text-fit");let ga;k&&Xi!=="none"&&(v.allowVerticalPlacement&&b.vertical&&(ga=Iv(k,b.vertical,Xi,ht.get("icon-text-fit-padding"),gt,Ht)),St&&(k=Iv(k,St,Xi,ht.get("icon-text-fit-padding"),gt,Ht)));const qi=(Ei,Wa)=>{Wa.x<0||Wa.x>=Os||Wa.y<0||Wa.y>=Os||function(Ta,gs,gl,Sl,zc,Dp,Op,dh,Jh,Nh,vh,nc,Us,zs,Fp,Zh,Bf,zp,np,ic,yu,xf,yo,ro,Bp){const av=Ta.addToLineVertexArray(gs,gl);let Np,qv,ov,Md,vd=0,Kv=0,Ep=0,xg=0,y0=-1,xv=-1;const Cp={};let W0=Tl("");if(Ta.allowVerticalPlacement&&Sl.vertical){const Zp=dh.layout.get("text-rotate").evaluate(yu,{},ro)+90;ov=new ci(Jh,gs,Nh,vh,nc,Sl.vertical,Us,zs,Fp,Zp),Op&&(Md=new ci(Jh,gs,Nh,vh,nc,Op,Bf,zp,Fp,Zp))}if(zc){const Zp=dh.layout.get("icon-rotate").evaluate(yu,{}),md=dh.layout.get("icon-text-fit")!=="none",Qv=An(zc,Zp,yo,md),Sv=Op?An(Op,Zp,yo,md):void 0;qv=new ci(Jh,gs,Nh,vh,nc,zc,Bf,zp,!1,Zp),vd=4*Qv.length;const xm=Ta.iconSizeData;let Dv=null;xm.kind==="source"?(Dv=[Rp*dh.layout.get("icon-size").evaluate(yu,{})],Dv[0]>ph&&Br(`${Ta.layerIds[0]}: Value for "icon-size" is >= ${Bh}. Reduce your "icon-size".`)):xm.kind==="composite"&&(Dv=[Rp*xf.compositeIconSizes[0].evaluate(yu,{},ro),Rp*xf.compositeIconSizes[1].evaluate(yu,{},ro)],(Dv[0]>ph||Dv[1]>ph)&&Br(`${Ta.layerIds[0]}: Value for "icon-size" is >= ${Bh}. Reduce your "icon-size".`)),Ta.addSymbols(Ta.icon,Qv,Dv,ic,np,yu,M.ai.none,gs,av.lineStartIndex,av.lineLength,-1,ro),y0=Ta.icon.placedSymbolArray.length-1,Sv&&(Kv=4*Sv.length,Ta.addSymbols(Ta.icon,Sv,Dv,ic,np,yu,M.ai.vertical,gs,av.lineStartIndex,av.lineLength,-1,ro),xv=Ta.icon.placedSymbolArray.length-1)}const bm=Object.keys(Sl.horizontal);for(const Zp of bm){const md=Sl.horizontal[Zp];if(!Np){W0=Tl(md.text);const Sv=dh.layout.get("text-rotate").evaluate(yu,{},ro);Np=new ci(Jh,gs,Nh,vh,nc,md,Us,zs,Fp,Sv)}const Qv=md.positionedLines.length===1;if(Ep+=cs(Ta,gs,md,Dp,dh,Fp,yu,Zh,av,Sl.vertical?M.ai.horizontal:M.ai.horizontalOnly,Qv?bm:[Zp],Cp,y0,xf,ro),Qv)break}Sl.vertical&&(xg+=cs(Ta,gs,Sl.vertical,Dp,dh,Fp,yu,Zh,av,M.ai.vertical,["vertical"],Cp,xv,xf,ro));const wg=Np?Np.boxStartIndex:Ta.collisionBoxArray.length,Sg=Np?Np.boxEndIndex:Ta.collisionBoxArray.length,Eg=ov?ov.boxStartIndex:Ta.collisionBoxArray.length,Cg=ov?ov.boxEndIndex:Ta.collisionBoxArray.length,Xy=qv?qv.boxStartIndex:Ta.collisionBoxArray.length,X0=qv?qv.boxEndIndex:Ta.collisionBoxArray.length,Yy=Md?Md.boxStartIndex:Ta.collisionBoxArray.length,qy=Md?Md.boxEndIndex:Ta.collisionBoxArray.length;let sv=-1;const Ag=(Zp,md)=>Zp&&Zp.circleDiameter?Math.max(Zp.circleDiameter,md):md;sv=Ag(Np,sv),sv=Ag(ov,sv),sv=Ag(qv,sv),sv=Ag(Md,sv);const wv=sv>-1?1:0;wv&&(sv*=Bp/ks),Ta.glyphOffsetArray.length>=rv.MAX_GLYPHS&&Br("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yu.sortKey!==void 0&&Ta.addToSortKeyRanges(Ta.symbolInstances.length,yu.sortKey);const Ky=lo(dh,yu,ro),[Jv,Y0]=function(Zp,md){const Qv=Zp.length,Sv=md==null?void 0:md.values;if((Sv==null?void 0:Sv.length)>0)for(let xm=0;xm<Sv.length;xm+=2){const Dv=Sv[xm+1];Zp.emplaceBack(M.aq[Sv[xm]],Dv[0],Dv[1])}return[Qv,Zp.length]}(Ta.textAnchorOffsets,Ky);Ta.symbolInstances.emplaceBack(gs.x,gs.y,Cp.right>=0?Cp.right:-1,Cp.center>=0?Cp.center:-1,Cp.left>=0?Cp.left:-1,Cp.vertical||-1,y0,xv,W0,wg,Sg,Eg,Cg,Xy,X0,Yy,qy,Nh,Ep,xg,vd,Kv,wv,0,Us,sv,Jv,Y0)}(v,Wa,Ei,b,k,z,ga,v.layers[0],v.collisionBoxArray,c.index,c.sourceLayerIndex,v.index,ir,[Jr,Jr,Jr,Jr],da,he,Gr,wn,$a,gt,c,V,Se,Ne,W)};if(fa==="line")for(const Ei of it(c.geometry,0,0,Os,Os)){const Wa=pr(Ei,Tr,ii,b.vertical||St,k,24,fr,v.overscaling,Os);for(const Ta of Wa)St&&Bo(v,St.text,ra,Ta)||qi(Ei,Ta)}else if(fa==="line-center"){for(const Ei of c.geometry)if(Ei.length>1){const Wa=Xt(Ei,ii,b.vertical||St,k,24,fr);Wa&&qi(Ei,Wa)}}else if(c.type==="Polygon")for(const Ei of _f(c.geometry,0)){const Wa=Si(Ei,16);qi(Ei[0],new tt(Wa.x,Wa.y,0))}else if(c.type==="LineString")for(const Ei of c.geometry)qi(Ei,new tt(Ei[0].x,Ei[0].y,0));else if(c.type==="Point")for(const Ei of c.geometry)for(const Wa of Ei)qi([Wa],new tt(Wa.x,Wa.y,0))}function cs(v,c,b,k,z,V,W,ne,he,Se,Ne,We,ht,gt,St){const Ht=function(Gr,Tr,Jr,wn,ii,da,$a,fa){const ra=wn.layout.get("text-rotate").evaluate(da,{})*Math.PI/180,Xi=[];for(const ga of Tr.positionedLines)for(const qi of ga.positionedGlyphs){if(!qi.rect)continue;const Ei=qi.rect||{};let Wa=$r+1,Ta=!0,gs=1,gl=0;const Sl=(ii||fa)&&qi.vertical,zc=qi.metrics.advance*qi.scale/2;if(fa&&Tr.verticalizable&&(gl=ga.lineOffset/2-(qi.imageName?-(ks-qi.metrics.width*qi.scale)/2:(qi.scale-1)*ks)),qi.imageName){const ic=$a[qi.imageName];Ta=ic.sdf,gs=ic.pixelRatio,Wa=ur/gs}const Dp=ii?[qi.x+zc,qi.y]:[0,0];let Op=ii?[0,0]:[qi.x+zc+Jr[0],qi.y+Jr[1]-gl],dh=[0,0];Sl&&(dh=Op,Op=[0,0]);const Jh=qi.metrics.isDoubleResolution?2:1,Nh=(qi.metrics.left-Wa)*qi.scale-zc+Op[0],vh=(-qi.metrics.top-Wa)*qi.scale+Op[1],nc=Nh+Ei.w/Jh*qi.scale/gs,Us=vh+Ei.h/Jh*qi.scale/gs,zs=new le(Nh,vh),Fp=new le(nc,vh),Zh=new le(Nh,Us),Bf=new le(nc,Us);if(Sl){const ic=new le(-zc,zc-It),yu=-Math.PI/2,xf=ks/2-zc,yo=new le(5-It-xf,-(qi.imageName?xf:0)),ro=new le(...dh);zs._rotateAround(yu,ic)._add(yo)._add(ro),Fp._rotateAround(yu,ic)._add(yo)._add(ro),Zh._rotateAround(yu,ic)._add(yo)._add(ro),Bf._rotateAround(yu,ic)._add(yo)._add(ro)}if(ra){const ic=Math.sin(ra),yu=Math.cos(ra),xf=[yu,-ic,ic,yu];zs._matMult(xf),Fp._matMult(xf),Zh._matMult(xf),Bf._matMult(xf)}const zp=new le(0,0),np=new le(0,0);Xi.push({tl:zs,tr:Fp,bl:Zh,br:Bf,tex:Ei,writingMode:Tr.writingMode,glyphOffset:Dp,sectionIndex:qi.sectionIndex,isSDF:Ta,pixelOffsetTL:zp,pixelOffsetBR:np,minFontScaleX:0,minFontScaleY:0})}return Xi}(0,b,ne,z,V,W,k,v.allowVerticalPlacement),ir=v.textSizeData;let fr=null;ir.kind==="source"?(fr=[Rp*z.layout.get("text-size").evaluate(W,{})],fr[0]>ph&&Br(`${v.layerIds[0]}: Value for "text-size" is >= ${Bh}. Reduce your "text-size".`)):ir.kind==="composite"&&(fr=[Rp*gt.compositeTextSizes[0].evaluate(W,{},St),Rp*gt.compositeTextSizes[1].evaluate(W,{},St)],(fr[0]>ph||fr[1]>ph)&&Br(`${v.layerIds[0]}: Value for "text-size" is >= ${Bh}. Reduce your "text-size".`)),v.addSymbols(v.text,Ht,fr,ne,V,W,Se,c,he.lineStartIndex,he.lineLength,ht,St);for(const Gr of Ne)We[Gr]=v.text.placedSymbolArray.length-1;return 4*Ht.length}function Wo(v){for(const c in v)return v[c];return null}function Bo(v,c,b,k){const z=v.compareText;if(c in z){const V=z[c];for(let W=V.length-1;W>=0;W--)if(k.dist(V[W])<b)return!0}else z[c]=[];return z[c].push(k),!1}const Xo=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Au{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[b,k]=new Uint8Array(c,0,2);if(b!==219)throw new Error("Data does not appear to be in a KDBush format.");const z=k>>4;if(z!==1)throw new Error(`Got v${z} data when expected v1.`);const V=Xo[15&k];if(!V)throw new Error("Unrecognized array type.");const[W]=new Uint16Array(c,2,1),[ne]=new Uint32Array(c,4,1);return new Au(ne,W,V,c)}constructor(c,b=64,k=Float64Array,z){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+b,2),65535),this.ArrayType=k,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const V=Xo.indexOf(this.ArrayType),W=2*c*this.ArrayType.BYTES_PER_ELEMENT,ne=c*this.IndexArrayType.BYTES_PER_ELEMENT,he=(8-ne%8)%8;if(V<0)throw new Error(`Unexpected typed array class: ${k}.`);z&&z instanceof ArrayBuffer?(this.data=z,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+ne+he,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+W+ne+he),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+ne+he,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+V]),new Uint16Array(this.data,2,1)[0]=b,new Uint32Array(this.data,4,1)[0]=c)}add(c,b){const k=this._pos>>1;return this.ids[k]=k,this.coords[this._pos++]=c,this.coords[this._pos++]=b,k}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return Wi(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,b,k,z){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:V,coords:W,nodeSize:ne}=this,he=[0,V.length-1,0],Se=[];for(;he.length;){const Ne=he.pop()||0,We=he.pop()||0,ht=he.pop()||0;if(We-ht<=ne){for(let ir=ht;ir<=We;ir++){const fr=W[2*ir],Gr=W[2*ir+1];fr>=c&&fr<=k&&Gr>=b&&Gr<=z&&Se.push(V[ir])}continue}const gt=ht+We>>1,St=W[2*gt],Ht=W[2*gt+1];St>=c&&St<=k&&Ht>=b&&Ht<=z&&Se.push(V[gt]),(Ne===0?c<=St:b<=Ht)&&(he.push(ht),he.push(gt-1),he.push(1-Ne)),(Ne===0?k>=St:z>=Ht)&&(he.push(gt+1),he.push(We),he.push(1-Ne))}return Se}within(c,b,k){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:z,coords:V,nodeSize:W}=this,ne=[0,z.length-1,0],he=[],Se=k*k;for(;ne.length;){const Ne=ne.pop()||0,We=ne.pop()||0,ht=ne.pop()||0;if(We-ht<=W){for(let ir=ht;ir<=We;ir++)ms(V[2*ir],V[2*ir+1],c,b)<=Se&&he.push(z[ir]);continue}const gt=ht+We>>1,St=V[2*gt],Ht=V[2*gt+1];ms(St,Ht,c,b)<=Se&&he.push(z[gt]),(Ne===0?c-k<=St:b-k<=Ht)&&(ne.push(ht),ne.push(gt-1),ne.push(1-Ne)),(Ne===0?c+k>=St:b+k>=Ht)&&(ne.push(gt+1),ne.push(We),ne.push(1-Ne))}return he}}function Wi(v,c,b,k,z,V){if(z-k<=b)return;const W=k+z>>1;hs(v,c,W,k,z,V),Wi(v,c,b,k,W-1,1-V),Wi(v,c,b,W+1,z,1-V)}function hs(v,c,b,k,z,V){for(;z>k;){if(z-k>600){const Se=z-k+1,Ne=b-k+1,We=Math.log(Se),ht=.5*Math.exp(2*We/3),gt=.5*Math.sqrt(We*ht*(Se-ht)/Se)*(Ne-Se/2<0?-1:1);hs(v,c,b,Math.max(k,Math.floor(b-Ne*ht/Se+gt)),Math.min(z,Math.floor(b+(Se-Ne)*ht/Se+gt)),V)}const W=c[2*b+V];let ne=k,he=z;for(Ba(v,c,k,b),c[2*z+V]>W&&Ba(v,c,k,z);ne<he;){for(Ba(v,c,ne,he),ne++,he--;c[2*ne+V]<W;)ne++;for(;c[2*he+V]>W;)he--}c[2*k+V]===W?Ba(v,c,k,he):(he++,Ba(v,c,he,z)),he<=b&&(k=he+1),b<=he&&(z=he-1)}}function Ba(v,c,b,k){bs(v,b,k),bs(c,2*b,2*k),bs(c,2*b+1,2*k+1)}function bs(v,c,b){const k=v[c];v[c]=v[b],v[b]=k}function ms(v,c,b,k){const z=v-b,V=c-k;return z*z+V*V}var Eo;M.bg=void 0,(Eo=M.bg||(M.bg={})).create="create",Eo.load="load",Eo.fullLoad="fullLoad";let gu=null,fs=[];const Cn=1e3/60,Ma="loadTime",go="fullLoadTime",Na={mark(v){performance.mark(v)},frame(v){const c=v;gu!=null&&fs.push(c-gu),gu=c},clearMetrics(){gu=null,fs=[],performance.clearMeasures(Ma),performance.clearMeasures(go);for(const v in M.bg)performance.clearMarks(M.bg[v])},getPerformanceMetrics(){performance.measure(Ma,M.bg.create,M.bg.load),performance.measure(go,M.bg.create,M.bg.fullLoad);const v=performance.getEntriesByName(Ma)[0].duration,c=performance.getEntriesByName(go)[0].duration,b=fs.length,k=1/(fs.reduce((V,W)=>V+W,0)/b/1e3),z=fs.filter(V=>V>Cn).reduce((V,W)=>V+(W-Cn)/Cn,0);return{loadTime:v,fullLoadTime:c,fps:k,percentDroppedFrames:z/(b+z)*100,totalFrames:b}}};M.$=function(v,c,b){var k,z,V,W,ne,he,Se,Ne,We,ht,gt,St,Ht=b[0],ir=b[1],fr=b[2];return c===v?(v[12]=c[0]*Ht+c[4]*ir+c[8]*fr+c[12],v[13]=c[1]*Ht+c[5]*ir+c[9]*fr+c[13],v[14]=c[2]*Ht+c[6]*ir+c[10]*fr+c[14],v[15]=c[3]*Ht+c[7]*ir+c[11]*fr+c[15]):(z=c[1],V=c[2],W=c[3],ne=c[4],he=c[5],Se=c[6],Ne=c[7],We=c[8],ht=c[9],gt=c[10],St=c[11],v[0]=k=c[0],v[1]=z,v[2]=V,v[3]=W,v[4]=ne,v[5]=he,v[6]=Se,v[7]=Ne,v[8]=We,v[9]=ht,v[10]=gt,v[11]=St,v[12]=k*Ht+ne*ir+We*fr+c[12],v[13]=z*Ht+he*ir+ht*fr+c[13],v[14]=V*Ht+Se*ir+gt*fr+c[14],v[15]=W*Ht+Ne*ir+St*fr+c[15]),v},M.A=dv,M.B=Yu,M.C=class{constructor(v,c,b){this.receive=k=>{const z=k.data,V=z.id;if(V&&(!z.targetMapId||this.mapId===z.targetMapId))if(z.type==="<cancel>"){delete this.tasks[V];const W=this.cancelCallbacks[V];delete this.cancelCallbacks[V],W&&W()}else Dt()||z.mustQueue?(this.tasks[V]=z,this.taskQueue.push(V),this.invoker.trigger()):this.processTask(V,z)},this.process=()=>{if(!this.taskQueue.length)return;const k=this.taskQueue.shift(),z=this.tasks[k];delete this.tasks[k],this.taskQueue.length&&this.invoker.trigger(),z&&this.processTask(k,z)},this.target=v,this.parent=c,this.mapId=b,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new bv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Dt()?v:window}send(v,c,b,k,z=!1){const V=Math.round(1e18*Math.random()).toString(36).substring(0,10);b&&(this.callbacks[V]=b);const W=[],ne={id:V,type:v,hasCallback:!!b,targetMapId:k,mustQueue:z,sourceMapId:this.mapId,data:Gu(c,W)};return this.target.postMessage(ne,{transfer:W}),{cancel:()=>{b&&delete this.callbacks[V],this.target.postMessage({id:V,type:"<cancel>",targetMapId:k,sourceMapId:this.mapId})}}}processTask(v,c){if(c.type==="<response>"){const b=this.callbacks[v];delete this.callbacks[v],b&&(c.error?b($h(c.error)):b(null,$h(c.data)))}else{let b=!1;const k=[],z=c.hasCallback?(ne,he)=>{b=!0,delete this.cancelCallbacks[v];const Se={id:v,type:"<response>",sourceMapId:this.mapId,error:ne?Gu(ne):null,data:Gu(he,k)};this.target.postMessage(Se,{transfer:k})}:ne=>{b=!0};let V=null;const W=$h(c.data);if(this.parent[c.type])V=this.parent[c.type](c.sourceMapId,W,z);else if("getWorkerSource"in this.parent){const ne=c.type.split(".");V=this.parent.getWorkerSource(c.sourceMapId,ne[0],W.source)[ne[1]](W,z)}else z(new Error(`Could not find function ${c.type}`));!b&&V&&V.cancel&&(this.cancelCallbacks[v]=V.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},M.D=Da,M.E=Fo,M.F=function(v,c){const b={};for(let k=0;k<c.length;k++){const z=c[k];z in v&&(b[z]=v[z])}return b},M.G=yc,M.H=iv,M.I=Lr,M.J=jt,M.K=Vt,M.L=jd,M.M=Pr,M.N=Os,M.O=A,M.P=le,M.Q=il,M.R=fh,M.S=oa,M.T=Pf,M.U=s,M.V=class extends Rc{},M.W=p,M.X=function(v,c){const b=window.document.createElement("video");b.muted=!0,b.onloadstart=function(){c(null,b)};for(let k=0;k<v.length;k++){const z=window.document.createElement("source");qo(v[k])||(b.crossOrigin="Anonymous"),z.src=v[k],b.appendChild(z)}return{cancel:()=>{}}},M.Y=dr,M.Z=function(){var v=new dv(16);return dv!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},M._=ee,M.a=Bt,M.a$=class extends _{},M.a0=function(v,c,b){var k=b[0],z=b[1],V=b[2];return v[0]=c[0]*k,v[1]=c[1]*k,v[2]=c[2]*k,v[3]=c[3]*k,v[4]=c[4]*z,v[5]=c[5]*z,v[6]=c[6]*z,v[7]=c[7]*z,v[8]=c[8]*V,v[9]=c[9]*V,v[10]=c[10]*V,v[11]=c[11]*V,v[12]=c[12],v[13]=c[13],v[14]=c[14],v[15]=c[15],v},M.a1=Xd,M.a2=function(){return vn++},M.a3=$,M.a4=rv,M.a5=function(){Dl.isLoading()||Dl.isLoaded()||_l()!=="deferred"||xo()},M.a6=Hc,M.a7=ml,M.a8=Po,M.a9=re,M.aA=Mf,M.aB=function(v){v=v.slice();const c=Object.create(null);for(let b=0;b<v.length;b++)c[v[b].id]=v[b];for(let b=0;b<v.length;b++)"ref"in v[b]&&(v[b]=zr(v[b],c[v[b].ref]));return v},M.aC=function(v){if(v.type==="custom")return new tg(v);switch(v.type){case"background":return new Ii(v);case"circle":return new Om(v);case"fill":return new yv(v);case"fill-extrusion":return new hi(v);case"heatmap":return new Ku(v);case"hillshade":return new kv(v);case"line":return new Hn(v);case"raster":return new nv(v);case"symbol":return new pd(v)}},M.aD=br,M.aE=function(v,c){if(!v)return[{command:lt.setStyle,args:[c]}];let b=[];try{if(!be(v.version,c.version))return[{command:lt.setStyle,args:[c]}];be(v.center,c.center)||b.push({command:lt.setCenter,args:[c.center]}),be(v.zoom,c.zoom)||b.push({command:lt.setZoom,args:[c.zoom]}),be(v.bearing,c.bearing)||b.push({command:lt.setBearing,args:[c.bearing]}),be(v.pitch,c.pitch)||b.push({command:lt.setPitch,args:[c.pitch]}),be(v.sprite,c.sprite)||b.push({command:lt.setSprite,args:[c.sprite]}),be(v.glyphs,c.glyphs)||b.push({command:lt.setGlyphs,args:[c.glyphs]}),be(v.transition,c.transition)||b.push({command:lt.setTransition,args:[c.transition]}),be(v.light,c.light)||b.push({command:lt.setLight,args:[c.light]});const k={},z=[];(function(W,ne,he,Se){let Ne;for(Ne in ne=ne||{},W=W||{})Object.prototype.hasOwnProperty.call(W,Ne)&&(Object.prototype.hasOwnProperty.call(ne,Ne)||Qt(Ne,he,Se));for(Ne in ne)Object.prototype.hasOwnProperty.call(ne,Ne)&&(Object.prototype.hasOwnProperty.call(W,Ne)?be(W[Ne],ne[Ne])||(W[Ne].type==="geojson"&&ne[Ne].type==="geojson"&&mn(W,ne,Ne)?he.push({command:lt.setGeoJSONSourceData,args:[Ne,ne[Ne].data]}):xr(Ne,ne,he,Se)):mt(Ne,ne,he))})(v.sources,c.sources,z,k);const V=[];v.layers&&v.layers.forEach(W=>{k[W.source]?b.push({command:lt.removeLayer,args:[W.id]}):V.push(W)}),b=b.concat(z),function(W,ne,he){ne=ne||[];const Se=(W=W||[]).map(tr),Ne=ne.map(tr),We=W.reduce(Hr,{}),ht=ne.reduce(Hr,{}),gt=Se.slice(),St=Object.create(null);let Ht,ir,fr,Gr,Tr,Jr,wn;for(Ht=0,ir=0;Ht<Se.length;Ht++)fr=Se[Ht],Object.prototype.hasOwnProperty.call(ht,fr)?ir++:(he.push({command:lt.removeLayer,args:[fr]}),gt.splice(gt.indexOf(fr,ir),1));for(Ht=0,ir=0;Ht<Ne.length;Ht++)fr=Ne[Ne.length-1-Ht],gt[gt.length-1-Ht]!==fr&&(Object.prototype.hasOwnProperty.call(We,fr)?(he.push({command:lt.removeLayer,args:[fr]}),gt.splice(gt.lastIndexOf(fr,gt.length-ir),1)):ir++,Jr=gt[gt.length-Ht],he.push({command:lt.addLayer,args:[ht[fr],Jr]}),gt.splice(gt.length-Ht,0,fr),St[fr]=!0);for(Ht=0;Ht<Ne.length;Ht++)if(fr=Ne[Ht],Gr=We[fr],Tr=ht[fr],!St[fr]&&!be(Gr,Tr))if(be(Gr.source,Tr.source)&&be(Gr["source-layer"],Tr["source-layer"])&&be(Gr.type,Tr.type)){for(wn in Wn(Gr.layout,Tr.layout,he,fr,null,lt.setLayoutProperty),Wn(Gr.paint,Tr.paint,he,fr,null,lt.setPaintProperty),be(Gr.filter,Tr.filter)||he.push({command:lt.setFilter,args:[fr,Tr.filter]}),be(Gr.minzoom,Tr.minzoom)&&be(Gr.maxzoom,Tr.maxzoom)||he.push({command:lt.setLayerZoomRange,args:[fr,Tr.minzoom,Tr.maxzoom]}),Gr)Object.prototype.hasOwnProperty.call(Gr,wn)&&wn!=="layout"&&wn!=="paint"&&wn!=="filter"&&wn!=="metadata"&&wn!=="minzoom"&&wn!=="maxzoom"&&(wn.indexOf("paint.")===0?Wn(Gr[wn],Tr[wn],he,fr,wn.slice(6),lt.setPaintProperty):be(Gr[wn],Tr[wn])||he.push({command:lt.setLayerProperty,args:[fr,wn,Tr[wn]]}));for(wn in Tr)Object.prototype.hasOwnProperty.call(Tr,wn)&&!Object.prototype.hasOwnProperty.call(Gr,wn)&&wn!=="layout"&&wn!=="paint"&&wn!=="filter"&&wn!=="metadata"&&wn!=="minzoom"&&wn!=="maxzoom"&&(wn.indexOf("paint.")===0?Wn(Gr[wn],Tr[wn],he,fr,wn.slice(6),lt.setPaintProperty):be(Gr[wn],Tr[wn])||he.push({command:lt.setLayerProperty,args:[fr,wn,Tr[wn]]}))}else he.push({command:lt.removeLayer,args:[fr]}),Jr=gt[gt.lastIndexOf(fr)+1],he.push({command:lt.addLayer,args:[Tr,Jr]})}(V,c.layers,b)}catch(k){console.warn("Unable to compute style diff:",k),b=[{command:lt.setStyle,args:[c]}]}return b},M.aF=function(v){const c=[],b=v.id;return b===void 0&&c.push({message:`layers.${b}: missing required property "id"`}),v.render===void 0&&c.push({message:`layers.${b}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&c.push({message:`layers.${b}: property "renderingMode" must be either "2d" or "3d"`}),c},M.aG=function v(c,b){if(Array.isArray(c)){if(!Array.isArray(b)||c.length!==b.length)return!1;for(let k=0;k<c.length;k++)if(!v(c[k],b[k]))return!1;return!0}if(typeof c=="object"&&c!==null&&b!==null){if(typeof b!="object"||Object.keys(c).length!==Object.keys(b).length)return!1;for(const k in c)if(!v(c[k],b[k]))return!1;return!0}return c===b},M.aH=rr,M.aI=Jt,M.aJ=Lc,M.aK=function(v){return v({pluginStatus:Ql,pluginURL:Yh}),Lc.on("pluginStateChange",v),v},M.aL=class extends Uu{constructor(v,c){super(v,c),this.current=0}set(v){this.current!==v&&(this.current=v,this.gl.uniform1i(this.location,v))}},M.aM=uh,M.aN=class extends Uu{constructor(v,c){super(v,c),this.current=Yc}set(v){if(v[12]!==this.current[12]||v[0]!==this.current[0])return this.current=v,void this.gl.uniformMatrix4fv(this.location,!1,v);for(let c=1;c<16;c++)if(v[c]!==this.current[c]){this.current=v,this.gl.uniformMatrix4fv(this.location,!1,v);break}}},M.aO=pc,M.aP=class extends Uu{constructor(v,c){super(v,c),this.current=[0,0,0]}set(v){v[0]===this.current[0]&&v[1]===this.current[1]&&v[2]===this.current[2]||(this.current=v,this.gl.uniform3f(this.location,v[0],v[1],v[2]))}},M.aQ=class extends Uu{constructor(v,c){super(v,c),this.current=[0,0]}set(v){v[0]===this.current[0]&&v[1]===this.current[1]||(this.current=v,this.gl.uniform2f(this.location,v[0],v[1]))}},M.aR=Xc,M.aS=function(v,c,b,k,z,V,W){var ne=1/(c-b),he=1/(k-z),Se=1/(V-W);return v[0]=-2*ne,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*he,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*Se,v[11]=0,v[12]=(c+b)*ne,v[13]=(z+k)*he,v[14]=(W+V)*Se,v[15]=1,v},M.aT=vo,M.aU=Vv,M.aV=class extends O{},M.aW=Go,M.aX=class extends H{},M.aY=function(v){return v<=1?1:Math.pow(2,Math.ceil(Math.log(v)/Math.LN2))},M.aZ=Oh,M.a_=dt,M.aa=function(v){const c={};if(v.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(b,k,z,V)=>{const W=z||V;return c[k]=!W||W.toLowerCase(),""}),c["max-age"]){const b=parseInt(c["max-age"],10);isNaN(b)?delete c["max-age"]:c["max-age"]=b}return c},M.ab=function(v,c){const b=[];for(const k in v)k in c||b.push(k);return b},M.ac=function(v){if(Ee==null){const c=v.navigator?v.navigator.userAgent:null;Ee=!!v.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Ee},M.ad=er,M.ae=function(v,c,b){var k=Math.sin(b),z=Math.cos(b),V=c[0],W=c[1],ne=c[2],he=c[3],Se=c[4],Ne=c[5],We=c[6],ht=c[7];return c!==v&&(v[8]=c[8],v[9]=c[9],v[10]=c[10],v[11]=c[11],v[12]=c[12],v[13]=c[13],v[14]=c[14],v[15]=c[15]),v[0]=V*z+Se*k,v[1]=W*z+Ne*k,v[2]=ne*z+We*k,v[3]=he*z+ht*k,v[4]=Se*z-V*k,v[5]=Ne*z-W*k,v[6]=We*z-ne*k,v[7]=ht*z-he*k,v},M.af=function(v){var c=new dv(16);return c[0]=v[0],c[1]=v[1],c[2]=v[2],c[3]=v[3],c[4]=v[4],c[5]=v[5],c[6]=v[6],c[7]=v[7],c[8]=v[8],c[9]=v[9],c[10]=v[10],c[11]=v[11],c[12]=v[12],c[13]=v[13],c[14]=v[14],c[15]=v[15],c},M.ag=lm,M.ah=function(v,c){let b=0,k=0;if(v.kind==="constant")k=v.layoutSize;else if(v.kind!=="source"){const{interpolationType:z,minZoom:V,maxZoom:W}=v,ne=z?er(Vs.interpolationFactor(z,c,V,W),0,1):0;v.kind==="camera"?k=Yu.number(v.minSize,v.maxSize,ne):b=ne}return{uSizeT:b,uSize:k}},M.aj=function(v,{uSize:c,uSizeT:b},{lowerSize:k,upperSize:z}){return v.kind==="source"?k/Rp:v.kind==="composite"?Yu.number(k/Rp,z/Rp,b):c},M.ak=rc,M.al=function(v,c,b,k){const z=c.y-v.y,V=c.x-v.x,W=k.y-b.y,ne=k.x-b.x,he=W*V-ne*z;if(he===0)return null;const Se=(ne*(v.y-b.y)-W*(v.x-b.x))/he;return new le(v.x+Se*V,v.y+Se*z)},M.am=it,M.an=ep,M.ao=Df,M.ap=ks,M.ar=Td,M.as=function(v,c){var b=c[0],k=c[1],z=c[2],V=c[3],W=c[4],ne=c[5],he=c[6],Se=c[7],Ne=c[8],We=c[9],ht=c[10],gt=c[11],St=c[12],Ht=c[13],ir=c[14],fr=c[15],Gr=b*ne-k*W,Tr=b*he-z*W,Jr=b*Se-V*W,wn=k*he-z*ne,ii=k*Se-V*ne,da=z*Se-V*he,$a=Ne*Ht-We*St,fa=Ne*ir-ht*St,ra=Ne*fr-gt*St,Xi=We*ir-ht*Ht,ga=We*fr-gt*Ht,qi=ht*fr-gt*ir,Ei=Gr*qi-Tr*ga+Jr*Xi+wn*ra-ii*fa+da*$a;return Ei?(v[0]=(ne*qi-he*ga+Se*Xi)*(Ei=1/Ei),v[1]=(z*ga-k*qi-V*Xi)*Ei,v[2]=(Ht*da-ir*ii+fr*wn)*Ei,v[3]=(ht*ii-We*da-gt*wn)*Ei,v[4]=(he*ra-W*qi-Se*fa)*Ei,v[5]=(b*qi-z*ra+V*fa)*Ei,v[6]=(ir*Jr-St*da-fr*Tr)*Ei,v[7]=(Ne*da-ht*Jr+gt*Tr)*Ei,v[8]=(W*ga-ne*ra+Se*$a)*Ei,v[9]=(k*ra-b*ga-V*$a)*Ei,v[10]=(St*ii-Ht*Jr+fr*Gr)*Ei,v[11]=(We*Jr-Ne*ii-gt*Gr)*Ei,v[12]=(ne*fa-W*Xi-he*$a)*Ei,v[13]=(b*Xi-k*fa+z*$a)*Ei,v[14]=(Ht*Tr-St*wn-ir*Gr)*Ei,v[15]=(Ne*wn-We*Tr+ht*Gr)*Ei,v):null},M.at=Oo,M.au=Ys,M.av=Au,M.aw=function(){const v={},c=un.$version;for(const b in un.$root){const k=un.$root[b];if(k.required){let z=null;z=b==="version"?c:k.type==="array"?[]:{},z!=null&&(v[b]=z)}}return v},M.ax=lt,M.ay=Wh,M.az=na,M.b=function(v,c){const b=new Blob([new Uint8Array(v)],{type:"image/png"});createImageBitmap(b).then(k=>{c(null,k)}).catch(k=>{c(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},M.b0=Qi,M.b1=function(v,c){var b=v[0],k=v[1],z=v[2],V=v[3],W=v[4],ne=v[5],he=v[6],Se=v[7],Ne=v[8],We=v[9],ht=v[10],gt=v[11],St=v[12],Ht=v[13],ir=v[14],fr=v[15],Gr=c[0],Tr=c[1],Jr=c[2],wn=c[3],ii=c[4],da=c[5],$a=c[6],fa=c[7],ra=c[8],Xi=c[9],ga=c[10],qi=c[11],Ei=c[12],Wa=c[13],Ta=c[14],gs=c[15];return Math.abs(b-Gr)<=hh*Math.max(1,Math.abs(b),Math.abs(Gr))&&Math.abs(k-Tr)<=hh*Math.max(1,Math.abs(k),Math.abs(Tr))&&Math.abs(z-Jr)<=hh*Math.max(1,Math.abs(z),Math.abs(Jr))&&Math.abs(V-wn)<=hh*Math.max(1,Math.abs(V),Math.abs(wn))&&Math.abs(W-ii)<=hh*Math.max(1,Math.abs(W),Math.abs(ii))&&Math.abs(ne-da)<=hh*Math.max(1,Math.abs(ne),Math.abs(da))&&Math.abs(he-$a)<=hh*Math.max(1,Math.abs(he),Math.abs($a))&&Math.abs(Se-fa)<=hh*Math.max(1,Math.abs(Se),Math.abs(fa))&&Math.abs(Ne-ra)<=hh*Math.max(1,Math.abs(Ne),Math.abs(ra))&&Math.abs(We-Xi)<=hh*Math.max(1,Math.abs(We),Math.abs(Xi))&&Math.abs(ht-ga)<=hh*Math.max(1,Math.abs(ht),Math.abs(ga))&&Math.abs(gt-qi)<=hh*Math.max(1,Math.abs(gt),Math.abs(qi))&&Math.abs(St-Ei)<=hh*Math.max(1,Math.abs(St),Math.abs(Ei))&&Math.abs(Ht-Wa)<=hh*Math.max(1,Math.abs(Ht),Math.abs(Wa))&&Math.abs(ir-Ta)<=hh*Math.max(1,Math.abs(ir),Math.abs(Ta))&&Math.abs(fr-gs)<=hh*Math.max(1,Math.abs(fr),Math.abs(gs))},M.b2=function(v,c){return v[0]=c[0],v[1]=c[1],v[2]=c[2],v[3]=c[3],v[4]=c[4],v[5]=c[5],v[6]=c[6],v[7]=c[7],v[8]=c[8],v[9]=c[9],v[10]=c[10],v[11]=c[11],v[12]=c[12],v[13]=c[13],v[14]=c[14],v[15]=c[15],v},M.b3=function(v,c,b){return v[0]=c[0]*b[0],v[1]=c[1]*b[1],v[2]=c[2]*b[2],v[3]=c[3]*b[3],v},M.b4=function(v,c){return v[0]*c[0]+v[1]*c[1]+v[2]*c[2]+v[3]*c[3]},M.b5=gn,M.b6=S,M.b7=L,M.b8=function(v,c,b,k,z){var V,W=1/Math.tan(c/2);return v[0]=W/b,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=W,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,z!=null&&z!==1/0?(v[10]=(z+k)*(V=1/(k-z)),v[14]=2*z*k*V):(v[10]=-1,v[14]=-2*k),v},M.b9=function(v,c,b){var k=Math.sin(b),z=Math.cos(b),V=c[4],W=c[5],ne=c[6],he=c[7],Se=c[8],Ne=c[9],We=c[10],ht=c[11];return c!==v&&(v[0]=c[0],v[1]=c[1],v[2]=c[2],v[3]=c[3],v[12]=c[12],v[13]=c[13],v[14]=c[14],v[15]=c[15]),v[4]=V*z+Se*k,v[5]=W*z+Ne*k,v[6]=ne*z+We*k,v[7]=he*z+ht*k,v[8]=Se*z-V*k,v[9]=Ne*z-W*k,v[10]=We*z-ne*k,v[11]=ht*z-he*k,v},M.bA=Ho,M.bB=dp,M.bC=Dl,M.ba=Rt,M.bb=hr,M.bc=function(v,c){return v[0]=c[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=c[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=c[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},M.bd=class extends If{},M.be=dd,M.bf=Na,M.bh=Ka,M.bi=function(v,c,b=!1){if(Ql===ff||Ql===Tf||Ql===Jl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Yh=Ji.resolveURL(v),Ql=ff,wc=c,pf(),b||xo()},M.bj=_l,M.bk=function(v,c){const b={};for(let z=0;z<v.length;z++){const V=c&&c[v[z].id]||yp(v[z]);c&&(c[v[z].id]=V);let W=b[V];W||(W=b[V]=[]),W.push(v[z])}const k=[];for(const z in b)k.push(b[z]);return k},M.bl=zi,M.bm=q,M.bn=de,M.bo=Zt,M.bp=function(v){v.bucket.createArrays(),v.bucket.tilePixelRatio=Os/(512*v.bucket.overscaling),v.bucket.compareText={},v.bucket.iconsNeedLinear=!1;const c=v.bucket.layers[0],b=c.layout,k=c._unevaluatedLayout._values,z={layoutIconSize:k["icon-size"].possiblyEvaluate(new Po(v.bucket.zoom+1),v.canonical),layoutTextSize:k["text-size"].possiblyEvaluate(new Po(v.bucket.zoom+1),v.canonical),textMaxSize:k["text-size"].possiblyEvaluate(new Po(18))};if(v.bucket.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ne}=v.bucket.textSizeData;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Po(Se),v.canonical),k["text-size"].possiblyEvaluate(new Po(Ne),v.canonical)]}if(v.bucket.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ne}=v.bucket.iconSizeData;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Po(Se),v.canonical),k["icon-size"].possiblyEvaluate(new Po(Ne),v.canonical)]}const V=b.get("text-line-height")*ks,W=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point",ne=b.get("text-keep-upright"),he=b.get("text-size");for(const Se of v.bucket.features){const Ne=b.get("text-font").evaluate(Se,{},v.canonical).join(","),We=he.evaluate(Se,{},v.canonical),ht=z.layoutTextSize.evaluate(Se,{},v.canonical),gt=z.layoutIconSize.evaluate(Se,{},v.canonical),St={horizontal:{},vertical:void 0},Ht=Se.text;let ir,fr=[0,0];if(Ht){const Jr=Ht.toString(),wn=b.get("text-letter-spacing").evaluate(Se,{},v.canonical)*ks,ii=hf(Jr)?wn:0,da=b.get("text-anchor").evaluate(Se,{},v.canonical),$a=lo(c,Se,v.canonical);if(!$a){const qi=b.get("text-radial-offset").evaluate(Se,{},v.canonical);fr=qi?$o(da,[qi*ks,Aa]):b.get("text-offset").evaluate(Se,{},v.canonical).map(Ei=>Ei*ks)}let fa=W?"center":b.get("text-justify").evaluate(Se,{},v.canonical);const ra=b.get("symbol-placement"),Xi=ra==="point"?b.get("text-max-width").evaluate(Se,{},v.canonical)*ks:0,ga=()=>{v.bucket.allowVerticalPlacement&&Ic(Jr)&&(St.vertical=Rn(Ht,v.glyphMap,v.glyphPositions,v.imagePositions,Ne,Xi,V,da,"left",ii,fr,M.ai.vertical,!0,ra,ht,We))};if(!W&&$a){const qi=new Set;if(fa==="auto")for(let Wa=0;Wa<$a.values.length;Wa+=2)qi.add(Oo($a.values[Wa]));else qi.add(fa);let Ei=!1;for(const Wa of qi)if(!St.horizontal[Wa])if(Ei)St.horizontal[Wa]=St.horizontal[0];else{const Ta=Rn(Ht,v.glyphMap,v.glyphPositions,v.imagePositions,Ne,Xi,V,"center",Wa,ii,fr,M.ai.horizontal,!1,ra,ht,We);Ta&&(St.horizontal[Wa]=Ta,Ei=Ta.positionedLines.length===1)}ga()}else{fa==="auto"&&(fa=Oo(da));const qi=Rn(Ht,v.glyphMap,v.glyphPositions,v.imagePositions,Ne,Xi,V,da,fa,ii,fr,M.ai.horizontal,!1,ra,ht,We);qi&&(St.horizontal[fa]=qi),ga(),Ic(Jr)&&W&&ne&&(St.vertical=Rn(Ht,v.glyphMap,v.glyphPositions,v.imagePositions,Ne,Xi,V,da,fa,ii,fr,M.ai.vertical,!1,ra,ht,We))}}let Gr=!1;if(Se.icon&&Se.icon.name){const Jr=v.imageMap[Se.icon.name];Jr&&(ir=bf(v.imagePositions[Se.icon.name],b.get("icon-offset").evaluate(Se,{},v.canonical),b.get("icon-anchor").evaluate(Se,{},v.canonical)),Gr=!!Jr.sdf,v.bucket.sdfIcons===void 0?v.bucket.sdfIcons=Gr:v.bucket.sdfIcons!==Gr&&Br("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Jr.pixelRatio!==v.bucket.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(v.bucket.iconsNeedLinear=!0))}const Tr=Wo(St.horizontal)||St.vertical;v.bucket.iconsInText=!!Tr&&Tr.iconsInText,(Tr||ir)&&So(v.bucket,Se,St,ir,v.imageMap,z,ht,gt,fr,Gr,v.canonical)}v.showCollisionBoxes&&v.bucket.generateCollisionDebugBuffers()},M.bq=qn,M.br=Wv,M.bs=ri,M.bt=class{constructor(v){this._marks={start:[v.url,"start"].join("#"),end:[v.url,"end"].join("#"),measure:v.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let v=performance.getEntriesByName(this._marks.measure);return v.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),v=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),v}},M.bu=ls,M.bv=Kp,M.bw=function(v,c,b,k,z){return ee(this,void 0,void 0,function*(){if(Vt())try{return yield Pr(v,c,b,k,z)}catch(V){}return function(V,W,ne,he,Se){const Ne=V.width,We=V.height;Fr&&Nr||(Fr=new OffscreenCanvas(Ne,We),Nr=Fr.getContext("2d",{willReadFrequently:!0})),Fr.width=Ne,Fr.height=We,Nr.drawImage(V,0,0,Ne,We);const ht=Nr.getImageData(W,ne,he,Se);return Nr.clearRect(0,0,Ne,We),ht.data}(v,c,b,k,z)})},M.bx=U,M.by=te,M.bz=pe,M.c=pi,M.d=function(v,c){const b=new Image;b.onload=()=>{c(null,b),URL.revokeObjectURL(b.src),b.onload=null,window.requestAnimationFrame(()=>{b.src=Ot})},b.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(v)],{type:"image/png"});b.src=v.byteLength?URL.createObjectURL(k):Ot},M.e=Rr,M.f=function(v,c){return La(Rr(v,{type:"json"}),c)},M.g=ca,M.h=Ji,M.i=Dt,M.j=ha,M.k=Za,M.l=$i,M.m=La,M.n=function(v){return new ls(v).readFields(Et,[])},M.o=function(v,c,b){if(!v.length)return b(null,[]);let k=v.length;const z=new Array(v.length);let V=null;v.forEach((W,ne)=>{c(W,(he,Se)=>{he&&(V=he),z[ne]=Se,--k==0&&b(V,z)})})},M.p=wr,M.q=qu,M.r=Pu,M.s=qo,M.t=Cf,M.u=ji,M.v=un,M.w=Br,M.x=Cu,M.y=cf,M.z=function([v,c,b]){return c+=90,c*=Math.PI/180,b*=Math.PI/180,{x:v*Math.cos(c)*Math.sin(b),y:v*Math.sin(c)*Math.sin(b),z:v*Math.cos(b)}}}),j(["./shared"],function(M){"use strict";class ee{constructor(qe){this.keyCache={},qe&&this.replace(qe)}replace(qe){this._layerConfigs={},this._layers={},this.update(qe,[])}update(qe,se){for(const Ae of qe){this._layerConfigs[Ae.id]=Ae;const Re=this._layers[Ae.id]=M.aC(Ae);Re._featureFilter=M.a6(Re.filter),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id]}for(const Ae of se)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const ve=M.bk(Object.values(this._layerConfigs),this.keyCache);for(const Ae of ve){const Re=Ae.map(Be=>this._layers[Be.id]),Xe=Re[0];if(Xe.visibility==="none")continue;const Qe=Xe.source||"";let Ye=this.familiesBySource[Qe];Ye||(Ye=this.familiesBySource[Qe]={});const Fe=Xe.sourceLayer||"_geojsonTileLayer";let Me=Ye[Fe];Me||(Me=Ye[Fe]=[]),Me.push(Re)}}}class te{constructor(qe){const se={},ve=[];for(const Qe in qe){const Ye=qe[Qe],Fe=se[Qe]={};for(const Me in Ye){const Be=Ye[+Me];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const yt={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};ve.push(yt),Fe[Me]={rect:yt,metrics:Be.metrics}}}const{w:Ae,h:Re}=M.p(ve),Xe=new M.q({width:Ae||1,height:Re||1});for(const Qe in qe){const Ye=qe[Qe];for(const Fe in Ye){const Me=Ye[+Fe];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Be=se[Qe][Fe].rect;M.q.copy(Me.bitmap,Xe,{x:0,y:0},{x:Be.x+1,y:Be.y+1},Me.bitmap)}}this.image=Xe,this.positions=se}}M.bl("GlyphAtlas",te);class pe{constructor(qe){this.tileID=new M.O(qe.tileID.overscaledZ,qe.tileID.wrap,qe.tileID.canonical.z,qe.tileID.canonical.x,qe.tileID.canonical.y),this.uid=qe.uid,this.zoom=qe.zoom,this.pixelRatio=qe.pixelRatio,this.tileSize=qe.tileSize,this.source=qe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=qe.showCollisionBoxes,this.collectResourceTiming=!!qe.collectResourceTiming,this.returnDependencies=!!qe.returnDependencies,this.promoteId=qe.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(qe,se,ve,Ae,Re){this.status="parsing",this.data=qe,this.collisionBoxArray=new M.a3;const Xe=new M.bm(Object.keys(qe.layers).sort()),Qe=new M.bn(this.tileID,this.promoteId);Qe.bucketLayerIDs=[];const Ye={},Fe={featureIndex:Qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ve},Me=se.familiesBySource[this.source];for(const zn in Me){const jn=qe.layers[zn];if(!jn)continue;jn.version===1&&M.w(`Vector tile source "${this.source}" layer "${zn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ca=Xe.encode(zn),ni=[];for(let za=0;za<jn.length;za++){const Ao=jn.feature(za),io=Qe.getId(Ao,zn);ni.push({feature:Ao,id:io,index:za,sourceLayerIndex:Ca})}for(const za of Me[zn]){const Ao=za[0];Ao.source!==this.source&&M.w(`layer.source = ${Ao.source} does not equal this.source = ${this.source}`),Ao.minzoom&&this.zoom<Math.floor(Ao.minzoom)||Ao.maxzoom&&this.zoom>=Ao.maxzoom||Ao.visibility!=="none"&&(Ce(za,this.zoom,ve),(Ye[Ao.id]=Ao.createBucket({index:Qe.bucketLayerIDs.length,layers:za,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ca,sourceID:this.source})).populate(ni,Fe,this.tileID.canonical),Qe.bucketLayerIDs.push(za.map(io=>io.id)))}}let Be,yt,zt,Ze;const Yr=M.aH(Fe.glyphDependencies,zn=>Object.keys(zn).map(Number));this.inFlightDependencies.forEach(zn=>zn==null?void 0:zn.cancel()),this.inFlightDependencies=[];const Fn=++this.dependencySentinel;Object.keys(Yr).length?this.inFlightDependencies.push(Ae.send("getGlyphs",{uid:this.uid,stacks:Yr,source:this.source,tileID:this.tileID,type:"glyphs"},(zn,jn)=>{Fn===this.dependencySentinel&&(Be||(Be=zn,yt=jn,li.call(this)))})):yt={};const Nn=Object.keys(Fe.iconDependencies);Nn.length?this.inFlightDependencies.push(Ae.send("getImages",{icons:Nn,source:this.source,tileID:this.tileID,type:"icons"},(zn,jn)=>{Fn===this.dependencySentinel&&(Be||(Be=zn,zt=jn,li.call(this)))})):zt={};const qr=Object.keys(Fe.patternDependencies);function li(){if(Be)return Re(Be);if(yt&&zt&&Ze){const zn=new te(yt),jn=new M.bo(zt,Ze);for(const Ca in Ye){const ni=Ye[Ca];ni instanceof M.a4?(Ce(ni.layers,this.zoom,ve),M.bp({bucket:ni,glyphMap:yt,glyphPositions:zn.positions,imageMap:zt,imagePositions:jn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ni.hasPattern&&(ni instanceof M.bq||ni instanceof M.br||ni instanceof M.bs)&&(Ce(ni.layers,this.zoom,ve),ni.addFeatures(Fe,this.tileID.canonical,jn.patternPositions))}this.status="done",Re(null,{buckets:Object.values(Ye).filter(Ca=>!Ca.isEmpty()),featureIndex:Qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zn.image,imageAtlas:jn,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?zt:null,glyphPositions:this.returnDependencies?zn.positions:null})}}qr.length?this.inFlightDependencies.push(Ae.send("getImages",{icons:qr,source:this.source,tileID:this.tileID,type:"patterns"},(zn,jn)=>{Fn===this.dependencySentinel&&(Be||(Be=zn,Ze=jn,li.call(this)))})):Ze={},li.call(this)}}function Ce(Wt,qe,se){const ve=new M.a8(qe);for(const Ae of Wt)Ae.recalculate(ve,se)}function le(Wt,qe){const se=M.l(Wt.request,(ve,Ae,Re,Xe)=>{if(ve)qe(ve);else if(Ae)try{const Qe=new M.bv.VectorTile(new M.bu(Ae));qe(null,{vectorTile:Qe,rawData:Ae,cacheControl:Re,expires:Xe})}catch(Qe){const Ye=new Uint8Array(Ae);let Fe=`Unable to parse the tile at ${Wt.request.url}, `;Fe+=Ye[0]===31&&Ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Qe.messge}`,qe(new Error(Fe))}});return()=>{se.cancel(),qe()}}class Ie{constructor(qe,se,ve,Ae){this.actor=qe,this.layerIndex=se,this.availableImages=ve,this.loadVectorData=Ae||le,this.fetching={},this.loading={},this.loaded={}}loadTile(qe,se){const ve=qe.uid;this.loading||(this.loading={});const Ae=!!(qe&&qe.request&&qe.request.collectResourceTiming)&&new M.bt(qe.request),Re=this.loading[ve]=new pe(qe);Re.abort=this.loadVectorData(qe,(Xe,Qe)=>{if(delete this.loading[ve],Xe||!Qe)return Re.status="done",this.loaded[ve]=Re,se(Xe);const Ye=Qe.rawData,Fe={};Qe.expires&&(Fe.expires=Qe.expires),Qe.cacheControl&&(Fe.cacheControl=Qe.cacheControl);const Me={};if(Ae){const Be=Ae.finish();Be&&(Me.resourceTiming=JSON.parse(JSON.stringify(Be)))}Re.vectorTile=Qe.vectorTile,Re.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Be,yt)=>{if(delete this.fetching[ve],Be||!yt)return se(Be);se(null,M.e({rawTileData:Ye.slice(0)},yt,Fe,Me))}),this.loaded=this.loaded||{},this.loaded[ve]=Re,this.fetching[ve]={rawTileData:Ye,cacheControl:Fe,resourceTiming:Me}})}reloadTile(qe,se){const ve=this.loaded,Ae=qe.uid;if(ve&&ve[Ae]){const Re=ve[Ae];Re.showCollisionBoxes=qe.showCollisionBoxes,Re.status==="parsing"?Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,(Xe,Qe)=>{if(Xe||!Qe)return se(Xe,Qe);let Ye;if(this.fetching[Ae]){const{rawTileData:Fe,cacheControl:Me,resourceTiming:Be}=this.fetching[Ae];delete this.fetching[Ae],Ye=M.e({rawTileData:Fe.slice(0)},Qe,Me,Be)}else Ye=Qe;se(null,Ye)}):Re.status==="done"&&(Re.vectorTile?Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}}abortTile(qe,se){const ve=this.loading,Ae=qe.uid;ve&&ve[Ae]&&ve[Ae].abort&&(ve[Ae].abort(),delete ve[Ae]),se()}removeTile(qe,se){const ve=this.loaded,Ae=qe.uid;ve&&ve[Ae]&&delete ve[Ae],se()}}class rt{constructor(){this.loaded={}}loadTile(qe,se){return M._(this,void 0,void 0,function*(){const{uid:ve,encoding:Ae,rawImageData:Re,redFactor:Xe,greenFactor:Qe,blueFactor:Ye,baseShift:Fe}=qe,Me=Re.width+2,Be=Re.height+2,yt=M.a(Re)?new M.R({width:Me,height:Be},yield M.bw(Re,-1,-1,Me,Be)):Re,zt=new M.bx(ve,yt,Ae,Xe,Qe,Ye,Fe);this.loaded=this.loaded||{},this.loaded[ve]=zt,se(null,zt)})}removeTile(qe){const se=this.loaded,ve=qe.uid;se&&se[ve]&&delete se[ve]}}function xt(Wt,qe){if(Wt.length!==0){nt(Wt[0],qe);for(var se=1;se<Wt.length;se++)nt(Wt[se],!qe)}}function nt(Wt,qe){for(var se=0,ve=0,Ae=0,Re=Wt.length,Xe=Re-1;Ae<Re;Xe=Ae++){var Qe=(Wt[Ae][0]-Wt[Xe][0])*(Wt[Xe][1]+Wt[Ae][1]),Ye=se+Qe;ve+=Math.abs(se)>=Math.abs(Qe)?se-Ye+Qe:Qe-Ye+se,se=Ye}se+ve>=0!=!!qe&&Wt.reverse()}var Ct=M.by(function Wt(qe,se){var ve,Ae=qe&&qe.type;if(Ae==="FeatureCollection")for(ve=0;ve<qe.features.length;ve++)Wt(qe.features[ve],se);else if(Ae==="GeometryCollection")for(ve=0;ve<qe.geometries.length;ve++)Wt(qe.geometries[ve],se);else if(Ae==="Feature")Wt(qe.geometry,se);else if(Ae==="Polygon")xt(qe.coordinates,se);else if(Ae==="MultiPolygon")for(ve=0;ve<qe.coordinates.length;ve++)xt(qe.coordinates[ve],se);return qe});const jt=M.bv.VectorTileFeature.prototype.toGeoJSON;var Vt={exports:{}},Rt=M.bz,hr=M.bv.VectorTileFeature,er=gn;function gn(Wt,qe){this.options=qe||{},this.features=Wt,this.length=Wt.length}function Rr(Wt,qe){this.id=typeof Wt.id=="number"?Wt.id:void 0,this.type=Wt.type,this.rawGeometry=Wt.type===1?[Wt.geometry]:Wt.geometry,this.properties=Wt.tags,this.extent=qe||4096}gn.prototype.feature=function(Wt){return new Rr(this.features[Wt],this.options.extent)},Rr.prototype.loadGeometry=function(){var Wt=this.rawGeometry;this.geometry=[];for(var qe=0;qe<Wt.length;qe++){for(var se=Wt[qe],ve=[],Ae=0;Ae<se.length;Ae++)ve.push(new Rt(se[Ae][0],se[Ae][1]));this.geometry.push(ve)}return this.geometry},Rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Wt=this.geometry,qe=1/0,se=-1/0,ve=1/0,Ae=-1/0,Re=0;Re<Wt.length;Re++)for(var Xe=Wt[Re],Qe=0;Qe<Xe.length;Qe++){var Ye=Xe[Qe];qe=Math.min(qe,Ye.x),se=Math.max(se,Ye.x),ve=Math.min(ve,Ye.y),Ae=Math.max(Ae,Ye.y)}return[qe,ve,se,Ae]},Rr.prototype.toGeoJSON=hr.prototype.toGeoJSON;var vn=M.bA,rr=er;function Jt(Wt){var qe=new vn;return function(se,ve){for(var Ae in se.layers)ve.writeMessage(3,br,se.layers[Ae])}(Wt,qe),qe.finish()}function br(Wt,qe){var se;qe.writeVarintField(15,Wt.version||1),qe.writeStringField(1,Wt.name||""),qe.writeVarintField(5,Wt.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<Wt.length;se++)ve.feature=Wt.feature(se),qe.writeMessage(2,or,ve);var Ae=ve.keys;for(se=0;se<Ae.length;se++)qe.writeStringField(3,Ae[se]);var Re=ve.values;for(se=0;se<Re.length;se++)qe.writeMessage(4,Ee,Re[se])}function or(Wt,qe){var se=Wt.feature;se.id!==void 0&&qe.writeVarintField(1,se.id),qe.writeMessage(2,Br,Wt),qe.writeVarintField(3,se.type),qe.writeMessage(4,Dt,se)}function Br(Wt,qe){var se=Wt.feature,ve=Wt.keys,Ae=Wt.values,Re=Wt.keycache,Xe=Wt.valuecache;for(var Qe in se.properties){var Ye=se.properties[Qe],Fe=Re[Qe];if(Ye!==null){Fe===void 0&&(ve.push(Qe),Re[Qe]=Fe=ve.length-1),qe.writeVarint(Fe);var Me=typeof Ye;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(Ye=JSON.stringify(Ye));var Be=Me+":"+Ye,yt=Xe[Be];yt===void 0&&(Ae.push(Ye),Xe[Be]=yt=Ae.length-1),qe.writeVarint(yt)}}}function an(Wt,qe){return(qe<<3)+(7&Wt)}function ot(Wt){return Wt<<1^Wt>>31}function Dt(Wt,qe){for(var se=Wt.loadGeometry(),ve=Wt.type,Ae=0,Re=0,Xe=se.length,Qe=0;Qe<Xe;Qe++){var Ye=se[Qe],Fe=1;ve===1&&(Fe=Ye.length),qe.writeVarint(an(1,Fe));for(var Me=ve===3?Ye.length-1:Ye.length,Be=0;Be<Me;Be++){Be===1&&ve!==1&&qe.writeVarint(an(2,Me-1));var yt=Ye[Be].x-Ae,zt=Ye[Be].y-Re;qe.writeVarint(ot(yt)),qe.writeVarint(ot(zt)),Ae+=yt,Re+=zt}ve===3&&qe.writeVarint(an(7,1))}}function Ee(Wt,qe){var se=typeof Wt;se==="string"?qe.writeStringField(1,Wt):se==="boolean"?qe.writeBooleanField(7,Wt):se==="number"&&(Wt%1!=0?qe.writeDoubleField(3,Wt):Wt<0?qe.writeSVarintField(6,Wt):qe.writeVarintField(5,Wt))}Vt.exports=Jt,Vt.exports.fromVectorTileJs=Jt,Vt.exports.fromGeojsonVt=function(Wt,qe){qe=qe||{};var se={};for(var ve in Wt)se[ve]=new rr(Wt[ve].features,qe),se[ve].name=ve,se[ve].version=qe.version,se[ve].extent=qe.extent;return Jt({layers:se})},Vt.exports.GeoJSONWrapper=rr;var Bt=M.by(Vt.exports);const Ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Wt=>Wt},Pr=Math.fround||(Fr=new Float32Array(1),Wt=>(Fr[0]=+Wt,Fr[0]));var Fr;const Nr=3,hn=5,xn=6;class Ji{constructor(qe){this.options=Object.assign(Object.create(Ot),qe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(qe){const{log:se,minZoom:ve,maxZoom:Ae}=this.options;se&&console.time("total time");const Re=`prepare ${qe.length} points`;se&&console.time(Re),this.points=qe;const Xe=[];for(let Ye=0;Ye<qe.length;Ye++){const Fe=qe[Ye];if(!Fe.geometry)continue;const[Me,Be]=Fe.geometry.coordinates,yt=Pr(na(Me)),zt=Pr(ca(Be));Xe.push(yt,zt,1/0,Ye,-1,1),this.options.reduce&&Xe.push(0)}let Qe=this.trees[Ae+1]=this._createTree(Xe);se&&console.timeEnd(Re);for(let Ye=Ae;Ye>=ve;Ye--){const Fe=+Date.now();Qe=this.trees[Ye]=this._createTree(this._cluster(Qe,Ye)),se&&console.log("z%d: %d clusters in %dms",Ye,Qe.numItems,+Date.now()-Fe)}return se&&console.timeEnd("total time"),this}getClusters(qe,se){let ve=((qe[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,qe[1]));let Re=qe[2]===180?180:((qe[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)ve=-180,Re=180;else if(ve>Re){const Be=this.getClusters([ve,Ae,180,Xe],se),yt=this.getClusters([-180,Ae,Re,Xe],se);return Be.concat(yt)}const Qe=this.trees[this._limitZoom(se)],Ye=Qe.range(na(ve),ca(Xe),na(Re),ca(Ae)),Fe=Qe.data,Me=[];for(const Be of Ye){const yt=this.stride*Be;Me.push(Fe[yt+hn]>1?pi(Fe,yt,this.clusterProps):this.points[Fe[yt+Nr]])}return Me}getChildren(qe){const se=this._getOriginId(qe),ve=this._getOriginZoom(qe),Ae="No cluster with the specified id.",Re=this.trees[ve];if(!Re)throw new Error(Ae);const Xe=Re.data;if(se*this.stride>=Xe.length)throw new Error(Ae);const Qe=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),Ye=Re.within(Xe[se*this.stride],Xe[se*this.stride+1],Qe),Fe=[];for(const Me of Ye){const Be=Me*this.stride;Xe[Be+4]===qe&&Fe.push(Xe[Be+hn]>1?pi(Xe,Be,this.clusterProps):this.points[Xe[Be+Nr]])}if(Fe.length===0)throw new Error(Ae);return Fe}getLeaves(qe,se,ve){const Ae=[];return this._appendLeaves(Ae,qe,se=se||10,ve=ve||0,0),Ae}getTile(qe,se,ve){const Ae=this.trees[this._limitZoom(qe)],Re=Math.pow(2,qe),{extent:Xe,radius:Qe}=this.options,Ye=Qe/Xe,Fe=(ve-Ye)/Re,Me=(ve+1+Ye)/Re,Be={features:[]};return this._addTileFeatures(Ae.range((se-Ye)/Re,Fe,(se+1+Ye)/Re,Me),Ae.data,se,ve,Re,Be),se===0&&this._addTileFeatures(Ae.range(1-Ye/Re,Fe,1,Me),Ae.data,Re,ve,Re,Be),se===Re-1&&this._addTileFeatures(Ae.range(0,Fe,Ye/Re,Me),Ae.data,-1,ve,Re,Be),Be.features.length?Be:null}getClusterExpansionZoom(qe){let se=this._getOriginZoom(qe)-1;for(;se<=this.options.maxZoom;){const ve=this.getChildren(qe);if(se++,ve.length!==1)break;qe=ve[0].properties.cluster_id}return se}_appendLeaves(qe,se,ve,Ae,Re){const Xe=this.getChildren(se);for(const Qe of Xe){const Ye=Qe.properties;if(Ye&&Ye.cluster?Re+Ye.point_count<=Ae?Re+=Ye.point_count:Re=this._appendLeaves(qe,Ye.cluster_id,ve,Ae,Re):Re<Ae?Re++:qe.push(Qe),qe.length===ve)break}return Re}_createTree(qe){const se=new M.av(qe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<qe.length;ve+=this.stride)se.add(qe[ve],qe[ve+1]);return se.finish(),se.data=qe,se}_addTileFeatures(qe,se,ve,Ae,Re,Xe){for(const Qe of qe){const Ye=Qe*this.stride,Fe=se[Ye+hn]>1;let Me,Be,yt;if(Fe)Me=Ka(se,Ye,this.clusterProps),Be=se[Ye],yt=se[Ye+1];else{const Yr=this.points[se[Ye+Nr]];Me=Yr.properties;const[Fn,Nn]=Yr.geometry.coordinates;Be=na(Fn),yt=ca(Nn)}const zt={type:1,geometry:[[Math.round(this.options.extent*(Be*Re-ve)),Math.round(this.options.extent*(yt*Re-Ae))]],tags:Me};let Ze;Ze=Fe||this.options.generateId?se[Ye+Nr]:this.points[se[Ye+Nr]].id,Ze!==void 0&&(zt.id=Ze),Xe.features.push(zt)}}_limitZoom(qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+qe),this.options.maxZoom+1))}_cluster(qe,se){const{radius:ve,extent:Ae,reduce:Re,minPoints:Xe}=this.options,Qe=ve/(Ae*Math.pow(2,se)),Ye=qe.data,Fe=[],Me=this.stride;for(let Be=0;Be<Ye.length;Be+=Me){if(Ye[Be+2]<=se)continue;Ye[Be+2]=se;const yt=Ye[Be],zt=Ye[Be+1],Ze=qe.within(Ye[Be],Ye[Be+1],Qe),Yr=Ye[Be+hn];let Fn=Yr;for(const Nn of Ze){const qr=Nn*Me;Ye[qr+2]>se&&(Fn+=Ye[qr+hn])}if(Fn>Yr&&Fn>=Xe){let Nn,qr=yt*Yr,li=zt*Yr,zn=-1;const jn=((Be/Me|0)<<5)+(se+1)+this.points.length;for(const Ca of Ze){const ni=Ca*Me;if(Ye[ni+2]<=se)continue;Ye[ni+2]=se;const za=Ye[ni+hn];qr+=Ye[ni]*za,li+=Ye[ni+1]*za,Ye[ni+4]=jn,Re&&(Nn||(Nn=this._map(Ye,Be,!0),zn=this.clusterProps.length,this.clusterProps.push(Nn)),Re(Nn,this._map(Ye,ni)))}Ye[Be+4]=jn,Fe.push(qr/Fn,li/Fn,1/0,jn,-1,Fn),Re&&Fe.push(zn)}else{for(let Nn=0;Nn<Me;Nn++)Fe.push(Ye[Be+Nn]);if(Fn>1)for(const Nn of Ze){const qr=Nn*Me;if(!(Ye[qr+2]<=se)){Ye[qr+2]=se;for(let li=0;li<Me;li++)Fe.push(Ye[qr+li])}}}}return Fe}_getOriginId(qe){return qe-this.points.length>>5}_getOriginZoom(qe){return(qe-this.points.length)%32}_map(qe,se,ve){if(qe[se+hn]>1){const Xe=this.clusterProps[qe[se+xn]];return ve?Object.assign({},Xe):Xe}const Ae=this.points[qe[se+Nr]].properties,Re=this.options.map(Ae);return ve&&Re===Ae?Object.assign({},Re):Re}}function pi(Wt,qe,se){return{type:"Feature",id:Wt[qe+Nr],properties:Ka(Wt,qe,se),geometry:{type:"Point",coordinates:[(ve=Wt[qe],360*(ve-.5)),po(Wt[qe+1])]}};var ve}function Ka(Wt,qe,se){const ve=Wt[qe+hn],Ae=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Re=Wt[qe+xn],Xe=Re===-1?{}:Object.assign({},se[Re]);return Object.assign(Xe,{cluster:!0,cluster_id:Wt[qe+Nr],point_count:ve,point_count_abbreviated:Ae})}function na(Wt){return Wt/360+.5}function ca(Wt){const qe=Math.sin(Wt*Math.PI/180),se=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return se<0?0:se>1?1:se}function po(Wt){const qe=(180-360*Wt)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function La(Wt,qe,se,ve){for(var Ae,Re=ve,Xe=se-qe>>1,Qe=se-qe,Ye=Wt[qe],Fe=Wt[qe+1],Me=Wt[se],Be=Wt[se+1],yt=qe+3;yt<se;yt+=3){var zt=$i(Wt[yt],Wt[yt+1],Ye,Fe,Me,Be);if(zt>Re)Ae=yt,Re=zt;else if(zt===Re){var Ze=Math.abs(yt-Xe);Ze<Qe&&(Ae=yt,Qe=Ze)}}Re>ve&&(Ae-qe>3&&La(Wt,qe,Ae,ve),Wt[Ae+2]=Re,se-Ae>3&&La(Wt,Ae,se,ve))}function $i(Wt,qe,se,ve,Ae,Re){var Xe=Ae-se,Qe=Re-ve;if(Xe!==0||Qe!==0){var Ye=((Wt-se)*Xe+(qe-ve)*Qe)/(Xe*Xe+Qe*Qe);Ye>1?(se=Ae,ve=Re):Ye>0&&(se+=Xe*Ye,ve+=Qe*Ye)}return(Xe=Wt-se)*Xe+(Qe=qe-ve)*Qe}function qo(Wt,qe,se,ve){var Ae={id:Wt===void 0?null:Wt,type:qe,geometry:se,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Re){var Xe=Re.geometry,Qe=Re.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")is(Re,Xe);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ye=0;Ye<Xe.length;Ye++)is(Re,Xe[Ye]);else if(Qe==="MultiPolygon")for(Ye=0;Ye<Xe.length;Ye++)for(var Fe=0;Fe<Xe[Ye].length;Fe++)is(Re,Xe[Ye][Fe])}(Ae),Ae}function is(Wt,qe){for(var se=0;se<qe.length;se+=3)Wt.minX=Math.min(Wt.minX,qe[se]),Wt.minY=Math.min(Wt.minY,qe[se+1]),Wt.maxX=Math.max(Wt.maxX,qe[se]),Wt.maxY=Math.max(Wt.maxY,qe[se+1])}function Ko(Wt,qe,se,ve){if(qe.geometry){var Ae=qe.geometry.coordinates,Re=qe.geometry.type,Xe=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),Qe=[],Ye=qe.id;if(se.promoteId?Ye=qe.properties[se.promoteId]:se.generateId&&(Ye=ve||0),Re==="Point")Za(Ae,Qe);else if(Re==="MultiPoint")for(var Fe=0;Fe<Ae.length;Fe++)Za(Ae[Fe],Qe);else if(Re==="LineString")ha(Ae,Qe,Xe,!1);else if(Re==="MultiLineString"){if(se.lineMetrics){for(Fe=0;Fe<Ae.length;Fe++)ha(Ae[Fe],Qe=[],Xe,!1),Wt.push(qo(Ye,"LineString",Qe,qe.properties));return}Fo(Ae,Qe,Xe,!1)}else if(Re==="Polygon")Fo(Ae,Qe,Xe,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(Fe=0;Fe<qe.geometry.geometries.length;Fe++)Ko(Wt,{id:Ye,geometry:qe.geometry.geometries[Fe],properties:qe.properties},se,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<Ae.length;Fe++){var Me=[];Fo(Ae[Fe],Me,Xe,!0),Qe.push(Me)}}Wt.push(qo(Ye,Re,Qe,qe.properties))}}function Za(Wt,qe){qe.push(un(Wt[0])),qe.push(Ua(Wt[1])),qe.push(0)}function ha(Wt,qe,se,ve){for(var Ae,Re,Xe=0,Qe=0;Qe<Wt.length;Qe++){var Ye=un(Wt[Qe][0]),Fe=Ua(Wt[Qe][1]);qe.push(Ye),qe.push(Fe),qe.push(0),Qe>0&&(Xe+=ve?(Ae*Fe-Ye*Re)/2:Math.sqrt(Math.pow(Ye-Ae,2)+Math.pow(Fe-Re,2))),Ae=Ye,Re=Fe}var Me=qe.length-3;qe[2]=1,La(qe,0,Me,se),qe[Me+2]=1,qe.size=Math.abs(Xe),qe.start=0,qe.end=qe.size}function Fo(Wt,qe,se,ve){for(var Ae=0;Ae<Wt.length;Ae++){var Re=[];ha(Wt[Ae],Re,se,ve),qe.push(Re)}}function un(Wt){return Wt/360+.5}function Ua(Wt){var qe=Math.sin(Wt*Math.PI/180),se=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return se<0?0:se>1?1:se}function zr(Wt,qe,se,ve,Ae,Re,Xe,Qe){if(ve/=qe,Re>=(se/=qe)&&Xe<ve)return Wt;if(Xe<se||Re>=ve)return null;for(var Ye=[],Fe=0;Fe<Wt.length;Fe++){var Me=Wt[Fe],Be=Me.geometry,yt=Me.type,zt=Ae===0?Me.minX:Me.minY,Ze=Ae===0?Me.maxX:Me.maxY;if(zt>=se&&Ze<ve)Ye.push(Me);else if(!(Ze<se||zt>=ve)){var Yr=[];if(yt==="Point"||yt==="MultiPoint")be(Be,Yr,se,ve,Ae);else if(yt==="LineString")lt(Be,Yr,se,ve,Ae,!1,Qe.lineMetrics);else if(yt==="MultiLineString")Qt(Be,Yr,se,ve,Ae,!1);else if(yt==="Polygon")Qt(Be,Yr,se,ve,Ae,!0);else if(yt==="MultiPolygon")for(var Fn=0;Fn<Be.length;Fn++){var Nn=[];Qt(Be[Fn],Nn,se,ve,Ae,!0),Nn.length&&Yr.push(Nn)}if(Yr.length){if(Qe.lineMetrics&&yt==="LineString"){for(Fn=0;Fn<Yr.length;Fn++)Ye.push(qo(Me.id,yt,Yr[Fn],Me.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Yr.length===1?(yt="LineString",Yr=Yr[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Yr.length===3?"Point":"MultiPoint"),Ye.push(qo(Me.id,yt,Yr,Me.tags))}}}return Ye.length?Ye:null}function be(Wt,qe,se,ve,Ae){for(var Re=0;Re<Wt.length;Re+=3){var Xe=Wt[Re+Ae];Xe>=se&&Xe<=ve&&(qe.push(Wt[Re]),qe.push(Wt[Re+1]),qe.push(Wt[Re+2]))}}function lt(Wt,qe,se,ve,Ae,Re,Xe){for(var Qe,Ye,Fe=mt(Wt),Me=Ae===0?mn:Wn,Be=Wt.start,yt=0;yt<Wt.length-3;yt+=3){var zt=Wt[yt],Ze=Wt[yt+1],Yr=Wt[yt+2],Fn=Wt[yt+3],Nn=Wt[yt+4],qr=Ae===0?zt:Ze,li=Ae===0?Fn:Nn,zn=!1;Xe&&(Qe=Math.sqrt(Math.pow(zt-Fn,2)+Math.pow(Ze-Nn,2))),qr<se?li>se&&(Ye=Me(Fe,zt,Ze,Fn,Nn,se),Xe&&(Fe.start=Be+Qe*Ye)):qr>ve?li<ve&&(Ye=Me(Fe,zt,Ze,Fn,Nn,ve),Xe&&(Fe.start=Be+Qe*Ye)):xr(Fe,zt,Ze,Yr),li<se&&qr>=se&&(Ye=Me(Fe,zt,Ze,Fn,Nn,se),zn=!0),li>ve&&qr<=ve&&(Ye=Me(Fe,zt,Ze,Fn,Nn,ve),zn=!0),!Re&&zn&&(Xe&&(Fe.end=Be+Qe*Ye),qe.push(Fe),Fe=mt(Wt)),Xe&&(Be+=Qe)}var jn=Wt.length-3;zt=Wt[jn],Ze=Wt[jn+1],Yr=Wt[jn+2],(qr=Ae===0?zt:Ze)>=se&&qr<=ve&&xr(Fe,zt,Ze,Yr),jn=Fe.length-3,Re&&jn>=3&&(Fe[jn]!==Fe[0]||Fe[jn+1]!==Fe[1])&&xr(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&qe.push(Fe)}function mt(Wt){var qe=[];return qe.size=Wt.size,qe.start=Wt.start,qe.end=Wt.end,qe}function Qt(Wt,qe,se,ve,Ae,Re){for(var Xe=0;Xe<Wt.length;Xe++)lt(Wt[Xe],qe,se,ve,Ae,Re,!1)}function xr(Wt,qe,se,ve){Wt.push(qe),Wt.push(se),Wt.push(ve)}function mn(Wt,qe,se,ve,Ae,Re){var Xe=(Re-qe)/(ve-qe);return Wt.push(Re),Wt.push(se+(Ae-se)*Xe),Wt.push(1),Xe}function Wn(Wt,qe,se,ve,Ae,Re){var Xe=(Re-se)/(Ae-se);return Wt.push(qe+(ve-qe)*Xe),Wt.push(Re),Wt.push(1),Xe}function tr(Wt,qe){for(var se=[],ve=0;ve<Wt.length;ve++){var Ae,Re=Wt[ve],Xe=Re.type;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")Ae=Hr(Re.geometry,qe);else if(Xe==="MultiLineString"||Xe==="Polygon"){Ae=[];for(var Qe=0;Qe<Re.geometry.length;Qe++)Ae.push(Hr(Re.geometry[Qe],qe))}else if(Xe==="MultiPolygon")for(Ae=[],Qe=0;Qe<Re.geometry.length;Qe++){for(var Ye=[],Fe=0;Fe<Re.geometry[Qe].length;Fe++)Ye.push(Hr(Re.geometry[Qe][Fe],qe));Ae.push(Ye)}se.push(qo(Re.id,Xe,Ae,Re.tags))}return se}function Hr(Wt,qe){var se=[];se.size=Wt.size,Wt.start!==void 0&&(se.start=Wt.start,se.end=Wt.end);for(var ve=0;ve<Wt.length;ve+=3)se.push(Wt[ve]+qe,Wt[ve+1],Wt[ve+2]);return se}function dr(Wt,qe){if(Wt.transformed)return Wt;var se,ve,Ae,Re=1<<Wt.z,Xe=Wt.x,Qe=Wt.y;for(se=0;se<Wt.features.length;se++){var Ye=Wt.features[se],Fe=Ye.geometry,Me=Ye.type;if(Ye.geometry=[],Me===1)for(ve=0;ve<Fe.length;ve+=2)Ye.geometry.push(Un(Fe[ve],Fe[ve+1],qe,Re,Xe,Qe));else for(ve=0;ve<Fe.length;ve++){var Be=[];for(Ae=0;Ae<Fe[ve].length;Ae+=2)Be.push(Un(Fe[ve][Ae],Fe[ve][Ae+1],qe,Re,Xe,Qe));Ye.geometry.push(Be)}}return Wt.transformed=!0,Wt}function Un(Wt,qe,se,ve,Ae,Re){return[Math.round(se*(Wt*ve-Ae)),Math.round(se*(qe*ve-Re))]}function ti(Wt,qe,se,ve,Ae){for(var Re=qe===Ae.maxZoom?0:Ae.tolerance/((1<<qe)*Ae.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ve,z:qe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<Wt.length;Qe++){Xe.numFeatures++,Yi(Xe,Wt[Qe],Re,Ae);var Ye=Wt[Qe].minX,Fe=Wt[Qe].minY,Me=Wt[Qe].maxX,Be=Wt[Qe].maxY;Ye<Xe.minX&&(Xe.minX=Ye),Fe<Xe.minY&&(Xe.minY=Fe),Me>Xe.maxX&&(Xe.maxX=Me),Be>Xe.maxY&&(Xe.maxY=Be)}return Xe}function Yi(Wt,qe,se,ve){var Ae=qe.geometry,Re=qe.type,Xe=[];if(Re==="Point"||Re==="MultiPoint")for(var Qe=0;Qe<Ae.length;Qe+=3)Xe.push(Ae[Qe]),Xe.push(Ae[Qe+1]),Wt.numPoints++,Wt.numSimplified++;else if(Re==="LineString")ea(Xe,Ae,Wt,se,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(Qe=0;Qe<Ae.length;Qe++)ea(Xe,Ae[Qe],Wt,se,Re==="Polygon",Qe===0);else if(Re==="MultiPolygon")for(var Ye=0;Ye<Ae.length;Ye++){var Fe=Ae[Ye];for(Qe=0;Qe<Fe.length;Qe++)ea(Xe,Fe[Qe],Wt,se,!0,Qe===0)}if(Xe.length){var Me=qe.tags||null;if(Re==="LineString"&&ve.lineMetrics){for(var Be in Me={},qe.tags)Me[Be]=qe.tags[Be];Me.mapbox_clip_start=Ae.start/Ae.size,Me.mapbox_clip_end=Ae.end/Ae.size}var yt={geometry:Xe,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:Me};qe.id!==null&&(yt.id=qe.id),Wt.features.push(yt)}}function ea(Wt,qe,se,ve,Ae,Re){var Xe=ve*ve;if(ve>0&&qe.size<(Ae?Xe:ve))se.numPoints+=qe.length/3;else{for(var Qe=[],Ye=0;Ye<qe.length;Ye+=3)(ve===0||qe[Ye+2]>Xe)&&(se.numSimplified++,Qe.push(qe[Ye]),Qe.push(qe[Ye+1])),se.numPoints++;Ae&&function(Fe,Me){for(var Be=0,yt=0,zt=Fe.length,Ze=zt-2;yt<zt;Ze=yt,yt+=2)Be+=(Fe[yt]-Fe[Ze])*(Fe[yt+1]+Fe[Ze+1]);if(Be>0===Me)for(yt=0,zt=Fe.length;yt<zt/2;yt+=2){var Yr=Fe[yt],Fn=Fe[yt+1];Fe[yt]=Fe[zt-2-yt],Fe[yt+1]=Fe[zt-1-yt],Fe[zt-2-yt]=Yr,Fe[zt-1-yt]=Fn}}(Qe,Re),Wt.push(Qe)}}function on(Wt,qe){var se=(qe=this.options=function(Ae,Re){for(var Xe in Re)Ae[Xe]=Re[Xe];return Ae}(Object.create(this.options),qe)).debug;if(se&&console.time("preprocess data"),qe.maxZoom<0||qe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(qe.promoteId&&qe.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve=function(Ae,Re){var Xe=[];if(Ae.type==="FeatureCollection")for(var Qe=0;Qe<Ae.features.length;Qe++)Ko(Xe,Ae.features[Qe],Re,Qe);else Ko(Xe,Ae.type==="Feature"?Ae:{geometry:Ae},Re);return Xe}(Wt,qe);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",qe.indexMaxZoom,qe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(Ae,Re){var Xe=Re.buffer/Re.extent,Qe=Ae,Ye=zr(Ae,1,-1-Xe,Xe,0,-1,2,Re),Fe=zr(Ae,1,1-Xe,2+Xe,0,-1,2,Re);return(Ye||Fe)&&(Qe=zr(Ae,1,-Xe,1+Xe,0,-1,2,Re)||[],Ye&&(Qe=tr(Ye,1).concat(Qe)),Fe&&(Qe=Qe.concat(tr(Fe,-1)))),Qe}(ve,qe),ve.length&&this.splitTile(ve,0,0,0),se&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xn(Wt,qe,se){return 32*((1<<Wt)*se+qe)+Wt}function Pi(Wt,qe){return qe?Wt.properties[qe]:Wt.id}function Pa(Wt,qe){if(Wt==null)return!0;if(Wt.type==="Feature")return Pi(Wt,qe)!=null;if(Wt.type==="FeatureCollection"){const se=new Set;for(const ve of Wt.features){const Ae=Pi(ve,qe);if(Ae==null||se.has(Ae))return!1;se.add(Ae)}return!0}return!1}function zo(Wt,qe){const se=new Map;if(Wt!=null)if(Wt.type==="Feature")se.set(Pi(Wt,qe),Wt);else for(const ve of Wt.features)se.set(Pi(ve,qe),ve);return se}on.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},on.prototype.splitTile=function(Wt,qe,se,ve,Ae,Re,Xe){for(var Qe=[Wt,qe,se,ve],Ye=this.options,Fe=Ye.debug;Qe.length;){ve=Qe.pop(),se=Qe.pop(),qe=Qe.pop(),Wt=Qe.pop();var Me=1<<qe,Be=Xn(qe,se,ve),yt=this.tiles[Be];if(!yt&&(Fe>1&&console.time("creation"),yt=this.tiles[Be]=ti(Wt,qe,se,ve,Ye),this.tileCoords.push({z:qe,x:se,y:ve}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",qe,se,ve,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));var zt="z"+qe;this.stats[zt]=(this.stats[zt]||0)+1,this.total++}if(yt.source=Wt,Ae){if(qe===Ye.maxZoom||qe===Ae)continue;var Ze=1<<Ae-qe;if(se!==Math.floor(Re/Ze)||ve!==Math.floor(Xe/Ze))continue}else if(qe===Ye.indexMaxZoom||yt.numPoints<=Ye.indexMaxPoints)continue;if(yt.source=null,Wt.length!==0){Fe>1&&console.time("clipping");var Yr,Fn,Nn,qr,li,zn,jn=.5*Ye.buffer/Ye.extent,Ca=.5-jn,ni=.5+jn,za=1+jn;Yr=Fn=Nn=qr=null,li=zr(Wt,Me,se-jn,se+ni,0,yt.minX,yt.maxX,Ye),zn=zr(Wt,Me,se+Ca,se+za,0,yt.minX,yt.maxX,Ye),Wt=null,li&&(Yr=zr(li,Me,ve-jn,ve+ni,1,yt.minY,yt.maxY,Ye),Fn=zr(li,Me,ve+Ca,ve+za,1,yt.minY,yt.maxY,Ye),li=null),zn&&(Nn=zr(zn,Me,ve-jn,ve+ni,1,yt.minY,yt.maxY,Ye),qr=zr(zn,Me,ve+Ca,ve+za,1,yt.minY,yt.maxY,Ye),zn=null),Fe>1&&console.timeEnd("clipping"),Qe.push(Yr||[],qe+1,2*se,2*ve),Qe.push(Fn||[],qe+1,2*se,2*ve+1),Qe.push(Nn||[],qe+1,2*se+1,2*ve),Qe.push(qr||[],qe+1,2*se+1,2*ve+1)}}},on.prototype.getTile=function(Wt,qe,se){var ve=this.options,Ae=ve.extent,Re=ve.debug;if(Wt<0||Wt>24)return null;var Xe=1<<Wt,Qe=Xn(Wt,qe=(qe%Xe+Xe)%Xe,se);if(this.tiles[Qe])return dr(this.tiles[Qe],Ae);Re>1&&console.log("drilling down to z%d-%d-%d",Wt,qe,se);for(var Ye,Fe=Wt,Me=qe,Be=se;!Ye&&Fe>0;)Fe--,Me=Math.floor(Me/2),Be=Math.floor(Be/2),Ye=this.tiles[Xn(Fe,Me,Be)];return Ye&&Ye.source?(Re>1&&console.log("found parent tile z%d-%d-%d",Fe,Me,Be),Re>1&&console.time("drilling down"),this.splitTile(Ye.source,Fe,Me,Be,Wt,qe,se),Re>1&&console.timeEnd("drilling down"),this.tiles[Qe]?dr(this.tiles[Qe],Ae):null):null};class ya extends Ie{constructor(qe,se,ve,Ae){super(qe,se,ve),this._dataUpdateable=new Map,this.loadGeoJSON=(Re,Xe)=>{const{promoteId:Qe}=Re;if(Re.request)return M.f(Re.request,(Ye,Fe,Me,Be)=>{this._dataUpdateable=Pa(Fe,Qe)?zo(Fe,Qe):void 0,Xe(Ye,Fe,Me,Be)});if(typeof Re.data=="string")try{const Ye=JSON.parse(Re.data);this._dataUpdateable=Pa(Ye,Qe)?zo(Ye,Qe):void 0,Xe(null,Ye)}catch(Ye){Xe(new Error(`Input data given to '${Re.source}' is not a valid GeoJSON object.`))}else Re.dataDiff?this._dataUpdateable?(function(Ye,Fe,Me){var Be,yt,zt,Ze;if(Fe.removeAll&&Ye.clear(),Fe.remove)for(const Yr of Fe.remove)Ye.delete(Yr);if(Fe.add)for(const Yr of Fe.add){const Fn=Pi(Yr,Me);Fn!=null&&Ye.set(Fn,Yr)}if(Fe.update)for(const Yr of Fe.update){let Fn=Ye.get(Yr.id);if(Fn==null)continue;const Nn=!Yr.removeAllProperties&&(((Be=Yr.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((yt=Yr.addOrUpdateProperties)===null||yt===void 0?void 0:yt.length)>0);if((Yr.newGeometry||Yr.removeAllProperties||Nn)&&(Fn=Object.assign({},Fn),Ye.set(Yr.id,Fn),Nn&&(Fn.properties=Object.assign({},Fn.properties))),Yr.newGeometry&&(Fn.geometry=Yr.newGeometry),Yr.removeAllProperties)Fn.properties={};else if(((zt=Yr.removeProperties)===null||zt===void 0?void 0:zt.length)>0)for(const qr of Yr.removeProperties)Object.prototype.hasOwnProperty.call(Fn.properties,qr)&&delete Fn.properties[qr];if(((Ze=Yr.addOrUpdateProperties)===null||Ze===void 0?void 0:Ze.length)>0)for(const{key:qr,value:li}of Yr.addOrUpdateProperties)Fn.properties[qr]=li}}(this._dataUpdateable,Re.dataDiff,Qe),Xe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Xe(new Error(`Cannot update existing geojson data in ${Re.source}`)):Xe(new Error(`Input data given to '${Re.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Ae&&(this.loadGeoJSON=Ae)}loadGeoJSONTile(qe,se){const ve=qe.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);const Ae=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Ae)return se(null,null);const Re=new class{constructor(Qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=M.N,this.length=Qe.length,this._features=Qe}feature(Qe){return new class{constructor(Ye){this._feature=Ye,this.extent=M.N,this.type=Ye.type,this.properties=Ye.tags,"id"in Ye&&!isNaN(Ye.id)&&(this.id=parseInt(Ye.id,10))}loadGeometry(){if(this._feature.type===1){const Ye=[];for(const Fe of this._feature.geometry)Ye.push([new M.P(Fe[0],Fe[1])]);return Ye}{const Ye=[];for(const Fe of this._feature.geometry){const Me=[];for(const Be of Fe)Me.push(new M.P(Be[0],Be[1]));Ye.push(Me)}return Ye}}toGeoJSON(Ye,Fe,Me){return jt.call(this,Ye,Fe,Me)}}(this._features[Qe])}}(Ae.features);let Xe=Bt(Re);Xe.byteOffset===0&&Xe.byteLength===Xe.buffer.byteLength||(Xe=new Uint8Array(Xe)),se(null,{vectorTile:Re,rawData:Xe.buffer})}loadData(qe,se){var ve;(ve=this._pendingRequest)===null||ve===void 0||ve.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Ae=!!(qe&&qe.request&&qe.request.collectResourceTiming)&&new M.bt(qe.request);this._pendingCallback=se,this._pendingRequest=this.loadGeoJSON(qe,(Re,Xe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Re||!Xe)return se(Re);if(typeof Xe!="object")return se(new Error(`Input data given to '${qe.source}' is not a valid GeoJSON object.`));{Ct(Xe,!0);try{if(qe.filter){const Ye=M.bB(qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ye.result==="error")throw new Error(Ye.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(Me=>Ye.value.evaluate({zoom:0},Me))}}this._geoJSONIndex=qe.cluster?new Ji(function({superclusterOptions:Ye,clusterProperties:Fe}){if(!Fe||!Ye)return Ye;const Me={},Be={},yt={accumulated:null,zoom:0},zt={properties:null},Ze=Object.keys(Fe);for(const Yr of Ze){const[Fn,Nn]=Fe[Yr],qr=M.bB(Nn),li=M.bB(typeof Fn=="string"?[Fn,["accumulated"],["get",Yr]]:Fn);Me[Yr]=qr.value,Be[Yr]=li.value}return Ye.map=Yr=>{zt.properties=Yr;const Fn={};for(const Nn of Ze)Fn[Nn]=Me[Nn].evaluate(yt,zt);return Fn},Ye.reduce=(Yr,Fn)=>{zt.properties=Fn;for(const Nn of Ze)yt.accumulated=Yr[Nn],Yr[Nn]=Be[Nn].evaluate(yt,zt)},Ye}(qe)).load(Xe.features):function(Ye,Fe){return new on(Ye,Fe)}(Xe,qe.geojsonVtOptions)}catch(Ye){return se(Ye)}this.loaded={};const Qe={};if(Ae){const Ye=Ae.finish();Ye&&(Qe.resourceTiming={},Qe.resourceTiming[qe.source]=JSON.parse(JSON.stringify(Ye)))}se(null,Qe)}})}reloadTile(qe,se){const ve=this.loaded;return ve&&ve[qe.uid]?super.reloadTile(qe,se):this.loadTile(qe,se)}removeSource(qe,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),se()}getClusterExpansionZoom(qe,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(qe.clusterId))}catch(ve){se(ve)}}getClusterChildren(qe,se){try{se(null,this._geoJSONIndex.getChildren(qe.clusterId))}catch(ve){se(ve)}}getClusterLeaves(qe,se){try{se(null,this._geoJSONIndex.getLeaves(qe.clusterId,qe.limit,qe.offset))}catch(ve){se(ve)}}}class Xu{constructor(qe){this.self=qe,this.actor=new M.C(qe,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ie,geojson:ya},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(se,ve)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=ve},this.self.registerRTLTextPlugin=se=>{if(M.bC.isParsed())throw new Error("RTL text plugin already registered.");M.bC.applyArabicShaping=se.applyArabicShaping,M.bC.processBidirectionalText=se.processBidirectionalText,M.bC.processStyledBidirectionalText=se.processStyledBidirectionalText}}setReferrer(qe,se){this.referrer=se}setImages(qe,se,ve){this.availableImages[qe]=se;for(const Ae in this.workerSources[qe]){const Re=this.workerSources[qe][Ae];for(const Xe in Re)Re[Xe].availableImages=se}ve()}setLayers(qe,se,ve){this.getLayerIndex(qe).replace(se),ve()}updateLayers(qe,se,ve){this.getLayerIndex(qe).update(se.layers,se.removedIds),ve()}loadTile(qe,se,ve){this.getWorkerSource(qe,se.type,se.source).loadTile(se,ve)}loadDEMTile(qe,se,ve){this.getDEMWorkerSource(qe,se.source).loadTile(se,ve)}reloadTile(qe,se,ve){this.getWorkerSource(qe,se.type,se.source).reloadTile(se,ve)}abortTile(qe,se,ve){this.getWorkerSource(qe,se.type,se.source).abortTile(se,ve)}removeTile(qe,se,ve){this.getWorkerSource(qe,se.type,se.source).removeTile(se,ve)}removeDEMTile(qe,se){this.getDEMWorkerSource(qe,se.source).removeTile(se)}removeSource(qe,se,ve){if(!this.workerSources[qe]||!this.workerSources[qe][se.type]||!this.workerSources[qe][se.type][se.source])return;const Ae=this.workerSources[qe][se.type][se.source];delete this.workerSources[qe][se.type][se.source],Ae.removeSource!==void 0?Ae.removeSource(se,ve):ve()}loadWorkerSource(qe,se,ve){try{this.self.importScripts(se.url),ve()}catch(Ae){ve(Ae.toString())}}syncRTLPluginState(qe,se,ve){try{M.bC.setState(se);const Ae=M.bC.getPluginURL();if(M.bC.isLoaded()&&!M.bC.isParsed()&&Ae!=null){this.self.importScripts(Ae);const Re=M.bC.isParsed();ve(Re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ae}`),Re)}}catch(Ae){ve(Ae.toString())}}getAvailableImages(qe){let se=this.availableImages[qe];return se||(se=[]),se}getLayerIndex(qe){let se=this.layerIndexes[qe];return se||(se=this.layerIndexes[qe]=new ee),se}getWorkerSource(qe,se,ve){return this.workerSources[qe]||(this.workerSources[qe]={}),this.workerSources[qe][se]||(this.workerSources[qe][se]={}),this.workerSources[qe][se][ve]||(this.workerSources[qe][se][ve]=new this.workerSourceTypes[se]({send:(Ae,Re,Xe)=>{this.actor.send(Ae,Re,Xe,qe)}},this.getLayerIndex(qe),this.getAvailableImages(qe))),this.workerSources[qe][se][ve]}getDEMWorkerSource(qe,se){return this.demWorkerSources[qe]||(this.demWorkerSources[qe]={}),this.demWorkerSources[qe][se]||(this.demWorkerSources[qe][se]=new rt),this.demWorkerSources[qe][se]}}return M.i()&&(self.worker=new Xu(self)),Xu}),j(["./shared"],function(M){"use strict";var ee="3.5.2";class te{static testProp(h){if(!te.docStyle)return h[0];for(let x=0;x<h.length;x++)if(h[x]in te.docStyle)return h[x];return h[0]}static create(h,x,O){const Z=window.document.createElement(h);return x!==void 0&&(Z.className=x),O&&O.appendChild(Z),Z}static createNS(h,x){return window.document.createElementNS(h,x)}static disableDrag(){te.docStyle&&te.selectProp&&(te.userSelect=te.docStyle[te.selectProp],te.docStyle[te.selectProp]="none")}static enableDrag(){te.docStyle&&te.selectProp&&(te.docStyle[te.selectProp]=te.userSelect)}static setTransform(h,x){h.style[te.transformProp]=x}static addEventListener(h,x,O,Z={}){h.addEventListener(x,O,"passive"in Z?Z:Z.capture)}static removeEventListener(h,x,O,Z={}){h.removeEventListener(x,O,"passive"in Z?Z:Z.capture)}static suppressClickInternal(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",te.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",te.suppressClickInternal,!0)},0)}static mousePos(h,x){const O=h.getBoundingClientRect();return new M.P(x.clientX-O.left-h.clientLeft,x.clientY-O.top-h.clientTop)}static touchPos(h,x){const O=h.getBoundingClientRect(),Z=[];for(let H=0;H<x.length;H++)Z.push(new M.P(x[H].clientX-O.left-h.clientLeft,x[H].clientY-O.top-h.clientTop));return Z}static mouseButton(h){return h.button}static remove(h){h.parentNode&&h.parentNode.removeChild(h)}}te.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,te.selectProp=te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),te.transformProp=te.testProp(["transform","WebkitTransform"]);const pe={supported:!1,testSupport:function(D){!Ie&&le&&(rt?xt(D):Ce=D)}};let Ce,le,Ie=!1,rt=!1;function xt(D){const h=D.createTexture();D.bindTexture(D.TEXTURE_2D,h);try{if(D.texImage2D(D.TEXTURE_2D,0,D.RGBA,D.RGBA,D.UNSIGNED_BYTE,le),D.isContextLost())return;pe.supported=!0}catch(x){}D.deleteTexture(h),Ie=!0}var nt,Ct;typeof document!="undefined"&&(le=document.createElement("img"),le.onload=function(){Ce&&xt(Ce),Ce=null,rt=!0},le.onerror=function(){Ie=!0,Ce=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(D){let h,x,O,Z;D.resetRequestQueue=()=>{h=[],x=0,O=0,Z={}},D.addThrottleControl=Le=>{const m=O++;return Z[m]=Le,m},D.removeThrottleControl=Le=>{delete Z[Le],ue()},D.getImage=(Le,m,w=!0)=>{pe.supported&&(Le.headers||(Le.headers={}),Le.headers.accept="image/webp,*/*");const _={requestParameters:Le,supportImageRefresh:w,callback:m,cancelled:!1,completed:!1,cancel:()=>{_.completed||_.cancelled||(_.cancelled=!0,_.innerRequest&&(_.innerRequest.cancel(),x--),ue())}};return h.push(_),ue(),_};const H=Le=>{const{requestParameters:m,supportImageRefresh:w,callback:_}=Le;return M.e(m,{type:"image"}),(w!==!1||M.i()||M.g(m.url)||m.headers&&!Object.keys(m.headers).reduce((T,N)=>T&&N==="accept",!0)?M.m:ge)(m,(T,N,$,X)=>{ae(Le,_,T,N,$,X)})},ae=(Le,m,w,_,T,N)=>{w?m(w):_ instanceof HTMLImageElement||M.a(_)?m(null,_):_&&(($,X)=>{typeof createImageBitmap=="function"?M.b($,X):M.d($,X)})(_,($,X)=>{$!=null?m($):X!=null&&m(null,X,{cacheControl:T,expires:N})}),Le.cancelled||(Le.completed=!0,x--,ue())},ue=()=>{const Le=(()=>{const m=Object.keys(Z);let w=!1;if(m.length>0){for(const _ of m)if(w=Z[_](),w)break}return w})()?M.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:M.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let m=x;m<Le&&h.length>0;m++){const w=h.shift();if(w.cancelled){m--;continue}const _=H(w);x++,w.innerRequest=_}},ge=(Le,m)=>{const w=new Image,_=Le.url;let T=!1;const N=Le.credentials;return N&&N==="include"?w.crossOrigin="use-credentials":(N&&N==="same-origin"||!M.s(_))&&(w.crossOrigin="anonymous"),w.fetchPriority="high",w.onload=()=>{m(null,w),w.onerror=w.onload=null},w.onerror=()=>{T||m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),w.onerror=w.onload=null},w.src=_,{cancel:()=>{T=!0,w.src=""}}}}(nt||(nt={})),nt.resetRequestQueue(),function(D){D.Glyphs="Glyphs",D.Image="Image",D.Source="Source",D.SpriteImage="SpriteImage",D.SpriteJSON="SpriteJSON",D.Style="Style",D.Tile="Tile",D.Unknown="Unknown"}(Ct||(Ct={}));class jt{constructor(h){this._transformRequestFn=h}transformRequest(h,x){return this._transformRequestFn&&this._transformRequestFn(h,x)||{url:h}}normalizeSpriteURL(h,x,O){const Z=function(H){const ae=H.match(Vt);if(!ae)throw new Error(`Unable to parse URL "${H}"`);return{protocol:ae[1],authority:ae[2],path:ae[3]||"/",params:ae[4]?ae[4].split("&"):[]}}(h);return Z.path+=`${x}${O}`,function(H){const ae=H.params.length?`?${H.params.join("&")}`:"";return`${H.protocol}://${H.authority}${H.path}${ae}`}(Z)}setTransformRequest(h){this._transformRequestFn=h}}const Vt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Rt(D){var h=new M.A(3);return h[0]=D[0],h[1]=D[1],h[2]=D[2],h}var hr,er=function(D,h,x){return D[0]=h[0]-x[0],D[1]=h[1]-x[1],D[2]=h[2]-x[2],D};hr=new M.A(3),M.A!=Float32Array&&(hr[0]=0,hr[1]=0,hr[2]=0);var gn=function(D){var h=D[0],x=D[1];return h*h+x*x};function Rr(D){const h=[];if(typeof D=="string")h.push({id:"default",url:D});else if(D&&D.length>0){const x=[];for(const{id:O,url:Z}of D){const H=`${O}${Z}`;x.indexOf(H)===-1&&(x.push(H),h.push({id:O,url:Z}))}}return h}function vn(D,h,x,O,Z){if(O)return void D(O);if(Z!==Object.values(h).length||Z!==Object.values(x).length)return;const H={};for(const ae in h){H[ae]={};const ue=M.h.getImageCanvasContext(x[ae]),ge=h[ae];for(const Le in ge){const{width:m,height:w,x:_,y:T,sdf:N,pixelRatio:$,stretchX:X,stretchY:oe,content:xe}=ge[Le];H[ae][Le]={data:null,pixelRatio:$,sdf:N,stretchX:X,stretchY:oe,content:xe,spriteData:{width:m,height:w,x:_,y:T,context:ue}}}}D(null,H)}(function(){var D=new M.A(2);M.A!=Float32Array&&(D[0]=0,D[1]=0)})();class rr{constructor(h,x,O,Z){this.context=h,this.format=O,this.texture=h.gl.createTexture(),this.update(x,Z)}update(h,x,O){const{width:Z,height:H}=h,ae=!(this.size&&this.size[0]===Z&&this.size[1]===H||O),{context:ue}=this,{gl:ge}=ue;if(this.useMipmap=!!(x&&x.useMipmap),ge.bindTexture(ge.TEXTURE_2D,this.texture),ue.pixelStoreUnpackFlipY.set(!1),ue.pixelStoreUnpack.set(1),ue.pixelStoreUnpackPremultiplyAlpha.set(this.format===ge.RGBA&&(!x||x.premultiply!==!1)),ae)this.size=[Z,H],h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||M.a(h)?ge.texImage2D(ge.TEXTURE_2D,0,this.format,this.format,ge.UNSIGNED_BYTE,h):ge.texImage2D(ge.TEXTURE_2D,0,this.format,Z,H,0,this.format,ge.UNSIGNED_BYTE,h.data);else{const{x:Le,y:m}=O||{x:0,y:0};h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||M.a(h)?ge.texSubImage2D(ge.TEXTURE_2D,0,Le,m,ge.RGBA,ge.UNSIGNED_BYTE,h):ge.texSubImage2D(ge.TEXTURE_2D,0,Le,m,Z,H,ge.RGBA,ge.UNSIGNED_BYTE,h.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ge.generateMipmap(ge.TEXTURE_2D)}bind(h,x,O){const{context:Z}=this,{gl:H}=Z;H.bindTexture(H.TEXTURE_2D,this.texture),O!==H.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(O=H.LINEAR),h!==this.filter&&(H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,h),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,O||h),this.filter=h),x!==this.wrap&&(H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,x),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}}function Jt(D){const{userImage:h}=D;return!!(h&&h.render&&h.render())&&(D.data.replace(new Uint8Array(h.data.buffer)),!0)}class br extends M.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new M.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(h){if(this.loaded!==h&&(this.loaded=h,h)){for(const{ids:x,callback:O}of this.requestors)this._notify(x,O);this.requestors=[]}}getImage(h){const x=this.images[h];if(x&&!x.data&&x.spriteData){const O=x.spriteData;x.data=new M.R({width:O.width,height:O.height},O.context.getImageData(O.x,O.y,O.width,O.height).data),x.spriteData=null}return x}addImage(h,x){if(this.images[h])throw new Error(`Image id ${h} already exist, use updateImage instead`);this._validate(h,x)&&(this.images[h]=x)}_validate(h,x){let O=!0;const Z=x.data||x.spriteData;return this._validateStretch(x.stretchX,Z&&Z.width)||(this.fire(new M.j(new Error(`Image "${h}" has invalid "stretchX" value`))),O=!1),this._validateStretch(x.stretchY,Z&&Z.height)||(this.fire(new M.j(new Error(`Image "${h}" has invalid "stretchY" value`))),O=!1),this._validateContent(x.content,x)||(this.fire(new M.j(new Error(`Image "${h}" has invalid "content" value`))),O=!1),O}_validateStretch(h,x){if(!h)return!0;let O=0;for(const Z of h){if(Z[0]<O||Z[1]<Z[0]||x<Z[1])return!1;O=Z[1]}return!0}_validateContent(h,x){if(!h)return!0;if(h.length!==4)return!1;const O=x.spriteData,Z=O&&O.width||x.data.width,H=O&&O.height||x.data.height;return!(h[0]<0||Z<h[0]||h[1]<0||H<h[1]||h[2]<0||Z<h[2]||h[3]<0||H<h[3]||h[2]<h[0]||h[3]<h[1])}updateImage(h,x,O=!0){const Z=this.getImage(h);if(O&&(Z.data.width!==x.data.width||Z.data.height!==x.data.height))throw new Error(`size mismatch between old image (${Z.data.width}x${Z.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=Z.version+1,this.images[h]=x,this.updatedImages[h]=!0}removeImage(h){const x=this.images[h];delete this.images[h],delete this.patterns[h],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(h,x){let O=!0;if(!this.isLoaded())for(const Z of h)this.images[Z]||(O=!1);this.isLoaded()||O?this._notify(h,x):this.requestors.push({ids:h,callback:x})}_notify(h,x){const O={};for(const Z of h){let H=this.getImage(Z);H||(this.fire(new M.k("styleimagemissing",{id:Z})),H=this.getImage(Z)),H?O[Z]={data:H.data.clone(),pixelRatio:H.pixelRatio,sdf:H.sdf,version:H.version,stretchX:H.stretchX,stretchY:H.stretchY,content:H.content,hasRenderCallback:!!(H.userImage&&H.userImage.render)}:M.w(`Image "${Z}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,O)}getPixelSize(){const{width:h,height:x}=this.atlasImage;return{width:h,height:x}}getPattern(h){const x=this.patterns[h],O=this.getImage(h);if(!O)return null;if(x&&x.position.version===O.version)return x.position;if(x)x.position.version=O.version;else{const Z={w:O.data.width+2,h:O.data.height+2,x:0,y:0},H=new M.I(Z,O);this.patterns[h]={bin:Z,position:H}}return this._updatePatternAtlas(),this.patterns[h].position}bind(h){const x=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new rr(h,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){const h=[];for(const H in this.patterns)h.push(this.patterns[H].bin);const{w:x,h:O}=M.p(h),Z=this.atlasImage;Z.resize({width:x||1,height:O||1});for(const H in this.patterns){const{bin:ae}=this.patterns[H],ue=ae.x+1,ge=ae.y+1,Le=this.getImage(H).data,m=Le.width,w=Le.height;M.R.copy(Le,Z,{x:0,y:0},{x:ue,y:ge},{width:m,height:w}),M.R.copy(Le,Z,{x:0,y:w-1},{x:ue,y:ge-1},{width:m,height:1}),M.R.copy(Le,Z,{x:0,y:0},{x:ue,y:ge+w},{width:m,height:1}),M.R.copy(Le,Z,{x:m-1,y:0},{x:ue-1,y:ge},{width:1,height:w}),M.R.copy(Le,Z,{x:0,y:0},{x:ue+m,y:ge},{width:1,height:w})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(h){for(const x of h){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;const O=this.getImage(x);O||M.w(`Image with ID: "${x}" was not found`),Jt(O)&&this.updateImage(x,O)}}}const or=1e20;function Br(D,h,x,O,Z,H,ae,ue,ge){for(let Le=h;Le<h+O;Le++)an(D,x*H+Le,H,Z,ae,ue,ge);for(let Le=x;Le<x+Z;Le++)an(D,Le*H+h,1,O,ae,ue,ge)}function an(D,h,x,O,Z,H,ae){H[0]=0,ae[0]=-or,ae[1]=or,Z[0]=D[h];for(let ue=1,ge=0,Le=0;ue<O;ue++){Z[ue]=D[h+ue*x];const m=ue*ue;do{const w=H[ge];Le=(Z[ue]-Z[w]+m-w*w)/(ue-w)/2}while(Le<=ae[ge]&&--ge>-1);ge++,H[ge]=ue,ae[ge]=Le,ae[ge+1]=or}for(let ue=0,ge=0;ue<O;ue++){for(;ae[ge+1]<ue;)ge++;const Le=H[ge],m=ue-Le;D[h+ue*x]=Z[Le]+m*m}}class ot{constructor(h,x){this.requestManager=h,this.localIdeographFontFamily=x,this.entries={}}setURL(h){this.url=h}getGlyphs(h,x){const O=[];for(const Z in h)for(const H of h[Z])O.push({stack:Z,id:H});M.o(O,({stack:Z,id:H},ae)=>{let ue=this.entries[Z];ue||(ue=this.entries[Z]={glyphs:{},requests:{},ranges:{}});let ge=ue.glyphs[H];if(ge!==void 0)return void ae(null,{stack:Z,id:H,glyph:ge});if(ge=this._tinySDF(ue,Z,H),ge)return ue.glyphs[H]=ge,void ae(null,{stack:Z,id:H,glyph:ge});const Le=Math.floor(H/256);if(256*Le>65535)return void ae(new Error("glyphs > 65535 not supported"));if(ue.ranges[Le])return void ae(null,{stack:Z,id:H,glyph:ge});if(!this.url)return void ae(new Error("glyphsUrl is not set"));let m=ue.requests[Le];m||(m=ue.requests[Le]=[],ot.loadGlyphRange(Z,Le,this.url,this.requestManager,(w,_)=>{if(_){for(const T in _)this._doesCharSupportLocalGlyph(+T)||(ue.glyphs[+T]=_[+T]);ue.ranges[Le]=!0}for(const T of m)T(w,_);delete ue.requests[Le]})),m.push((w,_)=>{w?ae(w):_&&ae(null,{stack:Z,id:H,glyph:_[H]||null})})},(Z,H)=>{if(Z)x(Z);else if(H){const ae={};for(const{stack:ue,id:ge,glyph:Le}of H)(ae[ue]||(ae[ue]={}))[ge]=Le&&{id:Le.id,bitmap:Le.bitmap.clone(),metrics:Le.metrics};x(null,ae)}})}_doesCharSupportLocalGlyph(h){return!!this.localIdeographFontFamily&&(M.u["CJK Unified Ideographs"](h)||M.u["Hangul Syllables"](h)||M.u.Hiragana(h)||M.u.Katakana(h))}_tinySDF(h,x,O){const Z=this.localIdeographFontFamily;if(!Z||!this._doesCharSupportLocalGlyph(O))return;let H=h.tinySDF;if(!H){let ue="400";/bold/i.test(x)?ue="900":/medium/i.test(x)?ue="500":/light/i.test(x)&&(ue="200"),H=h.tinySDF=new ot.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:Z,fontWeight:ue})}const ae=H.draw(String.fromCharCode(O));return{id:O,bitmap:new M.q({width:ae.width||60,height:ae.height||60},ae.data),metrics:{width:ae.glyphWidth/2||24,height:ae.glyphHeight/2||24,left:ae.glyphLeft/2+.5||0,top:ae.glyphTop/2-27.5||-8,advance:ae.glyphAdvance/2||24,isDoubleResolution:!0}}}}ot.loadGlyphRange=function(D,h,x,O,Z){const H=256*h,ae=H+255,ue=O.transformRequest(x.replace("{fontstack}",D).replace("{range}",`${H}-${ae}`),Ct.Glyphs);M.l(ue,(ge,Le)=>{if(ge)Z(ge);else if(Le){const m={};for(const w of M.n(Le))m[w.id]=w;Z(null,m)}})},ot.TinySDF=class{constructor({fontSize:D=24,buffer:h=3,radius:x=8,cutoff:O=.25,fontFamily:Z="sans-serif",fontWeight:H="normal",fontStyle:ae="normal"}={}){this.buffer=h,this.cutoff=O,this.radius=x;const ue=this.size=D+4*h,ge=this._createCanvas(ue),Le=this.ctx=ge.getContext("2d",{willReadFrequently:!0});Le.font=`${ae} ${H} ${D}px ${Z}`,Le.textBaseline="alphabetic",Le.textAlign="left",Le.fillStyle="black",this.gridOuter=new Float64Array(ue*ue),this.gridInner=new Float64Array(ue*ue),this.f=new Float64Array(ue),this.z=new Float64Array(ue+1),this.v=new Uint16Array(ue)}_createCanvas(D){const h=document.createElement("canvas");return h.width=h.height=D,h}draw(D){const{width:h,actualBoundingBoxAscent:x,actualBoundingBoxDescent:O,actualBoundingBoxLeft:Z,actualBoundingBoxRight:H}=this.ctx.measureText(D),ae=Math.ceil(x),ue=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(H-Z))),ge=Math.min(this.size-this.buffer,ae+Math.ceil(O)),Le=ue+2*this.buffer,m=ge+2*this.buffer,w=Math.max(Le*m,0),_=new Uint8ClampedArray(w),T={data:_,width:Le,height:m,glyphWidth:ue,glyphHeight:ge,glyphTop:ae,glyphLeft:0,glyphAdvance:h};if(ue===0||ge===0)return T;const{ctx:N,buffer:$,gridInner:X,gridOuter:oe}=this;N.clearRect($,$,ue,ge),N.fillText(D,$,$+ae);const xe=N.getImageData($,$,ue,ge);oe.fill(or,0,w),X.fill(0,0,w);for(let ye=0;ye<ge;ye++)for(let De=0;De<ue;De++){const He=xe.data[4*(ye*ue+De)+3]/255;if(He===0)continue;const $e=(ye+$)*Le+De+$;if(He===1)oe[$e]=0,X[$e]=or;else{const ft=.5-He;oe[$e]=ft>0?ft*ft:0,X[$e]=ft<0?ft*ft:0}}Br(oe,0,0,Le,m,Le,this.f,this.v,this.z),Br(X,$,$,ue,ge,Le,this.f,this.v,this.z);for(let ye=0;ye<w;ye++){const De=Math.sqrt(oe[ye])-Math.sqrt(X[ye]);_[ye]=Math.round(255-255*(De/this.radius+this.cutoff))}return T}};class Dt{constructor(){this.specification=M.v.light.position}possiblyEvaluate(h,x){return M.z(h.expression.evaluate(x))}interpolate(h,x,O){return{x:M.B.number(h.x,x.x,O),y:M.B.number(h.y,x.y,O),z:M.B.number(h.z,x.z,O)}}}let Ee;class Bt extends M.E{constructor(h){super(),Ee=Ee||new M.r({anchor:new M.D(M.v.light.anchor),position:new Dt,color:new M.D(M.v.light.color),intensity:new M.D(M.v.light.intensity)}),this._transitionable=new M.T(Ee),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,x={}){if(!this._validate(M.t,h,x))for(const O in h){const Z=h[O];O.endsWith("-transition")?this._transitionable.setTransition(O.slice(0,-11),Z):this._transitionable.setValue(O,Z)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,x,O){return(!O||O.validate!==!1)&&M.x(this,h.call(M.y,M.e({value:x,style:{glyphs:!0,sprite:!0},styleSpec:M.v})))}}class Ot{constructor(h,x){this.width=h,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(h,x){const O=h.join(",")+String(x);return this.dashEntry[O]||(this.dashEntry[O]=this.addDash(h,x)),this.dashEntry[O]}getDashRanges(h,x,O){const Z=[];let H=h.length%2==1?-h[h.length-1]*O:0,ae=h[0]*O,ue=!0;Z.push({left:H,right:ae,isDash:ue,zeroLength:h[0]===0});let ge=h[0];for(let Le=1;Le<h.length;Le++){ue=!ue;const m=h[Le];H=ge*O,ge+=m,ae=ge*O,Z.push({left:H,right:ae,isDash:ue,zeroLength:m===0})}return Z}addRoundDash(h,x,O){const Z=x/2;for(let H=-O;H<=O;H++){const ae=this.width*(this.nextRow+O+H);let ue=0,ge=h[ue];for(let Le=0;Le<this.width;Le++){Le/ge.right>1&&(ge=h[++ue]);const m=Math.abs(Le-ge.left),w=Math.abs(Le-ge.right),_=Math.min(m,w);let T;const N=H/O*(Z+1);if(ge.isDash){const $=Z-Math.abs(N);T=Math.sqrt(_*_+$*$)}else T=Z-Math.sqrt(_*_+N*N);this.data[ae+Le]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(h){for(let ue=h.length-1;ue>=0;--ue){const ge=h[ue],Le=h[ue+1];ge.zeroLength?h.splice(ue,1):Le&&Le.isDash===ge.isDash&&(Le.left=ge.left,h.splice(ue,1))}const x=h[0],O=h[h.length-1];x.isDash===O.isDash&&(x.left=O.left-this.width,O.right=x.right+this.width);const Z=this.width*this.nextRow;let H=0,ae=h[H];for(let ue=0;ue<this.width;ue++){ue/ae.right>1&&(ae=h[++H]);const ge=Math.abs(ue-ae.left),Le=Math.abs(ue-ae.right),m=Math.min(ge,Le);this.data[Z+ue]=Math.max(0,Math.min(255,(ae.isDash?m:-m)+128))}}addDash(h,x){const O=x?7:0,Z=2*O+1;if(this.nextRow+Z>this.height)return M.w("LineAtlas out of space"),null;let H=0;for(let ue=0;ue<h.length;ue++)H+=h[ue];if(H!==0){const ue=this.width/H,ge=this.getDashRanges(h,this.width,ue);x?this.addRoundDash(ge,ue,O):this.addRegularDash(ge)}const ae={y:(this.nextRow+O+.5)/this.height,height:2*O/this.height,width:H};return this.nextRow+=Z,this.dirty=!0,ae}bind(h){const x=h.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}class Pr{constructor(h,x,O){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=O;const Z=this.workerPool.acquire(O);for(let H=0;H<Z.length;H++){const ae=new M.C(Z[H],x,O);ae.name=`Worker ${H}`,this.actors.push(ae)}if(!this.actors.length)throw new Error("No actors found")}broadcast(h,x,O){M.o(this.actors,(Z,H)=>{Z.send(h,x,H)},O=O||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(h=!0){this.actors.forEach(x=>{x.remove()}),this.actors=[],h&&this.workerPool.release(this.id)}}function Fr(D,h,x){const O=function(Z,H){if(Z)return x(Z);if(H){const ae=M.F(M.e(H,D),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);H.vector_layers&&(ae.vectorLayers=H.vector_layers,ae.vectorLayerIds=ae.vectorLayers.map(ue=>ue.id)),x(null,ae)}};return D.url?M.f(h.transformRequest(D.url,Ct.Source),O):M.h.frame(()=>O(null,D))}class Nr{constructor(h,x){h&&(x?this.setSouthWest(h).setNorthEast(x):Array.isArray(h)&&(h.length===4?this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]]):this.setSouthWest(h[0]).setNorthEast(h[1])))}setNorthEast(h){return this._ne=h instanceof M.L?new M.L(h.lng,h.lat):M.L.convert(h),this}setSouthWest(h){return this._sw=h instanceof M.L?new M.L(h.lng,h.lat):M.L.convert(h),this}extend(h){const x=this._sw,O=this._ne;let Z,H;if(h instanceof M.L)Z=h,H=h;else{if(!(h instanceof Nr))return Array.isArray(h)?h.length===4||h.every(Array.isArray)?this.extend(Nr.convert(h)):this.extend(M.L.convert(h)):h&&("lng"in h||"lon"in h)&&"lat"in h?this.extend(M.L.convert(h)):this;if(Z=h._sw,H=h._ne,!Z||!H)return this}return x||O?(x.lng=Math.min(Z.lng,x.lng),x.lat=Math.min(Z.lat,x.lat),O.lng=Math.max(H.lng,O.lng),O.lat=Math.max(H.lat,O.lat)):(this._sw=new M.L(Z.lng,Z.lat),this._ne=new M.L(H.lng,H.lat)),this}getCenter(){return new M.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new M.L(this.getWest(),this.getNorth())}getSouthEast(){return new M.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(h){const{lng:x,lat:O}=M.L.convert(h);let Z=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(Z=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=O&&O<=this._ne.lat&&Z}static convert(h){return h instanceof Nr?h:h&&new Nr(h)}static fromLngLat(h,x=0){const O=360*x/40075017,Z=O/Math.cos(Math.PI/180*h.lat);return new Nr(new M.L(h.lng-Z,h.lat-O),new M.L(h.lng+Z,h.lat+O))}}class hn{constructor(h,x,O){this.bounds=Nr.convert(this.validateBounds(h)),this.minzoom=x||0,this.maxzoom=O||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){const x=Math.pow(2,h.z),O=Math.floor(M.G(this.bounds.getWest())*x),Z=Math.floor(M.H(this.bounds.getNorth())*x),H=Math.ceil(M.G(this.bounds.getEast())*x),ae=Math.ceil(M.H(this.bounds.getSouth())*x);return h.x>=O&&h.x<H&&h.y>=Z&&h.y<ae}}class xn extends M.E{constructor(h,x,O,Z){if(super(),this.load=()=>{this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Fr(this._options,this.map._requestManager,(H,ae)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),H?this.fire(new M.j(H)):ae&&(M.e(this,ae),ae.bounds&&(this.tileBounds=new hn(ae.bounds,this.minzoom,this.maxzoom)),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>M.e({},this._options),this.id=h,this.dispatcher=O,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,M.e(this,M.F(x,["url","scheme","tileSize","promoteId"])),this._options=M.e({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(Z)}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(h,x){const O=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Z={request:this.map._requestManager.transformRequest(O,Ct.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function H(ae,ue){return delete h.request,h.aborted?x(null):ae&&ae.status!==404?x(ae):(ue&&ue.resourceTiming&&(h.resourceTiming=ue.resourceTiming),this.map._refreshExpiredTiles&&ue&&h.setExpiryData(ue),h.loadVectorData(ue,this.map.painter),x(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}Z.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=x:h.request=h.actor.send("reloadTile",Z,H.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",Z,H.bind(this)))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ji extends M.E{constructor(h,x,O,Z){super(),this.id=h,this.dispatcher=O,this.setEventedParent(Z),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=M.e({type:"raster"},x),M.e(this,M.F(x,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Fr(this._options,this.map._requestManager,(h,x)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new M.j(h)):x&&(M.e(this,x),x.bounds&&(this.tileBounds=new hn(x.bounds,this.minzoom,this.maxzoom)),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}serialize(){return M.e({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,x){const O=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);h.request=nt.getImage(this.map._requestManager.transformRequest(O,Ct.Tile),(Z,H,ae)=>{if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(Z)h.state="errored",x(Z);else if(H){this.map._refreshExpiredTiles&&ae&&h.setExpiryData(ae);const ue=this.map.painter.context,ge=ue.gl;h.texture=this.map.painter.getTileTexture(H.width),h.texture?h.texture.update(H,{useMipmap:!0}):(h.texture=new rr(ue,H,ge.RGBA,{useMipmap:!0}),h.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE,ge.LINEAR_MIPMAP_NEAREST),ue.extTextureFilterAnisotropic&&ge.texParameterf(ge.TEXTURE_2D,ue.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ue.extTextureFilterAnisotropicMax)),h.state="loaded",x(null)}},this.map._refreshExpiredTiles)}abortTile(h,x){h.request&&(h.request.cancel(),delete h.request),x()}unloadTile(h,x){h.texture&&this.map.painter.saveTileTexture(h.texture),x()}hasTransition(){return!1}}class pi extends Ji{constructor(h,x,O,Z){super(h,x,O,Z),this.type="raster-dem",this.maxzoom=22,this._options=M.e({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox",this.redFactor=x.redFactor,this.greenFactor=x.greenFactor,this.blueFactor=x.blueFactor,this.baseShift=x.baseShift}loadTile(h,x){const O=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Z=this.map._requestManager.transformRequest(O,Ct.Tile);function H(ae,ue){ae&&(h.state="errored",x(ae)),ue&&(h.dem=ue,h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0,h.state="loaded",x(null))}h.neighboringTiles=this._getNeighboringTiles(h.tileID),h.request=nt.getImage(Z,(ae,ue,ge)=>M._(this,void 0,void 0,function*(){if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(ae)h.state="errored",x(ae);else if(ue){this.map._refreshExpiredTiles&&h.setExpiryData(ge);const Le=M.a(ue)&&M.J()?ue:yield function(w){return M._(this,void 0,void 0,function*(){if(typeof VideoFrame!="undefined"&&M.K()){const _=w.width+2,T=w.height+2;try{return new M.R({width:_,height:T},yield M.M(w,-1,-1,_,T))}catch(N){}}return M.h.getImageData(w,1)})}(ue),m={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:Le,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",m,H))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(h){const x=h.canonical,O=Math.pow(2,x.z),Z=(x.x-1+O)%O,H=x.x===0?h.wrap-1:h.wrap,ae=(x.x+1+O)%O,ue=x.x+1===O?h.wrap+1:h.wrap,ge={};return ge[new M.O(h.overscaledZ,H,x.z,Z,x.y).key]={backfilled:!1},ge[new M.O(h.overscaledZ,ue,x.z,ae,x.y).key]={backfilled:!1},x.y>0&&(ge[new M.O(h.overscaledZ,H,x.z,Z,x.y-1).key]={backfilled:!1},ge[new M.O(h.overscaledZ,h.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},ge[new M.O(h.overscaledZ,ue,x.z,ae,x.y-1).key]={backfilled:!1}),x.y+1<O&&(ge[new M.O(h.overscaledZ,H,x.z,Z,x.y+1).key]={backfilled:!1},ge[new M.O(h.overscaledZ,h.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},ge[new M.O(h.overscaledZ,ue,x.z,ae,x.y+1).key]={backfilled:!1}),ge}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})}}class Ka extends M.E{constructor(h,x,O,Z){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>M.e({},this._options,{type:this.type,data:this._data}),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=O.getActor(),this.setEventedParent(Z),this._data=x.data,this._options=M.e({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;const H=M.N/this.tileSize;this.workerOptions=M.e({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*H,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*H,extent:M.N,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:M.N,radius:(x.clusterRadius||50)*H,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(h){this.map=h,this.load()}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){return this._updateWorkerData(h),this}setClusterOptions(h){return this.workerOptions.cluster=h.cluster,h&&(h.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=h.clusterRadius),h.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=h.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(h,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},x),this}getClusterChildren(h,x){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},x),this}getClusterLeaves(h,x,O,Z){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:x,offset:O},Z),this}_updateWorkerData(h){const x=M.e({},this.workerOptions);h?x.dataDiff=h:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(M.h.resolveURL(this._data),Ct.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new M.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,x,(O,Z)=>{if(this._pendingLoads--,this._removed||Z&&Z.abandoned)return void this.fire(new M.k("dataabort",{dataType:"source"}));let H=null;if(Z&&Z.resourceTiming&&Z.resourceTiming[this.id]&&(H=Z.resourceTiming[this.id].slice(0)),O)return void this.fire(new M.j(O));const ae={dataType:"source"};this._collectResourceTiming&&H&&H.length>0&&M.e(ae,{resourceTiming:H}),this.fire(new M.k("data",Object.assign(Object.assign({},ae),{sourceDataType:"metadata"}))),this.fire(new M.k("data",Object.assign(Object.assign({},ae),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(h,x){const O=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const Z={type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request=this.actor.send(O,Z,(H,ae)=>(delete h.request,h.unloadVectorData(),h.aborted?x(null):H?x(H):(h.loadVectorData(ae,this.map.painter,O==="reloadTile"),x(null))))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var na=M.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ca extends M.E{constructor(h,x,O,Z){super(),this.load=(H,ae)=>{this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=nt.getImage(this.map._requestManager.transformRequest(this.url,Ct.Image),(ue,ge)=>{this._request=null,this._loaded=!0,ue?this.fire(new M.j(ue)):ge&&(this.image=ge,H&&(this.coordinates=H),ae&&ae(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const H=this.map.painter.context,ae=H.gl;this.boundsBuffer||(this.boundsBuffer=H.createVertexBuffer(this._boundsArray,na.members)),this.boundsSegments||(this.boundsSegments=M.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new rr(H,this.image,ae.RGBA),this.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE));let ue=!1;for(const ge in this.tiles){const Le=this.tiles[ge];Le.state!=="loaded"&&(Le.state="loaded",Le.texture=this.texture,ue=!0)}ue&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=h,this.dispatcher=O,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(Z),this.options=x}loaded(){return this._loaded}updateImage(h){return h.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=h.url,this.load(h.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(h){this.map=h,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(h){this.coordinates=h;const x=h.map(M.U.fromLngLat);this.tileID=function(Z){let H=1/0,ae=1/0,ue=-1/0,ge=-1/0;for(const _ of Z)H=Math.min(H,_.x),ae=Math.min(ae,_.y),ue=Math.max(ue,_.x),ge=Math.max(ge,_.y);const Le=Math.max(ue-H,ge-ae),m=Math.max(0,Math.floor(-Math.log(Le)/Math.LN2)),w=Math.pow(2,m);return new M.W(m,Math.floor((H+ue)/2*w),Math.floor((ae+ge)/2*w))}(x),this.minzoom=this.maxzoom=this.tileID.z;const O=x.map(Z=>this.tileID.getTilePoint(Z)._round());return this._boundsArray=new M.V,this._boundsArray.emplaceBack(O[0].x,O[0].y,0,0),this._boundsArray.emplaceBack(O[1].x,O[1].y,M.N,0),this._boundsArray.emplaceBack(O[3].x,O[3].y,0,M.N),this._boundsArray.emplaceBack(O[2].x,O[2].y,M.N,M.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(h,x){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},x(null)):(h.state="errored",x(null))}hasTransition(){return!1}}class po extends ca{constructor(h,x,O,Z){super(h,x,O,Z),this.load=()=>{this._loaded=!1;const H=this.options;this.urls=[];for(const ae of H.urls)this.urls.push(this.map._requestManager.transformRequest(ae,Ct.Source).url);M.X(this.urls,(ae,ue)=>{this._loaded=!0,ae?this.fire(new M.j(ae)):ue&&(this.video=ue,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const H=this.map.painter.context,ae=H.gl;this.boundsBuffer||(this.boundsBuffer=H.createVertexBuffer(this._boundsArray,na.members)),this.boundsSegments||(this.boundsSegments=M.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ae.texSubImage2D(ae.TEXTURE_2D,0,0,0,ae.RGBA,ae.UNSIGNED_BYTE,this.video)):(this.texture=new rr(H,this.video,ae.RGBA),this.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE));let ue=!1;for(const ge in this.tiles){const Le=this.tiles[ge];Le.state!=="loaded"&&(Le.state="loaded",Le.texture=this.texture,ue=!0)}ue&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=x}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const x=this.video.seekable;h<x.start(0)||h>x.end(0)?this.fire(new M.j(new M.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class La extends ca{constructor(h,x,O,Z){super(h,x,O,Z),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new M.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let H=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,H=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,H=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const ae=this.map.painter.context,ue=ae.gl;this.boundsBuffer||(this.boundsBuffer=ae.createVertexBuffer(this._boundsArray,na.members)),this.boundsSegments||(this.boundsSegments=M.S.simpleSegment(0,0,4,2)),this.texture?(H||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new rr(ae,this.canvas,ue.RGBA,{premultiply:!0});let ge=!1;for(const Le in this.tiles){const m=this.tiles[Le];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,ge=!0)}ge&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(H=>!Array.isArray(H)||H.length!==2||H.some(ae=>typeof ae!="number"))||this.fire(new M.j(new M.Y(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new M.j(new M.Y(`sources.${h}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new M.j(new M.Y(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new M.j(new M.Y(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new M.j(new M.Y(`sources.${h}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}const $i={},qo=D=>{switch(D){case"geojson":return Ka;case"image":return ca;case"raster":return Ji;case"raster-dem":return pi;case"vector":return xn;case"video":return po;case"canvas":return La}return $i[D]};function is(D,h){const x=M.Z();return M.$(x,x,[1,1,0]),M.a0(x,x,[.5*D.width,.5*D.height,1]),M.a1(x,x,D.calculatePosMatrix(h.toUnwrapped()))}function Ko(D,h,x,O,Z,H){const ae=function(w,_,T){if(w)for(const N of w){const $=_[N];if($&&$.source===T&&$.type==="fill-extrusion")return!0}else for(const N in _){const $=_[N];if($.source===T&&$.type==="fill-extrusion")return!0}return!1}(Z&&Z.layers,h,D.id),ue=H.maxPitchScaleFactor(),ge=D.tilesIn(O,ue,ae);ge.sort(Za);const Le=[];for(const w of ge)Le.push({wrappedTileID:w.tileID.wrapped().key,queryResults:w.tile.queryRenderedFeatures(h,x,D._state,w.queryGeometry,w.cameraQueryGeometry,w.scale,Z,H,ue,is(D.transform,w.tileID))});const m=function(w){const _={},T={};for(const N of w){const $=N.queryResults,X=N.wrappedTileID,oe=T[X]=T[X]||{};for(const xe in $){const ye=$[xe],De=oe[xe]=oe[xe]||{},He=_[xe]=_[xe]||[];for(const $e of ye)De[$e.featureIndex]||(De[$e.featureIndex]=!0,He.push($e))}}return _}(Le);for(const w in m)m[w].forEach(_=>{const T=_.feature,N=D.getFeatureState(T.layer["source-layer"],T.id);T.source=T.layer.source,T.layer["source-layer"]&&(T.sourceLayer=T.layer["source-layer"]),T.state=N});return m}function Za(D,h){const x=D.tileID,O=h.tileID;return x.overscaledZ-O.overscaledZ||x.canonical.y-O.canonical.y||x.wrap-O.wrap||x.canonical.x-O.canonical.x}class ha{constructor(h,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=h,this.uid=M.a2(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(h){const x=h+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(h){this.demTexture&&h.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(h,x,O){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",h){h.featureIndex&&(this.latestFeatureIndex=h.featureIndex,h.rawTileData?(this.latestRawTileData=h.rawTileData,this.latestFeatureIndex.rawTileData=h.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=h.collisionBoxArray,this.buckets=function(Z,H){const ae={};if(!H)return ae;for(const ue of Z){const ge=ue.layerIds.map(Le=>H.getLayer(Le)).filter(Boolean);if(ge.length!==0){ue.layers=ge,ue.stateDependentLayerIds&&(ue.stateDependentLayers=ue.stateDependentLayerIds.map(Le=>ge.filter(m=>m.id===Le)[0]));for(const Le of ge)ae[Le.id]=ue}}return ae}(h.buckets,x.style),this.hasSymbolBuckets=!1;for(const Z in this.buckets){const H=this.buckets[Z];if(H instanceof M.a4){if(this.hasSymbolBuckets=!0,!O)break;H.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const Z in this.buckets){const H=this.buckets[Z];if(H instanceof M.a4&&H.hasRTLText){this.hasRTLText=!0,M.a5();break}}this.queryPadding=0;for(const Z in this.buckets){const H=this.buckets[Z];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(Z).queryRadius(H))}h.imageAtlas&&(this.imageAtlas=h.imageAtlas),h.glyphAtlasImage&&(this.glyphAtlasImage=h.glyphAtlasImage)}else this.collisionBoxArray=new M.a3}unloadVectorData(){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(h){return this.buckets[h.id]}upload(h){for(const O in this.buckets){const Z=this.buckets[O];Z.uploadPending()&&Z.upload(h)}const x=h.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rr(h,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rr(h,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(h){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(h,this.imageAtlasTexture)}queryRenderedFeatures(h,x,O,Z,H,ae,ue,ge,Le,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:Z,cameraQueryGeometry:H,scale:ae,tileSize:this.tileSize,pixelPosMatrix:m,transform:ge,params:ue,queryPadding:this.queryPadding*Le},h,x,O):{}}querySourceFeatures(h,x){const O=this.latestFeatureIndex;if(!O||!O.rawTileData)return;const Z=O.loadVTLayers(),H=x&&x.sourceLayer?x.sourceLayer:"",ae=Z._geojsonTileLayer||Z[H];if(!ae)return;const ue=M.a6(x&&x.filter),{z:ge,x:Le,y:m}=this.tileID.canonical,w={z:ge,x:Le,y:m};for(let _=0;_<ae.length;_++){const T=ae.feature(_);if(ue.needGeometry){const X=M.a7(T,!0);if(!ue.filter(new M.a8(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!ue.filter(new M.a8(this.tileID.overscaledZ),T))continue;const N=O.getId(T,H),$=new M.a9(T,ge,Le,m,N);$.tile=w,h.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(h){const x=this.expirationTime;if(h.cacheControl){const O=M.aa(h.cacheControl);O["max-age"]&&(this.expirationTime=Date.now()+1e3*O["max-age"])}else h.expires&&(this.expirationTime=new Date(h.expires).getTime());if(this.expirationTime){const O=Date.now();let Z=!1;if(this.expirationTime>O)Z=!1;else if(x)if(this.expirationTime<x)Z=!0;else{const H=this.expirationTime-x;H?this.expirationTime=O+Math.max(H,3e4):Z=!0}else Z=!0;Z?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(h,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(h).length===0)return;const O=this.latestFeatureIndex.loadVTLayers();for(const Z in this.buckets){if(!x.style.hasLayer(Z))continue;const H=this.buckets[Z],ae=H.layers[0].sourceLayer||"_geojsonTileLayer",ue=O[ae],ge=h[ae];if(!ue||!ge||Object.keys(ge).length===0)continue;H.update(ge,ue,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Le=x&&x.style&&x.style.getLayer(Z);Le&&(this.queryPadding=Math.max(this.queryPadding,Le.queryRadius(H)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(h){this.symbolFadeHoldUntil=M.h.now()+h}setDependencies(h,x){const O={};for(const Z of x)O[Z]=!0;this.dependencies[h]=O}hasDependency(h,x){for(const O of h){const Z=this.dependencies[O];if(Z){for(const H of x)if(Z[H])return!0}}return!1}}class Fo{constructor(h,x){this.max=h,this.onRemove=x,this.reset()}reset(){for(const h in this.data)for(const x of this.data[h])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(h,x,O){const Z=h.wrapped().key;this.data[Z]===void 0&&(this.data[Z]=[]);const H={value:x,timeout:void 0};if(O!==void 0&&(H.timeout=setTimeout(()=>{this.remove(h,H)},O)),this.data[Z].push(H),this.order.push(Z),this.order.length>this.max){const ae=this._getAndRemoveByKey(this.order[0]);ae&&this.onRemove(ae)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){const x=this.data[h].shift();return x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),x.value}getByKey(h){const x=this.data[h];return x?x[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,x){if(!this.has(h))return this;const O=h.wrapped().key,Z=x===void 0?0:this.data[O].indexOf(x),H=this.data[O][Z];return this.data[O].splice(Z,1),H.timeout&&clearTimeout(H.timeout),this.data[O].length===0&&delete this.data[O],this.onRemove(H.value),this.order.splice(this.order.indexOf(O),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(h){const x=[];for(const O in this.data)for(const Z of this.data[O])h(Z.value)||x.push(Z);for(const O of x)this.remove(O.value.tileID,O)}}class un{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(h,x,O){const Z=String(x);if(this.stateChanges[h]=this.stateChanges[h]||{},this.stateChanges[h][Z]=this.stateChanges[h][Z]||{},M.e(this.stateChanges[h][Z],O),this.deletedStates[h]===null){this.deletedStates[h]={};for(const H in this.state[h])H!==Z&&(this.deletedStates[h][H]=null)}else if(this.deletedStates[h]&&this.deletedStates[h][Z]===null){this.deletedStates[h][Z]={};for(const H in this.state[h][Z])O[H]||(this.deletedStates[h][Z][H]=null)}else for(const H in O)this.deletedStates[h]&&this.deletedStates[h][Z]&&this.deletedStates[h][Z][H]===null&&delete this.deletedStates[h][Z][H]}removeFeatureState(h,x,O){if(this.deletedStates[h]===null)return;const Z=String(x);if(this.deletedStates[h]=this.deletedStates[h]||{},O&&x!==void 0)this.deletedStates[h][Z]!==null&&(this.deletedStates[h][Z]=this.deletedStates[h][Z]||{},this.deletedStates[h][Z][O]=null);else if(x!==void 0)if(this.stateChanges[h]&&this.stateChanges[h][Z])for(O in this.deletedStates[h][Z]={},this.stateChanges[h][Z])this.deletedStates[h][Z][O]=null;else this.deletedStates[h][Z]=null;else this.deletedStates[h]=null}getState(h,x){const O=String(x),Z=M.e({},(this.state[h]||{})[O],(this.stateChanges[h]||{})[O]);if(this.deletedStates[h]===null)return{};if(this.deletedStates[h]){const H=this.deletedStates[h][x];if(H===null)return{};for(const ae in H)delete Z[ae]}return Z}initializeTileState(h,x){h.setFeatureState(this.state,x)}coalesceChanges(h,x){const O={};for(const Z in this.stateChanges){this.state[Z]=this.state[Z]||{};const H={};for(const ae in this.stateChanges[Z])this.state[Z][ae]||(this.state[Z][ae]={}),M.e(this.state[Z][ae],this.stateChanges[Z][ae]),H[ae]=this.state[Z][ae];O[Z]=H}for(const Z in this.deletedStates){this.state[Z]=this.state[Z]||{};const H={};if(this.deletedStates[Z]===null)for(const ae in this.state[Z])H[ae]={},this.state[Z][ae]={};else for(const ae in this.deletedStates[Z]){if(this.deletedStates[Z][ae]===null)this.state[Z][ae]={};else for(const ue of Object.keys(this.deletedStates[Z][ae]))delete this.state[Z][ae][ue];H[ae]=this.state[Z][ae]}O[Z]=O[Z]||{},M.e(O[Z],H)}if(this.stateChanges={},this.deletedStates={},Object.keys(O).length!==0)for(const Z in h)h[Z].setFeatureState(O,x)}}class Ua extends M.E{constructor(h,x,O){super(),this.id=h,this.dispatcher=O,this.on("data",Z=>{Z.dataType==="source"&&Z.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&Z.dataType==="source"&&Z.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((Z,H,ae,ue)=>{const ge=new(qo(H.type))(Z,H,ae,ue);if(ge.id!==Z)throw new Error(`Expected Source id to be ${Z} instead of ${ge.id}`);return ge})(h,x,O,this),this._tiles={},this._cache=new Fo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new un,this._didEmitContent=!1,this._updated=!1}onAdd(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._maxTileCacheZoomLevels=h?h._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(h)}onRemove(h){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(h)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const h in this._tiles){const x=this._tiles[h];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(h,x){return this._source.loadTile(h,x)}_unloadTile(h){if(this._source.unloadTile)return this._source.unloadTile(h,()=>{})}_abortTile(h){this._source.abortTile&&this._source.abortTile(h,()=>{}),this._source.fire(new M.k("dataabort",{tile:h,coord:h.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(h){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const x in this._tiles){const O=this._tiles[x];O.upload(h),O.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(h=>h.tileID).sort(zr).map(h=>h.key)}getRenderableIds(h){const x=[];for(const O in this._tiles)this._isIdRenderable(O,h)&&x.push(this._tiles[O]);return h?x.sort((O,Z)=>{const H=O.tileID,ae=Z.tileID,ue=new M.P(H.canonical.x,H.canonical.y)._rotate(this.transform.angle),ge=new M.P(ae.canonical.x,ae.canonical.y)._rotate(this.transform.angle);return H.overscaledZ-ae.overscaledZ||ge.y-ue.y||ge.x-ue.x}).map(O=>O.tileID.key):x.map(O=>O.tileID).sort(zr).map(O=>O.key)}hasRenderableParent(h){const x=this.findLoadedParent(h,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(h,x){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(x||!this._tiles[h].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(h,x){const O=this._tiles[h];O&&(O.state!=="loading"&&(O.state=x),this._loadTile(O,this._tileLoaded.bind(this,O,h,x)))}_tileLoaded(h,x,O,Z){if(Z)return h.state="errored",void(Z.status!==404?this._source.fire(new M.j(Z,{tile:h})):this.update(this.transform,this.terrain));h.timeAdded=M.h.now(),O==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(x,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),h.aborted||this._source.fire(new M.k("data",{dataType:"source",tile:h,coord:h.tileID}))}_backfillDEM(h){const x=this.getRenderableIds();for(let Z=0;Z<x.length;Z++){const H=x[Z];if(h.neighboringTiles&&h.neighboringTiles[H]){const ae=this.getTileByID(H);O(h,ae),O(ae,h)}}function O(Z,H){Z.needsHillshadePrepare=!0,Z.needsTerrainPrepare=!0;let ae=H.tileID.canonical.x-Z.tileID.canonical.x;const ue=H.tileID.canonical.y-Z.tileID.canonical.y,ge=Math.pow(2,Z.tileID.canonical.z),Le=H.tileID.key;ae===0&&ue===0||Math.abs(ue)>1||(Math.abs(ae)>1&&(Math.abs(ae+ge)===1?ae+=ge:Math.abs(ae-ge)===1&&(ae-=ge)),H.dem&&Z.dem&&(Z.dem.backfillBorder(H.dem,ae,ue),Z.neighboringTiles&&Z.neighboringTiles[Le]&&(Z.neighboringTiles[Le].backfilled=!0)))}}getTile(h){return this.getTileByID(h.key)}getTileByID(h){return this._tiles[h]}_retainLoadedChildren(h,x,O,Z){for(const H in this._tiles){let ae=this._tiles[H];if(Z[H]||!ae.hasData()||ae.tileID.overscaledZ<=x||ae.tileID.overscaledZ>O)continue;let ue=ae.tileID;for(;ae&&ae.tileID.overscaledZ>x+1;){const Le=ae.tileID.scaledTo(ae.tileID.overscaledZ-1);ae=this._tiles[Le.key],ae&&ae.hasData()&&(ue=Le)}let ge=ue;for(;ge.overscaledZ>x;)if(ge=ge.scaledTo(ge.overscaledZ-1),h[ge.key]){Z[ue.key]=ue;break}}}findLoadedParent(h,x){if(h.key in this._loadedParentTiles){const O=this._loadedParentTiles[h.key];return O&&O.tileID.overscaledZ>=x?O:null}for(let O=h.overscaledZ-1;O>=x;O--){const Z=h.scaledTo(O),H=this._getLoadedTile(Z);if(H)return H}}_getLoadedTile(h){const x=this._tiles[h.key];return x&&x.hasData()?x:this._cache.getByKey(h.wrapped().key)}updateCacheSize(h){const x=Math.ceil(h.width/this._source.tileSize)+1,O=Math.ceil(h.height/this._source.tileSize)+1,Z=Math.floor(x*O*(this._maxTileCacheZoomLevels===null?M.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),H=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,Z):Z;this._cache.setMaxSize(H)}handleWrapJump(h){const x=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,x){const O={};for(const Z in this._tiles){const H=this._tiles[Z];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+x),O[H.tileID.key]=H}this._tiles=O;for(const Z in this._timers)clearTimeout(this._timers[Z]),delete this._timers[Z];for(const Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}}update(h,x){if(this.transform=h,this.terrain=x,!this._sourceLoaded||this._paused)return;let O;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?O=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new M.O(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(O=h.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(O=O.filter(m=>this._source.hasTile(m)))):O=[];const Z=h.coveringZoomLevel(this._source),H=Math.max(Z-Ua.maxOverzooming,this._source.minzoom),ae=Math.max(Z+Ua.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const m={};for(const w of O)if(w.canonical.z>this._source.minzoom){const _=w.scaledTo(w.canonical.z-1);m[_.key]=_;const T=w.scaledTo(Math.max(this._source.minzoom,Math.min(w.canonical.z,5)));m[T.key]=T}O=O.concat(Object.values(m))}const ue=O.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,ue&&this.fire(new M.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const ge=this._updateRetainedTiles(O,Z);if(be(this._source.type)){const m={},w={},_=Object.keys(ge),T=M.h.now();for(const N of _){const $=ge[N],X=this._tiles[N];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=T)continue;const oe=this.findLoadedParent($,H);oe&&(this._addTile(oe.tileID),m[oe.tileID.key]=oe.tileID),w[N]=$}this._retainLoadedChildren(w,Z,ae,ge);for(const N in m)ge[N]||(this._coveredTiles[N]=!0,ge[N]=m[N]);if(x){const N={},$={};for(const X of O)this._tiles[X.key].hasData()?N[X.key]=X:$[X.key]=X;for(const X in $){const oe=$[X].children(this._source.maxzoom);this._tiles[oe[0].key]&&this._tiles[oe[1].key]&&this._tiles[oe[2].key]&&this._tiles[oe[3].key]&&(N[oe[0].key]=ge[oe[0].key]=oe[0],N[oe[1].key]=ge[oe[1].key]=oe[1],N[oe[2].key]=ge[oe[2].key]=oe[2],N[oe[3].key]=ge[oe[3].key]=oe[3],delete $[X])}for(const X in $){const oe=this.findLoadedParent($[X],this._source.minzoom);if(oe){N[oe.tileID.key]=ge[oe.tileID.key]=oe.tileID;for(const xe in N)N[xe].isChildOf(oe.tileID)&&delete N[xe]}}for(const X in this._tiles)N[X]||(this._coveredTiles[X]=!0)}}for(const m in ge)this._tiles[m].clearFadeHold();const Le=M.ab(this._tiles,ge);for(const m of Le){const w=this._tiles[m];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(m)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)}_updateRetainedTiles(h,x){const O={},Z={},H=Math.max(x-Ua.maxOverzooming,this._source.minzoom),ae=Math.max(x+Ua.maxUnderzooming,this._source.minzoom),ue={};for(const ge of h){const Le=this._addTile(ge);O[ge.key]=ge,Le.hasData()||x<this._source.maxzoom&&(ue[ge.key]=ge)}this._retainLoadedChildren(ue,x,ae,O);for(const ge of h){let Le=this._tiles[ge.key];if(Le.hasData())continue;if(x+1>this._source.maxzoom){const w=ge.children(this._source.maxzoom)[0],_=this.getTile(w);if(_&&_.hasData()){O[w.key]=w;continue}}else{const w=ge.children(this._source.maxzoom);if(O[w[0].key]&&O[w[1].key]&&O[w[2].key]&&O[w[3].key])continue}let m=Le.wasRequested();for(let w=ge.overscaledZ-1;w>=H;--w){const _=ge.scaledTo(w);if(Z[_.key])break;if(Z[_.key]=!0,Le=this.getTile(_),!Le&&m&&(Le=this._addTile(_)),Le){const T=Le.hasData();if((m||T)&&(O[_.key]=_),m=Le.wasRequested(),T)break}}}return O}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const h in this._tiles){const x=[];let O,Z=this._tiles[h].tileID;for(;Z.overscaledZ>0;){if(Z.key in this._loadedParentTiles){O=this._loadedParentTiles[Z.key];break}x.push(Z.key);const H=Z.scaledTo(Z.overscaledZ-1);if(O=this._getLoadedTile(H),O)break;Z=H}for(const H of x)this._loadedParentTiles[H]=O}}_addTile(h){let x=this._tiles[h.key];if(x)return x;x=this._cache.getAndRemove(h),x&&(this._setTileReloadTimer(h.key,x),x.tileID=h,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,x)));const O=x;return x||(x=new ha(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,h.key,x.state))),x.uses++,this._tiles[h.key]=x,O||this._source.fire(new M.k("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(h,x){h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);const O=x.getExpiryTimeout();O&&(this._timers[h]=setTimeout(()=>{this._reloadTile(h,"expired"),delete this._timers[h]},O))}_removeTile(h){const x=this._tiles[h];x&&(x.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const h in this._tiles)this._removeTile(h);this._cache.reset()}tilesIn(h,x,O){const Z=[],H=this.transform;if(!H)return Z;const ae=O?H.getCameraQueryGeometry(h):h,ue=h.map(N=>H.pointCoordinate(N,this.terrain)),ge=ae.map(N=>H.pointCoordinate(N,this.terrain)),Le=this.getIds();let m=1/0,w=1/0,_=-1/0,T=-1/0;for(const N of ge)m=Math.min(m,N.x),w=Math.min(w,N.y),_=Math.max(_,N.x),T=Math.max(T,N.y);for(let N=0;N<Le.length;N++){const $=this._tiles[Le[N]];if($.holdingForFade())continue;const X=$.tileID,oe=Math.pow(2,H.zoom-$.tileID.overscaledZ),xe=x*$.queryPadding*M.N/$.tileSize/oe,ye=[X.getTilePoint(new M.U(m,w)),X.getTilePoint(new M.U(_,T))];if(ye[0].x-xe<M.N&&ye[0].y-xe<M.N&&ye[1].x+xe>=0&&ye[1].y+xe>=0){const De=ue.map($e=>X.getTilePoint($e)),He=ge.map($e=>X.getTilePoint($e));Z.push({tile:$,tileID:X,queryGeometry:De,cameraQueryGeometry:He,scale:oe})}}return Z}getVisibleCoordinates(h){const x=this.getRenderableIds(h).map(O=>this._tiles[O].tileID);for(const O of x)O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(be(this._source.type)){const h=M.h.now();for(const x in this._tiles)if(this._tiles[x].fadeEndTime>=h)return!0}return!1}setFeatureState(h,x,O){this._state.updateState(h=h||"_geojsonTileLayer",x,O)}removeFeatureState(h,x,O){this._state.removeFeatureState(h=h||"_geojsonTileLayer",x,O)}getFeatureState(h,x){return this._state.getState(h=h||"_geojsonTileLayer",x)}setDependencies(h,x,O){const Z=this._tiles[h];Z&&Z.setDependencies(x,O)}reloadTilesForDependencies(h,x){for(const O in this._tiles)this._tiles[O].hasDependency(h,x)&&this._reloadTile(O,"reloading");this._cache.filter(O=>!O.hasDependency(h,x))}}function zr(D,h){const x=Math.abs(2*D.wrap)-+(D.wrap<0),O=Math.abs(2*h.wrap)-+(h.wrap<0);return D.overscaledZ-h.overscaledZ||O-x||h.canonical.y-D.canonical.y||h.canonical.x-D.canonical.x}function be(D){return D==="raster"||D==="image"||D==="video"}Ua.maxOverzooming=10,Ua.maxUnderzooming=3;const lt="mapboxgl_preloaded_worker_pool";class mt{constructor(){this.active={}}acquire(h){if(!this.workers)for(this.workers=[];this.workers.length<mt.workerCount;)this.workers.push(new Worker(M.c.WORKER_URL));return this.active[h]=!0,this.workers.slice()}release(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(x=>{x.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lt]}numActive(){return Object.keys(this.active).length}}const Qt=Math.floor(M.h.hardwareConcurrency/2);let xr;function mn(){return xr||(xr=new mt),xr}mt.workerCount=M.ac(globalThis)?Math.max(Math.min(Qt,3),1):1;class Wn{constructor(h,x){this.reset(h,x)}reset(h,x){this.points=h||[],this._distances=[0];for(let O=1;O<this.points.length;O++)this._distances[O]=this._distances[O-1]+this.points[O].dist(this.points[O-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=M.ad(h,0,1);let x=1,O=this._distances[x];const Z=h*this.paddedLength+this.padding;for(;O<Z&&x<this._distances.length;)O=this._distances[++x];const H=x-1,ae=this._distances[H],ue=O-ae,ge=ue>0?(Z-ae)/ue:0;return this.points[H].mult(1-ge).add(this.points[x].mult(ge))}}function tr(D,h){let x=!0;return D==="always"||D!=="never"&&h!=="never"||(x=!1),x}class Hr{constructor(h,x,O){const Z=this.boxCells=[],H=this.circleCells=[];this.xCellCount=Math.ceil(h/O),this.yCellCount=Math.ceil(x/O);for(let ae=0;ae<this.xCellCount*this.yCellCount;ae++)Z.push([]),H.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=x,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,x,O,Z,H){this._forEachCell(x,O,Z,H,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(x),this.bboxes.push(O),this.bboxes.push(Z),this.bboxes.push(H)}insertCircle(h,x,O,Z){this._forEachCell(x-Z,O-Z,x+Z,O+Z,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(x),this.circles.push(O),this.circles.push(Z)}_insertBoxCell(h,x,O,Z,H,ae){this.boxCells[H].push(ae)}_insertCircleCell(h,x,O,Z,H,ae){this.circleCells[H].push(ae)}_query(h,x,O,Z,H,ae,ue){if(O<0||h>this.width||Z<0||x>this.height)return[];const ge=[];if(h<=0&&x<=0&&this.width<=O&&this.height<=Z){if(H)return[{key:null,x1:h,y1:x,x2:O,y2:Z}];for(let Le=0;Le<this.boxKeys.length;Le++)ge.push({key:this.boxKeys[Le],x1:this.bboxes[4*Le],y1:this.bboxes[4*Le+1],x2:this.bboxes[4*Le+2],y2:this.bboxes[4*Le+3]});for(let Le=0;Le<this.circleKeys.length;Le++){const m=this.circles[3*Le],w=this.circles[3*Le+1],_=this.circles[3*Le+2];ge.push({key:this.circleKeys[Le],x1:m-_,y1:w-_,x2:m+_,y2:w+_})}}else this._forEachCell(h,x,O,Z,this._queryCell,ge,{hitTest:H,overlapMode:ae,seenUids:{box:{},circle:{}}},ue);return ge}query(h,x,O,Z){return this._query(h,x,O,Z,!1,null)}hitTest(h,x,O,Z,H,ae){return this._query(h,x,O,Z,!0,H,ae).length>0}hitTestCircle(h,x,O,Z,H){const ae=h-O,ue=h+O,ge=x-O,Le=x+O;if(ue<0||ae>this.width||Le<0||ge>this.height)return!1;const m=[];return this._forEachCell(ae,ge,ue,Le,this._queryCellCircle,m,{hitTest:!0,overlapMode:Z,circle:{x:h,y:x,radius:O},seenUids:{box:{},circle:{}}},H),m.length>0}_queryCell(h,x,O,Z,H,ae,ue,ge){const{seenUids:Le,hitTest:m,overlapMode:w}=ue,_=this.boxCells[H];if(_!==null){const N=this.bboxes;for(const $ of _)if(!Le.box[$]){Le.box[$]=!0;const X=4*$,oe=this.boxKeys[$];if(h<=N[X+2]&&x<=N[X+3]&&O>=N[X+0]&&Z>=N[X+1]&&(!ge||ge(oe))&&(!m||!tr(w,oe.overlapMode))&&(ae.push({key:oe,x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]}),m))return!0}}const T=this.circleCells[H];if(T!==null){const N=this.circles;for(const $ of T)if(!Le.circle[$]){Le.circle[$]=!0;const X=3*$,oe=this.circleKeys[$];if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],h,x,O,Z)&&(!ge||ge(oe))&&(!m||!tr(w,oe.overlapMode))){const xe=N[X],ye=N[X+1],De=N[X+2];if(ae.push({key:oe,x1:xe-De,y1:ye-De,x2:xe+De,y2:ye+De}),m)return!0}}}return!1}_queryCellCircle(h,x,O,Z,H,ae,ue,ge){const{circle:Le,seenUids:m,overlapMode:w}=ue,_=this.boxCells[H];if(_!==null){const N=this.bboxes;for(const $ of _)if(!m.box[$]){m.box[$]=!0;const X=4*$,oe=this.boxKeys[$];if(this._circleAndRectCollide(Le.x,Le.y,Le.radius,N[X+0],N[X+1],N[X+2],N[X+3])&&(!ge||ge(oe))&&!tr(w,oe.overlapMode))return ae.push(!0),!0}}const T=this.circleCells[H];if(T!==null){const N=this.circles;for(const $ of T)if(!m.circle[$]){m.circle[$]=!0;const X=3*$,oe=this.circleKeys[$];if(this._circlesCollide(N[X],N[X+1],N[X+2],Le.x,Le.y,Le.radius)&&(!ge||ge(oe))&&!tr(w,oe.overlapMode))return ae.push(!0),!0}}}_forEachCell(h,x,O,Z,H,ae,ue,ge){const Le=this._convertToXCellCoord(h),m=this._convertToYCellCoord(x),w=this._convertToXCellCoord(O),_=this._convertToYCellCoord(Z);for(let T=Le;T<=w;T++)for(let N=m;N<=_;N++)if(H.call(this,h,x,O,Z,this.xCellCount*N+T,ae,ue,ge))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,x,O,Z,H,ae){const ue=Z-h,ge=H-x,Le=O+ae;return Le*Le>ue*ue+ge*ge}_circleAndRectCollide(h,x,O,Z,H,ae,ue){const ge=(ae-Z)/2,Le=Math.abs(h-(Z+ge));if(Le>ge+O)return!1;const m=(ue-H)/2,w=Math.abs(x-(H+m));if(w>m+O)return!1;if(Le<=ge||w<=m)return!0;const _=Le-ge,T=w-m;return _*_+T*T<=O*O}}function dr(D,h,x,O,Z){const H=M.Z();return h?(M.a0(H,H,[1/Z,1/Z,1]),x||M.ae(H,H,O.angle)):M.a1(H,O.labelPlaneMatrix,D),H}function Un(D,h,x,O,Z){if(h){const H=M.af(D);return M.a0(H,H,[Z,Z,1]),x||M.ae(H,H,-O.angle),H}return O.glCoordMatrix}function ti(D,h,x){let O;x?(O=[D.x,D.y,x(D.x,D.y),1],M.ag(O,O,h)):(O=[D.x,D.y,0,1],Ae(O,O,h));const Z=O[3];return{point:new M.P(O[0]/Z,O[1]/Z),signedDistanceFromCamera:Z}}function Yi(D,h){return .5+D/h*.5}function ea(D,h){const x=D[0]/D[3],O=D[1]/D[3];return x>=-h[0]&&x<=h[0]&&O>=-h[1]&&O<=h[1]}function on(D,h,x,O,Z,H,ae,ue,ge,Le){const m=O?D.textSizeData:D.iconSizeData,w=M.ah(m,x.transform.zoom),_=[256/x.width*2+1,256/x.height*2+1],T=O?D.text.dynamicLayoutVertexArray:D.icon.dynamicLayoutVertexArray;T.clear();const N=D.lineVertexArray,$=O?D.text.placedSymbolArray:D.icon.placedSymbolArray,X=x.transform.width/x.transform.height;let oe=!1;for(let xe=0;xe<$.length;xe++){const ye=$.get(xe);if(ye.hidden||ye.writingMode===M.ai.vertical&&!oe){ve(ye.numGlyphs,T);continue}let De;if(oe=!1,Le?(De=[ye.anchorX,ye.anchorY,Le(ye.anchorX,ye.anchorY),1],M.ag(De,De,h)):(De=[ye.anchorX,ye.anchorY,0,1],Ae(De,De,h)),!ea(De,_)){ve(ye.numGlyphs,T);continue}const He=Yi(x.transform.cameraToCenterDistance,De[3]),$e=M.aj(m,w,ye),ft=ae?$e/He:$e*He,pt=new M.P(ye.anchorX,ye.anchorY),wt=ti(pt,Z,Le).point,dt={projections:{},offsets:{}},Ft=Pa(ye,ft,!1,ue,h,Z,H,D.glyphOffsetArray,N,T,wt,pt,dt,X,ge,Le);oe=Ft.useVertical,(Ft.notEnoughRoom||oe||Ft.needsFlipping&&Pa(ye,ft,!0,ue,h,Z,H,D.glyphOffsetArray,N,T,wt,pt,dt,X,ge,Le).notEnoughRoom)&&ve(ye.numGlyphs,T)}O?D.text.dynamicLayoutVertexBuffer.updateData(T):D.icon.dynamicLayoutVertexBuffer.updateData(T)}function Xn(D,h,x,O,Z,H,ae,ue,ge,Le,m,w,_){const T=ue.glyphStartIndex+ue.numGlyphs,N=ue.lineStartIndex,$=ue.lineStartIndex+ue.lineLength,X=h.getoffsetX(ue.glyphStartIndex),oe=h.getoffsetX(T-1),xe=qe(D*X,x,O,Z,H,ae,ue.segment,N,$,ge,Le,m,w,_);if(!xe)return null;const ye=qe(D*oe,x,O,Z,H,ae,ue.segment,N,$,ge,Le,m,w,_);return ye?{first:xe,last:ye}:null}function Pi(D,h,x,O){return D===M.ai.horizontal&&Math.abs(x.y-h.y)>Math.abs(x.x-h.x)*O?{useVertical:!0}:(D===M.ai.vertical?h.y<x.y:h.x>x.x)?{needsFlipping:!0}:null}function Pa(D,h,x,O,Z,H,ae,ue,ge,Le,m,w,_,T,N,$){const X=h/24,oe=D.lineOffsetX*X,xe=D.lineOffsetY*X;let ye;if(D.numGlyphs>1){const De=D.glyphStartIndex+D.numGlyphs,He=D.lineStartIndex,$e=D.lineStartIndex+D.lineLength,ft=Xn(X,ue,oe,xe,x,m,w,D,ge,H,_,N,$);if(!ft)return{notEnoughRoom:!0};const pt=ti(ft.first.point,ae,$).point,wt=ti(ft.last.point,ae,$).point;if(O&&!x){const dt=Pi(D.writingMode,pt,wt,T);if(dt)return dt}ye=[ft.first];for(let dt=D.glyphStartIndex+1;dt<De-1;dt++)ye.push(qe(X*ue.getoffsetX(dt),oe,xe,x,m,w,D.segment,He,$e,ge,H,_,N,$));ye.push(ft.last)}else{if(O&&!x){const He=ti(w,Z,$).point,$e=D.lineStartIndex+D.segment+1,ft=new M.P(ge.getx($e),ge.gety($e)),pt=ti(ft,Z,$),wt=pt.signedDistanceFromCamera>0?pt.point:zo(w,ft,He,1,Z,$),dt=Pi(D.writingMode,He,wt,T);if(dt)return dt}const De=qe(X*ue.getoffsetX(D.glyphStartIndex),oe,xe,x,m,w,D.segment,D.lineStartIndex,D.lineStartIndex+D.lineLength,ge,H,_,N,$);if(!De)return{notEnoughRoom:!0};ye=[De]}for(const De of ye)M.ak(Le,De.point,De.angle);return{}}function zo(D,h,x,O,Z,H){const ae=ti(D.add(D.sub(h)._unit()),Z,H).point,ue=x.sub(ae);return x.add(ue._mult(O/ue.mag()))}function ya(D,h){const{projectionCache:x,lineVertexArray:O,labelPlaneMatrix:Z,tileAnchorPoint:H,distanceFromAnchor:ae,getElevation:ue,previousVertex:ge,direction:Le,absOffsetX:m}=h;if(x.projections[D])return x.projections[D];const w=new M.P(O.getx(D),O.gety(D)),_=ti(w,Z,ue);if(_.signedDistanceFromCamera>0)return x.projections[D]=_.point,_.point;const T=D-Le;return zo(ae===0?H:new M.P(O.getx(T),O.gety(T)),w,ge,m-ae+1,Z,ue)}function Xu(D,h,x){return D._unit()._perp()._mult(h*x)}function Wt(D,h,x,O,Z,H,ae,ue){const{projectionCache:ge,direction:Le}=ue;if(ge.offsets[D])return ge.offsets[D];const m=x.add(h);if(D+Le<O||D+Le>=Z)return ge.offsets[D]=m,m;const w=ya(D+Le,ue),_=Xu(w.sub(x),ae,Le),T=x.add(_),N=w.add(_);return ge.offsets[D]=M.al(H,m,T,N)||m,ge.offsets[D]}function qe(D,h,x,O,Z,H,ae,ue,ge,Le,m,w,_,T){const N=O?D-h:D+h;let $=N>0?1:-1,X=0;O&&($*=-1,X=Math.PI),$<0&&(X+=Math.PI);let oe,xe,ye=$>0?ue+ae:ue+ae+1,De=Z,He=Z,$e=0,ft=0;const pt=Math.abs(N),wt=[];let dt;for(;$e+ft<=pt;){if(ye+=$,ye<ue||ye>=ge)return null;$e+=ft,He=De,xe=oe;const nr={projectionCache:w,lineVertexArray:Le,labelPlaneMatrix:m,tileAnchorPoint:H,distanceFromAnchor:$e,getElevation:T,previousVertex:He,direction:$,absOffsetX:pt};if(De=ya(ye,nr),x===0)wt.push(He),dt=De.sub(He);else{let Ir;const _r=De.sub(He);Ir=_r.mag()===0?Xu(ya(ye+$,nr).sub(De),x,$):Xu(_r,x,$),xe||(xe=He.add(Ir)),oe=Wt(ye,Ir,De,ue,ge,xe,x,nr),wt.push(xe),dt=oe.sub(xe)}ft=dt.mag()}const Ft=dt._mult((pt-$e)/ft)._add(xe||He),ar=X+Math.atan2(De.y-He.y,De.x-He.x);return wt.push(Ft),{point:Ft,angle:_?ar:0,path:wt}}const se=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ve(D,h){for(let x=0;x<D;x++){const O=h.length;h.resize(O+4),h.float32.set(se,3*O)}}function Ae(D,h,x){const O=h[0],Z=h[1];return D[0]=x[0]*O+x[4]*Z+x[12],D[1]=x[1]*O+x[5]*Z+x[13],D[3]=x[3]*O+x[7]*Z+x[15],D}const Re=100;class Xe{constructor(h,x=new Hr(h.width+200,h.height+200,25),O=new Hr(h.width+200,h.height+200,25)){this.transform=h,this.grid=x,this.ignoredGrid=O,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+Re,this.screenBottomBoundary=h.height+Re,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(h,x,O,Z,H,ae){const ue=this.projectAndGetPerspectiveRatio(Z,h.anchorPointX,h.anchorPointY,ae),ge=O*ue.perspectiveRatio,Le=h.x1*ge+ue.point.x,m=h.y1*ge+ue.point.y,w=h.x2*ge+ue.point.x,_=h.y2*ge+ue.point.y;return!this.isInsideGrid(Le,m,w,_)||x!=="always"&&this.grid.hitTest(Le,m,w,_,x,H)||ue.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[Le,m,w,_],offscreen:this.isOffscreen(Le,m,w,_)}}placeCollisionCircles(h,x,O,Z,H,ae,ue,ge,Le,m,w,_,T,N){const $=[],X=new M.P(x.anchorX,x.anchorY),oe=ti(X,ae,N),xe=Yi(this.transform.cameraToCenterDistance,oe.signedDistanceFromCamera),ye=(m?H/xe:H*xe)/M.ap,De=ti(X,ue,N).point,He=Xn(ye,Z,x.lineOffsetX*ye,x.lineOffsetY*ye,!1,De,X,x,O,ue,{projections:{},offsets:{}},!1,N);let $e=!1,ft=!1,pt=!0;if(He){const wt=.5*_*xe+T,dt=new M.P(-100,-100),Ft=new M.P(this.screenRightBoundary,this.screenBottomBoundary),ar=new Wn,nr=He.first,Ir=He.last;let _r=[];for(let Ln=nr.path.length-1;Ln>=1;Ln--)_r.push(nr.path[Ln]);for(let Ln=1;Ln<Ir.path.length;Ln++)_r.push(Ir.path[Ln]);const Qr=2.5*wt;if(ge){const Ln=_r.map(Mn=>ti(Mn,ge,N));_r=Ln.some(Mn=>Mn.signedDistanceFromCamera<=0)?[]:Ln.map(Mn=>Mn.point)}let nn=[];if(_r.length>0){const Ln=_r[0].clone(),Mn=_r[0].clone();for(let yi=1;yi<_r.length;yi++)Ln.x=Math.min(Ln.x,_r[yi].x),Ln.y=Math.min(Ln.y,_r[yi].y),Mn.x=Math.max(Mn.x,_r[yi].x),Mn.y=Math.max(Mn.y,_r[yi].y);nn=Ln.x>=dt.x&&Mn.x<=Ft.x&&Ln.y>=dt.y&&Mn.y<=Ft.y?[_r]:Mn.x<dt.x||Ln.x>Ft.x||Mn.y<dt.y||Ln.y>Ft.y?[]:M.am([_r],dt.x,dt.y,Ft.x,Ft.y)}for(const Ln of nn){ar.reset(Ln,.25*wt);let Mn=0;Mn=ar.length<=.5*wt?1:Math.ceil(ar.paddedLength/Qr)+1;for(let yi=0;yi<Mn;yi++){const Ri=yi/Math.max(Mn-1,1),Qi=ar.lerp(Ri),Vi=Qi.x+Re,ao=Qi.y+Re;$.push(Vi,ao,wt,0);const Bi=Vi-wt,oa=ao-wt,Ha=Vi+wt,ja=ao+wt;if(pt=pt&&this.isOffscreen(Bi,oa,Ha,ja),ft=ft||this.isInsideGrid(Bi,oa,Ha,ja),h!=="always"&&this.grid.hitTestCircle(Vi,ao,wt,h,w)&&($e=!0,!Le))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!Le&&$e||!ft||xe<this.perspectiveRatioCutoff?[]:$,offscreen:pt,collisionDetected:$e}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const x=[];let O=1/0,Z=1/0,H=-1/0,ae=-1/0;for(const m of h){const w=new M.P(m.x+Re,m.y+Re);O=Math.min(O,w.x),Z=Math.min(Z,w.y),H=Math.max(H,w.x),ae=Math.max(ae,w.y),x.push(w)}const ue=this.grid.query(O,Z,H,ae).concat(this.ignoredGrid.query(O,Z,H,ae)),ge={},Le={};for(const m of ue){const w=m.key;if(ge[w.bucketInstanceId]===void 0&&(ge[w.bucketInstanceId]={}),ge[w.bucketInstanceId][w.featureIndex])continue;const _=[new M.P(m.x1,m.y1),new M.P(m.x2,m.y1),new M.P(m.x2,m.y2),new M.P(m.x1,m.y2)];M.an(x,_)&&(ge[w.bucketInstanceId][w.featureIndex]=!0,Le[w.bucketInstanceId]===void 0&&(Le[w.bucketInstanceId]=[]),Le[w.bucketInstanceId].push(w.featureIndex))}return Le}insertCollisionBox(h,x,O,Z,H,ae){(O?this.ignoredGrid:this.grid).insert({bucketInstanceId:Z,featureIndex:H,collisionGroupID:ae,overlapMode:x},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,x,O,Z,H,ae){const ue=O?this.ignoredGrid:this.grid,ge={bucketInstanceId:Z,featureIndex:H,collisionGroupID:ae,overlapMode:x};for(let Le=0;Le<h.length;Le+=4)ue.insertCircle(ge,h[Le],h[Le+1],h[Le+2])}projectAndGetPerspectiveRatio(h,x,O,Z){let H;return Z?(H=[x,O,Z(x,O),1],M.ag(H,H,h)):(H=[x,O,0,1],Ae(H,H,h)),{point:new M.P((H[0]/H[3]+1)/2*this.transform.width+Re,(-H[1]/H[3]+1)/2*this.transform.height+Re),perspectiveRatio:.5+this.transform.cameraToCenterDistance/H[3]*.5}}isOffscreen(h,x,O,Z){return O<Re||h>=this.screenRightBoundary||Z<Re||x>this.screenBottomBoundary}isInsideGrid(h,x,O,Z){return O>=0&&h<this.gridRightBoundary&&Z>=0&&x<this.gridBottomBoundary}getViewportMatrix(){const h=M.ao([]);return M.$(h,h,[-100,-100,0]),h}}function Qe(D,h,x){return h*(M.N/(D.tileSize*Math.pow(2,x-D.tileID.overscaledZ)))}class Ye{constructor(h,x,O,Z){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?x:-x))):Z&&O?1:0,this.placed=O}isHidden(){return this.opacity===0&&!this.placed}}class Fe{constructor(h,x,O,Z,H){this.text=new Ye(h?h.text:null,x,O,H),this.icon=new Ye(h?h.icon:null,x,Z,H)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Me{constructor(h,x,O){this.text=h,this.icon=x,this.skipFade=O}}class Be{constructor(){this.invProjMatrix=M.Z(),this.viewportMatrix=M.Z(),this.circles=[]}}class yt{constructor(h,x,O,Z,H){this.bucketInstanceId=h,this.featureIndex=x,this.sourceLayerIndex=O,this.bucketIndex=Z,this.tileID=H}}class zt{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){const x=++this.maxGroupID;this.collisionGroups[h]={ID:x,predicate:O=>O.collisionGroupID===x}}return this.collisionGroups[h]}}function Ze(D,h,x,O,Z){const{horizontalAlign:H,verticalAlign:ae}=M.au(D);return new M.P(-(H-.5)*h+O[0]*Z,-(ae-.5)*x+O[1]*Z)}function Yr(D,h,x,O,Z,H){const{x1:ae,x2:ue,y1:ge,y2:Le,anchorPointX:m,anchorPointY:w}=D,_=new M.P(h,x);return O&&_._rotate(Z?H:-H),{x1:ae+_.x,y1:ge+_.y,x2:ue+_.x,y2:Le+_.y,anchorPointX:m,anchorPointY:w}}class Fn{constructor(h,x,O,Z,H){this.transform=h.clone(),this.terrain=x,this.collisionIndex=new Xe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=O,this.retainedQueryData={},this.collisionGroups=new zt(Z),this.collisionCircleArrays={},this.prevPlacement=H,H&&(H.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,x,O,Z){const H=O.getBucket(x),ae=O.latestFeatureIndex;if(!H||!ae||x.id!==H.layerIds[0])return;const ue=O.collisionBoxArray,ge=H.layers[0].layout,Le=Math.pow(2,this.transform.zoom-O.tileID.overscaledZ),m=O.tileSize/M.N,w=this.transform.calculatePosMatrix(O.tileID.toUnwrapped()),_=ge.get("text-pitch-alignment")==="map",T=ge.get("text-rotation-alignment")==="map",N=Qe(O,1,this.transform.zoom),$=dr(w,_,T,this.transform,N);let X=null;if(_){const xe=Un(w,_,T,this.transform,N);X=M.a1([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[H.bucketInstanceId]=new yt(H.bucketInstanceId,ae,H.sourceLayerIndex,H.index,O.tileID);const oe={bucket:H,layout:ge,posMatrix:w,textLabelPlaneMatrix:$,labelToScreenMatrix:X,scale:Le,textPixelRatio:m,holdingForFade:O.holdingForFade(),collisionBoxArray:ue,partiallyEvaluatedTextSize:M.ah(H.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(H.sourceID)};if(Z)for(const xe of H.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:De,symbolInstanceEnd:He}=xe;h.push({sortKey:ye,symbolInstanceStart:De,symbolInstanceEnd:He,parameters:oe})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:H.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(h,x,O,Z,H,ae,ue,ge,Le,m,w,_,T,N,$,X){const oe=M.aq[h.textAnchor],xe=[h.textOffset0,h.textOffset1],ye=Ze(oe,O,Z,xe,H),De=this.collisionIndex.placeCollisionBox(Yr(x,ye.x,ye.y,ae,ue,this.transform.angle),w,ge,Le,m.predicate,X);if((!$||this.collisionIndex.placeCollisionBox(Yr($,ye.x,ye.y,ae,ue,this.transform.angle),w,ge,Le,m.predicate,X).box.length!==0)&&De.box.length>0){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_.crossTileID]&&this.prevPlacement.placements[_.crossTileID]&&this.prevPlacement.placements[_.crossTileID].text&&(He=this.prevPlacement.variableOffsets[_.crossTileID].anchor),_.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_.crossTileID]={textOffset:xe,width:O,height:Z,anchor:oe,textBoxScale:H,prevAnchor:He},this.markUsedJustification(T,oe,_,N),T.allowVerticalPlacement&&(this.markUsedOrientation(T,N,_),this.placedOrientations[_.crossTileID]=N),{shift:ye,placedGlyphBoxes:De}}}placeLayerBucketPart(h,x,O){const{bucket:Z,layout:H,posMatrix:ae,textLabelPlaneMatrix:ue,labelToScreenMatrix:ge,textPixelRatio:Le,holdingForFade:m,collisionBoxArray:w,partiallyEvaluatedTextSize:_,collisionGroup:T}=h.parameters,N=H.get("text-optional"),$=H.get("icon-optional"),X=M.ar(H,"text-overlap","text-allow-overlap"),oe=X==="always",xe=M.ar(H,"icon-overlap","icon-allow-overlap"),ye=xe==="always",De=H.get("text-rotation-alignment")==="map",He=H.get("text-pitch-alignment")==="map",$e=H.get("icon-text-fit")!=="none",ft=H.get("symbol-z-order")==="viewport-y",pt=oe&&(ye||!Z.hasIconData()||$),wt=ye&&(oe||!Z.hasTextData()||N);!Z.collisionArrays&&w&&Z.deserializeCollisionBoxes(w);const dt=this.retainedQueryData[Z.bucketInstanceId].tileID,Ft=this.terrain?(nr,Ir)=>this.terrain.getElevation(dt,nr,Ir):null,ar=(nr,Ir)=>{var _r,Qr;if(x[nr.crossTileID])return;if(m)return void(this.placements[nr.crossTileID]=new Me(!1,!1,!1));let nn=!1,Ln=!1,Mn=!0,yi=null,Ri={box:null,offscreen:null},Qi={box:null,offscreen:null},Vi=null,ao=null,Bi=null,oa=0,Ha=0,ja=0;Ir.textFeatureIndex?oa=Ir.textFeatureIndex:nr.useRuntimeCollisionCircles&&(oa=nr.featureIndex),Ir.verticalTextFeatureIndex&&(Ha=Ir.verticalTextFeatureIndex);const Sa=Ir.textBox;if(Sa){const va=Ps=>{let Qo=M.ai.horizontal;if(Z.allowVerticalPlacement&&!Ps&&this.prevPlacement){const Zs=this.prevPlacement.placedOrientations[nr.crossTileID];Zs&&(this.placedOrientations[nr.crossTileID]=Zs,Qo=Zs,this.markUsedOrientation(Z,Qo,nr))}return Qo},tu=(Ps,Qo)=>{if(Z.allowVerticalPlacement&&nr.numVerticalGlyphVertices>0&&Ir.verticalTextBox){for(const Zs of Z.writingModes)if(Zs===M.ai.vertical?(Ri=Qo(),Qi=Ri):Ri=Ps(),Ri&&Ri.box&&Ri.box.length)break}else Ri=Ps()},Gs=nr.textAnchorOffsetStartIndex,Tl=nr.textAnchorOffsetEndIndex;if(Tl===Gs){const Ps=(Qo,Zs)=>{const Hs=this.collisionIndex.placeCollisionBox(Qo,X,Le,ae,T.predicate,Ft);return Hs&&Hs.box&&Hs.box.length&&(this.markUsedOrientation(Z,Zs,nr),this.placedOrientations[nr.crossTileID]=Zs),Hs};tu(()=>Ps(Sa,M.ai.horizontal),()=>{const Qo=Ir.verticalTextBox;return Z.allowVerticalPlacement&&nr.numVerticalGlyphVertices>0&&Qo?Ps(Qo,M.ai.vertical):{box:null,offscreen:null}}),va(Ri&&Ri.box&&Ri.box.length)}else{let Ps=M.aq[(Qr=(_r=this.prevPlacement)===null||_r===void 0?void 0:_r.variableOffsets[nr.crossTileID])===null||Qr===void 0?void 0:Qr.anchor];const Qo=(Hs,Uu,uh)=>{const pc=Hs.x2-Hs.x1,Xc=Hs.y2-Hs.y1,Yc=nr.textBoxScale,Qf=$e&&xe==="never"?Uu:null;let dc={box:[],offscreen:!1},vc=X==="never"?1:2,Dc="never";Ps&&vc++;for(let Vl=0;Vl<vc;Vl++){for(let Gl=Gs;Gl<Tl;Gl++){const vf=Z.textAnchorOffsets.get(Gl);if(Ps&&vf.textAnchor!==Ps)continue;const mc=this.attemptAnchorPlacement(vf,Hs,pc,Xc,Yc,De,He,Le,ae,T,Dc,nr,Z,uh,Qf,Ft);if(mc&&(dc=mc.placedGlyphBoxes,dc&&dc.box&&dc.box.length))return nn=!0,yi=mc.shift,dc}Ps?Ps=null:Dc=X}return dc};tu(()=>Qo(Sa,Ir.iconBox,M.ai.horizontal),()=>{const Hs=Ir.verticalTextBox;return Z.allowVerticalPlacement&&!(Ri&&Ri.box&&Ri.box.length)&&nr.numVerticalGlyphVertices>0&&Hs?Qo(Hs,Ir.verticalIconBox,M.ai.vertical):{box:null,offscreen:null}}),Ri&&(nn=Ri.box,Mn=Ri.offscreen);const Zs=va(Ri&&Ri.box);if(!nn&&this.prevPlacement){const Hs=this.prevPlacement.variableOffsets[nr.crossTileID];Hs&&(this.variableOffsets[nr.crossTileID]=Hs,this.markUsedJustification(Z,Hs.anchor,nr,Zs))}}}if(Vi=Ri,nn=Vi&&Vi.box&&Vi.box.length>0,Mn=Vi&&Vi.offscreen,nr.useRuntimeCollisionCircles){const va=Z.text.placedSymbolArray.get(nr.centerJustifiedTextSymbolIndex),tu=M.aj(Z.textSizeData,_,va),Gs=H.get("text-padding");ao=this.collisionIndex.placeCollisionCircles(X,va,Z.lineVertexArray,Z.glyphOffsetArray,tu,ae,ue,ge,O,He,T.predicate,nr.collisionCircleDiameter,Gs,Ft),ao.circles.length&&ao.collisionDetected&&!O&&M.w("Collisions detected, but collision boxes are not shown"),nn=oe||ao.circles.length>0&&!ao.collisionDetected,Mn=Mn&&ao.offscreen}if(Ir.iconFeatureIndex&&(ja=Ir.iconFeatureIndex),Ir.iconBox){const va=tu=>{const Gs=$e&&yi?Yr(tu,yi.x,yi.y,De,He,this.transform.angle):tu;return this.collisionIndex.placeCollisionBox(Gs,xe,Le,ae,T.predicate,Ft)};Qi&&Qi.box&&Qi.box.length&&Ir.verticalIconBox?(Bi=va(Ir.verticalIconBox),Ln=Bi.box.length>0):(Bi=va(Ir.iconBox),Ln=Bi.box.length>0),Mn=Mn&&Bi.offscreen}const Qa=N||nr.numHorizontalGlyphVertices===0&&nr.numVerticalGlyphVertices===0,eo=$||nr.numIconVertices===0;if(Qa||eo?eo?Qa||(Ln=Ln&&nn):nn=Ln&&nn:Ln=nn=Ln&&nn,nn&&Vi&&Vi.box&&this.collisionIndex.insertCollisionBox(Vi.box,X,H.get("text-ignore-placement"),Z.bucketInstanceId,Qi&&Qi.box&&Ha?Ha:oa,T.ID),Ln&&Bi&&this.collisionIndex.insertCollisionBox(Bi.box,xe,H.get("icon-ignore-placement"),Z.bucketInstanceId,ja,T.ID),ao&&(nn&&this.collisionIndex.insertCollisionCircles(ao.circles,X,H.get("text-ignore-placement"),Z.bucketInstanceId,oa,T.ID),O)){const va=Z.bucketInstanceId;let tu=this.collisionCircleArrays[va];tu===void 0&&(tu=this.collisionCircleArrays[va]=new Be);for(let Gs=0;Gs<ao.circles.length;Gs+=4)tu.circles.push(ao.circles[Gs+0]),tu.circles.push(ao.circles[Gs+1]),tu.circles.push(ao.circles[Gs+2]),tu.circles.push(ao.collisionDetected?1:0)}if(nr.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(Z.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nr.crossTileID]=new Me(nn||pt,Ln||wt,Mn||Z.justReloaded),x[nr.crossTileID]=!0};if(ft){if(h.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nr=Z.getSortedSymbolIndexes(this.transform.angle);for(let Ir=nr.length-1;Ir>=0;--Ir){const _r=nr[Ir];ar(Z.symbolInstances.get(_r),Z.collisionArrays[_r])}}else for(let nr=h.symbolInstanceStart;nr<h.symbolInstanceEnd;nr++)ar(Z.symbolInstances.get(nr),Z.collisionArrays[nr]);if(O&&Z.bucketInstanceId in this.collisionCircleArrays){const nr=this.collisionCircleArrays[Z.bucketInstanceId];M.as(nr.invProjMatrix,ae),nr.viewportMatrix=this.collisionIndex.getViewportMatrix()}Z.justReloaded=!1}markUsedJustification(h,x,O,Z){let H;H=Z===M.ai.vertical?O.verticalPlacedTextSymbolIndex:{left:O.leftJustifiedTextSymbolIndex,center:O.centerJustifiedTextSymbolIndex,right:O.rightJustifiedTextSymbolIndex}[M.at(x)];const ae=[O.leftJustifiedTextSymbolIndex,O.centerJustifiedTextSymbolIndex,O.rightJustifiedTextSymbolIndex,O.verticalPlacedTextSymbolIndex];for(const ue of ae)ue>=0&&(h.text.placedSymbolArray.get(ue).crossTileID=H>=0&&ue!==H?0:O.crossTileID)}markUsedOrientation(h,x,O){const Z=x===M.ai.horizontal||x===M.ai.horizontalOnly?x:0,H=x===M.ai.vertical?x:0,ae=[O.leftJustifiedTextSymbolIndex,O.centerJustifiedTextSymbolIndex,O.rightJustifiedTextSymbolIndex];for(const ue of ae)h.text.placedSymbolArray.get(ue).placedOrientation=Z;O.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(O.verticalPlacedTextSymbolIndex).placedOrientation=H)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;const x=this.prevPlacement;let O=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;const Z=x?x.symbolFadeChange(h):1,H=x?x.opacities:{},ae=x?x.variableOffsets:{},ue=x?x.placedOrientations:{};for(const ge in this.placements){const Le=this.placements[ge],m=H[ge];m?(this.opacities[ge]=new Fe(m,Z,Le.text,Le.icon),O=O||Le.text!==m.text.placed||Le.icon!==m.icon.placed):(this.opacities[ge]=new Fe(null,Z,Le.text,Le.icon,Le.skipFade),O=O||Le.text||Le.icon)}for(const ge in H){const Le=H[ge];if(!this.opacities[ge]){const m=new Fe(Le,Z,!1,!1);m.isHidden()||(this.opacities[ge]=m,O=O||Le.text.placed||Le.icon.placed)}}for(const ge in ae)this.variableOffsets[ge]||!this.opacities[ge]||this.opacities[ge].isHidden()||(this.variableOffsets[ge]=ae[ge]);for(const ge in ue)this.placedOrientations[ge]||!this.opacities[ge]||this.opacities[ge].isHidden()||(this.placedOrientations[ge]=ue[ge]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");O?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:h)}updateLayerOpacities(h,x){const O={};for(const Z of x){const H=Z.getBucket(h);H&&Z.latestFeatureIndex&&h.id===H.layerIds[0]&&this.updateBucketOpacities(H,O,Z.collisionBoxArray)}}updateBucketOpacities(h,x,O){h.hasTextData()&&(h.text.opacityVertexArray.clear(),h.text.hasVisibleVertices=!1),h.hasIconData()&&(h.icon.opacityVertexArray.clear(),h.icon.hasVisibleVertices=!1),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();const Z=h.layers[0],H=Z.layout,ae=new Fe(null,0,!1,!1,!0),ue=H.get("text-allow-overlap"),ge=H.get("icon-allow-overlap"),Le=Z._unevaluatedLayout.hasValue("text-variable-anchor")||Z._unevaluatedLayout.hasValue("text-variable-anchor-offset"),m=H.get("text-rotation-alignment")==="map",w=H.get("text-pitch-alignment")==="map",_=H.get("icon-text-fit")!=="none",T=new Fe(null,0,ue&&(ge||!h.hasIconData()||H.get("icon-optional")),ge&&(ue||!h.hasTextData()||H.get("text-optional")),!0);!h.collisionArrays&&O&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(O);const N=($,X,oe)=>{for(let xe=0;xe<X/4;xe++)$.opacityVertexArray.emplaceBack(oe);$.hasVisibleVertices=$.hasVisibleVertices||oe!==io};for(let $=0;$<h.symbolInstances.length;$++){const X=h.symbolInstances.get($),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:xe,crossTileID:ye}=X;let De=this.opacities[ye];x[ye]?De=ae:De||(De=T,this.opacities[ye]=De),x[ye]=!0;const He=X.numIconVertices>0,$e=this.placedOrientations[X.crossTileID],ft=$e===M.ai.vertical,pt=$e===M.ai.horizontal||$e===M.ai.horizontalOnly;if(oe>0||xe>0){const wt=Ao(De.text);N(h.text,oe,ft?io:wt),N(h.text,xe,pt?io:wt);const dt=De.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(nr=>{nr>=0&&(h.text.placedSymbolArray.get(nr).hidden=dt||ft?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=dt||pt?1:0);const Ft=this.variableOffsets[X.crossTileID];Ft&&this.markUsedJustification(h,Ft.anchor,X,$e);const ar=this.placedOrientations[X.crossTileID];ar&&(this.markUsedJustification(h,"left",X,ar),this.markUsedOrientation(h,ar,X))}if(He){const wt=Ao(De.icon),dt=!(_&&X.verticalPlacedIconSymbolIndex&&ft);X.placedIconSymbolIndex>=0&&(N(h.icon,X.numIconVertices,dt?wt:io),h.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=De.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(N(h.icon,X.numVerticalIconVertices,dt?io:wt),h.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){const wt=h.collisionArrays[$];if(wt){let dt=new M.P(0,0);if(wt.textBox||wt.verticalTextBox){let ar=!0;if(Le){const nr=this.variableOffsets[ye];nr?(dt=Ze(nr.anchor,nr.width,nr.height,nr.textOffset,nr.textBoxScale),m&&dt._rotate(w?this.transform.angle:-this.transform.angle)):ar=!1}wt.textBox&&Nn(h.textCollisionBox.collisionVertexArray,De.text.placed,!ar||ft,dt.x,dt.y),wt.verticalTextBox&&Nn(h.textCollisionBox.collisionVertexArray,De.text.placed,!ar||pt,dt.x,dt.y)}const Ft=!!(!pt&&wt.verticalIconBox);wt.iconBox&&Nn(h.iconCollisionBox.collisionVertexArray,De.icon.placed,Ft,_?dt.x:0,_?dt.y:0),wt.verticalIconBox&&Nn(h.iconCollisionBox.collisionVertexArray,De.icon.placed,!Ft,_?dt.x:0,_?dt.y:0)}}}if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.text.opacityVertexArray.length!==h.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${h.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${h.text.layoutVertexArray.length}) / 4`);if(h.icon.opacityVertexArray.length!==h.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${h.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${h.icon.layoutVertexArray.length}) / 4`);if(h.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=$.invProjMatrix,h.placementViewportMatrix=$.viewportMatrix,h.collisionCircleArray=$.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,x){const O=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*O>h}setStale(){this.stale=!0}}function Nn(D,h,x,O,Z){D.emplaceBack(h?1:0,x?1:0,O||0,Z||0),D.emplaceBack(h?1:0,x?1:0,O||0,Z||0),D.emplaceBack(h?1:0,x?1:0,O||0,Z||0),D.emplaceBack(h?1:0,x?1:0,O||0,Z||0)}const qr=Math.pow(2,25),li=Math.pow(2,24),zn=Math.pow(2,17),jn=Math.pow(2,16),Ca=Math.pow(2,9),ni=Math.pow(2,8),za=Math.pow(2,1);function Ao(D){if(D.opacity===0&&!D.placed)return 0;if(D.opacity===1&&D.placed)return 4294967295;const h=D.placed?1:0,x=Math.floor(127*D.opacity);return x*qr+h*li+x*zn+h*jn+x*Ca+h*ni+x*za+h}const io=0;class ys{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&!h.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(h,x,O,Z,H){const ae=this._bucketParts;for(;this._currentTileIndex<h.length;)if(x.getBucketParts(ae,Z,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,H())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,ae.sort((ue,ge)=>ue.sortKey-ge.sortKey));this._currentPartIndex<ae.length;)if(x.placeLayerBucketPart(ae[this._currentPartIndex],this._seenCrossTileIDs,O),this._currentPartIndex++,H())return!0;return!1}}class oo{constructor(h,x,O,Z,H,ae,ue,ge){this.placement=new Fn(h,x,ae,ue,ge),this._currentPlacementIndex=O.length-1,this._forceFullPlacement=Z,this._showCollisionBoxes=H,this._done=!1}isDone(){return this._done}continuePlacement(h,x,O){const Z=M.h.now(),H=()=>!this._forceFullPlacement&&M.h.now()-Z>2;for(;this._currentPlacementIndex>=0;){const ae=x[h[this._currentPlacementIndex]],ue=this.placement.collisionIndex.transform.zoom;if(ae.type==="symbol"&&(!ae.minzoom||ae.minzoom<=ue)&&(!ae.maxzoom||ae.maxzoom>ue)){if(this._inProgressLayer||(this._inProgressLayer=new ys(ae)),this._inProgressLayer.continuePlacement(O[ae.source],this.placement,this._showCollisionBoxes,ae,H))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}const el=512/M.N/2;class Qs{constructor(h,x,O){this.tileID=h,this.bucketInstanceId=O,this._symbolsByKey={};const Z=new Map;for(let H=0;H<x.length;H++){const ae=x.get(H),ue=ae.key,ge=Z.get(ue);ge?ge.push(ae):Z.set(ue,[ae])}for(const[H,ae]of Z){const ue={positions:ae.map(ge=>({x:Math.floor(ge.anchorX*el),y:Math.floor(ge.anchorY*el)})),crossTileIDs:ae.map(ge=>ge.crossTileID)};if(ue.positions.length>128){const ge=new M.av(ue.positions.length,16,Uint16Array);for(const{x:Le,y:m}of ue.positions)ge.add(Le,m);ge.finish(),delete ue.positions,ue.index=ge}this._symbolsByKey[H]=ue}}getScaledCoordinates(h,x){const{x:O,y:Z,z:H}=this.tileID.canonical,{x:ae,y:ue,z:ge}=x.canonical,Le=el/Math.pow(2,ge-H),m=(ue*M.N+h.anchorY)*Le,w=Z*M.N*el;return{x:Math.floor((ae*M.N+h.anchorX)*Le-O*M.N*el),y:Math.floor(m-w)}}findMatches(h,x,O){const Z=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let H=0;H<h.length;H++){const ae=h.get(H);if(ae.crossTileID)continue;const ue=this._symbolsByKey[ae.key];if(!ue)continue;const ge=this.getScaledCoordinates(ae,x);if(ue.index){const Le=ue.index.range(ge.x-Z,ge.y-Z,ge.x+Z,ge.y+Z).sort();for(const m of Le){const w=ue.crossTileIDs[m];if(!O[w]){O[w]=!0,ae.crossTileID=w;break}}}else if(ue.positions)for(let Le=0;Le<ue.positions.length;Le++){const m=ue.positions[Le],w=ue.crossTileIDs[Le];if(Math.abs(m.x-ge.x)<=Z&&Math.abs(m.y-ge.y)<=Z&&!O[w]){O[w]=!0,ae.crossTileID=w;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:h})=>h)}}class vo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class as{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){const x=Math.round((h-this.lng)/360);if(x!==0)for(const O in this.indexes){const Z=this.indexes[O],H={};for(const ae in Z){const ue=Z[ae];ue.tileID=ue.tileID.unwrapTo(ue.tileID.wrap+x),H[ue.tileID.key]=ue}this.indexes[O]=H}this.lng=h}addBucket(h,x,O){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let H=0;H<x.symbolInstances.length;H++)x.symbolInstances.get(H).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});const Z=this.usedCrossTileIDs[h.overscaledZ];for(const H in this.indexes){const ae=this.indexes[H];if(Number(H)>h.overscaledZ)for(const ue in ae){const ge=ae[ue];ge.tileID.isChildOf(h)&&ge.findMatches(x.symbolInstances,h,Z)}else{const ue=ae[h.scaledTo(Number(H)).key];ue&&ue.findMatches(x.symbolInstances,h,Z)}}for(let H=0;H<x.symbolInstances.length;H++){const ae=x.symbolInstances.get(H);ae.crossTileID||(ae.crossTileID=O.generate(),Z[ae.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Qs(h,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(h,x){for(const O of x.getCrossTileIDsLists())for(const Z of O)delete this.usedCrossTileIDs[h][Z]}removeStaleBuckets(h){let x=!1;for(const O in this.indexes){const Z=this.indexes[O];for(const H in Z)h[Z[H].bucketInstanceId]||(this.removeBucketCrossTileIDs(O,Z[H]),delete Z[H],x=!0)}return x}}class To{constructor(){this.layerIndexes={},this.crossTileIDs=new vo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,x,O){let Z=this.layerIndexes[h.id];Z===void 0&&(Z=this.layerIndexes[h.id]=new as);let H=!1;const ae={};Z.handleWrapJump(O);for(const ue of x){const ge=ue.getBucket(h);ge&&h.id===ge.layerIds[0]&&(ge.bucketInstanceId||(ge.bucketInstanceId=++this.maxBucketInstanceId),Z.addBucket(ue.tileID,ge,this.crossTileIDs)&&(H=!0),ae[ge.bucketInstanceId]=!0)}return Z.removeStaleBuckets(ae)&&(H=!0),H}pruneUnusedLayers(h){const x={};h.forEach(O=>{x[O]=!0});for(const O in this.layerIndexes)x[O]||delete this.layerIndexes[O]}}const to=(D,h)=>M.x(D,h&&h.filter(x=>x.identifier!=="source.canvas")),js=M.F(M.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Vc=M.F(M.ax,["setCenter","setZoom","setBearing","setPitch"]),ws=M.aw();class Ss extends M.E{constructor(h,x={}){super(),this.map=h,this.dispatcher=new Pr(mn(),this,h._getMapId()),this.imageManager=new br,this.imageManager.setEventedParent(this),this.glyphManager=new ot(h._requestManager,x.localIdeographFontFamily),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new To,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new M.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",M.az());const O=this;this._rtlTextPluginCallback=Ss.registerForPluginStateChange(Z=>{O.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:Z.pluginStatus,pluginURL:Z.pluginURL},(H,ae)=>{if(M.aA(H),ae&&ae.every(ue=>ue))for(const ue in O.sourceCaches){const ge=O.sourceCaches[ue].getSource().type;ge!=="vector"&&ge!=="geojson"||O.sourceCaches[ue].reload()}})}),this.on("data",Z=>{if(Z.dataType!=="source"||Z.sourceDataType!=="metadata")return;const H=this.sourceCaches[Z.sourceId];if(!H)return;const ae=H.getSource();if(ae&&ae.vectorLayerIds)for(const ue in this._layers){const ge=this._layers[ue];ge.source===ae.id&&this._validateLayer(ge)}})}loadURL(h,x={},O){this.fire(new M.k("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;const Z=this.map._requestManager.transformRequest(h,Ct.Style);this._request=M.f(Z,(H,ae)=>{this._request=null,H?this.fire(new M.j(H)):ae&&this._load(ae,x,O)})}loadJSON(h,x={},O){this.fire(new M.k("dataloading",{dataType:"style"})),this._request=M.h.frame(()=>{this._request=null,x.validate=x.validate!==!1,this._load(h,x,O)})}loadEmpty(){this.fire(new M.k("dataloading",{dataType:"style"})),this._load(ws,{validate:!1})}_load(h,x,O){var Z;const H=x.transformStyle?x.transformStyle(O,h):h;if(!x.validate||!to(this,M.y(H))){this._loaded=!0,this.stylesheet=H;for(const ae in H.sources)this.addSource(ae,H.sources[ae],{validate:!1});H.sprite?this._loadSprite(H.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(H.glyphs),this._createLayers(),this.light=new Bt(this.stylesheet.light),this.map.setTerrain((Z=this.stylesheet.terrain)!==null&&Z!==void 0?Z:null),this.fire(new M.k("data",{dataType:"style"})),this.fire(new M.k("style.load"))}}_createLayers(){const h=M.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",h),this._order=h.map(x=>x.id),this._layers={},this._serializedLayers=null;for(const x of h){const O=M.aC(x);O.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=O}}_loadSprite(h,x=!1,O=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(Z,H,ae,ue){const ge=Rr(Z),Le=ge.length,m=ae>1?"@2x":"",w={},_={},T={};for(const{id:N,url:$}of ge){const X=H.transformRequest(H.normalizeSpriteURL($,m,".json"),Ct.SpriteJSON),oe=`${N}_${X.url}`;w[oe]=M.f(X,(De,He)=>{delete w[oe],_[N]=He,vn(ue,_,T,De,Le)});const xe=H.transformRequest(H.normalizeSpriteURL($,m,".png"),Ct.SpriteImage),ye=`${N}_${xe.url}`;w[ye]=nt.getImage(xe,(De,He)=>{delete w[ye],T[N]=He,vn(ue,_,T,De,Le)})}return{cancel(){for(const N of Object.values(w))N.cancel()}}}(h,this.map._requestManager,this.map.getPixelRatio(),(Z,H)=>{if(this._spriteRequest=null,Z)this.fire(new M.j(Z));else if(H)for(const ae in H){this._spritesImagesIds[ae]=[];const ue=this._spritesImagesIds[ae]?this._spritesImagesIds[ae].filter(ge=>!(ge in H)):[];for(const ge of ue)this.imageManager.removeImage(ge),this._changedImages[ge]=!0;for(const ge in H[ae]){const Le=ae==="default"?ge:`${ae}:${ge}`;this._spritesImagesIds[ae].push(Le),Le in this.imageManager.images?this.imageManager.updateImage(Le,H[ae][ge],!1):this.imageManager.addImage(Le,H[ae][ge]),x&&(this._changedImages[Le]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"})),O&&O(Z)})}_unloadSprite(){for(const h of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(h),this._changedImages[h]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}_validateLayer(h){const x=this.sourceCaches[h.source];if(!x)return;const O=h.sourceLayer;if(!O)return;const Z=x.getSource();(Z.type==="geojson"||Z.vectorLayerIds&&Z.vectorLayerIds.indexOf(O)===-1)&&this.fire(new M.j(new Error(`Source layer "${O}" does not exist on source "${Z.id}" as specified by style layer "${h.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(h){const x=this._serializedAllLayers();if(!h||h.length===0)return Object.values(x);const O=[];for(const Z of h)x[Z]&&O.push(x[Z]);return O}_serializedAllLayers(){let h=this._serializedLayers;if(h)return h;h=this._serializedLayers={};const x=Object.keys(this._layers);for(const O of x){const Z=this._layers[O];Z.type!=="custom"&&(h[O]=Z.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(h){if(!this._loaded)return;const x=this._changed;if(this._changed){const Z=Object.keys(this._updatedLayers),H=Object.keys(this._removedLayers);(Z.length||H.length)&&this._updateWorkerLayers(Z,H);for(const ae in this._updatedSources){const ue=this._updatedSources[ae];if(ue==="reload")this._reloadSource(ae);else{if(ue!=="clear")throw new Error(`Invalid action ${ue}`);this._clearSource(ae)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const ae in this._updatedPaintProps)this._layers[ae].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}const O={};for(const Z in this.sourceCaches){const H=this.sourceCaches[Z];O[Z]=H.used,H.used=!1}for(const Z of this._order){const H=this._layers[Z];H.recalculate(h,this._availableImages),!H.isHidden(h.zoom)&&H.source&&(this.sourceCaches[H.source].used=!0)}for(const Z in O){const H=this.sourceCaches[Z];O[Z]!==H.used&&H.fire(new M.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:Z}))}this.light.recalculate(h),this.z=h.zoom,x&&this.fire(new M.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const h=Object.keys(this._changedImages);if(h.length){for(const x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(h,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(h),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(h,x={}){this._checkLoaded();const O=this.serialize();if(h=x.transformStyle?x.transformStyle(O,h):h,to(this,M.y(h)))return!1;(h=M.aD(h)).layers=M.aB(h.layers);const Z=M.aE(O,h).filter(ae=>!(ae.command in Vc));if(Z.length===0)return!1;const H=Z.filter(ae=>!(ae.command in js));if(H.length>0)throw new Error(`Unimplemented: ${H.map(ae=>ae.command).join(", ")}.`);for(const ae of Z)ae.command!=="setTransition"&&this[ae.command].apply(this,ae.args);return this.stylesheet=h,this._serializedLayers=null,!0}addImage(h,x){if(this.getImage(h))return this.fire(new M.j(new Error(`An image named "${h}" already exists.`)));this.imageManager.addImage(h,x),this._afterImageUpdated(h)}updateImage(h,x){this.imageManager.updateImage(h,x)}getImage(h){return this.imageManager.getImage(h)}removeImage(h){if(!this.getImage(h))return this.fire(new M.j(new Error(`An image named "${h}" does not exist.`)));this.imageManager.removeImage(h),this._afterImageUpdated(h)}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(h,x,O={}){if(this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error(`Source "${h}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(M.y.source,`sources.${h}`,x,null,O))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);const Z=this.sourceCaches[h]=new Ua(h,x,this.dispatcher);Z.style=this,Z.setEventedParent(this,()=>({isSourceLoaded:Z.loaded(),source:Z.serialize(),sourceId:h})),Z.onAdd(this.map),this._changed=!0}removeSource(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(const O in this._layers)if(this._layers[O].source===h)return this.fire(new M.j(new Error(`Source "${h}" cannot be removed while layer "${O}" is using it.`)));const x=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],x.fire(new M.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(h,x){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error(`There is no source with this ID=${h}`);const O=this.sourceCaches[h].getSource();if(O.type!=="geojson")throw new Error(`geojsonSource.type is ${O.type}, which is !== 'geojson`);O.setData(x),this._changed=!0}getSource(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()}addLayer(h,x,O={}){this._checkLoaded();const Z=h.id;if(this.getLayer(Z))return void this.fire(new M.j(new Error(`Layer "${Z}" already exists on this map.`)));let H;if(h.type==="custom"){if(to(this,M.aF(h)))return;H=M.aC(h)}else{if("source"in h&&typeof h.source=="object"&&(this.addSource(Z,h.source),h=M.aD(h),h=M.e(h,{source:Z})),this._validate(M.y.layer,`layers.${Z}`,h,{arrayIndex:-1},O))return;H=M.aC(h),this._validateLayer(H),H.setEventedParent(this,{layer:{id:Z}})}const ae=x?this._order.indexOf(x):this._order.length;if(x&&ae===-1)this.fire(new M.j(new Error(`Cannot add layer "${Z}" before non-existing layer "${x}".`)));else{if(this._order.splice(ae,0,Z),this._layerOrderChanged=!0,this._layers[Z]=H,this._removedLayers[Z]&&H.source&&H.type!=="custom"){const ue=this._removedLayers[Z];delete this._removedLayers[Z],ue.type!==H.type?this._updatedSources[H.source]="clear":(this._updatedSources[H.source]="reload",this.sourceCaches[H.source].pause())}this._updateLayer(H),H.onAdd&&H.onAdd(this.map)}}moveLayer(h,x){if(this._checkLoaded(),this._changed=!0,!this._layers[h])return void this.fire(new M.j(new Error(`The layer '${h}' does not exist in the map's style and cannot be moved.`)));if(h===x)return;const O=this._order.indexOf(h);this._order.splice(O,1);const Z=x?this._order.indexOf(x):this._order.length;x&&Z===-1?this.fire(new M.j(new Error(`Cannot move layer "${h}" before non-existing layer "${x}".`))):(this._order.splice(Z,0,h),this._layerOrderChanged=!0)}removeLayer(h){this._checkLoaded();const x=this._layers[h];if(!x)return void this.fire(new M.j(new Error(`Cannot remove non-existing layer "${h}".`)));x.setEventedParent(null);const O=this._order.indexOf(h);this._order.splice(O,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=x,delete this._layers[h],this._serializedLayers&&delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],x.onRemove&&x.onRemove(this.map)}getLayer(h){return this._layers[h]}hasLayer(h){return h in this._layers}setLayerZoomRange(h,x,O){this._checkLoaded();const Z=this.getLayer(h);Z?Z.minzoom===x&&Z.maxzoom===O||(x!=null&&(Z.minzoom=x),O!=null&&(Z.maxzoom=O),this._updateLayer(Z)):this.fire(new M.j(new Error(`Cannot set the zoom range of non-existing layer "${h}".`)))}setFilter(h,x,O={}){this._checkLoaded();const Z=this.getLayer(h);if(Z){if(!M.aG(Z.filter,x))return x==null?(Z.filter=void 0,void this._updateLayer(Z)):void(this._validate(M.y.filter,`layers.${Z.id}.filter`,x,null,O)||(Z.filter=M.aD(x),this._updateLayer(Z)))}else this.fire(new M.j(new Error(`Cannot filter non-existing layer "${h}".`)))}getFilter(h){return M.aD(this.getLayer(h).filter)}setLayoutProperty(h,x,O,Z={}){this._checkLoaded();const H=this.getLayer(h);H?M.aG(H.getLayoutProperty(x),O)||(H.setLayoutProperty(x,O,Z),this._updateLayer(H)):this.fire(new M.j(new Error(`Cannot style non-existing layer "${h}".`)))}getLayoutProperty(h,x){const O=this.getLayer(h);if(O)return O.getLayoutProperty(x);this.fire(new M.j(new Error(`Cannot get style of non-existing layer "${h}".`)))}setPaintProperty(h,x,O,Z={}){this._checkLoaded();const H=this.getLayer(h);H?M.aG(H.getPaintProperty(x),O)||(H.setPaintProperty(x,O,Z)&&this._updateLayer(H),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new M.j(new Error(`Cannot style non-existing layer "${h}".`)))}getPaintProperty(h,x){return this.getLayer(h).getPaintProperty(x)}setFeatureState(h,x){this._checkLoaded();const O=h.source,Z=h.sourceLayer,H=this.sourceCaches[O];if(H===void 0)return void this.fire(new M.j(new Error(`The source '${O}' does not exist in the map's style.`)));const ae=H.getSource().type;ae==="geojson"&&Z?this.fire(new M.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):ae!=="vector"||Z?(h.id===void 0&&this.fire(new M.j(new Error("The feature id parameter must be provided."))),H.setFeatureState(Z,h.id,x)):this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(h,x){this._checkLoaded();const O=h.source,Z=this.sourceCaches[O];if(Z===void 0)return void this.fire(new M.j(new Error(`The source '${O}' does not exist in the map's style.`)));const H=Z.getSource().type,ae=H==="vector"?h.sourceLayer:void 0;H!=="vector"||ae?x&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new M.j(new Error("A feature id is required to remove its specific state property."))):Z.removeFeatureState(ae,h.id,x):this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(h){this._checkLoaded();const x=h.source,O=h.sourceLayer,Z=this.sourceCaches[x];if(Z!==void 0)return Z.getSource().type!=="vector"||O?(h.id===void 0&&this.fire(new M.j(new Error("The feature id parameter must be provided."))),Z.getFeatureState(O,h.id)):void this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new M.j(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return M.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const h=M.aH(this.sourceCaches,H=>H.serialize()),x=this._serializeByIds(this._order),O=this.map.getTerrain()||void 0,Z=this.stylesheet;return M.aI({version:Z.version,name:Z.name,metadata:Z.metadata,light:Z.light,center:Z.center,zoom:Z.zoom,bearing:Z.bearing,pitch:Z.pitch,sprite:Z.sprite,glyphs:Z.glyphs,transition:Z.transition,sources:h,layers:x,terrain:O},H=>H!==void 0)}_updateLayer(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(h){const x=ae=>this._layers[ae].type==="fill-extrusion",O={},Z=[];for(let ae=this._order.length-1;ae>=0;ae--){const ue=this._order[ae];if(x(ue)){O[ue]=ae;for(const ge of h){const Le=ge[ue];if(Le)for(const m of Le)Z.push(m)}}}Z.sort((ae,ue)=>ue.intersectionZ-ae.intersectionZ);const H=[];for(let ae=this._order.length-1;ae>=0;ae--){const ue=this._order[ae];if(x(ue))for(let ge=Z.length-1;ge>=0;ge--){const Le=Z[ge].feature;if(O[Le.layer.id]<ae)break;H.push(Le),Z.pop()}else for(const ge of h){const Le=ge[ue];if(Le)for(const m of Le)H.push(m.feature)}}return H}queryRenderedFeatures(h,x,O){x&&x.filter&&this._validate(M.y.filter,"queryRenderedFeatures.filter",x.filter,null,x);const Z={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new M.j(new Error("parameters.layers must be an Array."))),[];for(const ue of x.layers){const ge=this._layers[ue];if(!ge)return this.fire(new M.j(new Error(`The layer '${ue}' does not exist in the map's style and cannot be queried for features.`))),[];Z[ge.source]=!0}}const H=[];x.availableImages=this._availableImages;const ae=this._serializedAllLayers();for(const ue in this.sourceCaches)x.layers&&!Z[ue]||H.push(Ko(this.sourceCaches[ue],this._layers,ae,h,x,O));return this.placement&&H.push(function(ue,ge,Le,m,w,_,T){const N={},$=_.queryRenderedSymbols(m),X=[];for(const oe of Object.keys($).map(Number))X.push(T[oe]);X.sort(Za);for(const oe of X){const xe=oe.featureIndex.lookupSymbolFeatures($[oe.bucketInstanceId],ge,oe.bucketIndex,oe.sourceLayerIndex,w.filter,w.layers,w.availableImages,ue);for(const ye in xe){const De=N[ye]=N[ye]||[],He=xe[ye];He.sort(($e,ft)=>{const pt=oe.featureSortOrder;if(pt){const wt=pt.indexOf($e.featureIndex);return pt.indexOf(ft.featureIndex)-wt}return ft.featureIndex-$e.featureIndex});for(const $e of He)De.push($e)}}for(const oe in N)N[oe].forEach(xe=>{const ye=xe.feature,De=Le[ue[oe].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=De});return N}(this._layers,ae,this.sourceCaches,h,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(H)}querySourceFeatures(h,x){x&&x.filter&&this._validate(M.y.filter,"querySourceFeatures.filter",x.filter,null,x);const O=this.sourceCaches[h];return O?function(Z,H){const ae=Z.getRenderableIds().map(Le=>Z.getTileByID(Le)),ue=[],ge={};for(let Le=0;Le<ae.length;Le++){const m=ae[Le],w=m.tileID.canonical.key;ge[w]||(ge[w]=!0,m.querySourceFeatures(ue,H))}return ue}(O,x):[]}addSourceType(h,x,O){return qo(h)?O(new Error(`A source type called "${h}" already exists.`)):(((Z,H)=>{$i[Z]=H})(h,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:x.workerSourceURL},O):O(null,null))}getLight(){return this.light.getLight()}setLight(h,x={}){this._checkLoaded();const O=this.light.getLight();let Z=!1;for(const ae in h)if(!M.aG(h[ae],O[ae])){Z=!0;break}if(!Z)return;const H={now:M.h.now(),transition:M.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,x),this.light.updateTransitions(H)}_validate(h,x,O,Z,H={}){return(!H||H.validate!==!1)&&to(this,h.call(M.y,M.e({key:x,style:this.serialize(),value:O,styleSpec:M.v},Z)))}_remove(h=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),M.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const x in this._layers)this._layers[x].setEventedParent(null);for(const x in this.sourceCaches){const O=this.sourceCaches[x];O.setEventedParent(null),O.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(h)}_clearSource(h){this.sourceCaches[h].clearTiles()}_reloadSource(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()}_updateSources(h){for(const x in this.sourceCaches)this.sourceCaches[x].update(h,this.map.terrain)}_generateCollisionBoxes(){for(const h in this.sourceCaches)this._reloadSource(h)}_updatePlacement(h,x,O,Z,H=!1){let ae=!1,ue=!1;const ge={};for(const Le of this._order){const m=this._layers[Le];if(m.type!=="symbol")continue;if(!ge[m.source]){const _=this.sourceCaches[m.source];ge[m.source]=_.getRenderableIds(!0).map(T=>_.getTileByID(T)).sort((T,N)=>N.tileID.overscaledZ-T.tileID.overscaledZ||(T.tileID.isLessThan(N.tileID)?-1:1))}const w=this.crossTileSymbolIndex.addLayer(m,ge[m.source],h.center.lng);ae=ae||w}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((H=H||this._layerOrderChanged||O===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.h.now(),h.zoom))&&(this.pauseablePlacement=new oo(h,this.map.terrain,this._order,H,x,O,Z,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ge),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.h.now()),ue=!0),ae&&this.pauseablePlacement.placement.setStale()),ue||ae)for(const Le of this._order){const m=this._layers[Le];m.type==="symbol"&&this.placement.updateLayerOpacities(m,ge[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.h.now())}_releaseSymbolFadeTiles(){for(const h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()}getImages(h,x,O){this.imageManager.getImages(x.icons,O),this._updateTilesForChangedImages();const Z=this.sourceCaches[x.source];Z&&Z.setDependencies(x.tileID.key,x.type,x.icons)}getGlyphs(h,x,O){this.glyphManager.getGlyphs(x.stacks,O);const Z=this.sourceCaches[x.source];Z&&Z.setDependencies(x.tileID.key,x.type,[""])}getResource(h,x,O){return M.m(x,O)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(h,x={}){this._checkLoaded(),h&&this._validate(M.y.glyphs,"glyphs",h,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=h,this.glyphManager.entries={},this.glyphManager.setURL(h))}addSprite(h,x,O={},Z){this._checkLoaded();const H=[{id:h,url:x}],ae=[...Rr(this.stylesheet.sprite),...H];this._validate(M.y.sprite,"sprite",ae,null,O)||(this.stylesheet.sprite=ae,this._loadSprite(H,!0,Z))}removeSprite(h){this._checkLoaded();const x=Rr(this.stylesheet.sprite);if(x.find(O=>O.id===h)){if(this._spritesImagesIds[h])for(const O of this._spritesImagesIds[h])this.imageManager.removeImage(O),this._changedImages[O]=!0;x.splice(x.findIndex(O=>O.id===h),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[h],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}else this.fire(new M.j(new Error(`Sprite "${h}" doesn't exists on this map.`)))}getSprite(){return Rr(this.stylesheet.sprite)}setSprite(h,x={},O){this._checkLoaded(),h&&this._validate(M.y.sprite,"sprite",h,null,x)||(this.stylesheet.sprite=h,h?this._loadSprite(h,!0,O):(this._unloadSprite(),O&&O(null)))}}Ss.registerForPluginStateChange=M.aK;var eh=M.Q([{name:"a_pos",type:"Int16",components:2}]),kc="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Io={prelude:bo(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:bo(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:bo(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:bo(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:bo("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bo(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:bo(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:bo("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bo("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bo("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:bo(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:bo(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:bo(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:bo(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:bo(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:bo(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:bo(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bo(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:bo(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:bo(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:bo(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:bo(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:bo(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:bo(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:bo(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:bo(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:bo("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",kc),terrainDepth:bo("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",kc),terrainCoords:bo("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",kc)};function bo(D,h){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,O=h.match(/attribute ([\w]+) ([\w]+)/g),Z=D.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),H=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),ae=H?H.concat(Z):Z,ue={};return{fragmentSource:D=D.replace(x,(ge,Le,m,w,_)=>(ue[_]=!0,Le==="define"?`
#ifndef HAS_UNIFORM_u_${_}
varying ${m} ${w} ${_};
#else
uniform ${m} ${w} u_${_};
#endif
`:`
#ifdef HAS_UNIFORM_u_${_}
    ${m} ${w} ${_} = u_${_};
#endif
`)),vertexSource:h=h.replace(x,(ge,Le,m,w,_)=>{const T=w==="float"?"vec2":"vec4",N=_.match(/color/)?"color":T;return ue[_]?Le==="define"?`
#ifndef HAS_UNIFORM_u_${_}
uniform lowp float u_${_}_t;
attribute ${m} ${T} a_${_};
varying ${m} ${w} ${_};
#else
uniform ${m} ${w} u_${_};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${_}
    ${_} = a_${_};
#else
    ${m} ${w} ${_} = u_${_};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_}
    ${_} = unpack_mix_${N}(a_${_}, u_${_}_t);
#else
    ${m} ${w} ${_} = u_${_};
#endif
`:Le==="define"?`
#ifndef HAS_UNIFORM_u_${_}
uniform lowp float u_${_}_t;
attribute ${m} ${T} a_${_};
#else
uniform ${m} ${w} u_${_};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${_}
    ${m} ${w} ${_} = a_${_};
#else
    ${m} ${w} ${_} = u_${_};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_}
    ${m} ${w} ${_} = unpack_mix_${N}(a_${_}, u_${_}_t);
#else
    ${m} ${w} ${_} = u_${_};
#endif
`}),staticAttributes:O,staticUniforms:ae}}class du{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(h,x,O,Z,H,ae,ue,ge,Le){this.context=h;let m=this.boundPaintVertexBuffers.length!==Z.length;for(let w=0;!m&&w<Z.length;w++)this.boundPaintVertexBuffers[w]!==Z[w]&&(m=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==O||m||this.boundIndexBuffer!==H||this.boundVertexOffset!==ae||this.boundDynamicVertexBuffer!==ue||this.boundDynamicVertexBuffer2!==ge||this.boundDynamicVertexBuffer3!==Le?this.freshBind(x,O,Z,H,ae,ue,ge,Le):(h.bindVertexArray.set(this.vao),ue&&ue.bind(),H&&H.dynamicDraw&&H.bind(),ge&&ge.bind(),Le&&Le.bind())}freshBind(h,x,O,Z,H,ae,ue,ge){const Le=h.numAttributes,m=this.context,w=m.gl;this.vao&&this.destroy(),this.vao=m.createVertexArray(),m.bindVertexArray.set(this.vao),this.boundProgram=h,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=O,this.boundIndexBuffer=Z,this.boundVertexOffset=H,this.boundDynamicVertexBuffer=ae,this.boundDynamicVertexBuffer2=ue,this.boundDynamicVertexBuffer3=ge,x.enableAttributes(w,h);for(const _ of O)_.enableAttributes(w,h);ae&&ae.enableAttributes(w,h),ue&&ue.enableAttributes(w,h),ge&&ge.enableAttributes(w,h),x.bind(),x.setVertexAttribPointers(w,h,H);for(const _ of O)_.bind(),_.setVertexAttribPointers(w,h,H);ae&&(ae.bind(),ae.setVertexAttribPointers(w,h,H)),Z&&Z.bind(),ue&&(ue.bind(),ue.setVertexAttribPointers(w,h,H)),ge&&(ge.bind(),ge.setVertexAttribPointers(w,h,H)),m.currentNumAttributes=Le}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Zo(D){const h=[];for(let x=0;x<D.length;x++){if(D[x]===null)continue;const O=D[x].split(" ");h.push(O.pop())}return h}class Il{constructor(h,x,O,Z,H,ae){const ue=h.gl;this.program=ue.createProgram();const ge=Zo(x.staticAttributes),Le=O?O.getBinderAttributes():[],m=ge.concat(Le),w=Io.prelude.staticUniforms?Zo(Io.prelude.staticUniforms):[],_=x.staticUniforms?Zo(x.staticUniforms):[],T=O?O.getBinderUniforms():[],N=w.concat(_).concat(T),$=[];for(const $e of N)$.indexOf($e)<0&&$.push($e);const X=O?O.defines():[];H&&X.push("#define OVERDRAW_INSPECTOR;"),ae&&X.push("#define TERRAIN3D;");const oe=X.concat(Io.prelude.fragmentSource,x.fragmentSource).join(`
`),xe=X.concat(Io.prelude.vertexSource,x.vertexSource).join(`
`),ye=ue.createShader(ue.FRAGMENT_SHADER);if(ue.isContextLost())return void(this.failedToCreate=!0);if(ue.shaderSource(ye,oe),ue.compileShader(ye),!ue.getShaderParameter(ye,ue.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${ue.getShaderInfoLog(ye)}`);ue.attachShader(this.program,ye);const De=ue.createShader(ue.VERTEX_SHADER);if(ue.isContextLost())return void(this.failedToCreate=!0);if(ue.shaderSource(De,xe),ue.compileShader(De),!ue.getShaderParameter(De,ue.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${ue.getShaderInfoLog(De)}`);ue.attachShader(this.program,De),this.attributes={};const He={};this.numAttributes=m.length;for(let $e=0;$e<this.numAttributes;$e++)m[$e]&&(ue.bindAttribLocation(this.program,$e,m[$e]),this.attributes[m[$e]]=$e);if(ue.linkProgram(this.program),!ue.getProgramParameter(this.program,ue.LINK_STATUS))throw new Error(`Program failed to link: ${ue.getProgramInfoLog(this.program)}`);ue.deleteShader(De),ue.deleteShader(ye);for(let $e=0;$e<$.length;$e++){const ft=$[$e];if(ft&&!He[ft]){const pt=ue.getUniformLocation(this.program,ft);pt&&(He[ft]=pt)}}this.fixedUniforms=Z(h,He),this.terrainUniforms=(($e,ft)=>({u_depth:new M.aL($e,ft.u_depth),u_terrain:new M.aL($e,ft.u_terrain),u_terrain_dim:new M.aM($e,ft.u_terrain_dim),u_terrain_matrix:new M.aN($e,ft.u_terrain_matrix),u_terrain_unpack:new M.aO($e,ft.u_terrain_unpack),u_terrain_exaggeration:new M.aM($e,ft.u_terrain_exaggeration)}))(h,He),this.binderUniforms=O?O.getUniforms(h,He):[]}draw(h,x,O,Z,H,ae,ue,ge,Le,m,w,_,T,N,$,X,oe,xe){const ye=h.gl;if(this.failedToCreate)return;if(h.program.set(this.program),h.setDepthMode(O),h.setStencilMode(Z),h.setColorMode(H),h.setCullFace(ae),ge){h.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,ge.depthTexture),h.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,ge.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(ge[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(ue[He]);$&&$.setUniforms(h,this.binderUniforms,T,{zoom:N});let De=0;switch(x){case ye.LINES:De=2;break;case ye.TRIANGLES:De=3;break;case ye.LINE_STRIP:De=1}for(const He of _.get()){const $e=He.vaos||(He.vaos={});($e[Le]||($e[Le]=new du)).bind(h,this,m,$?$.getPaintVertexBuffers():[],w,He.vertexOffset,X,oe,xe),ye.drawElements(x,He.primitiveLength*De,ye.UNSIGNED_SHORT,He.primitiveOffset*De*2)}}}function Uo(D,h,x){const O=1/Qe(x,1,h.transform.tileZoom),Z=Math.pow(2,x.tileID.overscaledZ),H=x.tileSize*Math.pow(2,h.transform.tileZoom)/Z,ae=H*(x.tileID.canonical.x+x.tileID.wrap*Z),ue=H*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[O,D.fromScale,D.toScale],u_fade:D.t,u_pixel_coord_upper:[ae>>16,ue>>16],u_pixel_coord_lower:[65535&ae,65535&ue]}}const Ws=(D,h,x,O)=>{const Z=h.style.light,H=Z.properties.get("position"),ae=[H.x,H.y,H.z],ue=function(){var Le=new M.A(9);return M.A!=Float32Array&&(Le[1]=0,Le[2]=0,Le[3]=0,Le[5]=0,Le[6]=0,Le[7]=0),Le[0]=1,Le[4]=1,Le[8]=1,Le}();Z.properties.get("anchor")==="viewport"&&function(Le,m){var w=Math.sin(m),_=Math.cos(m);Le[0]=_,Le[1]=w,Le[2]=0,Le[3]=-w,Le[4]=_,Le[5]=0,Le[6]=0,Le[7]=0,Le[8]=1}(ue,-h.transform.angle),function(Le,m,w){var _=m[0],T=m[1],N=m[2];Le[0]=_*w[0]+T*w[3]+N*w[6],Le[1]=_*w[1]+T*w[4]+N*w[7],Le[2]=_*w[2]+T*w[5]+N*w[8]}(ae,ae,ue);const ge=Z.properties.get("color");return{u_matrix:D,u_lightpos:ae,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+x,u_opacity:O}},eu=(D,h,x,O,Z,H,ae)=>M.e(Ws(D,h,x,O),Uo(H,h,ae),{u_height_factor:-Math.pow(2,Z.overscaledZ)/ae.tileSize/8}),sl=D=>({u_matrix:D}),ul=(D,h,x,O)=>M.e(sl(D),Uo(x,h,O)),ll=(D,h)=>({u_matrix:D,u_world:h}),_c=(D,h,x,O,Z)=>M.e(ul(D,h,x,O),{u_world:Z}),zu=(D,h,x,O)=>{const Z=D.transform;let H,ae;if(O.paint.get("circle-pitch-alignment")==="map"){const ue=Qe(x,1,Z.zoom);H=!0,ae=[ue,ue]}else H=!1,ae=Z.pixelsToGLUnits;return{u_camera_to_center_distance:Z.cameraToCenterDistance,u_scale_with_map:+(O.paint.get("circle-pitch-scale")==="map"),u_matrix:D.translatePosMatrix(h.posMatrix,x,O.paint.get("circle-translate"),O.paint.get("circle-translate-anchor")),u_pitch_with_map:+H,u_device_pixel_ratio:D.pixelRatio,u_extrude_scale:ae}},cl=(D,h,x)=>{const O=Qe(x,1,h.zoom),Z=Math.pow(2,h.zoom-x.tileID.overscaledZ),H=x.tileID.overscaleFactor();return{u_matrix:D,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:O,u_extrude_scale:[h.pixelsToGLUnits[0]/(O*Z),h.pixelsToGLUnits[1]/(O*Z)],u_overscale_factor:H}},iu=(D,h,x=1)=>({u_matrix:D,u_color:h,u_overlay:0,u_overlay_scale:x}),_t=D=>({u_matrix:D}),Ut=(D,h,x,O)=>({u_matrix:D,u_extrude_scale:Qe(h,1,x),u_intensity:O});function Er(D,h){const x=Math.pow(2,h.canonical.z),O=h.canonical.y;return[new M.U(0,O/x).toLngLat().lat,new M.U(0,(O+1)/x).toLngLat().lat]}const Sn=(D,h,x,O)=>{const Z=D.transform;return{u_matrix:Jo(D,h,x,O),u_ratio:1/Qe(h,1,Z.zoom),u_device_pixel_ratio:D.pixelRatio,u_units_to_pixels:[1/Z.pixelsToGLUnits[0],1/Z.pixelsToGLUnits[1]]}},kr=(D,h,x,O,Z)=>M.e(Sn(D,h,x,Z),{u_image:0,u_image_height:O}),wa=(D,h,x,O,Z)=>{const H=D.transform,ae=yl(h,H);return{u_matrix:Jo(D,h,x,Z),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Qe(h,1,H.zoom),u_device_pixel_ratio:D.pixelRatio,u_image:0,u_scale:[ae,O.fromScale,O.toScale],u_fade:O.t,u_units_to_pixels:[1/H.pixelsToGLUnits[0],1/H.pixelsToGLUnits[1]]}},Xa=(D,h,x,O,Z,H)=>{const ae=D.lineAtlas,ue=yl(h,D.transform),ge=x.layout.get("line-cap")==="round",Le=ae.getDash(O.from,ge),m=ae.getDash(O.to,ge),w=Le.width*Z.fromScale,_=m.width*Z.toScale;return M.e(Sn(D,h,x,H),{u_patternscale_a:[ue/w,-Le.height/2],u_patternscale_b:[ue/_,-m.height/2],u_sdfgamma:ae.width/(256*Math.min(w,_)*D.pixelRatio)/2,u_image:0,u_tex_y_a:Le.y,u_tex_y_b:m.y,u_mix:Z.t})};function yl(D,h){return 1/Qe(D,1,h.tileZoom)}function Jo(D,h,x,O){return D.translatePosMatrix(O?O.posMatrix:h.tileID.posMatrix,h,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}const au=(D,h,x,O,Z)=>{return{u_matrix:D,u_tl_parent:h,u_scale_parent:x,u_buffer_scale:1,u_fade_t:O.mix,u_opacity:O.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:(ae=Z.paint.get("raster-saturation"),ae>0?1-1/(1.001-ae):-ae),u_contrast_factor:(H=Z.paint.get("raster-contrast"),H>0?1/(1-H):1+H),u_spin_weights:ou(Z.paint.get("raster-hue-rotate"))};var H,ae};function ou(D){D*=Math.PI/180;const h=Math.sin(D),x=Math.cos(D);return[(2*x+1)/3,(-Math.sqrt(3)*h-x+1)/3,(Math.sqrt(3)*h-x+1)/3]}const Ra=(D,h,x,O,Z,H,ae,ue,ge,Le)=>{const m=Z.transform;return{u_is_size_zoom_constant:+(D==="constant"||D==="source"),u_is_size_feature_constant:+(D==="constant"||D==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:m.cameraToCenterDistance,u_pitch:m.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:m.width/m.height,u_fade_change:Z.options.fadeDuration?Z.symbolFadeChange:1,u_matrix:H,u_label_plane_matrix:ae,u_coord_matrix:ue,u_is_text:+ge,u_pitch_with_map:+O,u_texsize:Le,u_texture:0}},Mp=(D,h,x,O,Z,H,ae,ue,ge,Le,m)=>{const w=Z.transform;return M.e(Ra(D,h,x,O,Z,H,ae,ue,ge,Le),{u_gamma_scale:O?Math.cos(w._pitch)*w.cameraToCenterDistance:1,u_device_pixel_ratio:Z.pixelRatio,u_is_halo:+m})},th=(D,h,x,O,Z,H,ae,ue,ge,Le)=>M.e(Mp(D,h,x,O,Z,H,ae,ue,!0,ge,!0),{u_texsize_icon:Le,u_texture_icon:1}),su=(D,h,x)=>({u_matrix:D,u_opacity:h,u_color:x}),_a=(D,h,x,O,Z,H)=>M.e(function(ae,ue,ge,Le){const m=ge.imageManager.getPattern(ae.from.toString()),w=ge.imageManager.getPattern(ae.to.toString()),{width:_,height:T}=ge.imageManager.getPixelSize(),N=Math.pow(2,Le.tileID.overscaledZ),$=Le.tileSize*Math.pow(2,ge.transform.tileZoom)/N,X=$*(Le.tileID.canonical.x+Le.tileID.wrap*N),oe=$*Le.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:m.tl,u_pattern_br_a:m.br,u_pattern_tl_b:w.tl,u_pattern_br_b:w.br,u_texsize:[_,T],u_mix:ue.t,u_pattern_size_a:m.displaySize,u_pattern_size_b:w.displaySize,u_scale_a:ue.fromScale,u_scale_b:ue.toScale,u_tile_units_to_pixels:1/Qe(Le,1,ge.transform.tileZoom),u_pixel_coord_upper:[X>>16,oe>>16],u_pixel_coord_lower:[65535&X,65535&oe]}}(O,H,x,Z),{u_matrix:D,u_opacity:h}),os={fillExtrusion:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_lightpos:new M.aP(D,h.u_lightpos),u_lightintensity:new M.aM(D,h.u_lightintensity),u_lightcolor:new M.aP(D,h.u_lightcolor),u_vertical_gradient:new M.aM(D,h.u_vertical_gradient),u_opacity:new M.aM(D,h.u_opacity)}),fillExtrusionPattern:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_lightpos:new M.aP(D,h.u_lightpos),u_lightintensity:new M.aM(D,h.u_lightintensity),u_lightcolor:new M.aP(D,h.u_lightcolor),u_vertical_gradient:new M.aM(D,h.u_vertical_gradient),u_height_factor:new M.aM(D,h.u_height_factor),u_image:new M.aL(D,h.u_image),u_texsize:new M.aQ(D,h.u_texsize),u_pixel_coord_upper:new M.aQ(D,h.u_pixel_coord_upper),u_pixel_coord_lower:new M.aQ(D,h.u_pixel_coord_lower),u_scale:new M.aP(D,h.u_scale),u_fade:new M.aM(D,h.u_fade),u_opacity:new M.aM(D,h.u_opacity)}),fill:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix)}),fillPattern:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_image:new M.aL(D,h.u_image),u_texsize:new M.aQ(D,h.u_texsize),u_pixel_coord_upper:new M.aQ(D,h.u_pixel_coord_upper),u_pixel_coord_lower:new M.aQ(D,h.u_pixel_coord_lower),u_scale:new M.aP(D,h.u_scale),u_fade:new M.aM(D,h.u_fade)}),fillOutline:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_world:new M.aQ(D,h.u_world)}),fillOutlinePattern:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_world:new M.aQ(D,h.u_world),u_image:new M.aL(D,h.u_image),u_texsize:new M.aQ(D,h.u_texsize),u_pixel_coord_upper:new M.aQ(D,h.u_pixel_coord_upper),u_pixel_coord_lower:new M.aQ(D,h.u_pixel_coord_lower),u_scale:new M.aP(D,h.u_scale),u_fade:new M.aM(D,h.u_fade)}),circle:(D,h)=>({u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_scale_with_map:new M.aL(D,h.u_scale_with_map),u_pitch_with_map:new M.aL(D,h.u_pitch_with_map),u_extrude_scale:new M.aQ(D,h.u_extrude_scale),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_matrix:new M.aN(D,h.u_matrix)}),collisionBox:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_pixels_to_tile_units:new M.aM(D,h.u_pixels_to_tile_units),u_extrude_scale:new M.aQ(D,h.u_extrude_scale),u_overscale_factor:new M.aM(D,h.u_overscale_factor)}),collisionCircle:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_inv_matrix:new M.aN(D,h.u_inv_matrix),u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_viewport_size:new M.aQ(D,h.u_viewport_size)}),debug:(D,h)=>({u_color:new M.aR(D,h.u_color),u_matrix:new M.aN(D,h.u_matrix),u_overlay:new M.aL(D,h.u_overlay),u_overlay_scale:new M.aM(D,h.u_overlay_scale)}),clippingMask:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix)}),heatmap:(D,h)=>({u_extrude_scale:new M.aM(D,h.u_extrude_scale),u_intensity:new M.aM(D,h.u_intensity),u_matrix:new M.aN(D,h.u_matrix)}),heatmapTexture:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_world:new M.aQ(D,h.u_world),u_image:new M.aL(D,h.u_image),u_color_ramp:new M.aL(D,h.u_color_ramp),u_opacity:new M.aM(D,h.u_opacity)}),hillshade:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_image:new M.aL(D,h.u_image),u_latrange:new M.aQ(D,h.u_latrange),u_light:new M.aQ(D,h.u_light),u_shadow:new M.aR(D,h.u_shadow),u_highlight:new M.aR(D,h.u_highlight),u_accent:new M.aR(D,h.u_accent)}),hillshadePrepare:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_image:new M.aL(D,h.u_image),u_dimension:new M.aQ(D,h.u_dimension),u_zoom:new M.aM(D,h.u_zoom),u_unpack:new M.aO(D,h.u_unpack)}),line:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_ratio:new M.aM(D,h.u_ratio),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_units_to_pixels:new M.aQ(D,h.u_units_to_pixels)}),lineGradient:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_ratio:new M.aM(D,h.u_ratio),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_units_to_pixels:new M.aQ(D,h.u_units_to_pixels),u_image:new M.aL(D,h.u_image),u_image_height:new M.aM(D,h.u_image_height)}),linePattern:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_texsize:new M.aQ(D,h.u_texsize),u_ratio:new M.aM(D,h.u_ratio),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_image:new M.aL(D,h.u_image),u_units_to_pixels:new M.aQ(D,h.u_units_to_pixels),u_scale:new M.aP(D,h.u_scale),u_fade:new M.aM(D,h.u_fade)}),lineSDF:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_ratio:new M.aM(D,h.u_ratio),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_units_to_pixels:new M.aQ(D,h.u_units_to_pixels),u_patternscale_a:new M.aQ(D,h.u_patternscale_a),u_patternscale_b:new M.aQ(D,h.u_patternscale_b),u_sdfgamma:new M.aM(D,h.u_sdfgamma),u_image:new M.aL(D,h.u_image),u_tex_y_a:new M.aM(D,h.u_tex_y_a),u_tex_y_b:new M.aM(D,h.u_tex_y_b),u_mix:new M.aM(D,h.u_mix)}),raster:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_tl_parent:new M.aQ(D,h.u_tl_parent),u_scale_parent:new M.aM(D,h.u_scale_parent),u_buffer_scale:new M.aM(D,h.u_buffer_scale),u_fade_t:new M.aM(D,h.u_fade_t),u_opacity:new M.aM(D,h.u_opacity),u_image0:new M.aL(D,h.u_image0),u_image1:new M.aL(D,h.u_image1),u_brightness_low:new M.aM(D,h.u_brightness_low),u_brightness_high:new M.aM(D,h.u_brightness_high),u_saturation_factor:new M.aM(D,h.u_saturation_factor),u_contrast_factor:new M.aM(D,h.u_contrast_factor),u_spin_weights:new M.aP(D,h.u_spin_weights)}),symbolIcon:(D,h)=>({u_is_size_zoom_constant:new M.aL(D,h.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aL(D,h.u_is_size_feature_constant),u_size_t:new M.aM(D,h.u_size_t),u_size:new M.aM(D,h.u_size),u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_pitch:new M.aM(D,h.u_pitch),u_rotate_symbol:new M.aL(D,h.u_rotate_symbol),u_aspect_ratio:new M.aM(D,h.u_aspect_ratio),u_fade_change:new M.aM(D,h.u_fade_change),u_matrix:new M.aN(D,h.u_matrix),u_label_plane_matrix:new M.aN(D,h.u_label_plane_matrix),u_coord_matrix:new M.aN(D,h.u_coord_matrix),u_is_text:new M.aL(D,h.u_is_text),u_pitch_with_map:new M.aL(D,h.u_pitch_with_map),u_texsize:new M.aQ(D,h.u_texsize),u_texture:new M.aL(D,h.u_texture)}),symbolSDF:(D,h)=>({u_is_size_zoom_constant:new M.aL(D,h.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aL(D,h.u_is_size_feature_constant),u_size_t:new M.aM(D,h.u_size_t),u_size:new M.aM(D,h.u_size),u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_pitch:new M.aM(D,h.u_pitch),u_rotate_symbol:new M.aL(D,h.u_rotate_symbol),u_aspect_ratio:new M.aM(D,h.u_aspect_ratio),u_fade_change:new M.aM(D,h.u_fade_change),u_matrix:new M.aN(D,h.u_matrix),u_label_plane_matrix:new M.aN(D,h.u_label_plane_matrix),u_coord_matrix:new M.aN(D,h.u_coord_matrix),u_is_text:new M.aL(D,h.u_is_text),u_pitch_with_map:new M.aL(D,h.u_pitch_with_map),u_texsize:new M.aQ(D,h.u_texsize),u_texture:new M.aL(D,h.u_texture),u_gamma_scale:new M.aM(D,h.u_gamma_scale),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_is_halo:new M.aL(D,h.u_is_halo)}),symbolTextAndIcon:(D,h)=>({u_is_size_zoom_constant:new M.aL(D,h.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aL(D,h.u_is_size_feature_constant),u_size_t:new M.aM(D,h.u_size_t),u_size:new M.aM(D,h.u_size),u_camera_to_center_distance:new M.aM(D,h.u_camera_to_center_distance),u_pitch:new M.aM(D,h.u_pitch),u_rotate_symbol:new M.aL(D,h.u_rotate_symbol),u_aspect_ratio:new M.aM(D,h.u_aspect_ratio),u_fade_change:new M.aM(D,h.u_fade_change),u_matrix:new M.aN(D,h.u_matrix),u_label_plane_matrix:new M.aN(D,h.u_label_plane_matrix),u_coord_matrix:new M.aN(D,h.u_coord_matrix),u_is_text:new M.aL(D,h.u_is_text),u_pitch_with_map:new M.aL(D,h.u_pitch_with_map),u_texsize:new M.aQ(D,h.u_texsize),u_texsize_icon:new M.aQ(D,h.u_texsize_icon),u_texture:new M.aL(D,h.u_texture),u_texture_icon:new M.aL(D,h.u_texture_icon),u_gamma_scale:new M.aM(D,h.u_gamma_scale),u_device_pixel_ratio:new M.aM(D,h.u_device_pixel_ratio),u_is_halo:new M.aL(D,h.u_is_halo)}),background:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_opacity:new M.aM(D,h.u_opacity),u_color:new M.aR(D,h.u_color)}),backgroundPattern:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_opacity:new M.aM(D,h.u_opacity),u_image:new M.aL(D,h.u_image),u_pattern_tl_a:new M.aQ(D,h.u_pattern_tl_a),u_pattern_br_a:new M.aQ(D,h.u_pattern_br_a),u_pattern_tl_b:new M.aQ(D,h.u_pattern_tl_b),u_pattern_br_b:new M.aQ(D,h.u_pattern_br_b),u_texsize:new M.aQ(D,h.u_texsize),u_mix:new M.aM(D,h.u_mix),u_pattern_size_a:new M.aQ(D,h.u_pattern_size_a),u_pattern_size_b:new M.aQ(D,h.u_pattern_size_b),u_scale_a:new M.aM(D,h.u_scale_a),u_scale_b:new M.aM(D,h.u_scale_b),u_pixel_coord_upper:new M.aQ(D,h.u_pixel_coord_upper),u_pixel_coord_lower:new M.aQ(D,h.u_pixel_coord_lower),u_tile_units_to_pixels:new M.aM(D,h.u_tile_units_to_pixels)}),terrain:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_texture:new M.aL(D,h.u_texture),u_ele_delta:new M.aM(D,h.u_ele_delta)}),terrainDepth:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_ele_delta:new M.aM(D,h.u_ele_delta)}),terrainCoords:(D,h)=>({u_matrix:new M.aN(D,h.u_matrix),u_texture:new M.aL(D,h.u_texture),u_terrain_coords_id:new M.aM(D,h.u_terrain_coords_id),u_ele_delta:new M.aM(D,h.u_ele_delta)})};class Su{constructor(h,x,O){this.context=h;const Z=h.gl;this.buffer=Z.createBuffer(),this.dynamicDraw=!!O,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),Z.bufferData(Z.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?Z.DYNAMIC_DRAW:Z.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){const x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mo{constructor(h,x,O,Z){this.length=x.length,this.attributes=O,this.itemSize=x.bytesPerElement,this.dynamicDraw=Z,this.context=h;const H=h.gl;this.buffer=H.createBuffer(),h.bindVertexBuffer.set(this.buffer),H.bufferData(H.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?H.DYNAMIC_DRAW:H.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){if(h.length!==this.length)throw new Error(`Length of new data is ${h.length}, which doesn't match current length of ${this.length}`);const x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,x){for(let O=0;O<this.attributes.length;O++){const Z=x.attributes[this.attributes[O].name];Z!==void 0&&h.enableVertexAttribArray(Z)}}setVertexAttribPointers(h,x,O){for(let Z=0;Z<this.attributes.length;Z++){const H=this.attributes[Z],ae=x.attributes[H.name];ae!==void 0&&h.vertexAttribPointer(ae,H.components,h[Eh[H.type]],!1,this.itemSize,H.offset+this.itemSize*(O||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cc=new WeakMap;function uu(D){var h;if(cc.has(D))return cc.get(D);{const x=(h=D.getParameter(D.VERSION))===null||h===void 0?void 0:h.startsWith("WebGL 2.0");return cc.set(D,x),x}}class Ja{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class rf extends Ja{getDefault(){return M.aT.transparent}set(h){const x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class Yu extends Ja{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class Vs extends Ja{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class yh extends Ja{getDefault(){return[!0,!0,!0,!0]}set(h){const x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class tl extends Ja{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class vu extends Ja{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class Ch extends Ja{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){const x=this.current;(h.func!==x.func||h.ref!==x.ref||h.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class Hf extends Ja{getDefault(){const h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){const x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class Vn extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;h?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=h,this.dirty=!1}}class gi extends Ja{getDefault(){return[0,1]}set(h){const x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class Hp extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;h?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=h,this.dirty=!1}}class nf extends Ja{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class Gc extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;h?x.enable(x.BLEND):x.disable(x.BLEND),this.current=h,this.dirty=!1}}class sd extends Ja{getDefault(){const h=this.gl;return[h.ONE,h.ZERO]}set(h){const x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)}}class Bu extends Ja{getDefault(){return M.aT.transparent}set(h){const x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class $d extends Ja{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)}}class rh extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;h?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=h,this.dirty=!1}}class Ah extends Ja{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class lp extends Ja{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}class hl extends Ja{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}}class $f extends Ja{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class Th extends Ja{getDefault(){const h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){const x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class _h extends Ja{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class nh extends Ja{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class $p extends Ja{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.bindTexture(x.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class cp extends Ja{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Mu extends Ja{getDefault(){return null}set(h){const x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class af extends Ja{getDefault(){return null}set(h){var x;if(h===this.current&&!this.dirty)return;const O=this.gl;uu(O)?O.bindVertexArray(h):(x=O.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(h),this.current=h,this.dirty=!1}}class hp extends Ja{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class ih extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class fp extends Ja{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class Vh extends Ja{constructor(h,x){super(h),this.context=h,this.parent=x}getDefault(){return null}}class Nu extends Vh{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class Wf extends Vh{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class Sf extends Vh{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class ko{constructor(h,x,O,Z,H){this.context=h,this.width=x,this.height=O;const ae=h.gl,ue=this.framebuffer=ae.createFramebuffer();if(this.colorAttachment=new Nu(h,ue),Z)this.depthAttachment=H?new Sf(h,ue):new Wf(h,ue);else if(H)throw new Error("Stencil cannot be setted without depth");if(ae.checkFramebufferStatus(ae.FRAMEBUFFER)!==ae.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const h=this.context.gl,x=this.colorAttachment.get();if(x&&h.deleteTexture(x),this.depthAttachment){const O=this.depthAttachment.get();O&&h.deleteRenderbuffer(O)}h.deleteFramebuffer(this.framebuffer)}}class rl{constructor(h,x,O){this.blendFunction=h,this.blendColor=x,this.mask=O}}rl.Replace=[1,0],rl.disabled=new rl(rl.Replace,M.aT.transparent,[!1,!1,!1,!1]),rl.unblended=new rl(rl.Replace,M.aT.transparent,[!0,!0,!0,!0]),rl.alphaBlended=new rl([1,771],M.aT.transparent,[!0,!0,!0,!0]);class pp{constructor(h){var x,O;if(this.gl=h,this.clearColor=new rf(this),this.clearDepth=new Yu(this),this.clearStencil=new Vs(this),this.colorMask=new yh(this),this.depthMask=new tl(this),this.stencilMask=new vu(this),this.stencilFunc=new Ch(this),this.stencilOp=new Hf(this),this.stencilTest=new Vn(this),this.depthRange=new gi(this),this.depthTest=new Hp(this),this.depthFunc=new nf(this),this.blend=new Gc(this),this.blendFunc=new sd(this),this.blendColor=new Bu(this),this.blendEquation=new $d(this),this.cullFace=new rh(this),this.cullFaceSide=new Ah(this),this.frontFace=new lp(this),this.program=new hl(this),this.activeTexture=new $f(this),this.viewport=new Th(this),this.bindFramebuffer=new _h(this),this.bindRenderbuffer=new nh(this),this.bindTexture=new $p(this),this.bindVertexBuffer=new cp(this),this.bindElementBuffer=new Mu(this),this.bindVertexArray=new af(this),this.pixelStoreUnpack=new hp(this),this.pixelStoreUnpackPremultiplyAlpha=new ih(this),this.pixelStoreUnpackFlipY=new fp(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),uu(h)){this.HALF_FLOAT=h.HALF_FLOAT;const Z=h.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=h.RGBA16F)!==null&&x!==void 0?x:Z==null?void 0:Z.RGBA16F_EXT,this.RGB16F=(O=h.RGB16F)!==null&&O!==void 0?O:Z==null?void 0:Z.RGB16F_EXT,h.getExtension("EXT_color_buffer_float")}else{h.getExtension("EXT_color_buffer_half_float"),h.getExtension("OES_texture_half_float_linear");const Z=h.getExtension("OES_texture_half_float");this.HALF_FLOAT=Z==null?void 0:Z.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,x){return new Su(this,h,x)}createVertexBuffer(h,x,O){return new Mo(this,h,x,O)}createRenderbuffer(h,x,O){const Z=this.gl,H=Z.createRenderbuffer();return this.bindRenderbuffer.set(H),Z.renderbufferStorage(Z.RENDERBUFFER,h,x,O),this.bindRenderbuffer.set(null),H}createFramebuffer(h,x,O,Z){return new ko(this,h,x,O,Z)}clear({color:h,depth:x,stencil:O}){const Z=this.gl;let H=0;h&&(H|=Z.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(H|=Z.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),O!==void 0&&(H|=Z.STENCIL_BUFFER_BIT,this.clearStencil.set(O),this.stencilMask.set(255)),Z.clear(H)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){M.aG(h.blendFunction,rl.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)}createVertexArray(){var h;return uu(this.gl)?this.gl.createVertexArray():(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.createVertexArrayOES()}deleteVertexArray(h){var x;return uu(this.gl)?this.gl.deleteVertexArray(h):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(h)}unbindVAO(){this.bindVertexArray.set(null)}}class jo{constructor(h,x,O){this.func=h,this.mask=x,this.range=O}}jo.ReadOnly=!1,jo.ReadWrite=!0,jo.disabled=new jo(519,jo.ReadOnly,[0,1]);const hc=7680;class _u{constructor(h,x,O,Z,H,ae){this.test=h,this.ref=x,this.mask=O,this.fail=Z,this.depthFail=H,this.pass=ae}}_u.disabled=new _u({func:519,mask:0},0,0,hc,hc,hc);class mu{constructor(h,x,O){this.enable=h,this.mode=x,this.frontFace=O}}let Mh;function ud(D,h,x,O,Z,H,ae){const ue=D.context,ge=ue.gl,Le=D.useProgram("collisionBox"),m=[];let w=0,_=0;for(let ye=0;ye<O.length;ye++){const De=O[ye],He=h.getTile(De),$e=He.getBucket(x);if(!$e)continue;let ft=De.posMatrix;Z[0]===0&&Z[1]===0||(ft=D.translatePosMatrix(De.posMatrix,He,Z,H));const pt=ae?$e.textCollisionBox:$e.iconCollisionBox,wt=$e.collisionCircleArray;if(wt.length>0){const dt=M.Z(),Ft=ft;M.aU(dt,$e.placementInvProjMatrix,D.transform.glCoordMatrix),M.aU(dt,dt,$e.placementViewportMatrix),m.push({circleArray:wt,circleOffset:_,transform:Ft,invTransform:dt,coord:De}),w+=wt.length/4,_=w}pt&&Le.draw(ue,ge.LINES,jo.disabled,_u.disabled,D.colorModeForRenderPass(),mu.disabled,cl(ft,D.transform,He),D.style.map.terrain&&D.style.map.terrain.getTerrainData(De),x.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,D.transform.zoom,null,null,pt.collisionVertexBuffer)}if(!ae||!m.length)return;const T=D.useProgram("collisionCircle"),N=new M.aV;N.resize(4*w),N._trim();let $=0;for(const ye of m)for(let De=0;De<ye.circleArray.length/4;De++){const He=4*De,$e=ye.circleArray[He+0],ft=ye.circleArray[He+1],pt=ye.circleArray[He+2],wt=ye.circleArray[He+3];N.emplace($++,$e,ft,pt,wt,0),N.emplace($++,$e,ft,pt,wt,1),N.emplace($++,$e,ft,pt,wt,2),N.emplace($++,$e,ft,pt,wt,3)}(!Mh||Mh.length<2*w)&&(Mh=function(ye){const De=2*ye,He=new M.aX;He.resize(De),He._trim();for(let $e=0;$e<De;$e++){const ft=6*$e;He.uint16[ft+0]=4*$e+0,He.uint16[ft+1]=4*$e+1,He.uint16[ft+2]=4*$e+2,He.uint16[ft+3]=4*$e+2,He.uint16[ft+4]=4*$e+3,He.uint16[ft+5]=4*$e+0}return He}(w));const X=ue.createIndexBuffer(Mh,!0),oe=ue.createVertexBuffer(N,M.aW.members,!0);for(const ye of m){const De={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(xe=D.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};T.draw(ue,ge.TRIANGLES,jo.disabled,_u.disabled,D.colorModeForRenderPass(),mu.disabled,De,D.style.map.terrain&&D.style.map.terrain.getTerrainData(ye.coord),x.id,oe,X,M.S.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,D.transform.zoom,null,null,null)}var xe;oe.destroy(),X.destroy()}mu.disabled=new mu(!1,1029,2305),mu.backCCW=new mu(!0,1029,2305);const of=M.ao(new Float32Array(16));function Eu(D,h,x,O,Z,H){const{horizontalAlign:ae,verticalAlign:ue}=M.au(D);return new M.P((-(ae-.5)*h/Z+O[0])*H,(-(ue-.5)*x/Z+O[1])*H)}function dp(D,h,x,O,Z,H,ae,ue,ge,Le,m){const w=D.text.placedSymbolArray,_=D.text.dynamicLayoutVertexArray,T=D.icon.dynamicLayoutVertexArray,N={};_.clear();for(let $=0;$<w.length;$++){const X=w.get($),oe=X.hidden||!X.crossTileID||D.allowVerticalPlacement&&!X.placedOrientation?null:O[X.crossTileID];if(oe){const xe=new M.P(X.anchorX,X.anchorY),ye=ti(xe,x?ae:H,m),De=Yi(Z.cameraToCenterDistance,ye.signedDistanceFromCamera);let He=M.aj(D.textSizeData,ge,X)*De/M.ap;x&&(He*=D.tilePixelRatio/ue);const{width:$e,height:ft,anchor:pt,textOffset:wt,textBoxScale:dt}=oe,Ft=Eu(pt,$e,ft,wt,dt,He),ar=x?ti(xe.add(Ft),H,m).point:ye.point.add(h?Ft.rotate(-Z.angle):Ft),nr=D.allowVerticalPlacement&&X.placedOrientation===M.ai.vertical?Math.PI/2:0;for(let Ir=0;Ir<X.numGlyphs;Ir++)M.ak(_,ar,nr);Le&&X.associatedIconIndex>=0&&(N[X.associatedIconIndex]={shiftedAnchor:ar,angle:nr})}else ve(X.numGlyphs,_)}if(Le){T.clear();const $=D.icon.placedSymbolArray;for(let X=0;X<$.length;X++){const oe=$.get(X);if(oe.hidden)ve(oe.numGlyphs,T);else{const xe=N[X];if(xe)for(let ye=0;ye<oe.numGlyphs;ye++)M.ak(T,xe.shiftedAnchor,xe.angle);else ve(oe.numGlyphs,T)}}D.icon.dynamicLayoutVertexBuffer.updateData(T)}D.text.dynamicLayoutVertexBuffer.updateData(_)}function Wp(D,h,x){return x.iconsInText&&h?"symbolTextAndIcon":D?"symbolSDF":"symbolIcon"}function Ph(D,h,x,O,Z,H,ae,ue,ge,Le,m,w){const _=D.context,T=_.gl,N=D.transform,$=ue==="map",X=ge==="map",oe=ue!=="viewport"&&x.layout.get("symbol-placement")!=="point",xe=$&&!X&&!oe,ye=!x.layout.get("symbol-sort-key").isConstant();let De=!1;const He=D.depthModeForSublayer(0,jo.ReadOnly),$e=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(const pt of O){const wt=h.getTile(pt),dt=wt.getBucket(x);if(!dt)continue;const Ft=Z?dt.text:dt.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const ar=Ft.programConfigurations.get(x.id),nr=Z||dt.sdfIcons,Ir=Z?dt.textSizeData:dt.iconSizeData,_r=X||N.pitch!==0,Qr=D.useProgram(Wp(nr,Z,dt),ar),nn=M.ah(Ir,N.zoom),Ln=D.style.map.terrain&&D.style.map.terrain.getTerrainData(pt);let Mn,yi,Ri,Qi,Vi=[0,0],ao=null;if(Z)yi=wt.glyphAtlasTexture,Ri=T.LINEAR,Mn=wt.glyphAtlasTexture.size,dt.iconsInText&&(Vi=wt.imageAtlasTexture.size,ao=wt.imageAtlasTexture,Qi=_r||D.options.rotating||D.options.zooming||Ir.kind==="composite"||Ir.kind==="camera"?T.LINEAR:T.NEAREST);else{const Ps=x.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;yi=wt.imageAtlasTexture,Ri=nr||D.options.rotating||D.options.zooming||Ps||_r?T.LINEAR:T.NEAREST,Mn=wt.imageAtlasTexture.size}const Bi=Qe(wt,1,D.transform.zoom),oa=dr(pt.posMatrix,X,$,D.transform,Bi),Ha=Un(pt.posMatrix,X,$,D.transform,Bi),ja=$e&&dt.hasTextData(),Sa=x.layout.get("icon-text-fit")!=="none"&&ja&&dt.hasIconData();if(oe){const Ps=D.style.map.terrain?(Zs,Hs)=>D.style.map.terrain.getElevation(pt,Zs,Hs):null,Qo=x.layout.get("text-rotation-alignment")==="map";on(dt,pt.posMatrix,D,Z,oa,Ha,X,Le,Qo,Ps)}const Qa=D.translatePosMatrix(pt.posMatrix,wt,H,ae),eo=oe||Z&&$e||Sa?of:oa,va=D.translatePosMatrix(Ha,wt,H,ae,!0),tu=nr&&x.paint.get(Z?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gs;Gs=nr?dt.iconsInText?th(Ir.kind,nn,xe,X,D,Qa,eo,va,Mn,Vi):Mp(Ir.kind,nn,xe,X,D,Qa,eo,va,Z,Mn,!0):Ra(Ir.kind,nn,xe,X,D,Qa,eo,va,Z,Mn);const Tl={program:Qr,buffers:Ft,uniformValues:Gs,atlasTexture:yi,atlasTextureIcon:ao,atlasInterpolation:Ri,atlasInterpolationIcon:Qi,isSDF:nr,hasHalo:tu};if(ye&&dt.canOverlap){De=!0;const Ps=Ft.segments.get();for(const Qo of Ps)ft.push({segments:new M.S([Qo]),sortKey:Qo.sortKey,state:Tl,terrainData:Ln})}else ft.push({segments:Ft.segments,sortKey:0,state:Tl,terrainData:Ln})}De&&ft.sort((pt,wt)=>pt.sortKey-wt.sortKey);for(const pt of ft){const wt=pt.state;if(_.activeTexture.set(T.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,T.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(_.activeTexture.set(T.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,T.CLAMP_TO_EDGE)),wt.isSDF){const dt=wt.uniformValues;wt.hasHalo&&(dt.u_is_halo=1,wd(wt.buffers,pt.segments,x,D,wt.program,He,m,w,dt,pt.terrainData)),dt.u_is_halo=0}wd(wt.buffers,pt.segments,x,D,wt.program,He,m,w,wt.uniformValues,pt.terrainData)}}function wd(D,h,x,O,Z,H,ae,ue,ge,Le){const m=O.context;Z.draw(m,m.gl.TRIANGLES,H,ae,ue,mu.disabled,ge,Le,x.id,D.layoutVertexBuffer,D.indexBuffer,h,x.paint,O.transform.zoom,D.programConfigurations.get(x.id),D.dynamicLayoutVertexBuffer,D.opacityVertexBuffer)}function Xp(D,h,x,O,Z){if(!x||!O||!O.imageAtlas)return;const H=O.imageAtlas.patternPositions;let ae=H[x.to.toString()],ue=H[x.from.toString()];if(!ae||!ue){const ge=Z.getPaintProperty(h);ae=H[ge],ue=H[ge]}ae&&ue&&D.setConstantPatternPositions(ae,ue)}function vp(D,h,x,O,Z,H,ae){const ue=D.context.gl,ge="fill-pattern",Le=x.paint.get(ge),m=Le&&Le.constantOr(1),w=x.getCrossfadeParameters();let _,T,N,$,X;ae?(T=m&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_=ue.LINES):(T=m?"fillPattern":"fill",_=ue.TRIANGLES);const oe=Le.constantOr(null);for(const xe of O){const ye=h.getTile(xe);if(m&&!ye.patternsLoaded())continue;const De=ye.getBucket(x);if(!De)continue;const He=De.programConfigurations.get(x.id),$e=D.useProgram(T,He),ft=D.style.map.terrain&&D.style.map.terrain.getTerrainData(xe);m&&(D.context.activeTexture.set(ue.TEXTURE0),ye.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),He.updatePaintBuffers(w)),Xp(He,ge,oe,ye,x);const pt=ft?xe:null,wt=D.translatePosMatrix(pt?pt.posMatrix:xe.posMatrix,ye,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if(ae){$=De.indexBuffer2,X=De.segments2;const dt=[ue.drawingBufferWidth,ue.drawingBufferHeight];N=T==="fillOutlinePattern"&&m?_c(wt,D,w,ye,dt):ll(wt,dt)}else $=De.indexBuffer,X=De.segments,N=m?ul(wt,D,w,ye):sl(wt);$e.draw(D.context,_,Z,D.stencilModeForClipping(xe),H,mu.disabled,N,ft,x.id,De.layoutVertexBuffer,$,X,x.paint,D.transform.zoom,He)}}function Ga(D,h,x,O,Z,H,ae){const ue=D.context,ge=ue.gl,Le="fill-extrusion-pattern",m=x.paint.get(Le),w=m.constantOr(1),_=x.getCrossfadeParameters(),T=x.paint.get("fill-extrusion-opacity"),N=m.constantOr(null);for(const $ of O){const X=h.getTile($),oe=X.getBucket(x);if(!oe)continue;const xe=D.style.map.terrain&&D.style.map.terrain.getTerrainData($),ye=oe.programConfigurations.get(x.id),De=D.useProgram(w?"fillExtrusionPattern":"fillExtrusion",ye);w&&(D.context.activeTexture.set(ge.TEXTURE0),X.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),ye.updatePaintBuffers(_)),Xp(ye,Le,N,X,x);const He=D.translatePosMatrix($.posMatrix,X,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),$e=x.paint.get("fill-extrusion-vertical-gradient"),ft=w?eu(He,D,$e,T,$,_,X):Ws(He,D,$e,T);De.draw(ue,ue.gl.TRIANGLES,Z,H,ae,mu.backCCW,ft,xe,x.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,x.paint,D.transform.zoom,ye,D.style.map.terrain&&oe.centroidVertexBuffer)}}function mp(D,h,x,O,Z,H,ae){const ue=D.context,ge=ue.gl,Le=x.fbo;if(!Le)return;const m=D.useProgram("hillshade"),w=D.style.map.terrain&&D.style.map.terrain.getTerrainData(h);ue.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Le.colorAttachment.get()),m.draw(ue,ge.TRIANGLES,Z,H,ae,mu.disabled,((_,T,N,$)=>{const X=N.paint.get("hillshade-shadow-color"),oe=N.paint.get("hillshade-highlight-color"),xe=N.paint.get("hillshade-accent-color");let ye=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=_.transform.angle);const De=!_.options.moving;return{u_matrix:$?$.posMatrix:_.transform.calculatePosMatrix(T.tileID.toUnwrapped(),De),u_image:0,u_latrange:Er(0,T.tileID),u_light:[N.paint.get("hillshade-exaggeration"),ye],u_shadow:X,u_highlight:oe,u_accent:xe}})(D,x,O,w?h:null),w,O.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments)}function Hc(D,h,x,O,Z,H){const ae=D.context,ue=ae.gl,ge=h.dem;if(ge&&ge.data){const Le=ge.dim,m=ge.stride,w=ge.getPixels();if(ae.activeTexture.set(ue.TEXTURE1),ae.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||D.getTileTexture(m),h.demTexture){const T=h.demTexture;T.update(w,{premultiply:!1}),T.bind(ue.NEAREST,ue.CLAMP_TO_EDGE)}else h.demTexture=new rr(ae,w,ue.RGBA,{premultiply:!1}),h.demTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);ae.activeTexture.set(ue.TEXTURE0);let _=h.fbo;if(!_){const T=new rr(ae,{width:Le,height:Le,data:null},ue.RGBA);T.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),_=h.fbo=ae.createFramebuffer(Le,Le,!0,!1),_.colorAttachment.set(T.texture)}ae.bindFramebuffer.set(_.framebuffer),ae.viewport.set([0,0,Le,Le]),D.useProgram("hillshadePrepare").draw(ae,ue.TRIANGLES,O,Z,H,mu.disabled,((T,N)=>{const $=N.stride,X=M.Z();return M.aS(X,0,M.N,-M.N,0,0,1),M.$(X,X,[0,-M.N,0]),{u_matrix:X,u_image:1,u_dimension:[$,$],u_zoom:T.overscaledZ,u_unpack:N.getUnpackVector()}})(h.tileID,ge),null,x.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function gp(D,h,x,O,Z,H){const ae=O.paint.get("raster-fade-duration");if(!H&&ae>0){const ue=M.h.now(),ge=(ue-D.timeAdded)/ae,Le=h?(ue-h.timeAdded)/ae:-1,m=x.getSource(),w=Z.coveringZoomLevel({tileSize:m.tileSize,roundZoom:m.roundZoom}),_=!h||Math.abs(h.tileID.overscaledZ-w)>Math.abs(D.tileID.overscaledZ-w),T=_&&D.refreshedUponExpiration?1:M.ad(_?ge:1-Le,0,1);return D.refreshedUponExpiration&&ge>=1&&(D.refreshedUponExpiration=!1),h?{opacity:1,mix:1-T}:{opacity:T,mix:0}}return{opacity:1,mix:0}}const sf=new M.aT(1,0,0,1),ah=new M.aT(0,1,0,1),wo=new M.aT(0,0,1,1),fl=new M.aT(1,0,1,1),pl=new M.aT(0,1,1,1);function bh(D,h,x,O){yp(D,0,h+x/2,D.transform.width,x,O)}function Xf(D,h,x,O){yp(D,h-x/2,0,x,D.transform.height,O)}function yp(D,h,x,O,Z,H){const ae=D.context,ue=ae.gl;ue.enable(ue.SCISSOR_TEST),ue.scissor(h*D.pixelRatio,x*D.pixelRatio,O*D.pixelRatio,Z*D.pixelRatio),ae.clear({color:H}),ue.disable(ue.SCISSOR_TEST)}function Gh(D,h,x){const O=D.context,Z=O.gl,H=x.posMatrix,ae=D.useProgram("debug"),ue=jo.disabled,ge=_u.disabled,Le=D.colorModeForRenderPass(),m="$debug",w=D.style.map.terrain&&D.style.map.terrain.getTerrainData(x);O.activeTexture.set(Z.TEXTURE0);const _=h.getTileByID(x.key).latestRawTileData,T=Math.floor((_&&_.byteLength||0)/1024),N=h.getTile(x).tileSize,$=512/Math.min(N,512)*(x.overscaledZ/D.transform.zoom)*.5;let X=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(X+=` => ${x.overscaledZ}`),function(oe,xe){oe.initDebugOverlayCanvas();const ye=oe.debugOverlayCanvas,De=oe.context.gl,He=oe.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,ye.width,ye.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(xe,5,5),He.strokeText(xe,5,5),oe.debugOverlayTexture.update(ye),oe.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(D,`${X} ${T}kB`),ae.draw(O,Z.TRIANGLES,ue,ge,rl.alphaBlended,mu.disabled,iu(H,M.aT.transparent,$),null,m,D.debugBuffer,D.quadTriangleIndexBuffer,D.debugSegments),ae.draw(O,Z.LINE_STRIP,ue,ge,Le,mu.disabled,iu(H,M.aT.red),w,m,D.debugBuffer,D.tileBorderIndexBuffer,D.debugSegments)}function Vu(D,h,x){const O=D.context,Z=O.gl,H=D.colorModeForRenderPass(),ae=new jo(Z.LEQUAL,jo.ReadWrite,D.depthRangeFor3D),ue=D.useProgram("terrain"),ge=h.getTerrainMesh();O.bindFramebuffer.set(null),O.viewport.set([0,0,D.width,D.height]);for(const Le of x){const m=D.renderToTexture.getTexture(Le),w=h.getTerrainData(Le.tileID);O.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,m.texture);const _={u_matrix:D.transform.calculatePosMatrix(Le.tileID.toUnwrapped()),u_texture:0,u_ele_delta:h.getMeshFrameDelta(D.transform.zoom)};ue.draw(O,Z.TRIANGLES,ae,_u.disabled,H,mu.backCCW,_,w,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments)}}class Yf{constructor(h,x){this.context=new pp(h),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:M.Z(),renderTime:0},this.setup(),this.numSublayers=Ua.maxUnderzooming+Ua.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new To}resize(h,x,O){if(this.width=Math.floor(h*O),this.height=Math.floor(x*O),this.pixelRatio=O,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const Z of this.style._order)this.style._layers[Z].resize()}setup(){const h=this.context,x=new M.a_;x.emplaceBack(0,0),x.emplaceBack(M.N,0),x.emplaceBack(0,M.N),x.emplaceBack(M.N,M.N),this.tileExtentBuffer=h.createVertexBuffer(x,eh.members),this.tileExtentSegments=M.S.simpleSegment(0,0,4,2);const O=new M.a_;O.emplaceBack(0,0),O.emplaceBack(M.N,0),O.emplaceBack(0,M.N),O.emplaceBack(M.N,M.N),this.debugBuffer=h.createVertexBuffer(O,eh.members),this.debugSegments=M.S.simpleSegment(0,0,4,5);const Z=new M.V;Z.emplaceBack(0,0,0,0),Z.emplaceBack(M.N,0,M.N,0),Z.emplaceBack(0,M.N,0,M.N),Z.emplaceBack(M.N,M.N,M.N,M.N),this.rasterBoundsBuffer=h.createVertexBuffer(Z,na.members),this.rasterBoundsSegments=M.S.simpleSegment(0,0,4,2);const H=new M.a_;H.emplaceBack(0,0),H.emplaceBack(1,0),H.emplaceBack(0,1),H.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(H,eh.members),this.viewportSegments=M.S.simpleSegment(0,0,4,2);const ae=new M.a$;ae.emplaceBack(0),ae.emplaceBack(1),ae.emplaceBack(3),ae.emplaceBack(2),ae.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(ae);const ue=new M.b0;ue.emplaceBack(0,1,2),ue.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(ue);const ge=this.context.gl;this.stencilClearMode=new _u({func:ge.ALWAYS,mask:0},0,255,ge.ZERO,ge.ZERO,ge.ZERO)}clearStencil(){const h=this.context,x=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const O=M.Z();M.aS(O,0,this.width,this.height,0,0,1),M.a0(O,O,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,x.TRIANGLES,jo.disabled,this.stencilClearMode,rl.disabled,mu.disabled,_t(O),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(h,x){if(this.currentStencilSource===h.source||!h.isTileClipped()||!x||!x.length)return;this.currentStencilSource=h.source;const O=this.context,Z=O.gl;this.nextStencilID+x.length>256&&this.clearStencil(),O.setColorMode(rl.disabled),O.setDepthMode(jo.disabled);const H=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const ae of x){const ue=this._tileClippingMaskIDs[ae.key]=this.nextStencilID++,ge=this.style.map.terrain&&this.style.map.terrain.getTerrainData(ae);H.draw(O,Z.TRIANGLES,jo.disabled,new _u({func:Z.ALWAYS,mask:0},ue,255,Z.KEEP,Z.KEEP,Z.REPLACE),rl.disabled,mu.disabled,_t(ae.posMatrix),ge,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const h=this.nextStencilID++,x=this.context.gl;return new _u({func:x.NOTEQUAL,mask:255},h,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(h){const x=this.context.gl;return new _u({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(h){const x=this.context.gl,O=h.sort((ae,ue)=>ue.overscaledZ-ae.overscaledZ),Z=O[O.length-1].overscaledZ,H=O[0].overscaledZ-Z+1;if(H>1){this.currentStencilSource=void 0,this.nextStencilID+H>256&&this.clearStencil();const ae={};for(let ue=0;ue<H;ue++)ae[ue+Z]=new _u({func:x.GEQUAL,mask:255},ue+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=H,[ae,O]}return[{[Z]:_u.disabled},O]}colorModeForRenderPass(){const h=this.context.gl;return this._showOverdrawInspector?new rl([h.CONSTANT_COLOR,h.ONE],new M.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?rl.unblended:rl.alphaBlended}depthModeForSublayer(h,x,O){if(!this.opaquePassEnabledForLayer())return jo.disabled;const Z=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new jo(O||this.context.gl.LEQUAL,x,[Z,Z])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(h,x){this.style=h,this.options=x,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(M.h.now()),this.imageManager.beginFrame();const O=this.style._order,Z=this.style.sourceCaches,H={},ae={},ue={};for(const ge in Z){const Le=Z[ge];Le.used&&Le.prepare(this.context),H[ge]=Le.getVisibleCoordinates(),ae[ge]=H[ge].slice().reverse(),ue[ge]=Le.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ge=0;ge<O.length;ge++)if(this.style._layers[O[ge]].is3D()){this.opaquePassCutoff=ge;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const ge=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!M.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||ge.length)&&(M.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(Le,m){const w=Le.context,_=w.gl,T=rl.unblended,N=new jo(_.LEQUAL,jo.ReadWrite,[0,1]),$=m.getTerrainMesh(),X=m.sourceCache.getRenderableTiles(),oe=Le.useProgram("terrainDepth");w.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,Le.width/devicePixelRatio,Le.height/devicePixelRatio]),w.clear({color:M.aT.transparent,depth:1});for(const xe of X){const ye=m.getTerrainData(xe.tileID),De={u_matrix:Le.transform.calculatePosMatrix(xe.tileID.toUnwrapped()),u_ele_delta:m.getMeshFrameDelta(Le.transform.zoom)};oe.draw(w,_.TRIANGLES,N,_u.disabled,T,mu.backCCW,De,ye,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,Le.width,Le.height])}(this,this.style.map.terrain),function(Le,m){const w=Le.context,_=w.gl,T=rl.unblended,N=new jo(_.LEQUAL,jo.ReadWrite,[0,1]),$=m.getTerrainMesh(),X=m.getCoordsTexture(),oe=m.sourceCache.getRenderableTiles(),xe=Le.useProgram("terrainCoords");w.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,Le.width/devicePixelRatio,Le.height/devicePixelRatio]),w.clear({color:M.aT.transparent,depth:1}),m.coordsIndex=[];for(const ye of oe){const De=m.getTerrainData(ye.tileID);w.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,X.texture);const He={u_matrix:Le.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(Le.transform.zoom)};xe.draw(w,_.TRIANGLES,N,_u.disabled,T,mu.backCCW,He,De,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),m.coordsIndex.push(ye.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,Le.width,Le.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const ge of O){const Le=this.style._layers[ge];if(!Le.hasOffscreenPass()||Le.isHidden(this.transform.zoom))continue;const m=ae[Le.source];(Le.type==="custom"||m.length)&&this.renderLayer(this,Z[Le.source],Le,m)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?M.aT.black:M.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=O.length-1;this.currentLayer>=0;this.currentLayer--){const ge=this.style._layers[O[this.currentLayer]],Le=Z[ge.source],m=H[ge.source];this._renderTileClippingMasks(ge,m),this.renderLayer(this,Le,ge,m)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const ge=this.style._layers[O[this.currentLayer]],Le=Z[ge.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ge))continue;const m=(ge.type==="symbol"?ue:ae)[ge.source];this._renderTileClippingMasks(ge,H[ge.source]),this.renderLayer(this,Le,ge,m)}if(this.options.showTileBoundaries){const ge=function(Le,m){let w=null;const _=Object.values(Le._layers).flatMap(X=>X.source&&!X.isHidden(m)?[Le.sourceCaches[X.source]]:[]),T=_.filter(X=>X.getSource().type==="vector"),N=_.filter(X=>X.getSource().type!=="vector"),$=X=>{(!w||w.getSource().maxzoom<X.getSource().maxzoom)&&(w=X)};return T.forEach(X=>$(X)),w||N.forEach(X=>$(X)),w}(this.style,this.transform.zoom);ge&&function(Le,m,w){for(let _=0;_<w.length;_++)Gh(Le,m,w[_])}(this,ge,ge.getVisibleCoordinates())}this.options.showPadding&&function(ge){const Le=ge.transform.padding;bh(ge,ge.transform.height-(Le.top||0),3,sf),bh(ge,Le.bottom||0,3,ah),Xf(ge,Le.left||0,3,wo),Xf(ge,ge.transform.width-(Le.right||0),3,fl);const m=ge.transform.centerPoint;(function(w,_,T,N){yp(w,_-1,T-10,2,20,N),yp(w,_-10,T-1,20,2,N)})(ge,m.x,ge.transform.height-m.y,pl)}(this),this.context.setDefault()}renderLayer(h,x,O,Z){if(!O.isHidden(this.transform.zoom)&&(O.type==="background"||O.type==="custom"||(Z||[]).length))switch(this.id=O.id,O.type){case"symbol":(function(H,ae,ue,ge,Le){if(H.renderPass!=="translucent")return;const m=_u.disabled,w=H.colorModeForRenderPass();(ue._unevaluatedLayout.hasValue("text-variable-anchor")||ue._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(_,T,N,$,X,oe,xe){const ye=T.transform,De=X==="map",He=oe==="map";for(const $e of _){const ft=$.getTile($e),pt=ft.getBucket(N);if(!pt||!pt.text||!pt.text.segments.get().length)continue;const wt=M.ah(pt.textSizeData,ye.zoom),dt=Qe(ft,1,T.transform.zoom),Ft=dr($e.posMatrix,He,De,T.transform,dt),ar=N.layout.get("icon-text-fit")!=="none"&&pt.hasIconData();if(wt){const nr=Math.pow(2,ye.zoom-ft.tileID.overscaledZ);dp(pt,De,He,xe,ye,Ft,$e.posMatrix,nr,wt,ar,T.style.map.terrain?(Ir,_r)=>T.style.map.terrain.getElevation($e,Ir,_r):null)}}}(ge,H,ue,ae,ue.layout.get("text-rotation-alignment"),ue.layout.get("text-pitch-alignment"),Le),ue.paint.get("icon-opacity").constantOr(1)!==0&&Ph(H,ae,ue,ge,!1,ue.paint.get("icon-translate"),ue.paint.get("icon-translate-anchor"),ue.layout.get("icon-rotation-alignment"),ue.layout.get("icon-pitch-alignment"),ue.layout.get("icon-keep-upright"),m,w),ue.paint.get("text-opacity").constantOr(1)!==0&&Ph(H,ae,ue,ge,!0,ue.paint.get("text-translate"),ue.paint.get("text-translate-anchor"),ue.layout.get("text-rotation-alignment"),ue.layout.get("text-pitch-alignment"),ue.layout.get("text-keep-upright"),m,w),ae.map.showCollisionBoxes&&(ud(H,ae,ue,ge,ue.paint.get("text-translate"),ue.paint.get("text-translate-anchor"),!0),ud(H,ae,ue,ge,ue.paint.get("icon-translate"),ue.paint.get("icon-translate-anchor"),!1))})(h,x,O,Z,this.style.placement.variableOffsets);break;case"circle":(function(H,ae,ue,ge){if(H.renderPass!=="translucent")return;const Le=ue.paint.get("circle-opacity"),m=ue.paint.get("circle-stroke-width"),w=ue.paint.get("circle-stroke-opacity"),_=!ue.layout.get("circle-sort-key").isConstant();if(Le.constantOr(1)===0&&(m.constantOr(1)===0||w.constantOr(1)===0))return;const T=H.context,N=T.gl,$=H.depthModeForSublayer(0,jo.ReadOnly),X=_u.disabled,oe=H.colorModeForRenderPass(),xe=[];for(let ye=0;ye<ge.length;ye++){const De=ge[ye],He=ae.getTile(De),$e=He.getBucket(ue);if(!$e)continue;const ft=$e.programConfigurations.get(ue.id),pt=H.useProgram("circle",ft),wt=$e.layoutVertexBuffer,dt=$e.indexBuffer,Ft=H.style.map.terrain&&H.style.map.terrain.getTerrainData(De),ar={programConfiguration:ft,program:pt,layoutVertexBuffer:wt,indexBuffer:dt,uniformValues:zu(H,De,He,ue),terrainData:Ft};if(_){const nr=$e.segments.get();for(const Ir of nr)xe.push({segments:new M.S([Ir]),sortKey:Ir.sortKey,state:ar})}else xe.push({segments:$e.segments,sortKey:0,state:ar})}_&&xe.sort((ye,De)=>ye.sortKey-De.sortKey);for(const ye of xe){const{programConfiguration:De,program:He,layoutVertexBuffer:$e,indexBuffer:ft,uniformValues:pt,terrainData:wt}=ye.state;He.draw(T,N.TRIANGLES,$,X,oe,mu.disabled,pt,wt,ue.id,$e,ft,ye.segments,ue.paint,H.transform.zoom,De)}})(h,x,O,Z);break;case"heatmap":(function(H,ae,ue,ge){if(ue.paint.get("heatmap-opacity")!==0)if(H.renderPass==="offscreen"){const Le=H.context,m=Le.gl,w=_u.disabled,_=new rl([m.ONE,m.ONE],M.aT.transparent,[!0,!0,!0,!0]);(function(T,N,$){const X=T.gl;T.activeTexture.set(X.TEXTURE1),T.viewport.set([0,0,N.width/4,N.height/4]);let oe=$.heatmapFbo;if(oe)X.bindTexture(X.TEXTURE_2D,oe.colorAttachment.get()),T.bindFramebuffer.set(oe.framebuffer);else{const xe=X.createTexture();X.bindTexture(X.TEXTURE_2D,xe),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),oe=$.heatmapFbo=T.createFramebuffer(N.width/4,N.height/4,!1,!1),function(ye,De,He,$e){var ft,pt;const wt=ye.gl,dt=(ft=ye.HALF_FLOAT)!==null&&ft!==void 0?ft:wt.UNSIGNED_BYTE,Ft=(pt=ye.RGBA16F)!==null&&pt!==void 0?pt:wt.RGBA;wt.texImage2D(wt.TEXTURE_2D,0,Ft,De.width/4,De.height/4,0,wt.RGBA,dt,null),$e.colorAttachment.set(He)}(T,N,xe,oe)}})(Le,H,ue),Le.clear({color:M.aT.transparent});for(let T=0;T<ge.length;T++){const N=ge[T];if(ae.hasRenderableParent(N))continue;const $=ae.getTile(N),X=$.getBucket(ue);if(!X)continue;const oe=X.programConfigurations.get(ue.id),xe=H.useProgram("heatmap",oe),{zoom:ye}=H.transform;xe.draw(Le,m.TRIANGLES,jo.disabled,w,_,mu.disabled,Ut(N.posMatrix,$,ye,ue.paint.get("heatmap-intensity")),null,ue.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,ue.paint,H.transform.zoom,oe)}Le.viewport.set([0,0,H.width,H.height])}else H.renderPass==="translucent"&&(H.context.setColorMode(H.colorModeForRenderPass()),function(Le,m){const w=Le.context,_=w.gl,T=m.heatmapFbo;if(!T)return;w.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,T.colorAttachment.get()),w.activeTexture.set(_.TEXTURE1);let N=m.colorRampTexture;N||(N=m.colorRampTexture=new rr(w,m.colorRamp,_.RGBA)),N.bind(_.LINEAR,_.CLAMP_TO_EDGE),Le.useProgram("heatmapTexture").draw(w,_.TRIANGLES,jo.disabled,_u.disabled,Le.colorModeForRenderPass(),mu.disabled,(($,X,oe,xe)=>{const ye=M.Z();M.aS(ye,0,$.width,$.height,0,0,1);const De=$.context.gl;return{u_matrix:ye,u_world:[De.drawingBufferWidth,De.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(Le,m),null,m.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments,m.paint,Le.transform.zoom)}(H,ue))})(h,x,O,Z);break;case"line":(function(H,ae,ue,ge){if(H.renderPass!=="translucent")return;const Le=ue.paint.get("line-opacity"),m=ue.paint.get("line-width");if(Le.constantOr(1)===0||m.constantOr(1)===0)return;const w=H.depthModeForSublayer(0,jo.ReadOnly),_=H.colorModeForRenderPass(),T=ue.paint.get("line-dasharray"),N=ue.paint.get("line-pattern"),$=N.constantOr(1),X=ue.paint.get("line-gradient"),oe=ue.getCrossfadeParameters(),xe=$?"linePattern":T?"lineSDF":X?"lineGradient":"line",ye=H.context,De=ye.gl;let He=!0;for(const $e of ge){const ft=ae.getTile($e);if($&&!ft.patternsLoaded())continue;const pt=ft.getBucket(ue);if(!pt)continue;const wt=pt.programConfigurations.get(ue.id),dt=H.context.program.get(),Ft=H.useProgram(xe,wt),ar=He||Ft.program!==dt,nr=H.style.map.terrain&&H.style.map.terrain.getTerrainData($e),Ir=N.constantOr(null);if(Ir&&ft.imageAtlas){const nn=ft.imageAtlas,Ln=nn.patternPositions[Ir.to.toString()],Mn=nn.patternPositions[Ir.from.toString()];Ln&&Mn&&wt.setConstantPatternPositions(Ln,Mn)}const _r=nr?$e:null,Qr=$?wa(H,ft,ue,oe,_r):T?Xa(H,ft,ue,T,oe,_r):X?kr(H,ft,ue,pt.lineClipsArray.length,_r):Sn(H,ft,ue,_r);if($)ye.activeTexture.set(De.TEXTURE0),ft.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),wt.updatePaintBuffers(oe);else if(T&&(ar||H.lineAtlas.dirty))ye.activeTexture.set(De.TEXTURE0),H.lineAtlas.bind(ye);else if(X){const nn=pt.gradients[ue.id];let Ln=nn.texture;if(ue.gradientVersion!==nn.version){let Mn=256;if(ue.stepInterpolant){const yi=ae.getSource().maxzoom,Ri=$e.canonical.z===yi?Math.ceil(1<<H.transform.maxZoom-$e.canonical.z):1;Mn=M.ad(M.aY(pt.maxLineLength/M.N*1024*Ri),256,ye.maxTextureSize)}nn.gradient=M.aZ({expression:ue.gradientExpression(),evaluationKey:"lineProgress",resolution:Mn,image:nn.gradient||void 0,clips:pt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new rr(ye,nn.gradient,De.RGBA),nn.version=ue.gradientVersion,Ln=nn.texture}ye.activeTexture.set(De.TEXTURE0),Ln.bind(ue.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}Ft.draw(ye,De.TRIANGLES,w,H.stencilModeForClipping($e),_,mu.disabled,Qr,nr,ue.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,ue.paint,H.transform.zoom,wt,pt.layoutVertexBuffer2),He=!1}})(h,x,O,Z);break;case"fill":(function(H,ae,ue,ge){const Le=ue.paint.get("fill-color"),m=ue.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const w=H.colorModeForRenderPass(),_=ue.paint.get("fill-pattern"),T=H.opaquePassEnabledForLayer()&&!_.constantOr(1)&&Le.constantOr(M.aT.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";if(H.renderPass===T){const N=H.depthModeForSublayer(1,H.renderPass==="opaque"?jo.ReadWrite:jo.ReadOnly);vp(H,ae,ue,ge,N,w,!1)}if(H.renderPass==="translucent"&&ue.paint.get("fill-antialias")){const N=H.depthModeForSublayer(ue.getPaintProperty("fill-outline-color")?2:0,jo.ReadOnly);vp(H,ae,ue,ge,N,w,!0)}})(h,x,O,Z);break;case"fill-extrusion":(function(H,ae,ue,ge){const Le=ue.paint.get("fill-extrusion-opacity");if(Le!==0&&H.renderPass==="translucent"){const m=new jo(H.context.gl.LEQUAL,jo.ReadWrite,H.depthRangeFor3D);if(Le!==1||ue.paint.get("fill-extrusion-pattern").constantOr(1))Ga(H,ae,ue,ge,m,_u.disabled,rl.disabled),Ga(H,ae,ue,ge,m,H.stencilModeFor3D(),H.colorModeForRenderPass());else{const w=H.colorModeForRenderPass();Ga(H,ae,ue,ge,m,_u.disabled,w)}}})(h,x,O,Z);break;case"hillshade":(function(H,ae,ue,ge){if(H.renderPass!=="offscreen"&&H.renderPass!=="translucent")return;const Le=H.context,m=H.depthModeForSublayer(0,jo.ReadOnly),w=H.colorModeForRenderPass(),[_,T]=H.renderPass==="translucent"?H.stencilConfigForOverlap(ge):[{},ge];for(const N of T){const $=ae.getTile(N);$.needsHillshadePrepare!==void 0&&$.needsHillshadePrepare&&H.renderPass==="offscreen"?Hc(H,$,ue,m,_u.disabled,w):H.renderPass==="translucent"&&mp(H,N,$,ue,m,_[N.overscaledZ],w)}Le.viewport.set([0,0,H.width,H.height])})(h,x,O,Z);break;case"raster":(function(H,ae,ue,ge){if(H.renderPass!=="translucent"||ue.paint.get("raster-opacity")===0||!ge.length)return;const Le=H.context,m=Le.gl,w=ae.getSource(),_=H.useProgram("raster"),T=H.colorModeForRenderPass(),[N,$]=w instanceof ca?[{},ge]:H.stencilConfigForOverlap(ge),X=$[$.length-1].overscaledZ,oe=!H.options.moving;for(const xe of $){const ye=H.depthModeForSublayer(xe.overscaledZ-X,ue.paint.get("raster-opacity")===1?jo.ReadWrite:jo.ReadOnly,m.LESS),De=ae.getTile(xe);De.registerFadeDuration(ue.paint.get("raster-fade-duration"));const He=ae.findLoadedParent(xe,0),$e=gp(De,He,ae,ue,H.transform,H.style.map.terrain);let ft,pt;const wt=ue.paint.get("raster-resampling")==="nearest"?m.NEAREST:m.LINEAR;Le.activeTexture.set(m.TEXTURE0),De.texture.bind(wt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),Le.activeTexture.set(m.TEXTURE1),He?(He.texture.bind(wt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,He.tileID.overscaledZ-De.tileID.overscaledZ),pt=[De.tileID.canonical.x*ft%1,De.tileID.canonical.y*ft%1]):De.texture.bind(wt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST);const dt=H.style.map.terrain&&H.style.map.terrain.getTerrainData(xe),Ft=dt?xe:null,ar=Ft?Ft.posMatrix:H.transform.calculatePosMatrix(xe.toUnwrapped(),oe),nr=au(ar,pt||[0,0],ft||1,$e,ue);w instanceof ca?_.draw(Le,m.TRIANGLES,ye,_u.disabled,T,mu.disabled,nr,dt,ue.id,w.boundsBuffer,H.quadTriangleIndexBuffer,w.boundsSegments):_.draw(Le,m.TRIANGLES,ye,N[xe.overscaledZ],T,mu.disabled,nr,dt,ue.id,H.rasterBoundsBuffer,H.quadTriangleIndexBuffer,H.rasterBoundsSegments)}})(h,x,O,Z);break;case"background":(function(H,ae,ue,ge){const Le=ue.paint.get("background-color"),m=ue.paint.get("background-opacity");if(m===0)return;const w=H.context,_=w.gl,T=H.transform,N=T.tileSize,$=ue.paint.get("background-pattern");if(H.isPatternMissing($))return;const X=!$&&Le.a===1&&m===1&&H.opaquePassEnabledForLayer()?"opaque":"translucent";if(H.renderPass!==X)return;const oe=_u.disabled,xe=H.depthModeForSublayer(0,X==="opaque"?jo.ReadWrite:jo.ReadOnly),ye=H.colorModeForRenderPass(),De=H.useProgram($?"backgroundPattern":"background"),He=ge||T.coveringTiles({tileSize:N,terrain:H.style.map.terrain});$&&(w.activeTexture.set(_.TEXTURE0),H.imageManager.bind(H.context));const $e=ue.getCrossfadeParameters();for(const ft of He){const pt=ge?ft.posMatrix:H.transform.calculatePosMatrix(ft.toUnwrapped()),wt=$?_a(pt,m,H,$,{tileID:ft,tileSize:N},$e):su(pt,m,Le),dt=H.style.map.terrain&&H.style.map.terrain.getTerrainData(ft);De.draw(w,_.TRIANGLES,xe,oe,ye,mu.disabled,wt,dt,ue.id,H.tileExtentBuffer,H.quadTriangleIndexBuffer,H.tileExtentSegments)}})(h,0,O,Z);break;case"custom":(function(H,ae,ue){const ge=H.context,Le=ue.implementation;if(H.renderPass==="offscreen"){const m=Le.prerender;m&&(H.setCustomLayerDefaults(),ge.setColorMode(H.colorModeForRenderPass()),m.call(Le,ge.gl,H.transform.customLayerMatrix()),ge.setDirty(),H.setBaseState())}else if(H.renderPass==="translucent"){H.setCustomLayerDefaults(),ge.setColorMode(H.colorModeForRenderPass()),ge.setStencilMode(_u.disabled);const m=Le.renderingMode==="3d"?new jo(H.context.gl.LEQUAL,jo.ReadWrite,H.depthRangeFor3D):H.depthModeForSublayer(0,jo.ReadOnly);ge.setDepthMode(m),Le.render(ge.gl,H.transform.customLayerMatrix()),ge.setDirty(),H.setBaseState(),ge.bindFramebuffer.set(null)}})(h,0,O)}}translatePosMatrix(h,x,O,Z,H){if(!O[0]&&!O[1])return h;const ae=H?Z==="map"?this.transform.angle:0:Z==="viewport"?-this.transform.angle:0;if(ae){const Le=Math.sin(ae),m=Math.cos(ae);O=[O[0]*m-O[1]*Le,O[0]*Le+O[1]*m]}const ue=[H?O[0]:Qe(x,O[0],this.transform.zoom),H?O[1]:Qe(x,O[1],this.transform.zoom),0],ge=new Float32Array(16);return M.$(ge,h,ue),ge}saveTileTexture(h){const x=this._tileTextures[h.size[0]];x?x.push(h):this._tileTextures[h.size[0]]=[h]}getTileTexture(h){const x=this._tileTextures[h];return x&&x.length>0?x.pop():null}isPatternMissing(h){if(!h)return!1;if(!h.from||!h.to)return!0;const x=this.imageManager.getPattern(h.from.toString()),O=this.imageManager.getPattern(h.to.toString());return!x||!O}useProgram(h,x){this.cache=this.cache||{};const O=h+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[O]||(this.cache[O]=new Il(this.context,Io[h],x,os[h],this._showOverdrawInspector,this.style.map.terrain)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new rr(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:h,drawingBufferHeight:x}=this.context.gl;return this.width!==h||this.height!==x}}class Ll{constructor(h,x){this.points=h,this.planes=x}static fromInvProjectionMatrix(h,x,O){const Z=Math.pow(2,O),H=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ue=>{const ge=1/(ue=M.ag([],ue,h))[3]/x*Z;return M.b3(ue,ue,[ge,ge,1/ue[3],ge])}),ae=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ue=>{const ge=function(_,T){var N=T[0],$=T[1],X=T[2],oe=N*N+$*$+X*X;return oe>0&&(oe=1/Math.sqrt(oe)),_[0]=T[0]*oe,_[1]=T[1]*oe,_[2]=T[2]*oe,_}([],function(_,T,N){var $=T[0],X=T[1],oe=T[2],xe=N[0],ye=N[1],De=N[2];return _[0]=X*De-oe*ye,_[1]=oe*xe-$*De,_[2]=$*ye-X*xe,_}([],er([],H[ue[0]],H[ue[1]]),er([],H[ue[2]],H[ue[1]]))),Le=-((m=ge)[0]*(w=H[ue[1]])[0]+m[1]*w[1]+m[2]*w[2]);var m,w;return ge.concat(Le)});return new Ll(H,ae)}}class uf{constructor(h,x){this.min=h,this.max=x,this.center=function(O,Z,H){return O[0]=.5*Z[0],O[1]=.5*Z[1],O[2]=.5*Z[2],O}([],function(O,Z,H){return O[0]=Z[0]+H[0],O[1]=Z[1]+H[1],O[2]=Z[2]+H[2],O}([],this.min,this.max))}quadrant(h){const x=[h%2==0,h<2],O=Rt(this.min),Z=Rt(this.max);for(let H=0;H<x.length;H++)O[H]=x[H]?this.min[H]:this.center[H],Z[H]=x[H]?this.center[H]:this.max[H];return Z[2]=this.max[2],new uf(O,Z)}distanceX(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]}distanceY(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]}intersects(h){const x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let O=!0;for(let Z=0;Z<h.planes.length;Z++){const H=h.planes[Z];let ae=0;for(let ue=0;ue<x.length;ue++)M.b4(H,x[ue])>=0&&ae++;if(ae===0)return 0;ae!==x.length&&(O=!1)}if(O)return 2;for(let Z=0;Z<3;Z++){let H=Number.MAX_VALUE,ae=-Number.MAX_VALUE;for(let ue=0;ue<h.points.length;ue++){const ge=h.points[ue][Z]-this.min[Z];H=Math.min(H,ge),ae=Math.max(ae,ge)}if(ae<0||H>this.max[Z]-this.min[Z])return 0}return 1}}class Pp{constructor(h=0,x=0,O=0,Z=0){if(isNaN(h)||h<0||isNaN(x)||x<0||isNaN(O)||O<0||isNaN(Z)||Z<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=x,this.left=O,this.right=Z}interpolate(h,x,O){return x.top!=null&&h.top!=null&&(this.top=M.B.number(h.top,x.top,O)),x.bottom!=null&&h.bottom!=null&&(this.bottom=M.B.number(h.bottom,x.bottom,O)),x.left!=null&&h.left!=null&&(this.left=M.B.number(h.left,x.left,O)),x.right!=null&&h.right!=null&&(this.right=M.B.number(h.right,x.right,O)),this}getCenter(h,x){const O=M.ad((this.left+h-this.right)/2,0,h),Z=M.ad((this.top+x-this.bottom)/2,0,x);return new M.P(O,Z)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new Pp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class kh{constructor(h,x,O,Z,H){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=H===void 0||!!H,this._minZoom=h||0,this._maxZoom=x||22,this._minPitch=O==null?0:O,this._maxPitch=Z==null?60:Z,this.setMaxBounds(),this.width=0,this.height=0,this._center=new M.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pp,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const h=new kh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.apply(this),h}apply(h){this.tileSize=h.tileSize,this.latRange=h.latRange,this.width=h.width,this.height=h.height,this._center=h._center,this._elevation=h._elevation,this._minEleveationForCurrentTile=h._minEleveationForCurrentTile,this.zoom=h.zoom,this.angle=h.angle,this._fov=h._fov,this._pitch=h._pitch,this._unmodified=h._unmodified,this._edgeInsets=h._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new M.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(h){const x=-M.b5(h,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=function(){var O=new M.A(4);return M.A!=Float32Array&&(O[1]=0,O[2]=0),O[0]=1,O[3]=1,O}(),function(O,Z,H){var ae=Z[0],ue=Z[1],ge=Z[2],Le=Z[3],m=Math.sin(H),w=Math.cos(H);O[0]=ae*w+ge*m,O[1]=ue*w+Le*m,O[2]=ae*-m+ge*w,O[3]=ue*-m+Le*w}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){const x=M.ad(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(h){const x=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(h){h!==this._elevation&&(this._elevation=h,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,x,O){this._unmodified=!1,this._edgeInsets.interpolate(h,x,O),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){const x=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(h){const x=[new M.b6(0,h)];if(this._renderWorldCopies){const O=this.pointCoordinate(new M.P(0,0)),Z=this.pointCoordinate(new M.P(this.width,0)),H=this.pointCoordinate(new M.P(this.width,this.height)),ae=this.pointCoordinate(new M.P(0,this.height)),ue=Math.floor(Math.min(O.x,Z.x,H.x,ae.x)),ge=Math.floor(Math.max(O.x,Z.x,H.x,ae.x)),Le=1;for(let m=ue-Le;m<=ge+Le;m++)m!==0&&x.push(new M.b6(m,h))}return x}coveringTiles(h){var x,O;let Z=this.coveringZoomLevel(h);const H=Z;if(h.minzoom!==void 0&&Z<h.minzoom)return[];h.maxzoom!==void 0&&Z>h.maxzoom&&(Z=h.maxzoom);const ae=this.pointCoordinate(this.getCameraPoint()),ue=M.U.fromLngLat(this.center),ge=Math.pow(2,Z),Le=[ge*ae.x,ge*ae.y,0],m=[ge*ue.x,ge*ue.y,0],w=Ll.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,Z);let _=h.minzoom||0;!h.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(_=Z);const T=h.terrain?2/Math.min(this.tileSize,h.tileSize)*this.tileSize:3,N=ye=>({aabb:new uf([ye*ge,0,0],[(ye+1)*ge,ge,0]),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),$=[],X=[],oe=Z,xe=h.reparseOverscaled?H:Z;if(this._renderWorldCopies)for(let ye=1;ye<=3;ye++)$.push(N(-ye)),$.push(N(ye));for($.push(N(0));$.length>0;){const ye=$.pop(),De=ye.x,He=ye.y;let $e=ye.fullyVisible;if(!$e){const Ft=ye.aabb.intersects(w);if(Ft===0)continue;$e=Ft===2}const ft=h.terrain?Le:m,pt=ye.aabb.distanceX(ft),wt=ye.aabb.distanceY(ft),dt=Math.max(Math.abs(pt),Math.abs(wt));if(ye.zoom===oe||dt>T+(1<<oe-ye.zoom)-2&&ye.zoom>=_){const Ft=oe-ye.zoom,ar=Le[0]-.5-(De<<Ft),nr=Le[1]-.5-(He<<Ft);X.push({tileID:new M.O(ye.zoom===oe?xe:ye.zoom,ye.wrap,ye.zoom,De,He),distanceSq:gn([m[0]-.5-De,m[1]-.5-He]),tileDistanceToCamera:Math.sqrt(ar*ar+nr*nr)})}else for(let Ft=0;Ft<4;Ft++){const ar=(De<<1)+Ft%2,nr=(He<<1)+(Ft>>1),Ir=ye.zoom+1;let _r=ye.aabb.quadrant(Ft);if(h.terrain){const Qr=new M.O(Ir,ye.wrap,Ir,ar,nr),nn=h.terrain.getMinMaxElevation(Qr),Ln=(x=nn.minElevation)!==null&&x!==void 0?x:this.elevation,Mn=(O=nn.maxElevation)!==null&&O!==void 0?O:this.elevation;_r=new uf([_r.min[0],_r.min[1],Ln],[_r.max[0],_r.max[1],Mn])}$.push({aabb:_r,zoom:Ir,x:ar,y:nr,wrap:ye.wrap,fullyVisible:$e})}}return X.sort((ye,De)=>ye.distanceSq-De.distanceSq).map(ye=>ye.tileID)}resize(h,x){this.width=h,this.height=x,this.pixelsToGLUnits=[2/h,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){const x=M.ad(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new M.P(M.G(h.lng)*this.worldSize,M.H(x)*this.worldSize)}unproject(h){return new M.U(h.x/this.worldSize,h.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(h){const x=this.pointLocation(this.centerPoint,h),O=h.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-O))return;const Z=this.getCameraPosition(),H=M.U.fromLngLat(Z.lngLat,Z.altitude),ae=M.U.fromLngLat(x,O),ue=H.x-ae.x,ge=H.y-ae.y,Le=H.z-ae.z,m=Math.sqrt(ue*ue+ge*ge+Le*Le),w=this.scaleZoom(this.cameraToCenterDistance/m/this.tileSize);this._elevation=O,this._center=x,this.zoom=w}setLocationAtPoint(h,x){const O=this.pointCoordinate(x),Z=this.pointCoordinate(this.centerPoint),H=this.locationCoordinate(h),ae=new M.U(H.x-(O.x-Z.x),H.y-(O.y-Z.y));this.center=this.coordinateLocation(ae),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(h,x){return x?this.coordinatePoint(this.locationCoordinate(h),x.getElevationForLngLatZoom(h,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(h))}pointLocation(h,x){return this.coordinateLocation(this.pointCoordinate(h,x))}locationCoordinate(h){return M.U.fromLngLat(h)}coordinateLocation(h){return h&&h.toLngLat()}pointCoordinate(h,x){if(x){const _=x.pointCoordinate(h);if(_!=null)return _}const O=[h.x,h.y,0,1],Z=[h.x,h.y,1,1];M.ag(O,O,this.pixelMatrixInverse),M.ag(Z,Z,this.pixelMatrixInverse);const H=O[3],ae=Z[3],ue=O[1]/H,ge=Z[1]/ae,Le=O[2]/H,m=Z[2]/ae,w=Le===m?0:(0-Le)/(m-Le);return new M.U(M.B.number(O[0]/H,Z[0]/ae,w)/this.worldSize,M.B.number(ue,ge,w)/this.worldSize)}coordinatePoint(h,x=0,O=this.pixelMatrix){const Z=[h.x*this.worldSize,h.y*this.worldSize,x,1];return M.ag(Z,Z,O),new M.P(Z[0]/Z[3],Z[1]/Z[3])}getBounds(){const h=Math.max(0,this.height/2-this.getHorizon());return new Nr().extend(this.pointLocation(new M.P(0,h))).extend(this.pointLocation(new M.P(this.width,h))).extend(this.pointLocation(new M.P(this.width,this.height))).extend(this.pointLocation(new M.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Nr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(h,x=!1){const O=h.key,Z=x?this._alignedPosMatrixCache:this._posMatrixCache;if(Z[O])return Z[O];const H=h.canonical,ae=this.worldSize/this.zoomScale(H.z),ue=H.x+Math.pow(2,H.z)*h.wrap,ge=M.ao(new Float64Array(16));return M.$(ge,ge,[ue*ae,H.y*ae,0]),M.a0(ge,ge,[ae/M.N,ae/M.N,1]),M.a1(ge,x?this.alignedProjMatrix:this.projMatrix,ge),Z[O]=new Float32Array(ge),Z[O]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let h,x,O,Z,H=-90,ae=90,ue=-180,ge=180;const Le=this.size,m=this._unmodified;if(this.latRange){const T=this.latRange;H=M.H(T[1])*this.worldSize,ae=M.H(T[0])*this.worldSize,h=ae-H<Le.y?Le.y/(ae-H):0}if(this.lngRange){const T=this.lngRange;ue=M.b5(M.G(T[0])*this.worldSize,0,this.worldSize),ge=M.b5(M.G(T[1])*this.worldSize,0,this.worldSize),ge<ue&&(ge+=this.worldSize),x=ge-ue<Le.x?Le.x/(ge-ue):0}const w=this.point,_=Math.max(x||0,h||0);if(_)return this.center=this.unproject(new M.P(x?(ge+ue)/2:w.x,h?(ae+H)/2:w.y)),this.zoom+=this.scaleZoom(_),this._unmodified=m,void(this._constraining=!1);if(this.latRange){const T=w.y,N=Le.y/2;T-N<H&&(Z=H+N),T+N>ae&&(Z=ae-N)}if(this.lngRange){const T=(ue+ge)/2,N=M.b5(w.x,T-this.worldSize/2,T+this.worldSize/2),$=Le.x/2;N-$<ue&&(O=ue+$),N+$>ge&&(O=ge-$)}O===void 0&&Z===void 0||(this.center=this.unproject(new M.P(O!==void 0?O:w.x,Z!==void 0?Z:w.y)).wrap()),this._unmodified=m,this._constraining=!1}_calcMatrices(){if(!this.height)return;const h=this.centerOffset,x=this.point.x,O=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=M.b7(1,this.center.lat)*this.worldSize;let Z=M.ao(new Float64Array(16));M.a0(Z,Z,[this.width/2,-this.height/2,1]),M.$(Z,Z,[1,-1,0]),this.labelPlaneMatrix=Z,Z=M.ao(new Float64Array(16)),M.a0(Z,Z,[1,-1,1]),M.$(Z,Z,[-1,-1,0]),M.a0(Z,Z,[2/this.width,2/this.height,1]),this.glCoordMatrix=Z;const H=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),ae=Math.min(this.elevation,this._minEleveationForCurrentTile),ue=H-ae*this._pixelPerMeter/Math.cos(this._pitch),ge=ae<0?ue:H,Le=Math.PI/2+this._pitch,m=this._fov*(.5+h.y/this.height),w=Math.sin(m)*ge/Math.sin(M.ad(Math.PI-Le-m,.01,Math.PI-.01)),_=this.getHorizon(),T=2*Math.atan(_/this.cameraToCenterDistance)*(.5+h.y/(2*_)),N=Math.sin(T)*ge/Math.sin(M.ad(Math.PI-Le-T,.01,Math.PI-.01)),$=Math.min(w,N),X=1.01*(Math.cos(Math.PI/2-this._pitch)*$+ge),oe=this.height/50;Z=new Float64Array(16),M.b8(Z,this._fov,this.width/this.height,oe,X),Z[8]=2*-h.x/this.width,Z[9]=2*h.y/this.height,M.a0(Z,Z,[1,-1,1]),M.$(Z,Z,[0,0,-this.cameraToCenterDistance]),M.b9(Z,Z,this._pitch),M.ae(Z,Z,this.angle),M.$(Z,Z,[-x,-O,0]),this.mercatorMatrix=M.a0([],Z,[this.worldSize,this.worldSize,this.worldSize]),M.a0(Z,Z,[1,1,this._pixelPerMeter]),this.pixelMatrix=M.a1(new Float64Array(16),this.labelPlaneMatrix,Z),M.$(Z,Z,[0,0,-this.elevation]),this.projMatrix=Z,this.invProjMatrix=M.as([],Z),this.pixelMatrix3D=M.a1(new Float64Array(16),this.labelPlaneMatrix,Z);const xe=this.width%2/2,ye=this.height%2/2,De=Math.cos(this.angle),He=Math.sin(this.angle),$e=x-Math.round(x)+De*xe+He*ye,ft=O-Math.round(O)+De*ye+He*xe,pt=new Float64Array(Z);if(M.$(pt,pt,[$e>.5?$e-1:$e,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=pt,Z=M.as(new Float64Array(16),this.pixelMatrix),!Z)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Z,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const h=this.pointCoordinate(new M.P(0,0)),x=[h.x*this.worldSize,h.y*this.worldSize,0,1];return M.ag(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new M.P(0,h))}getCameraQueryGeometry(h){const x=this.getCameraPoint();if(h.length===1)return[h[0],x];{let O=x.x,Z=x.y,H=x.x,ae=x.y;for(const ue of h)O=Math.min(O,ue.x),Z=Math.min(Z,ue.y),H=Math.max(H,ue.x),ae=Math.max(ae,ue.y);return[new M.P(O,Z),new M.P(H,Z),new M.P(H,ae),new M.P(O,ae),new M.P(O,Z)]}}}function Xs(D,h){let x,O=!1,Z=null,H=null;const ae=()=>{Z=null,O&&(D.apply(H,x),Z=setTimeout(ae,h),O=!1)};return(...ue)=>(O=!0,H=this,x=ue,Z||ae(),Z)}class qf{constructor(h){this._getCurrentHash=()=>{const x=window.location.hash.replace("#","");if(this._hashName){let O;return x.split("&").map(Z=>Z.split("=")).forEach(Z=>{Z[0]===this._hashName&&(O=Z)}),(O&&O[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{const x=this._getCurrentHash();if(x.length>=3&&!x.some(O=>isNaN(O))){const O=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:O,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const x=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,x)}catch(O){}},this._updateHash=Xs(this._updateHashUnthrottled,300),this._hashName=h&&encodeURIComponent(h)}addTo(h){return this._map=h,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(h){const x=this._map.getCenter(),O=Math.round(100*this._map.getZoom())/100,Z=Math.ceil((O*Math.LN2+Math.log(512/360/.5))/Math.LN10),H=Math.pow(10,Z),ae=Math.round(x.lng*H)/H,ue=Math.round(x.lat*H)/H,ge=this._map.getBearing(),Le=this._map.getPitch();let m="";if(m+=h?`/${ae}/${ue}/${O}`:`${O}/${ue}/${ae}`,(ge||Le)&&(m+="/"+Math.round(10*ge)/10),Le&&(m+=`/${Math.round(Le)}`),this._hashName){const w=this._hashName;let _=!1;const T=window.location.hash.slice(1).split("&").map(N=>{const $=N.split("=")[0];return $===w?(_=!0,`${$}=${m}`):N}).filter(N=>N);return _||T.push(`${w}=${m}`),`#${T.join("&")}`}return`#${m}`}}const _p={linearity:.3,easing:M.ba(0,0,.3,1)},bp=M.e({deceleration:2500,maxSpeed:1400},_p),Yp=M.e({deceleration:20,maxSpeed:1400},_p),kp=M.e({deceleration:1e3,maxSpeed:360},_p),xp=M.e({deceleration:1e3,maxSpeed:90},_p);class Kl{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.h.now(),settings:h})}_drainInertiaBuffer(){const h=this._inertiaBuffer,x=M.h.now();for(;h.length>0&&x-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const x={zoom:0,bearing:0,pitch:0,pan:new M.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:H}of this._inertiaBuffer)x.zoom+=H.zoomDelta||0,x.bearing+=H.bearingDelta||0,x.pitch+=H.pitchDelta||0,H.panDelta&&x.pan._add(H.panDelta),H.around&&(x.around=H.around),H.pinchAround&&(x.pinchAround=H.pinchAround);const O=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,Z={};if(x.pan.mag()){const H=Rl(x.pan.mag(),O,M.e({},bp,h||{}));Z.offset=x.pan.mult(H.amount/x.pan.mag()),Z.center=this._map.transform.center,$c(Z,H)}if(x.zoom){const H=Rl(x.zoom,O,Yp);Z.zoom=this._map.transform.zoom+H.amount,$c(Z,H)}if(x.bearing){const H=Rl(x.bearing,O,kp);Z.bearing=this._map.transform.bearing+M.ad(H.amount,-179,179),$c(Z,H)}if(x.pitch){const H=Rl(x.pitch,O,xp);Z.pitch=this._map.transform.pitch+H.amount,$c(Z,H)}if(Z.zoom||Z.bearing){const H=x.pinchAround===void 0?x.around:x.pinchAround;Z.around=H?this._map.unproject(H):this._map.getCenter()}return this.clear(),M.e(Z,{noMoveStart:!0})}}function $c(D,h){(!D.duration||D.duration<h.duration)&&(D.duration=h.duration,D.easing=h.easing)}function Rl(D,h,x){const{maxSpeed:O,linearity:Z,deceleration:H}=x,ae=M.ad(D*Z/(h/1e3),-O,O),ue=Math.abs(ae)/(H*Z);return{easing:x.easing,duration:1e3*ue,amount:ae*(ue/2)}}class Ms extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,O,Z={}){const H=te.mousePos(x.getCanvasContainer(),O),ae=x.unproject(H);super(h,M.e({point:H,lngLat:ae,originalEvent:O},Z)),this._defaultPrevented=!1,this.target=x}}class Hh extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,O){const Z=h==="touchend"?O.changedTouches:O.touches,H=te.touchPos(x.getCanvasContainer(),Z),ae=H.map(ge=>x.unproject(ge)),ue=H.reduce((ge,Le,m,w)=>ge.add(Le.div(w.length)),new M.P(0,0));super(h,{points:H,point:ue,lngLats:ae,lngLat:x.unproject(ue),originalEvent:O}),this._defaultPrevented=!1}}class lf extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,O){super(h,{originalEvent:O}),this._defaultPrevented=!1}}class Ef{constructor(h,x){this._map=h,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(h){return this._firePreventable(new lf(h.type,this._map,h))}mousedown(h,x){return this._mousedownPos=x,this._firePreventable(new Ms(h.type,this._map,h))}mouseup(h){this._map.fire(new Ms(h.type,this._map,h))}click(h,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new Ms(h.type,this._map,h))}dblclick(h){return this._firePreventable(new Ms(h.type,this._map,h))}mouseover(h){this._map.fire(new Ms(h.type,this._map,h))}mouseout(h){this._map.fire(new Ms(h.type,this._map,h))}touchstart(h){return this._firePreventable(new Hh(h.type,this._map,h))}touchmove(h){this._map.fire(new Hh(h.type,this._map,h))}touchend(h){this._map.fire(new Hh(h.type,this._map,h))}touchcancel(h){this._map.fire(new Hh(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vs{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(h){this._map.fire(new Ms(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._ignoreContextMenu||this._map.fire(new Ms(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ns{constructor(h){this._map=h}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(h){return this.transform.pointLocation(M.P.convert(h),this._map.terrain)}}class bc{constructor(h,x){this._map=h,this._tr=new Ns(h),this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,x){this.isEnabled()&&h.shiftKey&&h.button===0&&(te.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(h,x){if(!this._active)return;const O=x;if(this._lastPos.equals(O)||!this._box&&O.dist(this._startPos)<this._clickTolerance)return;const Z=this._startPos;this._lastPos=O,this._box||(this._box=te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",h));const H=Math.min(Z.x,O.x),ae=Math.max(Z.x,O.x),ue=Math.min(Z.y,O.y),ge=Math.max(Z.y,O.y);te.setTransform(this._box,`translate(${H}px,${ue}px)`),this._box.style.width=ae-H+"px",this._box.style.height=ge-ue+"px"}mouseupWindow(h,x){if(!this._active||h.button!==0)return;const O=this._startPos,Z=x;if(this.reset(),te.suppressClick(),O.x!==Z.x||O.y!==Z.y)return this._map.fire(new M.k("boxzoomend",{originalEvent:h})),{cameraAnimation:H=>H.fitScreenCoordinates(O,Z,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",h)}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(h,x){return this._map.fire(new M.k(h,{originalEvent:x}))}}function fc(D,h){if(D.length!==h.length)throw new Error(`The number of touches and points are not equal - touches ${D.length}, points ${h.length}`);const x={};for(let O=0;O<D.length;O++)x[D[O].identifier]=h[O];return x}class xc{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(h,x,O){(this.centroid||O.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),O.length===this.numTouches&&(this.centroid=function(Z){const H=new M.P(0,0);for(const ae of Z)H._add(ae);return H.div(Z.length)}(x),this.touches=fc(O,x)))}touchmove(h,x,O){if(this.aborted||!this.centroid)return;const Z=fc(O,x);for(const H in this.touches){const ae=Z[H];(!ae||ae.dist(this.touches[H])>30)&&(this.aborted=!0)}}touchend(h,x,O){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),O.length===0){const Z=!this.aborted&&this.centroid;if(this.reset(),Z)return Z}}}class Pe{constructor(h){this.singleTap=new xc(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(h,x,O){this.singleTap.touchstart(h,x,O)}touchmove(h,x,O){this.singleTap.touchmove(h,x,O)}touchend(h,x,O){const Z=this.singleTap.touchend(h,x,O);if(Z){const H=h.timeStamp-this.lastTime<500,ae=!this.lastTap||this.lastTap.dist(Z)<30;if(H&&ae||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=Z,this.count===this.numTaps)return this.reset(),Z}}}class Ih{constructor(h){this._tr=new Ns(h),this._zoomIn=new Pe({numTouches:1,numTaps:2}),this._zoomOut=new Pe({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,x,O){this._zoomIn.touchstart(h,x,O),this._zoomOut.touchstart(h,x,O)}touchmove(h,x,O){this._zoomIn.touchmove(h,x,O),this._zoomOut.touchmove(h,x,O)}touchend(h,x,O){const Z=this._zoomIn.touchend(h,x,O),H=this._zoomOut.touchend(h,x,O),ae=this._tr;return Z?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ue=>ue.easeTo({duration:300,zoom:ae.zoom+1,around:ae.unproject(Z)},{originalEvent:h})}):H?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ue=>ue.easeTo({duration:300,zoom:ae.zoom-1,around:ae.unproject(H)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cf{constructor(h){this._enabled=!!h.enable,this._moveStateManager=h.moveStateManager,this._clickTolerance=h.clickTolerance||1,this._moveFunction=h.move,this._activateOnStart=!!h.activateOnStart,h.assignEvents(this),this.reset()}reset(h){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(h)}_move(...h){const x=this._moveFunction(...h);if(x.bearingDelta||x.pitchDelta||x.around||x.panDelta)return this._active=!0,x}dragStart(h,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(h)&&(this._moveStateManager.startMove(h),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(h,x){if(!this.isEnabled())return;const O=this._lastPoint;if(!O)return;if(h.preventDefault(),!this._moveStateManager.isValidMoveEvent(h))return void this.reset(h);const Z=x.length?x[0]:x;return!this._moved&&Z.dist(O)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=Z,this._move(O,Z))}dragEnd(h){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(h)&&(this._moved&&te.suppressClick(),this.reset(h))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Cf={0:1,2:2};class Af{constructor(h){this._correctEvent=h.checkCorrectEvent}startMove(h){const x=te.mouseButton(h);this._eventButton=x}endMove(h){delete this._eventButton}isValidStartEvent(h){return this._correctEvent(h)}isValidMoveEvent(h){return!function(x,O){const Z=Cf[O];return x.buttons===void 0||(x.buttons&Z)!==Z}(h,this._eventButton)}isValidEndEvent(h){return te.mouseButton(h)===this._eventButton}}class Lh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(h){return h.targetTouches.length===1}_isSameTouchEvent(h){return h.targetTouches[0].identifier===this._firstTouch}startMove(h){this._firstTouch=h.targetTouches[0].identifier}endMove(h){delete this._firstTouch}isValidStartEvent(h){return this._isOneFingerTouch(h)}isValidMoveEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}isValidEndEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}}const Cu=D=>{D.mousedown=D.dragStart,D.mousemoveWindow=D.dragMove,D.mouseup=D.dragEnd,D.contextmenu=function(h){h.preventDefault()}},nl=({enable:D,clickTolerance:h,bearingDegreesPerPixelMoved:x=.8})=>{const O=new Af({checkCorrectEvent:Z=>te.mouseButton(Z)===0&&Z.ctrlKey||te.mouseButton(Z)===2});return new cf({clickTolerance:h,move:(Z,H)=>({bearingDelta:(H.x-Z.x)*x}),moveStateManager:O,enable:D,assignEvents:Cu})},Wc=({enable:D,clickTolerance:h,pitchDegreesPerPixelMoved:x=-.5})=>{const O=new Af({checkCorrectEvent:Z=>te.mouseButton(Z)===0&&Z.ctrlKey||te.mouseButton(Z)===2});return new cf({clickTolerance:h,move:(Z,H)=>({pitchDelta:(H.y-Z.y)*x}),moveStateManager:O,enable:D,assignEvents:Cu})};class zi{constructor(h,x){this._minTouches=h.cooperativeGestures?2:1,this._clickTolerance=h.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new M.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(h,x,O){return this._calculateTransform(h,x,O)}touchmove(h,x,O){if(this._map._cooperativeGestures&&(this._minTouches===2&&O.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(h,!1,O.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(O.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,x,O)}touchend(h,x,O){this._calculateTransform(h,x,O),this._active&&O.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,x,O){O.length>0&&(this._active=!0);const Z=fc(O,x),H=new M.P(0,0),ae=new M.P(0,0);let ue=0;for(const Le in Z){const m=Z[Le],w=this._touches[Le];w&&(H._add(m),ae._add(m.sub(w)),ue++,Z[Le]=m)}if(this._touches=Z,ue<this._minTouches||!ae.mag())return;const ge=ae.div(ue);return this._sum._add(ge),this._sum.mag()<this._clickTolerance?void 0:{around:H.div(ue),panDelta:ge}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ui{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(h,x,O){this._firstTwoTouches||O.length<2||(this._firstTwoTouches=[O[0].identifier,O[1].identifier],this._start([x[0],x[1]]))}touchmove(h,x,O){if(!this._firstTwoTouches)return;h.preventDefault();const[Z,H]=this._firstTwoTouches,ae=Gu(O,x,Z),ue=Gu(O,x,H);if(!ae||!ue)return;const ge=this._aroundCenter?null:ae.add(ue).div(2);return this._move([ae,ue],ge,h)}touchend(h,x,O){if(!this._firstTwoTouches)return;const[Z,H]=this._firstTwoTouches,ae=Gu(O,x,Z),ue=Gu(O,x,H);ae&&ue||(this._active&&te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gu(D,h,x){for(let O=0;O<D.length;O++)if(D[O].identifier===x)return h[O]}function $h(D,h){return Math.log(D/h)/Math.LN2}class Wh extends Ui{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,x){const O=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs($h(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$h(this._distance,O),pinchAround:x}}}function ji(D,h){return 180*D.angleWith(h)/Math.PI}class Ic extends Ui{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,x){const O=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ji(this._vector,O),pinchAround:x}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());const x=25/(Math.PI*this._minDiameter)*360,O=ji(h,this._startVector);return Math.abs(O)<x}}function hf(D){return Math.abs(D.y)>Math.abs(D.x)}class Gn extends Ui{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(h,x,O){super.touchstart(h,x,O),this._currentTouchCount=O.length}_start(h){this._lastPoints=h,hf(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,x,O){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const Z=h[0].sub(this._lastPoints[0]),H=h[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(Z,H,O.timeStamp),this._valid?(this._lastPoints=h,this._active=!0,{pitchDelta:(Z.y+H.y)/2*-.5}):void 0}gestureBeginsVertically(h,x,O){if(this._valid!==void 0)return this._valid;const Z=h.mag()>=2,H=x.mag()>=2;if(!Z&&!H)return;if(!Z||!H)return this._firstMove===void 0&&(this._firstMove=O),O-this._firstMove<100&&void 0;const ae=h.y>0==x.y>0;return hf(h)&&hf(x)&&ae}}const ld={panStep:100,bearingStep:15,pitchStep:10};class xh{constructor(h){this._tr=new Ns(h);const x=ld;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let x=0,O=0,Z=0,H=0,ae=0;switch(h.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:h.shiftKey?O=-1:(h.preventDefault(),H=-1);break;case 39:h.shiftKey?O=1:(h.preventDefault(),H=1);break;case 38:h.shiftKey?Z=1:(h.preventDefault(),ae=-1);break;case 40:h.shiftKey?Z=-1:(h.preventDefault(),ae=1);break;default:return}return this._rotationDisabled&&(O=0,Z=0),{cameraAnimation:ue=>{const ge=this._tr;ue.easeTo({duration:300,easeId:"keyboardHandler",easing:Xh,zoom:x?Math.round(ge.zoom)+x*(h.shiftKey?2:1):ge.zoom,bearing:ge.bearing+O*this._bearingStep,pitch:ge.pitch+Z*this._pitchStep,offset:[-H*this._panStep,-ae*this._panStep],center:ge.center},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xh(D){return D*(2-D)}const wh=4.000244140625;class oh{constructor(h,x){this._onTimeout=O=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(O)},this._map=h,this._tr=new Ns(h),this._el=h.getCanvasContainer(),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!h[this._map._metaKey])return;h.preventDefault()}let x=h.deltaMode===WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY;const O=M.h.now(),Z=O-(this._lastWheelEventTime||0);this._lastWheelEventTime=O,x!==0&&x%wh==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":Z>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(Z*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),h.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=h,this._delta-=x,this._active||this._start(h)),h.preventDefault()}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const x=te.mousePos(this._el,h),O=this._tr;this._around=M.L.convert(this._aroundCenter?O.center:O.unproject(x)),this._aroundPoint=O.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const h=this._tr.transform;if(this._delta!==0){const ue=this._type==="wheel"&&Math.abs(this._delta)>wh?this._wheelZoomRate:this._defaultZoomRate;let ge=2/(1+Math.exp(-Math.abs(this._delta*ue)));this._delta<0&&ge!==0&&(ge=1/ge);const Le=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(Le*ge))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,O=this._startZoom,Z=this._easing;let H,ae=!1;if(this._type==="wheel"&&O&&Z){const ue=Math.min((M.h.now()-this._lastWheelEventTime)/200,1),ge=Z(ue);H=M.B.number(O,x,ge),ue<1?this._frameId||(this._frameId=!0):ae=!0}else H=x,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:H-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let x=M.bb;if(this._prevEase){const O=this._prevEase,Z=(M.h.now()-O.start)/O.duration,H=O.easing(Z+.01)-O.easing(Z),ae=.27/Math.sqrt(H*H+1e-4)*.01,ue=Math.sqrt(.0729-ae*ae);x=M.ba(ae,ue,.25,1)}return this._prevEase={start:M.h.now(),duration:h,easing:x},x}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ff{constructor(h,x){this._clickZoom=h,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tf{constructor(h){this._tr=new Ns(h),this.reset()}reset(){this._active=!1}dblclick(h,x){return h.preventDefault(),{cameraAnimation:O=>{O.easeTo({duration:300,zoom:this._tr.zoom+(h.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jl{constructor(){this._tap=new Pe({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(h,x,O){if(!this._swipePoint)if(this._tapTime){const Z=x[0],H=h.timeStamp-this._tapTime<500,ae=this._tapPoint.dist(Z)<30;H&&ae?O.length>0&&(this._swipePoint=Z,this._swipeTouch=O[0].identifier):this.reset()}else this._tap.touchstart(h,x,O)}touchmove(h,x,O){if(this._tapTime){if(this._swipePoint){if(O[0].identifier!==this._swipeTouch)return;const Z=x[0],H=Z.y-this._swipePoint.y;return this._swipePoint=Z,h.preventDefault(),this._active=!0,{zoomDelta:H/128}}}else this._tap.touchmove(h,x,O)}touchend(h,x,O){if(this._tapTime)this._swipePoint&&O.length===0&&this.reset();else{const Z=this._tap.touchend(h,x,O);Z&&(this._tapTime=h.timeStamp,this._tapPoint=Z)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wc{constructor(h,x,O){this._el=h,this._mousePan=x,this._touchPan=O}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ql{constructor(h,x,O){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=x,this._mousePitch=O}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yh{constructor(h,x,O,Z){this._el=h,this._touchZoom=x,this._touchRotate=O,this._tapDragZoom=Z,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Mf=D=>D.zoom||D.drag||D.pitch||D.rotate;class pf extends M.k{}function Lc(D){return D.panDelta&&D.panDelta.mag()||D.zoomDelta||D.bearingDelta||D.pitchDelta}class _l{constructor(h,x){this.handleWindowEvent=Z=>{this.handleEvent(Z,`${Z.type}Window`)},this.handleEvent=(Z,H)=>{if(Z.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const ae=Z.type==="renderFrame"?void 0:Z,ue={needsRenderFrame:!1},ge={},Le={},m=Z.touches,w=m?this._getMapTouches(m):void 0,_=w?te.touchPos(this._el,w):te.mousePos(this._el,Z);for(const{handlerName:$,handler:X,allowed:oe}of this._handlers){if(!X.isEnabled())continue;let xe;this._blockedByActive(Le,oe,$)?X.reset():X[H||Z.type]&&(xe=X[H||Z.type](Z,_,w),this.mergeHandlerResult(ue,ge,xe,$,ae),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||X.isActive())&&(Le[$]=X)}const T={};for(const $ in this._previousActiveHandlers)Le[$]||(T[$]=ae);this._previousActiveHandlers=Le,(Object.keys(T).length||Lc(ue))&&(this._changes.push([ue,ge,T]),this._triggerRenderFrame()),(Object.keys(Le).length||Lc(ue))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=ue;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kl(h),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);const O=this._el;this._listeners=[[O,"touchstart",{passive:!0}],[O,"touchmove",{passive:!1}],[O,"touchend",void 0],[O,"touchcancel",void 0],[O,"mousedown",void 0],[O,"mousemove",void 0],[O,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[O,"mouseover",void 0],[O,"mouseout",void 0],[O,"dblclick",void 0],[O,"click",void 0],[O,"keydown",{capture:!1}],[O,"keyup",void 0],[O,"wheel",{passive:!1}],[O,"contextmenu",void 0],[window,"blur",void 0]];for(const[Z,H,ae]of this._listeners)te.addEventListener(Z,H,Z===document?this.handleWindowEvent:this.handleEvent,ae)}destroy(){for(const[h,x,O]of this._listeners)te.removeEventListener(h,x,h===document?this.handleWindowEvent:this.handleEvent,O)}_addDefaultHandlers(h){const x=this._map,O=x.getCanvasContainer();this._add("mapEvent",new Ef(x,h));const Z=x.boxZoom=new bc(x,h);this._add("boxZoom",Z),h.interactive&&h.boxZoom&&Z.enable();const H=new Ih(x),ae=new Tf(x);x.doubleClickZoom=new ff(ae,H),this._add("tapZoom",H),this._add("clickZoom",ae),h.interactive&&h.doubleClickZoom&&x.doubleClickZoom.enable();const ue=new Jl;this._add("tapDragZoom",ue);const ge=x.touchPitch=new Gn(x);this._add("touchPitch",ge),h.interactive&&h.touchPitch&&x.touchPitch.enable(h.touchPitch);const Le=nl(h),m=Wc(h);x.dragRotate=new Ql(h,Le,m),this._add("mouseRotate",Le,["mousePitch"]),this._add("mousePitch",m,["mouseRotate"]),h.interactive&&h.dragRotate&&x.dragRotate.enable();const w=(({enable:oe,clickTolerance:xe})=>{const ye=new Af({checkCorrectEvent:De=>te.mouseButton(De)===0&&!De.ctrlKey});return new cf({clickTolerance:xe,move:(De,He)=>({around:He,panDelta:He.sub(De)}),activateOnStart:!0,moveStateManager:ye,enable:oe,assignEvents:Cu})})(h),_=new zi(h,x);x.dragPan=new wc(O,w,_),this._add("mousePan",w),this._add("touchPan",_,["touchZoom","touchRotate"]),h.interactive&&h.dragPan&&x.dragPan.enable(h.dragPan);const T=new Ic,N=new Wh;x.touchZoomRotate=new Yh(O,N,T,ue),this._add("touchRotate",T,["touchPan","touchZoom"]),this._add("touchZoom",N,["touchPan","touchRotate"]),h.interactive&&h.touchZoomRotate&&x.touchZoomRotate.enable(h.touchZoomRotate);const $=x.scrollZoom=new oh(x,()=>this._triggerRenderFrame());this._add("scrollZoom",$,["mousePan"]),h.interactive&&h.scrollZoom&&x.scrollZoom.enable(h.scrollZoom);const X=x.keyboard=new xh(x);this._add("keyboard",X),h.interactive&&h.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new vs(x))}_add(h,x,O){this._handlers.push({handlerName:h,handler:x,allowed:O}),this._handlersById[h]=x}stop(h){if(!this._updatingCamera){for(const{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}}isActive(){for(const{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mf(this._eventsInProgress)||this.isZooming()}_blockedByActive(h,x,O){for(const Z in h)if(Z!==O&&(!x||x.indexOf(Z)<0))return!0;return!1}_getMapTouches(h){const x=[];for(const O of h)this._el.contains(O.target)&&x.push(O);return x}mergeHandlerResult(h,x,O,Z,H){if(!O)return;M.e(h,O);const ae={handlerName:Z,originalEvent:O.originalEvent||H};O.zoomDelta!==void 0&&(x.zoom=ae),O.panDelta!==void 0&&(x.drag=ae),O.pitchDelta!==void 0&&(x.pitch=ae),O.bearingDelta!==void 0&&(x.rotate=ae)}_applyChanges(){const h={},x={},O={};for(const[Z,H,ae]of this._changes)Z.panDelta&&(h.panDelta=(h.panDelta||new M.P(0,0))._add(Z.panDelta)),Z.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+Z.zoomDelta),Z.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+Z.bearingDelta),Z.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+Z.pitchDelta),Z.around!==void 0&&(h.around=Z.around),Z.pinchAround!==void 0&&(h.pinchAround=Z.pinchAround),Z.noInertia&&(h.noInertia=Z.noInertia),M.e(x,H),M.e(O,ae);this._updateMapTransform(h,x,O),this._changes=[]}_updateMapTransform(h,x,O){const Z=this._map,H=Z._getTransformForUpdate(),ae=Z.terrain;if(!(Lc(h)||ae&&this._terrainMovement))return this._fireEvents(x,O,!0);let{panDelta:ue,zoomDelta:ge,bearingDelta:Le,pitchDelta:m,around:w,pinchAround:_}=h;_!==void 0&&(w=_),Z._stop(!0),w=w||Z.transform.centerPoint;const T=H.pointLocation(ue?w.sub(ue):w);Le&&(H.bearing+=Le),m&&(H.pitch+=m),ge&&(H.zoom+=ge),ae?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?H.center=H.pointLocation(H.centerPoint.sub(ue)):H.setLocationAtPoint(T,w):(this._terrainMovement=!0,this._map._elevationFreeze=!0,H.setLocationAtPoint(T,w),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,H.recalculateZoom(Z.terrain)})):H.setLocationAtPoint(T,w),Z._applyUpdatedTransform(H),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(x,O,!0)}_fireEvents(h,x,O){const Z=Mf(this._eventsInProgress),H=Mf(h),ae={};for(const m in h){const{originalEvent:w}=h[m];this._eventsInProgress[m]||(ae[`${m}start`]=w),this._eventsInProgress[m]=h[m]}!Z&&H&&this._fireEvent("movestart",H.originalEvent);for(const m in ae)this._fireEvent(m,ae[m]);H&&this._fireEvent("move",H.originalEvent);for(const m in h){const{originalEvent:w}=h[m];this._fireEvent(m,w)}const ue={};let ge;for(const m in this._eventsInProgress){const{handlerName:w,originalEvent:_}=this._eventsInProgress[m];this._handlersById[w].isActive()||(delete this._eventsInProgress[m],ge=x[w]||_,ue[`${m}end`]=ge)}for(const m in ue)this._fireEvent(m,ue[m]);const Le=Mf(this._eventsInProgress);if(O&&(Z||H)&&!Le){this._updatingCamera=!0;const m=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),w=_=>_!==0&&-this._bearingSnap<_&&_<this._bearingSnap;!m||!m.essential&&M.h.prefersReducedMotion?(this._map.fire(new M.k("moveend",{originalEvent:ge})),w(this._map.getBearing())&&this._map.resetNorth()):(w(m.bearing||this._map.getBearing())&&(m.bearing=0),m.freezeElevation=!0,this._map.easeTo(m,{originalEvent:ge})),this._updatingCamera=!1}}_fireEvent(h,x){this._map.fire(new M.k(h,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{delete this._frameId,this.handleEvent(new pf("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xo extends M.E{constructor(h,x){super(),this._renderFrameCallback=()=>{const O=Math.min((M.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(O)),O<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=x.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new M.L(this.transform.center.lng,this.transform.center.lat)}setCenter(h,x){return this.jumpTo({center:h},x)}panBy(h,x,O){return h=M.P.convert(h).mult(-1),this.panTo(this.transform.center,M.e({offset:h},x),O)}panTo(h,x,O){return this.easeTo(M.e({center:h},x),O)}getZoom(){return this.transform.zoom}setZoom(h,x){return this.jumpTo({zoom:h},x),this}zoomTo(h,x,O){return this.easeTo(M.e({zoom:h},x),O)}zoomIn(h,x){return this.zoomTo(this.getZoom()+1,h,x),this}zoomOut(h,x){return this.zoomTo(this.getZoom()-1,h,x),this}getBearing(){return this.transform.bearing}setBearing(h,x){return this.jumpTo({bearing:h},x),this}getPadding(){return this.transform.padding}setPadding(h,x){return this.jumpTo({padding:h},x),this}rotateTo(h,x,O){return this.easeTo(M.e({bearing:h},x),O)}resetNorth(h,x){return this.rotateTo(0,M.e({duration:1e3},h),x),this}resetNorthPitch(h,x){return this.easeTo(M.e({bearing:0,pitch:0,duration:1e3},h),x),this}snapToNorth(h,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,x):this}getPitch(){return this.transform.pitch}setPitch(h,x){return this.jumpTo({pitch:h},x),this}cameraForBounds(h,x){h=Nr.convert(h);const O=x&&x.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),O,x)}_cameraForBoxAndBearing(h,x,O,Z){const H={top:0,bottom:0,right:0,left:0};if(typeof(Z=M.e({padding:H,offset:[0,0],maxZoom:this.transform.maxZoom},Z)).padding=="number"){const He=Z.padding;Z.padding={top:He,bottom:He,right:He,left:He}}Z.padding=M.e(H,Z.padding);const ae=this.transform,ue=ae.padding,ge=ae.project(M.L.convert(h)),Le=ae.project(M.L.convert(x)),m=ge.rotate(-O*Math.PI/180),w=Le.rotate(-O*Math.PI/180),_=new M.P(Math.max(m.x,w.x),Math.max(m.y,w.y)),T=new M.P(Math.min(m.x,w.x),Math.min(m.y,w.y)),N=_.sub(T),$=(ae.width-(ue.left+ue.right+Z.padding.left+Z.padding.right))/N.x,X=(ae.height-(ue.top+ue.bottom+Z.padding.top+Z.padding.bottom))/N.y;if(X<0||$<0)return void M.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(ae.scaleZoom(ae.scale*Math.min($,X)),Z.maxZoom),xe=M.P.convert(Z.offset),ye=new M.P((Z.padding.left-Z.padding.right)/2,(Z.padding.top-Z.padding.bottom)/2).rotate(O*Math.PI/180),De=xe.add(ye).mult(ae.scale/ae.zoomScale(oe));return{center:ae.unproject(ge.add(Le).div(2).sub(De)),zoom:oe,bearing:O}}fitBounds(h,x,O){return this._fitInternal(this.cameraForBounds(h,x),x,O)}fitScreenCoordinates(h,x,O,Z,H){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(M.P.convert(h)),this.transform.pointLocation(M.P.convert(x)),O,Z),Z,H)}_fitInternal(h,x,O){return h?(delete(x=M.e(h,x)).padding,x.linear?this.easeTo(x,O):this.flyTo(x,O)):this}jumpTo(h,x){this.stop();const O=this._getTransformForUpdate();let Z=!1,H=!1,ae=!1;return"zoom"in h&&O.zoom!==+h.zoom&&(Z=!0,O.zoom=+h.zoom),h.center!==void 0&&(O.center=M.L.convert(h.center)),"bearing"in h&&O.bearing!==+h.bearing&&(H=!0,O.bearing=+h.bearing),"pitch"in h&&O.pitch!==+h.pitch&&(ae=!0,O.pitch=+h.pitch),h.padding==null||O.isPaddingEqual(h.padding)||(O.padding=h.padding),this._applyUpdatedTransform(O),this.fire(new M.k("movestart",x)).fire(new M.k("move",x)),Z&&this.fire(new M.k("zoomstart",x)).fire(new M.k("zoom",x)).fire(new M.k("zoomend",x)),H&&this.fire(new M.k("rotatestart",x)).fire(new M.k("rotate",x)).fire(new M.k("rotateend",x)),ae&&this.fire(new M.k("pitchstart",x)).fire(new M.k("pitch",x)).fire(new M.k("pitchend",x)),this.fire(new M.k("moveend",x))}calculateCameraOptionsFromTo(h,x,O,Z=0){const H=M.U.fromLngLat(h,x),ae=M.U.fromLngLat(O,Z),ue=ae.x-H.x,ge=ae.y-H.y,Le=ae.z-H.z,m=Math.hypot(ue,ge,Le);if(m===0)throw new Error("Can't calculate camera options with same From and To");const w=Math.hypot(ue,ge),_=this.transform.scaleZoom(this.transform.cameraToCenterDistance/m/this.transform.tileSize),T=180*Math.atan2(ue,-ge)/Math.PI;let N=180*Math.acos(w/m)/Math.PI;return N=Le<0?90-N:90+N,{center:ae.toLngLat(),zoom:_,pitch:N,bearing:T}}easeTo(h,x){this._stop(!1,h.easeId),((h=M.e({offset:[0,0],duration:500,easing:M.bb},h)).animate===!1||!h.essential&&M.h.prefersReducedMotion)&&(h.duration=0);const O=this._getTransformForUpdate(),Z=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),ue=this.getPadding(),ge="zoom"in h?+h.zoom:Z,Le="bearing"in h?this._normalizeBearing(h.bearing,H):H,m="pitch"in h?+h.pitch:ae,w="padding"in h?h.padding:O.padding,_=M.P.convert(h.offset);let T=O.centerPoint.add(_);const N=O.pointLocation(T),$=M.L.convert(h.center||N);this._normalizeCenter($);const X=O.project(N),oe=O.project($).sub(X),xe=O.zoomScale(ge-Z);let ye,De;h.around&&(ye=M.L.convert(h.around),De=O.locationPoint(ye));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==Z,this._rotating=this._rotating||H!==Le,this._pitching=this._pitching||m!==ae,this._padding=!O.isPaddingEqual(w),this._easeId=h.easeId,this._prepareEase(x,h.noMoveStart,He),this.terrain&&this._prepareElevation($),this._ease($e=>{if(this._zooming&&(O.zoom=M.B.number(Z,ge,$e)),this._rotating&&(O.bearing=M.B.number(H,Le,$e)),this._pitching&&(O.pitch=M.B.number(ae,m,$e)),this._padding&&(O.interpolatePadding(ue,w,$e),T=O.centerPoint.add(_)),this.terrain&&!h.freezeElevation&&this._updateElevation($e),ye)O.setLocationAtPoint(ye,De);else{const ft=O.zoomScale(O.zoom-Z),pt=ge>Z?Math.min(2,xe):Math.max(.5,xe),wt=Math.pow(pt,1-$e),dt=O.unproject(X.add(oe.mult($e*wt)).mult(ft));O.setLocationAtPoint(O.renderWorldCopies?dt.wrap():dt,T)}this._applyUpdatedTransform(O),this._fireMoveEvents(x)},$e=>{this.terrain&&this._finalizeElevation(),this._afterEase(x,$e)},h),this}_prepareEase(h,x,O={}){this._moving=!0,x||O.moving||this.fire(new M.k("movestart",h)),this._zooming&&!O.zooming&&this.fire(new M.k("zoomstart",h)),this._rotating&&!O.rotating&&this.fire(new M.k("rotatestart",h)),this._pitching&&!O.pitching&&this.fire(new M.k("pitchstart",h))}_prepareElevation(h){this._elevationCenter=h,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(h){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(h<1&&x!==this._elevationTarget){const O=this._elevationTarget-this._elevationStart;this._elevationStart+=h*(O-(x-(O*h+this._elevationStart))/(1-h)),this._elevationTarget=x}this.transform.elevation=M.B.number(this._elevationStart,this._elevationTarget,h)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(h){if(!this.transformCameraUpdate)return;const x=h.clone(),{center:O,zoom:Z,pitch:H,bearing:ae,elevation:ue}=this.transformCameraUpdate(x);O&&(x.center=O),Z!==void 0&&(x.zoom=Z),H!==void 0&&(x.pitch=H),ae!==void 0&&(x.bearing=ae),ue!==void 0&&(x.elevation=ue),this.transform.apply(x)}_fireMoveEvents(h){this.fire(new M.k("move",h)),this._zooming&&this.fire(new M.k("zoom",h)),this._rotating&&this.fire(new M.k("rotate",h)),this._pitching&&this.fire(new M.k("pitch",h))}_afterEase(h,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;const O=this._zooming,Z=this._rotating,H=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,O&&this.fire(new M.k("zoomend",h)),Z&&this.fire(new M.k("rotateend",h)),H&&this.fire(new M.k("pitchend",h)),this.fire(new M.k("moveend",h))}flyTo(h,x){if(!h.essential&&M.h.prefersReducedMotion){const _r=M.F(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_r,x)}this.stop(),h=M.e({offset:[0,0],speed:1.2,curve:1.42,easing:M.bb},h);const O=this._getTransformForUpdate(),Z=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),ue=this.getPadding(),ge="zoom"in h?M.ad(+h.zoom,O.minZoom,O.maxZoom):Z,Le="bearing"in h?this._normalizeBearing(h.bearing,H):H,m="pitch"in h?+h.pitch:ae,w="padding"in h?h.padding:O.padding,_=O.zoomScale(ge-Z),T=M.P.convert(h.offset);let N=O.centerPoint.add(T);const $=O.pointLocation(N),X=M.L.convert(h.center||$);this._normalizeCenter(X);const oe=O.project($),xe=O.project(X).sub(oe);let ye=h.curve;const De=Math.max(O.width,O.height),He=De/_,$e=xe.mag();if("minZoom"in h){const _r=M.ad(Math.min(h.minZoom,Z,ge),O.minZoom,O.maxZoom),Qr=De/O.zoomScale(_r-Z);ye=Math.sqrt(Qr/$e*2)}const ft=ye*ye;function pt(_r){const Qr=(He*He-De*De+(_r?-1:1)*ft*ft*$e*$e)/(2*(_r?He:De)*ft*$e);return Math.log(Math.sqrt(Qr*Qr+1)-Qr)}function wt(_r){return(Math.exp(_r)-Math.exp(-_r))/2}function dt(_r){return(Math.exp(_r)+Math.exp(-_r))/2}const Ft=pt(!1);let ar=function(_r){return dt(Ft)/dt(Ft+ye*_r)},nr=function(_r){return De*((dt(Ft)*(wt(Qr=Ft+ye*_r)/dt(Qr))-wt(Ft))/ft)/$e;var Qr},Ir=(pt(!0)-Ft)/ye;if(Math.abs($e)<1e-6||!isFinite(Ir)){if(Math.abs(De-He)<1e-6)return this.easeTo(h,x);const _r=He<De?-1:1;Ir=Math.abs(Math.log(He/De))/ye,nr=function(){return 0},ar=function(Qr){return Math.exp(_r*ye*Qr)}}return h.duration="duration"in h?+h.duration:1e3*Ir/("screenSpeed"in h?+h.screenSpeed/ye:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=H!==Le,this._pitching=m!==ae,this._padding=!O.isPaddingEqual(w),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(X),this._ease(_r=>{const Qr=_r*Ir,nn=1/ar(Qr);O.zoom=_r===1?ge:Z+O.scaleZoom(nn),this._rotating&&(O.bearing=M.B.number(H,Le,_r)),this._pitching&&(O.pitch=M.B.number(ae,m,_r)),this._padding&&(O.interpolatePadding(ue,w,_r),N=O.centerPoint.add(T)),this.terrain&&!h.freezeElevation&&this._updateElevation(_r);const Ln=_r===1?X:O.unproject(oe.add(xe.mult(nr(Qr))).mult(nn));O.setLocationAtPoint(O.renderWorldCopies?Ln.wrap():Ln,N),this._applyUpdatedTransform(O),this._fireMoveEvents(x)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(x)},h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(h,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const O=this._onEaseEnd;delete this._onEaseEnd,O.call(this,x)}if(!h){const O=this.handlers;O&&O.stop(!1)}return this}_ease(h,x,O){O.animate===!1||O.duration===0?(h(1),x()):(this._easeStart=M.h.now(),this._easeOptions=O,this._onEaseFrame=h,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(h,x){h=M.b5(h,-180,180);const O=Math.abs(h-x);return Math.abs(h-360-x)<O&&(h-=360),Math.abs(h+360-x)<O&&(h+=360),h}_normalizeCenter(h){const x=this.transform;if(!x.renderWorldCopies||x.lngRange)return;const O=h.lng-x.center.lng;h.lng+=O>180?-360:O<-180?360:0}queryTerrainElevation(h){return this.terrain?this.terrain.getElevationForLngLatZoom(M.L.convert(h),this.transform.tileZoom)-this.transform.elevation:null}}class Dl{constructor(h={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=h}getDefaultPosition(){return"bottom-right"}onAdd(h){return this._map=h,this._compact=this.options&&this.options.compact,this._container=te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(h,x){const O=this._map._getUIString(`AttributionControl.${x}`);h.title=O,h.setAttribute("aria-label",O)}_updateAttributions(){if(!this._map.style)return;let h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(Z=>typeof Z!="string"?"":Z)):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){const Z=this._map.style.stylesheet;this.styleOwner=Z.owner,this.styleId=Z.id}const x=this._map.style.sourceCaches;for(const Z in x){const H=x[Z];if(H.used||H.usedForTerrain){const ae=H.getSource();ae.attribution&&h.indexOf(ae.attribution)<0&&h.push(ae.attribution)}}h=h.filter(Z=>String(Z).trim()),h.sort((Z,H)=>Z.length-H.length),h=h.filter((Z,H)=>{for(let ae=H+1;ae<h.length;ae++)if(h[ae].indexOf(Z)>=0)return!1;return!0});const O=h.join(" | ");O!==this._attribHTML&&(this._attribHTML=O,h.length?(this._innerContainer.innerHTML=O,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Po{constructor(h={}){this._updateCompact=()=>{const x=this._container.children;if(x.length){const O=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&O.classList.add("maplibregl-compact"):O.classList.remove("maplibregl-compact")}},this.options=h}getDefaultPosition(){return"bottom-left"}onAdd(h){this._map=h,this._compact=this.options&&this.options.compact,this._container=te.create("div","maplibregl-ctrl");const x=te.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class dl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){const x=++this._id;return this._queue.push({callback:h,id:x,cancelled:!1}),x}remove(h){const x=this._currentlyRunning,O=x?this._queue.concat(x):this._queue;for(const Z of O)if(Z.id===h)return void(Z.cancelled=!0)}run(h=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const x=this._currentlyRunning=this._queue;this._queue=[];for(const O of x)if(!O.cancelled&&(O.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Kf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Pf=M.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Sc extends M.E{constructor(h){super(),this.sourceCache=h,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,h.usedForTerrain=!0,h.tileSize=this.tileSize*Tp(2,this.deltaZoom)}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(h,x){this.sourceCache.update(h,x),this._renderableTilesKeys=[];const O={};for(const Z of h.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))O[Z.key]=!0,this._renderableTilesKeys.push(Z.key),this._tiles[Z.key]||(Z.posMatrix=new Float64Array(16),M.aS(Z.posMatrix,0,M.N,0,M.N,0,1),this._tiles[Z.key]=new ha(Z,this.tileSize));for(const Z in this._tiles)O[Z]||delete this._tiles[Z]}freeRtt(h){for(const x in this._tiles){const O=this._tiles[x];(!h||O.tileID.equals(h)||O.tileID.isChildOf(h)||h.isChildOf(O.tileID))&&(O.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(h=>this.getTileByID(h))}getTileByID(h){return this._tiles[h]}getTerrainCoords(h){const x={};for(const O of this._renderableTilesKeys){const Z=this._tiles[O].tileID;if(Z.canonical.equals(h.canonical)){const H=h.clone();H.posMatrix=new Float64Array(16),M.aS(H.posMatrix,0,M.N,0,M.N,0,1),x[O]=H}else if(Z.canonical.isChildOf(h.canonical)){const H=h.clone();H.posMatrix=new Float64Array(16);const ae=Z.canonical.z-h.canonical.z,ue=Z.canonical.x-(Z.canonical.x>>ae<<ae),ge=Z.canonical.y-(Z.canonical.y>>ae<<ae),Le=M.N>>ae;M.aS(H.posMatrix,0,Le,0,Le,0,1),M.$(H.posMatrix,H.posMatrix,[-ue*Le,-ge*Le,0]),x[O]=H}else if(h.canonical.isChildOf(Z.canonical)){const H=h.clone();H.posMatrix=new Float64Array(16);const ae=h.canonical.z-Z.canonical.z,ue=h.canonical.x-(h.canonical.x>>ae<<ae),ge=h.canonical.y-(h.canonical.y>>ae<<ae),Le=M.N>>ae;M.aS(H.posMatrix,0,M.N,0,M.N,0,1),M.$(H.posMatrix,H.posMatrix,[ue*Le,ge*Le,0]),M.a0(H.posMatrix,H.posMatrix,[1/Tp(2,ae),1/Tp(2,ae),0]),x[O]=H}}return x}getSourceTile(h,x){const O=this.sourceCache._source;let Z=h.overscaledZ-this.deltaZoom;if(Z>O.maxzoom&&(Z=O.maxzoom),Z<O.minzoom)return null;this._sourceTileCache[h.key]||(this._sourceTileCache[h.key]=h.scaledTo(Z).key);let H=this.sourceCache.getTileByID(this._sourceTileCache[h.key]);if((!H||!H.dem)&&x)for(;Z>=O.minzoom&&(!H||!H.dem);)H=this.sourceCache.getTileByID(h.scaledTo(Z--).key);return H}tilesAfterTime(h=Date.now()){return Object.values(this._tiles).filter(x=>x.timeAdded>=h)}}class Ec{constructor(h,x,O){this.painter=h,this.sourceCache=new Sc(x),this.options=O,this.exaggeration=typeof O.exaggeration=="number"?O.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(h,x,O,Z=M.N){var H;if(!(x>=0&&x<Z&&O>=0&&O<Z))return 0;const ae=this.getTerrainData(h),ue=(H=ae.tile)===null||H===void 0?void 0:H.dem;if(!ue)return 0;const ge=function(N,$,X){var oe=$[0],xe=$[1];return N[0]=X[0]*oe+X[4]*xe+X[12],N[1]=X[1]*oe+X[5]*xe+X[13],N}([],[x/Z*M.N,O/Z*M.N],ae.u_terrain_matrix),Le=[ge[0]*ue.dim,ge[1]*ue.dim],m=Math.floor(Le[0]),w=Math.floor(Le[1]),_=Le[0]-m,T=Le[1]-w;return ue.get(m,w)*(1-_)*(1-T)+ue.get(m+1,w)*_*(1-T)+ue.get(m,w+1)*(1-_)*T+ue.get(m+1,w+1)*_*T}getElevationForLngLatZoom(h,x){const{tileID:O,mercatorX:Z,mercatorY:H}=this._getOverscaledTileIDFromLngLatZoom(h,x);return this.getElevation(O,Z%M.N,H%M.N,M.N)}getElevation(h,x,O,Z=M.N){return this.getDEMElevation(h,x,O,Z)*this.exaggeration}getTerrainData(h){if(!this._emptyDemTexture){const Z=this.painter.context,H=new M.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new rr(Z,H,Z.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new rr(Z,new M.R({width:1,height:1}),Z.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(Z.gl.NEAREST,Z.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=M.ao([])}const x=this.sourceCache.getSourceTile(h,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){const Z=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new rr(Z,x.dem.getPixels(),Z.gl.RGBA,{premultiply:!1}),x.demTexture.bind(Z.gl.NEAREST,Z.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}const O=x&&x+x.tileID.key+h.key;if(O&&!this._demMatrixCache[O]){const Z=this.sourceCache.sourceCache._source.maxzoom;let H=h.canonical.z-x.tileID.canonical.z;h.overscaledZ>h.canonical.z&&(h.canonical.z>=Z?H=h.canonical.z-Z:M.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const ae=h.canonical.x-(h.canonical.x>>H<<H),ue=h.canonical.y-(h.canonical.y>>H<<H),ge=M.bc(new Float64Array(16),[1/(M.N<<H),1/(M.N<<H),0]);M.$(ge,ge,[ae*M.N,ue*M.N,0]),this._demMatrixCache[h.key]={matrix:ge,coord:h}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:O?this._demMatrixCache[h.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(h){const x=this.painter,O=x.width/devicePixelRatio,Z=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===O&&this._fbo.height===Z||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new rr(x.context,{width:O,height:Z,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new rr(x.context,{width:O,height:Z,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(O,Z,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,O,Z))),this._fbo.colorAttachment.set(h==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const h=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let H=0,ae=0;H<this._coordsTextureSize;H++)for(let ue=0;ue<this._coordsTextureSize;ue++,ae+=4)x[ae+0]=255&ue,x[ae+1]=255&H,x[ae+2]=ue>>8<<4|H>>8,x[ae+3]=0;const O=new M.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),Z=new rr(h,O,h.gl.RGBA,{premultiply:!1});return Z.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._coordsTexture=Z,Z}pointCoordinate(h){const x=new Uint8Array(4),O=this.painter.context,Z=O.gl;O.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),Z.readPixels(h.x,this.painter.height/devicePixelRatio-h.y-1,1,1,Z.RGBA,Z.UNSIGNED_BYTE,x),O.bindFramebuffer.set(null);const H=x[0]+(x[2]>>4<<8),ae=x[1]+((15&x[2])<<8),ue=this.coordsIndex[255-x[3]],ge=ue&&this.sourceCache.getTileByID(ue);if(!ge)return null;const Le=this._coordsTextureSize,m=(1<<ge.tileID.canonical.z)*Le;return new M.U((ge.tileID.canonical.x*Le+H)/m,(ge.tileID.canonical.y*Le+ae)/m,this.getElevation(ge.tileID,H,ae,Le))}getTerrainMesh(){if(this._mesh)return this._mesh;const h=this.painter.context,x=new M.bd,O=new M.b0,Z=this.meshSize,H=M.N/Z,ae=Z*Z;for(let w=0;w<=Z;w++)for(let _=0;_<=Z;_++)x.emplaceBack(_*H,w*H,0);for(let w=0;w<ae;w+=Z+1)for(let _=0;_<Z;_++)O.emplaceBack(_+w,Z+_+w+1,Z+_+w+2),O.emplaceBack(_+w,Z+_+w+2,_+w+1);const ue=x.length,ge=ue+2*(Z+1);for(const w of[0,1])for(let _=0;_<=Z;_++)for(const T of[0,1])x.emplaceBack(_*H,w*M.N,T);for(let w=0;w<2*Z;w+=2)O.emplaceBack(ge+w,ge+w+1,ge+w+3),O.emplaceBack(ge+w,ge+w+3,ge+w+2),O.emplaceBack(ue+w,ue+w+3,ue+w+1),O.emplaceBack(ue+w,ue+w+2,ue+w+3);const Le=x.length,m=Le+2*(Z+1);for(const w of[0,1])for(let _=0;_<=Z;_++)for(const T of[0,1])x.emplaceBack(w*M.N,_*H,T);for(let w=0;w<2*Z;w+=2)O.emplaceBack(Le+w,Le+w+1,Le+w+3),O.emplaceBack(Le+w,Le+w+3,Le+w+2),O.emplaceBack(m+w,m+w+3,m+w+1),O.emplaceBack(m+w,m+w+2,m+w+3);return this._mesh={indexBuffer:h.createIndexBuffer(O),vertexBuffer:h.createVertexBuffer(x,Pf.members),segments:M.S.simpleSegment(0,0,x.length,O.length)},this._mesh}getMeshFrameDelta(h){return 2*Math.PI*M.be/Math.pow(2,h)/5}getMinTileElevationForLngLatZoom(h,x){var O;const{tileID:Z}=this._getOverscaledTileIDFromLngLatZoom(h,x);return(O=this.getMinMaxElevation(Z).minElevation)!==null&&O!==void 0?O:0}getMinMaxElevation(h){const x=this.getTerrainData(h).tile,O={minElevation:null,maxElevation:null};return x&&x.dem&&(O.minElevation=x.dem.min*this.exaggeration,O.maxElevation=x.dem.max*this.exaggeration),O}_getOverscaledTileIDFromLngLatZoom(h,x){const O=M.U.fromLngLat(h.wrap()),Z=(1<<x)*M.N,H=O.x*Z,ae=O.y*Z,ue=Math.floor(H/M.N),ge=Math.floor(ae/M.N);return{tileID:new M.O(x,0,x,ue,ge),mercatorX:H,mercatorY:ae}}}class Al{constructor(h,x,O){this._context=h,this._size=x,this._tileSize=O,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const h of this._objects)h.texture.destroy(),h.fbo.destroy()}_createObject(h){const x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),O=new rr(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return O.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(O.texture),{id:h,fbo:x,texture:O,stamp:-1,inUse:!1}}getObjectForId(h){return this._objects[h]}useObject(h){h.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(x=>h.id!==x),this._recentlyUsed.push(h.id)}stampObject(h){h.stamp=++this._stamp}getOrCreateFreeObject(){for(const x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const h=this._createObject(this._objects.length);return this._objects.push(h),h}freeObject(h){h.inUse=!1}freeAllObjects(){for(const h of this._objects)this.freeObject(h)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(h=>!h.inUse)===!1}}const aa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ta{constructor(h,x){this.painter=h,this.terrain=x,this.pool=new Al(h.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(h){return this.pool.getObjectForId(h.rtt[this._stacks.length-1].id).texture}prepareForRender(h,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=h._order.filter(O=>!h._layers[O].isHidden(x)),this._coordsDescendingInv={};for(const O in h.sourceCaches){this._coordsDescendingInv[O]={};const Z=h.sourceCaches[O].getVisibleCoordinates();for(const H of Z){const ae=this.terrain.sourceCache.getTerrainCoords(H);for(const ue in ae)this._coordsDescendingInv[O][ue]||(this._coordsDescendingInv[O][ue]=[]),this._coordsDescendingInv[O][ue].push(ae[ue])}}this._coordsDescendingInvStr={};for(const O of h._order){const Z=h._layers[O],H=Z.source;if(aa[Z.type]&&!this._coordsDescendingInvStr[H]){this._coordsDescendingInvStr[H]={};for(const ae in this._coordsDescendingInv[H])this._coordsDescendingInvStr[H][ae]=this._coordsDescendingInv[H][ae].map(ue=>ue.key).sort().join()}}for(const O of this._renderableTiles)for(const Z in this._coordsDescendingInvStr){const H=this._coordsDescendingInvStr[Z][O.tileID.key];H&&H!==O.rttCoords[Z]&&(O.rtt=[])}}renderLayer(h){if(h.isHidden(this.painter.transform.zoom))return!1;const x=h.type,O=this.painter,Z=this._renderableLayerIds[this._renderableLayerIds.length-1]===h.id;if(aa[x]&&(this._prevType&&aa[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(h.id),!Z))return!0;if(aa[this._prevType]||aa[x]&&Z){this._prevType=x;const H=this._stacks.length-1,ae=this._stacks[H]||[];for(const ue of this._renderableTiles){if(this.pool.isFull()&&(Vu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ue),ue.rtt[H]){const Le=this.pool.getObjectForId(ue.rtt[H].id);if(Le.stamp===ue.rtt[H].stamp){this.pool.useObject(Le);continue}}const ge=this.pool.getOrCreateFreeObject();this.pool.useObject(ge),this.pool.stampObject(ge),ue.rtt[H]={id:ge.id,stamp:ge.stamp},O.context.bindFramebuffer.set(ge.fbo.framebuffer),O.context.clear({color:M.aT.transparent,stencil:0}),O.currentStencilSource=void 0;for(let Le=0;Le<ae.length;Le++){const m=O.style._layers[ae[Le]],w=m.source?this._coordsDescendingInv[m.source][ue.tileID.key]:[ue.tileID];O.context.viewport.set([0,0,ge.fbo.width,ge.fbo.height]),O._renderTileClippingMasks(m,w),O.renderLayer(O,O.style.sourceCaches[m.source],m,w),m.source&&(ue.rttCoords[m.source]=this._coordsDescendingInvStr[m.source][ue.tileID.key])}}return Vu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),aa[x]}return!1}}const Da=ee,ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:M.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},bl=D=>{D.touchstart=D.dragStart,D.touchmoveWindow=D.dragMove,D.touchend=D.dragEnd},jl={showCompass:!0,showZoom:!0,visualizePitch:!1};class df{constructor(h,x,O=!1){this.mousedown=ae=>{this.startMouse(M.e({},ae,{ctrlKey:!0,preventDefault:()=>ae.preventDefault()}),te.mousePos(this.element,ae)),te.addEventListener(window,"mousemove",this.mousemove),te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=ae=>{this.moveMouse(ae,te.mousePos(this.element,ae))},this.mouseup=ae=>{this.mouseRotate.dragEnd(ae),this.mousePitch&&this.mousePitch.dragEnd(ae),this.offTemp()},this.touchstart=ae=>{ae.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,ae.targetTouches)[0],this.startTouch(ae,this._startPos),te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.addEventListener(window,"touchend",this.touchend))},this.touchmove=ae=>{ae.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,ae.targetTouches)[0],this.moveTouch(ae,this._lastPos))},this.touchend=ae=>{ae.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const Z=h.dragRotate._mouseRotate.getClickTolerance(),H=h.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=nl({clickTolerance:Z,enable:!0}),this.touchRotate=(({enable:ae,clickTolerance:ue,bearingDegreesPerPixelMoved:ge=.8})=>{const Le=new Lh;return new cf({clickTolerance:ue,move:(m,w)=>({bearingDelta:(w.x-m.x)*ge}),moveStateManager:Le,enable:ae,assignEvents:bl})})({clickTolerance:Z,enable:!0}),this.map=h,O&&(this.mousePitch=Wc({clickTolerance:H,enable:!0}),this.touchPitch=(({enable:ae,clickTolerance:ue,pitchDegreesPerPixelMoved:ge=-.5})=>{const Le=new Lh;return new cf({clickTolerance:ue,move:(m,w)=>({pitchDelta:(w.y-m.y)*ge}),moveStateManager:Le,enable:ae,assignEvents:bl})})({clickTolerance:H,enable:!0})),te.addEventListener(x,"mousedown",this.mousedown),te.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(x,"touchcancel",this.reset)}startMouse(h,x){this.mouseRotate.dragStart(h,x),this.mousePitch&&this.mousePitch.dragStart(h,x),te.disableDrag()}startTouch(h,x){this.touchRotate.dragStart(h,x),this.touchPitch&&this.touchPitch.dragStart(h,x),te.disableDrag()}moveMouse(h,x){const O=this.map,{bearingDelta:Z}=this.mouseRotate.dragMove(h,x)||{};if(Z&&O.setBearing(O.getBearing()+Z),this.mousePitch){const{pitchDelta:H}=this.mousePitch.dragMove(h,x)||{};H&&O.setPitch(O.getPitch()+H)}}moveTouch(h,x){const O=this.map,{bearingDelta:Z}=this.touchRotate.dragMove(h,x)||{};if(Z&&O.setBearing(O.getBearing()+Z),this.touchPitch){const{pitchDelta:H}=this.touchPitch.dragMove(h,x)||{};H&&O.setPitch(O.getPitch()+H)}}off(){const h=this.element;te.removeEventListener(h,"mousedown",this.mousedown),te.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend),te.removeEventListener(h,"touchcancel",this.reset),this.offTemp()}offTemp(){te.enableDrag(),te.removeEventListener(window,"mousemove",this.mousemove),te.removeEventListener(window,"mouseup",this.mouseup),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend)}}let Pu;function Rh(D,h,x){if(D=new M.L(D.lng,D.lat),h){const O=new M.L(D.lng-360,D.lat),Z=new M.L(D.lng+360,D.lat),H=x.locationPoint(D).distSqr(h);x.locationPoint(O).distSqr(h)<H?D=O:x.locationPoint(Z).distSqr(h)<H&&(D=Z)}for(;Math.abs(D.lng-x.center.lng)>180;){const O=x.locationPoint(D);if(O.x>=0&&O.y>=0&&O.x<=x.width&&O.y<=x.height)break;D.lng>x.center.lng?D.lng-=360:D.lng+=360}return D}const ho={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(D,h,x){const O=D.classList;for(const Z in ho)O.remove(`maplibregl-${x}-anchor-${Z}`);O.add(`maplibregl-${x}-anchor-${h}`)}class kf extends M.E{constructor(h){if(super(),this._onKeyPress=x=>{const O=x.code,Z=x.charCode||x.keyCode;O!=="Space"&&O!=="Enter"&&Z!==32&&Z!==13||this.togglePopup()},this._onMapClick=x=>{const O=x.originalEvent.target,Z=this._element;this._popup&&(O===Z||Z.contains(O))&&this.togglePopup()},this._update=x=>{if(!this._map)return;const O=this._map.loaded()&&!this._map.isMoving();((x==null?void 0:x.type)==="terrain"||(x==null?void 0:x.type)==="render"&&!O)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Rh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let Z="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?Z=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(Z=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let H="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?H="rotateX(0deg)":this._pitchAlignment==="map"&&(H=`rotateX(${this._map.getPitch()}deg)`),x&&x.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,`${ho[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${H} ${Z}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const ae=this._map.unproject(this._pos),ue=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=ae.distanceTo(this._lngLat)>20*ue?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=x=>{if(!this._isDragging){const O=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=O}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new M.k("dragstart"))),this.fire(new M.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new M.k("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=M.P.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div"),this._element.setAttribute("aria-label","Map marker");const x=te.createNS("http://www.w3.org/2000/svg","svg"),O=41,Z=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${O}px`),x.setAttributeNS(null,"width",`${Z}px`),x.setAttributeNS(null,"viewBox",`0 0 ${Z} ${O}`);const H=te.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"stroke","none"),H.setAttributeNS(null,"stroke-width","1"),H.setAttributeNS(null,"fill","none"),H.setAttributeNS(null,"fill-rule","evenodd");const ae=te.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"fill-rule","nonzero");const ue=te.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ue.setAttributeNS(null,"fill","#000000");const ge=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of ge){const xe=te.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",oe.rx),xe.setAttributeNS(null,"ry",oe.ry),ue.appendChild(xe)}const Le=te.createNS("http://www.w3.org/2000/svg","g");Le.setAttributeNS(null,"fill",this._color);const m=te.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Le.appendChild(m);const w=te.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"opacity","0.25"),w.setAttributeNS(null,"fill","#000000");const _=te.createNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),w.appendChild(_);const T=te.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(6.0, 7.0)"),T.setAttributeNS(null,"fill","#FFFFFF");const N=te.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=te.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const X=te.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),N.appendChild($),N.appendChild(X),ae.appendChild(ue),ae.appendChild(Le),ae.appendChild(w),ae.appendChild(T),ae.appendChild(N),x.appendChild(ae),x.setAttributeNS(null,"height",O*this._scale+"px"),x.setAttributeNS(null,"width",Z*this._scale+"px"),this._element.appendChild(x),this._offset=M.P.convert(h&&h.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),vl(this._element,this._anchor,"marker"),h&&h.className)for(const x of h.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),h.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=M.L.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){const Z=Math.abs(13.5)/Math.SQRT2;h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[Z,-1*(38.1-13.5+Z)],"bottom-right":[-Z,-1*(38.1-13.5+Z)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(h){return this._offset=M.P.convert(h),this._update(),this}addClassName(h){this._element.classList.add(h)}removeClassName(h){this._element.classList.remove(h)}toggleClassName(h){return this._element.classList.toggle(h)}setDraggable(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let il=0,sh=!1;const ec={maxWidth:100,unit:"metric"};function If(D,h,x){const O=x&&x.maxWidth||100,Z=D._container.clientHeight/2,H=D.unproject([0,Z]),ae=D.unproject([O,Z]),ue=H.distanceTo(ae);if(x&&x.unit==="imperial"){const ge=3.2808*ue;ge>5280?Rc(h,O,ge/5280,D._getUIString("ScaleControl.Miles")):Rc(h,O,ge,D._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?Rc(h,O,ue/1852,D._getUIString("ScaleControl.NauticalMiles")):ue>=1e3?Rc(h,O,ue/1e3,D._getUIString("ScaleControl.Kilometers")):Rc(h,O,ue,D._getUIString("ScaleControl.Meters"))}function Rc(D,h,x,O){const Z=function(H){const ae=Math.pow(10,`${Math.floor(H)}`.length-1);let ue=H/ae;return ue=ue>=10?10:ue>=5?5:ue>=3?3:ue>=2?2:ue>=1?1:function(ge){const Le=Math.pow(10,Math.ceil(-Math.log(ge)/Math.LN10));return Math.round(ge*Le)/Le}(ue),ae*ue}(x);D.style.width=h*(Z/x)+"px",D.innerHTML=`${Z}&nbsp;${O}`}const Cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dh(D){if(D){if(typeof D=="number"){const h=Math.round(Math.abs(D)/Math.SQRT2);return{center:new M.P(0,0),top:new M.P(0,D),"top-left":new M.P(h,h),"top-right":new M.P(-h,h),bottom:new M.P(0,-D),"bottom-left":new M.P(h,-h),"bottom-right":new M.P(-h,-h),left:new M.P(D,0),right:new M.P(-D,0)}}if(D instanceof M.P||Array.isArray(D)){const h=M.P.convert(D);return{center:h,top:h,"top-left":h,"top-right":h,bottom:h,"bottom-left":h,"bottom-right":h,left:h,right:h}}return{center:M.P.convert(D.center||[0,0]),top:M.P.convert(D.top||[0,0]),"top-left":M.P.convert(D["top-left"]||[0,0]),"top-right":M.P.convert(D["top-right"]||[0,0]),bottom:M.P.convert(D.bottom||[0,0]),"bottom-left":M.P.convert(D["bottom-left"]||[0,0]),"bottom-right":M.P.convert(D["bottom-right"]||[0,0]),left:M.P.convert(D.left||[0,0]),right:M.P.convert(D.right||[0,0])}}return Dh(new M.P(0,0))}const wp={extend:(D,...h)=>M.e(D,...h),run(D){D()},logToElement(D,h=!1,x="log"){const O=window.document.getElementById(x);O&&(h&&(O.innerHTML=""),O.innerHTML+=`<br>${D}`)}},Jf=ee;class mr{static get version(){return Jf}static get workerCount(){return mt.workerCount}static set workerCount(h){mt.workerCount=h}static get maxParallelImageRequests(){return M.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(h){M.c.MAX_PARALLEL_IMAGE_REQUESTS=h}static get workerUrl(){return M.c.WORKER_URL}static set workerUrl(h){M.c.WORKER_URL=h}static addProtocol(h,x){M.c.REGISTERED_PROTOCOLS[h]=x}static removeProtocol(h){delete M.c.REGISTERED_PROTOCOLS[h]}}return mr.Map=class extends xo{constructor(D){if(M.bf.mark(M.bg.create),(D=M.e({},ba,D)).minZoom!=null&&D.maxZoom!=null&&D.minZoom>D.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(D.minPitch!=null&&D.maxPitch!=null&&D.minPitch>D.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(D.minPitch!=null&&D.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(D.maxPitch!=null&&D.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new kh(D.minZoom,D.maxZoom,D.minPitch,D.maxPitch,D.renderWorldCopies),{bearingSnap:D.bearingSnap}),this._cooperativeGesturesOnWheel=h=>{this._onCooperativeGesture(h,h[this._metaKey],1)},this._contextLost=h=>{h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new M.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new M.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=D.interactive,this._cooperativeGestures=D.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=D.maxTileCacheSize,this._maxTileCacheZoomLevels=D.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=D.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=D.preserveDrawingBuffer,this._antialias=D.antialias,this._trackResize=D.trackResize,this._bearingSnap=D.bearingSnap,this._refreshExpiredTiles=D.refreshExpiredTiles,this._fadeDuration=D.fadeDuration,this._crossSourceCollisions=D.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=D.collectResourceTiming,this._renderTaskQueue=new dl,this._controls=[],this._mapId=M.a2(),this._locale=M.e({},Kf,D.locale),this._clickTolerance=D.clickTolerance,this._overridePixelRatio=D.pixelRatio,this._maxCanvasSize=D.maxCanvasSize,this.transformCameraUpdate=D.transformCameraUpdate,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new jt(D.transformRequest),typeof D.container=="string"){if(this._container=document.getElementById(D.container),!this._container)throw new Error(`Container '${D.container}' not found.`)}else{if(!(D.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=D.container}if(D.maxBounds&&this.setMaxBounds(D.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window!="undefined"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const x=Xs(O=>{this._trackResize&&!this._removed&&this.resize(O)._update()},50);this._resizeObserver=new ResizeObserver(O=>{h?x(O):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new _l(this,D),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=D.hash&&new qf(typeof D.hash=="string"&&D.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch}),D.bounds&&(this.resize(),this.fitBounds(D.bounds,M.e({},D.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=D.localIdeographFontFamily,this._validateStyle=D.validateStyle,D.style&&this.setStyle(D.style,{localIdeographFontFamily:D.localIdeographFontFamily}),D.attributionControl&&this.addControl(new Dl({customAttribution:D.customAttribution})),D.maplibreLogo&&this.addControl(new Po,D.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new M.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new M.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new M.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(D,h){if(h===void 0&&(h=D.getDefaultPosition?D.getDefaultPosition():"top-right"),!D||!D.onAdd)return this.fire(new M.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const x=D.onAdd(this);this._controls.push(D);const O=this._controlPositions[h];return h.indexOf("bottom")!==-1?O.insertBefore(x,O.firstChild):O.appendChild(x),this}removeControl(D){if(!D||!D.onRemove)return this.fire(new M.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const h=this._controls.indexOf(D);return h>-1&&this._controls.splice(h,1),D.onRemove(this),this}hasControl(D){return this._controls.indexOf(D)>-1}calculateCameraOptionsFromTo(D,h,x,O){return O==null&&this.terrain&&(O=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(D,h,x,O)}resize(D){var h;const x=this._containerDimensions(),O=x[0],Z=x[1],H=this._getClampedPixelRatio(O,Z);if(this._resizeCanvas(O,Z,H),this.painter.resize(O,Z,H),this.painter.overLimit()){const ue=this.painter.context.gl;this._maxCanvasSize=[ue.drawingBufferWidth,ue.drawingBufferHeight];const ge=this._getClampedPixelRatio(O,Z);this._resizeCanvas(O,Z,ge),this.painter.resize(O,Z,ge)}this.transform.resize(O,Z),(h=this._requestedCameraState)===null||h===void 0||h.resize(O,Z);const ae=!this._moving;return ae&&(this.stop(),this.fire(new M.k("movestart",D)).fire(new M.k("move",D))),this.fire(new M.k("resize",D)),ae&&this.fire(new M.k("moveend",D)),this}_getClampedPixelRatio(D,h){const{0:x,1:O}=this._maxCanvasSize,Z=this.getPixelRatio(),H=D*Z,ae=h*Z;return Math.min(H>x?x/H:1,ae>O?O/ae:1)*Z}getPixelRatio(){var D;return(D=this._overridePixelRatio)!==null&&D!==void 0?D:devicePixelRatio}setPixelRatio(D){this._overridePixelRatio=D,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(D){return this.transform.setMaxBounds(Nr.convert(D)),this._update()}setMinZoom(D){if((D=D==null?-2:D)>=-2&&D<=this.transform.maxZoom)return this.transform.minZoom=D,this._update(),this.getZoom()<D&&this.setZoom(D),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(D){if((D=D==null?22:D)>=this.transform.minZoom)return this.transform.maxZoom=D,this._update(),this.getZoom()>D&&this.setZoom(D),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(D){if((D=D==null?0:D)<0)throw new Error("minPitch must be greater than or equal to 0");if(D>=0&&D<=this.transform.maxPitch)return this.transform.minPitch=D,this._update(),this.getPitch()<D&&this.setPitch(D),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(D){if((D=D==null?60:D)>85)throw new Error("maxPitch must be less than or equal to 85");if(D>=this.transform.minPitch)return this.transform.maxPitch=D,this._update(),this.getPitch()>D&&this.setPitch(D),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(D){return this.transform.renderWorldCopies=D,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(D){return this._cooperativeGestures=D,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(D){return this.transform.locationPoint(M.L.convert(D),this.style&&this.terrain)}unproject(D){return this.transform.pointLocation(M.P.convert(D),this.terrain)}isMoving(){var D;return this._moving||((D=this.handlers)===null||D===void 0?void 0:D.isMoving())}isZooming(){var D;return this._zooming||((D=this.handlers)===null||D===void 0?void 0:D.isZooming())}isRotating(){var D;return this._rotating||((D=this.handlers)===null||D===void 0?void 0:D.isRotating())}_createDelegatedListener(D,h,x){if(D==="mouseenter"||D==="mouseover"){let O=!1;return{layer:h,listener:x,delegates:{mousemove:H=>{const ae=this.getLayer(h)?this.queryRenderedFeatures(H.point,{layers:[h]}):[];ae.length?O||(O=!0,x.call(this,new Ms(D,this,H.originalEvent,{features:ae}))):O=!1},mouseout:()=>{O=!1}}}}if(D==="mouseleave"||D==="mouseout"){let O=!1;return{layer:h,listener:x,delegates:{mousemove:ae=>{(this.getLayer(h)?this.queryRenderedFeatures(ae.point,{layers:[h]}):[]).length?O=!0:O&&(O=!1,x.call(this,new Ms(D,this,ae.originalEvent)))},mouseout:ae=>{O&&(O=!1,x.call(this,new Ms(D,this,ae.originalEvent)))}}}}{const O=Z=>{const H=this.getLayer(h)?this.queryRenderedFeatures(Z.point,{layers:[h]}):[];H.length&&(Z.features=H,x.call(this,Z),delete Z.features)};return{layer:h,listener:x,delegates:{[D]:O}}}}on(D,h,x){if(x===void 0)return super.on(D,h);const O=this._createDelegatedListener(D,h,x);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[D]=this._delegatedListeners[D]||[],this._delegatedListeners[D].push(O);for(const Z in O.delegates)this.on(Z,O.delegates[Z]);return this}once(D,h,x){if(x===void 0)return super.once(D,h);const O=this._createDelegatedListener(D,h,x);for(const Z in O.delegates)this.once(Z,O.delegates[Z]);return this}off(D,h,x){return x===void 0?super.off(D,h):(this._delegatedListeners&&this._delegatedListeners[D]&&(O=>{const Z=this._delegatedListeners[D];for(let H=0;H<Z.length;H++){const ae=Z[H];if(ae.layer===h&&ae.listener===x){for(const ue in ae.delegates)this.off(ue,ae.delegates[ue]);return Z.splice(H,1),this}}})(),this)}queryRenderedFeatures(D,h){if(!this.style)return[];let x;const O=D instanceof M.P||Array.isArray(D),Z=O?D:[[0,0],[this.transform.width,this.transform.height]];if(h=h||(O?{}:D)||{},Z instanceof M.P||typeof Z[0]=="number")x=[M.P.convert(Z)];else{const H=M.P.convert(Z[0]),ae=M.P.convert(Z[1]);x=[H,new M.P(ae.x,H.y),ae,new M.P(H.x,ae.y),H]}return this.style.queryRenderedFeatures(x,h,this.transform)}querySourceFeatures(D,h){return this.style.querySourceFeatures(D,h)}setStyle(D,h){return(h=M.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},h)).diff!==!1&&h.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&D?(this._diffStyle(D,h),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._updateStyle(D,h))}setTransformRequest(D){return this._requestManager.setTransformRequest(D),this}_getUIString(D){const h=this._locale[D];if(h==null)throw new Error(`Missing UI string '${D}'`);return h}_updateStyle(D,h){if(h.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(D,h));const x=this.style&&h.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!D)),D?(this.style=new Ss(this,h||{}),this.style.setEventedParent(this,{style:this.style}),typeof D=="string"?this.style.loadURL(D,h,x):this.style.loadJSON(D,h,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ss(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(D,h){if(typeof D=="string"){const x=this._requestManager.transformRequest(D,Ct.Style);M.f(x,(O,Z)=>{O?this.fire(new M.j(O)):Z&&this._updateDiff(Z,h)})}else typeof D=="object"&&this._updateDiff(D,h)}_updateDiff(D,h){try{this.style.setState(D,h)&&this._update(!0)}catch(x){M.w(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(D,h)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():M.w("There is no style added to the map.")}addSource(D,h){return this._lazyInitEmptyStyle(),this.style.addSource(D,h),this._update(!0)}isSourceLoaded(D){const h=this.style&&this.style.sourceCaches[D];if(h!==void 0)return h.loaded();this.fire(new M.j(new Error(`There is no source with ID '${D}'`)))}setTerrain(D){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),D){const h=this.style.sourceCaches[D.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${D.source}`);for(const x in this.style._layers){const O=this.style._layers[x];O.type==="hillshade"&&O.source===D.source&&M.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ec(this.painter,h,D),this.painter.renderToTexture=new ta(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==D.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new M.k("terrain",{terrain:D})),this}getTerrain(){var D,h;return(h=(D=this.terrain)===null||D===void 0?void 0:D.options)!==null&&h!==void 0?h:null}areTilesLoaded(){const D=this.style&&this.style.sourceCaches;for(const h in D){const x=D[h]._tiles;for(const O in x){const Z=x[O];if(Z.state!=="loaded"&&Z.state!=="errored")return!1}}return!0}addSourceType(D,h,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(D,h,x)}removeSource(D){return this.style.removeSource(D),this._update(!0)}getSource(D){return this.style.getSource(D)}addImage(D,h,x={}){const{pixelRatio:O=1,sdf:Z=!1,stretchX:H,stretchY:ae,content:ue}=x;if(this._lazyInitEmptyStyle(),!(h instanceof HTMLImageElement||M.a(h))){if(h.width===void 0||h.height===void 0)return this.fire(new M.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ge,height:Le,data:m}=h,w=h;return this.style.addImage(D,{data:new M.R({width:ge,height:Le},new Uint8Array(m)),pixelRatio:O,stretchX:H,stretchY:ae,content:ue,sdf:Z,version:0,userImage:w}),w.onAdd&&w.onAdd(this,D),this}}{const{width:ge,height:Le,data:m}=M.h.getImageData(h);this.style.addImage(D,{data:new M.R({width:ge,height:Le},m),pixelRatio:O,stretchX:H,stretchY:ae,content:ue,sdf:Z,version:0})}}updateImage(D,h){const x=this.style.getImage(D);if(!x)return this.fire(new M.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const O=h instanceof HTMLImageElement||M.a(h)?M.h.getImageData(h):h,{width:Z,height:H,data:ae}=O;if(Z===void 0||H===void 0)return this.fire(new M.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(Z!==x.data.width||H!==x.data.height)return this.fire(new M.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const ue=!(h instanceof HTMLImageElement||M.a(h));return x.data.replace(ae,ue),this.style.updateImage(D,x),this}getImage(D){return this.style.getImage(D)}hasImage(D){return D?!!this.style.getImage(D):(this.fire(new M.j(new Error("Missing required image id"))),!1)}removeImage(D){this.style.removeImage(D)}loadImage(D,h){nt.getImage(this._requestManager.transformRequest(D,Ct.Image),h)}listImages(){return this.style.listImages()}addLayer(D,h){return this._lazyInitEmptyStyle(),this.style.addLayer(D,h),this._update(!0)}moveLayer(D,h){return this.style.moveLayer(D,h),this._update(!0)}removeLayer(D){return this.style.removeLayer(D),this._update(!0)}getLayer(D){return this.style.getLayer(D)}setLayerZoomRange(D,h,x){return this.style.setLayerZoomRange(D,h,x),this._update(!0)}setFilter(D,h,x={}){return this.style.setFilter(D,h,x),this._update(!0)}getFilter(D){return this.style.getFilter(D)}setPaintProperty(D,h,x,O={}){return this.style.setPaintProperty(D,h,x,O),this._update(!0)}getPaintProperty(D,h){return this.style.getPaintProperty(D,h)}setLayoutProperty(D,h,x,O={}){return this.style.setLayoutProperty(D,h,x,O),this._update(!0)}getLayoutProperty(D,h){return this.style.getLayoutProperty(D,h)}setGlyphs(D,h={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(D,h),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(D,h,x={}){return this._lazyInitEmptyStyle(),this.style.addSprite(D,h,x,O=>{O||this._update(!0)}),this}removeSprite(D){return this._lazyInitEmptyStyle(),this.style.removeSprite(D),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(D,h={}){return this._lazyInitEmptyStyle(),this.style.setSprite(D,h,x=>{x||this._update(!0)}),this}setLight(D,h={}){return this._lazyInitEmptyStyle(),this.style.setLight(D,h),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(D,h){return this.style.setFeatureState(D,h),this._update()}removeFeatureState(D,h){return this.style.removeFeatureState(D,h),this._update()}getFeatureState(D){return this.style.getFeatureState(D)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let D=0,h=0;return this._container&&(D=this._container.clientWidth||400,h=this._container.clientHeight||300),[D,h]}_setupContainer(){const D=this._container;D.classList.add("maplibregl-map");const h=this._canvasContainer=te.create("div","maplibregl-canvas-container",D);this._interactive&&h.classList.add("maplibregl-interactive"),this._canvas=te.create("canvas","maplibregl-canvas",h),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const x=this._containerDimensions(),O=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],O);const Z=this._controlContainer=te.create("div","maplibregl-control-container",D),H=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(ae=>{H[ae]=te.create("div",`maplibregl-ctrl-${ae} `,Z)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=te.create("div","maplibregl-cooperative-gesture-screen",this._container);let D=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(D=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${D}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){te.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(D,h,x){this._canvas.width=Math.floor(x*D),this._canvas.height=Math.floor(x*h),this._canvas.style.width=`${D}px`,this._canvas.style.height=`${h}px`}_setupPainter(){const D={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let h=null;this._canvas.addEventListener("webglcontextcreationerror",O=>{h={requestedAttributes:D},O&&(h.statusMessage=O.statusMessage,h.type=O.type)},{once:!0});const x=this._canvas.getContext("webgl2",D)||this._canvas.getContext("webgl",D);if(!x){const O="Failed to initialize WebGL";throw h?(h.message=O,new Error(JSON.stringify(h))):new Error(O)}this.painter=new Yf(x,this.transform),pe.testSupport(x)}_onCooperativeGesture(D,h,x){return!h&&x<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(D){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||D,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(D){return this._update(),this._renderTaskQueue.add(D)}_cancelRenderFrame(D){this._renderTaskQueue.remove(D)}_render(D){const h=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(D),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,H=M.h.now();this.style.zoomHistory.update(Z,H);const ae=new M.a8(Z,{now:H,fadeDuration:h,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ue=ae.crossFadingFactor();ue===1&&ue===this._crossFadingFactor||(x=!0,this._crossFadingFactor=ue),this.style.update(ae)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,h,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:h,showPadding:this.showPadding}),this.fire(new M.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,M.bf.mark(M.bg.load),this.fire(new M.k("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new M.k("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,M.bf.mark(M.bg.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var D;this._hash&&this._hash.remove();for(const x of this._controls)x.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(D=this._resizeObserver)===null||D===void 0||D.disconnect();const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),te.remove(this._canvasContainer),te.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),M.bf.clearMetrics(),this._removed=!0,this.fire(new M.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=M.h.frame(D=>{M.bf.frame(D),this._frame=null,this._render(D)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(D){this._showTileBoundaries!==D&&(this._showTileBoundaries=D,this._update())}get showPadding(){return!!this._showPadding}set showPadding(D){this._showPadding!==D&&(this._showPadding=D,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(D){this._showCollisionBoxes!==D&&(this._showCollisionBoxes=D,D?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(D){this._showOverdrawInspector!==D&&(this._showOverdrawInspector=D,this._update())}get repaint(){return!!this._repaint}set repaint(D){this._repaint!==D&&(this._repaint=D,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(D){this._vertices=D,this._update()}get version(){return Da}getCameraTargetElevation(){return this.transform.elevation}},mr.NavigationControl=class{constructor(D){this._updateZoomButtons=()=>{const h=this._map.getZoom(),x=h===this._map.getMaxZoom(),O=h===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=O,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",O.toString())},this._rotateCompassArrow=()=>{const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h},this._setButtonTitle=(h,x)=>{const O=this._map._getUIString(`NavigationControl.${x}`);h.title=O,h.setAttribute("aria-label",O)},this.options=M.e({},jl,D),this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",h=>this._map.zoomIn({},{originalEvent:h})),te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",h=>this._map.zoomOut({},{originalEvent:h})),te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",h=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:h}):this._map.resetNorth({},{originalEvent:h})}),this._compassIcon=te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(D){return this._map=D,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new df(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(D,h){const x=te.create("button",D,this._container);return x.type="button",x.addEventListener("click",h),x}},mr.GeolocateControl=class extends M.E{constructor(D){super(),this._onSuccess=h=>{if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new M.k("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new M.k("geolocate",h)),this._finish()}},this._updateCamera=h=>{const x=new M.L(h.coords.longitude,h.coords.latitude),O=h.coords.accuracy,Z=this._map.getBearing(),H=M.e({bearing:Z},this.options.fitBoundsOptions),ae=Nr.fromLngLat(x,O);this._map.fitBounds(ae,H,{geolocateSource:!0})},this._updateMarker=h=>{if(h){const x=new M.L(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=h=>{if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&sh)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new M.k("error",h)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=h=>{if(this._map){if(this._container.addEventListener("contextmenu",x=>x.preventDefault()),this._geolocateButton=te.create("button","maplibregl-ctrl-geolocate",this._container),te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){M.w("Geolocation support is not available so the GeolocateControl will be disabled.");const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{const x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new kf({element:this._dotElement}),this._circleElement=te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new M.k("trackuserlocationend")))})}},this.options=M.e({},Zu,D)}onAdd(D){return this._map=D,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(h,x=!1){Pu===void 0||x?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(O=>{Pu=O.state!=="denied",h(Pu)}).catch(()=>{Pu=!!window.navigator.geolocation,h(Pu)}):(Pu=!!window.navigator.geolocation,h(Pu)):h(Pu)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,il=0,sh=!1}_isOutOfMapMaxBounds(D){const h=this._map.getMaxBounds(),x=D.coords;return h&&(x.longitude<h.getWest()||x.longitude>h.getEast()||x.latitude<h.getSouth()||x.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const D=this._map.getBounds(),h=D.getSouthEast(),x=D.getNorthEast(),O=h.distanceTo(x),Z=Math.ceil(this._accuracy/(O/this._map._container.clientHeight)*2);this._circleElement.style.width=`${Z}px`,this._circleElement.style.height=`${Z}px`}trigger(){if(!this._setup)return M.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new M.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":il--,sh=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new M.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new M.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let D;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),il++,il>1?(D={maximumAge:6e5,timeout:0},sh=!0):(D=this.options.positionOptions,sh=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,D)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},mr.AttributionControl=Dl,mr.LogoControl=Po,mr.ScaleControl=class{constructor(D){this._onMove=()=>{If(this._map,this._container,this.options)},this.setUnit=h=>{this.options.unit=h,If(this._map,this._container,this.options)},this.options=M.e({},ec,D)}getDefaultPosition(){return"bottom-left"}onAdd(D){return this._map=D,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",D.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},mr.FullscreenControl=class extends M.E{constructor(D={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,D&&D.container&&(D.container instanceof HTMLElement?this._container=D.container:M.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(D){return this._map=D,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const D=this._fullscreenButton=te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);te.create("span","maplibregl-ctrl-icon",D).setAttribute("aria-hidden","true"),D.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const D=this._getTitle();this._fullscreenButton.setAttribute("aria-label",D),this._fullscreenButton.title=D}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new M.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new M.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},mr.TerrainControl=class{constructor(D){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=D}onAdd(D){return this._map=D,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=te.create("button","maplibregl-ctrl-terrain",this._container),te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},mr.Popup=class extends M.E{constructor(D){super(),this.remove=()=>(this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new M.k("close")),this),this._onMouseUp=h=>{this._update(h.point)},this._onMouseMove=h=>{this._update(h.point)},this._onDrag=h=>{this._update(h.point)},this._update=h=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const ae of this.options.className.split(" "))this._container.classList.add(ae);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rh(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h)return;const x=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let O=this.options.anchor;const Z=Dh(this.options.offset);if(!O){const ae=this._container.offsetWidth,ue=this._container.offsetHeight;let ge;ge=x.y+Z.bottom.y<ue?["top"]:x.y>this._map.transform.height-ue?["bottom"]:[],x.x<ae/2?ge.push("left"):x.x>this._map.transform.width-ae/2&&ge.push("right"),O=ge.length===0?"bottom":ge.join("-")}const H=x.add(Z[O]).round();te.setTransform(this._container,`${ho[O]} translate(${H.x}px,${H.y}px)`),vl(this._container,O,"popup")},this._onClose=()=>{this.remove()},this.options=M.e(Object.create(Cc),D)}addTo(D){return this._map&&this.remove(),this._map=D,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new M.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(D){return this._lngLat=M.L.convert(D),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(D){return this.setDOMContent(document.createTextNode(D))}setHTML(D){const h=document.createDocumentFragment(),x=document.createElement("body");let O;for(x.innerHTML=D;O=x.firstChild,O;)h.appendChild(O);return this.setDOMContent(h)}getMaxWidth(){var D;return(D=this._container)===null||D===void 0?void 0:D.style.maxWidth}setMaxWidth(D){return this.options.maxWidth=D,this._update(),this}setDOMContent(D){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(D),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(D){this._container&&this._container.classList.add(D)}removeClassName(D){this._container&&this._container.classList.remove(D)}setOffset(D){return this.options.offset=D,this._update(),this}toggleClassName(D){if(this._container)return this._container.classList.toggle(D)}_createCloseButton(){this.options.closeButton&&(this._closeButton=te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const D=this._container.querySelector(Lf);D&&D.focus()}},mr.Marker=kf,mr.Style=Ss,mr.LngLat=M.L,mr.LngLatBounds=Nr,mr.Point=M.P,mr.MercatorCoordinate=M.U,mr.Evented=M.E,mr.AJAXError=M.bh,mr.config=M.c,mr.CanvasSource=La,mr.GeoJSONSource=Ka,mr.ImageSource=ca,mr.RasterDEMTileSource=pi,mr.RasterTileSource=Ji,mr.VectorTileSource=xn,mr.VideoSource=po,mr.setRTLTextPlugin=M.bi,mr.getRTLTextPluginStatus=M.bj,mr.prewarm=function(){mn().acquire(lt)},mr.clearPrewarmedResources=function(){const D=xr;D&&(D.isPreloaded()&&D.numActive()===1?(D.release(lt),xr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},wp.extend(mr,{isSafari:M.ac,getPerformanceMetrics:M.bf.getPerformanceMetrics}),mr});var P=K;return P})},97326:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return K}});function K(j){if(j===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j}},61120:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return K}});function K(j){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(M){return M.__proto__||Object.getPrototypeOf(M)},K(j)}},60136:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return j}});var K=G(89611);function j(P,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function");P.prototype=Object.create(M&&M.prototype,{constructor:{value:P,writable:!0,configurable:!0}}),Object.defineProperty(P,"prototype",{writable:!1}),M&&(0,K.Z)(P,M)}},78814:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return K}});function K(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}},82963:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return P}});var K=G(71002),j=G(97326);function P(M,ee){if(ee&&((0,K.Z)(ee)==="object"||typeof ee=="function"))return ee;if(ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(0,j.Z)(M)}},89611:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return K}});function K(j,P){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ee,te){return ee.__proto__=te,ee},K(j,P)}},74902:function(Ue,_e,G){"use strict";G.d(_e,{Z:function(){return te}});var K=G(30907);function j(pe){if(Array.isArray(pe))return(0,K.Z)(pe)}var P=G(59199),M=G(40181);function ee(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function te(pe){return j(pe)||(0,P.Z)(pe)||(0,M.Z)(pe)||ee()}}}]);
